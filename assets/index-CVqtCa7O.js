function mMe(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var hM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var VI={exports:{}},OT={};var CX;function gMe(){if(CX)return OT;CX=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,r,s){var a=null;if(s!==void 0&&(a=""+s),r.key!==void 0&&(a=""+r.key),"key"in r){s={};for(var o in r)o!=="key"&&(s[o]=r[o])}else s=r;return r=s.ref,{$$typeof:n,type:i,key:a,ref:r!==void 0?r:null,props:s}}return OT.Fragment=e,OT.jsx=t,OT.jsxs=t,OT}var wX;function yMe(){return wX||(wX=1,VI.exports=gMe()),VI.exports}var $=yMe(),HI={exports:{}},Ji={};var EX;function vMe(){if(EX)return Ji;EX=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),d=Symbol.for("react.activity"),f=Symbol.iterator;function m(ue){return ue===null||typeof ue!="object"?null:(ue=f&&ue[f]||ue["@@iterator"],typeof ue=="function"?ue:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,S={};function b(ue,ce,Ce){this.props=ue,this.context=ce,this.refs=S,this.updater=Ce||y}b.prototype.isReactComponent={},b.prototype.setState=function(ue,ce){if(typeof ue!="object"&&typeof ue!="function"&&ue!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ue,ce,"setState")},b.prototype.forceUpdate=function(ue){this.updater.enqueueForceUpdate(this,ue,"forceUpdate")};function M(){}M.prototype=b.prototype;function w(ue,ce,Ce){this.props=ue,this.context=ce,this.refs=S,this.updater=Ce||y}var T=w.prototype=new M;T.constructor=w,_(T,b.prototype),T.isPureReactComponent=!0;var E=Array.isArray;function R(){}var P={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function B(ue,ce,Ce){var Oe=Ce.ref;return{$$typeof:n,type:ue,key:ce,ref:Oe!==void 0?Oe:null,props:Ce}}function N(ue,ce){return B(ue.type,ce,ue.props)}function U(ue){return typeof ue=="object"&&ue!==null&&ue.$$typeof===n}function V(ue){var ce={"=":"=0",":":"=2"};return"$"+ue.replace(/[=:]/g,function(Ce){return ce[Ce]})}var W=/\/+/g;function K(ue,ce){return typeof ue=="object"&&ue!==null&&ue.key!=null?V(""+ue.key):ce.toString(36)}function q(ue){switch(ue.status){case"fulfilled":return ue.value;case"rejected":throw ue.reason;default:switch(typeof ue.status=="string"?ue.then(R,R):(ue.status="pending",ue.then(function(ce){ue.status==="pending"&&(ue.status="fulfilled",ue.value=ce)},function(ce){ue.status==="pending"&&(ue.status="rejected",ue.reason=ce)})),ue.status){case"fulfilled":return ue.value;case"rejected":throw ue.reason}}throw ue}function j(ue,ce,Ce,Oe,nt){var Ae=typeof ue;(Ae==="undefined"||Ae==="boolean")&&(ue=null);var Ye=!1;if(ue===null)Ye=!0;else switch(Ae){case"bigint":case"string":case"number":Ye=!0;break;case"object":switch(ue.$$typeof){case n:case e:Ye=!0;break;case c:return Ye=ue._init,j(Ye(ue._payload),ce,Ce,Oe,nt)}}if(Ye)return nt=nt(ue),Ye=Oe===""?"."+K(ue,0):Oe,E(nt)?(Ce="",Ye!=null&&(Ce=Ye.replace(W,"$&/")+"/"),j(nt,ce,Ce,"",function(ot){return ot})):nt!=null&&(U(nt)&&(nt=N(nt,Ce+(nt.key==null||ue&&ue.key===nt.key?"":(""+nt.key).replace(W,"$&/")+"/")+Ye)),ce.push(nt)),1;Ye=0;var ft=Oe===""?".":Oe+":";if(E(ue))for(var ze=0;ze<ue.length;ze++)Oe=ue[ze],Ae=ft+K(Oe,ze),Ye+=j(Oe,ce,Ce,Ae,nt);else if(ze=m(ue),typeof ze=="function")for(ue=ze.call(ue),ze=0;!(Oe=ue.next()).done;)Oe=Oe.value,Ae=ft+K(Oe,ze++),Ye+=j(Oe,ce,Ce,Ae,nt);else if(Ae==="object"){if(typeof ue.then=="function")return j(q(ue),ce,Ce,Oe,nt);throw ce=String(ue),Error("Objects are not valid as a React child (found: "+(ce==="[object Object]"?"object with keys {"+Object.keys(ue).join(", ")+"}":ce)+"). If you meant to render a collection of children, use an array instead.")}return Ye}function te(ue,ce,Ce){if(ue==null)return ue;var Oe=[],nt=0;return j(ue,Oe,"","",function(Ae){return ce.call(Ce,Ae,nt++)}),Oe}function he(ue){if(ue._status===-1){var ce=ue._result;ce=ce(),ce.then(function(Ce){(ue._status===0||ue._status===-1)&&(ue._status=1,ue._result=Ce)},function(Ce){(ue._status===0||ue._status===-1)&&(ue._status=2,ue._result=Ce)}),ue._status===-1&&(ue._status=0,ue._result=ce)}if(ue._status===1)return ue._result.default;throw ue._result}var _e=typeof reportError=="function"?reportError:function(ue){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ce=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ue=="object"&&ue!==null&&typeof ue.message=="string"?String(ue.message):String(ue),error:ue});if(!window.dispatchEvent(ce))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ue);return}console.error(ue)},Be={map:te,forEach:function(ue,ce,Ce){te(ue,function(){ce.apply(this,arguments)},Ce)},count:function(ue){var ce=0;return te(ue,function(){ce++}),ce},toArray:function(ue){return te(ue,function(ce){return ce})||[]},only:function(ue){if(!U(ue))throw Error("React.Children.only expected to receive a single React element child.");return ue}};return Ji.Activity=d,Ji.Children=Be,Ji.Component=b,Ji.Fragment=t,Ji.Profiler=r,Ji.PureComponent=w,Ji.StrictMode=i,Ji.Suspense=l,Ji.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,Ji.__COMPILER_RUNTIME={__proto__:null,c:function(ue){return P.H.useMemoCache(ue)}},Ji.cache=function(ue){return function(){return ue.apply(null,arguments)}},Ji.cacheSignal=function(){return null},Ji.cloneElement=function(ue,ce,Ce){if(ue==null)throw Error("The argument must be a React element, but you passed "+ue+".");var Oe=_({},ue.props),nt=ue.key;if(ce!=null)for(Ae in ce.key!==void 0&&(nt=""+ce.key),ce)!I.call(ce,Ae)||Ae==="key"||Ae==="__self"||Ae==="__source"||Ae==="ref"&&ce.ref===void 0||(Oe[Ae]=ce[Ae]);var Ae=arguments.length-2;if(Ae===1)Oe.children=Ce;else if(1<Ae){for(var Ye=Array(Ae),ft=0;ft<Ae;ft++)Ye[ft]=arguments[ft+2];Oe.children=Ye}return B(ue.type,nt,Oe)},Ji.createContext=function(ue){return ue={$$typeof:a,_currentValue:ue,_currentValue2:ue,_threadCount:0,Provider:null,Consumer:null},ue.Provider=ue,ue.Consumer={$$typeof:s,_context:ue},ue},Ji.createElement=function(ue,ce,Ce){var Oe,nt={},Ae=null;if(ce!=null)for(Oe in ce.key!==void 0&&(Ae=""+ce.key),ce)I.call(ce,Oe)&&Oe!=="key"&&Oe!=="__self"&&Oe!=="__source"&&(nt[Oe]=ce[Oe]);var Ye=arguments.length-2;if(Ye===1)nt.children=Ce;else if(1<Ye){for(var ft=Array(Ye),ze=0;ze<Ye;ze++)ft[ze]=arguments[ze+2];nt.children=ft}if(ue&&ue.defaultProps)for(Oe in Ye=ue.defaultProps,Ye)nt[Oe]===void 0&&(nt[Oe]=Ye[Oe]);return B(ue,Ae,nt)},Ji.createRef=function(){return{current:null}},Ji.forwardRef=function(ue){return{$$typeof:o,render:ue}},Ji.isValidElement=U,Ji.lazy=function(ue){return{$$typeof:c,_payload:{_status:-1,_result:ue},_init:he}},Ji.memo=function(ue,ce){return{$$typeof:u,type:ue,compare:ce===void 0?null:ce}},Ji.startTransition=function(ue){var ce=P.T,Ce={};P.T=Ce;try{var Oe=ue(),nt=P.S;nt!==null&&nt(Ce,Oe),typeof Oe=="object"&&Oe!==null&&typeof Oe.then=="function"&&Oe.then(R,_e)}catch(Ae){_e(Ae)}finally{ce!==null&&Ce.types!==null&&(ce.types=Ce.types),P.T=ce}},Ji.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},Ji.use=function(ue){return P.H.use(ue)},Ji.useActionState=function(ue,ce,Ce){return P.H.useActionState(ue,ce,Ce)},Ji.useCallback=function(ue,ce){return P.H.useCallback(ue,ce)},Ji.useContext=function(ue){return P.H.useContext(ue)},Ji.useDebugValue=function(){},Ji.useDeferredValue=function(ue,ce){return P.H.useDeferredValue(ue,ce)},Ji.useEffect=function(ue,ce){return P.H.useEffect(ue,ce)},Ji.useEffectEvent=function(ue){return P.H.useEffectEvent(ue)},Ji.useId=function(){return P.H.useId()},Ji.useImperativeHandle=function(ue,ce,Ce){return P.H.useImperativeHandle(ue,ce,Ce)},Ji.useInsertionEffect=function(ue,ce){return P.H.useInsertionEffect(ue,ce)},Ji.useLayoutEffect=function(ue,ce){return P.H.useLayoutEffect(ue,ce)},Ji.useMemo=function(ue,ce){return P.H.useMemo(ue,ce)},Ji.useOptimistic=function(ue,ce){return P.H.useOptimistic(ue,ce)},Ji.useReducer=function(ue,ce,Ce){return P.H.useReducer(ue,ce,Ce)},Ji.useRef=function(ue){return P.H.useRef(ue)},Ji.useState=function(ue){return P.H.useState(ue)},Ji.useSyncExternalStore=function(ue,ce,Ce){return P.H.useSyncExternalStore(ue,ce,Ce)},Ji.useTransition=function(){return P.H.useTransition()},Ji.version="19.2.4",Ji}var RX;function PE(){return RX||(RX=1,HI.exports=vMe()),HI.exports}var G=PE();const Ie=_0(G),Oz=mMe({__proto__:null,default:Ie},[G]);var XI={exports:{}},UT={},WI={exports:{}},ZI={};var PX;function xMe(){return PX||(PX=1,(function(n){function e(j,te){var he=j.length;j.push(te);e:for(;0<he;){var _e=he-1>>>1,Be=j[_e];if(0<r(Be,te))j[_e]=te,j[he]=Be,he=_e;else break e}}function t(j){return j.length===0?null:j[0]}function i(j){if(j.length===0)return null;var te=j[0],he=j.pop();if(he!==te){j[0]=he;e:for(var _e=0,Be=j.length,ue=Be>>>1;_e<ue;){var ce=2*(_e+1)-1,Ce=j[ce],Oe=ce+1,nt=j[Oe];if(0>r(Ce,he))Oe<Be&&0>r(nt,Ce)?(j[_e]=nt,j[Oe]=he,_e=Oe):(j[_e]=Ce,j[ce]=he,_e=ce);else if(Oe<Be&&0>r(nt,he))j[_e]=nt,j[Oe]=he,_e=Oe;else break e}}return te}function r(j,te){var he=j.sortIndex-te.sortIndex;return he!==0?he:j.id-te.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,f=3,m=!1,y=!1,_=!1,S=!1,b=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;function T(j){for(var te=t(u);te!==null;){if(te.callback===null)i(u);else if(te.startTime<=j)i(u),te.sortIndex=te.expirationTime,e(l,te);else break;te=t(u)}}function E(j){if(_=!1,T(j),!y)if(t(l)!==null)y=!0,R||(R=!0,V());else{var te=t(u);te!==null&&q(E,te.startTime-j)}}var R=!1,P=-1,I=5,B=-1;function N(){return S?!0:!(n.unstable_now()-B<I)}function U(){if(S=!1,R){var j=n.unstable_now();B=j;var te=!0;try{e:{y=!1,_&&(_=!1,M(P),P=-1),m=!0;var he=f;try{t:{for(T(j),d=t(l);d!==null&&!(d.expirationTime>j&&N());){var _e=d.callback;if(typeof _e=="function"){d.callback=null,f=d.priorityLevel;var Be=_e(d.expirationTime<=j);if(j=n.unstable_now(),typeof Be=="function"){d.callback=Be,T(j),te=!0;break t}d===t(l)&&i(l),T(j)}else i(l);d=t(l)}if(d!==null)te=!0;else{var ue=t(u);ue!==null&&q(E,ue.startTime-j),te=!1}}break e}finally{d=null,f=he,m=!1}te=void 0}}finally{te?V():R=!1}}}var V;if(typeof w=="function")V=function(){w(U)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,K=W.port2;W.port1.onmessage=U,V=function(){K.postMessage(null)}}else V=function(){b(U,0)};function q(j,te){P=b(function(){j(n.unstable_now())},te)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(j){j.callback=null},n.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<j?Math.floor(1e3/j):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_next=function(j){switch(f){case 1:case 2:case 3:var te=3;break;default:te=f}var he=f;f=te;try{return j()}finally{f=he}},n.unstable_requestPaint=function(){S=!0},n.unstable_runWithPriority=function(j,te){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var he=f;f=j;try{return te()}finally{f=he}},n.unstable_scheduleCallback=function(j,te,he){var _e=n.unstable_now();switch(typeof he=="object"&&he!==null?(he=he.delay,he=typeof he=="number"&&0<he?_e+he:_e):he=_e,j){case 1:var Be=-1;break;case 2:Be=250;break;case 5:Be=1073741823;break;case 4:Be=1e4;break;default:Be=5e3}return Be=he+Be,j={id:c++,callback:te,priorityLevel:j,startTime:he,expirationTime:Be,sortIndex:-1},he>_e?(j.sortIndex=he,e(u,j),t(l)===null&&j===t(u)&&(_?(M(P),P=-1):_=!0,q(E,he-_e))):(j.sortIndex=Be,e(l,j),y||m||(y=!0,R||(R=!0,V()))),j},n.unstable_shouldYield=N,n.unstable_wrapCallback=function(j){var te=f;return function(){var he=f;f=te;try{return j.apply(this,arguments)}finally{f=he}}}})(ZI)),ZI}var DX;function Tq(){return DX||(DX=1,WI.exports=xMe()),WI.exports}var jI={exports:{}},hu={};var NX;function bMe(){if(NX)return hu;NX=1;var n=PE();function e(l){var u="https://react.dev/errors/"+l;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)u+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+l+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function s(l,u,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:d==null?null:""+d,children:l,containerInfo:u,implementation:c}}var a=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,u){if(l==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return hu.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,hu.createPortal=function(l,u){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return s(l,u,null,c)},hu.flushSync=function(l){var u=a.T,c=i.p;try{if(a.T=null,i.p=2,l)return l()}finally{a.T=u,i.p=c,i.d.f()}},hu.preconnect=function(l,u){typeof l=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,i.d.C(l,u))},hu.prefetchDNS=function(l){typeof l=="string"&&i.d.D(l)},hu.preinit=function(l,u){if(typeof l=="string"&&u&&typeof u.as=="string"){var c=u.as,d=o(c,u.crossOrigin),f=typeof u.integrity=="string"?u.integrity:void 0,m=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;c==="style"?i.d.S(l,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:d,integrity:f,fetchPriority:m}):c==="script"&&i.d.X(l,{crossOrigin:d,integrity:f,fetchPriority:m,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},hu.preinitModule=function(l,u){if(typeof l=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var c=o(u.as,u.crossOrigin);i.d.M(l,{crossOrigin:c,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&i.d.M(l)},hu.preload=function(l,u){if(typeof l=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var c=u.as,d=o(c,u.crossOrigin);i.d.L(l,c,{crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},hu.preloadModule=function(l,u){if(typeof l=="string")if(u){var c=o(u.as,u.crossOrigin);i.d.m(l,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:c,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else i.d.m(l)},hu.requestFormReset=function(l){i.d.r(l)},hu.unstable_batchedUpdates=function(l,u){return l(u)},hu.useFormState=function(l,u,c){return a.H.useFormState(l,u,c)},hu.useFormStatus=function(){return a.H.useHostTransitionStatus()},hu.version="19.2.4",hu}var BX;function Cq(){if(BX)return jI.exports;BX=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),jI.exports=bMe(),jI.exports}var FX;function _Me(){if(FX)return UT;FX=1;var n=Tq(),e=PE(),t=Cq();function i(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)p+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function s(h){var p=h,x=h;if(h.alternate)for(;p.return;)p=p.return;else{h=p;do p=h,(p.flags&4098)!==0&&(x=p.return),h=p.return;while(h)}return p.tag===3?x:null}function a(h){if(h.tag===13){var p=h.memoizedState;if(p===null&&(h=h.alternate,h!==null&&(p=h.memoizedState)),p!==null)return p.dehydrated}return null}function o(h){if(h.tag===31){var p=h.memoizedState;if(p===null&&(h=h.alternate,h!==null&&(p=h.memoizedState)),p!==null)return p.dehydrated}return null}function l(h){if(s(h)!==h)throw Error(i(188))}function u(h){var p=h.alternate;if(!p){if(p=s(h),p===null)throw Error(i(188));return p!==h?null:h}for(var x=h,A=p;;){var L=x.return;if(L===null)break;var O=L.alternate;if(O===null){if(A=L.return,A!==null){x=A;continue}break}if(L.child===O.child){for(O=L.child;O;){if(O===x)return l(L),h;if(O===A)return l(L),p;O=O.sibling}throw Error(i(188))}if(x.return!==A.return)x=L,A=O;else{for(var Q=!1,pe=L.child;pe;){if(pe===x){Q=!0,x=L,A=O;break}if(pe===A){Q=!0,A=L,x=O;break}pe=pe.sibling}if(!Q){for(pe=O.child;pe;){if(pe===x){Q=!0,x=O,A=L;break}if(pe===A){Q=!0,A=O,x=L;break}pe=pe.sibling}if(!Q)throw Error(i(189))}}if(x.alternate!==A)throw Error(i(190))}if(x.tag!==3)throw Error(i(188));return x.stateNode.current===x?h:p}function c(h){var p=h.tag;if(p===5||p===26||p===27||p===6)return h;for(h=h.child;h!==null;){if(p=c(h),p!==null)return p;h=h.sibling}return null}var d=Object.assign,f=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),w=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),N=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function V(h){return h===null||typeof h!="object"?null:(h=U&&h[U]||h["@@iterator"],typeof h=="function"?h:null)}var W=Symbol.for("react.client.reference");function K(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===W?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case _:return"Fragment";case b:return"Profiler";case S:return"StrictMode";case E:return"Suspense";case R:return"SuspenseList";case B:return"Activity"}if(typeof h=="object")switch(h.$$typeof){case y:return"Portal";case w:return h.displayName||"Context";case M:return(h._context.displayName||"Context")+".Consumer";case T:var p=h.render;return h=h.displayName,h||(h=p.displayName||p.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case P:return p=h.displayName||null,p!==null?p:K(h.type)||"Memo";case I:p=h._payload,h=h._init;try{return K(h(p))}catch{}}return null}var q=Array.isArray,j=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,he={pending:!1,data:null,method:null,action:null},_e=[],Be=-1;function ue(h){return{current:h}}function ce(h){0>Be||(h.current=_e[Be],_e[Be]=null,Be--)}function Ce(h,p){Be++,_e[Be]=h.current,h.current=p}var Oe=ue(null),nt=ue(null),Ae=ue(null),Ye=ue(null);function ft(h,p){switch(Ce(Ae,p),Ce(nt,h),Ce(Oe,null),p.nodeType){case 9:case 11:h=(h=p.documentElement)&&(h=h.namespaceURI)?K8(h):0;break;default:if(h=p.tagName,p=p.namespaceURI)p=K8(p),h=$8(p,h);else switch(h){case"svg":h=1;break;case"math":h=2;break;default:h=0}}ce(Oe),Ce(Oe,h)}function ze(){ce(Oe),ce(nt),ce(Ae)}function ot(h){h.memoizedState!==null&&Ce(Ye,h);var p=Oe.current,x=$8(p,h.type);p!==x&&(Ce(nt,h),Ce(Oe,x))}function ut(h){nt.current===h&&(ce(Oe),ce(nt)),Ye.current===h&&(ce(Ye),FT._currentValue=he)}var Wt,It;function ke(h){if(Wt===void 0)try{throw Error()}catch(x){var p=x.stack.trim().match(/\n( *(at )?)/);Wt=p&&p[1]||"",It=-1<x.stack.indexOf(`
    at`)?" (<anonymous>)":-1<x.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Wt+h+It}var je=!1;function gt(h,p){if(!h||je)return"";je=!0;var x=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var A={DetermineComponentFrameRoot:function(){try{if(p){var $t=function(){throw Error()};if(Object.defineProperty($t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($t,[])}catch(Dt){var Mt=Dt}Reflect.construct(h,[],$t)}else{try{$t.call()}catch(Dt){Mt=Dt}h.call($t.prototype)}}else{try{throw Error()}catch(Dt){Mt=Dt}($t=h())&&typeof $t.catch=="function"&&$t.catch(function(){})}}catch(Dt){if(Dt&&Mt&&typeof Dt.stack=="string")return[Dt.stack,Mt.stack]}return[null,null]}};A.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var L=Object.getOwnPropertyDescriptor(A.DetermineComponentFrameRoot,"name");L&&L.configurable&&Object.defineProperty(A.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var O=A.DetermineComponentFrameRoot(),Q=O[0],pe=O[1];if(Q&&pe){var Ve=Q.split(`
`),xt=pe.split(`
`);for(L=A=0;A<Ve.length&&!Ve[A].includes("DetermineComponentFrameRoot");)A++;for(;L<xt.length&&!xt[L].includes("DetermineComponentFrameRoot");)L++;if(A===Ve.length||L===xt.length)for(A=Ve.length-1,L=xt.length-1;1<=A&&0<=L&&Ve[A]!==xt[L];)L--;for(;1<=A&&0<=L;A--,L--)if(Ve[A]!==xt[L]){if(A!==1||L!==1)do if(A--,L--,0>L||Ve[A]!==xt[L]){var Ht=`
`+Ve[A].replace(" at new "," at ");return h.displayName&&Ht.includes("<anonymous>")&&(Ht=Ht.replace("<anonymous>",h.displayName)),Ht}while(1<=A&&0<=L);break}}}finally{je=!1,Error.prepareStackTrace=x}return(x=h?h.displayName||h.name:"")?ke(x):""}function yt(h,p){switch(h.tag){case 26:case 27:case 5:return ke(h.type);case 16:return ke("Lazy");case 13:return h.child!==p&&p!==null?ke("Suspense Fallback"):ke("Suspense");case 19:return ke("SuspenseList");case 0:case 15:return gt(h.type,!1);case 11:return gt(h.type.render,!1);case 1:return gt(h.type,!0);case 31:return ke("Activity");default:return""}}function ve(h){try{var p="",x=null;do p+=yt(h,x),x=h,h=h.return;while(h);return p}catch(A){return`
Error generating stack: `+A.message+`
`+A.stack}}var An=Object.prototype.hasOwnProperty,cn=n.unstable_scheduleCallback,In=n.unstable_cancelCallback,Zt=n.unstable_shouldYield,le=n.unstable_requestPaint,ee=n.unstable_now,Re=n.unstable_getCurrentPriorityLevel,tt=n.unstable_ImmediatePriority,et=n.unstable_UserBlockingPriority,at=n.unstable_NormalPriority,jt=n.unstable_LowPriority,rn=n.unstable_IdlePriority,Nn=n.log,Fn=n.unstable_setDisableYieldValue,Gt=null,st=null;function Ft(h){if(typeof Nn=="function"&&Fn(h),st&&typeof st.setStrictMode=="function")try{st.setStrictMode(Gt,h)}catch{}}var Se=Math.clz32?Math.clz32:Ne,Je=Math.log,St=Math.LN2;function Ne(h){return h>>>=0,h===0?32:31-(Je(h)/St|0)|0}var it=256,kt=262144,vn=4194304;function Kt(h){var p=h&42;if(p!==0)return p;switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return h&261888;case 262144:case 524288:case 1048576:case 2097152:return h&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return h&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return h}}function Ut(h,p,x){var A=h.pendingLanes;if(A===0)return 0;var L=0,O=h.suspendedLanes,Q=h.pingedLanes;h=h.warmLanes;var pe=A&134217727;return pe!==0?(A=pe&~O,A!==0?L=Kt(A):(Q&=pe,Q!==0?L=Kt(Q):x||(x=pe&~h,x!==0&&(L=Kt(x))))):(pe=A&~O,pe!==0?L=Kt(pe):Q!==0?L=Kt(Q):x||(x=A&~h,x!==0&&(L=Kt(x)))),L===0?0:p!==0&&p!==L&&(p&O)===0&&(O=L&-L,x=p&-p,O>=x||O===32&&(x&4194048)!==0)?p:L}function z(h,p){return(h.pendingLanes&~(h.suspendedLanes&~h.pingedLanes)&p)===0}function se(h,p){switch(h){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ne(){var h=vn;return vn<<=1,(vn&62914560)===0&&(vn=4194304),h}function ae(h){for(var p=[],x=0;31>x;x++)p.push(h);return p}function be(h,p){h.pendingLanes|=p,p!==268435456&&(h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0)}function pt(h,p,x,A,L,O){var Q=h.pendingLanes;h.pendingLanes=x,h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0,h.expiredLanes&=x,h.entangledLanes&=x,h.errorRecoveryDisabledLanes&=x,h.shellSuspendCounter=0;var pe=h.entanglements,Ve=h.expirationTimes,xt=h.hiddenUpdates;for(x=Q&~x;0<x;){var Ht=31-Se(x),$t=1<<Ht;pe[Ht]=0,Ve[Ht]=-1;var Mt=xt[Ht];if(Mt!==null)for(xt[Ht]=null,Ht=0;Ht<Mt.length;Ht++){var Dt=Mt[Ht];Dt!==null&&(Dt.lane&=-536870913)}x&=~$t}A!==0&&Bt(h,A,0),O!==0&&L===0&&h.tag!==0&&(h.suspendedLanes|=O&~(Q&~p))}function Bt(h,p,x){h.pendingLanes|=p,h.suspendedLanes&=~p;var A=31-Se(p);h.entangledLanes|=p,h.entanglements[A]=h.entanglements[A]|1073741824|x&261930}function tn(h,p){var x=h.entangledLanes|=p;for(h=h.entanglements;x;){var A=31-Se(x),L=1<<A;L&p|h[A]&p&&(h[A]|=p),x&=~L}}function Tn(h,p){var x=p&-p;return x=(x&42)!==0?1:yi(x),(x&(h.suspendedLanes|p))!==0?0:x}function yi(h){switch(h){case 2:h=1;break;case 8:h=4;break;case 32:h=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:h=128;break;case 268435456:h=134217728;break;default:h=0}return h}function er(h){return h&=-h,2<h?8<h?(h&134217727)!==0?32:268435456:8:2}function Vi(){var h=te.p;return h!==0?h:(h=window.event,h===void 0?32:xX(h.type))}function Zn(h,p){var x=te.p;try{return te.p=h,p()}finally{te.p=x}}var Xs=Math.random().toString(36).slice(2),es="__reactFiber$"+Xs,ie="__reactProps$"+Xs,ye="__reactContainer$"+Xs,Ue="__reactEvents$"+Xs,dt="__reactListeners$"+Xs,Ct="__reactHandles$"+Xs,wt="__reactResources$"+Xs,sn="__reactMarker$"+Xs;function Qt(h){delete h[es],delete h[ie],delete h[Ue],delete h[dt],delete h[Ct]}function on(h){var p=h[es];if(p)return p;for(var x=h.parentNode;x;){if(p=x[ye]||x[es]){if(x=p.alternate,p.child!==null||x!==null&&x.child!==null)for(h=iX(h);h!==null;){if(x=h[es])return x;h=iX(h)}return p}h=x,x=h.parentNode}return null}function ln(h){if(h=h[es]||h[ye]){var p=h.tag;if(p===5||p===6||p===13||p===31||p===26||p===27||p===3)return h}return null}function gn(h){var p=h.tag;if(p===5||p===26||p===27||p===6)return h.stateNode;throw Error(i(33))}function fn(h){var p=h[wt];return p||(p=h[wt]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function de(h){h[sn]=!0}var Fe=new Set,$e={};function Ke(h,p){Ze(h,p),Ze(h+"Capture",p)}function Ze(h,p){for($e[h]=p,h=0;h<p.length;h++)Fe.add(p[h])}var zt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Jt={},Vt={};function Rn(h){return An.call(Vt,h)?!0:An.call(Jt,h)?!1:zt.test(h)?Vt[h]=!0:(Jt[h]=!0,!1)}function yn(h,p,x){if(Rn(p))if(x===null)h.removeAttribute(p);else{switch(typeof x){case"undefined":case"function":case"symbol":h.removeAttribute(p);return;case"boolean":var A=p.toLowerCase().slice(0,5);if(A!=="data-"&&A!=="aria-"){h.removeAttribute(p);return}}h.setAttribute(p,""+x)}}function jn(h,p,x){if(x===null)h.removeAttribute(p);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(p);return}h.setAttribute(p,""+x)}}function bn(h,p,x,A){if(A===null)h.removeAttribute(x);else{switch(typeof A){case"undefined":case"function":case"symbol":case"boolean":h.removeAttribute(x);return}h.setAttributeNS(p,x,""+A)}}function zn(h){switch(typeof h){case"bigint":case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function Bi(h){var p=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function _r(h,p,x){var A=Object.getOwnPropertyDescriptor(h.constructor.prototype,p);if(!h.hasOwnProperty(p)&&typeof A<"u"&&typeof A.get=="function"&&typeof A.set=="function"){var L=A.get,O=A.set;return Object.defineProperty(h,p,{configurable:!0,get:function(){return L.call(this)},set:function(Q){x=""+Q,O.call(this,Q)}}),Object.defineProperty(h,p,{enumerable:A.enumerable}),{getValue:function(){return x},setValue:function(Q){x=""+Q},stopTracking:function(){h._valueTracker=null,delete h[p]}}}}function Oi(h){if(!h._valueTracker){var p=Bi(h)?"checked":"value";h._valueTracker=_r(h,p,""+h[p])}}function On(h){if(!h)return!1;var p=h._valueTracker;if(!p)return!0;var x=p.getValue(),A="";return h&&(A=Bi(h)?h.checked?"true":"false":h.value),h=A,h!==x?(p.setValue(h),!0):!1}function qt(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}var ei=/[\n"\\]/g;function Bn(h){return h.replace(ei,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function tr(h,p,x,A,L,O,Q,pe){h.name="",Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?h.type=Q:h.removeAttribute("type"),p!=null?Q==="number"?(p===0&&h.value===""||h.value!=p)&&(h.value=""+zn(p)):h.value!==""+zn(p)&&(h.value=""+zn(p)):Q!=="submit"&&Q!=="reset"||h.removeAttribute("value"),p!=null?Wi(h,Q,zn(p)):x!=null?Wi(h,Q,zn(x)):A!=null&&h.removeAttribute("value"),L==null&&O!=null&&(h.defaultChecked=!!O),L!=null&&(h.checked=L&&typeof L!="function"&&typeof L!="symbol"),pe!=null&&typeof pe!="function"&&typeof pe!="symbol"&&typeof pe!="boolean"?h.name=""+zn(pe):h.removeAttribute("name")}function qs(h,p,x,A,L,O,Q,pe){if(O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"&&(h.type=O),p!=null||x!=null){if(!(O!=="submit"&&O!=="reset"||p!=null)){Oi(h);return}x=x!=null?""+zn(x):"",p=p!=null?""+zn(p):x,pe||p===h.value||(h.value=p),h.defaultValue=p}A=A??L,A=typeof A!="function"&&typeof A!="symbol"&&!!A,h.checked=pe?h.checked:!!A,h.defaultChecked=!!A,Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"&&(h.name=Q),Oi(h)}function Wi(h,p,x){p==="number"&&qt(h.ownerDocument)===h||h.defaultValue===""+x||(h.defaultValue=""+x)}function Ss(h,p,x,A){if(h=h.options,p){p={};for(var L=0;L<x.length;L++)p["$"+x[L]]=!0;for(x=0;x<h.length;x++)L=p.hasOwnProperty("$"+h[x].value),h[x].selected!==L&&(h[x].selected=L),L&&A&&(h[x].defaultSelected=!0)}else{for(x=""+zn(x),p=null,L=0;L<h.length;L++){if(h[L].value===x){h[L].selected=!0,A&&(h[L].defaultSelected=!0);return}p!==null||h[L].disabled||(p=h[L])}p!==null&&(p.selected=!0)}}function Lr(h,p,x){if(p!=null&&(p=""+zn(p),p!==h.value&&(h.value=p),x==null)){h.defaultValue!==p&&(h.defaultValue=p);return}h.defaultValue=x!=null?""+zn(x):""}function Qs(h,p,x,A){if(p==null){if(A!=null){if(x!=null)throw Error(i(92));if(q(A)){if(1<A.length)throw Error(i(93));A=A[0]}x=A}x==null&&(x=""),p=x}x=zn(p),h.defaultValue=x,A=h.textContent,A===x&&A!==""&&A!==null&&(h.value=A),Oi(h)}function Ws(h,p){if(p){var x=h.firstChild;if(x&&x===h.lastChild&&x.nodeType===3){x.nodeValue=p;return}}h.textContent=p}var Zs=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function la(h,p,x){var A=p.indexOf("--")===0;x==null||typeof x=="boolean"||x===""?A?h.setProperty(p,""):p==="float"?h.cssFloat="":h[p]="":A?h.setProperty(p,x):typeof x!="number"||x===0||Zs.has(p)?p==="float"?h.cssFloat=x:h[p]=(""+x).trim():h[p]=x+"px"}function Te(h,p,x){if(p!=null&&typeof p!="object")throw Error(i(62));if(h=h.style,x!=null){for(var A in x)!x.hasOwnProperty(A)||p!=null&&p.hasOwnProperty(A)||(A.indexOf("--")===0?h.setProperty(A,""):A==="float"?h.cssFloat="":h[A]="");for(var L in p)A=p[L],p.hasOwnProperty(L)&&x[L]!==A&&la(h,L,A)}else for(var O in p)p.hasOwnProperty(O)&&la(h,O,p[O])}function ai(h){if(h.indexOf("-")===-1)return!1;switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $c=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),jo=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function lc(h){return jo.test(""+h)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":h}function $n(){}var ql=null;function uc(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var cc=null,Ui=null;function Pl(h){var p=ln(h);if(p&&(h=p.stateNode)){var x=h[ie]||null;e:switch(h=p.stateNode,p.type){case"input":if(tr(h,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name),p=x.name,x.type==="radio"&&p!=null){for(x=h;x.parentNode;)x=x.parentNode;for(x=x.querySelectorAll('input[name="'+Bn(""+p)+'"][type="radio"]'),p=0;p<x.length;p++){var A=x[p];if(A!==h&&A.form===h.form){var L=A[ie]||null;if(!L)throw Error(i(90));tr(A,L.value,L.defaultValue,L.defaultValue,L.checked,L.defaultChecked,L.type,L.name)}}for(p=0;p<x.length;p++)A=x[p],A.form===h.form&&On(A)}break e;case"textarea":Lr(h,x.value,x.defaultValue);break e;case"select":p=x.value,p!=null&&Ss(h,!!x.multiple,p,!1)}}}var op=!1;function Jc(h,p,x){if(op)return h(p,x);op=!0;try{var A=h(p);return A}finally{if(op=!1,(cc!==null||Ui!==null)&&(ah(),cc&&(p=cc,h=Ui,Ui=cc=null,Pl(p),h)))for(p=0;p<h.length;p++)Pl(h[p])}}function hc(h,p){var x=h.stateNode;if(x===null)return null;var A=x[ie]||null;if(A===null)return null;x=A[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(h=h.type,A=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!A;break e;default:h=!1}if(h)return null;if(x&&typeof x!="function")throw Error(i(231,p,typeof x));return x}var Yo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ni=!1;if(Yo)try{var to={};Object.defineProperty(to,"passive",{get:function(){ni=!0}}),window.addEventListener("test",to,to),window.removeEventListener("test",to,to)}catch{ni=!1}var Ro=null,al=null,dc=null;function Ih(){if(dc)return dc;var h,p=al,x=p.length,A,L="value"in Ro?Ro.value:Ro.textContent,O=L.length;for(h=0;h<x&&p[h]===L[h];h++);var Q=x-h;for(A=1;A<=Q&&p[x-A]===L[O-A];A++);return dc=L.slice(h,1<A?1-A:void 0)}function qc(h){var p=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&p===13&&(h=13)):h=p,h===10&&(h=13),32<=h||h===13?h:0}function fc(){return!0}function Qc(){return!1}function ua(h){function p(x,A,L,O,Q){this._reactName=x,this._targetInst=L,this.type=A,this.nativeEvent=O,this.target=Q,this.currentTarget=null;for(var pe in h)h.hasOwnProperty(pe)&&(x=h[pe],this[pe]=x?x(O):O[pe]);return this.isDefaultPrevented=(O.defaultPrevented!=null?O.defaultPrevented:O.returnValue===!1)?fc:Qc,this.isPropagationStopped=Qc,this}return d(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var x=this.nativeEvent;x&&(x.preventDefault?x.preventDefault():typeof x.returnValue!="unknown"&&(x.returnValue=!1),this.isDefaultPrevented=fc)},stopPropagation:function(){var x=this.nativeEvent;x&&(x.stopPropagation?x.stopPropagation():typeof x.cancelBubble!="unknown"&&(x.cancelBubble=!0),this.isPropagationStopped=fc)},persist:function(){},isPersistent:fc}),p}var Ql={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qd=ua(Ql),ol=d({},Ql,{view:0,detail:0}),ci=ua(ol),Dl,Gh,eh,ll=d({},ol,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fp,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==eh&&(eh&&h.type==="mousemove"?(Dl=h.screenX-eh.screenX,Gh=h.screenY-eh.screenY):Gh=Dl=0,eh=h),Dl)},movementY:function(h){return"movementY"in h?h.movementY:Gh}}),Eu=ua(ll),lp=d({},ll,{dataTransfer:0}),D0=ua(lp),up=d({},ol,{relatedTarget:0}),ef=ua(up),Hm=d({},Ql,{animationName:0,elapsedTime:0,pseudoElement:0}),th=ua(Hm),cp=d({},Ql,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),Xm=ua(cp),tf=d({},Ql,{data:0}),hp=ua(tf),dp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},N0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Wm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Zm(h){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(h):(h=Wm[h])?!!p[h]:!1}function fp(){return Zm}var pc=d({},ol,{key:function(h){if(h.key){var p=dp[h.key]||h.key;if(p!=="Unidentified")return p}return h.type==="keypress"?(h=qc(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?N0[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fp,charCode:function(h){return h.type==="keypress"?qc(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?qc(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),Po=ua(pc),nf=d({},ll,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),jm=ua(nf),Oh=d({},ol,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fp}),Ym=ua(Oh),Km=d({},Ql,{propertyName:0,elapsedTime:0,pseudoElement:0}),u1=ua(Km),wa=d({},ll,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),$m=ua(wa),F=d({},Ql,{newState:0,oldState:0}),H=ua(F),J=[9,13,27,32],oe=Yo&&"CompositionEvent"in window,Me=null;Yo&&"documentMode"in document&&(Me=document.documentMode);var De=Yo&&"TextEvent"in window&&!Me,Ee=Yo&&(!oe||Me&&8<Me&&11>=Me),qe=" ",bt=!1;function un(h,p){switch(h){case"keyup":return J.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cn(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var fi=!1;function oi(h,p){switch(h){case"compositionend":return Cn(p);case"keypress":return p.which!==32?null:(bt=!0,qe);case"textInput":return h=p.data,h===qe&&bt?null:h;default:return null}}function Gn(h,p){if(fi)return h==="compositionend"||!oe&&un(h,p)?(h=Ih(),dc=al=Ro=null,fi=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return Ee&&p.locale!=="ko"?null:p.data;default:return null}}var vi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hi(h){var p=h&&h.nodeName&&h.nodeName.toLowerCase();return p==="input"?!!vi[h.type]:p==="textarea"}function ts(h,p,x,A){cc?Ui?Ui.push(A):Ui=[A]:cc=A,p=lP(p,"onChange"),0<p.length&&(x=new Qd("onChange","change",null,x,A),h.push({event:x,listeners:p}))}var Sr=null,Bs=null;function no(h){H8(h,0)}function ca(h){var p=gn(h);if(On(p))return h}function mr(h,p){if(h==="change")return p}var ns=!1;if(Yo){var Do;if(Yo){var Y="oninput"in document;if(!Y){var xe=document.createElement("div");xe.setAttribute("oninput","return;"),Y=typeof xe.oninput=="function"}Do=Y}else Do=!1;ns=Do&&(!document.documentMode||9<document.documentMode)}function Pe(){Sr&&(Sr.detachEvent("onpropertychange",Ot),Bs=Sr=null)}function Ot(h){if(h.propertyName==="value"&&ca(Bs)){var p=[];ts(p,Bs,h,uc(h)),Jc(no,p)}}function li(h,p,x){h==="focusin"?(Pe(),Sr=p,Bs=x,Sr.attachEvent("onpropertychange",Ot)):h==="focusout"&&Pe()}function Yr(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return ca(Bs)}function eu(h,p){if(h==="click")return ca(p)}function rf(h,p){if(h==="input"||h==="change")return ca(p)}function NA(h,p){return h===p&&(h!==0||1/h===1/p)||h!==h&&p!==p}var Nl=typeof Object.is=="function"?Object.is:NA;function B0(h,p){if(Nl(h,p))return!0;if(typeof h!="object"||h===null||typeof p!="object"||p===null)return!1;var x=Object.keys(h),A=Object.keys(p);if(x.length!==A.length)return!1;for(A=0;A<x.length;A++){var L=x[A];if(!An.call(p,L)||!Nl(h[L],p[L]))return!1}return!0}function c1(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function F0(h,p){var x=c1(h);h=0;for(var A;x;){if(x.nodeType===3){if(A=h+x.textContent.length,h<=p&&A>=p)return{node:x,offset:p-h};h=A}e:{for(;x;){if(x.nextSibling){x=x.nextSibling;break e}x=x.parentNode}x=void 0}x=c1(x)}}function Fs(h,p){return h&&p?h===p?!0:h&&h.nodeType===3?!1:p&&p.nodeType===3?Fs(h,p.parentNode):"contains"in h?h.contains(p):h.compareDocumentPosition?!!(h.compareDocumentPosition(p)&16):!1:!1}function l3(h){h=h!=null&&h.ownerDocument!=null&&h.ownerDocument.defaultView!=null?h.ownerDocument.defaultView:window;for(var p=qt(h.document);p instanceof h.HTMLIFrameElement;){try{var x=typeof p.contentWindow.location.href=="string"}catch{x=!1}if(x)h=p.contentWindow;else break;p=qt(h.document)}return p}function BA(h){var p=h&&h.nodeName&&h.nodeName.toLowerCase();return p&&(p==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||p==="textarea"||h.contentEditable==="true")}var u3=Yo&&"documentMode"in document&&11>=document.documentMode,Uh=null,kh=null,L0=null,Hb=!1;function I0(h,p,x){var A=x.window===x?x.document:x.nodeType===9?x:x.ownerDocument;Hb||Uh==null||Uh!==qt(A)||(A=Uh,"selectionStart"in A&&BA(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),L0&&B0(L0,A)||(L0=A,A=lP(kh,"onSelect"),0<A.length&&(p=new Qd("onSelect","select",null,p,x),h.push({event:p,listeners:A}),p.target=Uh)))}function ul(h,p){var x={};return x[h.toLowerCase()]=p.toLowerCase(),x["Webkit"+h]="webkit"+p,x["Moz"+h]="moz"+p,x}var Jm={animationend:ul("Animation","AnimationEnd"),animationiteration:ul("Animation","AnimationIteration"),animationstart:ul("Animation","AnimationStart"),transitionrun:ul("Transition","TransitionRun"),transitionstart:ul("Transition","TransitionStart"),transitioncancel:ul("Transition","TransitionCancel"),transitionend:ul("Transition","TransitionEnd")},h1={},FA={};Yo&&(FA=document.createElement("div").style,"AnimationEvent"in window||(delete Jm.animationend.animation,delete Jm.animationiteration.animation,delete Jm.animationstart.animation),"TransitionEvent"in window||delete Jm.transitionend.transition);function sf(h){if(h1[h])return h1[h];if(!Jm[h])return h;var p=Jm[h],x;for(x in p)if(p.hasOwnProperty(x)&&x in FA)return h1[h]=p[x];return h}var Xb=sf("animationend"),d1=sf("animationiteration"),LA=sf("animationstart"),c3=sf("transitionrun"),hI=sf("transitionstart"),h3=sf("transitioncancel"),IA=sf("transitionend"),mc=new Map,f1="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");f1.push("scrollEnd");function gc(h,p){mc.set(h,p),Ke(p,[h])}var p1=typeof reportError=="function"?reportError:function(h){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof h=="object"&&h!==null&&typeof h.message=="string"?String(h.message):String(h),error:h});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",h);return}console.error(h)},yc=[],af=0,No=0;function m1(){for(var h=af,p=No=af=0;p<h;){var x=yc[p];yc[p++]=null;var A=yc[p];yc[p++]=null;var L=yc[p];yc[p++]=null;var O=yc[p];if(yc[p++]=null,A!==null&&L!==null){var Q=A.pending;Q===null?L.next=L:(L.next=Q.next,Q.next=L),A.pending=L}O!==0&&pp(x,L,O)}}function Bo(h,p,x,A){yc[af++]=h,yc[af++]=p,yc[af++]=x,yc[af++]=A,No|=A,h.lanes|=A,h=h.alternate,h!==null&&(h.lanes|=A)}function Wb(h,p,x,A){return Bo(h,p,x,A),vc(h)}function Bl(h,p){return Bo(h,null,null,p),vc(h)}function pp(h,p,x){h.lanes|=x;var A=h.alternate;A!==null&&(A.lanes|=x);for(var L=!1,O=h.return;O!==null;)O.childLanes|=x,A=O.alternate,A!==null&&(A.childLanes|=x),O.tag===22&&(h=O.stateNode,h===null||h._visibility&1||(L=!0)),h=O,O=O.return;return h.tag===3?(O=h.stateNode,L&&p!==null&&(L=31-Se(x),h=O.hiddenUpdates,A=h[L],A===null?h[L]=[p]:A.push(p),p.lane=x|536870912),O):null}function vc(h){if(50<Bp)throw Bp=0,gg=null,Error(i(185));for(var p=h.return;p!==null;)h=p,p=h.return;return h.tag===3?h.stateNode:null}var mp={};function GA(h,p,x,A){this.tag=h,this.key=x,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ha(h,p,x,A){return new GA(h,p,x,A)}function Zb(h){return h=h.prototype,!(!h||!h.isReactComponent)}function tu(h,p){var x=h.alternate;return x===null?(x=ha(h.tag,p,h.key,h.mode),x.elementType=h.elementType,x.type=h.type,x.stateNode=h.stateNode,x.alternate=h,h.alternate=x):(x.pendingProps=p,x.type=h.type,x.flags=0,x.subtreeFlags=0,x.deletions=null),x.flags=h.flags&65011712,x.childLanes=h.childLanes,x.lanes=h.lanes,x.child=h.child,x.memoizedProps=h.memoizedProps,x.memoizedState=h.memoizedState,x.updateQueue=h.updateQueue,p=h.dependencies,x.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},x.sibling=h.sibling,x.index=h.index,x.ref=h.ref,x.refCleanup=h.refCleanup,x}function G0(h,p){h.flags&=65011714;var x=h.alternate;return x===null?(h.childLanes=0,h.lanes=p,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=x.childLanes,h.lanes=x.lanes,h.child=x.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=x.memoizedProps,h.memoizedState=x.memoizedState,h.updateQueue=x.updateQueue,h.type=x.type,p=x.dependencies,h.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),h}function zh(h,p,x,A,L,O){var Q=0;if(A=h,typeof h=="function")Zb(h)&&(Q=1);else if(typeof h=="string")Q=iMe(h,x,Oe.current)?26:h==="html"||h==="head"||h==="body"?27:5;else e:switch(h){case B:return h=ha(31,x,p,L),h.elementType=B,h.lanes=O,h;case _:return gp(x.children,L,O,p);case S:Q=8,L|=24;break;case b:return h=ha(12,x,p,L|2),h.elementType=b,h.lanes=O,h;case E:return h=ha(13,x,p,L),h.elementType=E,h.lanes=O,h;case R:return h=ha(19,x,p,L),h.elementType=R,h.lanes=O,h;default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case w:Q=10;break e;case M:Q=9;break e;case T:Q=11;break e;case P:Q=14;break e;case I:Q=16,A=null;break e}Q=29,x=Error(i(130,h===null?"null":typeof h,"")),A=null}return p=ha(Q,x,p,L),p.elementType=h,p.type=A,p.lanes=O,p}function gp(h,p,x,A){return h=ha(7,h,A,p),h.lanes=x,h}function jb(h,p,x){return h=ha(6,h,null,p),h.lanes=x,h}function O0(h){var p=ha(18,null,null,0);return p.stateNode=h,p}function Yb(h,p,x){return p=ha(4,h.children!==null?h.children:[],h.key,p),p.lanes=x,p.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},p}var g1=new WeakMap;function Ru(h,p){if(typeof h=="object"&&h!==null){var x=g1.get(h);return x!==void 0?x:(p={value:h,source:p,stack:ve(p)},g1.set(h,p),p)}return{value:h,source:p,stack:ve(p)}}var yp=[],vp=0,U0=null,k0=0,nu=[],ea=0,of=null,da=1,nh="";function Vh(h,p){yp[vp++]=k0,yp[vp++]=U0,U0=h,k0=p}function d3(h,p,x){nu[ea++]=da,nu[ea++]=nh,nu[ea++]=of,of=h;var A=da;h=nh;var L=32-Se(A)-1;A&=~(1<<L),x+=1;var O=32-Se(p)+L;if(30<O){var Q=L-L%5;O=(A&(1<<Q)-1).toString(32),A>>=Q,L-=Q,da=1<<32-Se(p)+L|x<<L|A,nh=O+h}else da=1<<O|x<<L|A,nh=h}function Hh(h){h.return!==null&&(Vh(h,1),d3(h,1,0))}function Kb(h){for(;h===U0;)U0=yp[--vp],yp[vp]=null,k0=yp[--vp],yp[vp]=null;for(;h===of;)of=nu[--ea],nu[ea]=null,nh=nu[--ea],nu[ea]=null,da=nu[--ea],nu[ea]=null}function $b(h,p){nu[ea++]=da,nu[ea++]=nh,nu[ea++]=of,da=p.id,nh=p.overflow,of=h}var Ea=null,Ls=null,Rr=!1,lf=null,Pu=!1,z0=Error(i(519));function Xh(h){var p=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Wh(Ru(p,h)),z0}function f3(h){var p=h.stateNode,x=h.type,A=h.memoizedProps;switch(p[es]=h,p[ie]=A,x){case"dialog":Gr("cancel",p),Gr("close",p);break;case"iframe":case"object":case"embed":Gr("load",p);break;case"video":case"audio":for(x=0;x<Dc.length;x++)Gr(Dc[x],p);break;case"source":Gr("error",p);break;case"img":case"image":case"link":Gr("error",p),Gr("load",p);break;case"details":Gr("toggle",p);break;case"input":Gr("invalid",p),qs(p,A.value,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name,!0);break;case"select":Gr("invalid",p);break;case"textarea":Gr("invalid",p),Qs(p,A.value,A.defaultValue,A.children)}x=A.children,typeof x!="string"&&typeof x!="number"&&typeof x!="bigint"||p.textContent===""+x||A.suppressHydrationWarning===!0||j8(p.textContent,x)?(A.popover!=null&&(Gr("beforetoggle",p),Gr("toggle",p)),A.onScroll!=null&&Gr("scroll",p),A.onScrollEnd!=null&&Gr("scrollend",p),A.onClick!=null&&(p.onclick=$n),p=!0):p=!1,p||Xh(h,!0)}function p3(h){for(Ea=h.return;Ea;)switch(Ea.tag){case 5:case 31:case 13:Pu=!1;return;case 27:case 3:Pu=!0;return;default:Ea=Ea.return}}function V0(h){if(h!==Ea)return!1;if(!Rr)return p3(h),Rr=!0,!1;var p=h.tag,x;if((x=p!==3&&p!==27)&&((x=p===5)&&(x=h.type,x=!(x!=="form"&&x!=="button")||wI(h.type,h.memoizedProps)),x=!x),x&&Ls&&Xh(h),p3(h),p===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(i(317));Ls=nX(h)}else if(p===31){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(i(317));Ls=nX(h)}else p===27?(p=Ls,ly(h.type)?(h=NI,NI=null,Ls=h):Ls=p):Ls=Ea?sd(h.stateNode.nextSibling):null;return!0}function xp(){Ls=Ea=null,Rr=!1}function Jb(){var h=lf;return h!==null&&(Pa===null?Pa=h:Pa.push.apply(Pa,h),lf=null),h}function Wh(h){lf===null?lf=[h]:lf.push(h)}var H0=ue(null),bp=null,Zh=null;function uf(h,p,x){Ce(H0,p._currentValue),p._currentValue=x}function jh(h){h._currentValue=H0.current,ce(H0)}function qb(h,p,x){for(;h!==null;){var A=h.alternate;if((h.childLanes&p)!==p?(h.childLanes|=p,A!==null&&(A.childLanes|=p)):A!==null&&(A.childLanes&p)!==p&&(A.childLanes|=p),h===x)break;h=h.return}}function Qb(h,p,x,A){var L=h.child;for(L!==null&&(L.return=h);L!==null;){var O=L.dependencies;if(O!==null){var Q=L.child;O=O.firstContext;e:for(;O!==null;){var pe=O;O=L;for(var Ve=0;Ve<p.length;Ve++)if(pe.context===p[Ve]){O.lanes|=x,pe=O.alternate,pe!==null&&(pe.lanes|=x),qb(O.return,x,h),A||(Q=null);break e}O=pe.next}}else if(L.tag===18){if(Q=L.return,Q===null)throw Error(i(341));Q.lanes|=x,O=Q.alternate,O!==null&&(O.lanes|=x),qb(Q,x,h),Q=null}else Q=L.child;if(Q!==null)Q.return=L;else for(Q=L;Q!==null;){if(Q===h){Q=null;break}if(L=Q.sibling,L!==null){L.return=Q.return,Q=L;break}Q=Q.return}L=Q}}function Yh(h,p,x,A){h=null;for(var L=p,O=!1;L!==null;){if(!O){if((L.flags&524288)!==0)O=!0;else if((L.flags&262144)!==0)break}if(L.tag===10){var Q=L.alternate;if(Q===null)throw Error(i(387));if(Q=Q.memoizedProps,Q!==null){var pe=L.type;Nl(L.pendingProps.value,Q.value)||(h!==null?h.push(pe):h=[pe])}}else if(L===Ye.current){if(Q=L.alternate,Q===null)throw Error(i(387));Q.memoizedState.memoizedState!==L.memoizedState.memoizedState&&(h!==null?h.push(FT):h=[FT])}L=L.return}h!==null&&Qb(p,h,x,A),p.flags|=262144}function y1(h){for(h=h.firstContext;h!==null;){if(!Nl(h.context._currentValue,h.memoizedValue))return!0;h=h.next}return!1}function _p(h){bp=h,Zh=null,h=h.dependencies,h!==null&&(h.firstContext=null)}function Fi(h){return m3(bp,h)}function X0(h,p){return bp===null&&_p(h),m3(h,p)}function m3(h,p){var x=p._currentValue;if(p={context:p,memoizedValue:x,next:null},Zh===null){if(h===null)throw Error(i(308));Zh=p,h.dependencies={lanes:0,firstContext:p},h.flags|=524288}else Zh=Zh.next=p;return x}var g3=typeof AbortController<"u"?AbortController:function(){var h=[],p=this.signal={aborted:!1,addEventListener:function(x,A){h.push(A)}};this.abort=function(){p.aborted=!0,h.forEach(function(x){return x()})}},dI=n.unstable_scheduleCallback,fI=n.unstable_NormalPriority,io={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function OA(){return{controller:new g3,data:new Map,refCount:0}}function qm(h){h.refCount--,h.refCount===0&&dI(fI,function(){h.controller.abort()})}var Du=null,e_=0,cf=0,xc=null;function UA(h,p){if(Du===null){var x=Du=[];e_=0,cf=Et(),xc={status:"pending",value:void 0,then:function(A){x.push(A)}}}return e_++,p.then(kA,kA),p}function kA(){if(--e_===0&&Du!==null){xc!==null&&(xc.status="fulfilled");var h=Du;Du=null,cf=0,xc=null;for(var p=0;p<h.length;p++)(0,h[p])()}}function zA(h,p){var x=[],A={status:"pending",value:null,reason:null,then:function(L){x.push(L)}};return h.then(function(){A.status="fulfilled",A.value=p;for(var L=0;L<x.length;L++)(0,x[L])(p)},function(L){for(A.status="rejected",A.reason=L,L=0;L<x.length;L++)(0,x[L])(void 0)}),A}var y3=j.S;j.S=function(h,p){ET=ee(),typeof p=="object"&&p!==null&&typeof p.then=="function"&&UA(h,p),y3!==null&&y3(h,p)};var Sp=ue(null);function t_(){var h=Sp.current;return h!==null?h:ki.pooledCache}function v1(h,p){p===null?Ce(Sp,Sp.current):Ce(Sp,p.pool)}function VA(){var h=t_();return h===null?null:{parent:io._currentValue,pool:h}}var Qm=Error(i(460)),x1=Error(i(474)),rr=Error(i(542)),n_={then:function(){}};function iu(h){return h=h.status,h==="fulfilled"||h==="rejected"}function i_(h,p,x){switch(x=h[x],x===void 0?h.push(p):x!==p&&(p.then($n,$n),p=x),p.status){case"fulfilled":return p.value;case"rejected":throw h=p.reason,ng(h),h;default:if(typeof p.status=="string")p.then($n,$n);else{if(h=ki,h!==null&&100<h.shellSuspendCounter)throw Error(i(482));h=p,h.status="pending",h.then(function(A){if(p.status==="pending"){var L=p;L.status="fulfilled",L.value=A}},function(A){if(p.status==="pending"){var L=p;L.status="rejected",L.reason=A}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw h=p.reason,ng(h),h}throw Kh=p,Qm}}function eg(h){try{var p=h._init;return p(h._payload)}catch(x){throw x!==null&&typeof x=="object"&&typeof x.then=="function"?(Kh=x,Qm):x}}var Kh=null;function tg(){if(Kh===null)throw Error(i(459));var h=Kh;return Kh=null,h}function ng(h){if(h===Qm||h===rr)throw Error(i(483))}var ig=null,rg=0;function b1(h){var p=rg;return rg+=1,ig===null&&(ig=[]),i_(ig,h,p)}function bc(h,p){p=p.props.ref,h.ref=p!==void 0?p:null}function W0(h,p){throw p.$$typeof===f?Error(i(525)):(h=Object.prototype.toString.call(p),Error(i(31,h==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":h)))}function r_(h){function p(lt,Qe){if(h){var vt=lt.deletions;vt===null?(lt.deletions=[Qe],lt.flags|=16):vt.push(Qe)}}function x(lt,Qe){if(!h)return null;for(;Qe!==null;)p(lt,Qe),Qe=Qe.sibling;return null}function A(lt){for(var Qe=new Map;lt!==null;)lt.key!==null?Qe.set(lt.key,lt):Qe.set(lt.index,lt),lt=lt.sibling;return Qe}function L(lt,Qe){return lt=tu(lt,Qe),lt.index=0,lt.sibling=null,lt}function O(lt,Qe,vt){return lt.index=vt,h?(vt=lt.alternate,vt!==null?(vt=vt.index,vt<Qe?(lt.flags|=67108866,Qe):vt):(lt.flags|=67108866,Qe)):(lt.flags|=1048576,Qe)}function Q(lt){return h&&lt.alternate===null&&(lt.flags|=67108866),lt}function pe(lt,Qe,vt,Xt){return Qe===null||Qe.tag!==6?(Qe=jb(vt,lt.mode,Xt),Qe.return=lt,Qe):(Qe=L(Qe,vt),Qe.return=lt,Qe)}function Ve(lt,Qe,vt,Xt){var _i=vt.type;return _i===_?Ht(lt,Qe,vt.props.children,Xt,vt.key):Qe!==null&&(Qe.elementType===_i||typeof _i=="object"&&_i!==null&&_i.$$typeof===I&&eg(_i)===Qe.type)?(Qe=L(Qe,vt.props),bc(Qe,vt),Qe.return=lt,Qe):(Qe=zh(vt.type,vt.key,vt.props,null,lt.mode,Xt),bc(Qe,vt),Qe.return=lt,Qe)}function xt(lt,Qe,vt,Xt){return Qe===null||Qe.tag!==4||Qe.stateNode.containerInfo!==vt.containerInfo||Qe.stateNode.implementation!==vt.implementation?(Qe=Yb(vt,lt.mode,Xt),Qe.return=lt,Qe):(Qe=L(Qe,vt.children||[]),Qe.return=lt,Qe)}function Ht(lt,Qe,vt,Xt,_i){return Qe===null||Qe.tag!==7?(Qe=gp(vt,lt.mode,Xt,_i),Qe.return=lt,Qe):(Qe=L(Qe,vt),Qe.return=lt,Qe)}function $t(lt,Qe,vt){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number"||typeof Qe=="bigint")return Qe=jb(""+Qe,lt.mode,vt),Qe.return=lt,Qe;if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case m:return vt=zh(Qe.type,Qe.key,Qe.props,null,lt.mode,vt),bc(vt,Qe),vt.return=lt,vt;case y:return Qe=Yb(Qe,lt.mode,vt),Qe.return=lt,Qe;case I:return Qe=eg(Qe),$t(lt,Qe,vt)}if(q(Qe)||V(Qe))return Qe=gp(Qe,lt.mode,vt,null),Qe.return=lt,Qe;if(typeof Qe.then=="function")return $t(lt,b1(Qe),vt);if(Qe.$$typeof===w)return $t(lt,X0(lt,Qe),vt);W0(lt,Qe)}return null}function Mt(lt,Qe,vt,Xt){var _i=Qe!==null?Qe.key:null;if(typeof vt=="string"&&vt!==""||typeof vt=="number"||typeof vt=="bigint")return _i!==null?null:pe(lt,Qe,""+vt,Xt);if(typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case m:return vt.key===_i?Ve(lt,Qe,vt,Xt):null;case y:return vt.key===_i?xt(lt,Qe,vt,Xt):null;case I:return vt=eg(vt),Mt(lt,Qe,vt,Xt)}if(q(vt)||V(vt))return _i!==null?null:Ht(lt,Qe,vt,Xt,null);if(typeof vt.then=="function")return Mt(lt,Qe,b1(vt),Xt);if(vt.$$typeof===w)return Mt(lt,Qe,X0(lt,vt),Xt);W0(lt,vt)}return null}function Dt(lt,Qe,vt,Xt,_i){if(typeof Xt=="string"&&Xt!==""||typeof Xt=="number"||typeof Xt=="bigint")return lt=lt.get(vt)||null,pe(Qe,lt,""+Xt,_i);if(typeof Xt=="object"&&Xt!==null){switch(Xt.$$typeof){case m:return lt=lt.get(Xt.key===null?vt:Xt.key)||null,Ve(Qe,lt,Xt,_i);case y:return lt=lt.get(Xt.key===null?vt:Xt.key)||null,xt(Qe,lt,Xt,_i);case I:return Xt=eg(Xt),Dt(lt,Qe,vt,Xt,_i)}if(q(Xt)||V(Xt))return lt=lt.get(vt)||null,Ht(Qe,lt,Xt,_i,null);if(typeof Xt.then=="function")return Dt(lt,Qe,vt,b1(Xt),_i);if(Xt.$$typeof===w)return Dt(lt,Qe,vt,X0(Qe,Xt),_i);W0(Qe,Xt)}return null}function ii(lt,Qe,vt,Xt){for(var _i=null,os=null,hi=Qe,cr=Qe=0,Xr=null;hi!==null&&cr<vt.length;cr++){hi.index>cr?(Xr=hi,hi=null):Xr=hi.sibling;var ls=Mt(lt,hi,vt[cr],Xt);if(ls===null){hi===null&&(hi=Xr);break}h&&hi&&ls.alternate===null&&p(lt,hi),Qe=O(ls,Qe,cr),os===null?_i=ls:os.sibling=ls,os=ls,hi=Xr}if(cr===vt.length)return x(lt,hi),Rr&&Vh(lt,cr),_i;if(hi===null){for(;cr<vt.length;cr++)hi=$t(lt,vt[cr],Xt),hi!==null&&(Qe=O(hi,Qe,cr),os===null?_i=hi:os.sibling=hi,os=hi);return Rr&&Vh(lt,cr),_i}for(hi=A(hi);cr<vt.length;cr++)Xr=Dt(hi,lt,cr,vt[cr],Xt),Xr!==null&&(h&&Xr.alternate!==null&&hi.delete(Xr.key===null?cr:Xr.key),Qe=O(Xr,Qe,cr),os===null?_i=Xr:os.sibling=Xr,os=Xr);return h&&hi.forEach(function(fy){return p(lt,fy)}),Rr&&Vh(lt,cr),_i}function Pi(lt,Qe,vt,Xt){if(vt==null)throw Error(i(151));for(var _i=null,os=null,hi=Qe,cr=Qe=0,Xr=null,ls=vt.next();hi!==null&&!ls.done;cr++,ls=vt.next()){hi.index>cr?(Xr=hi,hi=null):Xr=hi.sibling;var fy=Mt(lt,hi,ls.value,Xt);if(fy===null){hi===null&&(hi=Xr);break}h&&hi&&fy.alternate===null&&p(lt,hi),Qe=O(fy,Qe,cr),os===null?_i=fy:os.sibling=fy,os=fy,hi=Xr}if(ls.done)return x(lt,hi),Rr&&Vh(lt,cr),_i;if(hi===null){for(;!ls.done;cr++,ls=vt.next())ls=$t(lt,ls.value,Xt),ls!==null&&(Qe=O(ls,Qe,cr),os===null?_i=ls:os.sibling=ls,os=ls);return Rr&&Vh(lt,cr),_i}for(hi=A(hi);!ls.done;cr++,ls=vt.next())ls=Dt(hi,lt,cr,ls.value,Xt),ls!==null&&(h&&ls.alternate!==null&&hi.delete(ls.key===null?cr:ls.key),Qe=O(ls,Qe,cr),os===null?_i=ls:os.sibling=ls,os=ls);return h&&hi.forEach(function(pMe){return p(lt,pMe)}),Rr&&Vh(lt,cr),_i}function Os(lt,Qe,vt,Xt){if(typeof vt=="object"&&vt!==null&&vt.type===_&&vt.key===null&&(vt=vt.props.children),typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case m:e:{for(var _i=vt.key;Qe!==null;){if(Qe.key===_i){if(_i=vt.type,_i===_){if(Qe.tag===7){x(lt,Qe.sibling),Xt=L(Qe,vt.props.children),Xt.return=lt,lt=Xt;break e}}else if(Qe.elementType===_i||typeof _i=="object"&&_i!==null&&_i.$$typeof===I&&eg(_i)===Qe.type){x(lt,Qe.sibling),Xt=L(Qe,vt.props),bc(Xt,vt),Xt.return=lt,lt=Xt;break e}x(lt,Qe);break}else p(lt,Qe);Qe=Qe.sibling}vt.type===_?(Xt=gp(vt.props.children,lt.mode,Xt,vt.key),Xt.return=lt,lt=Xt):(Xt=zh(vt.type,vt.key,vt.props,null,lt.mode,Xt),bc(Xt,vt),Xt.return=lt,lt=Xt)}return Q(lt);case y:e:{for(_i=vt.key;Qe!==null;){if(Qe.key===_i)if(Qe.tag===4&&Qe.stateNode.containerInfo===vt.containerInfo&&Qe.stateNode.implementation===vt.implementation){x(lt,Qe.sibling),Xt=L(Qe,vt.children||[]),Xt.return=lt,lt=Xt;break e}else{x(lt,Qe);break}else p(lt,Qe);Qe=Qe.sibling}Xt=Yb(vt,lt.mode,Xt),Xt.return=lt,lt=Xt}return Q(lt);case I:return vt=eg(vt),Os(lt,Qe,vt,Xt)}if(q(vt))return ii(lt,Qe,vt,Xt);if(V(vt)){if(_i=V(vt),typeof _i!="function")throw Error(i(150));return vt=_i.call(vt),Pi(lt,Qe,vt,Xt)}if(typeof vt.then=="function")return Os(lt,Qe,b1(vt),Xt);if(vt.$$typeof===w)return Os(lt,Qe,X0(lt,vt),Xt);W0(lt,vt)}return typeof vt=="string"&&vt!==""||typeof vt=="number"||typeof vt=="bigint"?(vt=""+vt,Qe!==null&&Qe.tag===6?(x(lt,Qe.sibling),Xt=L(Qe,vt),Xt.return=lt,lt=Xt):(x(lt,Qe),Xt=jb(vt,lt.mode,Xt),Xt.return=lt,lt=Xt),Q(lt)):x(lt,Qe)}return function(lt,Qe,vt,Xt){try{rg=0;var _i=Os(lt,Qe,vt,Xt);return ig=null,_i}catch(hi){if(hi===Qm||hi===rr)throw hi;var os=ha(29,hi,null,lt.mode);return os.lanes=Xt,os.return=lt,os}}}var hf=r_(!0),s_=r_(!1),Fl=!1;function _1(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function HA(h,p){h=h.updateQueue,p.updateQueue===h&&(p.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,callbacks:null})}function df(h){return{lane:h,tag:0,payload:null,callback:null,next:null}}function Mp(h,p,x){var A=h.updateQueue;if(A===null)return null;if(A=A.shared,(pi&2)!==0){var L=A.pending;return L===null?p.next=p:(p.next=L.next,L.next=p),A.pending=p,p=vc(h),pp(h,null,x),p}return Bo(h,A,p,x),vc(h)}function Ap(h,p,x){if(p=p.updateQueue,p!==null&&(p=p.shared,(x&4194048)!==0)){var A=p.lanes;A&=h.pendingLanes,x|=A,p.lanes=x,tn(h,x)}}function bi(h,p){var x=h.updateQueue,A=h.alternate;if(A!==null&&(A=A.updateQueue,x===A)){var L=null,O=null;if(x=x.firstBaseUpdate,x!==null){do{var Q={lane:x.lane,tag:x.tag,payload:x.payload,callback:null,next:null};O===null?L=O=Q:O=O.next=Q,x=x.next}while(x!==null);O===null?L=O=p:O=O.next=p}else L=O=p;x={baseState:A.baseState,firstBaseUpdate:L,lastBaseUpdate:O,shared:A.shared,callbacks:A.callbacks},h.updateQueue=x;return}h=x.lastBaseUpdate,h===null?x.firstBaseUpdate=p:h.next=p,x.lastBaseUpdate=p}var XA=!1;function S1(){if(XA){var h=xc;if(h!==null)throw h}}function Z0(h,p,x,A){XA=!1;var L=h.updateQueue;Fl=!1;var O=L.firstBaseUpdate,Q=L.lastBaseUpdate,pe=L.shared.pending;if(pe!==null){L.shared.pending=null;var Ve=pe,xt=Ve.next;Ve.next=null,Q===null?O=xt:Q.next=xt,Q=Ve;var Ht=h.alternate;Ht!==null&&(Ht=Ht.updateQueue,pe=Ht.lastBaseUpdate,pe!==Q&&(pe===null?Ht.firstBaseUpdate=xt:pe.next=xt,Ht.lastBaseUpdate=Ve))}if(O!==null){var $t=L.baseState;Q=0,Ht=xt=Ve=null,pe=O;do{var Mt=pe.lane&-536870913,Dt=Mt!==pe.lane;if(Dt?(nr&Mt)===Mt:(A&Mt)===Mt){Mt!==0&&Mt===cf&&(XA=!0),Ht!==null&&(Ht=Ht.next={lane:0,tag:pe.tag,payload:pe.payload,callback:null,next:null});e:{var ii=h,Pi=pe;Mt=p;var Os=x;switch(Pi.tag){case 1:if(ii=Pi.payload,typeof ii=="function"){$t=ii.call(Os,$t,Mt);break e}$t=ii;break e;case 3:ii.flags=ii.flags&-65537|128;case 0:if(ii=Pi.payload,Mt=typeof ii=="function"?ii.call(Os,$t,Mt):ii,Mt==null)break e;$t=d({},$t,Mt);break e;case 2:Fl=!0}}Mt=pe.callback,Mt!==null&&(h.flags|=64,Dt&&(h.flags|=8192),Dt=L.callbacks,Dt===null?L.callbacks=[Mt]:Dt.push(Mt))}else Dt={lane:Mt,tag:pe.tag,payload:pe.payload,callback:pe.callback,next:null},Ht===null?(xt=Ht=Dt,Ve=$t):Ht=Ht.next=Dt,Q|=Mt;if(pe=pe.next,pe===null){if(pe=L.shared.pending,pe===null)break;Dt=pe,pe=Dt.next,Dt.next=null,L.lastBaseUpdate=Dt,L.shared.pending=null}}while(!0);Ht===null&&(Ve=$t),L.baseState=Ve,L.firstBaseUpdate=xt,L.lastBaseUpdate=Ht,O===null&&(L.shared.lanes=0),nd|=Q,h.lanes=Q,h.memoizedState=$t}}function j0(h,p){if(typeof h!="function")throw Error(i(191,h));h.call(p)}function v3(h,p){var x=h.callbacks;if(x!==null)for(h.callbacks=null,h=0;h<x.length;h++)j0(x[h],p)}var Y0=ue(null),a_=ue(0);function x3(h,p){h=Lu,Ce(a_,h),Ce(Y0,p),Lu=h|p.baseLanes}function WA(){Ce(a_,Lu),Ce(Y0,Y0.current)}function M1(){Lu=a_.current,ce(Y0),ce(a_)}var ru=ue(null),Ll=null;function ff(h){var p=h.alternate;Ce(Pr,Pr.current&1),Ce(ru,h),Ll===null&&(p===null||Y0.current!==null||p.memoizedState!==null)&&(Ll=h)}function ZA(h){Ce(Pr,Pr.current),Ce(ru,h),Ll===null&&(Ll=h)}function b3(h){h.tag===22?(Ce(Pr,Pr.current),Ce(ru,h),Ll===null&&(Ll=h)):su()}function su(){Ce(Pr,Pr.current),Ce(ru,ru.current)}function za(h){ce(ru),Ll===h&&(Ll=null),ce(Pr)}var Pr=ue(0);function Nu(h){for(var p=h;p!==null;){if(p.tag===13){var x=p.memoizedState;if(x!==null&&(x=x.dehydrated,x===null||PI(x)||DI(x)))return p}else if(p.tag===19&&(p.memoizedProps.revealOrder==="forwards"||p.memoizedProps.revealOrder==="backwards"||p.memoizedProps.revealOrder==="unstable_legacy-backwards"||p.memoizedProps.revealOrder==="together")){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===h)break;for(;p.sibling===null;){if(p.return===null||p.return===h)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var ta=0,Ki=null,Ms=null,Mr=null,_c=!1,K0=!1,sg=!1,o_=0,A1=0,$0=null,jA=0;function fa(){throw Error(i(321))}function YA(h,p){if(p===null)return!1;for(var x=0;x<p.length&&x<h.length;x++)if(!Nl(h[x],p[x]))return!1;return!0}function l_(h,p,x,A,L,O){return ta=O,Ki=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,j.H=h===null||h.memoizedState===null?q3:pT,sg=!1,O=x(A,L),sg=!1,K0&&(O=ag(p,x,A,L)),_3(h),O}function _3(h){j.H=J0;var p=Ms!==null&&Ms.next!==null;if(ta=0,Mr=Ms=Ki=null,_c=!1,A1=0,$0=null,p)throw Error(i(300));h===null||ro||(h=h.dependencies,h!==null&&y1(h)&&(ro=!0))}function ag(h,p,x,A){Ki=h;var L=0;do{if(K0&&($0=null),A1=0,K0=!1,25<=L)throw Error(i(301));if(L+=1,Mr=Ms=null,h.updateQueue!=null){var O=h.updateQueue;O.lastEffect=null,O.events=null,O.stores=null,O.memoCache!=null&&(O.memoCache.index=0)}j.H=Sc,O=p(x,A)}while(K0);return O}function og(){var h=j.H,p=h.useState()[0];return p=typeof p.then=="function"?T1(p):p,h=h.useState()[0],(Ms!==null?Ms.memoizedState:null)!==h&&(Ki.flags|=1024),p}function KA(){var h=o_!==0;return o_=0,h}function $A(h,p,x){p.updateQueue=h.updateQueue,p.flags&=-2053,h.lanes&=~x}function JA(h){if(_c){for(h=h.memoizedState;h!==null;){var p=h.queue;p!==null&&(p.pending=null),h=h.next}_c=!1}ta=0,Mr=Ms=Ki=null,K0=!1,A1=o_=0,$0=null}function yo(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mr===null?Ki.memoizedState=Mr=h:Mr=Mr.next=h,Mr}function Va(){if(Ms===null){var h=Ki.alternate;h=h!==null?h.memoizedState:null}else h=Ms.next;var p=Mr===null?Ki.memoizedState:Mr.next;if(p!==null)Mr=p,Ms=h;else{if(h===null)throw Ki.alternate===null?Error(i(467)):Error(i(310));Ms=h,h={memoizedState:Ms.memoizedState,baseState:Ms.baseState,baseQueue:Ms.baseQueue,queue:Ms.queue,next:null},Mr===null?Ki.memoizedState=Mr=h:Mr=Mr.next=h}return Mr}function u_(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function T1(h){var p=A1;return A1+=1,$0===null&&($0=[]),h=i_($0,h,p),p=Ki,(Mr===null?p.memoizedState:Mr.next)===null&&(p=p.alternate,j.H=p===null||p.memoizedState===null?q3:pT),h}function Tp(h){if(h!==null&&typeof h=="object"){if(typeof h.then=="function")return T1(h);if(h.$$typeof===w)return Fi(h)}throw Error(i(438,String(h)))}function qA(h){var p=null,x=Ki.updateQueue;if(x!==null&&(p=x.memoCache),p==null){var A=Ki.alternate;A!==null&&(A=A.updateQueue,A!==null&&(A=A.memoCache,A!=null&&(p={data:A.data.map(function(L){return L.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),x===null&&(x=u_(),Ki.updateQueue=x),x.memoCache=p,x=p.data[p.index],x===void 0)for(x=p.data[p.index]=Array(h),A=0;A<h;A++)x[A]=N;return p.index++,x}function pf(h,p){return typeof p=="function"?p(h):p}function c_(h){var p=Va();return QA(p,Ms,h)}function QA(h,p,x){var A=h.queue;if(A===null)throw Error(i(311));A.lastRenderedReducer=x;var L=h.baseQueue,O=A.pending;if(O!==null){if(L!==null){var Q=L.next;L.next=O.next,O.next=Q}p.baseQueue=L=O,A.pending=null}if(O=h.baseState,L===null)h.memoizedState=O;else{p=L.next;var pe=Q=null,Ve=null,xt=p,Ht=!1;do{var $t=xt.lane&-536870913;if($t!==xt.lane?(nr&$t)===$t:(ta&$t)===$t){var Mt=xt.revertLane;if(Mt===0)Ve!==null&&(Ve=Ve.next={lane:0,revertLane:0,gesture:null,action:xt.action,hasEagerState:xt.hasEagerState,eagerState:xt.eagerState,next:null}),$t===cf&&(Ht=!0);else if((ta&Mt)===Mt){xt=xt.next,Mt===cf&&(Ht=!0);continue}else $t={lane:0,revertLane:xt.revertLane,gesture:null,action:xt.action,hasEagerState:xt.hasEagerState,eagerState:xt.eagerState,next:null},Ve===null?(pe=Ve=$t,Q=O):Ve=Ve.next=$t,Ki.lanes|=Mt,nd|=Mt;$t=xt.action,sg&&x(O,$t),O=xt.hasEagerState?xt.eagerState:x(O,$t)}else Mt={lane:$t,revertLane:xt.revertLane,gesture:xt.gesture,action:xt.action,hasEagerState:xt.hasEagerState,eagerState:xt.eagerState,next:null},Ve===null?(pe=Ve=Mt,Q=O):Ve=Ve.next=Mt,Ki.lanes|=$t,nd|=$t;xt=xt.next}while(xt!==null&&xt!==p);if(Ve===null?Q=O:Ve.next=pe,!Nl(O,h.memoizedState)&&(ro=!0,Ht&&(x=xc,x!==null)))throw x;h.memoizedState=O,h.baseState=Q,h.baseQueue=Ve,A.lastRenderedState=O}return L===null&&(A.lanes=0),[h.memoizedState,A.dispatch]}function eT(h){var p=Va(),x=p.queue;if(x===null)throw Error(i(311));x.lastRenderedReducer=h;var A=x.dispatch,L=x.pending,O=p.memoizedState;if(L!==null){x.pending=null;var Q=L=L.next;do O=h(O,Q.action),Q=Q.next;while(Q!==L);Nl(O,p.memoizedState)||(ro=!0),p.memoizedState=O,p.baseQueue===null&&(p.baseState=O),x.lastRenderedState=O}return[O,A]}function S3(h,p,x){var A=Ki,L=Va(),O=Rr;if(O){if(x===void 0)throw Error(i(407));x=x()}else x=p();var Q=!Nl((Ms||L).memoizedState,x);if(Q&&(L.memoizedState=x,ro=!0),L=L.queue,lT(T3.bind(null,A,L,h),[h]),L.getSnapshot!==p||Q||Mr!==null&&Mr.memoizedState.tag&1){if(A.flags|=2048,Cp(9,{destroy:void 0},A3.bind(null,A,L,x,p),null),ki===null)throw Error(i(349));O||(ta&127)!==0||M3(A,p,x)}return x}function M3(h,p,x){h.flags|=16384,h={getSnapshot:p,value:x},p=Ki.updateQueue,p===null?(p=u_(),Ki.updateQueue=p,p.stores=[h]):(x=p.stores,x===null?p.stores=[h]:x.push(h))}function A3(h,p,x,A){p.value=x,p.getSnapshot=A,C3(p)&&w3(h)}function T3(h,p,x){return x(function(){C3(p)&&w3(h)})}function C3(h){var p=h.getSnapshot;h=h.value;try{var x=p();return!Nl(h,x)}catch{return!0}}function w3(h){var p=Bl(h,2);p!==null&&ar(p,h,2)}function tT(h){var p=yo();if(typeof h=="function"){var x=h;if(h=x(),sg){Ft(!0);try{x()}finally{Ft(!1)}}}return p.memoizedState=p.baseState=h,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pf,lastRenderedState:h},p}function nT(h,p,x,A){return h.baseState=x,QA(h,Ms,typeof A=="function"?A:pf)}function pI(h,p,x,A,L){if(p_(h))throw Error(i(485));if(h=p.action,h!==null){var O={payload:L,action:h,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Q){O.listeners.push(Q)}};j.T!==null?x(!0):O.isTransition=!1,A(O),x=p.pending,x===null?(O.next=p.pending=O,E3(p,O)):(O.next=x.next,p.pending=x.next=O)}}function E3(h,p){var x=p.action,A=p.payload,L=h.state;if(p.isTransition){var O=j.T,Q={};j.T=Q;try{var pe=x(L,A),Ve=j.S;Ve!==null&&Ve(Q,pe),R3(h,p,pe)}catch(xt){iT(h,p,xt)}finally{O!==null&&Q.types!==null&&(O.types=Q.types),j.T=O}}else try{O=x(L,A),R3(h,p,O)}catch(xt){iT(h,p,xt)}}function R3(h,p,x){x!==null&&typeof x=="object"&&typeof x.then=="function"?x.then(function(A){P3(h,p,A)},function(A){return iT(h,p,A)}):P3(h,p,x)}function P3(h,p,x){p.status="fulfilled",p.value=x,D3(p),h.state=x,p=h.pending,p!==null&&(x=p.next,x===p?h.pending=null:(x=x.next,p.next=x,E3(h,x)))}function iT(h,p,x){var A=h.pending;if(h.pending=null,A!==null){A=A.next;do p.status="rejected",p.reason=x,D3(p),p=p.next;while(p!==A)}h.action=null}function D3(h){h=h.listeners;for(var p=0;p<h.length;p++)(0,h[p])()}function rT(h,p){return p}function sT(h,p){if(Rr){var x=ki.formState;if(x!==null){e:{var A=Ki;if(Rr){if(Ls){t:{for(var L=Ls,O=Pu;L.nodeType!==8;){if(!O){L=null;break t}if(L=sd(L.nextSibling),L===null){L=null;break t}}O=L.data,L=O==="F!"||O==="F"?L:null}if(L){Ls=sd(L.nextSibling),A=L.data==="F!";break e}}Xh(A)}A=!1}A&&(p=x[0])}}return x=yo(),x.memoizedState=x.baseState=p,A={pending:null,lanes:0,dispatch:null,lastRenderedReducer:rT,lastRenderedState:p},x.queue=A,x=K3.bind(null,Ki,A),A.dispatch=x,A=tT(!1),O=fT.bind(null,Ki,!1,A.queue),A=yo(),L={state:p,dispatch:null,action:h,pending:null},A.queue=L,x=pI.bind(null,Ki,L,O,x),L.dispatch=x,A.memoizedState=h,[p,x,!1]}function N3(h){var p=Va();return aT(p,Ms,h)}function aT(h,p,x){if(p=QA(h,p,rT)[0],h=c_(pf)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var A=T1(p)}catch(Q){throw Q===Qm?rr:Q}else A=p;p=Va();var L=p.queue,O=L.dispatch;return x!==p.memoizedState&&(Ki.flags|=2048,Cp(9,{destroy:void 0},B3.bind(null,L,x),null)),[A,O,h]}function B3(h,p){h.action=p}function oT(h){var p=Va(),x=Ms;if(x!==null)return aT(p,x,h);Va(),p=p.memoizedState,x=Va();var A=x.queue.dispatch;return x.memoizedState=h,[p,A,!1]}function Cp(h,p,x,A){return h={tag:h,create:x,deps:A,inst:p,next:null},p=Ki.updateQueue,p===null&&(p=u_(),Ki.updateQueue=p),x=p.lastEffect,x===null?p.lastEffect=h.next=h:(A=x.next,x.next=h,h.next=A,p.lastEffect=h),h}function h_(){return Va().memoizedState}function d_(h,p,x,A){var L=yo();Ki.flags|=h,L.memoizedState=Cp(1|p,{destroy:void 0},x,A===void 0?null:A)}function f_(h,p,x,A){var L=Va();A=A===void 0?null:A;var O=L.memoizedState.inst;Ms!==null&&A!==null&&YA(A,Ms.memoizedState.deps)?L.memoizedState=Cp(p,O,x,A):(Ki.flags|=h,L.memoizedState=Cp(1|p,O,x,A))}function F3(h,p){d_(8390656,8,h,p)}function lT(h,p){f_(2048,8,h,p)}function L3(h){Ki.flags|=4;var p=Ki.updateQueue;if(p===null)p=u_(),Ki.updateQueue=p,p.events=[h];else{var x=p.events;x===null?p.events=[h]:x.push(h)}}function I3(h){var p=Va().memoizedState;return L3({ref:p,nextImpl:h}),function(){if((pi&2)!==0)throw Error(i(440));return p.impl.apply(void 0,arguments)}}function G3(h,p){return f_(4,2,h,p)}function O3(h,p){return f_(4,4,h,p)}function U3(h,p){if(typeof p=="function"){h=h();var x=p(h);return function(){typeof x=="function"?x():p(null)}}if(p!=null)return h=h(),p.current=h,function(){p.current=null}}function k3(h,p,x){x=x!=null?x.concat([h]):null,f_(4,4,U3.bind(null,p,h),x)}function uT(){}function z3(h,p){var x=Va();p=p===void 0?null:p;var A=x.memoizedState;return p!==null&&YA(p,A[1])?A[0]:(x.memoizedState=[h,p],h)}function V3(h,p){var x=Va();p=p===void 0?null:p;var A=x.memoizedState;if(p!==null&&YA(p,A[1]))return A[0];if(A=h(),sg){Ft(!0);try{h()}finally{Ft(!1)}}return x.memoizedState=[A,p],A}function cT(h,p,x){return x===void 0||(ta&1073741824)!==0&&(nr&261930)===0?h.memoizedState=p:(h.memoizedState=x,h=gr(),Ki.lanes|=h,nd|=h,x)}function H3(h,p,x,A){return Nl(x,p)?x:Y0.current!==null?(h=cT(h,x,A),Nl(h,p)||(ro=!0),h):(ta&42)===0||(ta&1073741824)!==0&&(nr&261930)===0?(ro=!0,h.memoizedState=x):(h=gr(),Ki.lanes|=h,nd|=h,p)}function X3(h,p,x,A,L){var O=te.p;te.p=O!==0&&8>O?O:8;var Q=j.T,pe={};j.T=pe,fT(h,!1,p,x);try{var Ve=L(),xt=j.S;if(xt!==null&&xt(pe,Ve),Ve!==null&&typeof Ve=="object"&&typeof Ve.then=="function"){var Ht=zA(Ve,A);C1(h,p,Ht,Gu(h))}else C1(h,p,A,Gu(h))}catch($t){C1(h,p,{then:function(){},status:"rejected",reason:$t},Gu())}finally{te.p=O,Q!==null&&pe.types!==null&&(Q.types=pe.types),j.T=Q}}function mI(){}function hT(h,p,x,A){if(h.tag!==5)throw Error(i(476));var L=W3(h).queue;X3(h,L,p,he,x===null?mI:function(){return Z3(h),x(A)})}function W3(h){var p=h.memoizedState;if(p!==null)return p;p={memoizedState:he,baseState:he,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pf,lastRenderedState:he},next:null};var x={};return p.next={memoizedState:x,baseState:x,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pf,lastRenderedState:x},next:null},h.memoizedState=p,h=h.alternate,h!==null&&(h.memoizedState=p),p}function Z3(h){var p=W3(h);p.next===null&&(p=h.alternate.memoizedState),C1(h,p.next.queue,{},Gu())}function dT(){return Fi(FT)}function j3(){return Va().memoizedState}function Y3(){return Va().memoizedState}function gI(h){for(var p=h.return;p!==null;){switch(p.tag){case 24:case 3:var x=Gu();h=df(x);var A=Mp(p,h,x);A!==null&&(ar(A,p,x),Ap(A,p,x)),p={cache:OA()},h.payload=p;return}p=p.return}}function yI(h,p,x){var A=Gu();x={lane:A,revertLane:0,gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null},p_(h)?$3(p,x):(x=Wb(h,p,x,A),x!==null&&(ar(x,h,A),J3(x,p,A)))}function K3(h,p,x){var A=Gu();C1(h,p,x,A)}function C1(h,p,x,A){var L={lane:A,revertLane:0,gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null};if(p_(h))$3(p,L);else{var O=h.alternate;if(h.lanes===0&&(O===null||O.lanes===0)&&(O=p.lastRenderedReducer,O!==null))try{var Q=p.lastRenderedState,pe=O(Q,x);if(L.hasEagerState=!0,L.eagerState=pe,Nl(pe,Q))return Bo(h,p,L,0),ki===null&&m1(),!1}catch{}if(x=Wb(h,p,L,A),x!==null)return ar(x,h,A),J3(x,p,A),!0}return!1}function fT(h,p,x,A){if(A={lane:2,revertLane:Et(),gesture:null,action:A,hasEagerState:!1,eagerState:null,next:null},p_(h)){if(p)throw Error(i(479))}else p=Wb(h,x,A,2),p!==null&&ar(p,h,2)}function p_(h){var p=h.alternate;return h===Ki||p!==null&&p===Ki}function $3(h,p){K0=_c=!0;var x=h.pending;x===null?p.next=p:(p.next=x.next,x.next=p),h.pending=p}function J3(h,p,x){if((x&4194048)!==0){var A=p.lanes;A&=h.pendingLanes,x|=A,p.lanes=x,tn(h,x)}}var J0={readContext:Fi,use:Tp,useCallback:fa,useContext:fa,useEffect:fa,useImperativeHandle:fa,useLayoutEffect:fa,useInsertionEffect:fa,useMemo:fa,useReducer:fa,useRef:fa,useState:fa,useDebugValue:fa,useDeferredValue:fa,useTransition:fa,useSyncExternalStore:fa,useId:fa,useHostTransitionStatus:fa,useFormState:fa,useActionState:fa,useOptimistic:fa,useMemoCache:fa,useCacheRefresh:fa};J0.useEffectEvent=fa;var q3={readContext:Fi,use:Tp,useCallback:function(h,p){return yo().memoizedState=[h,p===void 0?null:p],h},useContext:Fi,useEffect:F3,useImperativeHandle:function(h,p,x){x=x!=null?x.concat([h]):null,d_(4194308,4,U3.bind(null,p,h),x)},useLayoutEffect:function(h,p){return d_(4194308,4,h,p)},useInsertionEffect:function(h,p){d_(4,2,h,p)},useMemo:function(h,p){var x=yo();p=p===void 0?null:p;var A=h();if(sg){Ft(!0);try{h()}finally{Ft(!1)}}return x.memoizedState=[A,p],A},useReducer:function(h,p,x){var A=yo();if(x!==void 0){var L=x(p);if(sg){Ft(!0);try{x(p)}finally{Ft(!1)}}}else L=p;return A.memoizedState=A.baseState=L,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:L},A.queue=h,h=h.dispatch=yI.bind(null,Ki,h),[A.memoizedState,h]},useRef:function(h){var p=yo();return h={current:h},p.memoizedState=h},useState:function(h){h=tT(h);var p=h.queue,x=K3.bind(null,Ki,p);return p.dispatch=x,[h.memoizedState,x]},useDebugValue:uT,useDeferredValue:function(h,p){var x=yo();return cT(x,h,p)},useTransition:function(){var h=tT(!1);return h=X3.bind(null,Ki,h.queue,!0,!1),yo().memoizedState=h,[!1,h]},useSyncExternalStore:function(h,p,x){var A=Ki,L=yo();if(Rr){if(x===void 0)throw Error(i(407));x=x()}else{if(x=p(),ki===null)throw Error(i(349));(nr&127)!==0||M3(A,p,x)}L.memoizedState=x;var O={value:x,getSnapshot:p};return L.queue=O,F3(T3.bind(null,A,O,h),[h]),A.flags|=2048,Cp(9,{destroy:void 0},A3.bind(null,A,O,x,p),null),x},useId:function(){var h=yo(),p=ki.identifierPrefix;if(Rr){var x=nh,A=da;x=(A&~(1<<32-Se(A)-1)).toString(32)+x,p="_"+p+"R_"+x,x=o_++,0<x&&(p+="H"+x.toString(32)),p+="_"}else x=jA++,p="_"+p+"r_"+x.toString(32)+"_";return h.memoizedState=p},useHostTransitionStatus:dT,useFormState:sT,useActionState:sT,useOptimistic:function(h){var p=yo();p.memoizedState=p.baseState=h;var x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=x,p=fT.bind(null,Ki,!0,x),x.dispatch=p,[h,p]},useMemoCache:qA,useCacheRefresh:function(){return yo().memoizedState=gI.bind(null,Ki)},useEffectEvent:function(h){var p=yo(),x={impl:h};return p.memoizedState=x,function(){if((pi&2)!==0)throw Error(i(440));return x.impl.apply(void 0,arguments)}}},pT={readContext:Fi,use:Tp,useCallback:z3,useContext:Fi,useEffect:lT,useImperativeHandle:k3,useInsertionEffect:G3,useLayoutEffect:O3,useMemo:V3,useReducer:c_,useRef:h_,useState:function(){return c_(pf)},useDebugValue:uT,useDeferredValue:function(h,p){var x=Va();return H3(x,Ms.memoizedState,h,p)},useTransition:function(){var h=c_(pf)[0],p=Va().memoizedState;return[typeof h=="boolean"?h:T1(h),p]},useSyncExternalStore:S3,useId:j3,useHostTransitionStatus:dT,useFormState:N3,useActionState:N3,useOptimistic:function(h,p){var x=Va();return nT(x,Ms,h,p)},useMemoCache:qA,useCacheRefresh:Y3};pT.useEffectEvent=I3;var Sc={readContext:Fi,use:Tp,useCallback:z3,useContext:Fi,useEffect:lT,useImperativeHandle:k3,useInsertionEffect:G3,useLayoutEffect:O3,useMemo:V3,useReducer:eT,useRef:h_,useState:function(){return eT(pf)},useDebugValue:uT,useDeferredValue:function(h,p){var x=Va();return Ms===null?cT(x,h,p):H3(x,Ms.memoizedState,h,p)},useTransition:function(){var h=eT(pf)[0],p=Va().memoizedState;return[typeof h=="boolean"?h:T1(h),p]},useSyncExternalStore:S3,useId:j3,useHostTransitionStatus:dT,useFormState:oT,useActionState:oT,useOptimistic:function(h,p){var x=Va();return Ms!==null?nT(x,Ms,h,p):(x.baseState=h,[h,x.queue.dispatch])},useMemoCache:qA,useCacheRefresh:Y3};Sc.useEffectEvent=I3;function m_(h,p,x,A){p=h.memoizedState,x=x(A,p),x=x==null?p:d({},p,x),h.memoizedState=x,h.lanes===0&&(h.updateQueue.baseState=x)}var w1={enqueueSetState:function(h,p,x){h=h._reactInternals;var A=Gu(),L=df(A);L.payload=p,x!=null&&(L.callback=x),p=Mp(h,L,A),p!==null&&(ar(p,h,A),Ap(p,h,A))},enqueueReplaceState:function(h,p,x){h=h._reactInternals;var A=Gu(),L=df(A);L.tag=1,L.payload=p,x!=null&&(L.callback=x),p=Mp(h,L,A),p!==null&&(ar(p,h,A),Ap(p,h,A))},enqueueForceUpdate:function(h,p){h=h._reactInternals;var x=Gu(),A=df(x);A.tag=2,p!=null&&(A.callback=p),p=Mp(h,A,x),p!==null&&(ar(p,h,x),Ap(p,h,x))}};function mT(h,p,x,A,L,O,Q){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(A,O,Q):p.prototype&&p.prototype.isPureReactComponent?!B0(x,A)||!B0(L,O):!0}function gT(h,p,x,A){h=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(x,A),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(x,A),p.state!==h&&w1.enqueueReplaceState(p,p.state,null)}function wp(h,p){var x=p;if("ref"in p){x={};for(var A in p)A!=="ref"&&(x[A]=p[A])}if(h=h.defaultProps){x===p&&(x=d({},x));for(var L in h)x[L]===void 0&&(x[L]=h[L])}return x}function Q3(h){p1(h)}function yT(h){console.error(h)}function vT(h){p1(h)}function g_(h,p){try{var x=h.onUncaughtError;x(p.value,{componentStack:p.stack})}catch(A){setTimeout(function(){throw A})}}function eP(h,p,x){try{var A=h.onCaughtError;A(x.value,{componentStack:x.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(L){setTimeout(function(){throw L})}}function xT(h,p,x){return x=df(x),x.tag=3,x.payload={element:null},x.callback=function(){g_(h,p)},x}function bT(h){return h=df(h),h.tag=3,h}function tP(h,p,x,A){var L=x.type.getDerivedStateFromError;if(typeof L=="function"){var O=A.value;h.payload=function(){return L(O)},h.callback=function(){eP(p,x,A)}}var Q=x.stateNode;Q!==null&&typeof Q.componentDidCatch=="function"&&(h.callback=function(){eP(p,x,A),typeof L!="function"&&(Wa===null?Wa=new Set([this]):Wa.add(this));var pe=A.stack;this.componentDidCatch(A.value,{componentStack:pe!==null?pe:""})})}function vo(h,p,x,A,L){if(x.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){if(p=x.alternate,p!==null&&Yh(p,x,L,!0),x=ru.current,x!==null){switch(x.tag){case 31:case 13:return Ll===null?ry():x.alternate===null&&pa===0&&(pa=3),x.flags&=-257,x.flags|=65536,x.lanes=L,A===n_?x.flags|=16384:(p=x.updateQueue,p===null?x.updateQueue=new Set([A]):p.add(A),U1(h,A,L)),!1;case 22:return x.flags|=65536,A===n_?x.flags|=16384:(p=x.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([A])},x.updateQueue=p):(x=p.retryQueue,x===null?p.retryQueue=new Set([A]):x.add(A)),U1(h,A,L)),!1}throw Error(i(435,x.tag))}return U1(h,A,L),ry(),!1}if(Rr)return p=ru.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=L,A!==z0&&(h=Error(i(422),{cause:A}),Wh(Ru(h,x)))):(A!==z0&&(p=Error(i(423),{cause:A}),Wh(Ru(p,x))),h=h.current.alternate,h.flags|=65536,L&=-L,h.lanes|=L,A=Ru(A,x),L=xT(h.stateNode,A,L),bi(h,L),pa!==4&&(pa=2)),!1;var O=Error(i(520),{cause:A});if(O=Ru(O,x),mg===null?mg=[O]:mg.push(O),pa!==4&&(pa=2),p===null)return!0;A=Ru(A,x),x=p;do{switch(x.tag){case 3:return x.flags|=65536,h=L&-L,x.lanes|=h,h=xT(x.stateNode,A,h),bi(x,h),!1;case 1:if(p=x.type,O=x.stateNode,(x.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||O!==null&&typeof O.componentDidCatch=="function"&&(Wa===null||!Wa.has(O))))return x.flags|=65536,L&=-L,x.lanes|=L,L=bT(L),tP(L,h,x,A),bi(x,L),!1}x=x.return}while(x!==null);return!1}var y_=Error(i(461)),ro=!1;function Fo(h,p,x,A){p.child=h===null?s_(p,null,x,A):hf(p,h.child,x,A)}function _T(h,p,x,A,L){x=x.render;var O=p.ref;if("ref"in A){var Q={};for(var pe in A)pe!=="ref"&&(Q[pe]=A[pe])}else Q=A;return _p(p),A=l_(h,p,x,Q,O,L),pe=KA(),h!==null&&!ro?($A(h,p,L),Ha(h,p,L)):(Rr&&pe&&Hh(p),p.flags|=1,Fo(h,p,A,L),p.child)}function lg(h,p,x,A,L){if(h===null){var O=x.type;return typeof O=="function"&&!Zb(O)&&O.defaultProps===void 0&&x.compare===null?(p.tag=15,p.type=O,v_(h,p,O,A,L)):(h=zh(x.type,null,A,p,p.mode,L),h.ref=p.ref,h.return=p,p.child=h)}if(O=h.child,!A_(h,L)){var Q=O.memoizedProps;if(x=x.compare,x=x!==null?x:B0,x(Q,A)&&h.ref===p.ref)return Ha(h,p,L)}return p.flags|=1,h=tu(O,A),h.ref=p.ref,h.return=p,p.child=h}function v_(h,p,x,A,L){if(h!==null){var O=h.memoizedProps;if(B0(O,A)&&h.ref===p.ref)if(ro=!1,p.pendingProps=A=O,A_(h,L))(h.flags&131072)!==0&&(ro=!0);else return p.lanes=h.lanes,Ha(h,p,L)}return q0(h,p,x,A,L)}function ug(h,p,x,A){var L=A.children,O=h!==null?h.memoizedState:null;if(h===null&&p.stateNode===null&&(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),A.mode==="hidden"){if((p.flags&128)!==0){if(O=O!==null?O.baseLanes|x:x,h!==null){for(A=p.child=h.child,L=0;A!==null;)L=L|A.lanes|A.childLanes,A=A.sibling;A=L&~O}else A=0,p.child=null;return au(h,p,O,x,A)}if((x&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},h!==null&&v1(p,O!==null?O.cachePool:null),O!==null?x3(p,O):WA(),b3(p);else return A=p.lanes=536870912,au(h,p,O!==null?O.baseLanes|x:x,x,A)}else O!==null?(v1(p,O.cachePool),x3(p,O),su(),p.memoizedState=null):(h!==null&&v1(p,null),WA(),su());return Fo(h,p,L,x),p.child}function $h(h,p){return h!==null&&h.tag===22||p.stateNode!==null||(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.sibling}function au(h,p,x,A,L){var O=t_();return O=O===null?null:{parent:io._currentValue,pool:O},p.memoizedState={baseLanes:x,cachePool:O},h!==null&&v1(p,null),WA(),b3(p),h!==null&&Yh(h,p,A,!0),p.childLanes=L,null}function x_(h,p){return p=M_({mode:p.mode,children:p.children},h.mode),p.ref=h.ref,h.child=p,p.return=h,p}function nP(h,p,x){return hf(p,h.child,null,x),h=x_(p,p.pendingProps),h.flags|=2,za(p),p.memoizedState=null,h}function b_(h,p,x){var A=p.pendingProps,L=(p.flags&128)!==0;if(p.flags&=-129,h===null){if(Rr){if(A.mode==="hidden")return h=x_(p,A),p.lanes=536870912,$h(null,h);if(ZA(p),(h=Ls)?(h=tX(h,Pu),h=h!==null&&h.data==="&"?h:null,h!==null&&(p.memoizedState={dehydrated:h,treeContext:of!==null?{id:da,overflow:nh}:null,retryLane:536870912,hydrationErrors:null},x=O0(h),x.return=p,p.child=x,Ea=p,Ls=null)):h=null,h===null)throw Xh(p);return p.lanes=536870912,null}return x_(p,A)}var O=h.memoizedState;if(O!==null){var Q=O.dehydrated;if(ZA(p),L)if(p.flags&256)p.flags&=-257,p=nP(h,p,x);else if(p.memoizedState!==null)p.child=h.child,p.flags|=128,p=null;else throw Error(i(558));else if(ro||Yh(h,p,x,!1),L=(x&h.childLanes)!==0,ro||L){if(A=ki,A!==null&&(Q=Tn(A,x),Q!==0&&Q!==O.retryLane))throw O.retryLane=Q,Bl(h,Q),ar(A,h,Q),y_;ry(),p=nP(h,p,x)}else h=O.treeContext,Ls=sd(Q.nextSibling),Ea=p,Rr=!0,lf=null,Pu=!1,h!==null&&$b(p,h),p=x_(p,A),p.flags|=4096;return p}return h=tu(h.child,{mode:A.mode,children:A.children}),h.ref=p.ref,p.child=h,h.return=p,h}function cg(h,p){var x=p.ref;if(x===null)h!==null&&h.ref!==null&&(p.flags|=4194816);else{if(typeof x!="function"&&typeof x!="object")throw Error(i(284));(h===null||h.ref!==x)&&(p.flags|=4194816)}}function q0(h,p,x,A,L){return _p(p),x=l_(h,p,x,A,void 0,L),A=KA(),h!==null&&!ro?($A(h,p,L),Ha(h,p,L)):(Rr&&A&&Hh(p),p.flags|=1,Fo(h,p,x,L),p.child)}function E1(h,p,x,A,L,O){return _p(p),p.updateQueue=null,x=ag(p,A,x,L),_3(h),A=KA(),h!==null&&!ro?($A(h,p,O),Ha(h,p,O)):(Rr&&A&&Hh(p),p.flags|=1,Fo(h,p,x,O),p.child)}function __(h,p,x,A,L){if(_p(p),p.stateNode===null){var O=mp,Q=x.contextType;typeof Q=="object"&&Q!==null&&(O=Fi(Q)),O=new x(A,O),p.memoizedState=O.state!==null&&O.state!==void 0?O.state:null,O.updater=w1,p.stateNode=O,O._reactInternals=p,O=p.stateNode,O.props=A,O.state=p.memoizedState,O.refs={},_1(p),Q=x.contextType,O.context=typeof Q=="object"&&Q!==null?Fi(Q):mp,O.state=p.memoizedState,Q=x.getDerivedStateFromProps,typeof Q=="function"&&(m_(p,x,Q,A),O.state=p.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof O.getSnapshotBeforeUpdate=="function"||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(Q=O.state,typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount(),Q!==O.state&&w1.enqueueReplaceState(O,O.state,null),Z0(p,A,O,L),S1(),O.state=p.memoizedState),typeof O.componentDidMount=="function"&&(p.flags|=4194308),A=!0}else if(h===null){O=p.stateNode;var pe=p.memoizedProps,Ve=wp(x,pe);O.props=Ve;var xt=O.context,Ht=x.contextType;Q=mp,typeof Ht=="object"&&Ht!==null&&(Q=Fi(Ht));var $t=x.getDerivedStateFromProps;Ht=typeof $t=="function"||typeof O.getSnapshotBeforeUpdate=="function",pe=p.pendingProps!==pe,Ht||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(pe||xt!==Q)&&gT(p,O,A,Q),Fl=!1;var Mt=p.memoizedState;O.state=Mt,Z0(p,A,O,L),S1(),xt=p.memoizedState,pe||Mt!==xt||Fl?(typeof $t=="function"&&(m_(p,x,$t,A),xt=p.memoizedState),(Ve=Fl||mT(p,x,Ve,A,Mt,xt,Q))?(Ht||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(p.flags|=4194308)):(typeof O.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=A,p.memoizedState=xt),O.props=A,O.state=xt,O.context=Q,A=Ve):(typeof O.componentDidMount=="function"&&(p.flags|=4194308),A=!1)}else{O=p.stateNode,HA(h,p),Q=p.memoizedProps,Ht=wp(x,Q),O.props=Ht,$t=p.pendingProps,Mt=O.context,xt=x.contextType,Ve=mp,typeof xt=="object"&&xt!==null&&(Ve=Fi(xt)),pe=x.getDerivedStateFromProps,(xt=typeof pe=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(Q!==$t||Mt!==Ve)&&gT(p,O,A,Ve),Fl=!1,Mt=p.memoizedState,O.state=Mt,Z0(p,A,O,L),S1();var Dt=p.memoizedState;Q!==$t||Mt!==Dt||Fl||h!==null&&h.dependencies!==null&&y1(h.dependencies)?(typeof pe=="function"&&(m_(p,x,pe,A),Dt=p.memoizedState),(Ht=Fl||mT(p,x,Ht,A,Mt,Dt,Ve)||h!==null&&h.dependencies!==null&&y1(h.dependencies))?(xt||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(A,Dt,Ve),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(A,Dt,Ve)),typeof O.componentDidUpdate=="function"&&(p.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof O.componentDidUpdate!="function"||Q===h.memoizedProps&&Mt===h.memoizedState||(p.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||Q===h.memoizedProps&&Mt===h.memoizedState||(p.flags|=1024),p.memoizedProps=A,p.memoizedState=Dt),O.props=A,O.state=Dt,O.context=Ve,A=Ht):(typeof O.componentDidUpdate!="function"||Q===h.memoizedProps&&Mt===h.memoizedState||(p.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||Q===h.memoizedProps&&Mt===h.memoizedState||(p.flags|=1024),A=!1)}return O=A,cg(h,p),A=(p.flags&128)!==0,O||A?(O=p.stateNode,x=A&&typeof x.getDerivedStateFromError!="function"?null:O.render(),p.flags|=1,h!==null&&A?(p.child=hf(p,h.child,null,L),p.child=hf(p,null,x,L)):Fo(h,p,x,L),p.memoizedState=O.state,h=p.child):h=Ha(h,p,L),h}function iP(h,p,x,A){return xp(),p.flags|=256,Fo(h,p,x,A),p.child}var ST={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function cl(h){return{baseLanes:h,cachePool:VA()}}function S_(h,p,x){return h=h!==null?h.childLanes&~x:0,p&&(h|=Ol),h}function rP(h,p,x){var A=p.pendingProps,L=!1,O=(p.flags&128)!==0,Q;if((Q=O)||(Q=h!==null&&h.memoizedState===null?!1:(Pr.current&2)!==0),Q&&(L=!0,p.flags&=-129),Q=(p.flags&32)!==0,p.flags&=-33,h===null){if(Rr){if(L?ff(p):su(),(h=Ls)?(h=tX(h,Pu),h=h!==null&&h.data!=="&"?h:null,h!==null&&(p.memoizedState={dehydrated:h,treeContext:of!==null?{id:da,overflow:nh}:null,retryLane:536870912,hydrationErrors:null},x=O0(h),x.return=p,p.child=x,Ea=p,Ls=null)):h=null,h===null)throw Xh(p);return DI(h)?p.lanes=32:p.lanes=536870912,null}var pe=A.children;return A=A.fallback,L?(su(),L=p.mode,pe=M_({mode:"hidden",children:pe},L),A=gp(A,L,x,null),pe.return=p,A.return=p,pe.sibling=A,p.child=pe,A=p.child,A.memoizedState=cl(x),A.childLanes=S_(h,Q,x),p.memoizedState=ST,$h(null,A)):(ff(p),R1(p,pe))}var Ve=h.memoizedState;if(Ve!==null&&(pe=Ve.dehydrated,pe!==null)){if(O)p.flags&256?(ff(p),p.flags&=-257,p=MT(h,p,x)):p.memoizedState!==null?(su(),p.child=h.child,p.flags|=128,p=null):(su(),pe=A.fallback,L=p.mode,A=M_({mode:"visible",children:A.children},L),pe=gp(pe,L,x,null),pe.flags|=2,A.return=p,pe.return=p,A.sibling=pe,p.child=A,hf(p,h.child,null,x),A=p.child,A.memoizedState=cl(x),A.childLanes=S_(h,Q,x),p.memoizedState=ST,p=$h(null,A));else if(ff(p),DI(pe)){if(Q=pe.nextSibling&&pe.nextSibling.dataset,Q)var xt=Q.dgst;Q=xt,A=Error(i(419)),A.stack="",A.digest=Q,Wh({value:A,source:null,stack:null}),p=MT(h,p,x)}else if(ro||Yh(h,p,x,!1),Q=(x&h.childLanes)!==0,ro||Q){if(Q=ki,Q!==null&&(A=Tn(Q,x),A!==0&&A!==Ve.retryLane))throw Ve.retryLane=A,Bl(h,A),ar(Q,h,A),y_;PI(pe)||ry(),p=MT(h,p,x)}else PI(pe)?(p.flags|=192,p.child=h.child,p=null):(h=Ve.treeContext,Ls=sd(pe.nextSibling),Ea=p,Rr=!0,lf=null,Pu=!1,h!==null&&$b(p,h),p=R1(p,A.children),p.flags|=4096);return p}return L?(su(),pe=A.fallback,L=p.mode,Ve=h.child,xt=Ve.sibling,A=tu(Ve,{mode:"hidden",children:A.children}),A.subtreeFlags=Ve.subtreeFlags&65011712,xt!==null?pe=tu(xt,pe):(pe=gp(pe,L,x,null),pe.flags|=2),pe.return=p,A.return=p,A.sibling=pe,p.child=A,$h(null,A),A=p.child,pe=h.child.memoizedState,pe===null?pe=cl(x):(L=pe.cachePool,L!==null?(Ve=io._currentValue,L=L.parent!==Ve?{parent:Ve,pool:Ve}:L):L=VA(),pe={baseLanes:pe.baseLanes|x,cachePool:L}),A.memoizedState=pe,A.childLanes=S_(h,Q,x),p.memoizedState=ST,$h(h.child,A)):(ff(p),x=h.child,h=x.sibling,x=tu(x,{mode:"visible",children:A.children}),x.return=p,x.sibling=null,h!==null&&(Q=p.deletions,Q===null?(p.deletions=[h],p.flags|=16):Q.push(h)),p.child=x,p.memoizedState=null,x)}function R1(h,p){return p=M_({mode:"visible",children:p},h.mode),p.return=h,h.child=p}function M_(h,p){return h=ha(22,h,null,p),h.lanes=0,h}function MT(h,p,x){return hf(p,h.child,null,x),h=R1(p,p.pendingProps.children),h.flags|=2,p.memoizedState=null,h}function sP(h,p,x){h.lanes|=p;var A=h.alternate;A!==null&&(A.lanes|=p),qb(h.return,p,x)}function hg(h,p,x,A,L,O){var Q=h.memoizedState;Q===null?h.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:A,tail:x,tailMode:L,treeForkCount:O}:(Q.isBackwards=p,Q.rendering=null,Q.renderingStartTime=0,Q.last=A,Q.tail=x,Q.tailMode=L,Q.treeForkCount=O)}function ou(h,p,x){var A=p.pendingProps,L=A.revealOrder,O=A.tail;A=A.children;var Q=Pr.current,pe=(Q&2)!==0;if(pe?(Q=Q&1|2,p.flags|=128):Q&=1,Ce(Pr,Q),Fo(h,p,A,x),A=Rr?k0:0,!pe&&h!==null&&(h.flags&128)!==0)e:for(h=p.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&sP(h,x,p);else if(h.tag===19)sP(h,x,p);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===p)break e;for(;h.sibling===null;){if(h.return===null||h.return===p)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}switch(L){case"forwards":for(x=p.child,L=null;x!==null;)h=x.alternate,h!==null&&Nu(h)===null&&(L=x),x=x.sibling;x=L,x===null?(L=p.child,p.child=null):(L=x.sibling,x.sibling=null),hg(p,!1,L,x,O,A);break;case"backwards":case"unstable_legacy-backwards":for(x=null,L=p.child,p.child=null;L!==null;){if(h=L.alternate,h!==null&&Nu(h)===null){p.child=L;break}h=L.sibling,L.sibling=x,x=L,L=h}hg(p,!0,x,null,O,A);break;case"together":hg(p,!1,null,null,void 0,A);break;default:p.memoizedState=null}return p.child}function Ha(h,p,x){if(h!==null&&(p.dependencies=h.dependencies),nd|=p.lanes,(x&p.childLanes)===0)if(h!==null){if(Yh(h,p,x,!1),(x&p.childLanes)===0)return null}else return null;if(h!==null&&p.child!==h.child)throw Error(i(153));if(p.child!==null){for(h=p.child,x=tu(h,h.pendingProps),p.child=x,x.return=p;h.sibling!==null;)h=h.sibling,x=x.sibling=tu(h,h.pendingProps),x.return=p;x.sibling=null}return p.child}function A_(h,p){return(h.lanes&p)!==0?!0:(h=h.dependencies,!!(h!==null&&y1(h)))}function vI(h,p,x){switch(p.tag){case 3:ft(p,p.stateNode.containerInfo),uf(p,io,h.memoizedState.cache),xp();break;case 27:case 5:ot(p);break;case 4:ft(p,p.stateNode.containerInfo);break;case 10:uf(p,p.type,p.memoizedProps.value);break;case 31:if(p.memoizedState!==null)return p.flags|=128,ZA(p),null;break;case 13:var A=p.memoizedState;if(A!==null)return A.dehydrated!==null?(ff(p),p.flags|=128,null):(x&p.child.childLanes)!==0?rP(h,p,x):(ff(p),h=Ha(h,p,x),h!==null?h.sibling:null);ff(p);break;case 19:var L=(h.flags&128)!==0;if(A=(x&p.childLanes)!==0,A||(Yh(h,p,x,!1),A=(x&p.childLanes)!==0),L){if(A)return ou(h,p,x);p.flags|=128}if(L=p.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),Ce(Pr,Pr.current),A)break;return null;case 22:return p.lanes=0,ug(h,p,x,p.pendingProps);case 24:uf(p,io,h.memoizedState.cache)}return Ha(h,p,x)}function T_(h,p,x){if(h!==null)if(h.memoizedProps!==p.pendingProps)ro=!0;else{if(!A_(h,x)&&(p.flags&128)===0)return ro=!1,vI(h,p,x);ro=(h.flags&131072)!==0}else ro=!1,Rr&&(p.flags&1048576)!==0&&d3(p,k0,p.index);switch(p.lanes=0,p.tag){case 16:e:{var A=p.pendingProps;if(h=eg(p.elementType),p.type=h,typeof h=="function")Zb(h)?(A=wp(h,A),p.tag=1,p=__(null,p,h,A,x)):(p.tag=0,p=q0(null,p,h,A,x));else{if(h!=null){var L=h.$$typeof;if(L===T){p.tag=11,p=_T(null,p,h,A,x);break e}else if(L===P){p.tag=14,p=lg(null,p,h,A,x);break e}}throw p=K(h)||h,Error(i(306,p,""))}}return p;case 0:return q0(h,p,p.type,p.pendingProps,x);case 1:return A=p.type,L=wp(A,p.pendingProps),__(h,p,A,L,x);case 3:e:{if(ft(p,p.stateNode.containerInfo),h===null)throw Error(i(387));A=p.pendingProps;var O=p.memoizedState;L=O.element,HA(h,p),Z0(p,A,null,x);var Q=p.memoizedState;if(A=Q.cache,uf(p,io,A),A!==O.cache&&Qb(p,[io],x,!0),S1(),A=Q.element,O.isDehydrated)if(O={element:A,isDehydrated:!1,cache:Q.cache},p.updateQueue.baseState=O,p.memoizedState=O,p.flags&256){p=iP(h,p,A,x);break e}else if(A!==L){L=Ru(Error(i(424)),p),Wh(L),p=iP(h,p,A,x);break e}else for(h=p.stateNode.containerInfo,h.nodeType===9?h=h.body:h=h.nodeName==="HTML"?h.ownerDocument.body:h,Ls=sd(h.firstChild),Ea=p,Rr=!0,lf=null,Pu=!0,x=s_(p,null,A,x),p.child=x;x;)x.flags=x.flags&-3|4096,x=x.sibling;else{if(xp(),A===L){p=Ha(h,p,x);break e}Fo(h,p,A,x)}p=p.child}return p;case 26:return cg(h,p),h===null?(x=oX(p.type,null,p.pendingProps,null))?p.memoizedState=x:Rr||(x=p.type,h=p.pendingProps,A=uP(Ae.current).createElement(x),A[es]=p,A[ie]=h,kl(A,x,h),de(A),p.stateNode=A):p.memoizedState=oX(p.type,h.memoizedProps,p.pendingProps,h.memoizedState),null;case 27:return ot(p),h===null&&Rr&&(A=p.stateNode=rX(p.type,p.pendingProps,Ae.current),Ea=p,Pu=!0,L=Ls,ly(p.type)?(NI=L,Ls=sd(A.firstChild)):Ls=L),Fo(h,p,p.pendingProps.children,x),cg(h,p),h===null&&(p.flags|=4194304),p.child;case 5:return h===null&&Rr&&((L=A=Ls)&&(A=XSe(A,p.type,p.pendingProps,Pu),A!==null?(p.stateNode=A,Ea=p,Ls=sd(A.firstChild),Pu=!1,L=!0):L=!1),L||Xh(p)),ot(p),L=p.type,O=p.pendingProps,Q=h!==null?h.memoizedProps:null,A=O.children,wI(L,O)?A=null:Q!==null&&wI(L,Q)&&(p.flags|=32),p.memoizedState!==null&&(L=l_(h,p,og,null,null,x),FT._currentValue=L),cg(h,p),Fo(h,p,A,x),p.child;case 6:return h===null&&Rr&&((h=x=Ls)&&(x=WSe(x,p.pendingProps,Pu),x!==null?(p.stateNode=x,Ea=p,Ls=null,h=!0):h=!1),h||Xh(p)),null;case 13:return rP(h,p,x);case 4:return ft(p,p.stateNode.containerInfo),A=p.pendingProps,h===null?p.child=hf(p,null,A,x):Fo(h,p,A,x),p.child;case 11:return _T(h,p,p.type,p.pendingProps,x);case 7:return Fo(h,p,p.pendingProps,x),p.child;case 8:return Fo(h,p,p.pendingProps.children,x),p.child;case 12:return Fo(h,p,p.pendingProps.children,x),p.child;case 10:return A=p.pendingProps,uf(p,p.type,A.value),Fo(h,p,A.children,x),p.child;case 9:return L=p.type._context,A=p.pendingProps.children,_p(p),L=Fi(L),A=A(L),p.flags|=1,Fo(h,p,A,x),p.child;case 14:return lg(h,p,p.type,p.pendingProps,x);case 15:return v_(h,p,p.type,p.pendingProps,x);case 19:return ou(h,p,x);case 31:return b_(h,p,x);case 22:return ug(h,p,x,p.pendingProps);case 24:return _p(p),A=Fi(io),h===null?(L=t_(),L===null&&(L=ki,O=OA(),L.pooledCache=O,O.refCount++,O!==null&&(L.pooledCacheLanes|=x),L=O),p.memoizedState={parent:A,cache:L},_1(p),uf(p,io,L)):((h.lanes&x)!==0&&(HA(h,p),Z0(p,null,null,x),S1()),L=h.memoizedState,O=p.memoizedState,L.parent!==A?(L={parent:A,cache:A},p.memoizedState=L,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=L),uf(p,io,A)):(A=O.cache,uf(p,io,A),A!==L.cache&&Qb(p,[io],x,!0))),Fo(h,p,p.pendingProps.children,x),p.child;case 29:throw p.pendingProps}throw Error(i(156,p.tag))}function Jh(h){h.flags|=4}function P1(h,p,x,A,L){if((p=(h.mode&32)!==0)&&(p=!1),p){if(h.flags|=16777216,(L&335544128)===L)if(h.stateNode.complete)h.flags|=8192;else if(ga())h.flags|=8192;else throw Kh=n_,x1}else h.flags&=-16777217}function AT(h,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)h.flags&=-16777217;else if(h.flags|=16777216,!dX(p))if(ga())h.flags|=8192;else throw Kh=n_,x1}function mf(h,p){p!==null&&(h.flags|=4),h.flags&16384&&(p=h.tag!==22?ne():536870912,h.lanes|=p,js|=p)}function qh(h,p){if(!Rr)switch(h.tailMode){case"hidden":p=h.tail;for(var x=null;p!==null;)p.alternate!==null&&(x=p),p=p.sibling;x===null?h.tail=null:x.sibling=null;break;case"collapsed":x=h.tail;for(var A=null;x!==null;)x.alternate!==null&&(A=x),x=x.sibling;A===null?p||h.tail===null?h.tail=null:h.tail.sibling=null:A.sibling=null}}function As(h){var p=h.alternate!==null&&h.alternate.child===h.child,x=0,A=0;if(p)for(var L=h.child;L!==null;)x|=L.lanes|L.childLanes,A|=L.subtreeFlags&65011712,A|=L.flags&65011712,L.return=h,L=L.sibling;else for(L=h.child;L!==null;)x|=L.lanes|L.childLanes,A|=L.subtreeFlags,A|=L.flags,L.return=h,L=L.sibling;return h.subtreeFlags|=A,h.childLanes=x,p}function D1(h,p,x){var A=p.pendingProps;switch(Kb(p),p.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return As(p),null;case 1:return As(p),null;case 3:return x=p.stateNode,A=null,h!==null&&(A=h.memoizedState.cache),p.memoizedState.cache!==A&&(p.flags|=2048),jh(io),ze(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(h===null||h.child===null)&&(V0(p)?Jh(p):h===null||h.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,Jb())),As(p),null;case 26:var L=p.type,O=p.memoizedState;return h===null?(Jh(p),O!==null?(As(p),AT(p,O)):(As(p),P1(p,L,null,A,x))):O?O!==h.memoizedState?(Jh(p),As(p),AT(p,O)):(As(p),p.flags&=-16777217):(h=h.memoizedProps,h!==A&&Jh(p),As(p),P1(p,L,h,A,x)),null;case 27:if(ut(p),x=Ae.current,L=p.type,h!==null&&p.stateNode!=null)h.memoizedProps!==A&&Jh(p);else{if(!A){if(p.stateNode===null)throw Error(i(166));return As(p),null}h=Oe.current,V0(p)?f3(p):(h=rX(L,A,x),p.stateNode=h,Jh(p))}return As(p),null;case 5:if(ut(p),L=p.type,h!==null&&p.stateNode!=null)h.memoizedProps!==A&&Jh(p);else{if(!A){if(p.stateNode===null)throw Error(i(166));return As(p),null}if(O=Oe.current,V0(p))f3(p);else{var Q=uP(Ae.current);switch(O){case 1:O=Q.createElementNS("http://www.w3.org/2000/svg",L);break;case 2:O=Q.createElementNS("http://www.w3.org/1998/Math/MathML",L);break;default:switch(L){case"svg":O=Q.createElementNS("http://www.w3.org/2000/svg",L);break;case"math":O=Q.createElementNS("http://www.w3.org/1998/Math/MathML",L);break;case"script":O=Q.createElement("div"),O.innerHTML="<script><\/script>",O=O.removeChild(O.firstChild);break;case"select":O=typeof A.is=="string"?Q.createElement("select",{is:A.is}):Q.createElement("select"),A.multiple?O.multiple=!0:A.size&&(O.size=A.size);break;default:O=typeof A.is=="string"?Q.createElement(L,{is:A.is}):Q.createElement(L)}}O[es]=p,O[ie]=A;e:for(Q=p.child;Q!==null;){if(Q.tag===5||Q.tag===6)O.appendChild(Q.stateNode);else if(Q.tag!==4&&Q.tag!==27&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===p)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===p)break e;Q=Q.return}Q.sibling.return=Q.return,Q=Q.sibling}p.stateNode=O;e:switch(kl(O,L,A),L){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}A&&Jh(p)}}return As(p),P1(p,p.type,h===null?null:h.memoizedProps,p.pendingProps,x),null;case 6:if(h&&p.stateNode!=null)h.memoizedProps!==A&&Jh(p);else{if(typeof A!="string"&&p.stateNode===null)throw Error(i(166));if(h=Ae.current,V0(p)){if(h=p.stateNode,x=p.memoizedProps,A=null,L=Ea,L!==null)switch(L.tag){case 27:case 5:A=L.memoizedProps}h[es]=p,h=!!(h.nodeValue===x||A!==null&&A.suppressHydrationWarning===!0||j8(h.nodeValue,x)),h||Xh(p,!0)}else h=uP(h).createTextNode(A),h[es]=p,p.stateNode=h}return As(p),null;case 31:if(x=p.memoizedState,h===null||h.memoizedState!==null){if(A=V0(p),x!==null){if(h===null){if(!A)throw Error(i(318));if(h=p.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(i(557));h[es]=p}else xp(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;As(p),h=!1}else x=Jb(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=x),h=!0;if(!h)return p.flags&256?(za(p),p):(za(p),null);if((p.flags&128)!==0)throw Error(i(558))}return As(p),null;case 13:if(A=p.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(L=V0(p),A!==null&&A.dehydrated!==null){if(h===null){if(!L)throw Error(i(318));if(L=p.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(i(317));L[es]=p}else xp(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;As(p),L=!1}else L=Jb(),h!==null&&h.memoizedState!==null&&(h.memoizedState.hydrationErrors=L),L=!0;if(!L)return p.flags&256?(za(p),p):(za(p),null)}return za(p),(p.flags&128)!==0?(p.lanes=x,p):(x=A!==null,h=h!==null&&h.memoizedState!==null,x&&(A=p.child,L=null,A.alternate!==null&&A.alternate.memoizedState!==null&&A.alternate.memoizedState.cachePool!==null&&(L=A.alternate.memoizedState.cachePool.pool),O=null,A.memoizedState!==null&&A.memoizedState.cachePool!==null&&(O=A.memoizedState.cachePool.pool),O!==L&&(A.flags|=2048)),x!==h&&x&&(p.child.flags|=8192),mf(p,p.updateQueue),As(p),null);case 4:return ze(),h===null&&SI(p.stateNode.containerInfo),As(p),null;case 10:return jh(p.type),As(p),null;case 19:if(ce(Pr),A=p.memoizedState,A===null)return As(p),null;if(L=(p.flags&128)!==0,O=A.rendering,O===null)if(L)qh(A,!1);else{if(pa!==0||h!==null&&(h.flags&128)!==0)for(h=p.child;h!==null;){if(O=Nu(h),O!==null){for(p.flags|=128,qh(A,!1),h=O.updateQueue,p.updateQueue=h,mf(p,h),p.subtreeFlags=0,h=x,x=p.child;x!==null;)G0(x,h),x=x.sibling;return Ce(Pr,Pr.current&1|2),Rr&&Vh(p,A.treeForkCount),p.child}h=h.sibling}A.tail!==null&&ee()>Xa&&(p.flags|=128,L=!0,qh(A,!1),p.lanes=4194304)}else{if(!L)if(h=Nu(O),h!==null){if(p.flags|=128,L=!0,h=h.updateQueue,p.updateQueue=h,mf(p,h),qh(A,!0),A.tail===null&&A.tailMode==="hidden"&&!O.alternate&&!Rr)return As(p),null}else 2*ee()-A.renderingStartTime>Xa&&x!==536870912&&(p.flags|=128,L=!0,qh(A,!1),p.lanes=4194304);A.isBackwards?(O.sibling=p.child,p.child=O):(h=A.last,h!==null?h.sibling=O:p.child=O,A.last=O)}return A.tail!==null?(h=A.tail,A.rendering=h,A.tail=h.sibling,A.renderingStartTime=ee(),h.sibling=null,x=Pr.current,Ce(Pr,L?x&1|2:x&1),Rr&&Vh(p,A.treeForkCount),h):(As(p),null);case 22:case 23:return za(p),M1(),A=p.memoizedState!==null,h!==null?h.memoizedState!==null!==A&&(p.flags|=8192):A&&(p.flags|=8192),A?(x&536870912)!==0&&(p.flags&128)===0&&(As(p),p.subtreeFlags&6&&(p.flags|=8192)):As(p),x=p.updateQueue,x!==null&&mf(p,x.retryQueue),x=null,h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(x=h.memoizedState.cachePool.pool),A=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(A=p.memoizedState.cachePool.pool),A!==x&&(p.flags|=2048),h!==null&&ce(Sp),null;case 24:return x=null,h!==null&&(x=h.memoizedState.cache),p.memoizedState.cache!==x&&(p.flags|=2048),jh(io),As(p),null;case 25:return null;case 30:return null}throw Error(i(156,p.tag))}function Mc(h,p){switch(Kb(p),p.tag){case 1:return h=p.flags,h&65536?(p.flags=h&-65537|128,p):null;case 3:return jh(io),ze(),h=p.flags,(h&65536)!==0&&(h&128)===0?(p.flags=h&-65537|128,p):null;case 26:case 27:case 5:return ut(p),null;case 31:if(p.memoizedState!==null){if(za(p),p.alternate===null)throw Error(i(340));xp()}return h=p.flags,h&65536?(p.flags=h&-65537|128,p):null;case 13:if(za(p),h=p.memoizedState,h!==null&&h.dehydrated!==null){if(p.alternate===null)throw Error(i(340));xp()}return h=p.flags,h&65536?(p.flags=h&-65537|128,p):null;case 19:return ce(Pr),null;case 4:return ze(),null;case 10:return jh(p.type),null;case 22:case 23:return za(p),M1(),h!==null&&ce(Sp),h=p.flags,h&65536?(p.flags=h&-65537|128,p):null;case 24:return jh(io),null;case 25:return null;default:return null}}function Bu(h,p){switch(Kb(p),p.tag){case 3:jh(io),ze();break;case 26:case 27:case 5:ut(p);break;case 4:ze();break;case 31:p.memoizedState!==null&&za(p);break;case 13:za(p);break;case 19:ce(Pr);break;case 10:jh(p.type);break;case 22:case 23:za(p),M1(),h!==null&&ce(Sp);break;case 24:jh(io)}}function Ac(h,p){try{var x=p.updateQueue,A=x!==null?x.lastEffect:null;if(A!==null){var L=A.next;x=L;do{if((x.tag&h)===h){A=void 0;var O=x.create,Q=x.inst;A=O(),Q.destroy=A}x=x.next}while(x!==L)}}catch(pe){Kr(p,p.return,pe)}}function Ko(h,p,x){try{var A=p.updateQueue,L=A!==null?A.lastEffect:null;if(L!==null){var O=L.next;A=O;do{if((A.tag&h)===h){var Q=A.inst,pe=Q.destroy;if(pe!==void 0){Q.destroy=void 0,L=p;var Ve=x,xt=pe;try{xt()}catch(Ht){Kr(L,Ve,Ht)}}}A=A.next}while(A!==O)}}catch(Ht){Kr(p,p.return,Ht)}}function ih(h){var p=h.updateQueue;if(p!==null){var x=h.stateNode;try{v3(p,x)}catch(A){Kr(h,h.return,A)}}}function Lo(h,p,x){x.props=wp(h.type,h.memoizedProps),x.state=h.memoizedState;try{x.componentWillUnmount()}catch(A){Kr(h,p,A)}}function gf(h,p){try{var x=h.ref;if(x!==null){switch(h.tag){case 26:case 27:case 5:var A=h.stateNode;break;case 30:A=h.stateNode;break;default:A=h.stateNode}typeof x=="function"?h.refCleanup=x(A):x.current=A}}catch(L){Kr(h,p,L)}}function $o(h,p){var x=h.ref,A=h.refCleanup;if(x!==null)if(typeof A=="function")try{A()}catch(L){Kr(h,p,L)}finally{h.refCleanup=null,h=h.alternate,h!=null&&(h.refCleanup=null)}else if(typeof x=="function")try{x(null)}catch(L){Kr(h,p,L)}else x.current=null}function N1(h){var p=h.type,x=h.memoizedProps,A=h.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":x.autoFocus&&A.focus();break e;case"img":x.src?A.src=x.src:x.srcSet&&(A.srcset=x.srcSet)}}catch(L){Kr(h,h.return,L)}}function xo(h,p,x){try{var A=h.stateNode;OSe(A,h.type,x,p),A[ie]=p}catch(L){Kr(h,h.return,L)}}function na(h){return h.tag===5||h.tag===3||h.tag===26||h.tag===27&&ly(h.type)||h.tag===4}function Ar(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||na(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.tag===27&&ly(h.type)||h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Qh(h,p,x){var A=h.tag;if(A===5||A===6)h=h.stateNode,p?(x.nodeType===9?x.body:x.nodeName==="HTML"?x.ownerDocument.body:x).insertBefore(h,p):(p=x.nodeType===9?x.body:x.nodeName==="HTML"?x.ownerDocument.body:x,p.appendChild(h),x=x._reactRootContainer,x!=null||p.onclick!==null||(p.onclick=$n));else if(A!==4&&(A===27&&ly(h.type)&&(x=h.stateNode,p=null),h=h.child,h!==null))for(Qh(h,p,x),h=h.sibling;h!==null;)Qh(h,p,x),h=h.sibling}function Il(h,p,x){var A=h.tag;if(A===5||A===6)h=h.stateNode,p?x.insertBefore(h,p):x.appendChild(h);else if(A!==4&&(A===27&&ly(h.type)&&(x=h.stateNode),h=h.child,h!==null))for(Il(h,p,x),h=h.sibling;h!==null;)Il(h,p,x),h=h.sibling}function C_(h){var p=h.stateNode,x=h.memoizedProps;try{for(var A=h.type,L=p.attributes;L.length;)p.removeAttributeNode(L[0]);kl(p,A,x),p[es]=h,p[ie]=x}catch(O){Kr(h,h.return,O)}}var Tc=!1,Is=!1,rh=!1,aP=typeof WeakSet=="function"?WeakSet:Set,Io=null;function xI(h,p){if(h=h.containerInfo,TI=gP,h=l3(h),BA(h)){if("selectionStart"in h)var x={start:h.selectionStart,end:h.selectionEnd};else e:{x=(x=h.ownerDocument)&&x.defaultView||window;var A=x.getSelection&&x.getSelection();if(A&&A.rangeCount!==0){x=A.anchorNode;var L=A.anchorOffset,O=A.focusNode;A=A.focusOffset;try{x.nodeType,O.nodeType}catch{x=null;break e}var Q=0,pe=-1,Ve=-1,xt=0,Ht=0,$t=h,Mt=null;t:for(;;){for(var Dt;$t!==x||L!==0&&$t.nodeType!==3||(pe=Q+L),$t!==O||A!==0&&$t.nodeType!==3||(Ve=Q+A),$t.nodeType===3&&(Q+=$t.nodeValue.length),(Dt=$t.firstChild)!==null;)Mt=$t,$t=Dt;for(;;){if($t===h)break t;if(Mt===x&&++xt===L&&(pe=Q),Mt===O&&++Ht===A&&(Ve=Q),(Dt=$t.nextSibling)!==null)break;$t=Mt,Mt=$t.parentNode}$t=Dt}x=pe===-1||Ve===-1?null:{start:pe,end:Ve}}else x=null}x=x||{start:0,end:0}}else x=null;for(CI={focusedElem:h,selectionRange:x},gP=!1,Io=p;Io!==null;)if(p=Io,h=p.child,(p.subtreeFlags&1028)!==0&&h!==null)h.return=p,Io=h;else for(;Io!==null;){switch(p=Io,O=p.alternate,h=p.flags,p.tag){case 0:if((h&4)!==0&&(h=p.updateQueue,h=h!==null?h.events:null,h!==null))for(x=0;x<h.length;x++)L=h[x],L.ref.impl=L.nextImpl;break;case 11:case 15:break;case 1:if((h&1024)!==0&&O!==null){h=void 0,x=p,L=O.memoizedProps,O=O.memoizedState,A=x.stateNode;try{var ii=wp(x.type,L);h=A.getSnapshotBeforeUpdate(ii,O),A.__reactInternalSnapshotBeforeUpdate=h}catch(Pi){Kr(x,x.return,Pi)}}break;case 3:if((h&1024)!==0){if(h=p.stateNode.containerInfo,x=h.nodeType,x===9)RI(h);else if(x===1)switch(h.nodeName){case"HEAD":case"HTML":case"BODY":RI(h);break;default:h.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((h&1024)!==0)throw Error(i(163))}if(h=p.sibling,h!==null){h.return=p.return,Io=h;break}Io=p.return}}function ia(h,p,x){var A=x.flags;switch(x.tag){case 0:case 11:case 15:Ec(h,x),A&4&&Ac(5,x);break;case 1:if(Ec(h,x),A&4)if(h=x.stateNode,p===null)try{h.componentDidMount()}catch(Q){Kr(x,x.return,Q)}else{var L=wp(x.type,p.memoizedProps);p=p.memoizedState;try{h.componentDidUpdate(L,p,h.__reactInternalSnapshotBeforeUpdate)}catch(Q){Kr(x,x.return,Q)}}A&64&&ih(x),A&512&&gf(x,x.return);break;case 3:if(Ec(h,x),A&64&&(h=x.updateQueue,h!==null)){if(p=null,x.child!==null)switch(x.child.tag){case 27:case 5:p=x.child.stateNode;break;case 1:p=x.child.stateNode}try{v3(h,p)}catch(Q){Kr(x,x.return,Q)}}break;case 27:p===null&&A&4&&C_(x);case 26:case 5:Ec(h,x),p===null&&A&4&&N1(x),A&512&&gf(x,x.return);break;case 12:Ec(h,x);break;case 31:Ec(h,x),A&4&&Ep(h,x);break;case 13:Ec(h,x),A&4&&Q0(h,x),A&64&&(h=x.memoizedState,h!==null&&(h=h.dehydrated,h!==null&&(x=C.bind(null,x),ZSe(h,x))));break;case 22:if(A=x.memoizedState!==null||Tc,!A){p=p!==null&&p.memoizedState!==null||Is,L=Tc;var O=Is;Tc=A,(Is=p)&&!O?Gl(h,x,(x.subtreeFlags&8772)!==0):Ec(h,x),Tc=L,Is=O}break;case 30:break;default:Ec(h,x)}}function B1(h){var p=h.alternate;p!==null&&(h.alternate=null,B1(p)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(p=h.stateNode,p!==null&&Qt(p)),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}var ms=null,hl=!1;function Cc(h,p,x){for(x=x.child;x!==null;)w_(h,p,x),x=x.sibling}function w_(h,p,x){if(st&&typeof st.onCommitFiberUnmount=="function")try{st.onCommitFiberUnmount(Gt,x)}catch{}switch(x.tag){case 26:Is||$o(x,p),Cc(h,p,x),x.memoizedState?x.memoizedState.count--:x.stateNode&&(x=x.stateNode,x.parentNode.removeChild(x));break;case 27:Is||$o(x,p);var A=ms,L=hl;ly(x.type)&&(ms=x.stateNode,hl=!1),Cc(h,p,x),DT(x.stateNode),ms=A,hl=L;break;case 5:Is||$o(x,p);case 6:if(A=ms,L=hl,ms=null,Cc(h,p,x),ms=A,hl=L,ms!==null)if(hl)try{(ms.nodeType===9?ms.body:ms.nodeName==="HTML"?ms.ownerDocument.body:ms).removeChild(x.stateNode)}catch(O){Kr(x,p,O)}else try{ms.removeChild(x.stateNode)}catch(O){Kr(x,p,O)}break;case 18:ms!==null&&(hl?(h=ms,Q8(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,x.stateNode),L_(h)):Q8(ms,x.stateNode));break;case 4:A=ms,L=hl,ms=x.stateNode.containerInfo,hl=!0,Cc(h,p,x),ms=A,hl=L;break;case 0:case 11:case 14:case 15:Ko(2,x,p),Is||Ko(4,x,p),Cc(h,p,x);break;case 1:Is||($o(x,p),A=x.stateNode,typeof A.componentWillUnmount=="function"&&Lo(x,p,A)),Cc(h,p,x);break;case 21:Cc(h,p,x);break;case 22:Is=(A=Is)||x.memoizedState!==null,Cc(h,p,x),Is=A;break;default:Cc(h,p,x)}}function Ep(h,p){if(p.memoizedState===null&&(h=p.alternate,h!==null&&(h=h.memoizedState,h!==null))){h=h.dehydrated;try{L_(h)}catch(x){Kr(p,p.return,x)}}}function Q0(h,p){if(p.memoizedState===null&&(h=p.alternate,h!==null&&(h=h.memoizedState,h!==null&&(h=h.dehydrated,h!==null))))try{L_(h)}catch(x){Kr(p,p.return,x)}}function TT(h){switch(h.tag){case 31:case 13:case 19:var p=h.stateNode;return p===null&&(p=h.stateNode=new aP),p;case 22:return h=h.stateNode,p=h._retryCache,p===null&&(p=h._retryCache=new aP),p;default:throw Error(i(435,h.tag))}}function yf(h,p){var x=TT(h);p.forEach(function(A){if(!x.has(A)){x.add(A);var L=D.bind(null,h,A);A.then(L,L)}})}function bo(h,p){var x=p.deletions;if(x!==null)for(var A=0;A<x.length;A++){var L=x[A],O=h,Q=p,pe=Q;e:for(;pe!==null;){switch(pe.tag){case 27:if(ly(pe.type)){ms=pe.stateNode,hl=!1;break e}break;case 5:ms=pe.stateNode,hl=!1;break e;case 3:case 4:ms=pe.stateNode.containerInfo,hl=!0;break e}pe=pe.return}if(ms===null)throw Error(i(160));w_(O,Q,L),ms=null,hl=!1,O=L.alternate,O!==null&&(O.return=null),L.return=null}if(p.subtreeFlags&13886)for(p=p.child;p!==null;)Rp(p,h),p=p.sibling}var wc=null;function Rp(h,p){var x=h.alternate,A=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:bo(p,h),_o(h),A&4&&(Ko(3,h,h.return),Ac(3,h),Ko(5,h,h.return));break;case 1:bo(p,h),_o(h),A&512&&(Is||x===null||$o(x,x.return)),A&64&&Tc&&(h=h.updateQueue,h!==null&&(A=h.callbacks,A!==null&&(x=h.shared.hiddenCallbacks,h.shared.hiddenCallbacks=x===null?A:x.concat(A))));break;case 26:var L=wc;if(bo(p,h),_o(h),A&512&&(Is||x===null||$o(x,x.return)),A&4){var O=x!==null?x.memoizedState:null;if(A=h.memoizedState,x===null)if(A===null)if(h.stateNode===null){e:{A=h.type,x=h.memoizedProps,L=L.ownerDocument||L;t:switch(A){case"title":O=L.getElementsByTagName("title")[0],(!O||O[sn]||O[es]||O.namespaceURI==="http://www.w3.org/2000/svg"||O.hasAttribute("itemprop"))&&(O=L.createElement(A),L.head.insertBefore(O,L.querySelector("head > title"))),kl(O,A,x),O[es]=h,de(O),A=O;break e;case"link":var Q=cX("link","href",L).get(A+(x.href||""));if(Q){for(var pe=0;pe<Q.length;pe++)if(O=Q[pe],O.getAttribute("href")===(x.href==null||x.href===""?null:x.href)&&O.getAttribute("rel")===(x.rel==null?null:x.rel)&&O.getAttribute("title")===(x.title==null?null:x.title)&&O.getAttribute("crossorigin")===(x.crossOrigin==null?null:x.crossOrigin)){Q.splice(pe,1);break t}}O=L.createElement(A),kl(O,A,x),L.head.appendChild(O);break;case"meta":if(Q=cX("meta","content",L).get(A+(x.content||""))){for(pe=0;pe<Q.length;pe++)if(O=Q[pe],O.getAttribute("content")===(x.content==null?null:""+x.content)&&O.getAttribute("name")===(x.name==null?null:x.name)&&O.getAttribute("property")===(x.property==null?null:x.property)&&O.getAttribute("http-equiv")===(x.httpEquiv==null?null:x.httpEquiv)&&O.getAttribute("charset")===(x.charSet==null?null:x.charSet)){Q.splice(pe,1);break t}}O=L.createElement(A),kl(O,A,x),L.head.appendChild(O);break;default:throw Error(i(468,A))}O[es]=h,de(O),A=O}h.stateNode=A}else hX(L,h.type,h.stateNode);else h.stateNode=uX(L,A,h.memoizedProps);else O!==A?(O===null?x.stateNode!==null&&(x=x.stateNode,x.parentNode.removeChild(x)):O.count--,A===null?hX(L,h.type,h.stateNode):uX(L,A,h.memoizedProps)):A===null&&h.stateNode!==null&&xo(h,h.memoizedProps,x.memoizedProps)}break;case 27:bo(p,h),_o(h),A&512&&(Is||x===null||$o(x,x.return)),x!==null&&A&4&&xo(h,h.memoizedProps,x.memoizedProps);break;case 5:if(bo(p,h),_o(h),A&512&&(Is||x===null||$o(x,x.return)),h.flags&32){L=h.stateNode;try{Ws(L,"")}catch(ii){Kr(h,h.return,ii)}}A&4&&h.stateNode!=null&&(L=h.memoizedProps,xo(h,L,x!==null?x.memoizedProps:L)),A&1024&&(rh=!0);break;case 6:if(bo(p,h),_o(h),A&4){if(h.stateNode===null)throw Error(i(162));A=h.memoizedProps,x=h.stateNode;try{x.nodeValue=A}catch(ii){Kr(h,h.return,ii)}}break;case 3:if(dP=null,L=wc,wc=cP(p.containerInfo),bo(p,h),wc=L,_o(h),A&4&&x!==null&&x.memoizedState.isDehydrated)try{L_(p.containerInfo)}catch(ii){Kr(h,h.return,ii)}rh&&(rh=!1,E_(h));break;case 4:A=wc,wc=cP(h.stateNode.containerInfo),bo(p,h),_o(h),wc=A;break;case 12:bo(p,h),_o(h);break;case 31:bo(p,h),_o(h),A&4&&(A=h.updateQueue,A!==null&&(h.updateQueue=null,yf(h,A)));break;case 13:bo(p,h),_o(h),h.child.flags&8192&&h.memoizedState!==null!=(x!==null&&x.memoizedState!==null)&&(ey=ee()),A&4&&(A=h.updateQueue,A!==null&&(h.updateQueue=null,yf(h,A)));break;case 22:L=h.memoizedState!==null;var Ve=x!==null&&x.memoizedState!==null,xt=Tc,Ht=Is;if(Tc=xt||L,Is=Ht||Ve,bo(p,h),Is=Ht,Tc=xt,_o(h),A&8192)e:for(p=h.stateNode,p._visibility=L?p._visibility&-2:p._visibility|1,L&&(x===null||Ve||Tc||Is||ed(h)),x=null,p=h;;){if(p.tag===5||p.tag===26){if(x===null){Ve=x=p;try{if(O=Ve.stateNode,L)Q=O.style,typeof Q.setProperty=="function"?Q.setProperty("display","none","important"):Q.display="none";else{pe=Ve.stateNode;var $t=Ve.memoizedProps.style,Mt=$t!=null&&$t.hasOwnProperty("display")?$t.display:null;pe.style.display=Mt==null||typeof Mt=="boolean"?"":(""+Mt).trim()}}catch(ii){Kr(Ve,Ve.return,ii)}}}else if(p.tag===6){if(x===null){Ve=p;try{Ve.stateNode.nodeValue=L?"":Ve.memoizedProps}catch(ii){Kr(Ve,Ve.return,ii)}}}else if(p.tag===18){if(x===null){Ve=p;try{var Dt=Ve.stateNode;L?eX(Dt,!0):eX(Ve.stateNode,!1)}catch(ii){Kr(Ve,Ve.return,ii)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===h)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===h)break e;for(;p.sibling===null;){if(p.return===null||p.return===h)break e;x===p&&(x=null),p=p.return}x===p&&(x=null),p.sibling.return=p.return,p=p.sibling}A&4&&(A=h.updateQueue,A!==null&&(x=A.retryQueue,x!==null&&(A.retryQueue=null,yf(h,x))));break;case 19:bo(p,h),_o(h),A&4&&(A=h.updateQueue,A!==null&&(h.updateQueue=null,yf(h,A)));break;case 30:break;case 21:break;default:bo(p,h),_o(h)}}function _o(h){var p=h.flags;if(p&2){try{for(var x,A=h.return;A!==null;){if(na(A)){x=A;break}A=A.return}if(x==null)throw Error(i(160));switch(x.tag){case 27:var L=x.stateNode,O=Ar(h);Il(h,O,L);break;case 5:var Q=x.stateNode;x.flags&32&&(Ws(Q,""),x.flags&=-33);var pe=Ar(h);Il(h,pe,Q);break;case 3:case 4:var Ve=x.stateNode.containerInfo,xt=Ar(h);Qh(h,xt,Ve);break;default:throw Error(i(161))}}catch(Ht){Kr(h,h.return,Ht)}h.flags&=-3}p&4096&&(h.flags&=-4097)}function E_(h){if(h.subtreeFlags&1024)for(h=h.child;h!==null;){var p=h;E_(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),h=h.sibling}}function Ec(h,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)ia(h,p.alternate,p),p=p.sibling}function ed(h){for(h=h.child;h!==null;){var p=h;switch(p.tag){case 0:case 11:case 14:case 15:Ko(4,p,p.return),ed(p);break;case 1:$o(p,p.return);var x=p.stateNode;typeof x.componentWillUnmount=="function"&&Lo(p,p.return,x),ed(p);break;case 27:DT(p.stateNode);case 26:case 5:$o(p,p.return),ed(p);break;case 22:p.memoizedState===null&&ed(p);break;case 30:ed(p);break;default:ed(p)}h=h.sibling}}function Gl(h,p,x){for(x=x&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var A=p.alternate,L=h,O=p,Q=O.flags;switch(O.tag){case 0:case 11:case 15:Gl(L,O,x),Ac(4,O);break;case 1:if(Gl(L,O,x),A=O,L=A.stateNode,typeof L.componentDidMount=="function")try{L.componentDidMount()}catch(xt){Kr(A,A.return,xt)}if(A=O,L=A.updateQueue,L!==null){var pe=A.stateNode;try{var Ve=L.shared.hiddenCallbacks;if(Ve!==null)for(L.shared.hiddenCallbacks=null,L=0;L<Ve.length;L++)j0(Ve[L],pe)}catch(xt){Kr(A,A.return,xt)}}x&&Q&64&&ih(O),gf(O,O.return);break;case 27:C_(O);case 26:case 5:Gl(L,O,x),x&&A===null&&Q&4&&N1(O),gf(O,O.return);break;case 12:Gl(L,O,x);break;case 31:Gl(L,O,x),x&&Q&4&&Ep(L,O);break;case 13:Gl(L,O,x),x&&Q&4&&Q0(L,O);break;case 22:O.memoizedState===null&&Gl(L,O,x),gf(O,O.return);break;case 30:break;default:Gl(L,O,x)}p=p.sibling}}function Pp(h,p){var x=null;h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(x=h.memoizedState.cachePool.pool),h=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(h=p.memoizedState.cachePool.pool),h!==x&&(h!=null&&h.refCount++,x!=null&&qm(x))}function dg(h,p){h=null,p.alternate!==null&&(h=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==h&&(p.refCount++,h!=null&&qm(h))}function Jo(h,p,x,A){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)CT(h,p,x,A),p=p.sibling}function CT(h,p,x,A){var L=p.flags;switch(p.tag){case 0:case 11:case 15:Jo(h,p,x,A),L&2048&&Ac(9,p);break;case 1:Jo(h,p,x,A);break;case 3:Jo(h,p,x,A),L&2048&&(h=null,p.alternate!==null&&(h=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==h&&(p.refCount++,h!=null&&qm(h)));break;case 12:if(L&2048){Jo(h,p,x,A),h=p.stateNode;try{var O=p.memoizedProps,Q=O.id,pe=O.onPostCommit;typeof pe=="function"&&pe(Q,p.alternate===null?"mount":"update",h.passiveEffectDuration,-0)}catch(Ve){Kr(p,p.return,Ve)}}else Jo(h,p,x,A);break;case 31:Jo(h,p,x,A);break;case 13:Jo(h,p,x,A);break;case 23:break;case 22:O=p.stateNode,Q=p.alternate,p.memoizedState!==null?O._visibility&2?Jo(h,p,x,A):td(h,p):O._visibility&2?Jo(h,p,x,A):(O._visibility|=2,qo(h,p,x,A,(p.subtreeFlags&10256)!==0||!1)),L&2048&&Pp(Q,p);break;case 24:Jo(h,p,x,A),L&2048&&dg(p.alternate,p);break;default:Jo(h,p,x,A)}}function qo(h,p,x,A,L){for(L=L&&((p.subtreeFlags&10256)!==0||!1),p=p.child;p!==null;){var O=h,Q=p,pe=x,Ve=A,xt=Q.flags;switch(Q.tag){case 0:case 11:case 15:qo(O,Q,pe,Ve,L),Ac(8,Q);break;case 23:break;case 22:var Ht=Q.stateNode;Q.memoizedState!==null?Ht._visibility&2?qo(O,Q,pe,Ve,L):td(O,Q):(Ht._visibility|=2,qo(O,Q,pe,Ve,L)),L&&xt&2048&&Pp(Q.alternate,Q);break;case 24:qo(O,Q,pe,Ve,L),L&&xt&2048&&dg(Q.alternate,Q);break;default:qo(O,Q,pe,Ve,L)}p=p.sibling}}function td(h,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var x=h,A=p,L=A.flags;switch(A.tag){case 22:td(x,A),L&2048&&Pp(A.alternate,A);break;case 24:td(x,A),L&2048&&dg(A.alternate,A);break;default:td(x,A)}p=p.sibling}}var fg=8192;function Fu(h,p,x){if(h.subtreeFlags&fg)for(h=h.child;h!==null;)R_(h,p,x),h=h.sibling}function R_(h,p,x){switch(h.tag){case 26:Fu(h,p,x),h.flags&fg&&h.memoizedState!==null&&rMe(x,wc,h.memoizedState,h.memoizedProps);break;case 5:Fu(h,p,x);break;case 3:case 4:var A=wc;wc=cP(h.stateNode.containerInfo),Fu(h,p,x),wc=A;break;case 22:h.memoizedState===null&&(A=h.alternate,A!==null&&A.memoizedState!==null?(A=fg,fg=16777216,Fu(h,p,x),fg=A):Fu(h,p,x));break;default:Fu(h,p,x)}}function pg(h){var p=h.alternate;if(p!==null&&(h=p.child,h!==null)){p.child=null;do p=h.sibling,h.sibling=null,h=p;while(h!==null)}}function Dp(h){var p=h.deletions;if((h.flags&16)!==0){if(p!==null)for(var x=0;x<p.length;x++){var A=p[x];Io=A,Ra(A,h)}pg(h)}if(h.subtreeFlags&10256)for(h=h.child;h!==null;)lu(h),h=h.sibling}function lu(h){switch(h.tag){case 0:case 11:case 15:Dp(h),h.flags&2048&&Ko(9,h,h.return);break;case 3:Dp(h);break;case 12:Dp(h);break;case 22:var p=h.stateNode;h.memoizedState!==null&&p._visibility&2&&(h.return===null||h.return.tag!==13)?(p._visibility&=-3,uu(h)):Dp(h);break;default:Dp(h)}}function uu(h){var p=h.deletions;if((h.flags&16)!==0){if(p!==null)for(var x=0;x<p.length;x++){var A=p[x];Io=A,Ra(A,h)}pg(h)}for(h=h.child;h!==null;){switch(p=h,p.tag){case 0:case 11:case 15:Ko(8,p,p.return),uu(p);break;case 22:x=p.stateNode,x._visibility&2&&(x._visibility&=-3,uu(p));break;default:uu(p)}h=h.sibling}}function Ra(h,p){for(;Io!==null;){var x=Io;switch(x.tag){case 0:case 11:case 15:Ko(8,x,p);break;case 23:case 22:if(x.memoizedState!==null&&x.memoizedState.cachePool!==null){var A=x.memoizedState.cachePool.pool;A!=null&&A.refCount++}break;case 24:qm(x.memoizedState.cache)}if(A=x.child,A!==null)A.return=x,Io=A;else e:for(x=h;Io!==null;){A=Io;var L=A.sibling,O=A.return;if(B1(A),A===x){Io=null;break e}if(L!==null){L.return=O,Io=L;break e}Io=O}}}var vf={getCacheForType:function(h){var p=Fi(io),x=p.data.get(h);return x===void 0&&(x=h(),p.data.set(h,x)),x},cacheSignal:function(){return Fi(io).controller.signal}},$i=typeof WeakMap=="function"?WeakMap:Map,pi=0,ki=null,sr=null,nr=0,Ir=0,dl=null,Rc=!1,sh=!1,wT=!1,Lu=0,pa=0,nd=0,Np=0,F1=0,Ol=0,js=0,mg=null,Pa=null,Da=!1,ey=0,ET=0,Xa=1/0,ma=null,Wa=null,gs=0,Iu=null,ty=null,Pc=0,ny=0,iy=null,L1=null,Bp=0,gg=null;function Gu(){return(pi&2)!==0&&nr!==0?nr&-nr:j.T!==null?Et():Vi()}function gr(){if(Ol===0)if((nr&536870912)===0||Rr){var h=kt;kt<<=1,(kt&3932160)===0&&(kt=262144),Ol=h}else Ol=536870912;return h=ru.current,h!==null&&(h.flags|=32),Ol}function ar(h,p,x){(h===ki&&(Ir===2||Ir===9)||h.cancelPendingCommit!==null)&&(Lp(h,0),so(h,nr,Ol,!1)),be(h,x),((pi&2)===0||h!==ki)&&(h===ki&&((pi&2)===0&&(Np|=x),pa===4&&so(h,nr,Ol,!1)),mn(h))}function yr(h,p,x){if((pi&6)!==0)throw Error(i(327));var A=!x&&(p&127)===0&&(p&h.expiredLanes)===0||z(h,p),L=A?I1(h,p):Ul(h,p,!0),O=A;do{if(L===0){sh&&!A&&so(h,p,0,!1);break}else{if(x=h.current.alternate,O&&!ys(x)){L=Ul(h,p,!1),O=!1;continue}if(L===2){if(O=p,h.errorRecoveryDisabledLanes&O)var Q=0;else Q=h.pendingLanes&-536870913,Q=Q!==0?Q:Q&536870912?536870912:0;if(Q!==0){p=Q;e:{var pe=h;L=mg;var Ve=pe.current.memoizedState.isDehydrated;if(Ve&&(Lp(pe,Q).flags|=256),Q=Ul(pe,Q,!1),Q!==2){if(wT&&!Ve){pe.errorRecoveryDisabledLanes|=O,Np|=O,L=4;break e}O=Pa,Pa=L,O!==null&&(Pa===null?Pa=O:Pa.push.apply(Pa,O))}L=Q}if(O=!1,L!==2)continue}}if(L===1){Lp(h,0),so(h,p,0,!0);break}e:{switch(A=h,O=L,O){case 0:case 1:throw Error(i(345));case 4:if((p&4194048)!==p)break;case 6:so(A,p,Ol,!Rc);break e;case 2:Pa=null;break;case 3:case 5:break;default:throw Error(i(329))}if((p&62914560)===p&&(L=ey+300-ee(),10<L)){if(so(A,p,Ol,!Rc),Ut(A,0,!0)!==0)break e;Pc=p,A.timeoutHandle=J8(Tr.bind(null,A,x,Pa,ma,Da,p,Ol,Np,js,Rc,O,"Throttled",-0,0),L);break e}Tr(A,x,Pa,ma,Da,p,Ol,Np,js,Rc,O,null,-0,0)}}break}while(!0);mn(h)}function Tr(h,p,x,A,L,O,Q,pe,Ve,xt,Ht,$t,Mt,Dt){if(h.timeoutHandle=-1,$t=p.subtreeFlags,$t&8192||($t&16785408)===16785408){$t={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:$n},R_(p,O,$t);var ii=(O&62914560)===O?ey-ee():(O&4194048)===O?ET-ee():0;if(ii=sMe($t,ii),ii!==null){Pc=O,h.cancelPendingCommit=ii(bf.bind(null,h,p,O,x,A,L,Q,pe,Ve,Ht,$t,null,Mt,Dt)),so(h,O,Q,!xt);return}}bf(h,p,O,x,A,L,Q,pe,Ve)}function ys(h){for(var p=h;;){var x=p.tag;if((x===0||x===11||x===15)&&p.flags&16384&&(x=p.updateQueue,x!==null&&(x=x.stores,x!==null)))for(var A=0;A<x.length;A++){var L=x[A],O=L.getSnapshot;L=L.value;try{if(!Nl(O(),L))return!1}catch{return!1}}if(x=p.child,p.subtreeFlags&16384&&x!==null)x.return=p,p=x;else{if(p===h)break;for(;p.sibling===null;){if(p.return===null||p.return===h)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function so(h,p,x,A){p&=~F1,p&=~Np,h.suspendedLanes|=p,h.pingedLanes&=~p,A&&(h.warmLanes|=p),A=h.expirationTimes;for(var L=p;0<L;){var O=31-Se(L),Q=1<<O;A[O]=-1,L&=~Q}x!==0&&Bt(h,x,p)}function ah(){return(pi&6)===0?(Yn(0),!1):!0}function Fp(){if(sr!==null){if(Ir===0)var h=sr.return;else h=sr,Zh=bp=null,JA(h),ig=null,rg=0,h=sr;for(;h!==null;)Bu(h.alternate,h),h=h.return;sr=null}}function Lp(h,p){var x=h.timeoutHandle;x!==-1&&(h.timeoutHandle=-1,zSe(x)),x=h.cancelPendingCommit,x!==null&&(h.cancelPendingCommit=null,x()),Pc=0,Fp(),ki=h,sr=x=tu(h.current,null),nr=p,Ir=0,dl=null,Rc=!1,sh=z(h,p),wT=!1,js=Ol=F1=Np=nd=pa=0,Pa=mg=null,Da=!1,(p&8)!==0&&(p|=p&32);var A=h.entangledLanes;if(A!==0)for(h=h.entanglements,A&=p;0<A;){var L=31-Se(A),O=1<<L;p|=h[L],A&=~O}return Lu=p,m1(),x}function id(h,p){Ki=null,j.H=J0,p===Qm||p===rr?(p=tg(),Ir=3):p===x1?(p=tg(),Ir=4):Ir=p===y_?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,dl=p,sr===null&&(pa=1,g_(h,Ru(p,h.current)))}function ga(){var h=ru.current;return h===null?!0:(nr&4194048)===nr?Ll===null:(nr&62914560)===nr||(nr&536870912)!==0?h===Ll:!1}function xf(){var h=j.H;return j.H=J0,h===null?J0:h}function Ip(){var h=j.A;return j.A=vf,h}function ry(){pa=4,Rc||(nr&4194048)!==nr&&ru.current!==null||(sh=!0),(nd&134217727)===0&&(Np&134217727)===0||ki===null||so(ki,nr,Ol,!1)}function Ul(h,p,x){var A=pi;pi|=2;var L=xf(),O=Ip();(ki!==h||nr!==p)&&(ma=null,Lp(h,p)),p=!1;var Q=pa;e:do try{if(Ir!==0&&sr!==null){var pe=sr,Ve=dl;switch(Ir){case 8:Fp(),Q=6;break e;case 3:case 2:case 9:case 6:ru.current===null&&(p=!0);var xt=Ir;if(Ir=0,dl=null,yg(h,pe,Ve,xt),x&&sh){Q=0;break e}break;default:xt=Ir,Ir=0,dl=null,yg(h,pe,Ve,xt)}}sy(),Q=pa;break}catch(Ht){id(h,Ht)}while(!0);return p&&h.shellSuspendCounter++,Zh=bp=null,pi=A,j.H=L,j.A=O,sr===null&&(ki=null,nr=0,m1()),Q}function sy(){for(;sr!==null;)P_(sr)}function I1(h,p){var x=pi;pi|=2;var A=xf(),L=Ip();ki!==h||nr!==p?(ma=null,Xa=ee()+500,Lp(h,p)):sh=z(h,p);e:do try{if(Ir!==0&&sr!==null){p=sr;var O=dl;t:switch(Ir){case 1:Ir=0,dl=null,yg(h,p,O,1);break;case 2:case 9:if(iu(O)){Ir=0,dl=null,G1(p);break}p=function(){Ir!==2&&Ir!==9||ki!==h||(Ir=7),mn(h)},O.then(p,p);break e;case 3:Ir=7;break e;case 4:Ir=5;break e;case 7:iu(O)?(Ir=0,dl=null,G1(p)):(Ir=0,dl=null,yg(h,p,O,7));break;case 5:var Q=null;switch(sr.tag){case 26:Q=sr.memoizedState;case 5:case 27:var pe=sr;if(Q?dX(Q):pe.stateNode.complete){Ir=0,dl=null;var Ve=pe.sibling;if(Ve!==null)sr=Ve;else{var xt=pe.return;xt!==null?(sr=xt,Gp(xt)):sr=null}break t}}Ir=0,dl=null,yg(h,p,O,5);break;case 6:Ir=0,dl=null,yg(h,p,O,6);break;case 8:Fp(),pa=6;break e;default:throw Error(i(462))}}cu();break}catch(Ht){id(h,Ht)}while(!0);return Zh=bp=null,j.H=A,j.A=L,pi=x,sr!==null?0:(ki=null,nr=0,m1(),pa)}function cu(){for(;sr!==null&&!Zt();)P_(sr)}function P_(h){var p=T_(h.alternate,h,Lu);h.memoizedProps=h.pendingProps,p===null?Gp(h):sr=p}function G1(h){var p=h,x=p.alternate;switch(p.tag){case 15:case 0:p=E1(x,p,p.pendingProps,p.type,void 0,nr);break;case 11:p=E1(x,p,p.pendingProps,p.type.render,p.ref,nr);break;case 5:JA(p);default:Bu(x,p),p=sr=G0(p,Lu),p=T_(x,p,Lu)}h.memoizedProps=h.pendingProps,p===null?Gp(h):sr=p}function yg(h,p,x,A){Zh=bp=null,JA(p),ig=null,rg=0;var L=p.return;try{if(vo(h,L,p,x,nr)){pa=1,g_(h,Ru(x,h.current)),sr=null;return}}catch(O){if(L!==null)throw sr=L,O;pa=1,g_(h,Ru(x,h.current)),sr=null;return}p.flags&32768?(Rr||A===1?h=!0:sh||(nr&536870912)!==0?h=!1:(Rc=h=!0,(A===2||A===9||A===3||A===6)&&(A=ru.current,A!==null&&A.tag===13&&(A.flags|=16384))),O1(p,h)):Gp(p)}function Gp(h){var p=h;do{if((p.flags&32768)!==0){O1(p,Rc);return}h=p.return;var x=D1(p.alternate,p,Lu);if(x!==null){sr=x;return}if(p=p.sibling,p!==null){sr=p;return}sr=p=h}while(p!==null);pa===0&&(pa=5)}function O1(h,p){do{var x=Mc(h.alternate,h);if(x!==null){x.flags&=32767,sr=x;return}if(x=h.return,x!==null&&(x.flags|=32768,x.subtreeFlags=0,x.deletions=null),!p&&(h=h.sibling,h!==null)){sr=h;return}sr=h=x}while(h!==null);pa=6,sr=null}function bf(h,p,x,A,L,O,Q,pe,Ve){h.cancelPendingCommit=null;do ay();while(gs!==0);if((pi&6)!==0)throw Error(i(327));if(p!==null){if(p===h.current)throw Error(i(177));if(O=p.lanes|p.childLanes,O|=No,pt(h,x,O,Q,pe,Ve),h===ki&&(sr=ki=null,nr=0),ty=p,Iu=h,Pc=x,ny=O,iy=L,L1=A,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(h.callbackNode=null,h.callbackPriority=0,k(at,function(){return D_(),null})):(h.callbackNode=null,h.callbackPriority=0),A=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||A){A=j.T,j.T=null,L=te.p,te.p=2,Q=pi,pi|=4;try{xI(h,p,x)}finally{pi=Q,te.p=L,j.T=A}}gs=1,ao(),_f(),vg()}}function ao(){if(gs===1){gs=0;var h=Iu,p=ty,x=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||x){x=j.T,j.T=null;var A=te.p;te.p=2;var L=pi;pi|=4;try{Rp(p,h);var O=CI,Q=l3(h.containerInfo),pe=O.focusedElem,Ve=O.selectionRange;if(Q!==pe&&pe&&pe.ownerDocument&&Fs(pe.ownerDocument.documentElement,pe)){if(Ve!==null&&BA(pe)){var xt=Ve.start,Ht=Ve.end;if(Ht===void 0&&(Ht=xt),"selectionStart"in pe)pe.selectionStart=xt,pe.selectionEnd=Math.min(Ht,pe.value.length);else{var $t=pe.ownerDocument||document,Mt=$t&&$t.defaultView||window;if(Mt.getSelection){var Dt=Mt.getSelection(),ii=pe.textContent.length,Pi=Math.min(Ve.start,ii),Os=Ve.end===void 0?Pi:Math.min(Ve.end,ii);!Dt.extend&&Pi>Os&&(Q=Os,Os=Pi,Pi=Q);var lt=F0(pe,Pi),Qe=F0(pe,Os);if(lt&&Qe&&(Dt.rangeCount!==1||Dt.anchorNode!==lt.node||Dt.anchorOffset!==lt.offset||Dt.focusNode!==Qe.node||Dt.focusOffset!==Qe.offset)){var vt=$t.createRange();vt.setStart(lt.node,lt.offset),Dt.removeAllRanges(),Pi>Os?(Dt.addRange(vt),Dt.extend(Qe.node,Qe.offset)):(vt.setEnd(Qe.node,Qe.offset),Dt.addRange(vt))}}}}for($t=[],Dt=pe;Dt=Dt.parentNode;)Dt.nodeType===1&&$t.push({element:Dt,left:Dt.scrollLeft,top:Dt.scrollTop});for(typeof pe.focus=="function"&&pe.focus(),pe=0;pe<$t.length;pe++){var Xt=$t[pe];Xt.element.scrollLeft=Xt.left,Xt.element.scrollTop=Xt.top}}gP=!!TI,CI=TI=null}finally{pi=L,te.p=A,j.T=x}}h.current=p,gs=2}}function _f(){if(gs===2){gs=0;var h=Iu,p=ty,x=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||x){x=j.T,j.T=null;var A=te.p;te.p=2;var L=pi;pi|=4;try{ia(h,p.alternate,p)}finally{pi=L,te.p=A,j.T=x}}gs=3}}function vg(){if(gs===4||gs===3){gs=0,le();var h=Iu,p=ty,x=Pc,A=L1;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?gs=5:(gs=0,ty=Iu=null,rd(h,h.pendingLanes));var L=h.pendingLanes;if(L===0&&(Wa=null),er(x),p=p.stateNode,st&&typeof st.onCommitFiberRoot=="function")try{st.onCommitFiberRoot(Gt,p,void 0,(p.current.flags&128)===128)}catch{}if(A!==null){p=j.T,L=te.p,te.p=2,j.T=null;try{for(var O=h.onRecoverableError,Q=0;Q<A.length;Q++){var pe=A[Q];O(pe.value,{componentStack:pe.stack})}}finally{j.T=p,te.p=L}}(Pc&3)!==0&&ay(),mn(h),L=h.pendingLanes,(x&261930)!==0&&(L&42)!==0?h===gg?Bp++:(Bp=0,gg=h):Bp=0,Yn(0)}}function rd(h,p){(h.pooledCacheLanes&=p)===0&&(p=h.pooledCache,p!=null&&(h.pooledCache=null,qm(p)))}function ay(){return ao(),_f(),vg(),D_()}function D_(){if(gs!==5)return!1;var h=Iu,p=ny;ny=0;var x=er(Pc),A=j.T,L=te.p;try{te.p=32>x?32:x,j.T=null,x=iy,iy=null;var O=Iu,Q=Pc;if(gs=0,ty=Iu=null,Pc=0,(pi&6)!==0)throw Error(i(331));var pe=pi;if(pi|=4,lu(O.current),CT(O,O.current,Q,x),pi=pe,Yn(0,!1),st&&typeof st.onPostCommitFiberRoot=="function")try{st.onPostCommitFiberRoot(Gt,O)}catch{}return!0}finally{te.p=L,j.T=A,rd(h,p)}}function RT(h,p,x){p=Ru(x,p),p=xT(h.stateNode,p,2),h=Mp(h,p,2),h!==null&&(be(h,2),mn(h))}function Kr(h,p,x){if(h.tag===3)RT(h,h,x);else for(;p!==null;){if(p.tag===3){RT(p,h,x);break}else if(p.tag===1){var A=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(Wa===null||!Wa.has(A))){h=Ru(x,h),x=bT(2),A=Mp(p,x,2),A!==null&&(tP(x,A,p,h),be(A,2),mn(A));break}}p=p.return}}function U1(h,p,x){var A=h.pingCache;if(A===null){A=h.pingCache=new $i;var L=new Set;A.set(p,L)}else L=A.get(p),L===void 0&&(L=new Set,A.set(p,L));L.has(x)||(wT=!0,L.add(x),h=g.bind(null,h,p,x),p.then(h,h))}function g(h,p,x){var A=h.pingCache;A!==null&&A.delete(p),h.pingedLanes|=h.suspendedLanes&x,h.warmLanes&=~x,ki===h&&(nr&x)===x&&(pa===4||pa===3&&(nr&62914560)===nr&&300>ee()-ey?(pi&2)===0&&Lp(h,0):F1|=x,js===nr&&(js=0)),mn(h)}function v(h,p){p===0&&(p=ne()),h=Bl(h,p),h!==null&&(be(h,p),mn(h))}function C(h){var p=h.memoizedState,x=0;p!==null&&(x=p.retryLane),v(h,x)}function D(h,p){var x=0;switch(h.tag){case 31:case 13:var A=h.stateNode,L=h.memoizedState;L!==null&&(x=L.retryLane);break;case 19:A=h.stateNode;break;case 22:A=h.stateNode._retryCache;break;default:throw Error(i(314))}A!==null&&A.delete(p),v(h,x)}function k(h,p){return cn(h,p)}var X=null,fe=null,Xe=!1,Rt=!1,an=!1,Pn=0;function mn(h){h!==fe&&h.next===null&&(fe===null?X=fe=h:fe=fe.next=h),Rt=!0,Xe||(Xe=!0,ct())}function Yn(h,p){if(!an&&Rt){an=!0;do for(var x=!1,A=X;A!==null;){if(h!==0){var L=A.pendingLanes;if(L===0)var O=0;else{var Q=A.suspendedLanes,pe=A.pingedLanes;O=(1<<31-Se(42|h)+1)-1,O&=L&~(Q&~pe),O=O&201326741?O&201326741|1:O?O|2:0}O!==0&&(x=!0,_t(A,O))}else O=nr,O=Ut(A,A===ki?O:0,A.cancelPendingCommit!==null||A.timeoutHandle!==-1),(O&3)===0||z(A,O)||(x=!0,_t(A,O));A=A.next}while(x);an=!1}}function ji(){Za()}function Za(){Rt=Xe=!1;var h=0;Pn!==0&&kSe()&&(h=Pn);for(var p=ee(),x=null,A=X;A!==null;){var L=A.next,O=oy(A,p);O===0?(A.next=null,x===null?X=L:x.next=L,L===null&&(fe=x)):(x=A,(h!==0||(O&3)!==0)&&(Rt=!0)),A=L}gs!==0&&gs!==5||Yn(h),Pn!==0&&(Pn=0)}function oy(h,p){for(var x=h.suspendedLanes,A=h.pingedLanes,L=h.expirationTimes,O=h.pendingLanes&-62914561;0<O;){var Q=31-Se(O),pe=1<<Q,Ve=L[Q];Ve===-1?((pe&x)===0||(pe&A)!==0)&&(L[Q]=se(pe,p)):Ve<=p&&(h.expiredLanes|=pe),O&=~pe}if(p=ki,x=nr,x=Ut(h,h===p?x:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),A=h.callbackNode,x===0||h===p&&(Ir===2||Ir===9)||h.cancelPendingCommit!==null)return A!==null&&A!==null&&In(A),h.callbackNode=null,h.callbackPriority=0;if((x&3)===0||z(h,x)){if(p=x&-x,p===h.callbackPriority)return p;switch(A!==null&&In(A),er(x)){case 2:case 8:x=et;break;case 32:x=at;break;case 268435456:x=rn;break;default:x=at}return A=Op.bind(null,h),x=cn(x,A),h.callbackPriority=p,h.callbackNode=x,p}return A!==null&&A!==null&&In(A),h.callbackPriority=2,h.callbackNode=null,2}function Op(h,p){if(gs!==0&&gs!==5)return h.callbackNode=null,h.callbackPriority=0,null;var x=h.callbackNode;if(ay()&&h.callbackNode!==x)return null;var A=nr;return A=Ut(h,h===ki?A:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),A===0?null:(yr(h,A,p),oy(h,ee()),h.callbackNode!=null&&h.callbackNode===x?Op.bind(null,h):null)}function _t(h,p){if(ay())return null;yr(h,p,!0)}function ct(){VSe(function(){(pi&6)!==0?cn(tt,ji):Za()})}function Et(){if(Pn===0){var h=cf;h===0&&(h=it,it<<=1,(it&261888)===0&&(it=256)),Pn=h}return Pn}function wn(h){return h==null||typeof h=="symbol"||typeof h=="boolean"?null:typeof h=="function"?h:lc(""+h)}function Si(h,p){var x=p.ownerDocument.createElement("input");return x.name=p.name,x.value=p.value,h.id&&x.setAttribute("form",h.id),p.parentNode.insertBefore(x,p),h=new FormData(h),x.parentNode.removeChild(x),h}function ya(h,p,x,A,L){if(p==="submit"&&x&&x.stateNode===L){var O=wn((L[ie]||null).action),Q=A.submitter;Q&&(p=(p=Q[ie]||null)?wn(p.formAction):Q.getAttribute("formAction"),p!==null&&(O=p,Q=null));var pe=new Qd("action","action",null,A,L);h.push({event:pe,listeners:[{instance:null,listener:function(){if(A.defaultPrevented){if(Pn!==0){var Ve=Q?Si(L,Q):new FormData(L);hT(x,{pending:!0,data:Ve,method:L.method,action:O},null,Ve)}}else typeof O=="function"&&(pe.preventDefault(),Ve=Q?Si(L,Q):new FormData(L),hT(x,{pending:!0,data:Ve,method:L.method,action:O},O,Ve))},currentTarget:L}]})}}for(var Ai=0;Ai<f1.length;Ai++){var Hr=f1[Ai],Go=Hr.toLowerCase(),is=Hr[0].toUpperCase()+Hr.slice(1);gc(Go,"on"+is)}gc(Xb,"onAnimationEnd"),gc(d1,"onAnimationIteration"),gc(LA,"onAnimationStart"),gc("dblclick","onDoubleClick"),gc("focusin","onFocus"),gc("focusout","onBlur"),gc(c3,"onTransitionRun"),gc(hI,"onTransitionStart"),gc(h3,"onTransitionCancel"),gc(IA,"onTransitionEnd"),Ze("onMouseEnter",["mouseout","mouseover"]),Ze("onMouseLeave",["mouseout","mouseover"]),Ze("onPointerEnter",["pointerout","pointerover"]),Ze("onPointerLeave",["pointerout","pointerover"]),Ke("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ke("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ke("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ke("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ke("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ke("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bI=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Dc));function H8(h,p){p=(p&4)!==0;for(var x=0;x<h.length;x++){var A=h[x],L=A.event;A=A.listeners;e:{var O=void 0;if(p)for(var Q=A.length-1;0<=Q;Q--){var pe=A[Q],Ve=pe.instance,xt=pe.currentTarget;if(pe=pe.listener,Ve!==O&&L.isPropagationStopped())break e;O=pe,L.currentTarget=xt;try{O(L)}catch(Ht){p1(Ht)}L.currentTarget=null,O=Ve}else for(Q=0;Q<A.length;Q++){if(pe=A[Q],Ve=pe.instance,xt=pe.currentTarget,pe=pe.listener,Ve!==O&&L.isPropagationStopped())break e;O=pe,L.currentTarget=xt;try{O(L)}catch(Ht){p1(Ht)}L.currentTarget=null,O=Ve}}}}function Gr(h,p){var x=p[Ue];x===void 0&&(x=p[Ue]=new Set);var A=h+"__bubble";x.has(A)||(X8(p,h,2,!1),x.add(A))}function _I(h,p,x){var A=0;p&&(A|=4),X8(x,h,A,p)}var oP="_reactListening"+Math.random().toString(36).slice(2);function SI(h){if(!h[oP]){h[oP]=!0,Fe.forEach(function(x){x!=="selectionchange"&&(bI.has(x)||_I(x,!1,h),_I(x,!0,h))});var p=h.nodeType===9?h:h.ownerDocument;p===null||p[oP]||(p[oP]=!0,_I("selectionchange",!1,p))}}function X8(h,p,x,A){switch(xX(p)){case 2:var L=lMe;break;case 8:L=uMe;break;default:L=GI}x=L.bind(null,p,x,h),L=void 0,!ni||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(L=!0),A?L!==void 0?h.addEventListener(p,x,{capture:!0,passive:L}):h.addEventListener(p,x,!0):L!==void 0?h.addEventListener(p,x,{passive:L}):h.addEventListener(p,x,!1)}function MI(h,p,x,A,L){var O=A;if((p&1)===0&&(p&2)===0&&A!==null)e:for(;;){if(A===null)return;var Q=A.tag;if(Q===3||Q===4){var pe=A.stateNode.containerInfo;if(pe===L)break;if(Q===4)for(Q=A.return;Q!==null;){var Ve=Q.tag;if((Ve===3||Ve===4)&&Q.stateNode.containerInfo===L)return;Q=Q.return}for(;pe!==null;){if(Q=on(pe),Q===null)return;if(Ve=Q.tag,Ve===5||Ve===6||Ve===26||Ve===27){A=O=Q;continue e}pe=pe.parentNode}}A=A.return}Jc(function(){var xt=O,Ht=uc(x),$t=[];e:{var Mt=mc.get(h);if(Mt!==void 0){var Dt=Qd,ii=h;switch(h){case"keypress":if(qc(x)===0)break e;case"keydown":case"keyup":Dt=Po;break;case"focusin":ii="focus",Dt=ef;break;case"focusout":ii="blur",Dt=ef;break;case"beforeblur":case"afterblur":Dt=ef;break;case"click":if(x.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Dt=Eu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Dt=D0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Dt=Ym;break;case Xb:case d1:case LA:Dt=th;break;case IA:Dt=u1;break;case"scroll":case"scrollend":Dt=ci;break;case"wheel":Dt=$m;break;case"copy":case"cut":case"paste":Dt=Xm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Dt=jm;break;case"toggle":case"beforetoggle":Dt=H}var Pi=(p&4)!==0,Os=!Pi&&(h==="scroll"||h==="scrollend"),lt=Pi?Mt!==null?Mt+"Capture":null:Mt;Pi=[];for(var Qe=xt,vt;Qe!==null;){var Xt=Qe;if(vt=Xt.stateNode,Xt=Xt.tag,Xt!==5&&Xt!==26&&Xt!==27||vt===null||lt===null||(Xt=hc(Qe,lt),Xt!=null&&Pi.push(PT(Qe,Xt,vt))),Os)break;Qe=Qe.return}0<Pi.length&&(Mt=new Dt(Mt,ii,null,x,Ht),$t.push({event:Mt,listeners:Pi}))}}if((p&7)===0){e:{if(Mt=h==="mouseover"||h==="pointerover",Dt=h==="mouseout"||h==="pointerout",Mt&&x!==ql&&(ii=x.relatedTarget||x.fromElement)&&(on(ii)||ii[ye]))break e;if((Dt||Mt)&&(Mt=Ht.window===Ht?Ht:(Mt=Ht.ownerDocument)?Mt.defaultView||Mt.parentWindow:window,Dt?(ii=x.relatedTarget||x.toElement,Dt=xt,ii=ii?on(ii):null,ii!==null&&(Os=s(ii),Pi=ii.tag,ii!==Os||Pi!==5&&Pi!==27&&Pi!==6)&&(ii=null)):(Dt=null,ii=xt),Dt!==ii)){if(Pi=Eu,Xt="onMouseLeave",lt="onMouseEnter",Qe="mouse",(h==="pointerout"||h==="pointerover")&&(Pi=jm,Xt="onPointerLeave",lt="onPointerEnter",Qe="pointer"),Os=Dt==null?Mt:gn(Dt),vt=ii==null?Mt:gn(ii),Mt=new Pi(Xt,Qe+"leave",Dt,x,Ht),Mt.target=Os,Mt.relatedTarget=vt,Xt=null,on(Ht)===xt&&(Pi=new Pi(lt,Qe+"enter",ii,x,Ht),Pi.target=vt,Pi.relatedTarget=Os,Xt=Pi),Os=Xt,Dt&&ii)t:{for(Pi=LSe,lt=Dt,Qe=ii,vt=0,Xt=lt;Xt;Xt=Pi(Xt))vt++;Xt=0;for(var _i=Qe;_i;_i=Pi(_i))Xt++;for(;0<vt-Xt;)lt=Pi(lt),vt--;for(;0<Xt-vt;)Qe=Pi(Qe),Xt--;for(;vt--;){if(lt===Qe||Qe!==null&&lt===Qe.alternate){Pi=lt;break t}lt=Pi(lt),Qe=Pi(Qe)}Pi=null}else Pi=null;Dt!==null&&W8($t,Mt,Dt,Pi,!1),ii!==null&&Os!==null&&W8($t,Os,ii,Pi,!0)}}e:{if(Mt=xt?gn(xt):window,Dt=Mt.nodeName&&Mt.nodeName.toLowerCase(),Dt==="select"||Dt==="input"&&Mt.type==="file")var os=mr;else if(Hi(Mt))if(ns)os=rf;else{os=Yr;var hi=li}else Dt=Mt.nodeName,!Dt||Dt.toLowerCase()!=="input"||Mt.type!=="checkbox"&&Mt.type!=="radio"?xt&&ai(xt.elementType)&&(os=mr):os=eu;if(os&&(os=os(h,xt))){ts($t,os,x,Ht);break e}hi&&hi(h,Mt,xt),h==="focusout"&&xt&&Mt.type==="number"&&xt.memoizedProps.value!=null&&Wi(Mt,"number",Mt.value)}switch(hi=xt?gn(xt):window,h){case"focusin":(Hi(hi)||hi.contentEditable==="true")&&(Uh=hi,kh=xt,L0=null);break;case"focusout":L0=kh=Uh=null;break;case"mousedown":Hb=!0;break;case"contextmenu":case"mouseup":case"dragend":Hb=!1,I0($t,x,Ht);break;case"selectionchange":if(u3)break;case"keydown":case"keyup":I0($t,x,Ht)}var cr;if(oe)e:{switch(h){case"compositionstart":var Xr="onCompositionStart";break e;case"compositionend":Xr="onCompositionEnd";break e;case"compositionupdate":Xr="onCompositionUpdate";break e}Xr=void 0}else fi?un(h,x)&&(Xr="onCompositionEnd"):h==="keydown"&&x.keyCode===229&&(Xr="onCompositionStart");Xr&&(Ee&&x.locale!=="ko"&&(fi||Xr!=="onCompositionStart"?Xr==="onCompositionEnd"&&fi&&(cr=Ih()):(Ro=Ht,al="value"in Ro?Ro.value:Ro.textContent,fi=!0)),hi=lP(xt,Xr),0<hi.length&&(Xr=new hp(Xr,h,null,x,Ht),$t.push({event:Xr,listeners:hi}),cr?Xr.data=cr:(cr=Cn(x),cr!==null&&(Xr.data=cr)))),(cr=De?oi(h,x):Gn(h,x))&&(Xr=lP(xt,"onBeforeInput"),0<Xr.length&&(hi=new hp("onBeforeInput","beforeinput",null,x,Ht),$t.push({event:hi,listeners:Xr}),hi.data=cr)),ya($t,h,xt,x,Ht)}H8($t,p)})}function PT(h,p,x){return{instance:h,listener:p,currentTarget:x}}function lP(h,p){for(var x=p+"Capture",A=[];h!==null;){var L=h,O=L.stateNode;if(L=L.tag,L!==5&&L!==26&&L!==27||O===null||(L=hc(h,x),L!=null&&A.unshift(PT(h,L,O)),L=hc(h,p),L!=null&&A.push(PT(h,L,O))),h.tag===3)return A;h=h.return}return[]}function LSe(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5&&h.tag!==27);return h||null}function W8(h,p,x,A,L){for(var O=p._reactName,Q=[];x!==null&&x!==A;){var pe=x,Ve=pe.alternate,xt=pe.stateNode;if(pe=pe.tag,Ve!==null&&Ve===A)break;pe!==5&&pe!==26&&pe!==27||xt===null||(Ve=xt,L?(xt=hc(x,O),xt!=null&&Q.unshift(PT(x,xt,Ve))):L||(xt=hc(x,O),xt!=null&&Q.push(PT(x,xt,Ve)))),x=x.return}Q.length!==0&&h.push({event:p,listeners:Q})}var ISe=/\r\n?/g,GSe=/\u0000|\uFFFD/g;function Z8(h){return(typeof h=="string"?h:""+h).replace(ISe,`
`).replace(GSe,"")}function j8(h,p){return p=Z8(p),Z8(h)===p}function Gs(h,p,x,A,L,O){switch(x){case"children":typeof A=="string"?p==="body"||p==="textarea"&&A===""||Ws(h,A):(typeof A=="number"||typeof A=="bigint")&&p!=="body"&&Ws(h,""+A);break;case"className":jn(h,"class",A);break;case"tabIndex":jn(h,"tabindex",A);break;case"dir":case"role":case"viewBox":case"width":case"height":jn(h,x,A);break;case"style":Te(h,A,O);break;case"data":if(p!=="object"){jn(h,"data",A);break}case"src":case"href":if(A===""&&(p!=="a"||x!=="href")){h.removeAttribute(x);break}if(A==null||typeof A=="function"||typeof A=="symbol"||typeof A=="boolean"){h.removeAttribute(x);break}A=lc(""+A),h.setAttribute(x,A);break;case"action":case"formAction":if(typeof A=="function"){h.setAttribute(x,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof O=="function"&&(x==="formAction"?(p!=="input"&&Gs(h,p,"name",L.name,L,null),Gs(h,p,"formEncType",L.formEncType,L,null),Gs(h,p,"formMethod",L.formMethod,L,null),Gs(h,p,"formTarget",L.formTarget,L,null)):(Gs(h,p,"encType",L.encType,L,null),Gs(h,p,"method",L.method,L,null),Gs(h,p,"target",L.target,L,null)));if(A==null||typeof A=="symbol"||typeof A=="boolean"){h.removeAttribute(x);break}A=lc(""+A),h.setAttribute(x,A);break;case"onClick":A!=null&&(h.onclick=$n);break;case"onScroll":A!=null&&Gr("scroll",h);break;case"onScrollEnd":A!=null&&Gr("scrollend",h);break;case"dangerouslySetInnerHTML":if(A!=null){if(typeof A!="object"||!("__html"in A))throw Error(i(61));if(x=A.__html,x!=null){if(L.children!=null)throw Error(i(60));h.innerHTML=x}}break;case"multiple":h.multiple=A&&typeof A!="function"&&typeof A!="symbol";break;case"muted":h.muted=A&&typeof A!="function"&&typeof A!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(A==null||typeof A=="function"||typeof A=="boolean"||typeof A=="symbol"){h.removeAttribute("xlink:href");break}x=lc(""+A),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",x);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":A!=null&&typeof A!="function"&&typeof A!="symbol"?h.setAttribute(x,""+A):h.removeAttribute(x);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":A&&typeof A!="function"&&typeof A!="symbol"?h.setAttribute(x,""):h.removeAttribute(x);break;case"capture":case"download":A===!0?h.setAttribute(x,""):A!==!1&&A!=null&&typeof A!="function"&&typeof A!="symbol"?h.setAttribute(x,A):h.removeAttribute(x);break;case"cols":case"rows":case"size":case"span":A!=null&&typeof A!="function"&&typeof A!="symbol"&&!isNaN(A)&&1<=A?h.setAttribute(x,A):h.removeAttribute(x);break;case"rowSpan":case"start":A==null||typeof A=="function"||typeof A=="symbol"||isNaN(A)?h.removeAttribute(x):h.setAttribute(x,A);break;case"popover":Gr("beforetoggle",h),Gr("toggle",h),yn(h,"popover",A);break;case"xlinkActuate":bn(h,"http://www.w3.org/1999/xlink","xlink:actuate",A);break;case"xlinkArcrole":bn(h,"http://www.w3.org/1999/xlink","xlink:arcrole",A);break;case"xlinkRole":bn(h,"http://www.w3.org/1999/xlink","xlink:role",A);break;case"xlinkShow":bn(h,"http://www.w3.org/1999/xlink","xlink:show",A);break;case"xlinkTitle":bn(h,"http://www.w3.org/1999/xlink","xlink:title",A);break;case"xlinkType":bn(h,"http://www.w3.org/1999/xlink","xlink:type",A);break;case"xmlBase":bn(h,"http://www.w3.org/XML/1998/namespace","xml:base",A);break;case"xmlLang":bn(h,"http://www.w3.org/XML/1998/namespace","xml:lang",A);break;case"xmlSpace":bn(h,"http://www.w3.org/XML/1998/namespace","xml:space",A);break;case"is":yn(h,"is",A);break;case"innerText":case"textContent":break;default:(!(2<x.length)||x[0]!=="o"&&x[0]!=="O"||x[1]!=="n"&&x[1]!=="N")&&(x=$c.get(x)||x,yn(h,x,A))}}function AI(h,p,x,A,L,O){switch(x){case"style":Te(h,A,O);break;case"dangerouslySetInnerHTML":if(A!=null){if(typeof A!="object"||!("__html"in A))throw Error(i(61));if(x=A.__html,x!=null){if(L.children!=null)throw Error(i(60));h.innerHTML=x}}break;case"children":typeof A=="string"?Ws(h,A):(typeof A=="number"||typeof A=="bigint")&&Ws(h,""+A);break;case"onScroll":A!=null&&Gr("scroll",h);break;case"onScrollEnd":A!=null&&Gr("scrollend",h);break;case"onClick":A!=null&&(h.onclick=$n);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$e.hasOwnProperty(x))e:{if(x[0]==="o"&&x[1]==="n"&&(L=x.endsWith("Capture"),p=x.slice(2,L?x.length-7:void 0),O=h[ie]||null,O=O!=null?O[x]:null,typeof O=="function"&&h.removeEventListener(p,O,L),typeof A=="function")){typeof O!="function"&&O!==null&&(x in h?h[x]=null:h.hasAttribute(x)&&h.removeAttribute(x)),h.addEventListener(p,A,L);break e}x in h?h[x]=A:A===!0?h.setAttribute(x,""):yn(h,x,A)}}}function kl(h,p,x){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Gr("error",h),Gr("load",h);var A=!1,L=!1,O;for(O in x)if(x.hasOwnProperty(O)){var Q=x[O];if(Q!=null)switch(O){case"src":A=!0;break;case"srcSet":L=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,p));default:Gs(h,p,O,Q,x,null)}}L&&Gs(h,p,"srcSet",x.srcSet,x,null),A&&Gs(h,p,"src",x.src,x,null);return;case"input":Gr("invalid",h);var pe=O=Q=L=null,Ve=null,xt=null;for(A in x)if(x.hasOwnProperty(A)){var Ht=x[A];if(Ht!=null)switch(A){case"name":L=Ht;break;case"type":Q=Ht;break;case"checked":Ve=Ht;break;case"defaultChecked":xt=Ht;break;case"value":O=Ht;break;case"defaultValue":pe=Ht;break;case"children":case"dangerouslySetInnerHTML":if(Ht!=null)throw Error(i(137,p));break;default:Gs(h,p,A,Ht,x,null)}}qs(h,O,pe,Ve,xt,Q,L,!1);return;case"select":Gr("invalid",h),A=Q=O=null;for(L in x)if(x.hasOwnProperty(L)&&(pe=x[L],pe!=null))switch(L){case"value":O=pe;break;case"defaultValue":Q=pe;break;case"multiple":A=pe;default:Gs(h,p,L,pe,x,null)}p=O,x=Q,h.multiple=!!A,p!=null?Ss(h,!!A,p,!1):x!=null&&Ss(h,!!A,x,!0);return;case"textarea":Gr("invalid",h),O=L=A=null;for(Q in x)if(x.hasOwnProperty(Q)&&(pe=x[Q],pe!=null))switch(Q){case"value":A=pe;break;case"defaultValue":L=pe;break;case"children":O=pe;break;case"dangerouslySetInnerHTML":if(pe!=null)throw Error(i(91));break;default:Gs(h,p,Q,pe,x,null)}Qs(h,A,L,O);return;case"option":for(Ve in x)x.hasOwnProperty(Ve)&&(A=x[Ve],A!=null)&&(Ve==="selected"?h.selected=A&&typeof A!="function"&&typeof A!="symbol":Gs(h,p,Ve,A,x,null));return;case"dialog":Gr("beforetoggle",h),Gr("toggle",h),Gr("cancel",h),Gr("close",h);break;case"iframe":case"object":Gr("load",h);break;case"video":case"audio":for(A=0;A<Dc.length;A++)Gr(Dc[A],h);break;case"image":Gr("error",h),Gr("load",h);break;case"details":Gr("toggle",h);break;case"embed":case"source":case"link":Gr("error",h),Gr("load",h);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(xt in x)if(x.hasOwnProperty(xt)&&(A=x[xt],A!=null))switch(xt){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,p));default:Gs(h,p,xt,A,x,null)}return;default:if(ai(p)){for(Ht in x)x.hasOwnProperty(Ht)&&(A=x[Ht],A!==void 0&&AI(h,p,Ht,A,x,void 0));return}}for(pe in x)x.hasOwnProperty(pe)&&(A=x[pe],A!=null&&Gs(h,p,pe,A,x,null))}function OSe(h,p,x,A){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var L=null,O=null,Q=null,pe=null,Ve=null,xt=null,Ht=null;for(Dt in x){var $t=x[Dt];if(x.hasOwnProperty(Dt)&&$t!=null)switch(Dt){case"checked":break;case"value":break;case"defaultValue":Ve=$t;default:A.hasOwnProperty(Dt)||Gs(h,p,Dt,null,A,$t)}}for(var Mt in A){var Dt=A[Mt];if($t=x[Mt],A.hasOwnProperty(Mt)&&(Dt!=null||$t!=null))switch(Mt){case"type":O=Dt;break;case"name":L=Dt;break;case"checked":xt=Dt;break;case"defaultChecked":Ht=Dt;break;case"value":Q=Dt;break;case"defaultValue":pe=Dt;break;case"children":case"dangerouslySetInnerHTML":if(Dt!=null)throw Error(i(137,p));break;default:Dt!==$t&&Gs(h,p,Mt,Dt,A,$t)}}tr(h,Q,pe,Ve,xt,Ht,O,L);return;case"select":Dt=Q=pe=Mt=null;for(O in x)if(Ve=x[O],x.hasOwnProperty(O)&&Ve!=null)switch(O){case"value":break;case"multiple":Dt=Ve;default:A.hasOwnProperty(O)||Gs(h,p,O,null,A,Ve)}for(L in A)if(O=A[L],Ve=x[L],A.hasOwnProperty(L)&&(O!=null||Ve!=null))switch(L){case"value":Mt=O;break;case"defaultValue":pe=O;break;case"multiple":Q=O;default:O!==Ve&&Gs(h,p,L,O,A,Ve)}p=pe,x=Q,A=Dt,Mt!=null?Ss(h,!!x,Mt,!1):!!A!=!!x&&(p!=null?Ss(h,!!x,p,!0):Ss(h,!!x,x?[]:"",!1));return;case"textarea":Dt=Mt=null;for(pe in x)if(L=x[pe],x.hasOwnProperty(pe)&&L!=null&&!A.hasOwnProperty(pe))switch(pe){case"value":break;case"children":break;default:Gs(h,p,pe,null,A,L)}for(Q in A)if(L=A[Q],O=x[Q],A.hasOwnProperty(Q)&&(L!=null||O!=null))switch(Q){case"value":Mt=L;break;case"defaultValue":Dt=L;break;case"children":break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(i(91));break;default:L!==O&&Gs(h,p,Q,L,A,O)}Lr(h,Mt,Dt);return;case"option":for(var ii in x)Mt=x[ii],x.hasOwnProperty(ii)&&Mt!=null&&!A.hasOwnProperty(ii)&&(ii==="selected"?h.selected=!1:Gs(h,p,ii,null,A,Mt));for(Ve in A)Mt=A[Ve],Dt=x[Ve],A.hasOwnProperty(Ve)&&Mt!==Dt&&(Mt!=null||Dt!=null)&&(Ve==="selected"?h.selected=Mt&&typeof Mt!="function"&&typeof Mt!="symbol":Gs(h,p,Ve,Mt,A,Dt));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Pi in x)Mt=x[Pi],x.hasOwnProperty(Pi)&&Mt!=null&&!A.hasOwnProperty(Pi)&&Gs(h,p,Pi,null,A,Mt);for(xt in A)if(Mt=A[xt],Dt=x[xt],A.hasOwnProperty(xt)&&Mt!==Dt&&(Mt!=null||Dt!=null))switch(xt){case"children":case"dangerouslySetInnerHTML":if(Mt!=null)throw Error(i(137,p));break;default:Gs(h,p,xt,Mt,A,Dt)}return;default:if(ai(p)){for(var Os in x)Mt=x[Os],x.hasOwnProperty(Os)&&Mt!==void 0&&!A.hasOwnProperty(Os)&&AI(h,p,Os,void 0,A,Mt);for(Ht in A)Mt=A[Ht],Dt=x[Ht],!A.hasOwnProperty(Ht)||Mt===Dt||Mt===void 0&&Dt===void 0||AI(h,p,Ht,Mt,A,Dt);return}}for(var lt in x)Mt=x[lt],x.hasOwnProperty(lt)&&Mt!=null&&!A.hasOwnProperty(lt)&&Gs(h,p,lt,null,A,Mt);for($t in A)Mt=A[$t],Dt=x[$t],!A.hasOwnProperty($t)||Mt===Dt||Mt==null&&Dt==null||Gs(h,p,$t,Mt,A,Dt)}function Y8(h){switch(h){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function USe(){if(typeof performance.getEntriesByType=="function"){for(var h=0,p=0,x=performance.getEntriesByType("resource"),A=0;A<x.length;A++){var L=x[A],O=L.transferSize,Q=L.initiatorType,pe=L.duration;if(O&&pe&&Y8(Q)){for(Q=0,pe=L.responseEnd,A+=1;A<x.length;A++){var Ve=x[A],xt=Ve.startTime;if(xt>pe)break;var Ht=Ve.transferSize,$t=Ve.initiatorType;Ht&&Y8($t)&&(Ve=Ve.responseEnd,Q+=Ht*(Ve<pe?1:(pe-xt)/(Ve-xt)))}if(--A,p+=8*(O+Q)/(L.duration/1e3),h++,10<h)break}}if(0<h)return p/h/1e6}return navigator.connection&&(h=navigator.connection.downlink,typeof h=="number")?h:5}var TI=null,CI=null;function uP(h){return h.nodeType===9?h:h.ownerDocument}function K8(h){switch(h){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function $8(h,p){if(h===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return h===1&&p==="foreignObject"?0:h}function wI(h,p){return h==="textarea"||h==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var EI=null;function kSe(){var h=window.event;return h&&h.type==="popstate"?h===EI?!1:(EI=h,!0):(EI=null,!1)}var J8=typeof setTimeout=="function"?setTimeout:void 0,zSe=typeof clearTimeout=="function"?clearTimeout:void 0,q8=typeof Promise=="function"?Promise:void 0,VSe=typeof queueMicrotask=="function"?queueMicrotask:typeof q8<"u"?function(h){return q8.resolve(null).then(h).catch(HSe)}:J8;function HSe(h){setTimeout(function(){throw h})}function ly(h){return h==="head"}function Q8(h,p){var x=p,A=0;do{var L=x.nextSibling;if(h.removeChild(x),L&&L.nodeType===8)if(x=L.data,x==="/$"||x==="/&"){if(A===0){h.removeChild(L),L_(p);return}A--}else if(x==="$"||x==="$?"||x==="$~"||x==="$!"||x==="&")A++;else if(x==="html")DT(h.ownerDocument.documentElement);else if(x==="head"){x=h.ownerDocument.head,DT(x);for(var O=x.firstChild;O;){var Q=O.nextSibling,pe=O.nodeName;O[sn]||pe==="SCRIPT"||pe==="STYLE"||pe==="LINK"&&O.rel.toLowerCase()==="stylesheet"||x.removeChild(O),O=Q}}else x==="body"&&DT(h.ownerDocument.body);x=L}while(x);L_(p)}function eX(h,p){var x=h;h=0;do{var A=x.nextSibling;if(x.nodeType===1?p?(x._stashedDisplay=x.style.display,x.style.display="none"):(x.style.display=x._stashedDisplay||"",x.getAttribute("style")===""&&x.removeAttribute("style")):x.nodeType===3&&(p?(x._stashedText=x.nodeValue,x.nodeValue=""):x.nodeValue=x._stashedText||""),A&&A.nodeType===8)if(x=A.data,x==="/$"){if(h===0)break;h--}else x!=="$"&&x!=="$?"&&x!=="$~"&&x!=="$!"||h++;x=A}while(x)}function RI(h){var p=h.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var x=p;switch(p=p.nextSibling,x.nodeName){case"HTML":case"HEAD":case"BODY":RI(x),Qt(x);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(x.rel.toLowerCase()==="stylesheet")continue}h.removeChild(x)}}function XSe(h,p,x,A){for(;h.nodeType===1;){var L=x;if(h.nodeName.toLowerCase()!==p.toLowerCase()){if(!A&&(h.nodeName!=="INPUT"||h.type!=="hidden"))break}else if(A){if(!h[sn])switch(p){case"meta":if(!h.hasAttribute("itemprop"))break;return h;case"link":if(O=h.getAttribute("rel"),O==="stylesheet"&&h.hasAttribute("data-precedence"))break;if(O!==L.rel||h.getAttribute("href")!==(L.href==null||L.href===""?null:L.href)||h.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin)||h.getAttribute("title")!==(L.title==null?null:L.title))break;return h;case"style":if(h.hasAttribute("data-precedence"))break;return h;case"script":if(O=h.getAttribute("src"),(O!==(L.src==null?null:L.src)||h.getAttribute("type")!==(L.type==null?null:L.type)||h.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin))&&O&&h.hasAttribute("async")&&!h.hasAttribute("itemprop"))break;return h;default:return h}}else if(p==="input"&&h.type==="hidden"){var O=L.name==null?null:""+L.name;if(L.type==="hidden"&&h.getAttribute("name")===O)return h}else return h;if(h=sd(h.nextSibling),h===null)break}return null}function WSe(h,p,x){if(p==="")return null;for(;h.nodeType!==3;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!x||(h=sd(h.nextSibling),h===null))return null;return h}function tX(h,p){for(;h.nodeType!==8;)if((h.nodeType!==1||h.nodeName!=="INPUT"||h.type!=="hidden")&&!p||(h=sd(h.nextSibling),h===null))return null;return h}function PI(h){return h.data==="$?"||h.data==="$~"}function DI(h){return h.data==="$!"||h.data==="$?"&&h.ownerDocument.readyState!=="loading"}function ZSe(h,p){var x=h.ownerDocument;if(h.data==="$~")h._reactRetry=p;else if(h.data!=="$?"||x.readyState!=="loading")p();else{var A=function(){p(),x.removeEventListener("DOMContentLoaded",A)};x.addEventListener("DOMContentLoaded",A),h._reactRetry=A}}function sd(h){for(;h!=null;h=h.nextSibling){var p=h.nodeType;if(p===1||p===3)break;if(p===8){if(p=h.data,p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"||p==="F!"||p==="F")break;if(p==="/$"||p==="/&")return null}}return h}var NI=null;function nX(h){h=h.nextSibling;for(var p=0;h;){if(h.nodeType===8){var x=h.data;if(x==="/$"||x==="/&"){if(p===0)return sd(h.nextSibling);p--}else x!=="$"&&x!=="$!"&&x!=="$?"&&x!=="$~"&&x!=="&"||p++}h=h.nextSibling}return null}function iX(h){h=h.previousSibling;for(var p=0;h;){if(h.nodeType===8){var x=h.data;if(x==="$"||x==="$!"||x==="$?"||x==="$~"||x==="&"){if(p===0)return h;p--}else x!=="/$"&&x!=="/&"||p++}h=h.previousSibling}return null}function rX(h,p,x){switch(p=uP(x),h){case"html":if(h=p.documentElement,!h)throw Error(i(452));return h;case"head":if(h=p.head,!h)throw Error(i(453));return h;case"body":if(h=p.body,!h)throw Error(i(454));return h;default:throw Error(i(451))}}function DT(h){for(var p=h.attributes;p.length;)h.removeAttributeNode(p[0]);Qt(h)}var ad=new Map,sX=new Set;function cP(h){return typeof h.getRootNode=="function"?h.getRootNode():h.nodeType===9?h:h.ownerDocument}var xg=te.d;te.d={f:jSe,r:YSe,D:KSe,C:$Se,L:JSe,m:qSe,X:eMe,S:QSe,M:tMe};function jSe(){var h=xg.f(),p=ah();return h||p}function YSe(h){var p=ln(h);p!==null&&p.tag===5&&p.type==="form"?Z3(p):xg.r(h)}var N_=typeof document>"u"?null:document;function aX(h,p,x){var A=N_;if(A&&typeof p=="string"&&p){var L=Bn(p);L='link[rel="'+h+'"][href="'+L+'"]',typeof x=="string"&&(L+='[crossorigin="'+x+'"]'),sX.has(L)||(sX.add(L),h={rel:h,crossOrigin:x,href:p},A.querySelector(L)===null&&(p=A.createElement("link"),kl(p,"link",h),de(p),A.head.appendChild(p)))}}function KSe(h){xg.D(h),aX("dns-prefetch",h,null)}function $Se(h,p){xg.C(h,p),aX("preconnect",h,p)}function JSe(h,p,x){xg.L(h,p,x);var A=N_;if(A&&h&&p){var L='link[rel="preload"][as="'+Bn(p)+'"]';p==="image"&&x&&x.imageSrcSet?(L+='[imagesrcset="'+Bn(x.imageSrcSet)+'"]',typeof x.imageSizes=="string"&&(L+='[imagesizes="'+Bn(x.imageSizes)+'"]')):L+='[href="'+Bn(h)+'"]';var O=L;switch(p){case"style":O=B_(h);break;case"script":O=F_(h)}ad.has(O)||(h=d({rel:"preload",href:p==="image"&&x&&x.imageSrcSet?void 0:h,as:p},x),ad.set(O,h),A.querySelector(L)!==null||p==="style"&&A.querySelector(NT(O))||p==="script"&&A.querySelector(BT(O))||(p=A.createElement("link"),kl(p,"link",h),de(p),A.head.appendChild(p)))}}function qSe(h,p){xg.m(h,p);var x=N_;if(x&&h){var A=p&&typeof p.as=="string"?p.as:"script",L='link[rel="modulepreload"][as="'+Bn(A)+'"][href="'+Bn(h)+'"]',O=L;switch(A){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":O=F_(h)}if(!ad.has(O)&&(h=d({rel:"modulepreload",href:h},p),ad.set(O,h),x.querySelector(L)===null)){switch(A){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(x.querySelector(BT(O)))return}A=x.createElement("link"),kl(A,"link",h),de(A),x.head.appendChild(A)}}}function QSe(h,p,x){xg.S(h,p,x);var A=N_;if(A&&h){var L=fn(A).hoistableStyles,O=B_(h);p=p||"default";var Q=L.get(O);if(!Q){var pe={loading:0,preload:null};if(Q=A.querySelector(NT(O)))pe.loading=5;else{h=d({rel:"stylesheet",href:h,"data-precedence":p},x),(x=ad.get(O))&&BI(h,x);var Ve=Q=A.createElement("link");de(Ve),kl(Ve,"link",h),Ve._p=new Promise(function(xt,Ht){Ve.onload=xt,Ve.onerror=Ht}),Ve.addEventListener("load",function(){pe.loading|=1}),Ve.addEventListener("error",function(){pe.loading|=2}),pe.loading|=4,hP(Q,p,A)}Q={type:"stylesheet",instance:Q,count:1,state:pe},L.set(O,Q)}}}function eMe(h,p){xg.X(h,p);var x=N_;if(x&&h){var A=fn(x).hoistableScripts,L=F_(h),O=A.get(L);O||(O=x.querySelector(BT(L)),O||(h=d({src:h,async:!0},p),(p=ad.get(L))&&FI(h,p),O=x.createElement("script"),de(O),kl(O,"link",h),x.head.appendChild(O)),O={type:"script",instance:O,count:1,state:null},A.set(L,O))}}function tMe(h,p){xg.M(h,p);var x=N_;if(x&&h){var A=fn(x).hoistableScripts,L=F_(h),O=A.get(L);O||(O=x.querySelector(BT(L)),O||(h=d({src:h,async:!0,type:"module"},p),(p=ad.get(L))&&FI(h,p),O=x.createElement("script"),de(O),kl(O,"link",h),x.head.appendChild(O)),O={type:"script",instance:O,count:1,state:null},A.set(L,O))}}function oX(h,p,x,A){var L=(L=Ae.current)?cP(L):null;if(!L)throw Error(i(446));switch(h){case"meta":case"title":return null;case"style":return typeof x.precedence=="string"&&typeof x.href=="string"?(p=B_(x.href),x=fn(L).hoistableStyles,A=x.get(p),A||(A={type:"style",instance:null,count:0,state:null},x.set(p,A)),A):{type:"void",instance:null,count:0,state:null};case"link":if(x.rel==="stylesheet"&&typeof x.href=="string"&&typeof x.precedence=="string"){h=B_(x.href);var O=fn(L).hoistableStyles,Q=O.get(h);if(Q||(L=L.ownerDocument||L,Q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},O.set(h,Q),(O=L.querySelector(NT(h)))&&!O._p&&(Q.instance=O,Q.state.loading=5),ad.has(h)||(x={rel:"preload",as:"style",href:x.href,crossOrigin:x.crossOrigin,integrity:x.integrity,media:x.media,hrefLang:x.hrefLang,referrerPolicy:x.referrerPolicy},ad.set(h,x),O||nMe(L,h,x,Q.state))),p&&A===null)throw Error(i(528,""));return Q}if(p&&A!==null)throw Error(i(529,""));return null;case"script":return p=x.async,x=x.src,typeof x=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=F_(x),x=fn(L).hoistableScripts,A=x.get(p),A||(A={type:"script",instance:null,count:0,state:null},x.set(p,A)),A):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,h))}}function B_(h){return'href="'+Bn(h)+'"'}function NT(h){return'link[rel="stylesheet"]['+h+"]"}function lX(h){return d({},h,{"data-precedence":h.precedence,precedence:null})}function nMe(h,p,x,A){h.querySelector('link[rel="preload"][as="style"]['+p+"]")?A.loading=1:(p=h.createElement("link"),A.preload=p,p.addEventListener("load",function(){return A.loading|=1}),p.addEventListener("error",function(){return A.loading|=2}),kl(p,"link",x),de(p),h.head.appendChild(p))}function F_(h){return'[src="'+Bn(h)+'"]'}function BT(h){return"script[async]"+h}function uX(h,p,x){if(p.count++,p.instance===null)switch(p.type){case"style":var A=h.querySelector('style[data-href~="'+Bn(x.href)+'"]');if(A)return p.instance=A,de(A),A;var L=d({},x,{"data-href":x.href,"data-precedence":x.precedence,href:null,precedence:null});return A=(h.ownerDocument||h).createElement("style"),de(A),kl(A,"style",L),hP(A,x.precedence,h),p.instance=A;case"stylesheet":L=B_(x.href);var O=h.querySelector(NT(L));if(O)return p.state.loading|=4,p.instance=O,de(O),O;A=lX(x),(L=ad.get(L))&&BI(A,L),O=(h.ownerDocument||h).createElement("link"),de(O);var Q=O;return Q._p=new Promise(function(pe,Ve){Q.onload=pe,Q.onerror=Ve}),kl(O,"link",A),p.state.loading|=4,hP(O,x.precedence,h),p.instance=O;case"script":return O=F_(x.src),(L=h.querySelector(BT(O)))?(p.instance=L,de(L),L):(A=x,(L=ad.get(O))&&(A=d({},x),FI(A,L)),h=h.ownerDocument||h,L=h.createElement("script"),de(L),kl(L,"link",A),h.head.appendChild(L),p.instance=L);case"void":return null;default:throw Error(i(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(A=p.instance,p.state.loading|=4,hP(A,x.precedence,h));return p.instance}function hP(h,p,x){for(var A=x.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),L=A.length?A[A.length-1]:null,O=L,Q=0;Q<A.length;Q++){var pe=A[Q];if(pe.dataset.precedence===p)O=pe;else if(O!==L)break}O?O.parentNode.insertBefore(h,O.nextSibling):(p=x.nodeType===9?x.head:x,p.insertBefore(h,p.firstChild))}function BI(h,p){h.crossOrigin==null&&(h.crossOrigin=p.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=p.referrerPolicy),h.title==null&&(h.title=p.title)}function FI(h,p){h.crossOrigin==null&&(h.crossOrigin=p.crossOrigin),h.referrerPolicy==null&&(h.referrerPolicy=p.referrerPolicy),h.integrity==null&&(h.integrity=p.integrity)}var dP=null;function cX(h,p,x){if(dP===null){var A=new Map,L=dP=new Map;L.set(x,A)}else L=dP,A=L.get(x),A||(A=new Map,L.set(x,A));if(A.has(h))return A;for(A.set(h,null),x=x.getElementsByTagName(h),L=0;L<x.length;L++){var O=x[L];if(!(O[sn]||O[es]||h==="link"&&O.getAttribute("rel")==="stylesheet")&&O.namespaceURI!=="http://www.w3.org/2000/svg"){var Q=O.getAttribute(p)||"";Q=h+Q;var pe=A.get(Q);pe?pe.push(O):A.set(Q,[O])}}return A}function hX(h,p,x){h=h.ownerDocument||h,h.head.insertBefore(x,p==="title"?h.querySelector("head > title"):null)}function iMe(h,p,x){if(x===1||p.itemProp!=null)return!1;switch(h){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;return p.rel==="stylesheet"?(h=p.disabled,typeof p.precedence=="string"&&h==null):!0;case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function dX(h){return!(h.type==="stylesheet"&&(h.state.loading&3)===0)}function rMe(h,p,x,A){if(x.type==="stylesheet"&&(typeof A.media!="string"||matchMedia(A.media).matches!==!1)&&(x.state.loading&4)===0){if(x.instance===null){var L=B_(A.href),O=p.querySelector(NT(L));if(O){p=O._p,p!==null&&typeof p=="object"&&typeof p.then=="function"&&(h.count++,h=fP.bind(h),p.then(h,h)),x.state.loading|=4,x.instance=O,de(O);return}O=p.ownerDocument||p,A=lX(A),(L=ad.get(L))&&BI(A,L),O=O.createElement("link"),de(O);var Q=O;Q._p=new Promise(function(pe,Ve){Q.onload=pe,Q.onerror=Ve}),kl(O,"link",A),x.instance=O}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(x,p),(p=x.state.preload)&&(x.state.loading&3)===0&&(h.count++,x=fP.bind(h),p.addEventListener("load",x),p.addEventListener("error",x))}}var LI=0;function sMe(h,p){return h.stylesheets&&h.count===0&&mP(h,h.stylesheets),0<h.count||0<h.imgCount?function(x){var A=setTimeout(function(){if(h.stylesheets&&mP(h,h.stylesheets),h.unsuspend){var O=h.unsuspend;h.unsuspend=null,O()}},6e4+p);0<h.imgBytes&&LI===0&&(LI=62500*USe());var L=setTimeout(function(){if(h.waitingForImages=!1,h.count===0&&(h.stylesheets&&mP(h,h.stylesheets),h.unsuspend)){var O=h.unsuspend;h.unsuspend=null,O()}},(h.imgBytes>LI?50:800)+p);return h.unsuspend=x,function(){h.unsuspend=null,clearTimeout(A),clearTimeout(L)}}:null}function fP(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)mP(this,this.stylesheets);else if(this.unsuspend){var h=this.unsuspend;this.unsuspend=null,h()}}}var pP=null;function mP(h,p){h.stylesheets=null,h.unsuspend!==null&&(h.count++,pP=new Map,p.forEach(aMe,h),pP=null,fP.call(h))}function aMe(h,p){if(!(p.state.loading&4)){var x=pP.get(h);if(x)var A=x.get(null);else{x=new Map,pP.set(h,x);for(var L=h.querySelectorAll("link[data-precedence],style[data-precedence]"),O=0;O<L.length;O++){var Q=L[O];(Q.nodeName==="LINK"||Q.getAttribute("media")!=="not all")&&(x.set(Q.dataset.precedence,Q),A=Q)}A&&x.set(null,A)}L=p.instance,Q=L.getAttribute("data-precedence"),O=x.get(Q)||A,O===A&&x.set(null,L),x.set(Q,L),this.count++,A=fP.bind(this),L.addEventListener("load",A),L.addEventListener("error",A),O?O.parentNode.insertBefore(L,O.nextSibling):(h=h.nodeType===9?h.head:h,h.insertBefore(L,h.firstChild)),p.state.loading|=4}}var FT={$$typeof:w,Provider:null,Consumer:null,_currentValue:he,_currentValue2:he,_threadCount:0};function oMe(h,p,x,A,L,O,Q,pe,Ve){this.tag=1,this.containerInfo=h,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ae(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ae(0),this.hiddenUpdates=ae(null),this.identifierPrefix=A,this.onUncaughtError=L,this.onCaughtError=O,this.onRecoverableError=Q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ve,this.incompleteTransitions=new Map}function fX(h,p,x,A,L,O,Q,pe,Ve,xt,Ht,$t){return h=new oMe(h,p,x,Q,Ve,xt,Ht,$t,pe),p=1,O===!0&&(p|=24),O=ha(3,null,null,p),h.current=O,O.stateNode=h,p=OA(),p.refCount++,h.pooledCache=p,p.refCount++,O.memoizedState={element:A,isDehydrated:x,cache:p},_1(O),h}function pX(h){return h?(h=mp,h):mp}function mX(h,p,x,A,L,O){L=pX(L),A.context===null?A.context=L:A.pendingContext=L,A=df(p),A.payload={element:x},O=O===void 0?null:O,O!==null&&(A.callback=O),x=Mp(h,A,p),x!==null&&(ar(x,h,p),Ap(x,h,p))}function gX(h,p){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var x=h.retryLane;h.retryLane=x!==0&&x<p?x:p}}function II(h,p){gX(h,p),(h=h.alternate)&&gX(h,p)}function yX(h){if(h.tag===13||h.tag===31){var p=Bl(h,67108864);p!==null&&ar(p,h,67108864),II(h,67108864)}}function vX(h){if(h.tag===13||h.tag===31){var p=Gu();p=yi(p);var x=Bl(h,p);x!==null&&ar(x,h,p),II(h,p)}}var gP=!0;function lMe(h,p,x,A){var L=j.T;j.T=null;var O=te.p;try{te.p=2,GI(h,p,x,A)}finally{te.p=O,j.T=L}}function uMe(h,p,x,A){var L=j.T;j.T=null;var O=te.p;try{te.p=8,GI(h,p,x,A)}finally{te.p=O,j.T=L}}function GI(h,p,x,A){if(gP){var L=OI(A);if(L===null)MI(h,p,A,yP,x),bX(h,A);else if(hMe(L,h,p,x,A))A.stopPropagation();else if(bX(h,A),p&4&&-1<cMe.indexOf(h)){for(;L!==null;){var O=ln(L);if(O!==null)switch(O.tag){case 3:if(O=O.stateNode,O.current.memoizedState.isDehydrated){var Q=Kt(O.pendingLanes);if(Q!==0){var pe=O;for(pe.pendingLanes|=2,pe.entangledLanes|=2;Q;){var Ve=1<<31-Se(Q);pe.entanglements[1]|=Ve,Q&=~Ve}mn(O),(pi&6)===0&&(Xa=ee()+500,Yn(0))}}break;case 31:case 13:pe=Bl(O,2),pe!==null&&ar(pe,O,2),ah(),II(O,2)}if(O=OI(A),O===null&&MI(h,p,A,yP,x),O===L)break;L=O}L!==null&&A.stopPropagation()}else MI(h,p,A,null,x)}}function OI(h){return h=uc(h),UI(h)}var yP=null;function UI(h){if(yP=null,h=on(h),h!==null){var p=s(h);if(p===null)h=null;else{var x=p.tag;if(x===13){if(h=a(p),h!==null)return h;h=null}else if(x===31){if(h=o(p),h!==null)return h;h=null}else if(x===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;h=null}else p!==h&&(h=null)}}return yP=h,null}function xX(h){switch(h){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Re()){case tt:return 2;case et:return 8;case at:case jt:return 32;case rn:return 268435456;default:return 32}default:return 32}}var kI=!1,uy=null,cy=null,hy=null,LT=new Map,IT=new Map,dy=[],cMe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bX(h,p){switch(h){case"focusin":case"focusout":uy=null;break;case"dragenter":case"dragleave":cy=null;break;case"mouseover":case"mouseout":hy=null;break;case"pointerover":case"pointerout":LT.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":IT.delete(p.pointerId)}}function GT(h,p,x,A,L,O){return h===null||h.nativeEvent!==O?(h={blockedOn:p,domEventName:x,eventSystemFlags:A,nativeEvent:O,targetContainers:[L]},p!==null&&(p=ln(p),p!==null&&yX(p)),h):(h.eventSystemFlags|=A,p=h.targetContainers,L!==null&&p.indexOf(L)===-1&&p.push(L),h)}function hMe(h,p,x,A,L){switch(p){case"focusin":return uy=GT(uy,h,p,x,A,L),!0;case"dragenter":return cy=GT(cy,h,p,x,A,L),!0;case"mouseover":return hy=GT(hy,h,p,x,A,L),!0;case"pointerover":var O=L.pointerId;return LT.set(O,GT(LT.get(O)||null,h,p,x,A,L)),!0;case"gotpointercapture":return O=L.pointerId,IT.set(O,GT(IT.get(O)||null,h,p,x,A,L)),!0}return!1}function _X(h){var p=on(h.target);if(p!==null){var x=s(p);if(x!==null){if(p=x.tag,p===13){if(p=a(x),p!==null){h.blockedOn=p,Zn(h.priority,function(){vX(x)});return}}else if(p===31){if(p=o(x),p!==null){h.blockedOn=p,Zn(h.priority,function(){vX(x)});return}}else if(p===3&&x.stateNode.current.memoizedState.isDehydrated){h.blockedOn=x.tag===3?x.stateNode.containerInfo:null;return}}}h.blockedOn=null}function vP(h){if(h.blockedOn!==null)return!1;for(var p=h.targetContainers;0<p.length;){var x=OI(h.nativeEvent);if(x===null){x=h.nativeEvent;var A=new x.constructor(x.type,x);ql=A,x.target.dispatchEvent(A),ql=null}else return p=ln(x),p!==null&&yX(p),h.blockedOn=x,!1;p.shift()}return!0}function SX(h,p,x){vP(h)&&x.delete(p)}function dMe(){kI=!1,uy!==null&&vP(uy)&&(uy=null),cy!==null&&vP(cy)&&(cy=null),hy!==null&&vP(hy)&&(hy=null),LT.forEach(SX),IT.forEach(SX)}function xP(h,p){h.blockedOn===p&&(h.blockedOn=null,kI||(kI=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,dMe)))}var bP=null;function MX(h){bP!==h&&(bP=h,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){bP===h&&(bP=null);for(var p=0;p<h.length;p+=3){var x=h[p],A=h[p+1],L=h[p+2];if(typeof A!="function"){if(UI(A||x)===null)continue;break}var O=ln(x);O!==null&&(h.splice(p,3),p-=3,hT(O,{pending:!0,data:L,method:x.method,action:A},A,L))}}))}function L_(h){function p(Ve){return xP(Ve,h)}uy!==null&&xP(uy,h),cy!==null&&xP(cy,h),hy!==null&&xP(hy,h),LT.forEach(p),IT.forEach(p);for(var x=0;x<dy.length;x++){var A=dy[x];A.blockedOn===h&&(A.blockedOn=null)}for(;0<dy.length&&(x=dy[0],x.blockedOn===null);)_X(x),x.blockedOn===null&&dy.shift();if(x=(h.ownerDocument||h).$$reactFormReplay,x!=null)for(A=0;A<x.length;A+=3){var L=x[A],O=x[A+1],Q=L[ie]||null;if(typeof O=="function")Q||MX(x);else if(Q){var pe=null;if(O&&O.hasAttribute("formAction")){if(L=O,Q=O[ie]||null)pe=Q.formAction;else if(UI(L)!==null)continue}else pe=Q.action;typeof pe=="function"?x[A+1]=pe:(x.splice(A,3),A-=3),MX(x)}}}function AX(){function h(O){O.canIntercept&&O.info==="react-transition"&&O.intercept({handler:function(){return new Promise(function(Q){return L=Q})},focusReset:"manual",scroll:"manual"})}function p(){L!==null&&(L(),L=null),A||setTimeout(x,20)}function x(){if(!A&&!navigation.transition){var O=navigation.currentEntry;O&&O.url!=null&&navigation.navigate(O.url,{state:O.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var A=!1,L=null;return navigation.addEventListener("navigate",h),navigation.addEventListener("navigatesuccess",p),navigation.addEventListener("navigateerror",p),setTimeout(x,100),function(){A=!0,navigation.removeEventListener("navigate",h),navigation.removeEventListener("navigatesuccess",p),navigation.removeEventListener("navigateerror",p),L!==null&&(L(),L=null)}}}function zI(h){this._internalRoot=h}_P.prototype.render=zI.prototype.render=function(h){var p=this._internalRoot;if(p===null)throw Error(i(409));var x=p.current,A=Gu();mX(x,A,h,p,null,null)},_P.prototype.unmount=zI.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var p=h.containerInfo;mX(h.current,2,null,h,null,null),ah(),p[ye]=null}};function _P(h){this._internalRoot=h}_P.prototype.unstable_scheduleHydration=function(h){if(h){var p=Vi();h={blockedOn:null,target:h,priority:p};for(var x=0;x<dy.length&&p!==0&&p<dy[x].priority;x++);dy.splice(x,0,h),x===0&&_X(h)}};var TX=e.version;if(TX!=="19.2.4")throw Error(i(527,TX,"19.2.4"));te.findDOMNode=function(h){var p=h._reactInternals;if(p===void 0)throw typeof h.render=="function"?Error(i(188)):(h=Object.keys(h).join(","),Error(i(268,h)));return h=u(p),h=h!==null?c(h):null,h=h===null?null:h.stateNode,h};var fMe={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:j,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var SP=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!SP.isDisabled&&SP.supportsFiber)try{Gt=SP.inject(fMe),st=SP}catch{}}return UT.createRoot=function(h,p){if(!r(h))throw Error(i(299));var x=!1,A="",L=Q3,O=yT,Q=vT;return p!=null&&(p.unstable_strictMode===!0&&(x=!0),p.identifierPrefix!==void 0&&(A=p.identifierPrefix),p.onUncaughtError!==void 0&&(L=p.onUncaughtError),p.onCaughtError!==void 0&&(O=p.onCaughtError),p.onRecoverableError!==void 0&&(Q=p.onRecoverableError)),p=fX(h,1,!1,null,null,x,A,null,L,O,Q,AX),h[ye]=p.current,SI(h),new zI(p)},UT.hydrateRoot=function(h,p,x){if(!r(h))throw Error(i(299));var A=!1,L="",O=Q3,Q=yT,pe=vT,Ve=null;return x!=null&&(x.unstable_strictMode===!0&&(A=!0),x.identifierPrefix!==void 0&&(L=x.identifierPrefix),x.onUncaughtError!==void 0&&(O=x.onUncaughtError),x.onCaughtError!==void 0&&(Q=x.onCaughtError),x.onRecoverableError!==void 0&&(pe=x.onRecoverableError),x.formState!==void 0&&(Ve=x.formState)),p=fX(h,1,!0,p,x??null,A,L,Ve,O,Q,pe,AX),p.context=pX(null),x=p.current,A=Gu(),A=yi(A),L=df(A),L.callback=null,Mp(x,L,A),x=A,p.current.lanes=x,be(p,x),mn(p),h[ye]=p.current,SI(h),new _P(p)},UT.version="19.2.4",UT}var LX;function SMe(){if(LX)return XI.exports;LX=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),XI.exports=_Me(),XI.exports}var Uz=SMe(),C2=Cq();const MMe=_0(C2);function IX(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function bb(...n){return e=>{let t=!1;const i=n.map(r=>{const s=IX(r,e);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let r=0;r<i.length;r++){const s=i[r];typeof s=="function"?s():IX(n[r],null)}}}}function _b(...n){return G.useCallback(bb(...n),n)}var AMe=Symbol.for("react.lazy"),uB=Oz[" use ".trim().toString()];function TMe(n){return typeof n=="object"&&n!==null&&"then"in n}function wq(n){return n!=null&&typeof n=="object"&&"$$typeof"in n&&n.$$typeof===AMe&&"_payload"in n&&TMe(n._payload)}function CMe(n){const e=wMe(n),t=G.forwardRef((i,r)=>{let{children:s,...a}=i;wq(s)&&typeof uB=="function"&&(s=uB(s._payload));const o=G.Children.toArray(s),l=o.find(RMe);if(l){const u=l.props.children,c=o.map(d=>d===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:d);return $.jsx(e,{...a,ref:r,children:G.isValidElement(u)?G.cloneElement(u,void 0,c):null})}return $.jsx(e,{...a,ref:r,children:s})});return t.displayName=`${n}.Slot`,t}function wMe(n){const e=G.forwardRef((t,i)=>{let{children:r,...s}=t;if(wq(r)&&typeof uB=="function"&&(r=uB(r._payload)),G.isValidElement(r)){const a=DMe(r),o=PMe(s,r.props);return r.type!==G.Fragment&&(o.ref=i?bb(i,a):a),G.cloneElement(r,o)}return G.Children.count(r)>1?G.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var EMe=Symbol("radix.slottable");function RMe(n){return G.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===EMe}function PMe(n,e){const t={...e};for(const i in e){const r=n[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?t[i]=(...o)=>{const l=s(...o);return r(...o),l}:r&&(t[i]=r):i==="style"?t[i]={...r,...s}:i==="className"&&(t[i]=[r,s].filter(Boolean).join(" "))}return{...n,...t}}function DMe(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var NMe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],BMe=NMe.reduce((n,e)=>{const t=CMe(`Primitive.${e}`),i=G.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),$.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),ov=globalThis?.document?G.useLayoutEffect:()=>{},FMe="Portal",Eq=G.forwardRef((n,e)=>{const{container:t,...i}=n,[r,s]=G.useState(!1);ov(()=>s(!0),[]);const a=t||r&&globalThis?.document?.body;return a?MMe.createPortal($.jsx(BMe.div,{...i,ref:e}),a):null});Eq.displayName=FMe;var LMe=Eq,GX=Object.prototype.hasOwnProperty;function Fw(n,e){var t,i;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((i=n.length)===e.length)for(;i--&&Fw(n[i],e[i]););return i===-1}if(!t||typeof n=="object"){i=0;for(t in n)if(GX.call(n,t)&&++i&&!GX.call(e,t)||!(t in e)||!Fw(n[t],e[t]))return!1;return Object.keys(e).length===i}}return n!==n&&e!==e}function w2(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(let i=0;i<t.length;i++)if(!Object.prototype.hasOwnProperty.call(e,t[i])||!Object.is(n[t[i]],e[t[i]]))return!1;return!0}var E2=function(e,t,i,r){this.name=e,this.fn=t,this.args=i,this.modifiers=r};E2.prototype._test=function(e){var t=this.fn;try{ZS(this.modifiers.slice(),t,this)(e)}catch{t=function(){return!1}}try{return ZS(this.modifiers.slice(),t,this)(e)}catch{return!1}};E2.prototype._check=function(e){try{ZS(this.modifiers.slice(),this.fn,this)(e)}catch{if(ZS(this.modifiers.slice(),function(i){return i},this)(!1))return}if(!ZS(this.modifiers.slice(),this.fn,this)(e))throw null};E2.prototype._testAsync=function(e){var t=this;return new Promise(function(i,r){Pq(t.modifiers.slice(),t.fn,t)(e).then(function(s){s?i(e):r(null)}).catch(function(s){return r(s)})})};function Rq(n,e){return e===void 0&&(e="simple"),typeof n=="object"?n[e]:n}function ZS(n,e,t){if(n.length){var i=n.shift(),r=ZS(n,e,t);return i.perform(r,t)}else return Rq(e)}function Pq(n,e,t){if(n.length){var i=n.shift(),r=Pq(n,e,t);return i.performAsync(r,t)}else return function(s){return Promise.resolve(Rq(e,"async")(s))}}var IMe=function(e,t,i){this.name=e,this.perform=t,this.performAsync=i},kz=(function(n){function e(t,i,r,s){for(var a=[],o=arguments.length-4;o-- >0;)a[o]=arguments[o+4];n.call(this,a),n.captureStackTrace&&n.captureStackTrace(this,e),this.rule=t,this.value=i,this.cause=r,this.target=s}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e})(Error),vm=function(e,t){e===void 0&&(e=[]),t===void 0&&(t=[]),this.chain=e,this.nextRuleModifiers=t};vm.prototype._applyRule=function(e,t){var i=this;return function(){for(var r=[],s=arguments.length;s--;)r[s]=arguments[s];return i.chain.push(new E2(t,e.apply(i,r),r,i.nextRuleModifiers)),i.nextRuleModifiers=[],i}};vm.prototype._applyModifier=function(e,t){return this.nextRuleModifiers.push(new IMe(t,e.simple,e.async)),this};vm.prototype._clone=function(){return new vm(this.chain.slice(),this.nextRuleModifiers.slice())};vm.prototype.test=function(e){return this.chain.every(function(t){return t._test(e)})};vm.prototype.testAll=function(e){var t=[];return this.chain.forEach(function(i){try{i._check(e)}catch(r){t.push(new kz(i,e,r))}}),t};vm.prototype.check=function(e){this.chain.forEach(function(t){try{t._check(e)}catch(i){throw new kz(t,e,i)}})};vm.prototype.testAsync=function(e){var t=this;return new Promise(function(i,r){Dq(e,t.chain.slice(),i,r)})};function Dq(n,e,t,i){if(e.length){var r=e.shift();r._testAsync(n).then(function(){Dq(n,e,t,i)},function(s){i(new kz(r,n,s))})}else t(n)}var OX=function(n,e){return e&&typeof n=="string"&&n.trim().length===0?!0:n==null};function GMe(n,e){return e===void 0&&(e=!1),{simple:function(t){return OX(t,e)||n.check(t)===void 0},async:function(t){return OX(t,e)||n.testAsync(t)}}}function kc(){return typeof Proxy<"u"?Nq(new vm):b5(new vm)}var Lw={};kc.extend=function(n){Object.assign(Lw,n)};kc.clearCustomRules=function(){Lw={}};function Nq(n){return new Proxy(n,{get:function(t,i){if(i in t)return t[i];var r=Nq(n._clone());if(i in cB)return r._applyModifier(cB[i],i);if(i in Lw)return r._applyRule(Lw[i],i);if(i in _5)return r._applyRule(_5[i],i)}})}function b5(n){var e=function(r,s){return Object.keys(r).forEach(function(a){s[a]=function(){for(var o=[],l=arguments.length;l--;)o[l]=arguments[l];var u=b5(s._clone()),c=u._applyRule(r[a],a).apply(void 0,o);return c}}),s},t=e(_5,n),i=e(Lw,t);return Object.keys(cB).forEach(function(r){Object.defineProperty(i,r,{get:function(){var s=b5(i._clone());return s._applyModifier(cB[r],r)}})}),i}var cB={not:{simple:function(n){return function(e){return!n(e)}},async:function(n){return function(e){return Promise.resolve(n(e)).then(function(t){return!t}).catch(function(){return!0})}}},some:{simple:function(n){return function(e){return MP(e).some(function(t){try{return n(t)}catch{return!1}})}},async:function(n){return function(e){return Promise.all(MP(e).map(function(t){try{return n(t).catch(function(){return!1})}catch{return!1}})).then(function(t){return t.some(Boolean)})}}},every:{simple:function(n){return function(e){return e!==!1&&MP(e).every(n)}},async:function(n){return function(e){return Promise.all(MP(e).map(n)).then(function(t){return t.every(Boolean)})}}},strict:{simple:function(n,e){return function(t){return UX(e)&&t&&typeof t=="object"?Object.keys(e.args[0]).length===Object.keys(t).length&&n(t):n(t)}},async:function(n,e){return function(t){return Promise.resolve(n(t)).then(function(i){return UX(e)&&t&&typeof t=="object"?Object.keys(e.args[0]).length===Object.keys(t).length&&i:i}).catch(function(){return!1})}}}};function UX(n){return n&&n.name==="schema"&&n.args.length>0&&typeof n.args[0]=="object"}function MP(n){return typeof n=="string"?n.split(""):n}var _5={equal:function(n){return function(e){return e==n}},exact:function(n){return function(e){return e===n}},number:function(n){return n===void 0&&(n=!0),function(e){return typeof e=="number"&&(n||isFinite(e))}},integer:function(){return function(n){var e=Number.isInteger||OMe;return e(n)}},numeric:function(){return function(n){return!isNaN(parseFloat(n))&&isFinite(n)}},string:function(){return I_("string")},boolean:function(){return I_("boolean")},undefined:function(){return I_("undefined")},null:function(){return I_("null")},array:function(){return I_("array")},object:function(){return I_("object")},instanceOf:function(n){return function(e){return e instanceof n}},pattern:function(n){return function(e){return n.test(e)}},lowercase:function(){return function(n){return typeof n=="boolean"||n===n.toLowerCase()&&n.trim()!==""}},uppercase:function(){return function(n){return n===n.toUpperCase()&&n.trim()!==""}},vowel:function(){return function(n){return/^[aeiou]+$/i.test(n)}},consonant:function(){return function(n){return/^(?=[^aeiou])([a-z]+)$/i.test(n)}},first:function(n){return function(e){return e[0]==n}},last:function(n){return function(e){return e[e.length-1]==n}},empty:function(){return function(n){return n.length===0}},length:function(n,e){return function(t){return t.length>=n&&t.length<=(e||n)}},minLength:function(n){return function(e){return e.length>=n}},maxLength:function(n){return function(e){return e.length<=n}},negative:function(){return function(n){return n<0}},positive:function(){return function(n){return n>=0}},between:function(n,e){return function(t){return t>=n&&t<=e}},range:function(n,e){return function(t){return t>=n&&t<=e}},lessThan:function(n){return function(e){return e<n}},lessThanOrEqual:function(n){return function(e){return e<=n}},greaterThan:function(n){return function(e){return e>n}},greaterThanOrEqual:function(n){return function(e){return e>=n}},even:function(){return function(n){return n%2===0}},odd:function(){return function(n){return n%2!==0}},includes:function(n){return function(e){return~e.indexOf(n)}},schema:function(n){return UMe(n)},passesAnyOf:function(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];return function(t){return n.some(function(i){return i.test(t)})}},optional:GMe};function I_(n){return function(e){return Array.isArray(e)&&n==="array"||e===null&&n==="null"||typeof e===n}}function OMe(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n}function UMe(n){return{simple:function(e){var t=[];if(Object.keys(n).forEach(function(i){var r=n[i];try{r.check((e||{})[i])}catch(s){s.target=i,t.push(s)}}),t.length>0)throw t;return!0},async:function(e){var t=[],i=Object.keys(n).map(function(r){var s=n[r];return s.testAsync((e||{})[r]).catch(function(a){a.target=r,t.push(a)})});return Promise.all(i).then(function(){if(t.length>0)throw t;return!0})}}}var Us="colors",Ou="sizes",ri="space",kMe={gap:ri,gridGap:ri,columnGap:ri,gridColumnGap:ri,rowGap:ri,gridRowGap:ri,inset:ri,insetBlock:ri,insetBlockEnd:ri,insetBlockStart:ri,insetInline:ri,insetInlineEnd:ri,insetInlineStart:ri,margin:ri,marginTop:ri,marginRight:ri,marginBottom:ri,marginLeft:ri,marginBlock:ri,marginBlockEnd:ri,marginBlockStart:ri,marginInline:ri,marginInlineEnd:ri,marginInlineStart:ri,padding:ri,paddingTop:ri,paddingRight:ri,paddingBottom:ri,paddingLeft:ri,paddingBlock:ri,paddingBlockEnd:ri,paddingBlockStart:ri,paddingInline:ri,paddingInlineEnd:ri,paddingInlineStart:ri,top:ri,right:ri,bottom:ri,left:ri,scrollMargin:ri,scrollMarginTop:ri,scrollMarginRight:ri,scrollMarginBottom:ri,scrollMarginLeft:ri,scrollMarginX:ri,scrollMarginY:ri,scrollMarginBlock:ri,scrollMarginBlockEnd:ri,scrollMarginBlockStart:ri,scrollMarginInline:ri,scrollMarginInlineEnd:ri,scrollMarginInlineStart:ri,scrollPadding:ri,scrollPaddingTop:ri,scrollPaddingRight:ri,scrollPaddingBottom:ri,scrollPaddingLeft:ri,scrollPaddingX:ri,scrollPaddingY:ri,scrollPaddingBlock:ri,scrollPaddingBlockEnd:ri,scrollPaddingBlockStart:ri,scrollPaddingInline:ri,scrollPaddingInlineEnd:ri,scrollPaddingInlineStart:ri,fontSize:"fontSizes",background:Us,backgroundColor:Us,backgroundImage:Us,borderImage:Us,border:Us,borderBlock:Us,borderBlockEnd:Us,borderBlockStart:Us,borderBottom:Us,borderBottomColor:Us,borderColor:Us,borderInline:Us,borderInlineEnd:Us,borderInlineStart:Us,borderLeft:Us,borderLeftColor:Us,borderRight:Us,borderRightColor:Us,borderTop:Us,borderTopColor:Us,caretColor:Us,color:Us,columnRuleColor:Us,fill:Us,outline:Us,outlineColor:Us,stroke:Us,textDecorationColor:Us,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Ou,minBlockSize:Ou,maxBlockSize:Ou,inlineSize:Ou,minInlineSize:Ou,maxInlineSize:Ou,width:Ou,minWidth:Ou,maxWidth:Ou,height:Ou,minHeight:Ou,maxHeight:Ou,flexBasis:Ou,gridTemplateColumns:Ou,gridTemplateRows:Ou,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},zMe=(n,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,LM=()=>{const n=Object.create(null);return(e,t,...i)=>{const r=(s=>JSON.stringify(s,zMe))(e);return r in n?n[r]:n[r]=t(e,...i)}},Fx=Symbol.for("sxs.internal"),zz=(n,e)=>Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)),kX=n=>{for(const e in n)return!0;return!1},{hasOwnProperty:VMe}=Object.prototype,S5=n=>n.includes("-")?n:n.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),HMe=/\s+(?![^()]*\))/,G_=n=>e=>n(...typeof e=="string"?String(e).split(HMe):[e]),zX={appearance:n=>({WebkitAppearance:n,appearance:n}),backfaceVisibility:n=>({WebkitBackfaceVisibility:n,backfaceVisibility:n}),backdropFilter:n=>({WebkitBackdropFilter:n,backdropFilter:n}),backgroundClip:n=>({WebkitBackgroundClip:n,backgroundClip:n}),boxDecorationBreak:n=>({WebkitBoxDecorationBreak:n,boxDecorationBreak:n}),clipPath:n=>({WebkitClipPath:n,clipPath:n}),content:n=>({content:n.includes('"')||n.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(n)?n:`"${n}"`}),hyphens:n=>({WebkitHyphens:n,hyphens:n}),maskImage:n=>({WebkitMaskImage:n,maskImage:n}),maskSize:n=>({WebkitMaskSize:n,maskSize:n}),tabSize:n=>({MozTabSize:n,tabSize:n}),textSizeAdjust:n=>({WebkitTextSizeAdjust:n,textSizeAdjust:n}),userSelect:n=>({WebkitUserSelect:n,userSelect:n}),marginBlock:G_(((n,e)=>({marginBlockStart:n,marginBlockEnd:e||n}))),marginInline:G_(((n,e)=>({marginInlineStart:n,marginInlineEnd:e||n}))),maxSize:G_(((n,e)=>({maxBlockSize:n,maxInlineSize:e||n}))),minSize:G_(((n,e)=>({minBlockSize:n,minInlineSize:e||n}))),paddingBlock:G_(((n,e)=>({paddingBlockStart:n,paddingBlockEnd:e||n}))),paddingInline:G_(((n,e)=>({paddingInlineStart:n,paddingInlineEnd:e||n})))},YI=/([\d.]+)([^]*)/,XMe=(n,e)=>n.length?n.reduce(((t,i)=>(t.push(...e.map((r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(r)?`:is(${i})`:i):i+" "+r))),t)),[]):e,WMe=(n,e)=>n in ZMe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,i,r,s)=>i+(r==="stretch"?`-moz-available${s};${S5(n)}:${i}-webkit-fill-available`:`-moz-fit-content${s};${S5(n)}:${i}fit-content`)+s)):String(e),ZMe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},a0=n=>n?n+"-":"",Bq=(n,e,t)=>n.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((i,r,s,a,o)=>a=="$"==!!s?i:(r||a=="--"?"calc(":"")+"var(--"+(a==="$"?a0(e)+(o.includes("$")?"":a0(t))+o.replace(/\$/g,"-"):o)+")"+(r||a=="--"?"*"+(r||"")+(s||"1")+")":""))),jMe=/\s*,\s*(?![^()]*\))/,YMe=Object.prototype.toString,OS=(n,e,t,i,r)=>{let s,a,o;const l=(u,c,d)=>{let f,m;const y=_=>{for(f in _){const M=f.charCodeAt(0)===64,w=M&&Array.isArray(_[f])?_[f]:[_[f]];for(m of w){const T=/[A-Z]/.test(b=f)?b:b.replace(/-[^]/g,(R=>R[1].toUpperCase())),E=typeof m=="object"&&m&&m.toString===YMe&&(!i.utils[T]||!c.length);if(T in i.utils&&!E){const R=i.utils[T];if(R!==a){a=R,y(R(m)),a=null;continue}}else if(T in zX){const R=zX[T];if(R!==o){o=R,y(R(m)),o=null;continue}}if(M&&(S=f.slice(1)in i.media?"@media "+i.media[f.slice(1)]:f,f=S.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((R,P,I,B,N,U)=>{const V=YI.test(P),W=.0625*(V?-1:1),[K,q]=V?[B,P]:[P,B];return"("+(I[0]==="="?"":I[0]===">"===V?"max-":"min-")+K+":"+(I[0]!=="="&&I.length===1?q.replace(YI,((j,te,he)=>Number(te)+W*(I===">"?1:-1)+he)):q)+(N?") and ("+(N[0]===">"?"min-":"max-")+K+":"+(N.length===1?U.replace(YI,((j,te,he)=>Number(te)+W*(N===">"?-1:1)+he)):U):"")+")"}))),E){const R=M?d.concat(f):[...d],P=M?[...c]:XMe(c,f.split(jMe));s!==void 0&&r(VX(...s)),s=void 0,l(m,P,R)}else s===void 0&&(s=[[],c,d]),f=M||f.charCodeAt(0)!==36?f:`--${a0(i.prefix)}${f.slice(1).replace(/\$/g,"-")}`,m=E?m:typeof m=="number"?m&&T in KMe?String(m)+"px":String(m):Bq(WMe(T,m??""),i.prefix,i.themeMap[T]),s[0].push(`${M?`${f} `:`${S5(f)}:`}${m}`)}}var S,b};y(u),s!==void 0&&r(VX(...s)),s=void 0};l(n,e,t)},VX=(n,e,t)=>`${t.map((i=>`${i}{`)).join("")}${e.length?`${e.join(",")}{`:""}${n.join(";")}${e.length?"}":""}${Array(t.length?t.length+1:0).join("}")}`,KMe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},HX=n=>String.fromCharCode(n+(n>25?39:97)),Lx=n=>(e=>{let t,i="";for(t=Math.abs(e);t>52;t=t/52|0)i=HX(t%52)+i;return HX(t%52)+i})(((e,t)=>{let i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e})(5381,JSON.stringify(n))>>>0),KC=["themed","global","styled","onevar","resonevar","allvar","inline"],$Me=n=>{if(n.href&&!n.href.startsWith(location.origin))return!1;try{return!!n.cssRules}catch{return!1}},JMe=n=>{let e;const t=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,((s,a)=>{const{cssText:o}=s;let l="";if(o.startsWith("--sxs"))return"";if(r[a-1]&&(l=r[a-1].cssText).startsWith("--sxs")){if(!s.cssRules.length)return"";for(const u in e.rules)if(e.rules[u].group===s)return`--sxs{--sxs:${[...e.rules[u].cache].join(" ")}}${o}`;return s.cssRules.length?`${l}${o}`:""}return o})).join("")},i=()=>{if(e){const{rules:o,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const u in o)delete o[u]}const r=Object(n).styleSheets||[];for(const o of r)if($Me(o)){for(let l=0,u=o.cssRules;u[l];++l){const c=Object(u[l]);if(c.type!==1)continue;const d=Object(u[l+1]);if(d.type!==4)continue;++l;const{cssText:f}=c;if(!f.startsWith("--sxs"))continue;const m=f.slice(14,-3).trim().split(/\s+/),y=KC[m[0]];y&&(e||(e={sheet:o,reset:i,rules:{},toString:t}),e.rules[y]={group:d,index:l,cache:new Set(m)})}if(e)break}if(!e){const o=(l,u)=>({type:u,cssRules:[],insertRule(c,d){this.cssRules.splice(d,0,o(c,{import:3,undefined:1}[(c.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,(c=>c.cssText)).join("")}}`:l}});e={sheet:n?(n.head||n).appendChild(document.createElement("style")).sheet:o("","text/css"),rules:{},reset:i,toString:t}}const{sheet:s,rules:a}=e;for(let o=KC.length-1;o>=0;--o){const l=KC[o];if(!a[l]){const u=KC[o+1],c=a[u]?a[u].index:s.cssRules.length;s.insertRule("@media{}",c),s.insertRule(`--sxs{--sxs:${o}}`,c),a[l]={group:s.cssRules[c+1],index:c,cache:new Set([o])}}qMe(a[l])}};return i(),e},qMe=n=>{const e=n.group;let t=e.cssRules.length;n.apply=i=>{try{e.insertRule(i,t),++t}catch{}}},kT=Symbol(),QMe=LM(),XX=(n,e)=>QMe(n,(()=>(...t)=>{let i={type:null,composers:new Set};for(const r of t)if(r!=null)if(r[Fx]){i.type==null&&(i.type=r[Fx].type);for(const s of r[Fx].composers)i.composers.add(s)}else r.constructor!==Object||r.$$typeof?i.type==null&&(i.type=r):i.composers.add(eAe(r,n));return i.type==null&&(i.type="span"),i.composers.size||i.composers.add(["PJLV",{},[],[],{},[]]),tAe(n,i,e)})),eAe=({variants:n,compoundVariants:e,defaultVariants:t,...i},r)=>{const s=`${a0(r.prefix)}c-${Lx(i)}`,a=[],o=[],l=Object.create(null),u=[];for(const f in t)l[f]=String(t[f]);if(typeof n=="object"&&n)for(const f in n){c=l,d=f,VMe.call(c,d)||(l[f]="undefined");const m=n[f];for(const y in m){const _={[f]:String(y)};String(y)==="undefined"&&u.push(f);const S=m[y],b=[_,S,!kX(S)];a.push(b)}}var c,d;if(typeof e=="object"&&e)for(const f of e){let{css:m,...y}=f;m=typeof m=="object"&&m||{};for(const S in y)y[S]=String(y[S]);const _=[y,m,!kX(m)];o.push(_)}return[s,i,a,o,l,u]},tAe=(n,e,t)=>{const[i,r,s,a]=nAe(e.composers),o=typeof e.type=="function"||e.type.$$typeof?(d=>{function f(){for(let m=0;m<f[kT].length;m++){const[y,_]=f[kT][m];d.rules[y].apply(_)}return f[kT]=[],null}return f[kT]=[],f.rules={},KC.forEach((m=>f.rules[m]={apply:y=>f[kT].push([m,y])})),f})(t):null,l=(o||t).rules,u=`.${i}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,c=d=>{d=typeof d=="object"&&d||iAe;const{css:f,...m}=d,y={};for(const b in s)if(delete m[b],b in d){let M=d[b];typeof M=="object"&&M?y[b]={"@initial":s[b],...M}:(M=String(M),y[b]=M!=="undefined"||a.has(b)?M:s[b])}else y[b]=s[b];const _=new Set([...r]);for(const[b,M,w,T]of e.composers){t.rules.styled.cache.has(b)||(t.rules.styled.cache.add(b),OS(M,[`.${b}`],[],n,(P=>{l.styled.apply(P)})));const E=WX(w,y,n.media),R=WX(T,y,n.media,!0);for(const P of E)if(P!==void 0)for(const[I,B,N]of P){const U=`${b}-${Lx(B)}-${I}`;_.add(U);const V=(N?t.rules.resonevar:t.rules.onevar).cache,W=N?l.resonevar:l.onevar;V.has(U)||(V.add(U),OS(B,[`.${U}`],[],n,(K=>{W.apply(K)})))}for(const P of R)if(P!==void 0)for(const[I,B]of P){const N=`${b}-${Lx(B)}-${I}`;_.add(N),t.rules.allvar.cache.has(N)||(t.rules.allvar.cache.add(N),OS(B,[`.${N}`],[],n,(U=>{l.allvar.apply(U)})))}}if(typeof f=="object"&&f){const b=`${i}-i${Lx(f)}-css`;_.add(b),t.rules.inline.cache.has(b)||(t.rules.inline.cache.add(b),OS(f,[`.${b}`],[],n,(M=>{l.inline.apply(M)})))}for(const b of String(d.className||"").trim().split(/\s+/))b&&_.add(b);const S=m.className=[..._].join(" ");return{type:e.type,className:S,selector:u,props:m,toString:()=>S,deferredInjector:o}};return zz(c,{className:i,selector:u,[Fx]:e,toString:()=>(t.rules.styled.cache.has(i)||c(),i)})},nAe=n=>{let e="";const t=[],i={},r=[];for(const[s,,,,a,o]of n){e===""&&(e=s),t.push(s),r.push(...o);for(const l in a){const u=a[l];(i[l]===void 0||u!=="undefined"||o.includes(u))&&(i[l]=u)}}return[e,t,i,new Set(r)]},WX=(n,e,t,i)=>{const r=[];e:for(let[s,a,o]of n){if(o)continue;let l,u=0,c=!1;for(l in s){const d=s[l];let f=e[l];if(f!==d){if(typeof f!="object"||!f)continue e;{let m,y,_=0;for(const S in f){if(d===String(f[S])){if(S!=="@initial"){const b=S.slice(1);(y=y||[]).push(b in t?t[b]:S.replace(/^@media ?/,"")),c=!0}u+=_,m=!0}++_}if(y&&y.length&&(a={["@media "+y.join(", ")]:a}),!m)continue e}}}(r[u]=r[u]||[]).push([i?"cv":`${l}-${s[l]}`,a,c])}return r},iAe={},rAe=LM(),sAe=(n,e)=>rAe(n,(()=>(...t)=>{const i=()=>{for(let r of t){r=typeof r=="object"&&r||{};let s=Lx(r);if(!e.rules.global.cache.has(s)){if(e.rules.global.cache.add(s),"@import"in r){let a=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let o of[].concat(r["@import"]))o=o.includes('"')||o.includes("'")?o:`"${o}"`,e.sheet.insertRule(`@import ${o};`,a++);delete r["@import"]}OS(r,[],[],n,(a=>{e.rules.global.apply(a)}))}}return""};return zz(i,{toString:i})})),aAe=LM(),oAe=(n,e)=>aAe(n,(()=>t=>{const i=`${a0(n.prefix)}k-${Lx(t)}`,r=()=>{if(!e.rules.global.cache.has(i)){e.rules.global.cache.add(i);const s=[];OS(t,[],[],n,(o=>s.push(o)));const a=`@keyframes ${i}{${s.join("")}}`;e.rules.global.apply(a)}return i};return zz(r,{get name(){return r()},toString:r})})),lAe=class{constructor(n,e,t,i){this.token=n==null?"":String(n),this.value=e==null?"":String(e),this.scale=t==null?"":String(t),this.prefix=i==null?"":String(i)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+a0(this.prefix)+a0(this.scale)+this.token}toString(){return this.computedValue}},uAe=LM(),cAe=(n,e)=>uAe(n,(()=>(t,i)=>{i=typeof t=="object"&&t||Object(i);const r=`.${t=(t=typeof t=="string"?t:"")||`${a0(n.prefix)}t-${Lx(i)}`}`,s={},a=[];for(const l in i){s[l]={};for(const u in i[l]){const c=`--${a0(n.prefix)}${l}-${u}`,d=Bq(String(i[l][u]),n.prefix,l);s[l][u]=new lAe(u,d,l,n.prefix),a.push(`${c}:${d}`)}}const o=()=>{if(a.length&&!e.rules.themed.cache.has(t)){e.rules.themed.cache.add(t);const l=`${i===n.theme?":root,":""}.${t}{${a.join(";")}}`;e.rules.themed.apply(l)}return t};return{...s,get className(){return o()},selector:r,toString:o}})),hAe=LM(),dAe=LM(),fAe=n=>{const e=(t=>{let i=!1;const r=hAe(t,(s=>{i=!0;const a="prefix"in(s=typeof s=="object"&&s||{})?String(s.prefix):"",o=typeof s.media=="object"&&s.media||{},l=typeof s.root=="object"?s.root||null:globalThis.document||null,u=typeof s.theme=="object"&&s.theme||{},c={prefix:a,media:o,theme:u,themeMap:typeof s.themeMap=="object"&&s.themeMap||{...kMe},utils:typeof s.utils=="object"&&s.utils||{}},d=JMe(l),f={css:XX(c,d),globalCss:sAe(c,d),keyframes:oAe(c,d),createTheme:cAe(c,d),reset(){d.reset(),f.theme.toString()},theme:{},sheet:d,config:c,prefix:a,getCssText:d.toString,toString:d.toString};return String(f.theme=f.createTheme(u)),f}));return i||r.reset(),r})(n);return e.styled=(({config:t,sheet:i})=>dAe(t,(()=>{const r=XX(t,i);return(...s)=>{const a=r(...s),o=a[Fx].type,l=Ie.forwardRef(((u,c)=>{const d=u&&u.as||o,{props:f,deferredInjector:m}=a(u);return delete f.as,f.ref=c,m?Ie.createElement(Ie.Fragment,null,Ie.createElement(d,f),Ie.createElement(m,null)):Ie.createElement(d,f)}));return l.className=a.className,l.displayName=`Styled.${o.displayName||o.name||o}`,l.selector=a.selector,l.toString=()=>a.selector,l[Fx]=a[Fx],l}})))(e),e};function pAe(n,e,t){return Math.max(e,Math.min(n,t))}const yu={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function ZX(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function jX(n,e,t,i=.15){return i===0?pAe(n,e,t):n<e?-ZX(e-n,t-e,i)+e:n>t?+ZX(n-t,t-e,i)+t:n}function mAe(n,[e,t],[i,r]){const[[s,a],[o,l]]=n;return[jX(e,s,a,i),jX(t,o,l,r)]}function gAe(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function yAe(n){var e=gAe(n,"string");return typeof e=="symbol"?e:String(e)}function Ic(n,e,t){return e=yAe(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function YX(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Qa(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?YX(Object(t),!0).forEach(function(i){Ic(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):YX(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const Fq={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function KX(n){return n?n[0].toUpperCase()+n.slice(1):""}const vAe=["enter","leave"];function xAe(n=!1,e){return n&&!vAe.includes(e)}function bAe(n,e="",t=!1){const i=Fq[n],r=i&&i[e]||e;return"on"+KX(n)+KX(r)+(xAe(t,r)?"Capture":"")}const _Ae=["gotpointercapture","lostpointercapture"];function SAe(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const i=_Ae.includes(e)?"capturecapture":"capture",r=!!~e.indexOf(i);return r&&(e=e.replace("capture","")),{device:e,capture:r,passive:t}}function MAe(n,e=""){const t=Fq[n],i=t&&t[e]||e;return n+i}function R2(n){return"touches"in n}function Lq(n){return R2(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function AAe(n){return Array.from(n.touches).filter(e=>{var t,i;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(i=t.contains)===null||i===void 0?void 0:i.call(t,e.target))})}function TAe(n){return n.type==="touchend"||n.type==="touchcancel"?n.changedTouches:n.targetTouches}function Iq(n){return R2(n)?TAe(n)[0]:n}function CAe(n){return AAe(n).map(e=>e.identifier)}function KI(n){const e=Iq(n);return R2(n)?e.identifier:e.pointerId}function $X(n){const e=Iq(n);return[e.clientX,e.clientY]}function wAe(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:i,metaKey:r,ctrlKey:s}=n;Object.assign(e,{shiftKey:t,altKey:i,metaKey:r,ctrlKey:s})}return e}function hB(n,...e){return typeof n=="function"?n(...e):n}function EAe(){}function RAe(...n){return n.length===0?EAe:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function JX(n,e){return Object.assign({},e,n||{})}const PAe=32;class DAe{constructor(e,t,i){this.ctrl=e,this.args=t,this.key=i,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:i,args:r}=this;t[i]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,i=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=i.from?hB(i.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:i,shared:r}=this;t.args=this.args;let s=0;if(e&&(t.event=e,i.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,wAe(e)),r.down=r.pressed=r.buttons%2===1||r.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const R=t._delta.map(Math.abs);yu.addTo(t._distance,R)}this.axisIntent&&this.axisIntent(e);const[a,o]=t._movement,[l,u]=i.threshold,{_step:c,values:d}=t;if(i.hasCustomTransform?(c[0]===!1&&(c[0]=Math.abs(a)>=l&&d[0]),c[1]===!1&&(c[1]=Math.abs(o)>=u&&d[1])):(c[0]===!1&&(c[0]=Math.abs(a)>=l&&Math.sign(a)*l),c[1]===!1&&(c[1]=Math.abs(o)>=u&&Math.sign(o)*u)),t.intentional=c[0]!==!1||c[1]!==!1,!t.intentional)return;const f=[0,0];if(i.hasCustomTransform){const[R,P]=d;f[0]=c[0]!==!1?R-c[0]:0,f[1]=c[1]!==!1?P-c[1]:0}else f[0]=c[0]!==!1?a-c[0]:0,f[1]=c[1]!==!1?o-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(f);const m=t.offset,y=t._active&&!t._blocked||t.active;y&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in i&&(t._bounds=hB(i.bounds,t)),this.setup&&this.setup()),t.movement=f,this.computeOffset()));const[_,S]=t.offset,[[b,M],[w,T]]=t._bounds;t.overflow=[_<b?-1:_>M?1:0,S<w?-1:S>T?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const E=t._active?i.rubberband||[0,0]:[0,0];if(t.offset=mAe(t._bounds,t.offset,E),t.delta=yu.sub(t.offset,m),this.computeMovement(),y&&(!t.last||s>PAe)){t.delta=yu.sub(t.offset,m);const R=t.delta.map(Math.abs);yu.addTo(t.distance,R),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[R[0]/s,R[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,i=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!i.triggerAllEvents)return;const r=this.handler(Qa(Qa(Qa({},t),e),{},{[this.aliasKey]:e.values}));r!==void 0&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function NAe([n,e],t){const i=Math.abs(n),r=Math.abs(e);if(i>r&&i>t)return"x";if(r>i&&r>t)return"y"}class BAe extends DAe{constructor(...e){super(...e),Ic(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=yu.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=yu.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,i=this.config;if(!t.axis&&e){const r=typeof i.axisThreshold=="object"?i.axisThreshold[Lq(e)]:i.axisThreshold;t.axis=NAe(t._movement,r)}t._blocked=(i.lockDirection||!!i.axis)&&!t.axis||!!i.axis&&i.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const FAe=n=>n,qX=.15,Gq={enabled(n=!0){return n},eventOptions(n,e,t){return Qa(Qa({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[qX,qX];case!1:return[0,0];default:return yu.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return yu.toVector(n)},transform(n,e,t){const i=n||t.shared.transform;return this.hasCustomTransform=!!i,i||FAe},threshold(n){return yu.toVector(n,0)}},LAe=0,DE=Qa(Qa({},Gq),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=LAe){return n},bounds(n={}){if(typeof n=="function")return s=>DE.bounds(n(s));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:i=-1/0,bottom:r=1/0}=n;return[[e,t],[i,r]]}}),QX={ArrowRight:(n,e=1)=>[n*e,0],ArrowLeft:(n,e=1)=>[-1*n*e,0],ArrowUp:(n,e=1)=>[0,-1*n*e],ArrowDown:(n,e=1)=>[0,n*e]};class IAe extends BAe{constructor(...e){super(...e),Ic(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),i=e.currentTarget.getBoundingClientRect(),r={left:t.left-i.left+e.offset[0],right:t.right-i.right+e.offset[0],top:t.top-i.top+e.offset[1],bottom:t.bottom-i.bottom+e.offset[1]};e._bounds=DE.bounds(r)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,i=this.state;if(e.buttons!=null&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):t.pointerButtons!==-1&&t.pointerButtons!==e.buttons))return;const r=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(r&&r.size>1&&i._pointerActive)&&(this.start(e),this.setupPointer(e),i._pointerId=KI(e),i._pointerActive=!0,this.computeValues($X(e)),this.computeInitial(),t.preventScrollAxis&&Lq(e)!=="mouse"?(i._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,i=this.config;if(!t._pointerActive)return;const r=KI(e);if(t._pointerId!==void 0&&r!==t._pointerId)return;const s=$X(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=yu.sub(s,t._values),this.computeValues(s)),yu.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(i.preventScrollAxis&&!t._preventScroll)if(t.axis)if(t.axis===i.preventScrollAxis||i.preventScrollAxis==="xy"){t._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const t=this.state,i=this.config;if(!t._active||!t._pointerActive)return;const r=KI(e);if(t._pointerId!==void 0&&r!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[s,a]=t._distance;if(t.tap=s<=i.tapsThreshold&&a<=i.tapsThreshold,t.tap&&i.filterTaps)t._force=!0;else{const[o,l]=t._delta,[u,c]=t._movement,[d,f]=i.swipe.velocity,[m,y]=i.swipe.distance,_=i.swipe.duration;if(t.elapsedTime<_){const S=Math.abs(o/t.timeDelta),b=Math.abs(l/t.timeDelta);S>d&&Math.abs(u)>m&&(t.swipe[0]=Math.sign(o)),b>f&&Math.abs(c)>y&&(t.swipe[1]=Math.sign(l))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,i=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,i,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,i,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,i,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,GAe(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const t=QX[e.key];if(t){const i=this.state,r=e.shiftKey?10:e.altKey?.1:1;this.start(e),i._delta=t(this.config.keyboardDisplacement,r),i._keyboardActive=!0,yu.addTo(i._movement,i._delta),this.compute(e),this.emit()}}keyUp(e){e.key in QX&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function GAe(n){"persist"in n&&typeof n.persist=="function"&&n.persist()}const NE=typeof window<"u"&&window.document&&window.document.createElement;function Oq(){return NE&&"ontouchstart"in window}function OAe(){return Oq()||NE&&window.navigator.maxTouchPoints>1}function UAe(){return NE&&"onpointerdown"in window}function kAe(){return NE&&"exitPointerLock"in window.document}function zAe(){try{return"constructor"in GestureEvent}catch{return!1}}const gd={isBrowser:NE,gesture:zAe(),touch:Oq(),touchscreen:OAe(),pointer:UAe(),pointerLock:kAe()},VAe=250,HAe=180,XAe=.5,WAe=50,ZAe=250,jAe=10,e7={mouse:0,touch:0,pen:8},YAe=Qa(Qa({},DE),{},{device(n,e,{pointer:{touch:t=!1,lock:i=!1,mouse:r=!1}={}}){return this.pointerLock=i&&gd.pointerLock,gd.touch&&t?"touch":this.pointerLock?"mouse":gd.pointer&&!r?"pointer":gd.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?VAe:void 0,!(!gd.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:i=1,keys:r=!0}={}}){return this.pointerButtons=i,this.keys=r,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:i=3,axis:r=void 0}){const s=yu.toVector(n,t?i:r?1:0);return this.filterTaps=t,this.tapsThreshold=i,s},swipe({velocity:n=XAe,distance:e=WAe,duration:t=ZAe}={}){return{velocity:this.transform(yu.toVector(n)),distance:this.transform(yu.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return HAe;case!1:return 0;default:return n}},axisThreshold(n){return n?Qa(Qa({},e7),n):e7},keyboardDisplacement(n=jAe){return n}});Qa(Qa({},Gq),{},{device(n,e,{shared:t,pointer:{touch:i=!1}={}}){if(t.target&&!gd.touch&&gd.gesture)return"gesture";if(gd.touch&&i)return"touch";if(gd.touchscreen){if(gd.pointer)return"pointer";if(gd.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:i={}}){const r=a=>{const o=JX(hB(t,a),{min:-1/0,max:1/0});return[o.min,o.max]},s=a=>{const o=JX(hB(i,a),{min:-1/0,max:1/0});return[o.min,o.max]};return typeof t!="function"&&typeof i!="function"?[r(),s()]:a=>[r(a),s(a)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",yu.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});Qa(Qa({},DE),{},{mouseOnly:(n=!0)=>n});Qa(Qa({},DE),{},{mouseOnly:(n=!0)=>n});const Uq=new Map,M5=new Map;function KAe(n){Uq.set(n.key,n.engine),M5.set(n.key,n.resolver)}const $Ae={key:"drag",engine:IAe,resolver:YAe};function JAe(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function qAe(n,e){if(n==null)return{};var t=JAe(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}const QAe={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=gd.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},eTe=["target","eventOptions","window","enabled","transform"];function kN(n={},e){const t={};for(const[i,r]of Object.entries(e))switch(typeof r){case"function":t[i]=r.call(t,n[i],i,n);break;case"object":t[i]=kN(n[i],r);break;case"boolean":r&&(t[i]=n[i]);break}return t}function tTe(n,e,t={}){const i=n,{target:r,eventOptions:s,window:a,enabled:o,transform:l}=i,u=qAe(i,eTe);if(t.shared=kN({target:r,eventOptions:s,window:a,enabled:o,transform:l},QAe),e){const c=M5.get(e);t[e]=kN(Qa({shared:t.shared},u),c)}else for(const c in u){const d=M5.get(c);d&&(t[c]=kN(Qa({shared:t.shared},u[c]),d))}return t}class kq{constructor(e,t){Ic(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,i,r,s){const a=this._listeners,o=MAe(t,i),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},u=Qa(Qa({},l),s);e.addEventListener(o,r,u);const c=()=>{e.removeEventListener(o,r,u),a.delete(c)};return a.add(c),c}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class nTe{constructor(){Ic(this,"_timeouts",new Map)}add(e,t,i=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,i,...r))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>{window.clearTimeout(e)}),this._timeouts.clear()}}let iTe=class{constructor(e){Ic(this,"gestures",new Set),Ic(this,"_targetEventStore",new kq(this)),Ic(this,"gestureEventStores",{}),Ic(this,"gestureTimeoutStores",{}),Ic(this,"handlers",{}),Ic(this,"config",{}),Ic(this,"pointerIds",new Set),Ic(this,"touchIds",new Set),Ic(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),rTe(this,e)}setEventIds(e){if(R2(e))return this.touchIds=new Set(CAe(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=tTe(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,i={};let r;if(!(t.target&&(r=t.target(),!r))){if(t.enabled){for(const a of this.gestures){const o=this.config[a],l=t7(i,o.eventOptions,!!r);if(o.enabled){const u=Uq.get(a);new u(this,e,a).bind(l)}}const s=t7(i,t.eventOptions,!!r);for(const a in this.nativeHandlers)s(a,"",o=>this.nativeHandlers[a](Qa(Qa({},this.state.shared),{},{event:o,args:e})),void 0,!0)}for(const s in i)i[s]=RAe(...i[s]);if(!r)return i;for(const s in i){const{device:a,capture:o,passive:l}=SAe(s);this._targetEventStore.add(r,a,"",i[s],{capture:o,passive:l})}}}};function O_(n,e){n.gestures.add(e),n.gestureEventStores[e]=new kq(n,e),n.gestureTimeoutStores[e]=new nTe}function rTe(n,e){e.drag&&O_(n,"drag"),e.wheel&&O_(n,"wheel"),e.scroll&&O_(n,"scroll"),e.move&&O_(n,"move"),e.pinch&&O_(n,"pinch"),e.hover&&O_(n,"hover")}const t7=(n,e,t)=>(i,r,s,a={},o=!1)=>{var l,u;const c=(l=a.capture)!==null&&l!==void 0?l:e.capture,d=(u=a.passive)!==null&&u!==void 0?u:e.passive;let f=o?i:bAe(i,r,c);t&&d&&(f+="Passive"),n[f]=n[f]||[],n[f].push(s)};function sTe(n,e={},t,i){const r=Ie.useMemo(()=>new iTe(n),[]);if(r.applyHandlers(n,i),r.applyConfig(e,t),Ie.useEffect(r.effect.bind(r)),Ie.useEffect(()=>r.clean.bind(r),[]),e.target===void 0)return r.bind.bind(r)}function aTe(n,e){return KAe($Ae),sTe({drag:n},e||{},"drag")}function Gg(n,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(n?.(r),t===!1||!r.defaultPrevented)return e?.(r)}}function zq(n,e=[]){let t=[];function i(s,a){const o=G.createContext(a),l=t.length;t=[...t,a];const u=d=>{const{scope:f,children:m,...y}=d,_=f?.[n]?.[l]||o,S=G.useMemo(()=>y,Object.values(y));return $.jsx(_.Provider,{value:S,children:m})};u.displayName=s+"Provider";function c(d,f){const m=f?.[n]?.[l]||o,y=G.useContext(m);if(y)return y;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[u,c]}const r=()=>{const s=t.map(a=>G.createContext(a));return function(o){const l=o?.[n]||s;return G.useMemo(()=>({[`__scope${n}`]:{...o,[n]:l}}),[o,l])}};return r.scopeName=n,[i,oTe(r,...e)]}function oTe(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const i=n.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const a=i.reduce((o,{useScope:l,scopeName:u})=>{const d=l(s)[`__scope${u}`];return{...o,...d}},{});return G.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return t.scopeName=e.scopeName,t}function lTe(n){const e=uTe(n),t=G.forwardRef((i,r)=>{const{children:s,...a}=i,o=G.Children.toArray(s),l=o.find(hTe);if(l){const u=l.props.children,c=o.map(d=>d===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:d);return $.jsx(e,{...a,ref:r,children:G.isValidElement(u)?G.cloneElement(u,void 0,c):null})}return $.jsx(e,{...a,ref:r,children:s})});return t.displayName=`${n}.Slot`,t}function uTe(n){const e=G.forwardRef((t,i)=>{const{children:r,...s}=t;if(G.isValidElement(r)){const a=fTe(r),o=dTe(s,r.props);return r.type!==G.Fragment&&(o.ref=i?bb(i,a):a),G.cloneElement(r,o)}return G.Children.count(r)>1?G.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var cTe=Symbol("radix.slottable");function hTe(n){return G.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===cTe}function dTe(n,e){const t={...e};for(const i in e){const r=n[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?t[i]=(...o)=>{const l=s(...o);return r(...o),l}:r&&(t[i]=r):i==="style"?t[i]={...r,...s}:i==="className"&&(t[i]=[r,s].filter(Boolean).join(" "))}return{...n,...t}}function fTe(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var pTe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Vq=pTe.reduce((n,e)=>{const t=lTe(`Primitive.${e}`),i=G.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),$.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{});function mTe(n,e){n&&C2.flushSync(()=>n.dispatchEvent(e))}function P2(n){const e=G.useRef(n);return G.useEffect(()=>{e.current=n}),G.useMemo(()=>(...t)=>e.current?.(...t),[])}function gTe(n,e=globalThis?.document){const t=P2(n);G.useEffect(()=>{const i=r=>{r.key==="Escape"&&t(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[t,e])}var yTe="DismissableLayer",A5="dismissableLayer.update",vTe="dismissableLayer.pointerDownOutside",xTe="dismissableLayer.focusOutside",n7,Hq=G.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Xq=G.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:s,onInteractOutside:a,onDismiss:o,...l}=n,u=G.useContext(Hq),[c,d]=G.useState(null),f=c?.ownerDocument??globalThis?.document,[,m]=G.useState({}),y=_b(e,P=>d(P)),_=Array.from(u.layers),[S]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),b=_.indexOf(S),M=c?_.indexOf(c):-1,w=u.layersWithOutsidePointerEventsDisabled.size>0,T=M>=b,E=STe(P=>{const I=P.target,B=[...u.branches].some(N=>N.contains(I));!T||B||(r?.(P),a?.(P),P.defaultPrevented||o?.())},f),R=MTe(P=>{const I=P.target;[...u.branches].some(N=>N.contains(I))||(s?.(P),a?.(P),P.defaultPrevented||o?.())},f);return gTe(P=>{M===u.layers.size-1&&(i?.(P),!P.defaultPrevented&&o&&(P.preventDefault(),o()))},f),G.useEffect(()=>{if(c)return t&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(n7=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(c)),u.layers.add(c),i7(),()=>{t&&u.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=n7)}},[c,f,t,u]),G.useEffect(()=>()=>{c&&(u.layers.delete(c),u.layersWithOutsidePointerEventsDisabled.delete(c),i7())},[c,u]),G.useEffect(()=>{const P=()=>m({});return document.addEventListener(A5,P),()=>document.removeEventListener(A5,P)},[]),$.jsx(Vq.div,{...l,ref:y,style:{pointerEvents:w?T?"auto":"none":void 0,...n.style},onFocusCapture:Gg(n.onFocusCapture,R.onFocusCapture),onBlurCapture:Gg(n.onBlurCapture,R.onBlurCapture),onPointerDownCapture:Gg(n.onPointerDownCapture,E.onPointerDownCapture)})});Xq.displayName=yTe;var bTe="DismissableLayerBranch",_Te=G.forwardRef((n,e)=>{const t=G.useContext(Hq),i=G.useRef(null),r=_b(e,i);return G.useEffect(()=>{const s=i.current;if(s)return t.branches.add(s),()=>{t.branches.delete(s)}},[t.branches]),$.jsx(Vq.div,{...n,ref:r})});_Te.displayName=bTe;function STe(n,e=globalThis?.document){const t=P2(n),i=G.useRef(!1),r=G.useRef(()=>{});return G.useEffect(()=>{const s=o=>{if(o.target&&!i.current){let l=function(){Wq(vTe,t,u,{discrete:!0})};const u={originalEvent:o};o.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=l,e.addEventListener("click",r.current,{once:!0})):l()}else e.removeEventListener("click",r.current);i.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",s),e.removeEventListener("click",r.current)}},[e,t]),{onPointerDownCapture:()=>i.current=!0}}function MTe(n,e=globalThis?.document){const t=P2(n),i=G.useRef(!1);return G.useEffect(()=>{const r=s=>{s.target&&!i.current&&Wq(xTe,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,t]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function i7(){const n=new CustomEvent(A5);document.dispatchEvent(n)}function Wq(n,e,t,{discrete:i}){const r=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&r.addEventListener(n,e,{once:!0}),i?mTe(r,s):r.dispatchEvent(s)}var ATe=Oz[" useId ".trim().toString()]||(()=>{}),TTe=0;function CTe(n){const[e,t]=G.useState(ATe());return ov(()=>{t(i=>i??String(TTe++))},[n]),e?`radix-${e}`:""}const wTe=["top","right","bottom","left"],lv=Math.min,mh=Math.max,dB=Math.round,AP=Math.floor,im=n=>({x:n,y:n}),ETe={left:"right",right:"left",bottom:"top",top:"bottom"},RTe={start:"end",end:"start"};function T5(n,e,t){return mh(n,lv(e,t))}function o0(n,e){return typeof n=="function"?n(e):n}function l0(n){return n.split("-")[0]}function IM(n){return n.split("-")[1]}function Vz(n){return n==="x"?"y":"x"}function Hz(n){return n==="y"?"height":"width"}const PTe=new Set(["top","bottom"]);function em(n){return PTe.has(l0(n))?"y":"x"}function Xz(n){return Vz(em(n))}function DTe(n,e,t){t===void 0&&(t=!1);const i=IM(n),r=Xz(n),s=Hz(r);let a=r==="x"?i===(t?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(a=fB(a)),[a,fB(a)]}function NTe(n){const e=fB(n);return[C5(n),e,C5(e)]}function C5(n){return n.replace(/start|end/g,e=>RTe[e])}const r7=["left","right"],s7=["right","left"],BTe=["top","bottom"],FTe=["bottom","top"];function LTe(n,e,t){switch(n){case"top":case"bottom":return t?e?s7:r7:e?r7:s7;case"left":case"right":return e?BTe:FTe;default:return[]}}function ITe(n,e,t,i){const r=IM(n);let s=LTe(l0(n),t==="start",i);return r&&(s=s.map(a=>a+"-"+r),e&&(s=s.concat(s.map(C5)))),s}function fB(n){return n.replace(/left|right|bottom|top/g,e=>ETe[e])}function GTe(n){return{top:0,right:0,bottom:0,left:0,...n}}function Zq(n){return typeof n!="number"?GTe(n):{top:n,right:n,bottom:n,left:n}}function pB(n){const{x:e,y:t,width:i,height:r}=n;return{width:i,height:r,top:t,left:e,right:e+i,bottom:t+r,x:e,y:t}}function a7(n,e,t){let{reference:i,floating:r}=n;const s=em(e),a=Xz(e),o=Hz(a),l=l0(e),u=s==="y",c=i.x+i.width/2-r.width/2,d=i.y+i.height/2-r.height/2,f=i[o]/2-r[o]/2;let m;switch(l){case"top":m={x:c,y:i.y-r.height};break;case"bottom":m={x:c,y:i.y+i.height};break;case"right":m={x:i.x+i.width,y:d};break;case"left":m={x:i.x-r.width,y:d};break;default:m={x:i.x,y:i.y}}switch(IM(e)){case"start":m[a]-=f*(t&&u?-1:1);break;case"end":m[a]+=f*(t&&u?-1:1);break}return m}const OTe=async(n,e,t)=>{const{placement:i="bottom",strategy:r="absolute",middleware:s=[],platform:a}=t,o=s.filter(Boolean),l=await(a.isRTL==null?void 0:a.isRTL(e));let u=await a.getElementRects({reference:n,floating:e,strategy:r}),{x:c,y:d}=a7(u,i,l),f=i,m={},y=0;for(let _=0;_<o.length;_++){const{name:S,fn:b}=o[_],{x:M,y:w,data:T,reset:E}=await b({x:c,y:d,initialPlacement:i,placement:f,strategy:r,middlewareData:m,rects:u,platform:a,elements:{reference:n,floating:e}});c=M??c,d=w??d,m={...m,[S]:{...m[S],...T}},E&&y<=50&&(y++,typeof E=="object"&&(E.placement&&(f=E.placement),E.rects&&(u=E.rects===!0?await a.getElementRects({reference:n,floating:e,strategy:r}):E.rects),{x:c,y:d}=a7(u,f,l)),_=-1)}return{x:c,y:d,placement:f,strategy:r,middlewareData:m}};async function Iw(n,e){var t;e===void 0&&(e={});const{x:i,y:r,platform:s,rects:a,elements:o,strategy:l}=n,{boundary:u="clippingAncestors",rootBoundary:c="viewport",elementContext:d="floating",altBoundary:f=!1,padding:m=0}=o0(e,n),y=Zq(m),S=o[f?d==="floating"?"reference":"floating":d],b=pB(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(S)))==null||t?S:S.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(o.floating)),boundary:u,rootBoundary:c,strategy:l})),M=d==="floating"?{x:i,y:r,width:a.floating.width,height:a.floating.height}:a.reference,w=await(s.getOffsetParent==null?void 0:s.getOffsetParent(o.floating)),T=await(s.isElement==null?void 0:s.isElement(w))?await(s.getScale==null?void 0:s.getScale(w))||{x:1,y:1}:{x:1,y:1},E=pB(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:M,offsetParent:w,strategy:l}):M);return{top:(b.top-E.top+y.top)/T.y,bottom:(E.bottom-b.bottom+y.bottom)/T.y,left:(b.left-E.left+y.left)/T.x,right:(E.right-b.right+y.right)/T.x}}const UTe=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:i,placement:r,rects:s,platform:a,elements:o,middlewareData:l}=e,{element:u,padding:c=0}=o0(n,e)||{};if(u==null)return{};const d=Zq(c),f={x:t,y:i},m=Xz(r),y=Hz(m),_=await a.getDimensions(u),S=m==="y",b=S?"top":"left",M=S?"bottom":"right",w=S?"clientHeight":"clientWidth",T=s.reference[y]+s.reference[m]-f[m]-s.floating[y],E=f[m]-s.reference[m],R=await(a.getOffsetParent==null?void 0:a.getOffsetParent(u));let P=R?R[w]:0;(!P||!await(a.isElement==null?void 0:a.isElement(R)))&&(P=o.floating[w]||s.floating[y]);const I=T/2-E/2,B=P/2-_[y]/2-1,N=lv(d[b],B),U=lv(d[M],B),V=N,W=P-_[y]-U,K=P/2-_[y]/2+I,q=T5(V,K,W),j=!l.arrow&&IM(r)!=null&&K!==q&&s.reference[y]/2-(K<V?N:U)-_[y]/2<0,te=j?K<V?K-V:K-W:0;return{[m]:f[m]+te,data:{[m]:q,centerOffset:K-q-te,...j&&{alignmentOffset:te}},reset:j}}}),kTe=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,i;const{placement:r,middlewareData:s,rects:a,initialPlacement:o,platform:l,elements:u}=e,{mainAxis:c=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:_=!0,...S}=o0(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const b=l0(r),M=em(o),w=l0(o)===o,T=await(l.isRTL==null?void 0:l.isRTL(u.floating)),E=f||(w||!_?[fB(o)]:NTe(o)),R=y!=="none";!f&&R&&E.push(...ITe(o,_,y,T));const P=[o,...E],I=await Iw(e,S),B=[];let N=((i=s.flip)==null?void 0:i.overflows)||[];if(c&&B.push(I[b]),d){const K=DTe(r,a,T);B.push(I[K[0]],I[K[1]])}if(N=[...N,{placement:r,overflows:B}],!B.every(K=>K<=0)){var U,V;const K=(((U=s.flip)==null?void 0:U.index)||0)+1,q=P[K];if(q&&(!(d==="alignment"?M!==em(q):!1)||N.every(he=>em(he.placement)===M?he.overflows[0]>0:!0)))return{data:{index:K,overflows:N},reset:{placement:q}};let j=(V=N.filter(te=>te.overflows[0]<=0).sort((te,he)=>te.overflows[1]-he.overflows[1])[0])==null?void 0:V.placement;if(!j)switch(m){case"bestFit":{var W;const te=(W=N.filter(he=>{if(R){const _e=em(he.placement);return _e===M||_e==="y"}return!0}).map(he=>[he.placement,he.overflows.filter(_e=>_e>0).reduce((_e,Be)=>_e+Be,0)]).sort((he,_e)=>he[1]-_e[1])[0])==null?void 0:W[0];te&&(j=te);break}case"initialPlacement":j=o;break}if(r!==j)return{reset:{placement:j}}}return{}}}};function o7(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function l7(n){return wTe.some(e=>n[e]>=0)}const zTe=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:i="referenceHidden",...r}=o0(n,e);switch(i){case"referenceHidden":{const s=await Iw(e,{...r,elementContext:"reference"}),a=o7(s,t.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:l7(a)}}}case"escaped":{const s=await Iw(e,{...r,altBoundary:!0}),a=o7(s,t.floating);return{data:{escapedOffsets:a,escaped:l7(a)}}}default:return{}}}}},jq=new Set(["left","top"]);async function VTe(n,e){const{placement:t,platform:i,elements:r}=n,s=await(i.isRTL==null?void 0:i.isRTL(r.floating)),a=l0(t),o=IM(t),l=em(t)==="y",u=jq.has(a)?-1:1,c=s&&l?-1:1,d=o0(e,n);let{mainAxis:f,crossAxis:m,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return o&&typeof y=="number"&&(m=o==="end"?y*-1:y),l?{x:m*c,y:f*u}:{x:f*u,y:m*c}}const HTe=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,i;const{x:r,y:s,placement:a,middlewareData:o}=e,l=await VTe(e,n);return a===((t=o.offset)==null?void 0:t.placement)&&(i=o.arrow)!=null&&i.alignmentOffset?{}:{x:r+l.x,y:s+l.y,data:{...l,placement:a}}}}},XTe=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:i,placement:r}=e,{mainAxis:s=!0,crossAxis:a=!1,limiter:o={fn:S=>{let{x:b,y:M}=S;return{x:b,y:M}}},...l}=o0(n,e),u={x:t,y:i},c=await Iw(e,l),d=em(l0(r)),f=Vz(d);let m=u[f],y=u[d];if(s){const S=f==="y"?"top":"left",b=f==="y"?"bottom":"right",M=m+c[S],w=m-c[b];m=T5(M,m,w)}if(a){const S=d==="y"?"top":"left",b=d==="y"?"bottom":"right",M=y+c[S],w=y-c[b];y=T5(M,y,w)}const _=o.fn({...e,[f]:m,[d]:y});return{..._,data:{x:_.x-t,y:_.y-i,enabled:{[f]:s,[d]:a}}}}}},WTe=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:i,placement:r,rects:s,middlewareData:a}=e,{offset:o=0,mainAxis:l=!0,crossAxis:u=!0}=o0(n,e),c={x:t,y:i},d=em(r),f=Vz(d);let m=c[f],y=c[d];const _=o0(o,e),S=typeof _=="number"?{mainAxis:_,crossAxis:0}:{mainAxis:0,crossAxis:0,..._};if(l){const w=f==="y"?"height":"width",T=s.reference[f]-s.floating[w]+S.mainAxis,E=s.reference[f]+s.reference[w]-S.mainAxis;m<T?m=T:m>E&&(m=E)}if(u){var b,M;const w=f==="y"?"width":"height",T=jq.has(l0(r)),E=s.reference[d]-s.floating[w]+(T&&((b=a.offset)==null?void 0:b[d])||0)+(T?0:S.crossAxis),R=s.reference[d]+s.reference[w]+(T?0:((M=a.offset)==null?void 0:M[d])||0)-(T?S.crossAxis:0);y<E?y=E:y>R&&(y=R)}return{[f]:m,[d]:y}}}},ZTe=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,i;const{placement:r,rects:s,platform:a,elements:o}=e,{apply:l=()=>{},...u}=o0(n,e),c=await Iw(e,u),d=l0(r),f=IM(r),m=em(r)==="y",{width:y,height:_}=s.floating;let S,b;d==="top"||d==="bottom"?(S=d,b=f===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(b=d,S=f==="end"?"top":"bottom");const M=_-c.top-c.bottom,w=y-c.left-c.right,T=lv(_-c[S],M),E=lv(y-c[b],w),R=!e.middlewareData.shift;let P=T,I=E;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(I=w),(i=e.middlewareData.shift)!=null&&i.enabled.y&&(P=M),R&&!f){const N=mh(c.left,0),U=mh(c.right,0),V=mh(c.top,0),W=mh(c.bottom,0);m?I=y-2*(N!==0||U!==0?N+U:mh(c.left,c.right)):P=_-2*(V!==0||W!==0?V+W:mh(c.top,c.bottom))}await l({...e,availableWidth:I,availableHeight:P});const B=await a.getDimensions(o.floating);return y!==B.width||_!==B.height?{reset:{rects:!0}}:{}}}};function D2(){return typeof window<"u"}function GM(n){return Yq(n)?(n.nodeName||"").toLowerCase():"#document"}function Mh(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function Lm(n){var e;return(e=(Yq(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function Yq(n){return D2()?n instanceof Node||n instanceof Mh(n).Node:!1}function Wf(n){return D2()?n instanceof Element||n instanceof Mh(n).Element:!1}function xm(n){return D2()?n instanceof HTMLElement||n instanceof Mh(n).HTMLElement:!1}function u7(n){return!D2()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Mh(n).ShadowRoot}const jTe=new Set(["inline","contents"]);function BE(n){const{overflow:e,overflowX:t,overflowY:i,display:r}=Zf(n);return/auto|scroll|overlay|hidden|clip/.test(e+i+t)&&!jTe.has(r)}const YTe=new Set(["table","td","th"]);function KTe(n){return YTe.has(GM(n))}const $Te=[":popover-open",":modal"];function N2(n){return $Te.some(e=>{try{return n.matches(e)}catch{return!1}})}const JTe=["transform","translate","scale","rotate","perspective"],qTe=["transform","translate","scale","rotate","perspective","filter"],QTe=["paint","layout","strict","content"];function Wz(n){const e=Zz(),t=Wf(n)?Zf(n):n;return JTe.some(i=>t[i]?t[i]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||qTe.some(i=>(t.willChange||"").includes(i))||QTe.some(i=>(t.contain||"").includes(i))}function eCe(n){let e=uv(n);for(;xm(e)&&!dM(e);){if(Wz(e))return e;if(N2(e))return null;e=uv(e)}return null}function Zz(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const tCe=new Set(["html","body","#document"]);function dM(n){return tCe.has(GM(n))}function Zf(n){return Mh(n).getComputedStyle(n)}function B2(n){return Wf(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function uv(n){if(GM(n)==="html")return n;const e=n.assignedSlot||n.parentNode||u7(n)&&n.host||Lm(n);return u7(e)?e.host:e}function Kq(n){const e=uv(n);return dM(e)?n.ownerDocument?n.ownerDocument.body:n.body:xm(e)&&BE(e)?e:Kq(e)}function Gw(n,e,t){var i;e===void 0&&(e=[]),t===void 0&&(t=!0);const r=Kq(n),s=r===((i=n.ownerDocument)==null?void 0:i.body),a=Mh(r);if(s){const o=w5(a);return e.concat(a,a.visualViewport||[],BE(r)?r:[],o&&t?Gw(o):[])}return e.concat(r,Gw(r,[],t))}function w5(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function $q(n){const e=Zf(n);let t=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=xm(n),s=r?n.offsetWidth:t,a=r?n.offsetHeight:i,o=dB(t)!==s||dB(i)!==a;return o&&(t=s,i=a),{width:t,height:i,$:o}}function jz(n){return Wf(n)?n:n.contextElement}function jS(n){const e=jz(n);if(!xm(e))return im(1);const t=e.getBoundingClientRect(),{width:i,height:r,$:s}=$q(e);let a=(s?dB(t.width):t.width)/i,o=(s?dB(t.height):t.height)/r;return(!a||!Number.isFinite(a))&&(a=1),(!o||!Number.isFinite(o))&&(o=1),{x:a,y:o}}const nCe=im(0);function Jq(n){const e=Mh(n);return!Zz()||!e.visualViewport?nCe:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function iCe(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Mh(n)?!1:e}function Zx(n,e,t,i){e===void 0&&(e=!1),t===void 0&&(t=!1);const r=n.getBoundingClientRect(),s=jz(n);let a=im(1);e&&(i?Wf(i)&&(a=jS(i)):a=jS(n));const o=iCe(s,t,i)?Jq(s):im(0);let l=(r.left+o.x)/a.x,u=(r.top+o.y)/a.y,c=r.width/a.x,d=r.height/a.y;if(s){const f=Mh(s),m=i&&Wf(i)?Mh(i):i;let y=f,_=w5(y);for(;_&&i&&m!==y;){const S=jS(_),b=_.getBoundingClientRect(),M=Zf(_),w=b.left+(_.clientLeft+parseFloat(M.paddingLeft))*S.x,T=b.top+(_.clientTop+parseFloat(M.paddingTop))*S.y;l*=S.x,u*=S.y,c*=S.x,d*=S.y,l+=w,u+=T,y=Mh(_),_=w5(y)}}return pB({width:c,height:d,x:l,y:u})}function F2(n,e){const t=B2(n).scrollLeft;return e?e.left+t:Zx(Lm(n)).left+t}function qq(n,e){const t=n.getBoundingClientRect(),i=t.left+e.scrollLeft-F2(n,t),r=t.top+e.scrollTop;return{x:i,y:r}}function rCe(n){let{elements:e,rect:t,offsetParent:i,strategy:r}=n;const s=r==="fixed",a=Lm(i),o=e?N2(e.floating):!1;if(i===a||o&&s)return t;let l={scrollLeft:0,scrollTop:0},u=im(1);const c=im(0),d=xm(i);if((d||!d&&!s)&&((GM(i)!=="body"||BE(a))&&(l=B2(i)),xm(i))){const m=Zx(i);u=jS(i),c.x=m.x+i.clientLeft,c.y=m.y+i.clientTop}const f=a&&!d&&!s?qq(a,l):im(0);return{width:t.width*u.x,height:t.height*u.y,x:t.x*u.x-l.scrollLeft*u.x+c.x+f.x,y:t.y*u.y-l.scrollTop*u.y+c.y+f.y}}function sCe(n){return Array.from(n.getClientRects())}function aCe(n){const e=Lm(n),t=B2(n),i=n.ownerDocument.body,r=mh(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),s=mh(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let a=-t.scrollLeft+F2(n);const o=-t.scrollTop;return Zf(i).direction==="rtl"&&(a+=mh(e.clientWidth,i.clientWidth)-r),{width:r,height:s,x:a,y:o}}const c7=25;function oCe(n,e){const t=Mh(n),i=Lm(n),r=t.visualViewport;let s=i.clientWidth,a=i.clientHeight,o=0,l=0;if(r){s=r.width,a=r.height;const c=Zz();(!c||c&&e==="fixed")&&(o=r.offsetLeft,l=r.offsetTop)}const u=F2(i);if(u<=0){const c=i.ownerDocument,d=c.body,f=getComputedStyle(d),m=c.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,y=Math.abs(i.clientWidth-d.clientWidth-m);y<=c7&&(s-=y)}else u<=c7&&(s+=u);return{width:s,height:a,x:o,y:l}}const lCe=new Set(["absolute","fixed"]);function uCe(n,e){const t=Zx(n,!0,e==="fixed"),i=t.top+n.clientTop,r=t.left+n.clientLeft,s=xm(n)?jS(n):im(1),a=n.clientWidth*s.x,o=n.clientHeight*s.y,l=r*s.x,u=i*s.y;return{width:a,height:o,x:l,y:u}}function h7(n,e,t){let i;if(e==="viewport")i=oCe(n,t);else if(e==="document")i=aCe(Lm(n));else if(Wf(e))i=uCe(e,t);else{const r=Jq(n);i={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return pB(i)}function Qq(n,e){const t=uv(n);return t===e||!Wf(t)||dM(t)?!1:Zf(t).position==="fixed"||Qq(t,e)}function cCe(n,e){const t=e.get(n);if(t)return t;let i=Gw(n,[],!1).filter(o=>Wf(o)&&GM(o)!=="body"),r=null;const s=Zf(n).position==="fixed";let a=s?uv(n):n;for(;Wf(a)&&!dM(a);){const o=Zf(a),l=Wz(a);!l&&o.position==="fixed"&&(r=null),(s?!l&&!r:!l&&o.position==="static"&&!!r&&lCe.has(r.position)||BE(a)&&!l&&Qq(n,a))?i=i.filter(c=>c!==a):r=o,a=uv(a)}return e.set(n,i),i}function hCe(n){let{element:e,boundary:t,rootBoundary:i,strategy:r}=n;const a=[...t==="clippingAncestors"?N2(e)?[]:cCe(e,this._c):[].concat(t),i],o=a[0],l=a.reduce((u,c)=>{const d=h7(e,c,r);return u.top=mh(d.top,u.top),u.right=lv(d.right,u.right),u.bottom=lv(d.bottom,u.bottom),u.left=mh(d.left,u.left),u},h7(e,o,r));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function dCe(n){const{width:e,height:t}=$q(n);return{width:e,height:t}}function fCe(n,e,t){const i=xm(e),r=Lm(e),s=t==="fixed",a=Zx(n,!0,s,e);let o={scrollLeft:0,scrollTop:0};const l=im(0);function u(){l.x=F2(r)}if(i||!i&&!s)if((GM(e)!=="body"||BE(r))&&(o=B2(e)),i){const m=Zx(e,!0,s,e);l.x=m.x+e.clientLeft,l.y=m.y+e.clientTop}else r&&u();s&&!i&&r&&u();const c=r&&!i&&!s?qq(r,o):im(0),d=a.left+o.scrollLeft-l.x-c.x,f=a.top+o.scrollTop-l.y-c.y;return{x:d,y:f,width:a.width,height:a.height}}function $I(n){return Zf(n).position==="static"}function d7(n,e){if(!xm(n)||Zf(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return Lm(n)===t&&(t=t.ownerDocument.body),t}function eQ(n,e){const t=Mh(n);if(N2(n))return t;if(!xm(n)){let r=uv(n);for(;r&&!dM(r);){if(Wf(r)&&!$I(r))return r;r=uv(r)}return t}let i=d7(n,e);for(;i&&KTe(i)&&$I(i);)i=d7(i,e);return i&&dM(i)&&$I(i)&&!Wz(i)?t:i||eCe(n)||t}const pCe=async function(n){const e=this.getOffsetParent||eQ,t=this.getDimensions,i=await t(n.floating);return{reference:fCe(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function mCe(n){return Zf(n).direction==="rtl"}const gCe={convertOffsetParentRelativeRectToViewportRelativeRect:rCe,getDocumentElement:Lm,getClippingRect:hCe,getOffsetParent:eQ,getElementRects:pCe,getClientRects:sCe,getDimensions:dCe,getScale:jS,isElement:Wf,isRTL:mCe};function tQ(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function yCe(n,e){let t=null,i;const r=Lm(n);function s(){var o;clearTimeout(i),(o=t)==null||o.disconnect(),t=null}function a(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),s();const u=n.getBoundingClientRect(),{left:c,top:d,width:f,height:m}=u;if(o||e(),!f||!m)return;const y=AP(d),_=AP(r.clientWidth-(c+f)),S=AP(r.clientHeight-(d+m)),b=AP(c),w={rootMargin:-y+"px "+-_+"px "+-S+"px "+-b+"px",threshold:mh(0,lv(1,l))||1};let T=!0;function E(R){const P=R[0].intersectionRatio;if(P!==l){if(!T)return a();P?a(!1,P):i=setTimeout(()=>{a(!1,1e-7)},1e3)}P===1&&!tQ(u,n.getBoundingClientRect())&&a(),T=!1}try{t=new IntersectionObserver(E,{...w,root:r.ownerDocument})}catch{t=new IntersectionObserver(E,w)}t.observe(n)}return a(!0),s}function vCe(n,e,t,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=i,u=jz(n),c=r||s?[...u?Gw(u):[],...Gw(e)]:[];c.forEach(b=>{r&&b.addEventListener("scroll",t,{passive:!0}),s&&b.addEventListener("resize",t)});const d=u&&o?yCe(u,t):null;let f=-1,m=null;a&&(m=new ResizeObserver(b=>{let[M]=b;M&&M.target===u&&m&&(m.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var w;(w=m)==null||w.observe(e)})),t()}),u&&!l&&m.observe(u),m.observe(e));let y,_=l?Zx(n):null;l&&S();function S(){const b=Zx(n);_&&!tQ(_,b)&&t(),_=b,y=requestAnimationFrame(S)}return t(),()=>{var b;c.forEach(M=>{r&&M.removeEventListener("scroll",t),s&&M.removeEventListener("resize",t)}),d?.(),(b=m)==null||b.disconnect(),m=null,l&&cancelAnimationFrame(y)}}const xCe=HTe,bCe=XTe,_Ce=kTe,SCe=ZTe,MCe=zTe,f7=UTe,ACe=WTe,TCe=(n,e,t)=>{const i=new Map,r={platform:gCe,...t},s={...r.platform,_c:i};return OTe(n,e,{...r,platform:s})};var CCe=typeof document<"u",wCe=function(){},zN=CCe?G.useLayoutEffect:wCe;function mB(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,i,r;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(i=t;i--!==0;)if(!mB(n[i],e[i]))return!1;return!0}if(r=Object.keys(n),t=r.length,t!==Object.keys(e).length)return!1;for(i=t;i--!==0;)if(!{}.hasOwnProperty.call(e,r[i]))return!1;for(i=t;i--!==0;){const s=r[i];if(!(s==="_owner"&&n.$$typeof)&&!mB(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function nQ(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function p7(n,e){const t=nQ(n);return Math.round(e*t)/t}function JI(n){const e=G.useRef(n);return zN(()=>{e.current=n}),e}function ECe(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:i=[],platform:r,elements:{reference:s,floating:a}={},transform:o=!0,whileElementsMounted:l,open:u}=n,[c,d]=G.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[f,m]=G.useState(i);mB(f,i)||m(i);const[y,_]=G.useState(null),[S,b]=G.useState(null),M=G.useCallback(he=>{he!==R.current&&(R.current=he,_(he))},[]),w=G.useCallback(he=>{he!==P.current&&(P.current=he,b(he))},[]),T=s||y,E=a||S,R=G.useRef(null),P=G.useRef(null),I=G.useRef(c),B=l!=null,N=JI(l),U=JI(r),V=JI(u),W=G.useCallback(()=>{if(!R.current||!P.current)return;const he={placement:e,strategy:t,middleware:f};U.current&&(he.platform=U.current),TCe(R.current,P.current,he).then(_e=>{const Be={..._e,isPositioned:V.current!==!1};K.current&&!mB(I.current,Be)&&(I.current=Be,C2.flushSync(()=>{d(Be)}))})},[f,e,t,U,V]);zN(()=>{u===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,d(he=>({...he,isPositioned:!1})))},[u]);const K=G.useRef(!1);zN(()=>(K.current=!0,()=>{K.current=!1}),[]),zN(()=>{if(T&&(R.current=T),E&&(P.current=E),T&&E){if(N.current)return N.current(T,E,W);W()}},[T,E,W,N,B]);const q=G.useMemo(()=>({reference:R,floating:P,setReference:M,setFloating:w}),[M,w]),j=G.useMemo(()=>({reference:T,floating:E}),[T,E]),te=G.useMemo(()=>{const he={position:t,left:0,top:0};if(!j.floating)return he;const _e=p7(j.floating,c.x),Be=p7(j.floating,c.y);return o?{...he,transform:"translate("+_e+"px, "+Be+"px)",...nQ(j.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:_e,top:Be}},[t,o,j.floating,c.x,c.y]);return G.useMemo(()=>({...c,update:W,refs:q,elements:j,floatingStyles:te}),[c,W,q,j,te])}const RCe=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:i,padding:r}=typeof n=="function"?n(t):n;return i&&e(i)?i.current!=null?f7({element:i.current,padding:r}).fn(t):{}:i?f7({element:i,padding:r}).fn(t):{}}}},PCe=(n,e)=>({...xCe(n),options:[n,e]}),DCe=(n,e)=>({...bCe(n),options:[n,e]}),NCe=(n,e)=>({...ACe(n),options:[n,e]}),BCe=(n,e)=>({..._Ce(n),options:[n,e]}),FCe=(n,e)=>({...SCe(n),options:[n,e]}),LCe=(n,e)=>({...MCe(n),options:[n,e]}),ICe=(n,e)=>({...RCe(n),options:[n,e]});function GCe(n){const e=OCe(n),t=G.forwardRef((i,r)=>{const{children:s,...a}=i,o=G.Children.toArray(s),l=o.find(kCe);if(l){const u=l.props.children,c=o.map(d=>d===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:d);return $.jsx(e,{...a,ref:r,children:G.isValidElement(u)?G.cloneElement(u,void 0,c):null})}return $.jsx(e,{...a,ref:r,children:s})});return t.displayName=`${n}.Slot`,t}function OCe(n){const e=G.forwardRef((t,i)=>{const{children:r,...s}=t;if(G.isValidElement(r)){const a=VCe(r),o=zCe(s,r.props);return r.type!==G.Fragment&&(o.ref=i?bb(i,a):a),G.cloneElement(r,o)}return G.Children.count(r)>1?G.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var UCe=Symbol("radix.slottable");function kCe(n){return G.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===UCe}function zCe(n,e){const t={...e};for(const i in e){const r=n[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?t[i]=(...o)=>{const l=s(...o);return r(...o),l}:r&&(t[i]=r):i==="style"?t[i]={...r,...s}:i==="className"&&(t[i]=[r,s].filter(Boolean).join(" "))}return{...n,...t}}function VCe(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var HCe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],XCe=HCe.reduce((n,e)=>{const t=GCe(`Primitive.${e}`),i=G.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),$.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),WCe="Arrow",iQ=G.forwardRef((n,e)=>{const{children:t,width:i=10,height:r=5,...s}=n;return $.jsx(XCe.svg,{...s,ref:e,width:i,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:$.jsx("polygon",{points:"0,0 30,0 15,10"})})});iQ.displayName=WCe;var ZCe=iQ;function jCe(n){const e=YCe(n),t=G.forwardRef((i,r)=>{const{children:s,...a}=i,o=G.Children.toArray(s),l=o.find($Ce);if(l){const u=l.props.children,c=o.map(d=>d===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:d);return $.jsx(e,{...a,ref:r,children:G.isValidElement(u)?G.cloneElement(u,void 0,c):null})}return $.jsx(e,{...a,ref:r,children:s})});return t.displayName=`${n}.Slot`,t}function YCe(n){const e=G.forwardRef((t,i)=>{const{children:r,...s}=t;if(G.isValidElement(r)){const a=qCe(r),o=JCe(s,r.props);return r.type!==G.Fragment&&(o.ref=i?bb(i,a):a),G.cloneElement(r,o)}return G.Children.count(r)>1?G.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var KCe=Symbol("radix.slottable");function $Ce(n){return G.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===KCe}function JCe(n,e){const t={...e};for(const i in e){const r=n[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?t[i]=(...o)=>{const l=s(...o);return r(...o),l}:r&&(t[i]=r):i==="style"?t[i]={...r,...s}:i==="className"&&(t[i]=[r,s].filter(Boolean).join(" "))}return{...n,...t}}function qCe(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var QCe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],rQ=QCe.reduce((n,e)=>{const t=jCe(`Primitive.${e}`),i=G.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),$.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{});function ewe(n){const[e,t]=G.useState(void 0);return ov(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const i=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const s=r[0];let a,o;if("borderBoxSize"in s){const l=s.borderBoxSize,u=Array.isArray(l)?l[0]:l;a=u.inlineSize,o=u.blockSize}else a=n.offsetWidth,o=n.offsetHeight;t({width:a,height:o})});return i.observe(n,{box:"border-box"}),()=>i.unobserve(n)}else t(void 0)},[n]),e}var Yz="Popper",[sQ,aQ]=zq(Yz),[twe,oQ]=sQ(Yz),lQ=n=>{const{__scopePopper:e,children:t}=n,[i,r]=G.useState(null);return $.jsx(twe,{scope:e,anchor:i,onAnchorChange:r,children:t})};lQ.displayName=Yz;var uQ="PopperAnchor",cQ=G.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:i,...r}=n,s=oQ(uQ,t),a=G.useRef(null),o=_b(e,a),l=G.useRef(null);return G.useEffect(()=>{const u=l.current;l.current=i?.current||a.current,u!==l.current&&s.onAnchorChange(l.current)}),i?null:$.jsx(rQ.div,{...r,ref:o})});cQ.displayName=uQ;var Kz="PopperContent",[nwe,iwe]=sQ(Kz),hQ=G.forwardRef((n,e)=>{const{__scopePopper:t,side:i="bottom",sideOffset:r=0,align:s="center",alignOffset:a=0,arrowPadding:o=0,avoidCollisions:l=!0,collisionBoundary:u=[],collisionPadding:c=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:m="optimized",onPlaced:y,..._}=n,S=oQ(Kz,t),[b,M]=G.useState(null),w=_b(e,Ye=>M(Ye)),[T,E]=G.useState(null),R=ewe(T),P=R?.width??0,I=R?.height??0,B=i+(s!=="center"?"-"+s:""),N=typeof c=="number"?c:{top:0,right:0,bottom:0,left:0,...c},U=Array.isArray(u)?u:[u],V=U.length>0,W={padding:N,boundary:U.filter(swe),altBoundary:V},{refs:K,floatingStyles:q,placement:j,isPositioned:te,middlewareData:he}=ECe({strategy:"fixed",placement:B,whileElementsMounted:(...Ye)=>vCe(...Ye,{animationFrame:m==="always"}),elements:{reference:S.anchor},middleware:[PCe({mainAxis:r+I,alignmentAxis:a}),l&&DCe({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?NCe():void 0,...W}),l&&BCe({...W}),FCe({...W,apply:({elements:Ye,rects:ft,availableWidth:ze,availableHeight:ot})=>{const{width:ut,height:Wt}=ft.reference,It=Ye.floating.style;It.setProperty("--radix-popper-available-width",`${ze}px`),It.setProperty("--radix-popper-available-height",`${ot}px`),It.setProperty("--radix-popper-anchor-width",`${ut}px`),It.setProperty("--radix-popper-anchor-height",`${Wt}px`)}}),T&&ICe({element:T,padding:o}),awe({arrowWidth:P,arrowHeight:I}),f&&LCe({strategy:"referenceHidden",...W})]}),[_e,Be]=pQ(j),ue=P2(y);ov(()=>{te&&ue?.()},[te,ue]);const ce=he.arrow?.x,Ce=he.arrow?.y,Oe=he.arrow?.centerOffset!==0,[nt,Ae]=G.useState();return ov(()=>{b&&Ae(window.getComputedStyle(b).zIndex)},[b]),$.jsx("div",{ref:K.setFloating,"data-radix-popper-content-wrapper":"",style:{...q,transform:te?q.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:nt,"--radix-popper-transform-origin":[he.transformOrigin?.x,he.transformOrigin?.y].join(" "),...he.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:$.jsx(nwe,{scope:t,placedSide:_e,onArrowChange:E,arrowX:ce,arrowY:Ce,shouldHideArrow:Oe,children:$.jsx(rQ.div,{"data-side":_e,"data-align":Be,..._,ref:w,style:{..._.style,animation:te?void 0:"none"}})})})});hQ.displayName=Kz;var dQ="PopperArrow",rwe={top:"bottom",right:"left",bottom:"top",left:"right"},fQ=G.forwardRef(function(e,t){const{__scopePopper:i,...r}=e,s=iwe(dQ,i),a=rwe[s.placedSide];return $.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:$.jsx(ZCe,{...r,ref:t,style:{...r.style,display:"block"}})})});fQ.displayName=dQ;function swe(n){return n!==null}var awe=n=>({name:"transformOrigin",options:n,fn(e){const{placement:t,rects:i,middlewareData:r}=e,a=r.arrow?.centerOffset!==0,o=a?0:n.arrowWidth,l=a?0:n.arrowHeight,[u,c]=pQ(t),d={start:"0%",center:"50%",end:"100%"}[c],f=(r.arrow?.x??0)+o/2,m=(r.arrow?.y??0)+l/2;let y="",_="";return u==="bottom"?(y=a?d:`${f}px`,_=`${-l}px`):u==="top"?(y=a?d:`${f}px`,_=`${i.floating.height+l}px`):u==="right"?(y=`${-l}px`,_=a?d:`${m}px`):u==="left"&&(y=`${i.floating.width+l}px`,_=a?d:`${m}px`),{data:{x:y,y:_}}}});function pQ(n){const[e,t="center"]=n.split("-");return[e,t]}var owe=lQ,lwe=cQ,uwe=hQ,cwe=fQ;function hwe(n){const e=dwe(n),t=G.forwardRef((i,r)=>{const{children:s,...a}=i,o=G.Children.toArray(s),l=o.find(pwe);if(l){const u=l.props.children,c=o.map(d=>d===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:d);return $.jsx(e,{...a,ref:r,children:G.isValidElement(u)?G.cloneElement(u,void 0,c):null})}return $.jsx(e,{...a,ref:r,children:s})});return t.displayName=`${n}.Slot`,t}function dwe(n){const e=G.forwardRef((t,i)=>{const{children:r,...s}=t;if(G.isValidElement(r)){const a=gwe(r),o=mwe(s,r.props);return r.type!==G.Fragment&&(o.ref=i?bb(i,a):a),G.cloneElement(r,o)}return G.Children.count(r)>1?G.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var mQ=Symbol("radix.slottable");function fwe(n){const e=({children:t})=>$.jsx($.Fragment,{children:t});return e.displayName=`${n}.Slottable`,e.__radixId=mQ,e}function pwe(n){return G.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===mQ}function mwe(n,e){const t={...e};for(const i in e){const r=n[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?t[i]=(...o)=>{const l=s(...o);return r(...o),l}:r&&(t[i]=r):i==="style"?t[i]={...r,...s}:i==="className"&&(t[i]=[r,s].filter(Boolean).join(" "))}return{...n,...t}}function gwe(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var ywe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],vwe=ywe.reduce((n,e)=>{const t=hwe(`Primitive.${e}`),i=G.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),$.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{});function xwe(n,e){return G.useReducer((t,i)=>e[t][i]??t,n)}var gQ=n=>{const{present:e,children:t}=n,i=bwe(e),r=typeof t=="function"?t({present:i.isPresent}):G.Children.only(t),s=_b(i.ref,_we(r));return typeof t=="function"||i.isPresent?G.cloneElement(r,{ref:s}):null};gQ.displayName="Presence";function bwe(n){const[e,t]=G.useState(),i=G.useRef(null),r=G.useRef(n),s=G.useRef("none"),a=n?"mounted":"unmounted",[o,l]=xwe(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return G.useEffect(()=>{const u=TP(i.current);s.current=o==="mounted"?u:"none"},[o]),ov(()=>{const u=i.current,c=r.current;if(c!==n){const f=s.current,m=TP(u);n?l("MOUNT"):m==="none"||u?.display==="none"?l("UNMOUNT"):l(c&&f!==m?"ANIMATION_OUT":"UNMOUNT"),r.current=n}},[n,l]),ov(()=>{if(e){let u;const c=e.ownerDocument.defaultView??window,d=m=>{const _=TP(i.current).includes(CSS.escape(m.animationName));if(m.target===e&&_&&(l("ANIMATION_END"),!r.current)){const S=e.style.animationFillMode;e.style.animationFillMode="forwards",u=c.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=S)})}},f=m=>{m.target===e&&(s.current=TP(i.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{c.clearTimeout(u),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:G.useCallback(u=>{i.current=u?getComputedStyle(u):null,t(u)},[])}}function TP(n){return n?.animationName||"none"}function _we(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Swe=Oz[" useInsertionEffect ".trim().toString()]||ov;function Mwe({prop:n,defaultProp:e,onChange:t=()=>{},caller:i}){const[r,s,a]=Awe({defaultProp:e,onChange:t}),o=n!==void 0,l=o?n:r;{const c=G.useRef(n!==void 0);G.useEffect(()=>{const d=c.current;d!==o&&console.warn(`${i} is changing from ${d?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),c.current=o},[o,i])}const u=G.useCallback(c=>{if(o){const d=Twe(c)?c(n):c;d!==n&&a.current?.(d)}else s(c)},[o,n,s,a]);return[l,u]}function Awe({defaultProp:n,onChange:e}){const[t,i]=G.useState(n),r=G.useRef(t),s=G.useRef(e);return Swe(()=>{s.current=e},[e]),G.useEffect(()=>{r.current!==t&&(s.current?.(t),r.current=t)},[t,r]),[t,i,s]}function Twe(n){return typeof n=="function"}function Cwe(n){const e=wwe(n),t=G.forwardRef((i,r)=>{const{children:s,...a}=i,o=G.Children.toArray(s),l=o.find(Rwe);if(l){const u=l.props.children,c=o.map(d=>d===l?G.Children.count(u)>1?G.Children.only(null):G.isValidElement(u)?u.props.children:null:d);return $.jsx(e,{...a,ref:r,children:G.isValidElement(u)?G.cloneElement(u,void 0,c):null})}return $.jsx(e,{...a,ref:r,children:s})});return t.displayName=`${n}.Slot`,t}function wwe(n){const e=G.forwardRef((t,i)=>{const{children:r,...s}=t;if(G.isValidElement(r)){const a=Dwe(r),o=Pwe(s,r.props);return r.type!==G.Fragment&&(o.ref=i?bb(i,a):a),G.cloneElement(r,o)}return G.Children.count(r)>1?G.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var Ewe=Symbol("radix.slottable");function Rwe(n){return G.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===Ewe}function Pwe(n,e){const t={...e};for(const i in e){const r=n[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?t[i]=(...o)=>{const l=s(...o);return r(...o),l}:r&&(t[i]=r):i==="style"?t[i]={...r,...s}:i==="className"&&(t[i]=[r,s].filter(Boolean).join(" "))}return{...n,...t}}function Dwe(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Nwe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Bwe=Nwe.reduce((n,e)=>{const t=Cwe(`Primitive.${e}`),i=G.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),$.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),Fwe=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Lwe="VisuallyHidden",yQ=G.forwardRef((n,e)=>$.jsx(Bwe.span,{...n,ref:e,style:{...Fwe,...n.style}}));yQ.displayName=Lwe;var Iwe=yQ,[L2]=zq("Tooltip",[aQ]),I2=aQ(),vQ="TooltipProvider",Gwe=700,E5="tooltip.open",[Owe,$z]=L2(vQ),xQ=n=>{const{__scopeTooltip:e,delayDuration:t=Gwe,skipDelayDuration:i=300,disableHoverableContent:r=!1,children:s}=n,a=G.useRef(!0),o=G.useRef(!1),l=G.useRef(0);return G.useEffect(()=>{const u=l.current;return()=>window.clearTimeout(u)},[]),$.jsx(Owe,{scope:e,isOpenDelayedRef:a,delayDuration:t,onOpen:G.useCallback(()=>{window.clearTimeout(l.current),a.current=!1},[]),onClose:G.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.current=!0,i)},[i]),isPointerInTransitRef:o,onPointerInTransitChange:G.useCallback(u=>{o.current=u},[]),disableHoverableContent:r,children:s})};xQ.displayName=vQ;var Ow="Tooltip",[Uwe,G2]=L2(Ow),bQ=n=>{const{__scopeTooltip:e,children:t,open:i,defaultOpen:r,onOpenChange:s,disableHoverableContent:a,delayDuration:o}=n,l=$z(Ow,n.__scopeTooltip),u=I2(e),[c,d]=G.useState(null),f=CTe(),m=G.useRef(0),y=a??l.disableHoverableContent,_=o??l.delayDuration,S=G.useRef(!1),[b,M]=Mwe({prop:i,defaultProp:r??!1,onChange:P=>{P?(l.onOpen(),document.dispatchEvent(new CustomEvent(E5))):l.onClose(),s?.(P)},caller:Ow}),w=G.useMemo(()=>b?S.current?"delayed-open":"instant-open":"closed",[b]),T=G.useCallback(()=>{window.clearTimeout(m.current),m.current=0,S.current=!1,M(!0)},[M]),E=G.useCallback(()=>{window.clearTimeout(m.current),m.current=0,M(!1)},[M]),R=G.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>{S.current=!0,M(!0),m.current=0},_)},[_,M]);return G.useEffect(()=>()=>{m.current&&(window.clearTimeout(m.current),m.current=0)},[]),$.jsx(owe,{...u,children:$.jsx(Uwe,{scope:e,contentId:f,open:b,stateAttribute:w,trigger:c,onTriggerChange:d,onTriggerEnter:G.useCallback(()=>{l.isOpenDelayedRef.current?R():T()},[l.isOpenDelayedRef,R,T]),onTriggerLeave:G.useCallback(()=>{y?E():(window.clearTimeout(m.current),m.current=0)},[E,y]),onOpen:T,onClose:E,disableHoverableContent:y,children:t})})};bQ.displayName=Ow;var R5="TooltipTrigger",_Q=G.forwardRef((n,e)=>{const{__scopeTooltip:t,...i}=n,r=G2(R5,t),s=$z(R5,t),a=I2(t),o=G.useRef(null),l=_b(e,o,r.onTriggerChange),u=G.useRef(!1),c=G.useRef(!1),d=G.useCallback(()=>u.current=!1,[]);return G.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),$.jsx(lwe,{asChild:!0,...a,children:$.jsx(vwe.button,{"aria-describedby":r.open?r.contentId:void 0,"data-state":r.stateAttribute,...i,ref:l,onPointerMove:Gg(n.onPointerMove,f=>{f.pointerType!=="touch"&&!c.current&&!s.isPointerInTransitRef.current&&(r.onTriggerEnter(),c.current=!0)}),onPointerLeave:Gg(n.onPointerLeave,()=>{r.onTriggerLeave(),c.current=!1}),onPointerDown:Gg(n.onPointerDown,()=>{r.open&&r.onClose(),u.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Gg(n.onFocus,()=>{u.current||r.onOpen()}),onBlur:Gg(n.onBlur,r.onClose),onClick:Gg(n.onClick,r.onClose)})})});_Q.displayName=R5;var kwe="TooltipPortal",[Xmt,zwe]=L2(kwe,{forceMount:void 0}),fM="TooltipContent",SQ=G.forwardRef((n,e)=>{const t=zwe(fM,n.__scopeTooltip),{forceMount:i=t.forceMount,side:r="top",...s}=n,a=G2(fM,n.__scopeTooltip);return $.jsx(gQ,{present:i||a.open,children:a.disableHoverableContent?$.jsx(MQ,{side:r,...s,ref:e}):$.jsx(Vwe,{side:r,...s,ref:e})})}),Vwe=G.forwardRef((n,e)=>{const t=G2(fM,n.__scopeTooltip),i=$z(fM,n.__scopeTooltip),r=G.useRef(null),s=_b(e,r),[a,o]=G.useState(null),{trigger:l,onClose:u}=t,c=r.current,{onPointerInTransitChange:d}=i,f=G.useCallback(()=>{o(null),d(!1)},[d]),m=G.useCallback((y,_)=>{const S=y.currentTarget,b={x:y.clientX,y:y.clientY},M=Zwe(b,S.getBoundingClientRect()),w=jwe(b,M),T=Ywe(_.getBoundingClientRect()),E=$we([...w,...T]);o(E),d(!0)},[d]);return G.useEffect(()=>()=>f(),[f]),G.useEffect(()=>{if(l&&c){const y=S=>m(S,c),_=S=>m(S,l);return l.addEventListener("pointerleave",y),c.addEventListener("pointerleave",_),()=>{l.removeEventListener("pointerleave",y),c.removeEventListener("pointerleave",_)}}},[l,c,m,f]),G.useEffect(()=>{if(a){const y=_=>{const S=_.target,b={x:_.clientX,y:_.clientY},M=l?.contains(S)||c?.contains(S),w=!Kwe(b,a);M?f():w&&(f(),u())};return document.addEventListener("pointermove",y),()=>document.removeEventListener("pointermove",y)}},[l,c,a,u,f]),$.jsx(MQ,{...n,ref:s})}),[Hwe,Xwe]=L2(Ow,{isInside:!1}),Wwe=fwe("TooltipContent"),MQ=G.forwardRef((n,e)=>{const{__scopeTooltip:t,children:i,"aria-label":r,onEscapeKeyDown:s,onPointerDownOutside:a,...o}=n,l=G2(fM,t),u=I2(t),{onClose:c}=l;return G.useEffect(()=>(document.addEventListener(E5,c),()=>document.removeEventListener(E5,c)),[c]),G.useEffect(()=>{if(l.trigger){const d=f=>{f.target?.contains(l.trigger)&&c()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,c]),$.jsx(Xq,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:a,onFocusOutside:d=>d.preventDefault(),onDismiss:c,children:$.jsxs(uwe,{"data-state":l.stateAttribute,...u,...o,ref:e,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[$.jsx(Wwe,{children:i}),$.jsx(Hwe,{scope:t,isInside:!0,children:$.jsx(Iwe,{id:l.contentId,role:"tooltip",children:r||i})})]})})});SQ.displayName=fM;var AQ="TooltipArrow",TQ=G.forwardRef((n,e)=>{const{__scopeTooltip:t,...i}=n,r=I2(t);return Xwe(AQ,t).isInside?null:$.jsx(cwe,{...r,...i,ref:e})});TQ.displayName=AQ;function Zwe(n,e){const t=Math.abs(e.top-n.y),i=Math.abs(e.bottom-n.y),r=Math.abs(e.right-n.x),s=Math.abs(e.left-n.x);switch(Math.min(t,i,r,s)){case s:return"left";case r:return"right";case t:return"top";case i:return"bottom";default:throw new Error("unreachable")}}function jwe(n,e,t=5){const i=[];switch(e){case"top":i.push({x:n.x-t,y:n.y+t},{x:n.x+t,y:n.y+t});break;case"bottom":i.push({x:n.x-t,y:n.y-t},{x:n.x+t,y:n.y-t});break;case"left":i.push({x:n.x+t,y:n.y-t},{x:n.x+t,y:n.y+t});break;case"right":i.push({x:n.x-t,y:n.y-t},{x:n.x-t,y:n.y+t});break}return i}function Ywe(n){const{top:e,right:t,bottom:i,left:r}=n;return[{x:r,y:e},{x:t,y:e},{x:t,y:i},{x:r,y:i}]}function Kwe(n,e){const{x:t,y:i}=n;let r=!1;for(let s=0,a=e.length-1;s<e.length;a=s++){const o=e[s],l=e[a],u=o.x,c=o.y,d=l.x,f=l.y;c>i!=f>i&&t<(d-u)*(i-c)/(f-c)+u&&(r=!r)}return r}function $we(n){const e=n.slice();return e.sort((t,i)=>t.x<i.x?-1:t.x>i.x?1:t.y<i.y?-1:t.y>i.y?1:0),Jwe(e)}function Jwe(n){if(n.length<=1)return n.slice();const e=[];for(let i=0;i<n.length;i++){const r=n[i];for(;e.length>=2;){const s=e[e.length-1],a=e[e.length-2];if((s.x-a.x)*(r.y-a.y)>=(s.y-a.y)*(r.x-a.x))e.pop();else break}e.push(r)}e.pop();const t=[];for(let i=n.length-1;i>=0;i--){const r=n[i];for(;t.length>=2;){const s=t[t.length-1],a=t[t.length-2];if((s.x-a.x)*(r.y-a.y)>=(s.y-a.y)*(r.x-a.x))t.pop();else break}t.push(r)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}var qwe=xQ,Qwe=bQ,eEe=_Q,tEe=SQ,nEe=TQ;function iEe(n,e){if(n==null)return{};var t={};for(var i in n)if({}.hasOwnProperty.call(n,i)){if(e.indexOf(i)!==-1)continue;t[i]=n[i]}return t}function Hs(n,e){if(n==null)return{};var t,i,r=iEe(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)t=s[i],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}let Uo=(function(n){return n[n.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",n[n.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",n[n.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",n[n.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",n[n.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",n[n.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",n[n.THEME_ERROR=6]="THEME_ERROR",n[n.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",n[n.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",n[n.EMPTY_KEY=9]="EMPTY_KEY",n})({});const rEe={[Uo.UNSUPPORTED_INPUT]:(n,e)=>[`An input with type \`${n}\` input was found at path \`${e}\` but it's not supported yet.`],[Uo.NO_COMPONENT_FOR_TYPE]:(n,e)=>[`Type \`${n}\` found at path \`${e}\` can't be displayed in panel because no component supports it yet.`],[Uo.UNKNOWN_INPUT]:(n,e)=>[`input at path \`${n}\` is not recognized.`,e],[Uo.DUPLICATE_KEYS]:(n,e,t)=>[`Key \`${n}\` of path \`${e}\` already exists at path \`${t}\`. Even nested keys need to be unique. Rename one of the keys.`],[Uo.ALREADY_REGISTERED_TYPE]:n=>[`Type ${n} has already been registered. You can't register a component with the same type.`],[Uo.CLIPBOARD_ERROR]:n=>["Error copying the value",n],[Uo.THEME_ERROR]:(n,e)=>[`Error accessing the theme \`${n}.${e}\` value.`],[Uo.PATH_DOESNT_EXIST]:n=>[`Error getting the value at path \`${n}\`. There is probably an error in your \`render\` function.`],[Uo.INPUT_TYPE_OVERRIDE]:(n,e,t)=>[`Input at path \`${n}\` already exists with type: \`${e}\`. Its type cannot be overridden with type \`${t}\`.`],[Uo.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function CQ(n,e,...t){const i=rEe[e],[r,...s]=i(...t);console[n]("LEVA: "+r,...s)}const zg=CQ.bind(null,"warn"),sEe=CQ.bind(null,"log"),aEe=["value"],oEe=["schema"],lEe=["value"],wQ=[],jx={};function m7(n){let{value:e}=n,t=Hs(n,aEe);for(let i of wQ){const r=i(e,t);if(r)return r}}function S0(n,e){let{schema:t}=e,i=Hs(e,oEe);if(n in jx){zg(Uo.ALREADY_REGISTERED_TYPE,n);return}wQ.push((r,s)=>t(r,s)&&n),jx[n]=i}function qI(n,e,t,i){const{normalize:r}=jx[n];if(r)return r(e,t,i);if(typeof e!="object"||!("value"in e))return{value:e};const{value:s}=e,a=Hs(e,lEe);return{value:s,settings:a}}function uEe(n,e,t,i,r,s){const{sanitize:a}=jx[n];return a?a(e,t,i,r,s):e}function g7(n,e,t){const{format:i}=jx[n];return i?i(e,t):e}function cEe(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function hEe(n){var e=cEe(n,"string");return typeof e=="symbol"?e:e+""}function dEe(n,e,t){return(e=hEe(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function y7(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Di(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?y7(Object(t),!0).forEach(function(i){dEe(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):y7(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const cv=(n,e,t)=>n>t?t:n<e?e:n,fEe=n=>{if(n===""||typeof n=="number")return n;try{const e=LS(n);if(!isNaN(e))return e}catch{}return parseFloat(n)},pEe=Math.log(10);function v7(n){let e=Math.abs(+String(n).replace(".",""));if(e===0)return .01;for(;e!==0&&e%10===0;)e/=10;const t=Math.floor(Math.log(e)/pEe)+1,i=Math.floor(Math.log10(Math.abs(n))),r=Math.pow(10,i-t);return Math.max(r,.001)}const gB=(n,e,t)=>t===e?0:(cv(n,e,t)-e)/(t-e),yB=(n,e,t)=>n*(t-e)+e,mEe=()=>"_"+Math.random().toString(36).substr(2,9),x7=/\(([^\(\)]+)\)/,b7=/(-?\d+(?:\.\d+)?)\s*\^\s*(-?\d+(?:\.\d+)?)/,_7=/(-?\d+(?:\.\d+)?)\s*([*/])\s*(-?\d+(?:\.\d+)?)/,S7=/(-?\d+(?:\.\d+)?)\s*([+-])\s*(-?\d+(?:\.\d+)?)/;function LS(n){return n=n.replace(/\s+/g,""),x7.test(n)?LS(n.replace(x7,(e,t)=>LS(t).toString())):b7.test(n)?LS(n.replace(b7,(e,t,i)=>Math.pow(Number(t),Number(i)).toString())):_7.test(n)?LS(n.replace(_7,(e,t,i,r)=>i==="*"?(Number(t)*Number(r)).toString():Number(r)===0?(()=>{throw new Error("Division by zero")})():(Number(t)/Number(r)).toString())):S7.test(n)?LS(n.replace(S7,(e,t,i,r)=>i==="+"?(Number(t)+Number(r)).toString():(Number(t)-Number(r)).toString())):Number(n)}function gEe(n,e){return e.reduce((t,i)=>(n&&n.hasOwnProperty(i)&&(t[i]=n[i]),t),{})}function yEe(n,e){const t=Di({},n);return e.forEach(i=>i in n&&delete t[i]),t}function vEe(n,e){return n.reduce((t,i,r)=>Object.assign(t,{[e[r]]:i}),{})}function EQ(n){return Object.prototype.toString.call(n)==="[object Object]"}const xEe=n=>EQ(n)&&Object.keys(n).length===0;let rm=(function(n){return n.BUTTON="BUTTON",n.BUTTON_GROUP="BUTTON_GROUP",n.MONITOR="MONITOR",n.FOLDER="FOLDER",n})({}),M0=(function(n){return n.SELECT="SELECT",n.IMAGE="IMAGE",n.NUMBER="NUMBER",n.COLOR="COLOR",n.STRING="STRING",n.BOOLEAN="BOOLEAN",n.INTERVAL="INTERVAL",n.VECTOR3D="VECTOR3D",n.VECTOR2D="VECTOR2D",n})({});const bEe=["type","__customInput"],_Ee=["render","label","optional","order","disabled","hint","onChange","onEditStart","onEditEnd","transient"],SEe=["type"];function RQ(n,e,t={},i){var r,s;if(typeof n!="object"||Array.isArray(n))return{type:i,input:n,options:Di({key:e,label:e,optional:!1,disabled:!1,order:0},t)};if("__customInput"in n){const{type:E,__customInput:R}=n,P=Hs(n,bEe);return RQ(R,e,P,E)}const{render:a,label:o,optional:l,order:u=0,disabled:c,hint:d,onChange:f,onEditStart:m,onEditEnd:y,transient:_}=n,S=Hs(n,_Ee),b=Di({render:a,key:e,label:o??e,hint:d,transient:_??!!f,onEditStart:m,onEditEnd:y,disabled:c,optional:l,order:u},t);let{type:M}=S,w=Hs(S,SEe);if(M=i??M,M in rm)return{type:M,input:w,options:b};let T;return i&&EQ(w)&&"value"in w?T=w.value:T=xEe(w)?void 0:w,{type:M,input:T,options:Di(Di({},b),{},{onChange:f,optional:(r=b.optional)!==null&&r!==void 0?r:!1,disabled:(s=b.disabled)!==null&&s!==void 0?s:!1})}}function MEe(n,e,t,i){const r=RQ(n,e),{type:s,input:a,options:o}=r;if(s)return s in rm?r:{type:s,input:qI(s,a,t,i),options:o};let l=m7(a);return l?{type:l,input:qI(l,a,t,i),options:o}:(l=m7({value:a}),l?{type:l,input:qI(l,{value:a},t,i),options:o}:!1)}function M7(n,e,t,i,r){const{value:s,type:a,settings:o}=n;n.value=PQ({type:a,value:s,settings:o},e,t,i),n.fromPanel=r}const AEe=function(e,t,i){this.type="LEVA_ERROR",this.message="LEVA: "+e,this.previousValue=t,this.error=i};function PQ({type:n,value:e,settings:t},i,r,s){const a=n!=="SELECT"&&typeof i=="function"?i(e):i;let o;try{o=uEe(n,a,t,e,r,s)}catch(l){throw new AEe(`The value \`${i}\` did not result in a correct value.`,e,l)}return Fw(o,e)?e:o}const DQ=(n,e,t=!1)=>{let i=0;return function(){const r=arguments,s=t&&!i,a=()=>n.apply(this,r);window.clearTimeout(i),i=window.setTimeout(a,e),s&&a()}},NQ=n=>n.shiftKey?5:n.altKey?1/5:1,TEe=["value"],CEe=["min","max"],wEe=n=>{if(typeof n=="number")return!0;if(typeof n=="string"){const e=parseFloat(n);return isNaN(e)?!1:n.substring((""+e).length).trim().length<4}return!1},BQ=(n,{min:e=-1/0,max:t=1/0,suffix:i})=>{const r=parseFloat(n);if(n===""||isNaN(r))throw Error("Invalid number");const s=cv(r,e,t);return i?s+i:s},EEe=(n,{pad:e=0,suffix:t})=>{const i=parseFloat(n).toFixed(e);return t?i+t:i},FQ=n=>{let{value:e}=n,t=Hs(n,TEe);const{min:i=-1/0,max:r=1/0}=t,s=Hs(t,CEe);let a=parseFloat(e);const o=typeof e=="string"?e.substring((""+a).length):void 0;a=cv(a,i,r);let l=t.step;l||(Number.isFinite(i)?Number.isFinite(r)?l=+(Math.abs(r-i)/100).toPrecision(1):l=+(Math.abs(a-i)/100).toPrecision(1):Number.isFinite(r)&&(l=+(Math.abs(r-a)/100).toPrecision(1)));const u=l?v7(l)*10:v7(a);l=l||u/10;const c=Math.round(cv(Math.log10(1/u),0,2));return{value:o?a+o:a,settings:Di({initialValue:a,step:l,pad:c,min:i,max:r,suffix:o},s)}},LQ=(n,{step:e,initialValue:t})=>{const i=Math.round((n-t)/e);return t+i*e};var IQ=Object.freeze({__proto__:null,schema:wEe,sanitize:BQ,format:EEe,normalize:FQ,sanitizeStep:LQ});function go(){return go=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},go.apply(null,arguments)}const GQ=G.createContext({});function Cu(){return G.useContext(GQ)}const Jz=G.createContext(null),OQ=G.createContext(null),UQ=G.createContext(null);function FE(){return G.useContext(OQ)}function REe(){return G.useContext(UQ)}const kQ=()=>({colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",folderWidgetColor:"$highlight2",folderTextColor:"$highlight3",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}});function CP(n,e){const[t,i]=n.split(" "),r={};return t!=="none"&&(r.boxShadow=`${e.inset?"inset ":""}0 0 0 $borderWidths${[e.key]} $colors${t!=="default"&&t||e.borderColor}`),i&&(r.backgroundColor=i),r}const zT={$inputStyle:()=>n=>CP(n,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>n=>CP(n,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>n=>CP(n,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>n=>CP(n,{key:"$active",borderColor:"$accent1",inset:!0})},LE=fAe({prefix:"leva",theme:kQ(),utils:Di(Di({},zT),{},{$flex:()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:n=>({"&:focus":zT.$focusStyle()(n)}),$focusWithin:n=>({"&:focus-within":zT.$focusStyle()(n)}),$hover:n=>({"&:hover":zT.$hoverStyle()(n)}),$active:n=>({"&:active":zT.$activeStyle()(n)})})}),Ei=LE.styled;LE.css;const PEe=LE.createTheme,DEe=LE.globalCss;LE.keyframes;const NEe=DEe({".leva__panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}});function BEe(n){const e=kQ();if(!n)return{theme:e,className:""};Object.keys(n).forEach(i=>{Object.assign(e[i],n[i])});const t=PEe(e);return{theme:e,className:t.className}}function Jg(n,e){const{theme:t}=G.useContext(Jz);if(!(n in t)||!(e in t[n]))return zg(Uo.THEME_ERROR,n,e),"";let i=e;for(;;){let r=t[n][i];if(typeof r=="string"&&r.charAt(0)==="$")i=r.substr(1);else return r}}const zQ=Ei("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}},as:{textarea:{padding:"$sm"}}}}),VQ=Ei("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",touchAction:"none",[`& + ${zQ}`]:{paddingLeft:0}}),FEe=Ei(VQ,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),LEe=Ei("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:"",variants:{textArea:{true:{height:"auto"}}}}),IEe=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id","inputType","rows"],GEe=["onUpdate"];function qz(n){let{innerLabel:e,value:t,onUpdate:i,onChange:r,onKeyDown:s,type:a,id:o,inputType:l="text",rows:u=0}=n,c=Hs(n,IEe);const{id:d,emitOnEditStart:f,emitOnEditEnd:m,disabled:y}=Cu(),_=o||d,S=G.useRef(null),b=u>0,M=b?"textarea":"input",w=G.useCallback(R=>P=>{const I=P.currentTarget.value;R(I)},[]);Ie.useEffect(()=>{const R=S.current,P=w(I=>{i(I),m()});return R?.addEventListener("blur",P),()=>R?.removeEventListener("blur",P)},[w,i,m]);const T=G.useCallback(R=>{R.key==="Enter"&&w(i)(R)},[w,i]),E=Object.assign({as:M},b?{rows:u}:{},c);return Ie.createElement(LEe,{textArea:b},e&&typeof e=="string"?Ie.createElement(VQ,null,e):e,Ie.createElement(zQ,go({levaType:a,ref:S,id:_,type:l,autoComplete:"off",spellCheck:"false",value:t,onChange:w(r),onFocus:()=>f(),onKeyPress:T,onKeyDown:s,disabled:y},E)))}function OEe(n){let{onUpdate:e}=n,t=Hs(n,GEe);const i=G.useCallback(s=>e(fEe(s)),[e]),r=G.useCallback(s=>{const a=s.key==="ArrowUp"?1:s.key==="ArrowDown"?-1:0;if(a){s.preventDefault();const o=s.altKey?.1:s.shiftKey?10:1;e(l=>parseFloat(l)+a*o)}},[e]);return Ie.createElement(qz,go({},t,{onUpdate:i,onKeyDown:r,type:"number"}))}const vB=Ei("div",{}),P5=Ei("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$folderWidgetColor",opacity:.4,transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),UEe=Ei("div",{$flex:"",color:"$folderTextColor",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$folderWidgetColor",opacity:.6},"&:hover > svg":{fill:"$folderWidgetColor"},[`&:hover + ${P5}::after`]:{opacity:.6},[`${vB}:hover > & + ${P5}::after`]:{opacity:.6},[`${vB}:hover > & > svg`]:{opacity:1}}),HQ=Ei("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${vB}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),XQ=Ei("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${HQ} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},variants:{disabled:{true:{pointerEvents:"none"},false:{"&:hover,&:focus-within":{color:"$highlight3"}}}}}),WQ=Ei(XQ,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),kEe=Ei("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),zEe=Ei("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),D5=Ei("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),VEe=Ei("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none",[`& ${D5}`]:{pointerEvents:"auto"}}}}}),ZQ=Ei("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3,userSelect:"none"}),HEe=Ei("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),XEe=Ei(nEe,{fill:"$toolTipBackground"});function Qz({children:n,container:e=(t=>globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body)()}){const{className:t}=G.useContext(Jz);return Ie.createElement(LMe,{className:t,container:e},n)}const WEe=["align"];function ZEe(){const{id:n,disable:e,disabled:t}=Cu();return Ie.createElement(Ie.Fragment,null,Ie.createElement(zEe,{id:n+"__disable",type:"checkbox",checked:!t,onChange:()=>e(!t)}),Ie.createElement("label",{htmlFor:n+"__disable"}))}function jEe(n){const{id:e,optional:t,hint:i}=Cu(),r=n.htmlFor||e||void 0,s=!i&&typeof n.children=="string"?n.children:void 0;return Ie.createElement(Ie.Fragment,null,t&&Ie.createElement(ZEe,null),i!==void 0?Ie.createElement(Qwe,null,Ie.createElement(eEe,{asChild:!0},Ie.createElement(D5,go({htmlFor:r},n))),Ie.createElement(tEe,{side:"top",sideOffset:2},Ie.createElement(HEe,null,i,Ie.createElement(XEe,null)))):Ie.createElement(D5,go({htmlFor:r,title:s},n)))}function ip(n){let{align:e}=n,t=Hs(n,WEe);const{value:i,label:r,key:s,disabled:a}=Cu(),{hideCopyButton:o}=REe(),l=!o&&s!==void 0,[u,c]=G.useState(!1),d=async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[s]:i??""})),c(!0)}catch{zg(Uo.CLIPBOARD_ERROR,{[s]:i})}};return Ie.createElement(kEe,{align:e,onPointerLeave:()=>c(!1)},Ie.createElement(jEe,t),l&&!a&&Ie.createElement("div",{title:`Click to copy ${typeof r=="string"?r:s} value`},u?Ie.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},Ie.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),Ie.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):Ie.createElement("svg",{onClick:d,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},Ie.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),Ie.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const YEe=["toggled"],KEe=Ei("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function e9(n){let{toggled:e}=n,t=Hs(n,YEe);return Ie.createElement(KEe,go({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${e?0:-90}deg)`}},t),Ie.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const $Ee=["input"];function Hd(n){let{input:e}=n,t=Hs(n,$Ee);return e?Ie.createElement(WQ,t):Ie.createElement(XQ,t)}function jQ({value:n,type:e,settings:t,setValue:i}){const[r,s]=G.useState(g7(e,n,t)),a=G.useRef(n),o=G.useRef(t);o.current=t;const l=G.useCallback(c=>s(g7(e,c,o.current)),[e]),u=G.useCallback(c=>{try{i(c)}catch(d){const{type:f,previousValue:m}=d;if(f!=="LEVA_ERROR")throw d;l(m)}},[l,i]);return G.useEffect(()=>{Fw(n,a.current)||l(n),a.current=n},[n,l]),{displayValue:r,onChange:s,onUpdate:u}}function IE(n,e){const{emitOnEditStart:t,emitOnEditEnd:i}=Cu();return aTe(r=>{r.first&&(document.body.classList.add("leva__panel__dragged"),t?.());const s=n(r);return r.last&&(document.body.classList.remove("leva__panel__dragged"),i?.()),s},e)}function JEe(n){const e=G.useRef(null),t=G.useRef(null),i=G.useRef(!1);return G.useEffect(()=>{const r=DQ(()=>{e.current.width=e.current.offsetWidth*window.devicePixelRatio,e.current.height=e.current.offsetHeight*window.devicePixelRatio,n(e.current,t.current)},250);return window.addEventListener("resize",r),i.current||(r(),i.current=!0),()=>window.removeEventListener("resize",r)},[n]),G.useEffect(()=>{t.current=e.current.getContext("2d")},[]),[e,t]}function YQ(){const n=G.useRef(null),e=G.useRef({x:0,y:0}),t=G.useCallback(i=>{Object.assign(e.current,i),n.current&&(n.current.style.transform=`translate3d(${e.current.x}px, ${e.current.y}px, 0)`)},[]);return[n,t]}const qEe=["__refCount"],QI=(n,e)=>{if(!n[e])return null;const t=n[e];return Hs(t,qEe)};function QEe(n){const e=FE(),[t,i]=G.useState(QI(e.getData(),n)),r=G.useCallback(u=>e.setValueAtPath(n,u,!0),[n,e]),s=G.useCallback(u=>e.setSettingsAtPath(n,u),[n,e]),a=G.useCallback(u=>e.disableInputAtPath(n,u),[n,e]),o=G.useCallback(()=>e.emitOnEditStart(n),[n,e]),l=G.useCallback(()=>e.emitOnEditEnd(n),[n,e]);return G.useEffect(()=>{i(QI(e.getData(),n));const u=e.useStore.subscribe(c=>QI(c.data,n),i,{equalityFn:w2});return()=>u()},[e,n]),[t,{set:r,setSettings:s,disable:a,storeId:e.storeId,emitOnEditStart:o,emitOnEditEnd:l}]}const eRe=Ei("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),KQ=Ei("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),N5=Ei("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),$Q=Ei("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),JQ=Ei("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function tRe({value:n,min:e,max:t,onDrag:i,step:r,initialValue:s}){const a=G.useRef(null),o=G.useRef(null),l=G.useRef(0),u=Jg("sizes","scrubberWidth"),c=IE(({event:f,first:m,xy:[y],movement:[_],memo:S})=>{if(m){const{width:M,left:w}=a.current.getBoundingClientRect();l.current=M-parseFloat(u),S=f?.target===o.current?n:yB((y-w)/M,e,t)}const b=S+yB(_/l.current,0,t-e);return i(LQ(b,{step:r,initialValue:s})),S}),d=gB(n,e,t);return Ie.createElement($Q,go({ref:a},c()),Ie.createElement(KQ,null,Ie.createElement(JQ,{style:{left:0,right:`${(1-d)*100}%`}})),Ie.createElement(N5,{ref:o,style:{left:`calc(${d} * (100% - ${u}))`}}))}const nRe=Ie.memo(({label:n,onUpdate:e,step:t,innerLabelTrim:i})=>{const[r,s]=G.useState(!1),a=IE(({active:o,delta:[l],event:u,memo:c=0,first:d,last:f,target:m})=>(d&&m.requestPointerLock(),f&&document.exitPointerLock(),s(o),c+=l/2,Math.abs(c)>=1&&(e(y=>parseFloat(y)+Math.floor(c)*t*NQ(u)),c=0),c));return Ie.createElement(FEe,go({dragging:r,title:n.length>1?n:""},a()),n.slice(0,i))});function qQ({label:n,id:e,displayValue:t,onUpdate:i,onChange:r,settings:s,innerLabelTrim:a=1}){const o=a>0&&Ie.createElement(nRe,{label:n,step:s.step,onUpdate:i,innerLabelTrim:a});return Ie.createElement(OEe,{id:e,value:String(t),onUpdate:i,onChange:r,innerLabel:o})}function iRe(){const n=Cu(),{label:e,value:t,onUpdate:i,settings:r,id:s}=n,{min:a,max:o}=r,l=o!==1/0&&a!==-1/0;return Ie.createElement(Hd,{input:!0},Ie.createElement(ip,null,e),Ie.createElement(eRe,{hasRange:l},l&&Ie.createElement(tRe,go({value:parseFloat(t),onDrag:i},r)),Ie.createElement(qQ,go({},n,{id:s,label:"value",innerLabelTrim:l?0:1}))))}const{sanitizeStep:rRe}=IQ,sRe=Hs(IQ,["sanitizeStep"]);var aRe=Di({component:iRe},sRe);const oRe=(n,e)=>kc().schema({options:kc().passesAnyOf(kc().object(),kc().array())}).test(e),lRe=(n,{values:e})=>{if(e.indexOf(n)<0)throw Error("Selected value doesn't match Select options");return n},uRe=(n,{values:e})=>e.indexOf(n),cRe=n=>{let{value:e,options:t}=n,i,r;return Array.isArray(t)?(r=t,i=t.map(s=>String(s))):(r=Object.values(t),i=Object.keys(t)),"value"in n?r.includes(e)||(i.unshift(String(e)),r.unshift(e)):e=r[0],Object.values(t).includes(e)||(t[String(e)]=e),{value:e,settings:{keys:i,values:r}}};var hRe=Object.freeze({__proto__:null,schema:oRe,sanitize:lRe,format:uRe,normalize:cRe});const dRe=Ei("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),B5=Ei("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),fRe=Ei("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${B5}:focus + &`]:{$focusStyle:""},[`${B5}:hover + &`]:{$hoverStyle:""}});function pRe({displayValue:n,value:e,onUpdate:t,id:i,settings:r,disabled:s}){const{keys:a,values:o}=r,l=G.useRef();return e===o[n]&&(l.current=a[n]),Ie.createElement(dRe,null,Ie.createElement(B5,{id:i,value:n,onChange:u=>t(o[Number(u.currentTarget.value)]),disabled:s},a.map((u,c)=>Ie.createElement("option",{key:u,value:c},u))),Ie.createElement(fRe,null,l.current),Ie.createElement(e9,{toggled:!0}))}function mRe(){const{label:n,value:e,displayValue:t,onUpdate:i,id:r,disabled:s,settings:a}=Cu();return Ie.createElement(Hd,{input:!0},Ie.createElement(ip,null,n),Ie.createElement(pRe,{id:r,value:e,displayValue:t,onUpdate:i,settings:a,disabled:s}))}var gRe=Di({component:mRe},hRe);const yRe=n=>kc().string().test(n),vRe=n=>{if(typeof n!="string")throw Error("Invalid string");return n},xRe=({value:n,editable:e=!0,rows:t=!1})=>({value:n,settings:{editable:e,rows:typeof t=="number"?t:t?5:0}});var bRe=Object.freeze({__proto__:null,schema:yRe,sanitize:vRe,normalize:xRe});const _Re=["displayValue","onUpdate","onChange","editable"],SRe=Ei("div",{whiteSpace:"pre-wrap"});function MRe(n){let{displayValue:e,onUpdate:t,onChange:i,editable:r=!0}=n,s=Hs(n,_Re);return r?Ie.createElement(qz,go({value:e,onUpdate:t,onChange:i},s)):Ie.createElement(SRe,null,e)}function ARe(){const{label:n,settings:e,displayValue:t,onUpdate:i,onChange:r}=Cu();return Ie.createElement(Hd,{input:!0},Ie.createElement(ip,null,n),Ie.createElement(MRe,go({displayValue:t,onUpdate:i,onChange:r},e)))}var TRe=Di({component:ARe},bRe);const CRe=n=>kc().boolean().test(n),wRe=n=>{if(typeof n!="boolean")throw Error("Invalid boolean");return n};var ERe=Object.freeze({__proto__:null,schema:CRe,sanitize:wRe});const RRe=Ei("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function PRe({value:n,onUpdate:e,id:t,disabled:i}){return Ie.createElement(RRe,null,Ie.createElement("input",{id:t,type:"checkbox",checked:n,onChange:r=>e(r.currentTarget.checked),disabled:i}),Ie.createElement("label",{htmlFor:t},Ie.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ie.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}function DRe(){const{label:n,value:e,onUpdate:t,disabled:i,id:r}=Cu();return Ie.createElement(Hd,{input:!0},Ie.createElement(ip,null,n),Ie.createElement(PRe,{value:e,onUpdate:t,id:r,disabled:i}))}var NRe=Di({component:DRe},ERe);const BRe=["locked"];function FRe({value:n,id:e,valueKey:t,settings:i,onUpdate:r,innerLabelTrim:s}){const a=G.useRef(n[t]);a.current=n[t];const o=G.useCallback(u=>r({[t]:PQ({type:"NUMBER",value:a.current,settings:i},u)}),[r,i,t]),l=jQ({type:"NUMBER",value:n[t],settings:i,setValue:o});return Ie.createElement(qQ,{id:e,label:t,value:n[t],displayValue:l.displayValue,onUpdate:l.onUpdate,onChange:l.onChange,settings:i,innerLabelTrim:s})}const LRe=Ei("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function IRe(n){let{locked:e}=n,t=Hs(n,BRe);return Ie.createElement("svg",go({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e?Ie.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):Ie.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function t9({value:n,onUpdate:e,settings:t,innerLabelTrim:i}){const{id:r,setSettings:s}=Cu(),{lock:a,locked:o}=t;return Ie.createElement(LRe,{withLock:a},a&&Ie.createElement(IRe,{locked:o,onClick:()=>s({locked:!o})}),Object.keys(n).map((l,u)=>Ie.createElement(FRe,{id:u===0?r:`${r}.${l}`,key:l,valueKey:l,value:n,settings:t[l],onUpdate:e,innerLabelTrim:i})))}const QQ=(n,e)=>{const t={};let i=0,r=1/0;Object.entries(n).forEach(([s,a])=>{t[s]=FQ(Di({value:a},e[s])).settings,i=Math.max(i,t[s].step),r=Math.min(r,t[s].pad)});for(let s in t){const{step:a,min:o,max:l}=e[s]||{};!isFinite(a)&&(!isFinite(o)||!isFinite(l))&&(t[s].step=i,t[s].pad=r)}return t},GRe=["lock"],ORe=["value"];function URe(n){const e=kc().array().length(n).every.number(),t=i=>{if(!i||typeof i!="object")return!1;const r=Object.values(i);return r.length===n&&r.every(s=>isFinite(s))};return i=>e.test(i)||t(i)}function kRe(n){return Array.isArray(n)?"array":"object"}function iw(n,e,t){return kRe(n)===e?n:e==="array"?Object.values(n):vEe(n,t)}const zRe=(n,e,t)=>{const i=iw(n,"object",e.keys);for(let a in i)i[a]=BQ(i[a],e[a]);const r=Object.keys(i);let s={};if(r.length===e.keys.length)s=i;else{const a=iw(t,"object",e.keys);if(r.length===1&&e.locked){const o=r[0],l=i[o],u=a[o],c=u!==0?l/u:1;for(let d in a)d===o?s[o]=l:s[d]=a[d]*c}else s=Di(Di({},a),i)}return iw(s,e.format,e.keys)},VRe=(n,e)=>iw(n,"object",e.keys),HRe=n=>!!n&&("step"in n||"min"in n||"max"in n);function XRe(n,e,t=[]){const{lock:i=!1}=e,r=Hs(e,GRe),s=Array.isArray(n)?"array":"object",a=s==="object"?Object.keys(n):t,o=iw(n,"object",a),l=HRe(r)?a.reduce((c,d)=>Object.assign(c,{[d]:r}),{}):r,u=QQ(o,l);return{value:s==="array"?n:o,settings:Di(Di({},u),{},{format:s,keys:a,lock:i,locked:!1})}}function eee(n){return{schema:URe(n.length),normalize:e=>{let{value:t}=e,i=Hs(e,ORe);return XRe(t,i,n)},format:(e,t)=>VRe(e,t),sanitize:(e,t,i)=>zRe(e,t,i)}}var WRe={grad:.9,turn:360,rad:360/(2*Math.PI)},bg=function(n){return typeof n=="string"?n.length>0:typeof n=="number"},gl=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t+0},Md=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n>e?n:e},tee=function(n){return(n=isFinite(n)?n%360:0)>0?n:n+360},A7=function(n){return{r:Md(n.r,0,255),g:Md(n.g,0,255),b:Md(n.b,0,255),a:Md(n.a)}},eG=function(n){return{r:gl(n.r),g:gl(n.g),b:gl(n.b),a:gl(n.a,3)}},ZRe=/^#([0-9a-f]{3,8})$/i,wP=function(n){var e=n.toString(16);return e.length<2?"0"+e:e},nee=function(n){var e=n.r,t=n.g,i=n.b,r=n.a,s=Math.max(e,t,i),a=s-Math.min(e,t,i),o=a?s===e?(t-i)/a:s===t?2+(i-e)/a:4+(e-t)/a:0;return{h:60*(o<0?o+6:o),s:s?a/s*100:0,v:s/255*100,a:r}},iee=function(n){var e=n.h,t=n.s,i=n.v,r=n.a;e=e/360*6,t/=100,i/=100;var s=Math.floor(e),a=i*(1-t),o=i*(1-(e-s)*t),l=i*(1-(1-e+s)*t),u=s%6;return{r:255*[i,o,a,a,l,i][u],g:255*[l,i,i,o,a,a][u],b:255*[a,a,l,i,i,o][u],a:r}},T7=function(n){return{h:tee(n.h),s:Md(n.s,0,100),l:Md(n.l,0,100),a:Md(n.a)}},C7=function(n){return{h:gl(n.h),s:gl(n.s),l:gl(n.l),a:gl(n.a,3)}},w7=function(n){return iee((t=(e=n).s,{h:e.h,s:(t*=((i=e.l)<50?i:100-i)/100)>0?2*t/(i+t)*100:0,v:i+t,a:e.a}));var e,t,i},rw=function(n){return{h:(e=nee(n)).h,s:(r=(200-(t=e.s))*(i=e.v)/100)>0&&r<200?t*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:e.a};var e,t,i,r},jRe=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,YRe=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,KRe=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,$Re=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,F5={string:[[function(n){var e=ZRe.exec(n);return e?(n=e[1]).length<=4?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?gl(parseInt(n[3]+n[3],16)/255,2):1}:n.length===6||n.length===8?{r:parseInt(n.substr(0,2),16),g:parseInt(n.substr(2,2),16),b:parseInt(n.substr(4,2),16),a:n.length===8?gl(parseInt(n.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(n){var e=KRe.exec(n)||$Re.exec(n);return e?e[2]!==e[4]||e[4]!==e[6]?null:A7({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(n){var e=jRe.exec(n)||YRe.exec(n);if(!e)return null;var t,i,r=T7({h:(t=e[1],i=e[2],i===void 0&&(i="deg"),Number(t)*(WRe[i]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return w7(r)},"hsl"]],object:[[function(n){var e=n.r,t=n.g,i=n.b,r=n.a,s=r===void 0?1:r;return bg(e)&&bg(t)&&bg(i)?A7({r:Number(e),g:Number(t),b:Number(i),a:Number(s)}):null},"rgb"],[function(n){var e=n.h,t=n.s,i=n.l,r=n.a,s=r===void 0?1:r;if(!bg(e)||!bg(t)||!bg(i))return null;var a=T7({h:Number(e),s:Number(t),l:Number(i),a:Number(s)});return w7(a)},"hsl"],[function(n){var e=n.h,t=n.s,i=n.v,r=n.a,s=r===void 0?1:r;if(!bg(e)||!bg(t)||!bg(i))return null;var a=(function(o){return{h:tee(o.h),s:Md(o.s,0,100),v:Md(o.v,0,100),a:Md(o.a)}})({h:Number(e),s:Number(t),v:Number(i),a:Number(s)});return iee(a)},"hsv"]]},E7=function(n,e){for(var t=0;t<e.length;t++){var i=e[t][0](n);if(i)return[i,e[t][1]]}return[null,void 0]},ree=function(n){return typeof n=="string"?E7(n.trim(),F5.string):typeof n=="object"&&n!==null?E7(n,F5.object):[null,void 0]},JRe=function(n){return ree(n)[1]},tG=function(n,e){var t=rw(n);return{h:t.h,s:Md(t.s+100*e,0,100),l:t.l,a:t.a}},nG=function(n){return(299*n.r+587*n.g+114*n.b)/1e3/255},R7=function(n,e){var t=rw(n);return{h:t.h,s:t.s,l:Md(t.l+100*e,0,100),a:t.a}},L5=(function(){function n(e){this.parsed=ree(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return n.prototype.isValid=function(){return this.parsed!==null},n.prototype.brightness=function(){return gl(nG(this.rgba),2)},n.prototype.isDark=function(){return nG(this.rgba)<.5},n.prototype.isLight=function(){return nG(this.rgba)>=.5},n.prototype.toHex=function(){return e=eG(this.rgba),t=e.r,i=e.g,r=e.b,a=(s=e.a)<1?wP(gl(255*s)):"","#"+wP(t)+wP(i)+wP(r)+a;var e,t,i,r,s,a},n.prototype.toRgb=function(){return eG(this.rgba)},n.prototype.toRgbString=function(){return e=eG(this.rgba),t=e.r,i=e.g,r=e.b,(s=e.a)<1?"rgba("+t+", "+i+", "+r+", "+s+")":"rgb("+t+", "+i+", "+r+")";var e,t,i,r,s},n.prototype.toHsl=function(){return C7(rw(this.rgba))},n.prototype.toHslString=function(){return e=C7(rw(this.rgba)),t=e.h,i=e.s,r=e.l,(s=e.a)<1?"hsla("+t+", "+i+"%, "+r+"%, "+s+")":"hsl("+t+", "+i+"%, "+r+"%)";var e,t,i,r,s},n.prototype.toHsv=function(){return e=nee(this.rgba),{h:gl(e.h),s:gl(e.s),v:gl(e.v),a:gl(e.a,3)};var e},n.prototype.invert=function(){return Hu({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},n.prototype.saturate=function(e){return e===void 0&&(e=.1),Hu(tG(this.rgba,e))},n.prototype.desaturate=function(e){return e===void 0&&(e=.1),Hu(tG(this.rgba,-e))},n.prototype.grayscale=function(){return Hu(tG(this.rgba,-1))},n.prototype.lighten=function(e){return e===void 0&&(e=.1),Hu(R7(this.rgba,e))},n.prototype.darken=function(e){return e===void 0&&(e=.1),Hu(R7(this.rgba,-e))},n.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},n.prototype.alpha=function(e){return typeof e=="number"?Hu({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):gl(this.rgba.a,3);var t},n.prototype.hue=function(e){var t=rw(this.rgba);return typeof e=="number"?Hu({h:e,s:t.s,l:t.l,a:t.a}):gl(t.h)},n.prototype.isEqual=function(e){return this.toHex()===Hu(e).toHex()},n})(),Hu=function(n){return n instanceof L5?n:new L5(n)},P7=[],qRe=function(n){n.forEach(function(e){P7.indexOf(e)<0&&(e(L5,F5),P7.push(e))})};function QRe(n,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in t)i[t[r]]=r;var s={};n.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,l,u=i[this.toHex()];if(u)return u;if(a?.closest){var c=this.toRgb(),d=1/0,f="black";if(!s.length)for(var m in t)s[m]=new n(t[m]).toRgb();for(var y in t){var _=(o=c,l=s[y],Math.pow(o.r-l.r,2)+Math.pow(o.g-l.g,2)+Math.pow(o.b-l.b,2));_<d&&(d=_,f=y)}return f}},e.string.push([function(a){var o=a.toLowerCase(),l=o==="transparent"?"#0000":t[o];return l?new n(l).toRgb():null},"name"])}function OM(){return(OM=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n}).apply(this,arguments)}function n9(n,e){if(n==null)return{};var t,i,r={},s=Object.keys(n);for(i=0;i<s.length;i++)e.indexOf(t=s[i])>=0||(r[t]=n[t]);return r}function I5(n){var e=G.useRef(n),t=G.useRef(function(i){e.current&&e.current(i)});return e.current=n,t.current}var pM=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n<e?e:n},sw=function(n){return"touches"in n},G5=function(n){return n&&n.ownerDocument.defaultView||self},D7=function(n,e,t){var i=n.getBoundingClientRect(),r=sw(e)?(function(s,a){for(var o=0;o<s.length;o++)if(s[o].identifier===a)return s[o];return s[0]})(e.touches,t):e;return{left:pM((r.pageX-(i.left+G5(n).pageXOffset))/i.width),top:pM((r.pageY-(i.top+G5(n).pageYOffset))/i.height)}},N7=function(n){!sw(n)&&n.preventDefault()},i9=Ie.memo(function(n){var e=n.onMove,t=n.onKey,i=n9(n,["onMove","onKey"]),r=G.useRef(null),s=I5(e),a=I5(t),o=G.useRef(null),l=G.useRef(!1),u=G.useMemo(function(){var m=function(S){N7(S),(sw(S)?S.touches.length>0:S.buttons>0)&&r.current?s(D7(r.current,S,o.current)):_(!1)},y=function(){return _(!1)};function _(S){var b=l.current,M=G5(r.current),w=S?M.addEventListener:M.removeEventListener;w(b?"touchmove":"mousemove",m),w(b?"touchend":"mouseup",y)}return[function(S){var b=S.nativeEvent,M=r.current;if(M&&(N7(b),!(function(T,E){return E&&!sw(T)})(b,l.current)&&M)){if(sw(b)){l.current=!0;var w=b.changedTouches||[];w.length&&(o.current=w[0].identifier)}M.focus(),s(D7(M,b,o.current)),_(!0)}},function(S){var b=S.which||S.keyCode;b<37||b>40||(S.preventDefault(),a({left:b===39?.05:b===37?-.05:0,top:b===40?.05:b===38?-.05:0}))},_]},[a,s]),c=u[0],d=u[1],f=u[2];return G.useEffect(function(){return f},[f]),Ie.createElement("div",OM({},i,{onTouchStart:c,onMouseDown:c,className:"react-colorful__interactive",ref:r,onKeyDown:d,tabIndex:0,role:"slider"}))}),GE=function(n){return n.filter(Boolean).join(" ")},r9=function(n){var e=n.color,t=n.left,i=n.top,r=i===void 0?.5:i,s=GE(["react-colorful__pointer",n.className]);return Ie.createElement("div",{className:s,style:{top:100*r+"%",left:100*t+"%"}},Ie.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},Ju=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t},see=function(n){var e=n.s,t=n.v,i=n.a,r=(200-e)*t/100;return{h:Ju(n.h),s:Ju(r>0&&r<200?e*t/100/(r<=100?r:200-r)*100:0),l:Ju(r/2),a:Ju(i,2)}},O5=function(n){var e=see(n);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},iG=function(n){var e=see(n);return"hsla("+e.h+", "+e.s+"%, "+e.l+"%, "+e.a+")"},aee=function(n){var e=n.h,t=n.s,i=n.v,r=n.a;e=e/360*6,t/=100,i/=100;var s=Math.floor(e),a=i*(1-t),o=i*(1-(e-s)*t),l=i*(1-(1-e+s)*t),u=s%6;return{r:Ju(255*[i,o,a,a,l,i][u]),g:Ju(255*[l,i,i,o,a,a][u]),b:Ju(255*[a,a,l,i,i,o][u]),a:Ju(r,2)}},oee=function(n){var e=n.r,t=n.g,i=n.b,r=n.a,s=Math.max(e,t,i),a=s-Math.min(e,t,i),o=a?s===e?(t-i)/a:s===t?2+(i-e)/a:4+(e-t)/a:0;return{h:Ju(60*(o<0?o+6:o)),s:Ju(s?a/s*100:0),v:Ju(s/255*100),a:r}},lee=Ie.memo(function(n){var e=n.hue,t=n.onChange,i=GE(["react-colorful__hue",n.className]);return Ie.createElement("div",{className:i},Ie.createElement(i9,{onMove:function(r){t({h:360*r.left})},onKey:function(r){t({h:pM(e+360*r.left,0,360)})},"aria-label":"Hue","aria-valuenow":Ju(e),"aria-valuemax":"360","aria-valuemin":"0"},Ie.createElement(r9,{className:"react-colorful__hue-pointer",left:e/360,color:O5({h:e,s:100,v:100,a:1})})))}),uee=Ie.memo(function(n){var e=n.hsva,t=n.onChange,i={backgroundColor:O5({h:e.h,s:100,v:100,a:1})};return Ie.createElement("div",{className:"react-colorful__saturation",style:i},Ie.createElement(i9,{onMove:function(r){t({s:100*r.left,v:100-100*r.top})},onKey:function(r){t({s:pM(e.s+100*r.left,0,100),v:pM(e.v-100*r.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Ju(e.s)+"%, Brightness "+Ju(e.v)+"%"},Ie.createElement(r9,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:O5(e)})))}),s9=function(n,e){if(n===e)return!0;for(var t in n)if(n[t]!==e[t])return!1;return!0};function cee(n,e,t){var i=I5(t),r=G.useState(function(){return n.toHsva(e)}),s=r[0],a=r[1],o=G.useRef({color:e,hsva:s});G.useEffect(function(){if(!n.equal(e,o.current.color)){var u=n.toHsva(e);o.current={hsva:u,color:e},a(u)}},[e,n]),G.useEffect(function(){var u;s9(s,o.current.hsva)||n.equal(u=n.fromHsva(s),o.current.color)||(o.current={hsva:s,color:u},i(u))},[s,n,i]);var l=G.useCallback(function(u){a(function(c){return Object.assign({},c,u)})},[]);return[s,l]}var e3e=typeof window<"u"?G.useLayoutEffect:G.useEffect,t3e=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},B7=new Map,hee=function(n){e3e(function(){var e=n.current?n.current.ownerDocument:document;if(e!==void 0&&!B7.has(e)){var t=e.createElement("style");t.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,B7.set(e,t);var i=t3e();i&&t.setAttribute("nonce",i),e.head.appendChild(t)}},[])},n3e=function(n){var e=n.className,t=n.colorModel,i=n.color,r=i===void 0?t.defaultColor:i,s=n.onChange,a=n9(n,["className","colorModel","color","onChange"]),o=G.useRef(null);hee(o);var l=cee(t,r,s),u=l[0],c=l[1],d=GE(["react-colorful",e]);return Ie.createElement("div",OM({},a,{ref:o,className:d}),Ie.createElement(uee,{hsva:u,onChange:c}),Ie.createElement(lee,{hue:u.h,onChange:c,className:"react-colorful__last-control"}))},i3e=function(n){var e=n.className,t=n.hsva,i=n.onChange,r={backgroundImage:"linear-gradient(90deg, "+iG(Object.assign({},t,{a:0}))+", "+iG(Object.assign({},t,{a:1}))+")"},s=GE(["react-colorful__alpha",e]),a=Ju(100*t.a);return Ie.createElement("div",{className:s},Ie.createElement("div",{className:"react-colorful__alpha-gradient",style:r}),Ie.createElement(i9,{onMove:function(o){i({a:o.left})},onKey:function(o){i({a:pM(t.a+o.left)})},"aria-label":"Alpha","aria-valuetext":a+"%","aria-valuenow":a,"aria-valuemin":"0","aria-valuemax":"100"},Ie.createElement(r9,{className:"react-colorful__alpha-pointer",left:t.a,color:iG(t)})))},r3e=function(n){var e=n.className,t=n.colorModel,i=n.color,r=i===void 0?t.defaultColor:i,s=n.onChange,a=n9(n,["className","colorModel","color","onChange"]),o=G.useRef(null);hee(o);var l=cee(t,r,s),u=l[0],c=l[1],d=GE(["react-colorful",e]);return Ie.createElement("div",OM({},a,{ref:o,className:d}),Ie.createElement(uee,{hsva:u,onChange:c}),Ie.createElement(lee,{hue:u.h,onChange:c}),Ie.createElement(i3e,{hsva:u,onChange:c,className:"react-colorful__last-control"}))},s3e={defaultColor:{r:0,g:0,b:0,a:1},toHsva:oee,fromHsva:aee,equal:s9},a3e=function(n){return Ie.createElement(r3e,OM({},n,{colorModel:s3e}))},o3e={defaultColor:{r:0,g:0,b:0},toHsva:function(n){return oee({r:n.r,g:n.g,b:n.b,a:1})},fromHsva:function(n){return{r:(e=aee(n)).r,g:e.g,b:e.b};var e},equal:s9},l3e=function(n){return Ie.createElement(n3e,OM({},n,{colorModel:o3e}))},rG={exports:{}},sG,F7;function u3e(){if(F7)return sG;F7=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return sG=n,sG}var aG,L7;function c3e(){if(L7)return aG;L7=1;var n=u3e();function e(){}function t(){}return t.resetWarningCache=e,aG=function(){function i(a,o,l,u,c,d){if(d!==n){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}i.isRequired=i;function r(){return i}var s={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:r,element:i,elementType:i,instanceOf:r,node:i,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},aG}var I7;function h3e(){return I7||(I7=1,rG.exports=c3e()()),rG.exports}var d3e=h3e();const ra=_0(d3e);function UM(n,e,t,i){function r(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(c){try{u(i.next(c))}catch(d){a(d)}}function l(c){try{u(i.throw(c))}catch(d){a(d)}}function u(c){c.done?s(c.value):r(c.value).then(o,l)}u((i=i.apply(n,e||[])).next())})}function kM(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(u){return function(c){return l([u,c])}}function l(u){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(t=0)),t;)try{if(i=1,r&&(s=u[0]&2?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,r=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(c){u=[6,c],r=0}finally{i=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function f3e(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),r,s=[],a;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(o){a={error:o}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}return s}function p3e(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(f3e(arguments[e]));return n}var m3e=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function OE(n,e){var t=g3e(n);if(typeof t.path!="string"){var i=n.webkitRelativePath;Object.defineProperty(t,"path",{value:typeof e=="string"?e:typeof i=="string"&&i.length>0?i:n.name,writable:!1,configurable:!1,enumerable:!0})}return t}function g3e(n){var e=n.name,t=e&&e.lastIndexOf(".")!==-1;if(t&&!n.type){var i=e.split(".").pop().toLowerCase(),r=m3e.get(i);r&&Object.defineProperty(n,"type",{value:r,writable:!1,configurable:!1,enumerable:!0})}return n}var y3e=[".DS_Store","Thumbs.db"];function v3e(n){return UM(this,void 0,void 0,function(){return kM(this,function(e){return xB(n)&&x3e(n)?[2,M3e(n.dataTransfer,n.type)]:b3e(n)?[2,_3e(n)]:Array.isArray(n)&&n.every(function(t){return"getFile"in t&&typeof t.getFile=="function"})?[2,S3e(n)]:[2,[]]})})}function x3e(n){return xB(n.dataTransfer)}function b3e(n){return xB(n)&&xB(n.target)}function xB(n){return typeof n=="object"&&n!==null}function _3e(n){return U5(n.target.files).map(function(e){return OE(e)})}function S3e(n){return UM(this,void 0,void 0,function(){var e;return kM(this,function(t){switch(t.label){case 0:return[4,Promise.all(n.map(function(i){return i.getFile()}))];case 1:return e=t.sent(),[2,e.map(function(i){return OE(i)})]}})})}function M3e(n,e){return UM(this,void 0,void 0,function(){var t,i;return kM(this,function(r){switch(r.label){case 0:return n===null?[2,[]]:n.items?(t=U5(n.items).filter(function(s){return s.kind==="file"}),e!=="drop"?[2,t]:[4,Promise.all(t.map(A3e))]):[3,2];case 1:return i=r.sent(),[2,G7(dee(i))];case 2:return[2,G7(U5(n.files).map(function(s){return OE(s)}))]}})})}function G7(n){return n.filter(function(e){return y3e.indexOf(e.name)===-1})}function U5(n){if(n===null)return[];for(var e=[],t=0;t<n.length;t++){var i=n[t];e.push(i)}return e}function A3e(n){if(typeof n.webkitGetAsEntry!="function")return O7(n);var e=n.webkitGetAsEntry();return e&&e.isDirectory?fee(e):O7(n)}function dee(n){return n.reduce(function(e,t){return p3e(e,Array.isArray(t)?dee(t):[t])},[])}function O7(n){var e=n.getAsFile();if(!e)return Promise.reject(n+" is not a File");var t=OE(e);return Promise.resolve(t)}function T3e(n){return UM(this,void 0,void 0,function(){return kM(this,function(e){return[2,n.isDirectory?fee(n):C3e(n)]})})}function fee(n){var e=n.createReader();return new Promise(function(t,i){var r=[];function s(){var a=this;e.readEntries(function(o){return UM(a,void 0,void 0,function(){var l,u,c;return kM(this,function(d){switch(d.label){case 0:if(o.length)return[3,5];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.all(r)];case 2:return l=d.sent(),t(l),[3,4];case 3:return u=d.sent(),i(u),[3,4];case 4:return[3,6];case 5:c=Promise.all(o.map(T3e)),r.push(c),s(),d.label=6;case 6:return[2]}})})},function(o){i(o)})}s()})}function C3e(n){return UM(this,void 0,void 0,function(){return kM(this,function(e){return[2,new Promise(function(t,i){n.file(function(r){var s=OE(r,n.fullPath);t(s)},function(r){i(r)})})]})})}var EP={},U7;function w3e(){return U7||(U7=1,EP.__esModule=!0,EP.default=function(n,e){if(n&&e){var t=Array.isArray(e)?e:e.split(",");if(t.length===0)return!0;var i=n.name||"",r=(n.type||"").toLowerCase(),s=r.replace(/\/.*$/,"");return t.some(function(a){var o=a.trim().toLowerCase();return o.charAt(0)==="."?i.toLowerCase().endsWith(o):o.endsWith("/*")?s===o.replace(/\/.*$/,""):r===o})}return!0}),EP}var E3e=w3e();const R3e=_0(E3e);function k7(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function z7(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?k7(Object(t),!0).forEach(function(i){pee(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):k7(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function pee(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function V7(n,e){return B3e(n)||N3e(n,e)||D3e(n,e)||P3e()}function P3e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function D3e(n,e){if(n){if(typeof n=="string")return H7(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return H7(n,e)}}function H7(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function N3e(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i=[],r=!0,s=!1,a,o;try{for(t=t.call(n);!(r=(a=t.next()).done)&&(i.push(a.value),!(e&&i.length===e));r=!0);}catch(l){s=!0,o=l}finally{try{!r&&t.return!=null&&t.return()}finally{if(s)throw o}}return i}}function B3e(n){if(Array.isArray(n))return n}var F3e="file-invalid-type",L3e="file-too-large",I3e="file-too-small",G3e="too-many-files",O3e=function(e){e=Array.isArray(e)&&e.length===1?e[0]:e;var t=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:F3e,message:"File type must be ".concat(t)}},X7=function(e){return{code:L3e,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},W7=function(e){return{code:I3e,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},U3e={code:G3e,message:"Too many files"};function mee(n,e){var t=n.type==="application/x-moz-file"||R3e(n,e);return[t,t?null:O3e(e)]}function gee(n,e,t){if(VT(n.size))if(VT(e)&&VT(t)){if(n.size>t)return[!1,X7(t)];if(n.size<e)return[!1,W7(e)]}else{if(VT(e)&&n.size<e)return[!1,W7(e)];if(VT(t)&&n.size>t)return[!1,X7(t)]}return[!0,null]}function VT(n){return n!=null}function k3e(n){var e=n.files,t=n.accept,i=n.minSize,r=n.maxSize,s=n.multiple,a=n.maxFiles;return!s&&e.length>1||s&&a>=1&&e.length>a?!1:e.every(function(o){var l=mee(o,t),u=V7(l,1),c=u[0],d=gee(o,i,r),f=V7(d,1),m=f[0];return c&&m})}function bB(n){return typeof n.isPropagationStopped=="function"?n.isPropagationStopped():typeof n.cancelBubble<"u"?n.cancelBubble:!1}function RP(n){return n.dataTransfer?Array.prototype.some.call(n.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!n.target&&!!n.target.files}function Z7(n){n.preventDefault()}function z3e(n){return n.indexOf("MSIE")!==-1||n.indexOf("Trident/")!==-1}function V3e(n){return n.indexOf("Edge/")!==-1}function H3e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return z3e(n)||V3e(n)}function Up(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return e.some(function(o){return!bB(i)&&o&&o.apply(void 0,[i].concat(s)),bB(i)})}}function X3e(){return"showOpenFilePicker"in window}function W3e(n){return n=typeof n=="string"?n.split(","):n,[{description:"everything",accept:Array.isArray(n)?n.filter(function(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}).reduce(function(e,t){return z7(z7({},e),{},pee({},t,[]))},{}):{}}]}function Z3e(n){return n instanceof DOMException&&(n.name==="AbortError"||n.code===n.ABORT_ERR)}function j3e(n){return n instanceof DOMException&&(n.name==="SecurityError"||n.code===n.SECURITY_ERR)}var Y3e=["children"],K3e=["open"],$3e=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],J3e=["refKey","onChange","onClick"];function q3e(n){return tPe(n)||ePe(n)||yee(n)||Q3e()}function Q3e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ePe(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function tPe(n){if(Array.isArray(n))return k5(n)}function oG(n,e){return rPe(n)||iPe(n,e)||yee(n,e)||nPe()}function nPe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yee(n,e){if(n){if(typeof n=="string")return k5(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return k5(n,e)}}function k5(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function iPe(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i=[],r=!0,s=!1,a,o;try{for(t=t.call(n);!(r=(a=t.next()).done)&&(i.push(a.value),!(e&&i.length===e));r=!0);}catch(l){s=!0,o=l}finally{try{!r&&t.return!=null&&t.return()}finally{if(s)throw o}}return i}}function rPe(n){if(Array.isArray(n))return n}function j7(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Ka(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?j7(Object(t),!0).forEach(function(i){z5(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):j7(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function z5(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function _B(n,e){if(n==null)return{};var t=sPe(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}function sPe(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}var a9=G.forwardRef(function(n,e){var t=n.children,i=_B(n,Y3e),r=xee(i),s=r.open,a=_B(r,K3e);return G.useImperativeHandle(e,function(){return{open:s}},[s]),Ie.createElement(G.Fragment,null,t(Ka(Ka({},a),{},{open:s})))});a9.displayName="Dropzone";var vee={disabled:!1,getFilesFromEvent:v3e,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};a9.defaultProps=vee;a9.propTypes={children:ra.func,accept:ra.oneOfType([ra.string,ra.arrayOf(ra.string)]),multiple:ra.bool,preventDropOnDocument:ra.bool,noClick:ra.bool,noKeyboard:ra.bool,noDrag:ra.bool,noDragEventsBubbling:ra.bool,minSize:ra.number,maxSize:ra.number,maxFiles:ra.number,disabled:ra.bool,getFilesFromEvent:ra.func,onFileDialogCancel:ra.func,onFileDialogOpen:ra.func,useFsAccessApi:ra.bool,onDragEnter:ra.func,onDragLeave:ra.func,onDragOver:ra.func,onDrop:ra.func,onDropAccepted:ra.func,onDropRejected:ra.func,validator:ra.func};var V5={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function xee(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Ka(Ka({},vee),n),t=e.accept,i=e.disabled,r=e.getFilesFromEvent,s=e.maxSize,a=e.minSize,o=e.multiple,l=e.maxFiles,u=e.onDragEnter,c=e.onDragLeave,d=e.onDragOver,f=e.onDrop,m=e.onDropAccepted,y=e.onDropRejected,_=e.onFileDialogCancel,S=e.onFileDialogOpen,b=e.useFsAccessApi,M=e.preventDropOnDocument,w=e.noClick,T=e.noKeyboard,E=e.noDrag,R=e.noDragEventsBubbling,P=e.validator,I=G.useMemo(function(){return typeof S=="function"?S:Y7},[S]),B=G.useMemo(function(){return typeof _=="function"?_:Y7},[_]),N=G.useRef(null),U=G.useRef(null),V=G.useReducer(aPe,V5),W=oG(V,2),K=W[0],q=W[1],j=K.isFocused,te=K.isFileDialogActive,he=K.draggedFiles,_e=G.useRef(typeof window<"u"&&window.isSecureContext&&b&&X3e()),Be=function(){!_e.current&&te&&setTimeout(function(){if(U.current){var ee=U.current.files;ee.length||(q({type:"closeDialog"}),B())}},300)};G.useEffect(function(){return window.addEventListener("focus",Be,!1),function(){window.removeEventListener("focus",Be,!1)}},[U,te,B,_e]);var ue=G.useRef([]),ce=function(ee){N.current&&N.current.contains(ee.target)||(ee.preventDefault(),ue.current=[])};G.useEffect(function(){return M&&(document.addEventListener("dragover",Z7,!1),document.addEventListener("drop",ce,!1)),function(){M&&(document.removeEventListener("dragover",Z7),document.removeEventListener("drop",ce))}},[N,M]);var Ce=G.useCallback(function(le){le.preventDefault(),le.persist(),gt(le),ue.current=[].concat(q3e(ue.current),[le.target]),RP(le)&&Promise.resolve(r(le)).then(function(ee){bB(le)&&!R||(q({draggedFiles:ee,isDragActive:!0,type:"setDraggedFiles"}),u&&u(le))})},[r,u,R]),Oe=G.useCallback(function(le){le.preventDefault(),le.persist(),gt(le);var ee=RP(le);if(ee&&le.dataTransfer)try{le.dataTransfer.dropEffect="copy"}catch{}return ee&&d&&d(le),!1},[d,R]),nt=G.useCallback(function(le){le.preventDefault(),le.persist(),gt(le);var ee=ue.current.filter(function(tt){return N.current&&N.current.contains(tt)}),Re=ee.indexOf(le.target);Re!==-1&&ee.splice(Re,1),ue.current=ee,!(ee.length>0)&&(q({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),RP(le)&&c&&c(le))},[N,c,R]),Ae=G.useCallback(function(le,ee){var Re=[],tt=[];le.forEach(function(et){var at=mee(et,t),jt=oG(at,2),rn=jt[0],Nn=jt[1],Fn=gee(et,a,s),Gt=oG(Fn,2),st=Gt[0],Ft=Gt[1],Se=P?P(et):null;if(rn&&st&&!Se)Re.push(et);else{var Je=[Nn,Ft];Se&&(Je=Je.concat(Se)),tt.push({file:et,errors:Je.filter(function(St){return St})})}}),(!o&&Re.length>1||o&&l>=1&&Re.length>l)&&(Re.forEach(function(et){tt.push({file:et,errors:[U3e]})}),Re.splice(0)),q({acceptedFiles:Re,fileRejections:tt,type:"setFiles"}),f&&f(Re,tt,ee),tt.length>0&&y&&y(tt,ee),Re.length>0&&m&&m(Re,ee)},[q,o,t,a,s,l,f,m,y,P]),Ye=G.useCallback(function(le){le.preventDefault(),le.persist(),gt(le),ue.current=[],RP(le)&&Promise.resolve(r(le)).then(function(ee){bB(le)&&!R||Ae(ee,le)}),q({type:"reset"})},[r,Ae,R]),ft=G.useCallback(function(){if(_e.current){q({type:"openDialog"}),I();var le={multiple:o,types:W3e(t)};window.showOpenFilePicker(le).then(function(ee){return r(ee)}).then(function(ee){Ae(ee,null),q({type:"closeDialog"})}).catch(function(ee){Z3e(ee)?(B(ee),q({type:"closeDialog"})):j3e(ee)&&(_e.current=!1,U.current&&(U.current.value=null,U.current.click()))});return}U.current&&(q({type:"openDialog"}),I(),U.current.value=null,U.current.click())},[q,I,B,b,Ae,t,o]),ze=G.useCallback(function(le){!N.current||!N.current.isEqualNode(le.target)||(le.key===" "||le.key==="Enter"||le.keyCode===32||le.keyCode===13)&&(le.preventDefault(),ft())},[N,ft]),ot=G.useCallback(function(){q({type:"focus"})},[]),ut=G.useCallback(function(){q({type:"blur"})},[]),Wt=G.useCallback(function(){w||(H3e()?setTimeout(ft,0):ft())},[w,ft]),It=function(ee){return i?null:ee},ke=function(ee){return T?null:It(ee)},je=function(ee){return E?null:It(ee)},gt=function(ee){R&&ee.stopPropagation()},yt=G.useMemo(function(){return function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ee=le.refKey,Re=ee===void 0?"ref":ee,tt=le.role,et=le.onKeyDown,at=le.onFocus,jt=le.onBlur,rn=le.onClick,Nn=le.onDragEnter,Fn=le.onDragOver,Gt=le.onDragLeave,st=le.onDrop,Ft=_B(le,$3e);return Ka(Ka(z5({onKeyDown:ke(Up(et,ze)),onFocus:ke(Up(at,ot)),onBlur:ke(Up(jt,ut)),onClick:It(Up(rn,Wt)),onDragEnter:je(Up(Nn,Ce)),onDragOver:je(Up(Fn,Oe)),onDragLeave:je(Up(Gt,nt)),onDrop:je(Up(st,Ye)),role:typeof tt=="string"&&tt!==""?tt:"button"},Re,N),!i&&!T?{tabIndex:0}:{}),Ft)}},[N,ze,ot,ut,Wt,Ce,Oe,nt,Ye,T,E,i]),ve=G.useCallback(function(le){le.stopPropagation()},[]),An=G.useMemo(function(){return function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ee=le.refKey,Re=ee===void 0?"ref":ee,tt=le.onChange,et=le.onClick,at=_B(le,J3e),jt=z5({accept:t,multiple:o,type:"file",style:{display:"none"},onChange:It(Up(tt,Ye)),onClick:It(Up(et,ve)),tabIndex:-1},Re,U);return Ka(Ka({},jt),at)}},[U,t,o,Ye,i]),cn=he.length,In=cn>0&&k3e({files:he,accept:t,minSize:a,maxSize:s,multiple:o,maxFiles:l}),Zt=cn>0&&!In;return Ka(Ka({},K),{},{isDragAccept:In,isDragReject:Zt,isFocused:j&&!i,getRootProps:yt,getInputProps:An,rootRef:N,inputRef:U,open:It(ft)})}function aPe(n,e){switch(e.type){case"focus":return Ka(Ka({},n),{},{isFocused:!0});case"blur":return Ka(Ka({},n),{},{isFocused:!1});case"openDialog":return Ka(Ka({},V5),{},{isFileDialogActive:!0});case"closeDialog":return Ka(Ka({},n),{},{isFileDialogActive:!1});case"setDraggedFiles":var t=e.isDragActive,i=e.draggedFiles;return Ka(Ka({},n),{},{draggedFiles:i,isDragActive:t});case"setFiles":return Ka(Ka({},n),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections});case"reset":return Ka({},V5);default:return n}}function Y7(){}function oPe(n){let e;const t=new Set,i=(u,c)=>{const d=typeof u=="function"?u(e):u;if(d!==e){const f=e;e=c?d:Object.assign({},e,d),t.forEach(m=>m(e,f))}},r=()=>e,s=(u,c=r,d=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let f=c(e);function m(){const y=c(e);if(!d(f,y)){const _=f;u(f=y,_)}}return t.add(m),()=>t.delete(m)},l={setState:i,getState:r,subscribe:(u,c,d)=>c||d?s(u,c,d):(t.add(u),()=>t.delete(u)),destroy:()=>t.clear()};return e=n(i,r,l),l}const lPe=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),K7=lPe?G.useEffect:G.useLayoutEffect;function uPe(n){const e=typeof n=="function"?oPe(n):n,t=(i=e.getState,r=Object.is)=>{const[,s]=G.useReducer(S=>S+1,0),a=e.getState(),o=G.useRef(a),l=G.useRef(i),u=G.useRef(r),c=G.useRef(!1),d=G.useRef();d.current===void 0&&(d.current=i(a));let f,m=!1;(o.current!==a||l.current!==i||u.current!==r||c.current)&&(f=i(a),m=!r(d.current,f)),K7(()=>{m&&(d.current=f),o.current=a,l.current=i,u.current=r,c.current=!1});const y=G.useRef(a);K7(()=>{const S=()=>{try{const M=e.getState(),w=l.current(M);u.current(d.current,w)||(o.current=M,d.current=w,s())}catch{c.current=!0,s()}},b=e.subscribe(S);return e.getState()!==y.current&&S(),b},[]);const _=m?f:d.current;return G.useDebugValue(_),_};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[t,e];return{next(){const r=i.length<=0;return{value:i.shift(),done:r}}}},t}const cPe=n=>(e,t,i)=>{const r=i.subscribe;return i.subscribe=(a,o,l)=>{let u=a;if(o){const c=l?.equalityFn||Object.is;let d=a(i.getState());u=f=>{const m=a(f);if(!c(d,m)){const y=d;o(d=m,y)}},l?.fireImmediately&&o(d,d)}return r(u)},n(e,t,i)};var lG,$7;function hPe(){return $7||($7=1,lG=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1}),lG}var uG,J7;function bee(){if(J7)return uG;J7=1;var n=hPe();function e(t){return n(t)===!0&&Object.prototype.toString.call(t)==="[object Object]"}return uG=function(i){var r,s;return!(e(i)===!1||(r=i.constructor,typeof r!="function")||(s=r.prototype,e(s)===!1)||s.hasOwnProperty("isPrototypeOf")===!1)},uG}var cG,q7;function o9(){if(q7)return cG;q7=1;var n=bee();return cG=function(t){return n(t)||typeof t=="function"||Array.isArray(t)},cG}var hG,Q7;function dPe(){return Q7||(Q7=1,hG=function(e,t,i){for(var r in e)if(t.call(i,e[r],r,e)===!1)break}),hG}var dG,eW;function fPe(){if(eW)return dG;eW=1;var n=o9(),e=dPe();function t(a,o){for(var l=arguments.length,u=0;++u<l;){var c=arguments[u];r(c)&&e(c,i,a)}return a}function i(a,o){if(s(o)){var l=this[o];r(a)&&r(l)?t(l,a):this[o]=a}}function r(a){return n(a)&&!Array.isArray(a)}function s(a){return a!=="__proto__"&&a!=="constructor"&&a!=="prototype"}return dG=t,dG}var fG,tW;function pPe(){if(tW)return fG;tW=1,fG=function(t,i,r,s,a){if(!n(t)||!i)return t;if(i=e(i),r&&(i+="."+e(r)),s&&(i+="."+e(s)),a&&(i+="."+e(a)),i in t)return t[i];for(var o=i.split("."),l=o.length,u=-1;t&&++u<l;){for(var c=o[u];c[c.length-1]==="\\";)c=c.slice(0,-1)+"."+o[++u];t=t[c]}return t};function n(t){return t!==null&&(typeof t=="object"||typeof t=="function")}function e(t){return t?Array.isArray(t)?t.join("."):t:""}return fG}var pG,nW;function mPe(){return nW||(nW=1,pG=function(n,e){if(n===null||typeof n>"u")throw new TypeError("expected first argument to be an object.");if(typeof e>"u"||typeof Symbol>"u"||typeof Object.getOwnPropertySymbols!="function")return n;for(var t=Object.prototype.propertyIsEnumerable,i=Object(n),r=arguments.length,s=0;++s<r;)for(var a=Object(arguments[s]),o=Object.getOwnPropertySymbols(a),l=0;l<o.length;l++){var u=o[l];t.call(a,u)&&(i[u]=a[u])}return i}),pG}var mG,iW;function gPe(){if(iW)return mG;iW=1;var n=o9(),e=mPe();mG=Object.assign||function(o){if(o===null||typeof o>"u")throw new TypeError("Cannot convert undefined or null to object");s(o)||(o={});for(var l=1;l<arguments.length;l++){var u=arguments[l];i(u)&&(u=r(u)),s(u)&&(t(o,u),e(o,u))}return o};function t(o,l){for(var u in l)a(l,u)&&(o[u]=l[u])}function i(o){return o&&typeof o=="string"}function r(o){var l={};for(var u in o)l[u]=o[u];return l}function s(o){return o&&typeof o=="object"||n(o)}function a(o,l){return Object.prototype.hasOwnProperty.call(o,l)}return mG}var gG,rW;function yPe(){if(rW)return gG;rW=1;var n=gPe();gG=function(r,s,a){if(typeof r!="string")throw new TypeError("expected a string");typeof s=="function"&&(a=s,s=null),typeof s=="string"&&(s={sep:s});var o=n({sep:"."},s),l=o.quotes||['"',"'","`"],u;o.brackets===!0?u={"<":">","(":")","[":"]","{":"}"}:o.brackets&&(u=o.brackets);var c=[],d=[],f=[""],m=o.sep,y=r.length,_=-1,S;function b(){if(u&&d.length)return u[d[d.length-1]]}for(;++_<y;){var M=r[_],w=r[_+1],T={val:M,idx:_,arr:f,str:r};if(c.push(T),M==="\\"){T.val=i(o,r,_)===!0?M+w:w,T.escaped=!0,typeof a=="function"&&a(T),f[f.length-1]+=T.val,_++;continue}if(u&&u[M]){d.push(M);var E=b(),R=_+1;if(r.indexOf(E,R+1)!==-1)for(;d.length&&R<y;){var P=r[++R];if(P==="\\"){P++;continue}if(l.indexOf(P)!==-1){R=e(r,P,R+1);continue}if(E=b(),d.length&&r.indexOf(E,R+1)===-1)break;if(u[P]){d.push(P);continue}E===P&&d.pop()}if(S=R,S===-1){f[f.length-1]+=M;continue}M=r.slice(_,S+1),T.val=M,T.idx=_=S}if(l.indexOf(M)!==-1){if(S=e(r,M,_+1),S===-1){f[f.length-1]+=M;continue}t(M,o)===!0?M=r.slice(_,S+1):M=r.slice(_+1,S),T.val=M,T.idx=_=S}if(typeof a=="function"&&(a(T,c),M=T.val,_=T.idx),T.val===m&&T.split!==!1){f.push("");continue}f[f.length-1]+=T.val}return f};function e(r,s,a,o){var l=r.indexOf(s,a);return r.charAt(l-1)==="\\"?e(r,s,l+1):l}function t(r,s){return s.keepDoubleQuotes===!0&&r==='"'||s.keepSingleQuotes===!0&&r==="'"?!0:s.keepQuotes}function i(r,s,a){return typeof r.keepEscaping=="function"?r.keepEscaping(s,a):r.keepEscaping===!0||s[a+1]==="\\"}return gG}var yG,sW;function vPe(){return sW||(sW=1,yG=function(e){return typeof e<"u"&&e!==null&&(typeof e=="object"||typeof e=="function")}),yG}var vG,aW;function xPe(){if(aW)return vG;aW=1;var n=vPe();vG=function(r){n(r)||(r={});for(var s=arguments.length,a=1;a<s;a++){var o=arguments[a];n(o)&&e(r,o)}return r};function e(i,r){for(var s in r)t(r,s)&&(i[s]=r[s])}function t(i,r){return Object.prototype.hasOwnProperty.call(i,r)}return vG}var xG,oW;function bPe(){return oW||(oW=1,xG=function(e){return typeof e<"u"&&e!==null&&(typeof e=="object"||typeof e=="function")}),xG}var bG,lW;function _Pe(){if(lW)return bG;lW=1;var n=yPe(),e=xPe(),t=bee(),i=bPe();bG=function(s,a,o){if(!i(s)||(Array.isArray(a)&&(a=[].concat.apply([],a).join(".")),typeof a!="string"))return s;for(var l=n(a,{sep:".",brackets:!0}).filter(r),u=l.length,c=-1,d=s;++c<u;){var f=l[c];if(c!==u-1){i(d[f])||(d[f]={}),d=d[f];continue}t(d[f])&&t(o)?d[f]=e({},d[f],o):d[f]=o}return s};function r(s){return s!=="__proto__"&&s!=="constructor"&&s!=="prototype"}return bG}var _G,uW;function SPe(){if(uW)return _G;uW=1;var n=o9(),e=fPe(),t=pPe(),i=_Pe();return _G=function(s,a,o){if(!n(s))throw new TypeError("expected an object");if(typeof a!="string"||o==null)return e.apply(null,arguments);if(typeof o=="string")return i(s,a,o),s;var l=t(s,a);return n(o)&&n(l)&&(o=e({},l,o)),i(s,a,o),s},_G}var MPe=SPe();const APe=_0(MPe),l9=(...n)=>n.filter(Boolean).join(".");function TPe(n){const e=n.split(".");return[e.pop(),e.join(".")||void 0]}function CPe(n,e){return Object.entries(gEe(n,e)).reduce((t,[,{value:i,disabled:r,key:s}])=>(t[s]=r?void 0:i,t),{})}function wPe(n,e){const t=G.useRef();return Fw(n,t.current)||(t.current=n),t.current}function _ee(n,e){var t;return G.useMemo(n,(t=wPe(e))!==null&&t!==void 0?t:[])}function EPe(n){const e=G.useRef(null),t=G.useRef(null),i=G.useRef(!0);return G.useLayoutEffect(()=>{n||(e.current.style.height="0px",e.current.style.overflow="hidden")},[]),G.useEffect(()=>{if(i.current){i.current=!1;return}let r;const s=e.current,a=()=>{n&&(s.style.removeProperty("height"),s.style.removeProperty("overflow"),t.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};s.addEventListener("transitionend",a,{once:!0});const{height:o}=t.current.getBoundingClientRect();return s.style.height=o+"px",n||(s.style.overflow="hidden",r=window.setTimeout(()=>s.style.height="0px",50)),()=>{s.removeEventListener("transitionend",a),clearTimeout(r)}},[n]),{wrapperRef:e,contentRef:t}}const RPe=n=>{const[e,t]=G.useState(n.getVisiblePaths());return G.useEffect(()=>{t(n.getVisiblePaths());const i=n.useStore.subscribe(n.getVisiblePaths,t,{equalityFn:w2});return()=>i()},[n]),e};function PPe(n,e,t){return n.useStore(r=>{const s=Di(Di({},t),r.data);return CPe(s,e)},w2)}function See(n=3){const e=G.useRef(null),t=G.useRef(null),[i,r]=G.useState(!1),s=G.useCallback(()=>r(!0),[]),a=G.useCallback(()=>r(!1),[]);return G.useLayoutEffect(()=>{if(i){const{bottom:o,top:l,left:u}=e.current.getBoundingClientRect(),{height:c}=t.current.getBoundingClientRect(),d=o+c>window.innerHeight-40?"up":"down";t.current.style.position="fixed",t.current.style.zIndex="10000",t.current.style.left=u+"px",d==="down"?t.current.style.top=o+n+"px":t.current.style.bottom=window.innerHeight-l+n+"px"}},[n,i]),{popinRef:e,wrapperRef:t,shown:i,show:s,hide:a}}qRe([QRe]);const DPe={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHex"};kc.extend({color:()=>n=>Hu(n).isValid()});const NPe=n=>kc().color().test(n);function Mee(n,{format:e,hasAlpha:t,isString:i}){const r=DPe[e]+(i&&e!=="hex"?"String":""),s=n[r]();return typeof s=="object"&&!t?yEe(s,["a"]):s}const Aee=(n,e)=>{const t=Hu(n);if(!t.isValid())throw Error("Invalid color");return Mee(t,e)},BPe=(n,e)=>Mee(Hu(n),Di(Di({},e),{},{isString:!0,format:"hex"})),FPe=({value:n})=>{const e=JRe(n),t=e==="name"?"hex":e,i=typeof n=="object"?"a"in n:e==="hex"&&n.length===8||/^(rgba)|(hsla)|(hsva)/.test(n),r={format:t,hasAlpha:i,isString:typeof n=="string"};return{value:Aee(n,r),settings:r}};var LPe=Object.freeze({__proto__:null,schema:NPe,sanitize:Aee,format:BPe,normalize:FPe});const IPe=Ei("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:`url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')`,$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),GPe=Ei("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),OPe=Ei("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function cW(n,e){return e!=="rgb"?Hu(n).toRgb():n}function UPe({value:n,displayValue:e,settings:t,onUpdate:i}){const{emitOnEditStart:r,emitOnEditEnd:s}=Cu(),{format:a,hasAlpha:o}=t,{popinRef:l,wrapperRef:u,shown:c,show:d,hide:f}=See(),m=G.useRef(0),[y,_]=G.useState(()=>cW(n,a)),S=o?a3e:l3e,b=()=>{_(cW(n,a)),d(),r()},M=()=>{f(),s(),window.clearTimeout(m.current)},w=()=>{m.current=window.setTimeout(M,500)};return G.useEffect(()=>()=>window.clearTimeout(m.current),[]),Ie.createElement(Ie.Fragment,null,Ie.createElement(IPe,{ref:l,active:c,onClick:()=>b(),style:{color:e}}),c&&Ie.createElement(Qz,null,Ie.createElement(ZQ,{onPointerUp:M}),Ie.createElement(OPe,{ref:u,onMouseEnter:()=>window.clearTimeout(m.current),onMouseLeave:T=>T.buttons===0&&w()},Ie.createElement(S,{color:y,onChange:i}))))}function kPe(){const{value:n,displayValue:e,label:t,onChange:i,onUpdate:r,settings:s}=Cu();return Ie.createElement(Hd,{input:!0},Ie.createElement(ip,null,t),Ie.createElement(GPe,null,Ie.createElement(UPe,{value:n,displayValue:e,onChange:i,onUpdate:r,settings:s}),Ie.createElement(qz,{value:e,onChange:i,onUpdate:r})))}var zPe=Di({component:kPe},LPe);function VPe(){const{label:n,displayValue:e,onUpdate:t,settings:i}=Cu();return Ie.createElement(Hd,{input:!0},Ie.createElement(ip,null,n),Ie.createElement(t9,{value:e,settings:i,onUpdate:t}))}var HPe=Di({component:VPe},eee(["x","y","z"]));const XPe=Ei("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",touchAction:"none",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),WPe=Ei("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function ZPe({value:n,settings:e,onUpdate:t}){const i=G.useRef(),r=G.useRef(0),s=G.useRef(0),a=G.useRef(1),[o,l]=G.useState(!1),[u,c]=G.useState(!1),[d,f]=YQ(),m=G.useRef(null),y=G.useRef(null);G.useLayoutEffect(()=>{if(o){const{top:V,left:W,width:K,height:q}=m.current.getBoundingClientRect();y.current.style.left=W+K/2+"px",y.current.style.top=V+q/2+"px"}},[o]);const{keys:[_,S],joystick:b}=e,M=b==="invertY"?1:-1,{[_]:{step:w},[S]:{step:T}}=e,E=Jg("sizes","joystickWidth"),R=Jg("sizes","joystickHeight"),P=parseFloat(E)*.8/2,I=parseFloat(R)*.8/2,B=G.useCallback(()=>{i.current||(c(!0),r.current&&f({x:r.current*P}),s.current&&f({y:s.current*-I}),i.current=window.setInterval(()=>{t(V=>{const W=w*r.current*a.current,K=M*T*s.current*a.current;return Array.isArray(V)?{[_]:V[0]+W,[S]:V[1]+K}:{[_]:V[_]+W,[S]:V[S]+K}})},16))},[P,I,t,f,w,T,_,S,M]),N=G.useCallback(()=>{window.clearTimeout(i.current),i.current=void 0,c(!1)},[]);G.useEffect(()=>{function V(W){a.current=NQ(W)}return window.addEventListener("keydown",V),window.addEventListener("keyup",V),()=>{window.clearTimeout(i.current),window.removeEventListener("keydown",V),window.removeEventListener("keyup",V)}},[]);const U=IE(({first:V,active:W,delta:[K,q],movement:[j,te]})=>{V&&l(!0);const he=cv(j,-P,P),_e=cv(te,-I,I);r.current=Math.abs(j)>Math.abs(he)?Math.sign(j-he):0,s.current=Math.abs(te)>Math.abs(_e)?Math.sign(_e-te):0;let Be=n[_],ue=n[S];W?(r.current||(Be+=K*w*a.current,f({x:he})),s.current||(ue-=M*q*T*a.current,f({y:_e})),r.current||s.current?B():N(),t({[_]:Be,[S]:ue})):(l(!1),r.current=0,s.current=0,f({x:0,y:0}),N())});return Ie.createElement(XPe,go({ref:m},U()),o&&Ie.createElement(Qz,null,Ie.createElement(WPe,{ref:y,isOutOfBounds:u},Ie.createElement("div",null),Ie.createElement("span",{ref:d}))))}const jPe=Ei("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});function YPe(){const{label:n,displayValue:e,onUpdate:t,settings:i}=Cu();return Ie.createElement(Hd,{input:!0},Ie.createElement(ip,null,n),Ie.createElement(jPe,{withJoystick:!!i.joystick},i.joystick&&Ie.createElement(ZPe,{value:e,settings:i,onUpdate:t}),Ie.createElement(t9,{value:e,settings:i,onUpdate:t})))}const KPe=["joystick"],Tee=eee(["x","y"]),$Pe=n=>{let{joystick:e=!0}=n,t=Hs(n,KPe);const{value:i,settings:r}=Tee.normalize(t);return{value:i,settings:Di(Di({},r),{},{joystick:e})}};var JPe=Di(Di({component:YPe},Tee),{},{normalize:$Pe});const qPe=n=>{if(n!==void 0){if(n instanceof File)try{return URL.createObjectURL(n)}catch{return}if(typeof n=="string"&&n.indexOf("blob:")===0)return n;throw Error("Invalid image format [undefined | blob |File].")}},QPe=(n,e)=>typeof e=="object"&&"image"in e,eDe=({image:n})=>({value:n});var tDe=Object.freeze({__proto__:null,sanitize:qPe,schema:QPe,normalize:eDe});const nDe=Ei("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),iDe=Ei("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),rDe=Ei("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),sDe=Ei("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),aDe=Ei("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),oDe=Ei("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});function lDe(){const{label:n,value:e,onUpdate:t,disabled:i}=Cu(),{popinRef:r,wrapperRef:s,shown:a,show:o,hide:l}=See(),u=G.useCallback(y=>{y.length&&t(y[0])},[t]),c=G.useCallback(y=>{y.stopPropagation(),t(void 0)},[t]),{getRootProps:d,getInputProps:f,isDragAccept:m}=xee({maxFiles:1,accept:"image/*",onDrop:u,disabled:i});return Ie.createElement(Hd,{input:!0},Ie.createElement(ip,null,n),Ie.createElement(nDe,null,Ie.createElement(rDe,{ref:r,hasImage:!!e,onPointerDown:()=>!!e&&o(),onPointerUp:l,style:{backgroundImage:e?`url(${e})`:"none"}}),a&&!!e&&Ie.createElement(Qz,null,Ie.createElement(ZQ,{onPointerUp:l,style:{cursor:"pointer"}}),Ie.createElement(sDe,{ref:s,style:{backgroundImage:`url(${e})`}})),Ie.createElement(iDe,d({isDragAccept:m}),Ie.createElement("input",f()),Ie.createElement(aDe,null,m?"drop image":"click or drop")),Ie.createElement(oDe,{onClick:c,disabled:!e})))}var uDe=Di({component:lDe},tDe);const hW=kc().number(),cDe=(n,e)=>kc().array().length(2).every.number().test(n)&&kc().schema({min:hW,max:hW}).test(e),SB=n=>({min:n[0],max:n[1]}),Cee=(n,{bounds:[e,t]},i)=>{const r=Array.isArray(n)?SB(n):n,s={min:i[0],max:i[1]},{min:a,max:o}=Di(Di({},s),r);return[cv(Number(a),e,Math.max(e,o)),cv(Number(o),Math.min(t,a),t)]},hDe=({value:n,min:e,max:t})=>{const i={min:e,max:t},r=QQ(SB(n),{min:i,max:i}),s=[e,t],a=Di(Di({},r),{},{bounds:s});return{value:Cee(SB(n),a,n),settings:a}};var dDe=Object.freeze({__proto__:null,schema:cDe,format:SB,sanitize:Cee,normalize:hDe});const fDe=["value","bounds","onDrag"],pDe=["bounds"],mDe=Ei("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function gDe(n){let{value:e,bounds:[t,i],onDrag:r}=n,s=Hs(n,fDe);const a=G.useRef(null),o=G.useRef(null),l=G.useRef(null),u=G.useRef(0),c=Jg("sizes","scrubberWidth"),d=IE(({event:y,first:_,xy:[S],movement:[b],memo:M={}})=>{if(_){const{width:T,left:E}=a.current.getBoundingClientRect();u.current=T-parseFloat(c);const R=y?.target===o.current||y?.target===l.current;M.pos=yB((S-E)/T,t,i);const P=Math.abs(M.pos-e.min)-Math.abs(M.pos-e.max);M.key=P<0||P===0&&M.pos<=e.min?"min":"max",R&&(M.pos=e[M.key])}const w=M.pos+yB(b/u.current,0,i-t);return r({[M.key]:rRe(w,s[M.key])}),M}),f=`calc(${gB(e.min,t,i)} * (100% - ${c} - 8px) + 4px)`,m=`calc(${1-gB(e.max,t,i)} * (100% - ${c} - 8px) + 4px)`;return Ie.createElement($Q,go({ref:a},d()),Ie.createElement(KQ,null,Ie.createElement(JQ,{style:{left:f,right:m}})),Ie.createElement(N5,{position:"left",ref:o,style:{left:f}}),Ie.createElement(N5,{position:"right",ref:l,style:{right:m}}))}function yDe(){const{label:n,displayValue:e,onUpdate:t,settings:i}=Cu(),r=Hs(i,pDe);return Ie.createElement(Ie.Fragment,null,Ie.createElement(Hd,{input:!0},Ie.createElement(ip,null,n),Ie.createElement(mDe,null,Ie.createElement(gDe,go({value:e},i,{onDrag:t})),Ie.createElement(t9,{value:e,settings:r,onUpdate:t,innerLabelTrim:0}))))}var vDe=Di({component:yDe},dDe);const xDe=()=>{const n=new Map;return{on:(e,t)=>{let i=n.get(e);i===void 0&&(i=new Set,n.set(e,i)),i.add(t)},off:(e,t)=>{const i=n.get(e);i!==void 0&&(i.delete(t),i.size===0&&n.delete(e))},emit:(e,...t)=>{const i=n.get(e);if(i!==void 0)for(const r of i)r(...t)}}},bDe=["type","value"],_De=["onChange","transient","onEditStart","onEditEnd"],SDe=function(){const e=uPe(cPe(()=>({data:{}}))),t=xDe();this.storeId=mEe(),this.useStore=e;const i={},r=new Set;this.getVisiblePaths=()=>{const a=this.getData(),o=Object.keys(a),l=[];Object.entries(i).forEach(([c,d])=>{d.render&&o.some(f=>f.indexOf(c)===0)&&!d.render(this.get)&&l.push(c+".")});const u=[];return r.forEach(c=>{c in a&&a[c].__refCount>0&&l.every(d=>c.indexOf(d)===-1)&&(!a[c].render||a[c].render(this.get))&&u.push(c)}),u},this.setOrderedPaths=a=>{a.forEach(o=>r.add(o))},this.orderPaths=a=>(this.setOrderedPaths(a),a),this.disposePaths=a=>{e.setState(o=>{const l=o.data;return a.forEach(u=>{if(u in l){const c=l[u];c.__refCount--,c.__refCount===0&&c.type in rm&&delete l[u]}}),{data:l}})},this.dispose=()=>{e.setState(()=>({data:{}}))},this.getFolderSettings=a=>i[a]||{},this.getData=()=>e.getState().data,this.addData=(a,o)=>{e.setState(l=>{const u=l.data;return Object.entries(a).forEach(([c,d])=>{let f=u[c];if(f){const{type:m,value:y}=d,_=Hs(d,bDe);m!==f.type?zg(Uo.INPUT_TYPE_OVERRIDE,c,f.type,m):((f.__refCount===0||o)&&Object.assign(f,_),f.__refCount++)}else u[c]=Di(Di({},d),{},{__refCount:1})}),{data:u}})},this.setValueAtPath=(a,o,l)=>{e.setState(u=>{const c=u.data;return M7(c[a],o,a,this,l),{data:c}})},this.setSettingsAtPath=(a,o)=>{e.setState(l=>{const u=l.data;return u[a].settings=Di(Di({},u[a].settings),o),{data:u}})},this.disableInputAtPath=(a,o)=>{e.setState(l=>{const u=l.data;return u[a].disabled=o,{data:u}})},this.set=(a,o)=>{e.setState(l=>{const u=l.data;return Object.entries(a).forEach(([c,d])=>{try{M7(u[c],d,void 0,void 0,o)}catch{}}),{data:u}})},this.getInput=a=>{try{return this.getData()[a]}catch{zg(Uo.PATH_DOESNT_EXIST,a)}},this.get=a=>{var o;return(o=this.getInput(a))===null||o===void 0?void 0:o.value},this.emitOnEditStart=a=>{t.emit(`onEditStart:${a}`,this.get(a),a,Di(Di({},this.getInput(a)),{},{get:this.get}))},this.emitOnEditEnd=a=>{t.emit(`onEditEnd:${a}`,this.get(a),a,Di(Di({},this.getInput(a)),{},{get:this.get}))},this.subscribeToEditStart=(a,o)=>{const l=`onEditStart:${a}`;return t.on(l,o),()=>t.off(l,o)},this.subscribeToEditEnd=(a,o)=>{const l=`onEditEnd:${a}`;return t.on(l,o),()=>t.off(l,o)};const s=(a,o,l)=>{const u={};return Object.entries(a).forEach(([c,d])=>{if(c==="")return zg(Uo.EMPTY_KEY);let f=l9(o,c);if(d.type===rm.FOLDER){const m=s(d.schema,f,l);Object.assign(u,m),f in i||(i[f]=d.settings)}else if(c in l)zg(Uo.DUPLICATE_KEYS,c,f,l[c].path);else{const m=MEe(d,c,f,u);if(m){const{type:y,options:_,input:S}=m,{onChange:b,transient:M,onEditStart:w,onEditEnd:T}=_,E=Hs(_,_De);u[f]=Di(Di(Di({type:y},E),S),{},{fromPanel:!0}),l[c]={path:f,onChange:b,transient:M,onEditStart:w,onEditEnd:T}}else zg(Uo.UNKNOWN_INPUT,f,d)}}),u};this.getDataFromSchema=a=>{const o={};return[s(a,"",o),o]}},wee=new SDe,MDe={collapsed:!1};function Mi(n,e){return{type:rm.FOLDER,schema:n,settings:Di(Di({},MDe),e)}}const ADe={disabled:!1};function Eee(n,e){return{type:rm.BUTTON,onClick:n,settings:Di(Di({},ADe),e)}}const dW=n=>"__levaInput"in n,TDe=(n,e)=>{const t={},i=e?e.toLowerCase():null;return n.forEach(r=>{const[s,a]=TPe(r);(!i||s.toLowerCase().indexOf(i)>-1)&&APe(t,a,{[s]:{__levaInput:!0,path:r}})}),t},CDe=["type","label","path","valueKey","value","settings","setValue","disabled"];function wDe(n){let{type:e,label:t,path:i,valueKey:r,value:s,settings:a,setValue:o,disabled:l}=n,u=Hs(n,CDe);const{displayValue:c,onChange:d,onUpdate:f}=jQ({type:e,value:s,settings:a,setValue:o}),m=jx[e].component;return m?Ie.createElement(GQ.Provider,{value:Di({key:r,path:i,id:""+i,label:t,displayValue:c,value:s,onChange:d,onUpdate:f,settings:a,setValue:o,disabled:l},u)},Ie.createElement(VEe,{disabled:l},Ie.createElement(m,null))):(zg(Uo.NO_COMPONENT_FOR_TYPE,e,i),null)}const EDe=Ei("button",{display:"block",$reset:"",fontWeight:"$button",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$elevation1",color:"$highlight1","&:not(:disabled)":{color:"$highlight3",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""}});function RDe({onClick:n,settings:e,label:t}){const i=FE();return Ie.createElement(Hd,null,Ie.createElement(EDe,{disabled:e.disabled,onClick:()=>n(i.get)},t))}const PDe=Ei("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),DDe=Ei("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}}),NDe=({label:n,opts:e})=>{let t=typeof n=="string"&&n.trim()===""?null:n,i=e;return typeof e.opts=="object"&&(i.label!==void 0&&(t=e.label),i=e.opts),{label:t,opts:i}};function BDe(n){const{label:e,opts:t}=NDe(n),i=FE();return Ie.createElement(Hd,{input:!!e},e&&Ie.createElement(ip,null,e),Ie.createElement(PDe,null,Object.entries(t).map(([r,s])=>Ie.createElement(DDe,{key:r,onClick:()=>s(i.get)},r))))}const FDe=Ei("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"}),Ree=100;function LDe(n,e){n.push(e),n.length>Ree&&n.shift()}const IDe=G.forwardRef(function({initialValue:n},e){const t=Jg("colors","highlight3"),i=Jg("colors","elevation2"),r=Jg("colors","highlight1"),[s,a]=G.useMemo(()=>[Hu(r).alpha(.4).toRgbString(),Hu(r).alpha(.1).toRgbString()],[r]),o=G.useRef([n]),l=G.useRef(n),u=G.useRef(n),c=G.useRef(),d=G.useCallback((y,_)=>{if(!y)return;const{width:S,height:b}=y,M=new Path2D,w=S/Ree,T=b*.05;for(let P=0;P<o.current.length;P++){const I=gB(o.current[P],l.current,u.current),B=w*P,N=b-I*(b-T*2)-T;M.lineTo(B,N)}_.clearRect(0,0,S,b);const E=new Path2D(M);E.lineTo(w*(o.current.length+1),b),E.lineTo(0,b),E.lineTo(0,0);const R=_.createLinearGradient(0,0,0,b);R.addColorStop(0,s),R.addColorStop(1,a),_.fillStyle=R,_.fill(E),_.strokeStyle=i,_.lineJoin="round",_.lineWidth=14,_.stroke(M),_.strokeStyle=t,_.lineWidth=2,_.stroke(M)},[t,i,s,a]),[f,m]=JEe(d);return G.useImperativeHandle(e,()=>({frame:y=>{(l.current===void 0||y<l.current)&&(l.current=y),(u.current===void 0||y>u.current)&&(u.current=y),LDe(o.current,y),c.current=requestAnimationFrame(()=>d(f.current,m.current))}}),[f,m,d]),G.useEffect(()=>()=>cancelAnimationFrame(c.current),[]),Ie.createElement(FDe,{ref:f})}),fW=n=>Number.isFinite(n)?n.toPrecision(2):n.toString(),GDe=G.forwardRef(function({initialValue:n},e){const[t,i]=G.useState(fW(n));return G.useImperativeHandle(e,()=>({frame:r=>i(fW(r))}),[]),Ie.createElement("div",null,t)});function pW(n){return typeof n=="function"?n():n.current}function ODe({label:n,objectOrFn:e,settings:t}){const i=G.useRef(),r=G.useRef(pW(e));return G.useEffect(()=>{const s=window.setInterval(()=>{var a;document.hidden||(a=i.current)===null||a===void 0||a.frame(pW(e))},t.interval);return()=>window.clearInterval(s)},[e,t.interval]),Ie.createElement(Hd,{input:!0},Ie.createElement(ip,{align:"top"},n),t.graph?Ie.createElement(IDe,{ref:i,initialValue:r.current}):Ie.createElement(GDe,{ref:i,initialValue:r.current}))}const UDe=["type","label","key"],kDe={[rm.BUTTON]:RDe,[rm.BUTTON_GROUP]:BDe,[rm.MONITOR]:ODe},zDe=Ie.memo(({path:n})=>{const[e,{set:t,setSettings:i,disable:r,storeId:s,emitOnEditStart:a,emitOnEditEnd:o}]=QEe(n);if(!e)return null;const{type:l,label:u,key:c}=e,d=Hs(e,UDe);if(l in rm){const f=kDe[l];return Ie.createElement(f,go({label:u,path:n},d))}return l in jx?Ie.createElement(wDe,go({key:s+n,type:l,label:u,storeId:s,path:n,valueKey:c,setValue:t,setSettings:i,disable:r,emitOnEditStart:a,emitOnEditEnd:o},d)):(sEe(Uo.UNSUPPORTED_INPUT,l,n),null)});function VDe({toggle:n,toggled:e,name:t}){return Ie.createElement(UEe,{onClick:()=>n()},Ie.createElement(e9,{toggled:e}),Ie.createElement("div",null,t))}const HDe=({name:n,path:e,tree:t})=>{const i=FE(),r=l9(e,n),{collapsed:s,color:a}=i.getFolderSettings(r),[o,l]=G.useState(!s),u=G.useRef(null),c=Jg("colors","folderWidgetColor"),d=Jg("colors","folderTextColor");return G.useLayoutEffect(()=>{u.current.style.setProperty("--leva-colors-folderWidgetColor",a||c),u.current.style.setProperty("--leva-colors-folderTextColor",a||d)},[a,c,d]),Ie.createElement(vB,{ref:u},Ie.createElement(VDe,{name:n,toggled:o,toggle:()=>l(f=>!f)}),Ie.createElement(Pee,{parent:r,tree:t,toggled:o}))},Pee=Ie.memo(({isRoot:n=!1,fill:e=!1,flat:t=!1,parent:i,tree:r,toggled:s})=>{const{wrapperRef:a,contentRef:o}=EPe(s),l=FE(),u=([d,f])=>{var m;return(dW(f)?(m=l.getInput(f.path))===null||m===void 0?void 0:m.order:l.getFolderSettings(l9(i,d)).order)||0},c=Object.entries(r).sort((d,f)=>u(d)-u(f));return Ie.createElement(P5,{ref:a,isRoot:n,fill:e,flat:t},Ie.createElement(HQ,{ref:o,isRoot:n,toggled:s},c.map(([d,f])=>dW(f)?Ie.createElement(zDe,{key:f.path,valueKey:f.valueKey,path:f.path}):Ie.createElement(HDe,{key:d,name:d,path:i,tree:f}))))}),XDe=Ei("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${WQ}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),Dee=40,MB=Ei("i",{$flexCenter:"",width:Dee,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),WDe=Ei("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),ZDe=Ei("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${MB}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),jDe=Ei("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),YDe=Ei("div",{touchAction:"none",$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:Dee}}}}),KDe=Ie.forwardRef(({setFilter:n,toggle:e},t)=>{const[i,r]=G.useState(""),s=G.useMemo(()=>DQ(n,250),[n]),a=()=>{n(""),r("")},o=l=>{const u=l.currentTarget.value;e(!0),r(u)};return G.useEffect(()=>{s(i)},[i,s]),Ie.createElement(Ie.Fragment,null,Ie.createElement(jDe,{ref:t,value:i,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:l=>l.stopPropagation(),onChange:o}),Ie.createElement(MB,{onClick:()=>a(),style:{visibility:i?"visible":"hidden"}},Ie.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},Ie.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))});function $De({setFilter:n,onDrag:e,onDragStart:t,onDragEnd:i,toggle:r,toggled:s,title:a,drag:o,filterEnabled:l,from:u}){const[c,d]=G.useState(!1),f=G.useRef(null);G.useEffect(()=>{var y,_;c?(y=f.current)===null||y===void 0||y.focus():(_=f.current)===null||_===void 0||_.blur()},[c]);const m=IE(({offset:[y,_],first:S,last:b})=>{e({x:y,y:_}),S&&t({x:y,y:_}),b&&i({x:y,y:_})},{filterTaps:!0,from:({offset:[y,_]})=>[u?.x||y,u?.y||_]});return G.useEffect(()=>{const y=_=>{_.key==="L"&&_.shiftKey&&_.metaKey&&d(S=>!S)};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[]),Ie.createElement(Ie.Fragment,null,Ie.createElement(WDe,{mode:o?"drag":void 0},Ie.createElement(MB,{active:!s,onClick:()=>r()},Ie.createElement(e9,{toggled:s,width:12,height:8})),Ie.createElement(YDe,go({},o?m():{},{drag:o,filterEnabled:l}),a===void 0&&o?Ie.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},Ie.createElement("circle",{cx:"2",cy:"2",r:"2"}),Ie.createElement("circle",{cx:"14",cy:"2",r:"2"}),Ie.createElement("circle",{cx:"26",cy:"2",r:"2"}),Ie.createElement("circle",{cx:"2",cy:"12",r:"2"}),Ie.createElement("circle",{cx:"14",cy:"12",r:"2"}),Ie.createElement("circle",{cx:"26",cy:"12",r:"2"})):a),l&&Ie.createElement(MB,{active:c,onClick:()=>d(y=>!y)},Ie.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},Ie.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),Ie.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),Ie.createElement(ZDe,{toggled:c},Ie.createElement(KDe,{ref:f,setFilter:n,toggle:r})))}const JDe=["store","hidden","theme","collapsed"];function qDe(n){let{store:e,hidden:t=!1,theme:i,collapsed:r=!1}=n,s=Hs(n,JDe);const a=_ee(()=>BEe(i),[i]),[o,l]=G.useState(!r),u=typeof r=="object"?!r.collapsed:o,c=G.useMemo(()=>typeof r=="object"?d=>{typeof d=="function"?r.onChange(!d(!r.collapsed)):r.onChange(!d)}:l,[r]);return!e||t?null:Ie.createElement(Jz.Provider,{value:a},Ie.createElement(QDe,go({store:e},s,{toggled:u,setToggle:c,rootClass:a.className})))}const QDe=Ie.memo(({store:n,rootClass:e,fill:t=!1,flat:i=!1,neverHide:r=!1,oneLineLabels:s=!1,titleBar:a={title:void 0,drag:!0,filter:!0,position:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0},hideCopyButton:o=!1,toggled:l,setToggle:u})=>{var c,d;const f=RPe(n),[m,y]=G.useState(""),_=G.useMemo(()=>TDe(f,m),[f,m]),[S,b]=YQ(),M=r||f.length>0,w=typeof a=="object"&&a.title||void 0,T=typeof a=="object"&&(c=a.drag)!==null&&c!==void 0?c:!0,E=typeof a=="object"&&(d=a.filter)!==null&&d!==void 0?d:!0,R=typeof a=="object"&&a.position||void 0,P=typeof a=="object"&&a.onDrag||void 0,I=typeof a=="object"&&a.onDragStart||void 0,B=typeof a=="object"&&a.onDragEnd||void 0;return Ie.useEffect(()=>{b({x:R?.x,y:R?.y})},[R,b]),NEe(),Ie.createElement(qwe,null,Ie.createElement(UQ.Provider,{value:{hideCopyButton:o}},Ie.createElement(XDe,{ref:S,className:e,fill:t,flat:i,oneLineLabels:s,hideTitleBar:!a,style:{display:M?"block":"none"}},a&&Ie.createElement($De,{onDrag:N=>{b(N),P?.(N)},onDragStart:N=>I?.(N),onDragEnd:N=>B?.(N),setFilter:y,toggle:N=>u(U=>N??!U),toggled:l,title:w,drag:T,filterEnabled:E,from:R}),M&&Ie.createElement(OQ.Provider,{value:n},Ie.createElement(Pee,{isRoot:!0,fill:t,flat:i,tree:_,toggled:l})))))}),eNe=["isRoot"];let AB=!1,bx=null;function Nee(n){let{isRoot:e=!1}=n,t=Hs(n,eNe);return G.useEffect(()=>(AB=!0,!e&&bx&&(bx.remove(),bx=null),()=>{e||(AB=!1)}),[e]),Ie.createElement(qDe,go({store:wee},t))}function tNe(n){G.useEffect(()=>{n&&!AB&&(bx||(bx=document.getElementById("leva__root")||Object.assign(document.createElement("div"),{id:"leva__root"}),document.body&&(document.body.appendChild(bx),Uz.createRoot(bx).render(Ie.createElement(Nee,{isRoot:!0})))),AB=!0)},[n])}function nNe(n,e,t,i,r){let s,a,o,l,u;return typeof n=="string"?(a=n,s=e,Array.isArray(t)?u=t:t&&("store"in t?(l=t,u=i):(o=t,Array.isArray(i)?u=i:(l=i,u=r)))):(s=n,Array.isArray(e)?u=e:(l=e,u=t)),{schema:s,folderName:a,folderSettings:o,hookSettings:l,deps:u||[]}}function Ks(n,e,t,i,r){const{folderName:s,schema:a,folderSettings:o,hookSettings:l,deps:u}=nNe(n,e,t,i,r),c=typeof a=="function",d=G.useRef(!1),f=G.useRef(!0),m=_ee(()=>{d.current=!0;const U=typeof a=="function"?a():a;return s?{[s]:Mi(U,o)}:U},u),y=!(l!=null&&l.store);tNe(y);const[_]=G.useState(()=>l?.store||wee),[S,b]=G.useMemo(()=>_.getDataFromSchema(m),[_,m]),[M,w,T,E,R]=G.useMemo(()=>{const U=[],V=[],W={},K={},q={};return Object.values(b).forEach(({path:j,onChange:te,onEditStart:he,onEditEnd:_e,transient:Be})=>{U.push(j),te?(W[j]=te,Be||V.push(j)):V.push(j),he&&(K[j]=he),_e&&(q[j]=_e)}),[U,V,W,K,q]},[b]),P=G.useMemo(()=>_.orderPaths(M),[M,_]),I=PPe(_,w,S),B=G.useCallback(U=>{const V=Object.entries(U).reduce((W,[K,q])=>Object.assign(W,{[b[K].path]:q}),{});_.set(V,!1)},[_,b]),N=G.useCallback(U=>_.get(b[U].path),[_,b]);return G.useEffect(()=>{const U=!f.current&&d.current;return _.addData(S,U),f.current=!1,d.current=!1,()=>_.disposePaths(P)},[_,P,S]),G.useEffect(()=>{const U=[];return Object.entries(T).forEach(([V,W])=>{W(_.get(V),V,Di({initial:!0,get:_.get},_.getInput(V)));const K=_.useStore.subscribe(q=>{const j=q.data[V];return[j.disabled?void 0:j.value,j]},([q,j])=>W(q,V,Di({initial:!1,get:_.get},j)),{equalityFn:w2});U.push(K)}),()=>U.forEach(V=>V())},[_,T]),G.useEffect(()=>{const U=[];return Object.entries(E).forEach(([V,W])=>U.push(_.subscribeToEditStart(V,W))),Object.entries(R).forEach(([V,W])=>U.push(_.subscribeToEditEnd(V,W))),()=>U.forEach(V=>V())},[E,R,_]),c?[I,B,N]:I}S0(M0.SELECT,gRe);S0(M0.IMAGE,uDe);S0(M0.NUMBER,aRe);S0(M0.COLOR,zPe);S0(M0.STRING,TRe);S0(M0.BOOLEAN,NRe);S0(M0.INTERVAL,vDe);S0(M0.VECTOR3D,HPe);S0(M0.VECTOR2D,JPe);function u9(){const n=window.location.hostname,e=n.endsWith("github.io"),t=["localhost","127.0.0.1","[::1]"].includes(n),i=["192.168"].includes(n);return(t||i)&&!e}function c9(n){return`/eye-candy/${n.startsWith("/")?n.substring(1):n}`}function US(n){return c9(`/audio/${n}`)}function $l(n){return c9(`/models/${n}`)}function iNe(n){return c9(`/videos/${n}`)}const Xd="182",Ly={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Iy={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},O2=0,Uw=1,U2=2,Bee=3,UE=0,tv=1,YS=2,Ad=3,wo=0,Er=1,fr=2,Oa=0,Al=1,bm=2,u0=3,c0=4,nv=5,vl=100,kE=101,zE=102,k2=103,z2=104,Bf=200,VE=201,HE=202,XE=203,Yx=204,Kx=205,WE=206,ZE=207,jE=208,YE=209,KE=210,h9=211,d9=212,f9=213,p9=214,$x=0,hv=1,Jx=2,_m=3,qx=4,Qx=5,eb=6,tb=7,Sb=0,V2=1,H2=2,ho=0,$E=1,JE=2,qE=3,zM=4,X2=5,QE=6,eR=7,TB="attached",m9="detached",Sm=300,_u=301,wh=302,Mm=303,h0=304,Am=306,Xc=1e3,ps=1001,jf=1002,xr=1003,Mb=1004,Fee=1004,xh=1005,Lee=1005,Jn=1006,sm=1007,Iee=1007,Vo=1008,kw=1008,br=1009,am=1010,om=1011,zc=1012,Ao=1013,qr=1014,wr=1015,zi=1016,VM=1017,HM=1018,jl=1020,XM=35902,WM=35899,tR=1021,Ab=1022,Vr=1023,Xo=1026,bl=1027,rp=1028,A0=1029,_l=1030,jv=1031,g9=1032,Yv=1033,lm=33776,um=33777,cm=33778,hm=33779,nb=35840,ib=35841,rb=35842,sb=35843,dv=36196,fv=37492,pv=37496,mv=37488,gv=37489,d0=37490,yv=37491,vv=37808,xv=37809,bv=37810,_v=37811,Sv=37812,Mv=37813,Av=37814,Tv=37815,Cv=37816,wv=37817,Ev=37818,Rv=37819,Pv=37820,Dv=37821,Nv=36492,zw=36494,Vw=36495,Bv=36283,Fv=36284,f0=36285,Lv=36286,y9=2200,v9=2201,x9=2202,ab=2300,ob=2301,aw=2302,Vy=2400,Hy=2401,mM=2402,nR=2500,W2=2501,b9=0,Z2=1,Hw=2,sp=3200,Gee=3201,Oee=3202,Uee=3203,Fd=0,j2=1,xl="",Ps="srgb",Su="srgb-linear",Iv="linear",Hn="srgb",ow="",Y2="rg",_9="ga",S9=0,Og=7680,M9=7681,A9=7682,T9=7683,C9=34055,w9=34056,E9=5386,R9=512,P9=513,D9=514,N9=515,B9=516,F9=517,L9=518,Xw=519,iR=512,Tb=513,rR=514,Cb=515,sR=516,aR=517,wb=518,oR=519,p0=35044,bh=35048,kee=35040,zee=35045,Vee=35049,Hee=35041,Xee=35046,Wee=35050,Zee=35042,jee="100",CB="300 es",Sl=2e3,ic=2001,Td={COMPUTE:"compute",RENDER:"render"},Yee={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},Kee={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function I9(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const rNe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function kS(n,e){return new rNe[n](e)}function gM(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Ww(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function K2(){const n=Ww("canvas");return n.style.display="block",n}const mW={};let Gv=null;function $ee(n){Gv=n}function Jee(){return Gv}function lb(...n){const e="THREE."+n.shift();Gv?Gv("log",e,...n):console.log(e,...n)}function mt(...n){const e="THREE."+n.shift();Gv?Gv("warn",e,...n):console.warn(e,...n)}function Tt(...n){const e="THREE."+n.shift();Gv?Gv("error",e,...n):console.error(e,...n)}function hs(...n){const e=n.join(" ");e in mW||(mW[e]=!0,mt(...n))}function sNe(n,e,t){return new Promise(function(i,r){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}}setTimeout(s,t)})}let wl=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const r=i[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}};const du=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let gW=1234567;const Ix=Math.PI/180,ub=180/Math.PI;function Ah(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(du[n&255]+du[n>>8&255]+du[n>>16&255]+du[n>>24&255]+"-"+du[e&255]+du[e>>8&255]+"-"+du[e>>16&15|64]+du[e>>24&255]+"-"+du[t&63|128]+du[t>>8&255]+"-"+du[t>>16&255]+du[t>>24&255]+du[i&255]+du[i>>8&255]+du[i>>16&255]+du[i>>24&255]).toLowerCase()}function Ii(n,e,t){return Math.max(e,Math.min(t,n))}function G9(n,e){return(n%e+e)%e}function aNe(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function oNe(n,e,t){return n!==e?(t-n)/(e-n):0}function lw(n,e,t){return(1-t)*n+t*e}function lNe(n,e,t,i){return lw(n,e,1-Math.exp(-t*i))}function uNe(n,e=1){return e-Math.abs(G9(n,e*2)-e)}function cNe(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function hNe(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function dNe(n,e){return n+Math.floor(Math.random()*(e-n+1))}function fNe(n,e){return n+Math.random()*(e-n)}function pNe(n){return n*(.5-Math.random())}function mNe(n){n!==void 0&&(gW=n);let e=gW+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function gNe(n){return n*Ix}function yNe(n){return n*ub}function vNe(n){return(n&n-1)===0&&n!==0}function xNe(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function bNe(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function _Ne(n,e,t,i,r){const s=Math.cos,a=Math.sin,o=s(t/2),l=a(t/2),u=s((e+i)/2),c=a((e+i)/2),d=s((e-i)/2),f=a((e-i)/2),m=s((i-e)/2),y=a((i-e)/2);switch(r){case"XYX":n.set(o*c,l*d,l*f,o*u);break;case"YZY":n.set(l*f,o*c,l*d,o*u);break;case"ZXZ":n.set(l*d,l*f,o*c,o*u);break;case"XZX":n.set(o*c,l*y,l*m,o*u);break;case"YXY":n.set(l*m,o*c,l*y,o*u);break;case"ZYZ":n.set(l*y,l*m,o*c,o*u);break;default:mt("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Ku(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function lr(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const Wl={DEG2RAD:Ix,RAD2DEG:ub,generateUUID:Ah,clamp:Ii,euclideanModulo:G9,mapLinear:aNe,inverseLerp:oNe,lerp:lw,damp:lNe,pingpong:uNe,smoothstep:cNe,smootherstep:hNe,randInt:dNe,randFloat:fNe,randFloatSpread:pNe,seededRandom:mNe,degToRad:gNe,radToDeg:yNe,isPowerOfTwo:vNe,ceilPowerOfTwo:xNe,floorPowerOfTwo:bNe,setQuaternionFromProperEuler:_Ne,normalize:lr,denormalize:Ku};class rt{constructor(e=0,t=0){rt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Ii(this.x,e.x,t.x),this.y=Ii(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Ii(this.x,e,t),this.y=Ii(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ii(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ii(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*i-a*r+e.x,this.y=s*r+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ba{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,a,o){let l=i[r+0],u=i[r+1],c=i[r+2],d=i[r+3],f=s[a+0],m=s[a+1],y=s[a+2],_=s[a+3];if(o<=0){e[t+0]=l,e[t+1]=u,e[t+2]=c,e[t+3]=d;return}if(o>=1){e[t+0]=f,e[t+1]=m,e[t+2]=y,e[t+3]=_;return}if(d!==_||l!==f||u!==m||c!==y){let S=l*f+u*m+c*y+d*_;S<0&&(f=-f,m=-m,y=-y,_=-_,S=-S);let b=1-o;if(S<.9995){const M=Math.acos(S),w=Math.sin(M);b=Math.sin(b*M)/w,o=Math.sin(o*M)/w,l=l*b+f*o,u=u*b+m*o,c=c*b+y*o,d=d*b+_*o}else{l=l*b+f*o,u=u*b+m*o,c=c*b+y*o,d=d*b+_*o;const M=1/Math.sqrt(l*l+u*u+c*c+d*d);l*=M,u*=M,c*=M,d*=M}}e[t]=l,e[t+1]=u,e[t+2]=c,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,r,s,a){const o=i[r],l=i[r+1],u=i[r+2],c=i[r+3],d=s[a],f=s[a+1],m=s[a+2],y=s[a+3];return e[t]=o*y+c*d+l*m-u*f,e[t+1]=l*y+c*f+u*d-o*m,e[t+2]=u*y+c*m+o*f-l*d,e[t+3]=c*y-o*d-l*f-u*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,u=o(i/2),c=o(r/2),d=o(s/2),f=l(i/2),m=l(r/2),y=l(s/2);switch(a){case"XYZ":this._x=f*c*d+u*m*y,this._y=u*m*d-f*c*y,this._z=u*c*y+f*m*d,this._w=u*c*d-f*m*y;break;case"YXZ":this._x=f*c*d+u*m*y,this._y=u*m*d-f*c*y,this._z=u*c*y-f*m*d,this._w=u*c*d+f*m*y;break;case"ZXY":this._x=f*c*d-u*m*y,this._y=u*m*d+f*c*y,this._z=u*c*y+f*m*d,this._w=u*c*d-f*m*y;break;case"ZYX":this._x=f*c*d-u*m*y,this._y=u*m*d+f*c*y,this._z=u*c*y-f*m*d,this._w=u*c*d+f*m*y;break;case"YZX":this._x=f*c*d+u*m*y,this._y=u*m*d+f*c*y,this._z=u*c*y-f*m*d,this._w=u*c*d-f*m*y;break;case"XZY":this._x=f*c*d-u*m*y,this._y=u*m*d-f*c*y,this._z=u*c*y+f*m*d,this._w=u*c*d+f*m*y;break;default:mt("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],a=t[1],o=t[5],l=t[9],u=t[2],c=t[6],d=t[10],f=i+o+d;if(f>0){const m=.5/Math.sqrt(f+1);this._w=.25/m,this._x=(c-l)*m,this._y=(s-u)*m,this._z=(a-r)*m}else if(i>o&&i>d){const m=2*Math.sqrt(1+i-o-d);this._w=(c-l)/m,this._x=.25*m,this._y=(r+a)/m,this._z=(s+u)/m}else if(o>d){const m=2*Math.sqrt(1+o-i-d);this._w=(s-u)/m,this._x=(r+a)/m,this._y=.25*m,this._z=(l+c)/m}else{const m=2*Math.sqrt(1+d-i-o);this._w=(a-r)/m,this._x=(s+u)/m,this._y=(l+c)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ii(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,a=e._w,o=t._x,l=t._y,u=t._z,c=t._w;return this._x=i*c+a*o+r*u-s*l,this._y=r*c+a*l+s*o-i*u,this._z=s*c+a*u+i*l-r*o,this._w=a*c-i*o-r*l-s*u,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let i=e._x,r=e._y,s=e._z,a=e._w,o=this.dot(e);o<0&&(i=-i,r=-r,s=-s,a=-a,o=-o);let l=1-t;if(o<.9995){const u=Math.acos(o),c=Math.sin(u);l=Math.sin(l*u)/c,t=Math.sin(t*u)/c,this._x=this._x*l+i*t,this._y=this._y*l+r*t,this._z=this._z*l+s*t,this._w=this._w*l+a*t,this._onChangeCallback()}else this._x=this._x*l+i*t,this._y=this._y*l+r*t,this._z=this._z*l+s*t,this._w=this._w*l+a*t,this.normalize();return this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class re{constructor(e=0,t=0,i=0){re.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(yW.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(yW.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,a=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*a,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*a,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*a,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,a=e.y,o=e.z,l=e.w,u=2*(a*r-o*i),c=2*(o*t-s*r),d=2*(s*i-a*t);return this.x=t+l*u+a*d-o*c,this.y=i+l*c+o*u-s*d,this.z=r+l*d+s*c-a*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Ii(this.x,e.x,t.x),this.y=Ii(this.y,e.y,t.y),this.z=Ii(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Ii(this.x,e,t),this.y=Ii(this.y,e,t),this.z=Ii(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ii(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,a=t.x,o=t.y,l=t.z;return this.x=r*l-s*o,this.y=s*a-i*l,this.z=i*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return SG.copy(this).projectOnVector(e),this.sub(SG)}reflect(e){return this.sub(SG.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ii(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const SG=new re,yW=new ba;class Li{constructor(e,t,i,r,s,a,o,l,u){Li.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,a,o,l,u)}set(e,t,i,r,s,a,o,l,u){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=s,c[5]=l,c[6]=i,c[7]=a,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,a=i[0],o=i[3],l=i[6],u=i[1],c=i[4],d=i[7],f=i[2],m=i[5],y=i[8],_=r[0],S=r[3],b=r[6],M=r[1],w=r[4],T=r[7],E=r[2],R=r[5],P=r[8];return s[0]=a*_+o*M+l*E,s[3]=a*S+o*w+l*R,s[6]=a*b+o*T+l*P,s[1]=u*_+c*M+d*E,s[4]=u*S+c*w+d*R,s[7]=u*b+c*T+d*P,s[2]=f*_+m*M+y*E,s[5]=f*S+m*w+y*R,s[8]=f*b+m*T+y*P,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],c=e[8];return t*a*c-t*o*u-i*s*c+i*o*l+r*s*u-r*a*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],c=e[8],d=c*a-o*u,f=o*l-c*s,m=u*s-a*l,y=t*d+i*f+r*m;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/y;return e[0]=d*_,e[1]=(r*u-c*i)*_,e[2]=(o*i-r*a)*_,e[3]=f*_,e[4]=(c*t-r*l)*_,e[5]=(r*s-o*t)*_,e[6]=m*_,e[7]=(i*l-u*t)*_,e[8]=(a*t-i*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,a,o){const l=Math.cos(s),u=Math.sin(s);return this.set(i*l,i*u,-i*(l*a+u*o)+a+e,-r*u,r*l,-r*(-u*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(MG.makeScale(e,t)),this}rotate(e){return this.premultiply(MG.makeRotation(-e)),this}translate(e,t){return this.premultiply(MG.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const MG=new Li,vW=new Li().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),xW=new Li().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function SNe(){const n={enabled:!0,workingColorSpace:Su,spaces:{},convert:function(r,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===Hn&&(r.r=qg(r.r),r.g=qg(r.g),r.b=qg(r.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Hn&&(r.r=KS(r.r),r.g=KS(r.g),r.b=KS(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===xl?Iv:this.spaces[r].transfer},getToneMappingMode:function(r){return this.spaces[r].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,a){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return hs("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return hs("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[Su]:{primaries:e,whitePoint:i,transfer:Iv,toXYZ:vW,fromXYZ:xW,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Ps},outputColorSpaceConfig:{drawingBufferColorSpace:Ps}},[Ps]:{primaries:e,whitePoint:i,transfer:Hn,toXYZ:vW,fromXYZ:xW,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Ps}}}),n}const di=SNe();function qg(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function KS(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let U_;class O9{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{U_===void 0&&(U_=Ww("canvas")),U_.width=e.width,U_.height=e.height;const r=U_.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=U_}return i.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Ww("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let a=0;a<s.length;a++)s[a]=qg(s[a]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(qg(t[i]/255)*255):t[i]=qg(t[i]);return{data:t,width:e.width,height:e.height}}else return mt("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let MNe=0;class Zg{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:MNe++}),this.uuid=Ah(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let a=0,o=r.length;a<o;a++)r[a].isDataTexture?s.push(AG(r[a].image)):s.push(AG(r[a]))}else s=AG(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function AG(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?O9.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(mt("Texture: Unable to serialize Texture."),{})}let ANe=0;const TG=new re;class pr extends wl{constructor(e=pr.DEFAULT_IMAGE,t=pr.DEFAULT_MAPPING,i=ps,r=ps,s=Jn,a=Vo,o=Vr,l=br,u=pr.DEFAULT_ANISOTROPY,c=xl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ANe++}),this.uuid=Ah(),this.name="",this.source=new Zg(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=l,this.offset=new rt(0,0),this.repeat=new rt(1,1),this.center=new rt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Li,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(TG).x}get height(){return this.source.getSize(TG).y}get depth(){return this.source.getSize(TG).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const i=e[t];if(i===void 0){mt(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){mt(`Texture.setValues(): property '${t}' does not exist.`);continue}r&&i&&r.isVector2&&i.isVector2||r&&i&&r.isVector3&&i.isVector3||r&&i&&r.isMatrix3&&i.isMatrix3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Sm)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Xc:e.x=e.x-Math.floor(e.x);break;case ps:e.x=e.x<0?0:1;break;case jf:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Xc:e.y=e.y-Math.floor(e.y);break;case ps:e.y=e.y<0?0:1;break;case jf:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}pr.DEFAULT_IMAGE=null;pr.DEFAULT_MAPPING=Sm;pr.DEFAULT_ANISOTROPY=1;class si{constructor(e=0,t=0,i=0,r=1){si.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*s,this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*s,this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*s,this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,u=l[0],c=l[4],d=l[8],f=l[1],m=l[5],y=l[9],_=l[2],S=l[6],b=l[10];if(Math.abs(c-f)<.01&&Math.abs(d-_)<.01&&Math.abs(y-S)<.01){if(Math.abs(c+f)<.1&&Math.abs(d+_)<.1&&Math.abs(y+S)<.1&&Math.abs(u+m+b-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const w=(u+1)/2,T=(m+1)/2,E=(b+1)/2,R=(c+f)/4,P=(d+_)/4,I=(y+S)/4;return w>T&&w>E?w<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(w),r=R/i,s=P/i):T>E?T<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(T),i=R/r,s=I/r):E<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(E),i=P/s,r=I/s),this.set(i,r,s,t),this}let M=Math.sqrt((S-y)*(S-y)+(d-_)*(d-_)+(f-c)*(f-c));return Math.abs(M)<.001&&(M=1),this.x=(S-y)/M,this.y=(d-_)/M,this.z=(f-c)/M,this.w=Math.acos((u+m+b-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Ii(this.x,e.x,t.x),this.y=Ii(this.y,e.y,t.y),this.z=Ii(this.z,e.z,t.z),this.w=Ii(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Ii(this.x,e,t),this.y=Ii(this.y,e,t),this.z=Ii(this.z,e,t),this.w=Ii(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ii(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Wd extends wl{constructor(e=1,t=1,i={}){super(),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Jn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},i),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=i.depth,this.scissor=new si(0,0,e,t),this.scissorTest=!1,this.viewport=new si(0,0,e,t);const r={width:e,height:t,depth:i.depth},s=new pr(r);this.textures=[];const a=i.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(i),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}_setTextureOptions(e={}){const t={minFilter:Jn,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let i=0;i<this.textures.length;i++)this.textures[i].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i,this.textures[r].isData3DTexture!==!0&&(this.textures[r].isArrayTexture=this.textures[r].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,i=e.textures.length;t<i;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new Zg(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Nr extends Wd{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class ZM extends pr{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=xr,this.minFilter=xr,this.wrapR=ps,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class qee extends Nr{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new ZM(null,e,t,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class lR extends pr{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=xr,this.minFilter=xr,this.wrapR=ps,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Qee extends Nr{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new lR(null,e,t,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class Ns{constructor(e=new re(1/0,1/0,1/0),t=new re(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Sf.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Sf.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Sf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,Sf):Sf.fromBufferAttribute(s,a),Sf.applyMatrix4(e.matrixWorld),this.expandByPoint(Sf);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),PP.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),PP.copy(i.boundingBox)),PP.applyMatrix4(e.matrixWorld),this.union(PP)}const r=e.children;for(let s=0,a=r.length;s<a;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Sf),Sf.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(HT),DP.subVectors(this.max,HT),k_.subVectors(e.a,HT),z_.subVectors(e.b,HT),V_.subVectors(e.c,HT),py.subVectors(z_,k_),my.subVectors(V_,z_),k1.subVectors(k_,V_);let t=[0,-py.z,py.y,0,-my.z,my.y,0,-k1.z,k1.y,py.z,0,-py.x,my.z,0,-my.x,k1.z,0,-k1.x,-py.y,py.x,0,-my.y,my.x,0,-k1.y,k1.x,0];return!CG(t,k_,z_,V_,DP)||(t=[1,0,0,0,1,0,0,0,1],!CG(t,k_,z_,V_,DP))?!1:(NP.crossVectors(py,my),t=[NP.x,NP.y,NP.z],CG(t,k_,z_,V_,DP))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Sf).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Sf).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(_g[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_g[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_g[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_g[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_g[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_g[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_g[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_g[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_g),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const _g=[new re,new re,new re,new re,new re,new re,new re,new re],Sf=new re,PP=new Ns,k_=new re,z_=new re,V_=new re,py=new re,my=new re,k1=new re,HT=new re,DP=new re,NP=new re,z1=new re;function CG(n,e,t,i,r){for(let s=0,a=n.length-3;s<=a;s+=3){z1.fromArray(n,s);const o=r.x*Math.abs(z1.x)+r.y*Math.abs(z1.y)+r.z*Math.abs(z1.z),l=e.dot(z1),u=t.dot(z1),c=i.dot(z1);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>o)return!1}return!0}const TNe=new Ns,XT=new re,wG=new re;let fo=class{constructor(e=new re,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):TNe.setFromPoints(e).getCenter(i);let r=0;for(let s=0,a=e.length;s<a;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;XT.subVectors(e,this.center);const t=XT.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(XT,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(wG.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(XT.copy(e.center).add(wG)),this.expandByPoint(XT.copy(e.center).sub(wG))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}};const Sg=new re,EG=new re,BP=new re,gy=new re,RG=new re,FP=new re,PG=new re;class Im{constructor(e=new re,t=new re(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Sg)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Sg.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Sg.copy(this.origin).addScaledVector(this.direction,t),Sg.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){EG.copy(e).add(t).multiplyScalar(.5),BP.copy(t).sub(e).normalize(),gy.copy(this.origin).sub(EG);const s=e.distanceTo(t)*.5,a=-this.direction.dot(BP),o=gy.dot(this.direction),l=-gy.dot(BP),u=gy.lengthSq(),c=Math.abs(1-a*a);let d,f,m,y;if(c>0)if(d=a*l-o,f=a*o-l,y=s*c,d>=0)if(f>=-y)if(f<=y){const _=1/c;d*=_,f*=_,m=d*(d+a*f+2*o)+f*(a*d+f+2*l)+u}else f=s,d=Math.max(0,-(a*f+o)),m=-d*d+f*(f+2*l)+u;else f=-s,d=Math.max(0,-(a*f+o)),m=-d*d+f*(f+2*l)+u;else f<=-y?(d=Math.max(0,-(-a*s+o)),f=d>0?-s:Math.min(Math.max(-s,-l),s),m=-d*d+f*(f+2*l)+u):f<=y?(d=0,f=Math.min(Math.max(-s,-l),s),m=f*(f+2*l)+u):(d=Math.max(0,-(a*s+o)),f=d>0?s:Math.min(Math.max(-s,-l),s),m=-d*d+f*(f+2*l)+u);else f=a>0?-s:s,d=Math.max(0,-(a*f+o)),m=-d*d+f*(f+2*l)+u;return i&&i.copy(this.origin).addScaledVector(this.direction,d),r&&r.copy(EG).addScaledVector(BP,f),m}intersectSphere(e,t){Sg.subVectors(e.center,this.origin);const i=Sg.dot(this.direction),r=Sg.dot(Sg)-i*i,s=e.radius*e.radius;if(r>s)return null;const a=Math.sqrt(s-r),o=i-a,l=i+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,a,o,l;const u=1/this.direction.x,c=1/this.direction.y,d=1/this.direction.z,f=this.origin;return u>=0?(i=(e.min.x-f.x)*u,r=(e.max.x-f.x)*u):(i=(e.max.x-f.x)*u,r=(e.min.x-f.x)*u),c>=0?(s=(e.min.y-f.y)*c,a=(e.max.y-f.y)*c):(s=(e.max.y-f.y)*c,a=(e.min.y-f.y)*c),i>a||s>r||((s>i||isNaN(i))&&(i=s),(a<r||isNaN(r))&&(r=a),d>=0?(o=(e.min.z-f.z)*d,l=(e.max.z-f.z)*d):(o=(e.max.z-f.z)*d,l=(e.min.z-f.z)*d),i>l||o>r)||((o>i||i!==i)&&(i=o),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Sg)!==null}intersectTriangle(e,t,i,r,s){RG.subVectors(t,e),FP.subVectors(i,e),PG.crossVectors(RG,FP);let a=this.direction.dot(PG),o;if(a>0){if(r)return null;o=1}else if(a<0)o=-1,a=-a;else return null;gy.subVectors(this.origin,e);const l=o*this.direction.dot(FP.crossVectors(gy,FP));if(l<0)return null;const u=o*this.direction.dot(RG.cross(gy));if(u<0||l+u>a)return null;const c=-o*gy.dot(PG);return c<0?null:this.at(c/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Mn{constructor(e,t,i,r,s,a,o,l,u,c,d,f,m,y,_,S){Mn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,a,o,l,u,c,d,f,m,y,_,S)}set(e,t,i,r,s,a,o,l,u,c,d,f,m,y,_,S){const b=this.elements;return b[0]=e,b[4]=t,b[8]=i,b[12]=r,b[1]=s,b[5]=a,b[9]=o,b[13]=l,b[2]=u,b[6]=c,b[10]=d,b[14]=f,b[3]=m,b[7]=y,b[11]=_,b[15]=S,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Mn().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),i.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this)}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,i=e.elements,r=1/H_.setFromMatrixColumn(e,0).length(),s=1/H_.setFromMatrixColumn(e,1).length(),a=1/H_.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,a=Math.cos(i),o=Math.sin(i),l=Math.cos(r),u=Math.sin(r),c=Math.cos(s),d=Math.sin(s);if(e.order==="XYZ"){const f=a*c,m=a*d,y=o*c,_=o*d;t[0]=l*c,t[4]=-l*d,t[8]=u,t[1]=m+y*u,t[5]=f-_*u,t[9]=-o*l,t[2]=_-f*u,t[6]=y+m*u,t[10]=a*l}else if(e.order==="YXZ"){const f=l*c,m=l*d,y=u*c,_=u*d;t[0]=f+_*o,t[4]=y*o-m,t[8]=a*u,t[1]=a*d,t[5]=a*c,t[9]=-o,t[2]=m*o-y,t[6]=_+f*o,t[10]=a*l}else if(e.order==="ZXY"){const f=l*c,m=l*d,y=u*c,_=u*d;t[0]=f-_*o,t[4]=-a*d,t[8]=y+m*o,t[1]=m+y*o,t[5]=a*c,t[9]=_-f*o,t[2]=-a*u,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const f=a*c,m=a*d,y=o*c,_=o*d;t[0]=l*c,t[4]=y*u-m,t[8]=f*u+_,t[1]=l*d,t[5]=_*u+f,t[9]=m*u-y,t[2]=-u,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const f=a*l,m=a*u,y=o*l,_=o*u;t[0]=l*c,t[4]=_-f*d,t[8]=y*d+m,t[1]=d,t[5]=a*c,t[9]=-o*c,t[2]=-u*c,t[6]=m*d+y,t[10]=f-_*d}else if(e.order==="XZY"){const f=a*l,m=a*u,y=o*l,_=o*u;t[0]=l*c,t[4]=-d,t[8]=u*c,t[1]=f*d+_,t[5]=a*c,t[9]=m*d-y,t[2]=y*d-m,t[6]=o*c,t[10]=_*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(CNe,e,wNe)}lookAt(e,t,i){const r=this.elements;return oh.subVectors(e,t),oh.lengthSq()===0&&(oh.z=1),oh.normalize(),yy.crossVectors(i,oh),yy.lengthSq()===0&&(Math.abs(i.z)===1?oh.x+=1e-4:oh.z+=1e-4,oh.normalize(),yy.crossVectors(i,oh)),yy.normalize(),LP.crossVectors(oh,yy),r[0]=yy.x,r[4]=LP.x,r[8]=oh.x,r[1]=yy.y,r[5]=LP.y,r[9]=oh.y,r[2]=yy.z,r[6]=LP.z,r[10]=oh.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,a=i[0],o=i[4],l=i[8],u=i[12],c=i[1],d=i[5],f=i[9],m=i[13],y=i[2],_=i[6],S=i[10],b=i[14],M=i[3],w=i[7],T=i[11],E=i[15],R=r[0],P=r[4],I=r[8],B=r[12],N=r[1],U=r[5],V=r[9],W=r[13],K=r[2],q=r[6],j=r[10],te=r[14],he=r[3],_e=r[7],Be=r[11],ue=r[15];return s[0]=a*R+o*N+l*K+u*he,s[4]=a*P+o*U+l*q+u*_e,s[8]=a*I+o*V+l*j+u*Be,s[12]=a*B+o*W+l*te+u*ue,s[1]=c*R+d*N+f*K+m*he,s[5]=c*P+d*U+f*q+m*_e,s[9]=c*I+d*V+f*j+m*Be,s[13]=c*B+d*W+f*te+m*ue,s[2]=y*R+_*N+S*K+b*he,s[6]=y*P+_*U+S*q+b*_e,s[10]=y*I+_*V+S*j+b*Be,s[14]=y*B+_*W+S*te+b*ue,s[3]=M*R+w*N+T*K+E*he,s[7]=M*P+w*U+T*q+E*_e,s[11]=M*I+w*V+T*j+E*Be,s[15]=M*B+w*W+T*te+E*ue,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],a=e[1],o=e[5],l=e[9],u=e[13],c=e[2],d=e[6],f=e[10],m=e[14],y=e[3],_=e[7],S=e[11],b=e[15],M=l*m-u*f,w=o*m-u*d,T=o*f-l*d,E=a*m-u*c,R=a*f-l*c,P=a*d-o*c;return t*(_*M-S*w+b*T)-i*(y*M-S*E+b*R)+r*(y*w-_*E+b*P)-s*(y*T-_*R+S*P)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],c=e[8],d=e[9],f=e[10],m=e[11],y=e[12],_=e[13],S=e[14],b=e[15],M=d*S*u-_*f*u+_*l*m-o*S*m-d*l*b+o*f*b,w=y*f*u-c*S*u-y*l*m+a*S*m+c*l*b-a*f*b,T=c*_*u-y*d*u+y*o*m-a*_*m-c*o*b+a*d*b,E=y*d*l-c*_*l-y*o*f+a*_*f+c*o*S-a*d*S,R=t*M+i*w+r*T+s*E;if(R===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const P=1/R;return e[0]=M*P,e[1]=(_*f*s-d*S*s-_*r*m+i*S*m+d*r*b-i*f*b)*P,e[2]=(o*S*s-_*l*s+_*r*u-i*S*u-o*r*b+i*l*b)*P,e[3]=(d*l*s-o*f*s-d*r*u+i*f*u+o*r*m-i*l*m)*P,e[4]=w*P,e[5]=(c*S*s-y*f*s+y*r*m-t*S*m-c*r*b+t*f*b)*P,e[6]=(y*l*s-a*S*s-y*r*u+t*S*u+a*r*b-t*l*b)*P,e[7]=(a*f*s-c*l*s+c*r*u-t*f*u-a*r*m+t*l*m)*P,e[8]=T*P,e[9]=(y*d*s-c*_*s-y*i*m+t*_*m+c*i*b-t*d*b)*P,e[10]=(a*_*s-y*o*s+y*i*u-t*_*u-a*i*b+t*o*b)*P,e[11]=(c*o*s-a*d*s-c*i*u+t*d*u+a*i*m-t*o*m)*P,e[12]=E*P,e[13]=(c*_*r-y*d*r+y*i*f-t*_*f-c*i*S+t*d*S)*P,e[14]=(y*o*r-a*_*r-y*i*l+t*_*l+a*i*S-t*o*S)*P,e[15]=(a*d*r-c*o*r+c*i*l-t*d*l-a*i*f+t*o*f)*P,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,a=e.x,o=e.y,l=e.z,u=s*a,c=s*o;return this.set(u*a+i,u*o-r*l,u*l+r*o,0,u*o+r*l,c*o+i,c*l-r*a,0,u*l-r*o,c*l+r*a,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,a){return this.set(1,i,s,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,a=t._y,o=t._z,l=t._w,u=s+s,c=a+a,d=o+o,f=s*u,m=s*c,y=s*d,_=a*c,S=a*d,b=o*d,M=l*u,w=l*c,T=l*d,E=i.x,R=i.y,P=i.z;return r[0]=(1-(_+b))*E,r[1]=(m+T)*E,r[2]=(y-w)*E,r[3]=0,r[4]=(m-T)*R,r[5]=(1-(f+b))*R,r[6]=(S+M)*R,r[7]=0,r[8]=(y+w)*P,r[9]=(S-M)*P,r[10]=(1-(f+_))*P,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;if(e.x=r[12],e.y=r[13],e.z=r[14],this.determinant()===0)return i.set(1,1,1),t.identity(),this;let s=H_.set(r[0],r[1],r[2]).length();const a=H_.set(r[4],r[5],r[6]).length(),o=H_.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),Mf.copy(this);const u=1/s,c=1/a,d=1/o;return Mf.elements[0]*=u,Mf.elements[1]*=u,Mf.elements[2]*=u,Mf.elements[4]*=c,Mf.elements[5]*=c,Mf.elements[6]*=c,Mf.elements[8]*=d,Mf.elements[9]*=d,Mf.elements[10]*=d,t.setFromRotationMatrix(Mf),i.x=s,i.y=a,i.z=o,this}makePerspective(e,t,i,r,s,a,o=Sl,l=!1){const u=this.elements,c=2*s/(t-e),d=2*s/(i-r),f=(t+e)/(t-e),m=(i+r)/(i-r);let y,_;if(l)y=s/(a-s),_=a*s/(a-s);else if(o===Sl)y=-(a+s)/(a-s),_=-2*a*s/(a-s);else if(o===ic)y=-a/(a-s),_=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return u[0]=c,u[4]=0,u[8]=f,u[12]=0,u[1]=0,u[5]=d,u[9]=m,u[13]=0,u[2]=0,u[6]=0,u[10]=y,u[14]=_,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,t,i,r,s,a,o=Sl,l=!1){const u=this.elements,c=2/(t-e),d=2/(i-r),f=-(t+e)/(t-e),m=-(i+r)/(i-r);let y,_;if(l)y=1/(a-s),_=a/(a-s);else if(o===Sl)y=-2/(a-s),_=-(a+s)/(a-s);else if(o===ic)y=-1/(a-s),_=-s/(a-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return u[0]=c,u[4]=0,u[8]=0,u[12]=f,u[1]=0,u[5]=d,u[9]=0,u[13]=m,u[2]=0,u[6]=0,u[10]=y,u[14]=_,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const H_=new re,Mf=new Mn,CNe=new re(0,0,0),wNe=new re(1,1,1),yy=new re,LP=new re,oh=new re,bW=new Mn,_W=new ba;class Mu{constructor(e=0,t=0,i=0,r=Mu.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],a=r[4],o=r[8],l=r[1],u=r[5],c=r[9],d=r[2],f=r[6],m=r[10];switch(t){case"XYZ":this._y=Math.asin(Ii(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,m),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Ii(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,m),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ii(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Ii(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Ii(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(o,m));break;case"XZY":this._z=Math.asin(-Ii(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-c,m),this._y=0);break;default:mt("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return bW.makeRotationFromQuaternion(e),this.setFromRotationMatrix(bW,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _W.setFromEuler(this),this.setFromQuaternion(_W,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Mu.DEFAULT_ORDER="XYZ";class cb{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let ENe=0;const SW=new re,X_=new ba,Mg=new Mn,IP=new re,WT=new re,RNe=new re,PNe=new ba,MW=new re(1,0,0),AW=new re(0,1,0),TW=new re(0,0,1),CW={type:"added"},DNe={type:"removed"},W_={type:"childadded",child:null},DG={type:"childremoved",child:null};class Br extends wl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ENe++}),this.uuid=Ah(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Br.DEFAULT_UP.clone();const e=new re,t=new Mu,i=new ba,r=new re(1,1,1);function s(){i.setFromEuler(t,!1)}function a(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Mn},normalMatrix:{value:new Li}}),this.matrix=new Mn,this.matrixWorld=new Mn,this.matrixAutoUpdate=Br.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Br.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new cb,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return X_.setFromAxisAngle(e,t),this.quaternion.multiply(X_),this}rotateOnWorldAxis(e,t){return X_.setFromAxisAngle(e,t),this.quaternion.premultiply(X_),this}rotateX(e){return this.rotateOnAxis(MW,e)}rotateY(e){return this.rotateOnAxis(AW,e)}rotateZ(e){return this.rotateOnAxis(TW,e)}translateOnAxis(e,t){return SW.copy(e).applyQuaternion(this.quaternion),this.position.add(SW.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(MW,e)}translateY(e){return this.translateOnAxis(AW,e)}translateZ(e){return this.translateOnAxis(TW,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Mg.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?IP.copy(e):IP.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),WT.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Mg.lookAt(WT,IP,this.up):Mg.lookAt(IP,WT,this.up),this.quaternion.setFromRotationMatrix(Mg),r&&(Mg.extractRotation(r.matrixWorld),X_.setFromRotationMatrix(Mg),this.quaternion.premultiply(X_.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Tt("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(CW),W_.child=e,this.dispatchEvent(W_),W_.child=null):Tt("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(DNe),DG.child=e,this.dispatchEvent(DG),DG.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Mg.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Mg.multiply(e.parent.matrixWorld)),e.applyMatrix4(Mg),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(CW),W_.child=e,this.dispatchEvent(W_),W_.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const a=this.children[i].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(WT,e,RNe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(WT,PNe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(o=>({...o})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let u=0,c=l.length;u<c;u++){const d=l[u];s(e.shapes,d)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(s(e.materials,this.material[l]));r.material=o}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];r.animations.push(s(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),u=a(e.textures),c=a(e.images),d=a(e.shapes),f=a(e.skeletons),m=a(e.animations),y=a(e.nodes);o.length>0&&(i.geometries=o),l.length>0&&(i.materials=l),u.length>0&&(i.textures=u),c.length>0&&(i.images=c),d.length>0&&(i.shapes=d),f.length>0&&(i.skeletons=f),m.length>0&&(i.animations=m),y.length>0&&(i.nodes=y)}return i.object=r,i;function a(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}Br.DEFAULT_UP=new re(0,1,0);Br.DEFAULT_MATRIX_AUTO_UPDATE=!0;Br.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Af=new re,Ag=new re,NG=new re,Tg=new re,Z_=new re,j_=new re,wW=new re,BG=new re,FG=new re,LG=new re,IG=new si,GG=new si,OG=new si;class Vs{constructor(e=new re,t=new re,i=new re){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Af.subVectors(e,t),r.cross(Af);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){Af.subVectors(r,t),Ag.subVectors(i,t),NG.subVectors(e,t);const a=Af.dot(Af),o=Af.dot(Ag),l=Af.dot(NG),u=Ag.dot(Ag),c=Ag.dot(NG),d=a*u-o*o;if(d===0)return s.set(0,0,0),null;const f=1/d,m=(u*l-o*c)*f,y=(a*c-o*l)*f;return s.set(1-m-y,y,m)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Tg)===null?!1:Tg.x>=0&&Tg.y>=0&&Tg.x+Tg.y<=1}static getInterpolation(e,t,i,r,s,a,o,l){return this.getBarycoord(e,t,i,r,Tg)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Tg.x),l.addScaledVector(a,Tg.y),l.addScaledVector(o,Tg.z),l)}static getInterpolatedAttribute(e,t,i,r,s,a){return IG.setScalar(0),GG.setScalar(0),OG.setScalar(0),IG.fromBufferAttribute(e,t),GG.fromBufferAttribute(e,i),OG.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(IG,s.x),a.addScaledVector(GG,s.y),a.addScaledVector(OG,s.z),a}static isFrontFacing(e,t,i,r){return Af.subVectors(i,t),Ag.subVectors(e,t),Af.cross(Ag).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Af.subVectors(this.c,this.b),Ag.subVectors(this.a,this.b),Af.cross(Ag).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Vs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Vs.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return Vs.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return Vs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Vs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let a,o;Z_.subVectors(r,i),j_.subVectors(s,i),BG.subVectors(e,i);const l=Z_.dot(BG),u=j_.dot(BG);if(l<=0&&u<=0)return t.copy(i);FG.subVectors(e,r);const c=Z_.dot(FG),d=j_.dot(FG);if(c>=0&&d<=c)return t.copy(r);const f=l*d-c*u;if(f<=0&&l>=0&&c<=0)return a=l/(l-c),t.copy(i).addScaledVector(Z_,a);LG.subVectors(e,s);const m=Z_.dot(LG),y=j_.dot(LG);if(y>=0&&m<=y)return t.copy(s);const _=m*u-l*y;if(_<=0&&u>=0&&y<=0)return o=u/(u-y),t.copy(i).addScaledVector(j_,o);const S=c*y-m*d;if(S<=0&&d-c>=0&&m-y>=0)return wW.subVectors(s,r),o=(d-c)/(d-c+(m-y)),t.copy(r).addScaledVector(wW,o);const b=1/(S+_+f);return a=_*b,o=f*b,t.copy(i).addScaledVector(Z_,a).addScaledVector(j_,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const ete={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},vy={h:0,s:0,l:0},GP={h:0,s:0,l:0};function UG(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class en{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ps){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,di.colorSpaceToWorking(this,t),this}setRGB(e,t,i,r=di.workingColorSpace){return this.r=e,this.g=t,this.b=i,di.colorSpaceToWorking(this,r),this}setHSL(e,t,i,r=di.workingColorSpace){if(e=G9(e,1),t=Ii(t,0,1),i=Ii(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,a=2*i-s;this.r=UG(a,s,e+1/3),this.g=UG(a,s,e),this.b=UG(a,s,e-1/3)}return di.colorSpaceToWorking(this,r),this}setStyle(e,t=Ps){function i(s){s!==void 0&&parseFloat(s)<1&&mt("Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[1],o=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:mt("Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);mt("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ps){const i=ete[e.toLowerCase()];return i!==void 0?this.setHex(i,t):mt("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=qg(e.r),this.g=qg(e.g),this.b=qg(e.b),this}copyLinearToSRGB(e){return this.r=KS(e.r),this.g=KS(e.g),this.b=KS(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ps){return di.workingToColorSpace(fu.copy(this),e),Math.round(Ii(fu.r*255,0,255))*65536+Math.round(Ii(fu.g*255,0,255))*256+Math.round(Ii(fu.b*255,0,255))}getHexString(e=Ps){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=di.workingColorSpace){di.workingToColorSpace(fu.copy(this),t);const i=fu.r,r=fu.g,s=fu.b,a=Math.max(i,r,s),o=Math.min(i,r,s);let l,u;const c=(o+a)/2;if(o===a)l=0,u=0;else{const d=a-o;switch(u=c<=.5?d/(a+o):d/(2-a-o),a){case i:l=(r-s)/d+(r<s?6:0);break;case r:l=(s-i)/d+2;break;case s:l=(i-r)/d+4;break}l/=6}return e.h=l,e.s=u,e.l=c,e}getRGB(e,t=di.workingColorSpace){return di.workingToColorSpace(fu.copy(this),t),e.r=fu.r,e.g=fu.g,e.b=fu.b,e}getStyle(e=Ps){di.workingToColorSpace(fu.copy(this),e);const t=fu.r,i=fu.g,r=fu.b;return e!==Ps?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(vy),this.setHSL(vy.h+e,vy.s+t,vy.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(vy),e.getHSL(GP);const i=lw(vy.h,GP.h,t),r=lw(vy.s,GP.s,t),s=lw(vy.l,GP.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const fu=new en;en.NAMES=ete;let NNe=0;class _a extends wl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:NNe++}),this.uuid=Ah(),this.name="",this.type="Material",this.blending=Al,this.side=wo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Yx,this.blendDst=Kx,this.blendEquation=vl,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new en(0,0,0),this.blendAlpha=0,this.depthFunc=_m,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Xw,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Og,this.stencilZFail=Og,this.stencilZPass=Og,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){mt(`Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){mt(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Al&&(i.blending=this.blending),this.side!==wo&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==Yx&&(i.blendSrc=this.blendSrc),this.blendDst!==Kx&&(i.blendDst=this.blendDst),this.blendEquation!==vl&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==_m&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Xw&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Og&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Og&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Og&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.allowOverride===!1&&(i.allowOverride=!1),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(t){const s=r(e.textures),a=r(e.images);s.length>0&&(i.textures=s),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class La extends _a{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new en(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mu,this.combine=Sb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Vg=BNe();function BNe(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const u=l-127;u<-27?(i[l]=0,i[l|256]=32768,r[l]=24,r[l|256]=24):u<-14?(i[l]=1024>>-u-14,i[l|256]=1024>>-u-14|32768,r[l]=-u-1,r[l|256]=-u-1):u<=15?(i[l]=u+15<<10,i[l|256]=u+15<<10|32768,r[l]=13,r[l|256]=13):u<128?(i[l]=31744,i[l|256]=64512,r[l]=24,r[l|256]=24):(i[l]=31744,i[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,c=0;for(;(u&8388608)===0;)u<<=1,c-=8388608;u&=-8388609,c+=947912704,s[l]=u|c}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function Lc(n){Math.abs(n)>65504&&mt("DataUtils.toHalfFloat(): Value out of range."),n=Ii(n,-65504,65504),Vg.floatView[0]=n;const e=Vg.uint32View[0],t=e>>23&511;return Vg.baseTable[t]+((e&8388607)>>Vg.shiftTable[t])}function $C(n){const e=n>>10;return Vg.uint32View[0]=Vg.mantissaTable[Vg.offsetTable[e]+(n&1023)]+Vg.exponentTable[e],Vg.floatView[0]}class Xy{static toHalfFloat(e){return Lc(e)}static fromHalfFloat(e){return $C(e)}}const Oo=new re,OP=new rt;let FNe=0;class Gi{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:FNe++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=p0,this.updateRanges=[],this.gpuType=wr,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)OP.fromBufferAttribute(this,t),OP.applyMatrix3(e),this.setXY(t,OP.x,OP.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Oo.fromBufferAttribute(this,t),Oo.applyMatrix3(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Oo.fromBufferAttribute(this,t),Oo.applyMatrix4(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Oo.fromBufferAttribute(this,t),Oo.applyNormalMatrix(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Oo.fromBufferAttribute(this,t),Oo.transformDirection(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Ku(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=lr(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Ku(t,this.array)),t}setX(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Ku(t,this.array)),t}setY(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Ku(t,this.array)),t}setZ(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Ku(t,this.array)),t}setW(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array),r=lr(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array),r=lr(r,this.array),s=lr(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==p0&&(e.usage=this.usage),e}}class tte extends Gi{constructor(e,t,i){super(new Int8Array(e),t,i)}}class nte extends Gi{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class ite extends Gi{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class rte extends Gi{constructor(e,t,i){super(new Int16Array(e),t,i)}}class uR extends Gi{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class ste extends Gi{constructor(e,t,i){super(new Int32Array(e),t,i)}}class cR extends Gi{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class $2 extends Gi{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=$C(this.array[e*this.itemSize]);return this.normalized&&(t=Ku(t,this.array)),t}setX(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize]=Lc(t),this}getY(e){let t=$C(this.array[e*this.itemSize+1]);return this.normalized&&(t=Ku(t,this.array)),t}setY(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize+1]=Lc(t),this}getZ(e){let t=$C(this.array[e*this.itemSize+2]);return this.normalized&&(t=Ku(t,this.array)),t}setZ(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize+2]=Lc(t),this}getW(e){let t=$C(this.array[e*this.itemSize+3]);return this.normalized&&(t=Ku(t,this.array)),t}setW(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize+3]=Lc(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array)),this.array[e+0]=Lc(t),this.array[e+1]=Lc(i),this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array),r=lr(r,this.array)),this.array[e+0]=Lc(t),this.array[e+1]=Lc(i),this.array[e+2]=Lc(r),this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array),r=lr(r,this.array),s=lr(s,this.array)),this.array[e+0]=Lc(t),this.array[e+1]=Lc(i),this.array[e+2]=Lc(r),this.array[e+3]=Lc(s),this}}class qn extends Gi{constructor(e,t,i){super(new Float32Array(e),t,i)}}let LNe=0;const od=new Mn,kG=new Br,Y_=new re,lh=new Ns,ZT=new Ns,fl=new re;class wi extends wl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:LNe++}),this.uuid=Ah(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(I9(e)?cR:uR)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new Li().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return od.makeRotationFromQuaternion(e),this.applyMatrix4(od),this}rotateX(e){return od.makeRotationX(e),this.applyMatrix4(od),this}rotateY(e){return od.makeRotationY(e),this.applyMatrix4(od),this}rotateZ(e){return od.makeRotationZ(e),this.applyMatrix4(od),this}translate(e,t,i){return od.makeTranslation(e,t,i),this.applyMatrix4(od),this}scale(e,t,i){return od.makeScale(e,t,i),this.applyMatrix4(od),this}lookAt(e){return kG.lookAt(e),kG.updateMatrix(),this.applyMatrix4(kG.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Y_).negate(),this.translate(Y_.x,Y_.y,Y_.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let r=0,s=e.length;r<s;r++){const a=e[r];i.push(a.x,a.y,a.z||0)}this.setAttribute("position",new qn(i,3))}else{const i=Math.min(e.length,t.count);for(let r=0;r<i;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&mt("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ns);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Tt("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new re(-1/0,-1/0,-1/0),new re(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];lh.setFromBufferAttribute(s),this.morphTargetsRelative?(fl.addVectors(this.boundingBox.min,lh.min),this.boundingBox.expandByPoint(fl),fl.addVectors(this.boundingBox.max,lh.max),this.boundingBox.expandByPoint(fl)):(this.boundingBox.expandByPoint(lh.min),this.boundingBox.expandByPoint(lh.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Tt('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new fo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Tt("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new re,1/0);return}if(e){const i=this.boundingSphere.center;if(lh.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const o=t[s];ZT.setFromBufferAttribute(o),this.morphTargetsRelative?(fl.addVectors(lh.min,ZT.min),lh.expandByPoint(fl),fl.addVectors(lh.max,ZT.max),lh.expandByPoint(fl)):(lh.expandByPoint(ZT.min),lh.expandByPoint(ZT.max))}lh.getCenter(i);let r=0;for(let s=0,a=e.count;s<a;s++)fl.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(fl));if(t)for(let s=0,a=t.length;s<a;s++){const o=t[s],l=this.morphTargetsRelative;for(let u=0,c=o.count;u<c;u++)fl.fromBufferAttribute(o,u),l&&(Y_.fromBufferAttribute(e,u),fl.add(Y_)),r=Math.max(r,i.distanceToSquared(fl))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&Tt('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){Tt("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Gi(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let I=0;I<i.count;I++)o[I]=new re,l[I]=new re;const u=new re,c=new re,d=new re,f=new rt,m=new rt,y=new rt,_=new re,S=new re;function b(I,B,N){u.fromBufferAttribute(i,I),c.fromBufferAttribute(i,B),d.fromBufferAttribute(i,N),f.fromBufferAttribute(s,I),m.fromBufferAttribute(s,B),y.fromBufferAttribute(s,N),c.sub(u),d.sub(u),m.sub(f),y.sub(f);const U=1/(m.x*y.y-y.x*m.y);isFinite(U)&&(_.copy(c).multiplyScalar(y.y).addScaledVector(d,-m.y).multiplyScalar(U),S.copy(d).multiplyScalar(m.x).addScaledVector(c,-y.x).multiplyScalar(U),o[I].add(_),o[B].add(_),o[N].add(_),l[I].add(S),l[B].add(S),l[N].add(S))}let M=this.groups;M.length===0&&(M=[{start:0,count:e.count}]);for(let I=0,B=M.length;I<B;++I){const N=M[I],U=N.start,V=N.count;for(let W=U,K=U+V;W<K;W+=3)b(e.getX(W+0),e.getX(W+1),e.getX(W+2))}const w=new re,T=new re,E=new re,R=new re;function P(I){E.fromBufferAttribute(r,I),R.copy(E);const B=o[I];w.copy(B),w.sub(E.multiplyScalar(E.dot(B))).normalize(),T.crossVectors(R,B);const U=T.dot(l[I])<0?-1:1;a.setXYZW(I,w.x,w.y,w.z,U)}for(let I=0,B=M.length;I<B;++I){const N=M[I],U=N.start,V=N.count;for(let W=U,K=U+V;W<K;W+=3)P(e.getX(W+0)),P(e.getX(W+1)),P(e.getX(W+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Gi(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let f=0,m=i.count;f<m;f++)i.setXYZ(f,0,0,0);const r=new re,s=new re,a=new re,o=new re,l=new re,u=new re,c=new re,d=new re;if(e)for(let f=0,m=e.count;f<m;f+=3){const y=e.getX(f+0),_=e.getX(f+1),S=e.getX(f+2);r.fromBufferAttribute(t,y),s.fromBufferAttribute(t,_),a.fromBufferAttribute(t,S),c.subVectors(a,s),d.subVectors(r,s),c.cross(d),o.fromBufferAttribute(i,y),l.fromBufferAttribute(i,_),u.fromBufferAttribute(i,S),o.add(c),l.add(c),u.add(c),i.setXYZ(y,o.x,o.y,o.z),i.setXYZ(_,l.x,l.y,l.z),i.setXYZ(S,u.x,u.y,u.z)}else for(let f=0,m=t.count;f<m;f+=3)r.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),a.fromBufferAttribute(t,f+2),c.subVectors(a,s),d.subVectors(r,s),c.cross(d),i.setXYZ(f+0,c.x,c.y,c.z),i.setXYZ(f+1,c.x,c.y,c.z),i.setXYZ(f+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)fl.fromBufferAttribute(e,t),fl.normalize(),e.setXYZ(t,fl.x,fl.y,fl.z)}toNonIndexed(){function e(o,l){const u=o.array,c=o.itemSize,d=o.normalized,f=new u.constructor(l.length*c);let m=0,y=0;for(let _=0,S=l.length;_<S;_++){o.isInterleavedBufferAttribute?m=l[_]*o.data.stride+o.offset:m=l[_]*c;for(let b=0;b<c;b++)f[y++]=u[m++]}return new Gi(f,c,d)}if(this.index===null)return mt("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new wi,i=this.index.array,r=this.attributes;for(const o in r){const l=r[o],u=e(l,i);t.setAttribute(o,u)}const s=this.morphAttributes;for(const o in s){const l=[],u=s[o];for(let c=0,d=u.length;c<d;c++){const f=u[c],m=e(f,i);l.push(m)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const u=a[o];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const u=i[l];e.data.attributes[l]=u.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],c=[];for(let d=0,f=u.length;d<f;d++){const m=u[d];c.push(m.toJSON(e.data))}c.length>0&&(r[l]=c,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone());const r=e.attributes;for(const u in r){const c=r[u];this.setAttribute(u,c.clone(t))}const s=e.morphAttributes;for(const u in s){const c=[],d=s[u];for(let f=0,m=d.length;f<m;f++)c.push(d[f].clone(t));this.morphAttributes[u]=c}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,c=a.length;u<c;u++){const d=a[u];this.addGroup(d.start,d.count,d.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const EW=new Mn,V1=new Im,UP=new fo,RW=new re,kP=new re,zP=new re,VP=new re,zG=new re,HP=new re,PW=new re,XP=new re;class Fr extends Br{constructor(e=new wi,t=new La){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(s&&o){HP.set(0,0,0);for(let l=0,u=s.length;l<u;l++){const c=o[l],d=s[l];c!==0&&(zG.fromBufferAttribute(d,e),a?HP.addScaledVector(zG,c):HP.addScaledVector(zG.sub(t),c))}t.add(HP)}return t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),UP.copy(i.boundingSphere),UP.applyMatrix4(s),V1.copy(e.ray).recast(e.near),!(UP.containsPoint(V1.origin)===!1&&(V1.intersectSphere(UP,RW)===null||V1.origin.distanceToSquared(RW)>(e.far-e.near)**2))&&(EW.copy(s).invert(),V1.copy(e.ray).applyMatrix4(EW),!(i.boundingBox!==null&&V1.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,V1)))}_computeIntersections(e,t,i){let r;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,u=s.attributes.uv,c=s.attributes.uv1,d=s.attributes.normal,f=s.groups,m=s.drawRange;if(o!==null)if(Array.isArray(a))for(let y=0,_=f.length;y<_;y++){const S=f[y],b=a[S.materialIndex],M=Math.max(S.start,m.start),w=Math.min(o.count,Math.min(S.start+S.count,m.start+m.count));for(let T=M,E=w;T<E;T+=3){const R=o.getX(T),P=o.getX(T+1),I=o.getX(T+2);r=WP(this,b,e,i,u,c,d,R,P,I),r&&(r.faceIndex=Math.floor(T/3),r.face.materialIndex=S.materialIndex,t.push(r))}}else{const y=Math.max(0,m.start),_=Math.min(o.count,m.start+m.count);for(let S=y,b=_;S<b;S+=3){const M=o.getX(S),w=o.getX(S+1),T=o.getX(S+2);r=WP(this,a,e,i,u,c,d,M,w,T),r&&(r.faceIndex=Math.floor(S/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(a))for(let y=0,_=f.length;y<_;y++){const S=f[y],b=a[S.materialIndex],M=Math.max(S.start,m.start),w=Math.min(l.count,Math.min(S.start+S.count,m.start+m.count));for(let T=M,E=w;T<E;T+=3){const R=T,P=T+1,I=T+2;r=WP(this,b,e,i,u,c,d,R,P,I),r&&(r.faceIndex=Math.floor(T/3),r.face.materialIndex=S.materialIndex,t.push(r))}}else{const y=Math.max(0,m.start),_=Math.min(l.count,m.start+m.count);for(let S=y,b=_;S<b;S+=3){const M=S,w=S+1,T=S+2;r=WP(this,a,e,i,u,c,d,M,w,T),r&&(r.faceIndex=Math.floor(S/3),t.push(r))}}}}function INe(n,e,t,i,r,s,a,o){let l;if(e.side===Er?l=i.intersectTriangle(a,s,r,!0,o):l=i.intersectTriangle(r,s,a,e.side===wo,o),l===null)return null;XP.copy(o),XP.applyMatrix4(n.matrixWorld);const u=t.ray.origin.distanceTo(XP);return u<t.near||u>t.far?null:{distance:u,point:XP.clone(),object:n}}function WP(n,e,t,i,r,s,a,o,l,u){n.getVertexPosition(o,kP),n.getVertexPosition(l,zP),n.getVertexPosition(u,VP);const c=INe(n,e,t,i,kP,zP,VP,PW);if(c){const d=new re;Vs.getBarycoord(PW,kP,zP,VP,d),r&&(c.uv=Vs.getInterpolatedAttribute(r,o,l,u,d,new rt)),s&&(c.uv1=Vs.getInterpolatedAttribute(s,o,l,u,d,new rt)),a&&(c.normal=Vs.getInterpolatedAttribute(a,o,l,u,d,new re),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const f={a:o,b:l,c:u,normal:new re,materialIndex:0};Vs.getNormal(kP,zP,VP,f.normal),c.face=f,c.barycoord=d}return c}class Id extends wi{constructor(e=1,t=1,i=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:a};const o=this;r=Math.floor(r),s=Math.floor(s),a=Math.floor(a);const l=[],u=[],c=[],d=[];let f=0,m=0;y("z","y","x",-1,-1,i,t,e,a,s,0),y("z","y","x",1,-1,i,t,-e,a,s,1),y("x","z","y",1,1,e,i,t,r,a,2),y("x","z","y",1,-1,e,i,-t,r,a,3),y("x","y","z",1,-1,e,t,i,r,s,4),y("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new qn(u,3)),this.setAttribute("normal",new qn(c,3)),this.setAttribute("uv",new qn(d,2));function y(_,S,b,M,w,T,E,R,P,I,B){const N=T/P,U=E/I,V=T/2,W=E/2,K=R/2,q=P+1,j=I+1;let te=0,he=0;const _e=new re;for(let Be=0;Be<j;Be++){const ue=Be*U-W;for(let ce=0;ce<q;ce++){const Ce=ce*N-V;_e[_]=Ce*M,_e[S]=ue*w,_e[b]=K,u.push(_e.x,_e.y,_e.z),_e[_]=0,_e[S]=0,_e[b]=R>0?1:-1,c.push(_e.x,_e.y,_e.z),d.push(ce/P),d.push(1-Be/I),te+=1}}for(let Be=0;Be<I;Be++)for(let ue=0;ue<P;ue++){const ce=f+ue+q*Be,Ce=f+ue+q*(Be+1),Oe=f+(ue+1)+q*(Be+1),nt=f+(ue+1)+q*Be;l.push(ce,Ce,nt),l.push(Ce,Oe,nt),he+=6}o.addGroup(m,he,B),m+=he,f+=te}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Id(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function yM(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(mt("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function zu(n){const e={};for(let t=0;t<n.length;t++){const i=yM(n[t]);for(const r in i)e[r]=i[r]}return e}function GNe(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function ate(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:di.workingColorSpace}const vM={clone:yM,merge:zu};var ONe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,UNe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ds extends _a{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=ONe,this.fragmentShader=UNe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=yM(e.uniforms),this.uniformsGroups=GNe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const a=this.uniforms[r].value;a&&a.isTexture?t.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[r]={type:"m4",value:a.toArray()}:t.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class Eb extends Br{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Mn,this.projectionMatrix=new Mn,this.projectionMatrixInverse=new Mn,this.coordinateSystem=Sl,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const xy=new re,DW=new rt,NW=new rt;let ds=class extends Eb{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=ub*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Ix*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ub*2*Math.atan(Math.tan(Ix*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){xy.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(xy.x,xy.y).multiplyScalar(-e/xy.z),xy.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(xy.x,xy.y).multiplyScalar(-e/xy.z)}getViewSize(e,t){return this.getViewBounds(e,DW,NW),t.subVectors(NW,DW)}setViewOffset(e,t,i,r,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Ix*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,u=a.fullHeight;s+=a.offsetX*r/l,t-=a.offsetY*i/u,r*=a.width/l,i*=a.height/u}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const K_=-90,$_=1;class J2 extends Br{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new ds(K_,$_,e,t);r.layers=this.layers,this.add(r);const s=new ds(K_,$_,e,t);s.layers=this.layers,this.add(s);const a=new ds(K_,$_,e,t);a.layers=this.layers,this.add(a);const o=new ds(K_,$_,e,t);o.layers=this.layers,this.add(o);const l=new ds(K_,$_,e,t);l.layers=this.layers,this.add(l);const u=new ds(K_,$_,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,a,o,l]=t;for(const u of t)this.remove(u);if(e===Sl)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===ic)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,u,c]=this.children,d=e.getRenderTarget(),f=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),y=e.xr.enabled;e.xr.enabled=!1;const _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,a),e.setRenderTarget(i,2,r),e.render(t,o),e.setRenderTarget(i,3,r),e.render(t,l),e.setRenderTarget(i,4,r),e.render(t,u),i.texture.generateMipmaps=_,e.setRenderTarget(i,5,r),e.render(t,c),e.setRenderTarget(d,f,m),e.xr.enabled=y,i.texture.needsPMREMUpdate=!0}}class T0 extends pr{constructor(e=[],t=_u,i,r,s,a,o,l,u,c){super(e,t,i,r,s,a,o,l,u,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class jM extends Nr{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new T0(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Id(5,5,5),s=new Ds({name:"CubemapFromEquirect",uniforms:yM(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Er,blending:Oa});s.uniforms.tEquirect.value=t;const a=new Fr(r,s),o=t.minFilter;return t.minFilter===Vo&&(t.minFilter=Jn),new J2(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,i=!0,r=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,i,r);e.setRenderTarget(s)}}class _h extends Br{constructor(){super(),this.isGroup=!0,this.type="Group"}}const kNe={type:"move"};class $S{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new _h,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new _h,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new re,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new re),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new _h,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new re,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new re),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,a=null;const o=this._targetRay,l=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){a=!0;for(const _ of e.hand.values()){const S=t.getJointPose(_,i),b=this._getHandJoint(u,_);S!==null&&(b.matrix.fromArray(S.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale),b.matrixWorldNeedsUpdate=!0,b.jointRadius=S.radius),b.visible=S!==null}const c=u.joints["index-finger-tip"],d=u.joints["thumb-tip"],f=c.position.distanceTo(d.position),m=.02,y=.005;u.inputState.pinching&&f>m+y?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&f<=m-y&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(kNe)))}return o!==null&&(o.visible=r!==null),l!==null&&(l.visible=s!==null),u!==null&&(u.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new _h;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class hR{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new en(e),this.density=t}clone(){return new hR(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class YM{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new en(e),this.near=t,this.far=i}clone(){return new YM(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Wc extends Br{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Mu,this.environmentIntensity=1,this.environmentRotation=new Mu,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Rb{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=p0,this.updateRanges=[],this.version=0,this.uuid=Ah()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ah()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ah()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Uu=new re;class Tm{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Uu.fromBufferAttribute(this,t),Uu.applyMatrix4(e),this.setXYZ(t,Uu.x,Uu.y,Uu.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Uu.fromBufferAttribute(this,t),Uu.applyNormalMatrix(e),this.setXYZ(t,Uu.x,Uu.y,Uu.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Uu.fromBufferAttribute(this,t),Uu.transformDirection(e),this.setXYZ(t,Uu.x,Uu.y,Uu.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=Ku(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=lr(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=lr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=lr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=lr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=lr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Ku(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Ku(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Ku(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Ku(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array),r=lr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array),r=lr(r,this.array),s=lr(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){lb("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Gi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Tm(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){lb("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class dR extends _a{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new en(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let J_;const jT=new re,q_=new re,Q_=new re,eS=new rt,YT=new rt,ote=new Mn,ZP=new re,KT=new re,jP=new re,BW=new rt,VG=new rt,FW=new rt;class U9 extends Br{constructor(e=new dR){if(super(),this.isSprite=!0,this.type="Sprite",J_===void 0){J_=new wi;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Rb(t,5);J_.setIndex([0,1,2,0,2,3]),J_.setAttribute("position",new Tm(i,3,0,!1)),J_.setAttribute("uv",new Tm(i,2,3,!1))}this.geometry=J_,this.material=e,this.center=new rt(.5,.5),this.count=1}raycast(e,t){e.camera===null&&Tt('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),q_.setFromMatrixScale(this.matrixWorld),ote.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Q_.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&q_.multiplyScalar(-Q_.z);const i=this.material.rotation;let r,s;i!==0&&(s=Math.cos(i),r=Math.sin(i));const a=this.center;YP(ZP.set(-.5,-.5,0),Q_,a,q_,r,s),YP(KT.set(.5,-.5,0),Q_,a,q_,r,s),YP(jP.set(.5,.5,0),Q_,a,q_,r,s),BW.set(0,0),VG.set(1,0),FW.set(1,1);let o=e.ray.intersectTriangle(ZP,KT,jP,!1,jT);if(o===null&&(YP(KT.set(-.5,.5,0),Q_,a,q_,r,s),VG.set(0,1),o=e.ray.intersectTriangle(ZP,jP,KT,!1,jT),o===null))return;const l=e.ray.origin.distanceTo(jT);l<e.near||l>e.far||t.push({distance:l,point:jT.clone(),uv:Vs.getInterpolation(jT,ZP,KT,jP,BW,VG,FW,new rt),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function YP(n,e,t,i,r,s){eS.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(YT.x=s*eS.x-r*eS.y,YT.y=r*eS.x+s*eS.y):YT.copy(eS),n.copy(e),n.x+=YT.x,n.y+=YT.y,n.applyMatrix4(ote)}const KP=new re,LW=new re;class k9 extends Br{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,r=t.length;i<r;i++){const s=t[i];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const r=this.levels;let s;for(s=0;s<r.length&&!(t<r[s].distance);s++);return r.splice(s,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let i=0;i<t.length;i++)if(t[i].distance===e){const r=t.splice(i,1);return this.remove(r[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,r;for(i=1,r=t.length;i<r;i++){let s=t[i].distance;if(t[i].object.visible&&(s-=s*t[i].hysteresis),e<s)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){KP.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(KP);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){KP.setFromMatrixPosition(e.matrixWorld),LW.setFromMatrixPosition(this.matrixWorld);const i=KP.distanceTo(LW)/e.zoom;t[0].object.visible=!0;let r,s;for(r=1,s=t.length;r<s;r++){let a=t[r].distance;if(t[r].object.visible&&(a-=a*t[r].hysteresis),i>=a)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let r=0,s=i.length;r<s;r++){const a=i[r];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const IW=new re,GW=new si,OW=new si,zNe=new re,UW=new Mn,$P=new re,HG=new fo,kW=new Mn,XG=new Im;class q2 extends Fr{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=TB,this.bindMatrix=new Mn,this.bindMatrixInverse=new Mn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ns),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,$P),this.boundingBox.expandByPoint($P)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new fo),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,$P),this.boundingSphere.expandByPoint($P)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),HG.copy(this.boundingSphere),HG.applyMatrix4(r),e.ray.intersectsSphere(HG)!==!1&&(kW.copy(r).invert(),XG.copy(e.ray).applyMatrix4(kW),!(this.boundingBox!==null&&XG.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,XG)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new si,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===TB?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===m9?this.bindMatrixInverse.copy(this.bindMatrix).invert():mt("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,r=this.geometry;GW.fromBufferAttribute(r.attributes.skinIndex,e),OW.fromBufferAttribute(r.attributes.skinWeight,e),IW.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=OW.getComponent(s);if(a!==0){const o=GW.getComponent(s);UW.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),t.addScaledVector(zNe.copy(IW).applyMatrix4(UW),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class fR extends Br{constructor(){super(),this.isBone=!0,this.type="Bone"}}class xu extends pr{constructor(e=null,t=1,i=1,r,s,a,o,l,u=xr,c=xr,d,f){super(null,a,o,l,u,c,r,s,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const zW=new Mn,VNe=new Mn;class KM{constructor(e=[],t=[]){this.uuid=Ah(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){mt("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Mn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Mn;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:VNe;zW.multiplyMatrices(o,t[s]),zW.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new KM(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new xu(t,e,e,Vr,wr);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let a=t[s];a===void 0&&(mt("Skeleton: No bone found with UUID:",s),a=new fR),this.bones.push(a),this.boneInverses.push(new Mn().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const a=t[r];e.bones.push(a.uuid);const o=i[r];e.boneInverses.push(o.toArray())}return e}}class Vc extends Gi{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const tS=new Mn,VW=new Mn,JP=[],HW=new Ns,HNe=new Mn,$T=new Fr,JT=new fo;class Q2 extends Fr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Vc(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,HNe)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Ns),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,tS),HW.copy(e.boundingBox).applyMatrix4(tS),this.boundingBox.union(HW)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new fo),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,tS),JT.copy(e.boundingSphere).applyMatrix4(tS),this.boundingSphere.union(JT)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,r=this.morphTexture.source.data.data,s=i.length+1,a=e*s+1;for(let o=0;o<i.length;o++)i[o]=r[a+o]}raycast(e,t){const i=this.matrixWorld,r=this.count;if($T.geometry=this.geometry,$T.material=this.material,$T.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),JT.copy(this.boundingSphere),JT.applyMatrix4(i),e.ray.intersectsSphere(JT)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,tS),VW.multiplyMatrices(i,tS),$T.matrixWorld=VW,$T.raycast(e,JP);for(let a=0,o=JP.length;a<o;a++){const l=JP[a];l.instanceId=s,l.object=this,t.push(l)}JP.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Vc(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new xu(new Float32Array(r*this.count),r,this.count,rp,wr));const s=this.morphTexture.source.data.data;let a=0;for(let u=0;u<i.length;u++)a+=i[u];const o=this.geometry.morphTargetsRelative?1:1-a,l=r*e;s[l]=o,s.set(i,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const WG=new re,XNe=new re,WNe=new Li;let Xl=class{constructor(e=new re(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=WG.subVectors(i,t).cross(XNe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(WG),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||WNe.getNormalMatrix(e),r=this.coplanarPoint(WG).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const H1=new fo,ZNe=new rt(.5,.5),qP=new re;class Kv{constructor(e=new Xl,t=new Xl,i=new Xl,r=new Xl,s=new Xl,a=new Xl){this.planes=[e,t,i,r,s,a]}set(e,t,i,r,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(s),o[5].copy(a),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Sl,i=!1){const r=this.planes,s=e.elements,a=s[0],o=s[1],l=s[2],u=s[3],c=s[4],d=s[5],f=s[6],m=s[7],y=s[8],_=s[9],S=s[10],b=s[11],M=s[12],w=s[13],T=s[14],E=s[15];if(r[0].setComponents(u-a,m-c,b-y,E-M).normalize(),r[1].setComponents(u+a,m+c,b+y,E+M).normalize(),r[2].setComponents(u+o,m+d,b+_,E+w).normalize(),r[3].setComponents(u-o,m-d,b-_,E-w).normalize(),i)r[4].setComponents(l,f,S,T).normalize(),r[5].setComponents(u-l,m-f,b-S,E-T).normalize();else if(r[4].setComponents(u-l,m-f,b-S,E-T).normalize(),t===Sl)r[5].setComponents(u+l,m+f,b+S,E+T).normalize();else if(t===ic)r[5].setComponents(l,f,S,T).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),H1.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),H1.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(H1)}intersectsSprite(e){H1.center.set(0,0,0);const t=ZNe.distanceTo(e.center);return H1.radius=.7071067811865476+t,H1.applyMatrix4(e.matrixWorld),this.intersectsSphere(H1)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(qP.x=r.normal.x>0?e.max.x:e.min.x,qP.y=r.normal.y>0?e.max.y:e.min.y,qP.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(qP)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const kp=new Mn,zp=new Kv;class $M{constructor(){this.coordinateSystem=Sl}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(kp.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),zp.setFromProjectionMatrix(kp,r.coordinateSystem,r.reversedDepth),zp.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(kp.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),zp.setFromProjectionMatrix(kp,r.coordinateSystem,r.reversedDepth),zp.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(kp.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),zp.setFromProjectionMatrix(kp,r.coordinateSystem,r.reversedDepth),zp.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(kp.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),zp.setFromProjectionMatrix(kp,r.coordinateSystem,r.reversedDepth),zp.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(kp.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),zp.setFromProjectionMatrix(kp,r.coordinateSystem,r.reversedDepth),zp.containsPoint(e))return!0}return!1}clone(){return new $M}}function ZG(n,e){return n-e}function jNe(n,e){return n.z-e.z}function YNe(n,e){return e.z-n.z}class KNe{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,i,r){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=i,o.index=r}reset(){this.list.length=0,this.index=0}}const Nc=new Mn,$Ne=new en(1,1,1),XW=new Kv,JNe=new $M,QP=new Ns,X1=new fo,qT=new re,WW=new re,qNe=new re,jG=new KNe,pu=new Fr,eD=[];function QNe(n,e,t=0){const i=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const r=n.count;for(let s=0;s<r;s++)for(let a=0;a<i;a++)e.setComponent(s+t,a,n.getComponent(s,a))}else e.array.set(n.array,t*i);e.needsUpdate=!0}function W1(n,e){if(n.constructor!==e.constructor){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++)e[i]=n[i]}else{const t=Math.min(n.length,e.length);e.set(new n.constructor(n.buffer,0,t))}}class z9 extends Fr{constructor(e,t,i=t*2,r){super(new wi,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new xu(t,e,e,Vr,wr);this._matricesTexture=i}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),i=new xu(t,e,e,A0,qr);this._indirectTexture=i}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),i=new xu(t,e,e,Vr,wr);i.colorSpace=di.workingColorSpace,this._colorsTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const a=e.getAttribute(s),{array:o,itemSize:l,normalized:u}=a,c=new o.constructor(i*l),d=new Gi(c,l,u);t.setAttribute(s,d)}if(e.getIndex()!==null){const s=i>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new Gi(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(!e.hasAttribute(i))throw new Error(`THREE.BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const r=e.getAttribute(i),s=t.getAttribute(i);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ns);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let i=0,r=t.length;i<r;i++){if(t[i].active===!1)continue;const s=t[i].geometryIndex;this.getMatrixAt(i,Nc),this.getBoundingBoxAt(s,QP).applyMatrix4(Nc),e.union(QP)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new fo);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let i=0,r=t.length;i<r;i++){if(t[i].active===!1)continue;const s=t[i].geometryIndex;this.getMatrixAt(i,Nc),this.getBoundingSphereAt(s,X1).applyMatrix4(Nc),e.union(X1)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:e};let r=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ZG),r=this._availableInstanceIds.shift(),this._instanceInfo[r]=i):(r=this._instanceInfo.length,this._instanceInfo.push(i));const s=this._matricesTexture;Nc.identity().toArray(s.image.data,r*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&($Ne.toArray(a.image.data,r*4),a.needsUpdate=!0),this._visibilityChanged=!0,r}addGeometry(e,t=-1,i=-1){this._initializeGeometry(e),this._validateGeometry(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=i===-1?a.count:i),r.indexStart!==-1&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ZG),l=this._availableGeometryIds.shift(),s[l]=r):(l=this._geometryCount,this._geometryCount++,s.push(r)),this.setGeometryAt(l,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,l}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,r=i.getIndex()!==null,s=i.getIndex(),a=t.getIndex(),o=this._geometryInfo[e];if(r&&a.count>o.reservedIndexCount||t.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,u=o.reservedVertexCount;o.vertexCount=t.getAttribute("position").count;for(const c in i.attributes){const d=t.getAttribute(c),f=i.getAttribute(c);QNe(d,f,l);const m=d.itemSize;for(let y=d.count,_=u;y<_;y++){const S=l+y;for(let b=0;b<m;b++)f.setComponent(S,b,0)}f.needsUpdate=!0,f.addUpdateRange(l*m,u*m)}if(r){const c=o.indexStart,d=o.reservedIndexCount;o.indexCount=t.getIndex().count;for(let f=0;f<a.count;f++)s.setX(c+f,l+a.getX(f));for(let f=a.count,m=d;f<m;f++)s.setX(c+f,l);s.needsUpdate=!0,s.addUpdateRange(c,o.reservedIndexCount)}return o.start=r?o.indexStart:o.vertexStart,o.count=r?o.indexCount:o.vertexCount,o.boundingBox=null,t.boundingBox!==null&&(o.boundingBox=t.boundingBox.clone()),o.boundingSphere=null,t.boundingSphere!==null&&(o.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const i=this._instanceInfo;for(let r=0,s=i.length;r<s;r++)i[r].active&&i[r].geometryIndex===e&&this.deleteInstance(r);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const i=this._geometryInfo,r=i.map((a,o)=>o).sort((a,o)=>i[a].vertexStart-i[o].vertexStart),s=this.geometry;for(let a=0,o=i.length;a<o;a++){const l=r[a],u=i[l];if(u.active!==!1){if(s.index!==null){if(u.indexStart!==t){const{indexStart:c,vertexStart:d,reservedIndexCount:f}=u,m=s.index,y=m.array,_=e-d;for(let S=c;S<c+f;S++)y[S]=y[S]+_;m.array.copyWithin(t,c,c+f),m.addUpdateRange(t,f),m.needsUpdate=!0,u.indexStart=t}t+=u.reservedIndexCount}if(u.vertexStart!==e){const{vertexStart:c,reservedVertexCount:d}=u,f=s.attributes;for(const m in f){const y=f[m],{array:_,itemSize:S}=y;_.copyWithin(e*S,c*S,(c+d)*S),y.addUpdateRange(e*S,d*S),y.needsUpdate=!0}u.vertexStart=e}e+=u.reservedVertexCount,u.start=s.index?u.indexStart:u.vertexStart,this._nextIndexStart=s.index?u.indexStart+u.reservedIndexCount:0,this._nextVertexStart=u.vertexStart+u.reservedVertexCount}}return this._visibilityChanged=!0,this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[e];if(r.boundingBox===null){const s=new Ns,a=i.index,o=i.attributes.position;for(let l=r.start,u=r.start+r.count;l<u;l++){let c=l;a&&(c=a.getX(c)),s.expandByPoint(qT.fromBufferAttribute(o,c))}r.boundingBox=s}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[e];if(r.boundingSphere===null){const s=new fo;this.getBoundingBoxAt(e,QP),QP.getCenter(s.center);const a=i.index,o=i.attributes.position;let l=0;for(let u=r.start,c=r.start+r.count;u<c;u++){let d=u;a&&(d=a.getX(d)),qT.fromBufferAttribute(o,d),l=Math.max(l,s.center.distanceToSquared(qT))}s.radius=Math.sqrt(l),r.boundingSphere=s}return t.copy(r.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const i=this._matricesTexture,r=this._matricesTexture.image.data;return t.toArray(r,e*16),i.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const i=this._geometryInfo[e];return t.vertexStart=i.vertexStart,t.vertexCount=i.vertexCount,t.reservedVertexCount=i.reservedVertexCount,t.indexStart=i.indexStart,t.indexCount=i.indexCount,t.reservedIndexCount=i.reservedIndexCount,t.start=i.start,t.count=i.count,t}setInstanceCount(e){const t=this._availableInstanceIds,i=this._instanceInfo;for(t.sort(ZG);t[t.length-1]===i.length-1;)i.pop(),t.pop();if(e<i.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const r=new Int32Array(e),s=new Int32Array(e);W1(this._multiDrawCounts,r),W1(this._multiDrawStarts,s),this._multiDrawCounts=r,this._multiDrawStarts=s,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;a.dispose(),this._initIndirectTexture(),W1(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),W1(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),W1(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const i=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...i.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...i.map(l=>l.indexStart+l.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new wi,this._initializeGeometry(s));const a=this.geometry;s.index&&W1(s.index.array,a.index.array);for(const o in s.attributes)W1(s.attributes[o].array,a.attributes[o].array)}raycast(e,t){const i=this._instanceInfo,r=this._geometryInfo,s=this.matrixWorld,a=this.geometry;pu.material=this.material,pu.geometry.index=a.index,pu.geometry.attributes=a.attributes,pu.geometry.boundingBox===null&&(pu.geometry.boundingBox=new Ns),pu.geometry.boundingSphere===null&&(pu.geometry.boundingSphere=new fo);for(let o=0,l=i.length;o<l;o++){if(!i[o].visible||!i[o].active)continue;const u=i[o].geometryIndex,c=r[u];pu.geometry.setDrawRange(c.start,c.count),this.getMatrixAt(o,pu.matrixWorld).premultiply(s),this.getBoundingBoxAt(u,pu.geometry.boundingBox),this.getBoundingSphereAt(u,pu.geometry.boundingSphere),pu.raycast(e,eD);for(let d=0,f=eD.length;d<f;d++){const m=eD[d];m.object=this,m.batchId=o,t.push(m)}eD.length=0}pu.material=null,pu.geometry.index=null,pu.geometry.attributes={},pu.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,i,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=r.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._instanceInfo,u=this._multiDrawStarts,c=this._multiDrawCounts,d=this._geometryInfo,f=this.perObjectFrustumCulled,m=this._indirectTexture,y=m.image.data,_=i.isArrayCamera?JNe:XW;f&&!i.isArrayCamera&&(Nc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),XW.setFromProjectionMatrix(Nc,i.coordinateSystem,i.reversedDepth));let S=0;if(this.sortObjects){Nc.copy(this.matrixWorld).invert(),qT.setFromMatrixPosition(i.matrixWorld).applyMatrix4(Nc),WW.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(Nc);for(let w=0,T=l.length;w<T;w++)if(l[w].visible&&l[w].active){const E=l[w].geometryIndex;this.getMatrixAt(w,Nc),this.getBoundingSphereAt(E,X1).applyMatrix4(Nc);let R=!1;if(f&&(R=!_.intersectsSphere(X1,i)),!R){const P=d[E],I=qNe.subVectors(X1.center,qT).dot(WW);jG.push(P.start,P.count,I,w)}}const b=jG.list,M=this.customSort;M===null?b.sort(s.transparent?YNe:jNe):M.call(this,b,i);for(let w=0,T=b.length;w<T;w++){const E=b[w];u[S]=E.start*o,c[S]=E.count,y[S]=E.index,S++}jG.reset()}else for(let b=0,M=l.length;b<M;b++)if(l[b].visible&&l[b].active){const w=l[b].geometryIndex;let T=!1;if(f&&(this.getMatrixAt(b,Nc),this.getBoundingSphereAt(w,X1).applyMatrix4(Nc),T=!_.intersectsSphere(X1,i)),!T){const E=d[w];u[S]=E.start*o,c[S]=E.count,y[S]=b,S++}}m.needsUpdate=!0,this._multiDrawCount=S,this._visibilityChanged=!1}onBeforeShadow(e,t,i,r,s,a){this.onBeforeRender(e,null,r,s,a)}}class El extends _a{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new en(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const wB=new re,EB=new re,ZW=new Mn,QT=new Im,tD=new fo,YG=new re,jW=new re;class Cm extends Br{constructor(e=new wi,t=new El){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)wB.fromBufferAttribute(t,r-1),EB.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=wB.distanceTo(EB);e.setAttribute("lineDistance",new qn(i,1))}else mt("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),tD.copy(i.boundingSphere),tD.applyMatrix4(r),tD.radius+=s,e.ray.intersectsSphere(tD)===!1)return;ZW.copy(r).invert(),QT.copy(e.ray).applyMatrix4(ZW);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=this.isLineSegments?2:1,c=i.index,f=i.attributes.position;if(c!==null){const m=Math.max(0,a.start),y=Math.min(c.count,a.start+a.count);for(let _=m,S=y-1;_<S;_+=u){const b=c.getX(_),M=c.getX(_+1),w=nD(this,e,QT,l,b,M,_);w&&t.push(w)}if(this.isLineLoop){const _=c.getX(y-1),S=c.getX(m),b=nD(this,e,QT,l,_,S,y-1);b&&t.push(b)}}else{const m=Math.max(0,a.start),y=Math.min(f.count,a.start+a.count);for(let _=m,S=y-1;_<S;_+=u){const b=nD(this,e,QT,l,_,_+1,_);b&&t.push(b)}if(this.isLineLoop){const _=nD(this,e,QT,l,y-1,m,y-1);_&&t.push(_)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function nD(n,e,t,i,r,s,a){const o=n.geometry.attributes.position;if(wB.fromBufferAttribute(o,r),EB.fromBufferAttribute(o,s),t.distanceSqToSegment(wB,EB,YG,jW)>i)return;YG.applyMatrix4(n.matrixWorld);const u=e.ray.origin.distanceTo(YG);if(!(u<e.near||u>e.far))return{distance:u,point:jW.clone().applyMatrix4(n.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:n}}const YW=new re,KW=new re;class Zd extends Cm{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)YW.fromBufferAttribute(t,r),KW.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+YW.distanceTo(KW);e.setAttribute("lineDistance",new qn(i,1))}else mt("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class eF extends Cm{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class JM extends _a{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new en(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const $W=new Mn,H5=new Im,iD=new fo,rD=new re;class tF extends Br{constructor(e=new wi,t=new JM){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),iD.copy(i.boundingSphere),iD.applyMatrix4(r),iD.radius+=s,e.ray.intersectsSphere(iD)===!1)return;$W.copy(r).invert(),H5.copy(e.ray).applyMatrix4($W);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=i.index,d=i.attributes.position;if(u!==null){const f=Math.max(0,a.start),m=Math.min(u.count,a.start+a.count);for(let y=f,_=m;y<_;y++){const S=u.getX(y);rD.fromBufferAttribute(d,S),JW(rD,S,l,r,e,t,this)}}else{const f=Math.max(0,a.start),m=Math.min(d.count,a.start+a.count);for(let y=f,_=m;y<_;y++)rD.fromBufferAttribute(d,y),JW(rD,y,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function JW(n,e,t,i,r,s,a){const o=H5.distanceSqToPoint(n);if(o<t){const l=new re;H5.closestPointToPoint(n,l),l.applyMatrix4(i);const u=r.ray.origin.distanceTo(l);if(u<r.near||u>r.far)return;s.push({distance:u,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class nF extends pr{constructor(e,t,i,r,s=Jn,a=Jn,o,l,u){super(e,t,i,r,s,a,o,l,u),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const c=this;function d(){c.needsUpdate=!0,c._requestVideoFrameCallbackId=e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(d))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class lte extends nF{constructor(e,t,i,r,s,a,o,l){super({},e,t,i,r,s,a,o,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class pR extends pr{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=xr,this.minFilter=xr,this.generateMipmaps=!1,this.needsUpdate=!0}}class mR extends pr{constructor(e,t,i,r,s,a,o,l,u,c,d,f){super(null,a,o,l,u,c,r,s,d,f),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class ute extends mR{constructor(e,t,i,r,s,a){super(e,t,i,s,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=ps,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class cte extends mR{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,_u),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class V9 extends pr{constructor(e,t,i,r,s,a,o,l,u){super(e,t,i,r,s,a,o,l,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class po extends pr{constructor(e,t,i=qr,r,s,a,o=xr,l=xr,u,c=Xo,d=1){if(c!==Xo&&c!==bl)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const f={width:e,height:t,depth:d};super(f,r,s,a,o,l,c,i,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Zg(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class iF extends po{constructor(e,t=qr,i=_u,r,s,a=xr,o=xr,l,u=Xo){const c={width:e,height:e,depth:1},d=[c,c,c,c,c,c];super(e,e,t,i,r,s,a,o,l,u),this.image=d,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class rF extends pr{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class gR extends wi{constructor(e=1,t=1,i=4,r=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:r,heightSegments:s},t=Math.max(0,t),i=Math.max(1,Math.floor(i)),r=Math.max(3,Math.floor(r)),s=Math.max(1,Math.floor(s));const a=[],o=[],l=[],u=[],c=t/2,d=Math.PI/2*e,f=t,m=2*d+f,y=i*2+s,_=r+1,S=new re,b=new re;for(let M=0;M<=y;M++){let w=0,T=0,E=0,R=0;if(M<=i){const B=M/i,N=B*Math.PI/2;T=-c-e*Math.cos(N),E=e*Math.sin(N),R=-e*Math.cos(N),w=B*d}else if(M<=i+s){const B=(M-i)/s;T=-c+B*t,E=e,R=0,w=d+B*f}else{const B=(M-i-s)/i,N=B*Math.PI/2;T=c+e*Math.sin(N),E=e*Math.cos(N),R=e*Math.sin(N),w=d+f+B*d}const P=Math.max(0,Math.min(1,w/m));let I=0;M===0?I=.5/r:M===y&&(I=-.5/r);for(let B=0;B<=r;B++){const N=B/r,U=N*Math.PI*2,V=Math.sin(U),W=Math.cos(U);b.x=-E*W,b.y=T,b.z=E*V,o.push(b.x,b.y,b.z),S.set(-E*W,R,E*V),S.normalize(),l.push(S.x,S.y,S.z),u.push(N+I,P)}if(M>0){const B=(M-1)*_;for(let N=0;N<r;N++){const U=B+N,V=B+N+1,W=M*_+N,K=M*_+N+1;a.push(U,V,W),a.push(V,K,W)}}}this.setIndex(a),this.setAttribute("position",new qn(o,3)),this.setAttribute("normal",new qn(l,3)),this.setAttribute("uv",new qn(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gR(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class yR extends wi{constructor(e=1,t=32,i=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},t=Math.max(3,t);const s=[],a=[],o=[],l=[],u=new re,c=new rt;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let d=0,f=3;d<=t;d++,f+=3){const m=i+d/t*r;u.x=e*Math.cos(m),u.y=e*Math.sin(m),a.push(u.x,u.y,u.z),o.push(0,0,1),c.x=(a[f]/e+1)/2,c.y=(a[f+1]/e+1)/2,l.push(c.x,c.y)}for(let d=1;d<=t;d++)s.push(d,d+1,0);this.setIndex(s),this.setAttribute("position",new qn(a,3)),this.setAttribute("normal",new qn(o,3)),this.setAttribute("uv",new qn(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yR(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Pb extends wi{constructor(e=1,t=1,i=1,r=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const u=this;r=Math.floor(r),s=Math.floor(s);const c=[],d=[],f=[],m=[];let y=0;const _=[],S=i/2;let b=0;M(),a===!1&&(e>0&&w(!0),t>0&&w(!1)),this.setIndex(c),this.setAttribute("position",new qn(d,3)),this.setAttribute("normal",new qn(f,3)),this.setAttribute("uv",new qn(m,2));function M(){const T=new re,E=new re;let R=0;const P=(t-e)/i;for(let I=0;I<=s;I++){const B=[],N=I/s,U=N*(t-e)+e;for(let V=0;V<=r;V++){const W=V/r,K=W*l+o,q=Math.sin(K),j=Math.cos(K);E.x=U*q,E.y=-N*i+S,E.z=U*j,d.push(E.x,E.y,E.z),T.set(q,P,j).normalize(),f.push(T.x,T.y,T.z),m.push(W,1-N),B.push(y++)}_.push(B)}for(let I=0;I<r;I++)for(let B=0;B<s;B++){const N=_[B][I],U=_[B+1][I],V=_[B+1][I+1],W=_[B][I+1];(e>0||B!==0)&&(c.push(N,U,W),R+=3),(t>0||B!==s-1)&&(c.push(U,V,W),R+=3)}u.addGroup(b,R,0),b+=R}function w(T){const E=y,R=new rt,P=new re;let I=0;const B=T===!0?e:t,N=T===!0?1:-1;for(let V=1;V<=r;V++)d.push(0,S*N,0),f.push(0,N,0),m.push(.5,.5),y++;const U=y;for(let V=0;V<=r;V++){const K=V/r*l+o,q=Math.cos(K),j=Math.sin(K);P.x=B*j,P.y=S*N,P.z=B*q,d.push(P.x,P.y,P.z),f.push(0,N,0),R.x=q*.5+.5,R.y=j*.5*N+.5,m.push(R.x,R.y),y++}for(let V=0;V<r;V++){const W=E+V,K=U+V;T===!0?c.push(K,K+1,W):c.push(K+1,K,W),I+=3}u.addGroup(b,I,T===!0?1:2),b+=I}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pb(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class qM extends Pb{constructor(e=1,t=1,i=32,r=1,s=!1,a=0,o=Math.PI*2){super(0,e,t,i,r,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new qM(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class C0 extends wi{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};const s=[],a=[];o(r),u(i),c(),this.setAttribute("position",new qn(s,3)),this.setAttribute("normal",new qn(s.slice(),3)),this.setAttribute("uv",new qn(a,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function o(M){const w=new re,T=new re,E=new re;for(let R=0;R<t.length;R+=3)m(t[R+0],w),m(t[R+1],T),m(t[R+2],E),l(w,T,E,M)}function l(M,w,T,E){const R=E+1,P=[];for(let I=0;I<=R;I++){P[I]=[];const B=M.clone().lerp(T,I/R),N=w.clone().lerp(T,I/R),U=R-I;for(let V=0;V<=U;V++)V===0&&I===R?P[I][V]=B:P[I][V]=B.clone().lerp(N,V/U)}for(let I=0;I<R;I++)for(let B=0;B<2*(R-I)-1;B++){const N=Math.floor(B/2);B%2===0?(f(P[I][N+1]),f(P[I+1][N]),f(P[I][N])):(f(P[I][N+1]),f(P[I+1][N+1]),f(P[I+1][N]))}}function u(M){const w=new re;for(let T=0;T<s.length;T+=3)w.x=s[T+0],w.y=s[T+1],w.z=s[T+2],w.normalize().multiplyScalar(M),s[T+0]=w.x,s[T+1]=w.y,s[T+2]=w.z}function c(){const M=new re;for(let w=0;w<s.length;w+=3){M.x=s[w+0],M.y=s[w+1],M.z=s[w+2];const T=S(M)/2/Math.PI+.5,E=b(M)/Math.PI+.5;a.push(T,1-E)}y(),d()}function d(){for(let M=0;M<a.length;M+=6){const w=a[M+0],T=a[M+2],E=a[M+4],R=Math.max(w,T,E),P=Math.min(w,T,E);R>.9&&P<.1&&(w<.2&&(a[M+0]+=1),T<.2&&(a[M+2]+=1),E<.2&&(a[M+4]+=1))}}function f(M){s.push(M.x,M.y,M.z)}function m(M,w){const T=M*3;w.x=e[T+0],w.y=e[T+1],w.z=e[T+2]}function y(){const M=new re,w=new re,T=new re,E=new re,R=new rt,P=new rt,I=new rt;for(let B=0,N=0;B<s.length;B+=9,N+=6){M.set(s[B+0],s[B+1],s[B+2]),w.set(s[B+3],s[B+4],s[B+5]),T.set(s[B+6],s[B+7],s[B+8]),R.set(a[N+0],a[N+1]),P.set(a[N+2],a[N+3]),I.set(a[N+4],a[N+5]),E.copy(M).add(w).add(T).divideScalar(3);const U=S(E);_(R,N+0,M,U),_(P,N+2,w,U),_(I,N+4,T,U)}}function _(M,w,T,E){E<0&&M.x===1&&(a[w]=M.x-1),T.x===0&&T.z===0&&(a[w]=E/2/Math.PI+.5)}function S(M){return Math.atan2(M.z,-M.x)}function b(M){return Math.atan2(-M.y,Math.sqrt(M.x*M.x+M.z*M.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new C0(e.vertices,e.indices,e.radius,e.detail)}}class vR extends C0{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new vR(e.radius,e.detail)}}const sD=new re,aD=new re,KG=new re,oD=new Vs;class H9 extends wi{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(Ix*t),a=e.getIndex(),o=e.getAttribute("position"),l=a?a.count:o.count,u=[0,0,0],c=["a","b","c"],d=new Array(3),f={},m=[];for(let y=0;y<l;y+=3){a?(u[0]=a.getX(y),u[1]=a.getX(y+1),u[2]=a.getX(y+2)):(u[0]=y,u[1]=y+1,u[2]=y+2);const{a:_,b:S,c:b}=oD;if(_.fromBufferAttribute(o,u[0]),S.fromBufferAttribute(o,u[1]),b.fromBufferAttribute(o,u[2]),oD.getNormal(KG),d[0]=`${Math.round(_.x*r)},${Math.round(_.y*r)},${Math.round(_.z*r)}`,d[1]=`${Math.round(S.x*r)},${Math.round(S.y*r)},${Math.round(S.z*r)}`,d[2]=`${Math.round(b.x*r)},${Math.round(b.y*r)},${Math.round(b.z*r)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let M=0;M<3;M++){const w=(M+1)%3,T=d[M],E=d[w],R=oD[c[M]],P=oD[c[w]],I=`${T}_${E}`,B=`${E}_${T}`;B in f&&f[B]?(KG.dot(f[B].normal)<=s&&(m.push(R.x,R.y,R.z),m.push(P.x,P.y,P.z)),f[B]=null):I in f||(f[I]={index0:u[M],index1:u[w],normal:KG.clone()})}}for(const y in f)if(f[y]){const{index0:_,index1:S}=f[y];sD.fromBufferAttribute(o,_),aD.fromBufferAttribute(o,S),m.push(sD.x,sD.y,sD.z),m.push(aD.x,aD.y,aD.z)}this.setAttribute("position",new qn(m,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class jd{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){mt("Curve: .getPoint() not implemented.")}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)i=this.getPoint(a/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const i=this.getLengths();let r=0;const s=i.length;let a;t?a=t:a=e*i[s-1];let o=0,l=s-1,u;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),u=i[r]-a,u<0)o=r+1;else if(u>0)l=r-1;else{l=r;break}if(r=l,i[r]===a)return r/(s-1);const c=i[r],f=i[r+1]-c,m=(a-c)/f;return(r+m)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const a=this.getPoint(r),o=this.getPoint(s),l=t||(a.isVector2?new rt:new re);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t=!1){const i=new re,r=[],s=[],a=[],o=new re,l=new Mn;for(let m=0;m<=e;m++){const y=m/e;r[m]=this.getTangentAt(y,new re)}s[0]=new re,a[0]=new re;let u=Number.MAX_VALUE;const c=Math.abs(r[0].x),d=Math.abs(r[0].y),f=Math.abs(r[0].z);c<=u&&(u=c,i.set(1,0,0)),d<=u&&(u=d,i.set(0,1,0)),f<=u&&i.set(0,0,1),o.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],o),a[0].crossVectors(r[0],s[0]);for(let m=1;m<=e;m++){if(s[m]=s[m-1].clone(),a[m]=a[m-1].clone(),o.crossVectors(r[m-1],r[m]),o.length()>Number.EPSILON){o.normalize();const y=Math.acos(Ii(r[m-1].dot(r[m]),-1,1));s[m].applyMatrix4(l.makeRotationAxis(o,y))}a[m].crossVectors(r[m],s[m])}if(t===!0){let m=Math.acos(Ii(s[0].dot(s[e]),-1,1));m/=e,r[0].dot(o.crossVectors(s[0],s[e]))>0&&(m=-m);for(let y=1;y<=e;y++)s[y].applyMatrix4(l.makeRotationAxis(r[y],m*y)),a[y].crossVectors(r[y],s[y])}return{tangents:r,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class xR extends jd{constructor(e=0,t=0,i=1,r=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new rt){const i=t,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(a?s=0:s=r),this.aClockwise===!0&&!a&&(s===r?s=-r:s=s-r);const o=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const c=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=l-this.aX,m=u-this.aY;l=f*c-m*d+this.aX,u=f*d+m*c+this.aY}return i.set(l,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class X9 extends xR{constructor(e,t,i,r,s,a){super(e,t,i,i,r,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function W9(){let n=0,e=0,t=0,i=0;function r(s,a,o,l){n=s,e=o,t=-3*s+3*a-2*o-l,i=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,u){r(a,o,u*(o-s),u*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,u,c,d){let f=(a-s)/u-(o-s)/(u+c)+(o-a)/c,m=(o-a)/c-(l-a)/(c+d)+(l-o)/d;f*=c,m*=c,r(a,o,f,m)},calc:function(s){const a=s*s,o=a*s;return n+e*s+t*a+i*o}}}const lD=new re,$G=new W9,JG=new W9,qG=new W9;class Z9 extends jd{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new re){const i=t,r=this.points,s=r.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let u,c;this.closed||o>0?u=r[(o-1)%s]:(lD.subVectors(r[0],r[1]).add(r[0]),u=lD);const d=r[o%s],f=r[(o+1)%s];if(this.closed||o+2<s?c=r[(o+2)%s]:(lD.subVectors(r[s-1],r[s-2]).add(r[s-1]),c=lD),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let y=Math.pow(u.distanceToSquared(d),m),_=Math.pow(d.distanceToSquared(f),m),S=Math.pow(f.distanceToSquared(c),m);_<1e-4&&(_=1),y<1e-4&&(y=_),S<1e-4&&(S=_),$G.initNonuniformCatmullRom(u.x,d.x,f.x,c.x,y,_,S),JG.initNonuniformCatmullRom(u.y,d.y,f.y,c.y,y,_,S),qG.initNonuniformCatmullRom(u.z,d.z,f.z,c.z,y,_,S)}else this.curveType==="catmullrom"&&($G.initCatmullRom(u.x,d.x,f.x,c.x,this.tension),JG.initCatmullRom(u.y,d.y,f.y,c.y,this.tension),qG.initCatmullRom(u.z,d.z,f.z,c.z,this.tension));return i.set($G.calc(l),JG.calc(l),qG.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new re().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function qW(n,e,t,i,r){const s=(i-e)*.5,a=(r-t)*.5,o=n*n,l=n*o;return(2*t-2*i+s+a)*l+(-3*t+3*i-2*s-a)*o+s*n+t}function eBe(n,e){const t=1-n;return t*t*e}function tBe(n,e){return 2*(1-n)*n*e}function nBe(n,e){return n*n*e}function uw(n,e,t,i){return eBe(n,e)+tBe(n,t)+nBe(n,i)}function iBe(n,e){const t=1-n;return t*t*t*e}function rBe(n,e){const t=1-n;return 3*t*t*n*e}function sBe(n,e){return 3*(1-n)*n*n*e}function aBe(n,e){return n*n*n*e}function cw(n,e,t,i,r){return iBe(n,e)+rBe(n,t)+sBe(n,i)+aBe(n,r)}class sF extends jd{constructor(e=new rt,t=new rt,i=new rt,r=new rt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new rt){const i=t,r=this.v0,s=this.v1,a=this.v2,o=this.v3;return i.set(cw(e,r.x,s.x,a.x,o.x),cw(e,r.y,s.y,a.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class j9 extends jd{constructor(e=new re,t=new re,i=new re,r=new re){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new re){const i=t,r=this.v0,s=this.v1,a=this.v2,o=this.v3;return i.set(cw(e,r.x,s.x,a.x,o.x),cw(e,r.y,s.y,a.y,o.y),cw(e,r.z,s.z,a.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class aF extends jd{constructor(e=new rt,t=new rt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new rt){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new rt){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Y9 extends jd{constructor(e=new re,t=new re){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new re){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new re){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class oF extends jd{constructor(e=new rt,t=new rt,i=new rt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new rt){const i=t,r=this.v0,s=this.v1,a=this.v2;return i.set(uw(e,r.x,s.x,a.x),uw(e,r.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class lF extends jd{constructor(e=new re,t=new re,i=new re){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new re){const i=t,r=this.v0,s=this.v1,a=this.v2;return i.set(uw(e,r.x,s.x,a.x),uw(e,r.y,s.y,a.y),uw(e,r.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class uF extends jd{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new rt){const i=t,r=this.points,s=(r.length-1)*e,a=Math.floor(s),o=s-a,l=r[a===0?a:a-1],u=r[a],c=r[a>r.length-2?r.length-1:a+1],d=r[a>r.length-3?r.length-1:a+2];return i.set(qW(o,l.x,u.x,c.x,d.x),qW(o,l.y,u.y,c.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new rt().fromArray(r))}return this}}var RB=Object.freeze({__proto__:null,ArcCurve:X9,CatmullRomCurve3:Z9,CubicBezierCurve:sF,CubicBezierCurve3:j9,EllipseCurve:xR,LineCurve:aF,LineCurve3:Y9,QuadraticBezierCurve:oF,QuadraticBezierCurve3:lF,SplineCurve:uF});class K9 extends jd{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new RB[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=i){const a=r[s]-i,o=this.curves[s],l=o.getLength(),u=l===0?0:1-a/l;return o.getPointAt(u,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,s=this.curves;r<s.length;r++){const a=s[r],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let u=0;u<l.length;u++){const c=l[u];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(new RB[r.type]().fromJSON(r))}return this}}class Zw extends K9{constructor(e){super(),this.type="Path",this.currentPoint=new rt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new aF(this.currentPoint.clone(),new rt(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const s=new oF(this.currentPoint.clone(),new rt(e,t),new rt(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,s,a){const o=new sF(this.currentPoint.clone(),new rt(e,t),new rt(i,r),new rt(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new uF(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,i,r,s,a),this}absarc(e,t,i,r,s,a){return this.absellipse(e,t,i,i,r,s,a),this}ellipse(e,t,i,r,s,a,o,l){const u=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+u,t+c,i,r,s,a,o,l),this}absellipse(e,t,i,r,s,a,o,l){const u=new xR(e,t,i,r,s,a,o,l);if(this.curves.length>0){const d=u.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(u);const c=u.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class iv extends Zw{constructor(e){super(e),this.uuid=Ah(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(new Zw().fromJSON(r))}return this}}function oBe(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let s=hte(n,0,r,t,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,u;if(i&&(s=dBe(n,e,s,t)),n.length>80*t){o=n[0],l=n[1];let c=o,d=l;for(let f=t;f<r;f+=t){const m=n[f],y=n[f+1];m<o&&(o=m),y<l&&(l=y),m>c&&(c=m),y>d&&(d=y)}u=Math.max(c-o,d-l),u=u!==0?32767/u:0}return jw(s,a,t,o,l,u,0),a}function hte(n,e,t,i,r){let s;if(r===MBe(n,e,t,i)>0)for(let a=e;a<t;a+=i)s=QW(a/i|0,n[a],n[a+1],s);else for(let a=t-i;a>=e;a-=i)s=QW(a/i|0,n[a],n[a+1],s);return s&&xM(s,s.next)&&(Kw(s),s=s.next),s}function hb(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(xM(t,t.next)||qa(t.prev,t,t.next)===0)){if(Kw(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function jw(n,e,t,i,r,s,a){if(!n)return;!a&&s&&yBe(n,i,r,s);let o=n;for(;n.prev!==n.next;){const l=n.prev,u=n.next;if(s?uBe(n,i,r,s):lBe(n)){e.push(l.i,n.i,u.i),Kw(n),n=u.next,o=u.next;continue}if(n=u,n===o){a?a===1?(n=cBe(hb(n),e),jw(n,e,t,i,r,s,2)):a===2&&hBe(n,e,t,i,r,s):jw(hb(n),e,t,i,r,s,1);break}}}function lBe(n){const e=n.prev,t=n,i=n.next;if(qa(e,t,i)>=0)return!1;const r=e.x,s=t.x,a=i.x,o=e.y,l=t.y,u=i.y,c=Math.min(r,s,a),d=Math.min(o,l,u),f=Math.max(r,s,a),m=Math.max(o,l,u);let y=i.next;for(;y!==e;){if(y.x>=c&&y.x<=f&&y.y>=d&&y.y<=m&&JC(r,o,s,l,a,u,y.x,y.y)&&qa(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function uBe(n,e,t,i){const r=n.prev,s=n,a=n.next;if(qa(r,s,a)>=0)return!1;const o=r.x,l=s.x,u=a.x,c=r.y,d=s.y,f=a.y,m=Math.min(o,l,u),y=Math.min(c,d,f),_=Math.max(o,l,u),S=Math.max(c,d,f),b=X5(m,y,e,t,i),M=X5(_,S,e,t,i);let w=n.prevZ,T=n.nextZ;for(;w&&w.z>=b&&T&&T.z<=M;){if(w.x>=m&&w.x<=_&&w.y>=y&&w.y<=S&&w!==r&&w!==a&&JC(o,c,l,d,u,f,w.x,w.y)&&qa(w.prev,w,w.next)>=0||(w=w.prevZ,T.x>=m&&T.x<=_&&T.y>=y&&T.y<=S&&T!==r&&T!==a&&JC(o,c,l,d,u,f,T.x,T.y)&&qa(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;w&&w.z>=b;){if(w.x>=m&&w.x<=_&&w.y>=y&&w.y<=S&&w!==r&&w!==a&&JC(o,c,l,d,u,f,w.x,w.y)&&qa(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;T&&T.z<=M;){if(T.x>=m&&T.x<=_&&T.y>=y&&T.y<=S&&T!==r&&T!==a&&JC(o,c,l,d,u,f,T.x,T.y)&&qa(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function cBe(n,e){let t=n;do{const i=t.prev,r=t.next.next;!xM(i,r)&&fte(i,t,t.next,r)&&Yw(i,r)&&Yw(r,i)&&(e.push(i.i,t.i,r.i),Kw(t),Kw(t.next),t=n=r),t=t.next}while(t!==n);return hb(t)}function hBe(n,e,t,i,r,s){let a=n;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&bBe(a,o)){let l=pte(a,o);a=hb(a,a.next),l=hb(l,l.next),jw(a,e,t,i,r,s,0),jw(l,e,t,i,r,s,0);return}o=o.next}a=a.next}while(a!==n)}function dBe(n,e,t,i){const r=[];for(let s=0,a=e.length;s<a;s++){const o=e[s]*i,l=s<a-1?e[s+1]*i:n.length,u=hte(n,o,l,i,!1);u===u.next&&(u.steiner=!0),r.push(xBe(u))}r.sort(fBe);for(let s=0;s<r.length;s++)t=pBe(r[s],t);return t}function fBe(n,e){let t=n.x-e.x;if(t===0&&(t=n.y-e.y,t===0)){const i=(n.next.y-n.y)/(n.next.x-n.x),r=(e.next.y-e.y)/(e.next.x-e.x);t=i-r}return t}function pBe(n,e){const t=mBe(n,e);if(!t)return e;const i=pte(t,n);return hb(i,i.next),hb(t,t.next)}function mBe(n,e){let t=e;const i=n.x,r=n.y;let s=-1/0,a;if(xM(n,t))return t;do{if(xM(n,t.next))return t.next;if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const d=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=i&&d>s&&(s=d,a=t.x<t.next.x?t:t.next,d===i))return a}t=t.next}while(t!==e);if(!a)return null;const o=a,l=a.x,u=a.y;let c=1/0;t=a;do{if(i>=t.x&&t.x>=l&&i!==t.x&&dte(r<u?i:s,r,l,u,r<u?s:i,r,t.x,t.y)){const d=Math.abs(r-t.y)/(i-t.x);Yw(t,n)&&(d<c||d===c&&(t.x>a.x||t.x===a.x&&gBe(a,t)))&&(a=t,c=d)}t=t.next}while(t!==o);return a}function gBe(n,e){return qa(n.prev,n,e.prev)<0&&qa(e.next,n,n.next)<0}function yBe(n,e,t,i){let r=n;do r.z===0&&(r.z=X5(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,vBe(r)}function vBe(n){let e,t=1;do{let i=n,r;n=null;let s=null;for(e=0;i;){e++;let a=i,o=0;for(let u=0;u<t&&(o++,a=a.nextZ,!!a);u++);let l=t;for(;o>0||l>0&&a;)o!==0&&(l===0||!a||i.z<=a.z)?(r=i,i=i.nextZ,o--):(r=a,a=a.nextZ,l--),s?s.nextZ=r:n=r,r.prevZ=s,s=r;i=a}s.nextZ=null,t*=2}while(e>1);return n}function X5(n,e,t,i,r){return n=(n-t)*r|0,e=(e-i)*r|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function xBe(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function dte(n,e,t,i,r,s,a,o){return(r-a)*(e-o)>=(n-a)*(s-o)&&(n-a)*(i-o)>=(t-a)*(e-o)&&(t-a)*(s-o)>=(r-a)*(i-o)}function JC(n,e,t,i,r,s,a,o){return!(n===a&&e===o)&&dte(n,e,t,i,r,s,a,o)}function bBe(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!_Be(n,e)&&(Yw(n,e)&&Yw(e,n)&&SBe(n,e)&&(qa(n.prev,n,e.prev)||qa(n,e.prev,e))||xM(n,e)&&qa(n.prev,n,n.next)>0&&qa(e.prev,e,e.next)>0)}function qa(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function xM(n,e){return n.x===e.x&&n.y===e.y}function fte(n,e,t,i){const r=cD(qa(n,e,t)),s=cD(qa(n,e,i)),a=cD(qa(t,i,n)),o=cD(qa(t,i,e));return!!(r!==s&&a!==o||r===0&&uD(n,t,e)||s===0&&uD(n,i,e)||a===0&&uD(t,n,i)||o===0&&uD(t,e,i))}function uD(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function cD(n){return n>0?1:n<0?-1:0}function _Be(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&fte(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Yw(n,e){return qa(n.prev,n,n.next)<0?qa(n,e,n.next)>=0&&qa(n,n.prev,e)>=0:qa(n,e,n.prev)<0||qa(n,n.next,e)<0}function SBe(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function pte(n,e){const t=W5(n.i,n.x,n.y),i=W5(e.i,e.x,e.y),r=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function QW(n,e,t,i){const r=W5(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Kw(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function W5(n,e,t){return{i:n,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function MBe(n,e,t,i){let r=0;for(let s=e,a=t-i;s<t;s+=i)r+=(n[a]-n[s])*(n[s+1]+n[a+1]),a=s;return r}class ABe{static triangulate(e,t,i=2){return oBe(e,t,i)}}class Cd{static area(e){const t=e.length;let i=0;for(let r=t-1,s=0;s<t;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return i*.5}static isClockWise(e){return Cd.area(e)<0}static triangulateShape(e,t){const i=[],r=[],s=[];eZ(e),tZ(i,e);let a=e.length;t.forEach(eZ);for(let l=0;l<t.length;l++)r.push(a),a+=t[l].length,tZ(i,t[l]);const o=ABe.triangulate(i,r);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function eZ(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function tZ(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class bR extends wi{constructor(e=new iv([new rt(.5,.5),new rt(-.5,.5),new rt(-.5,-.5),new rt(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],s=[];for(let o=0,l=e.length;o<l;o++){const u=e[o];a(u)}this.setAttribute("position",new qn(r,3)),this.setAttribute("uv",new qn(s,2)),this.computeVertexNormals();function a(o){const l=[],u=t.curveSegments!==void 0?t.curveSegments:12,c=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,m=t.bevelThickness!==void 0?t.bevelThickness:.2,y=t.bevelSize!==void 0?t.bevelSize:m-.1,_=t.bevelOffset!==void 0?t.bevelOffset:0,S=t.bevelSegments!==void 0?t.bevelSegments:3;const b=t.extrudePath,M=t.UVGenerator!==void 0?t.UVGenerator:TBe;let w,T=!1,E,R,P,I;if(b){w=b.getSpacedPoints(c),T=!0,f=!1;const ke=b.isCatmullRomCurve3?b.closed:!1;E=b.computeFrenetFrames(c,ke),R=new re,P=new re,I=new re}f||(S=0,m=0,y=0,_=0);const B=o.extractPoints(u);let N=B.shape;const U=B.holes;if(!Cd.isClockWise(N)){N=N.reverse();for(let ke=0,je=U.length;ke<je;ke++){const gt=U[ke];Cd.isClockWise(gt)&&(U[ke]=gt.reverse())}}function W(ke){const gt=10000000000000001e-36;let yt=ke[0];for(let ve=1;ve<=ke.length;ve++){const An=ve%ke.length,cn=ke[An],In=cn.x-yt.x,Zt=cn.y-yt.y,le=In*In+Zt*Zt,ee=Math.max(Math.abs(cn.x),Math.abs(cn.y),Math.abs(yt.x),Math.abs(yt.y)),Re=gt*ee*ee;if(le<=Re){ke.splice(An,1),ve--;continue}yt=cn}}W(N),U.forEach(W);const K=U.length,q=N;for(let ke=0;ke<K;ke++){const je=U[ke];N=N.concat(je)}function j(ke,je,gt){return je||Tt("ExtrudeGeometry: vec does not exist"),ke.clone().addScaledVector(je,gt)}const te=N.length;function he(ke,je,gt){let yt,ve,An;const cn=ke.x-je.x,In=ke.y-je.y,Zt=gt.x-ke.x,le=gt.y-ke.y,ee=cn*cn+In*In,Re=cn*le-In*Zt;if(Math.abs(Re)>Number.EPSILON){const tt=Math.sqrt(ee),et=Math.sqrt(Zt*Zt+le*le),at=je.x-In/tt,jt=je.y+cn/tt,rn=gt.x-le/et,Nn=gt.y+Zt/et,Fn=((rn-at)*le-(Nn-jt)*Zt)/(cn*le-In*Zt);yt=at+cn*Fn-ke.x,ve=jt+In*Fn-ke.y;const Gt=yt*yt+ve*ve;if(Gt<=2)return new rt(yt,ve);An=Math.sqrt(Gt/2)}else{let tt=!1;cn>Number.EPSILON?Zt>Number.EPSILON&&(tt=!0):cn<-Number.EPSILON?Zt<-Number.EPSILON&&(tt=!0):Math.sign(In)===Math.sign(le)&&(tt=!0),tt?(yt=-In,ve=cn,An=Math.sqrt(ee)):(yt=cn,ve=In,An=Math.sqrt(ee/2))}return new rt(yt/An,ve/An)}const _e=[];for(let ke=0,je=q.length,gt=je-1,yt=ke+1;ke<je;ke++,gt++,yt++)gt===je&&(gt=0),yt===je&&(yt=0),_e[ke]=he(q[ke],q[gt],q[yt]);const Be=[];let ue,ce=_e.concat();for(let ke=0,je=K;ke<je;ke++){const gt=U[ke];ue=[];for(let yt=0,ve=gt.length,An=ve-1,cn=yt+1;yt<ve;yt++,An++,cn++)An===ve&&(An=0),cn===ve&&(cn=0),ue[yt]=he(gt[yt],gt[An],gt[cn]);Be.push(ue),ce=ce.concat(ue)}let Ce;if(S===0)Ce=Cd.triangulateShape(q,U);else{const ke=[],je=[];for(let gt=0;gt<S;gt++){const yt=gt/S,ve=m*Math.cos(yt*Math.PI/2),An=y*Math.sin(yt*Math.PI/2)+_;for(let cn=0,In=q.length;cn<In;cn++){const Zt=j(q[cn],_e[cn],An);ze(Zt.x,Zt.y,-ve),yt===0&&ke.push(Zt)}for(let cn=0,In=K;cn<In;cn++){const Zt=U[cn];ue=Be[cn];const le=[];for(let ee=0,Re=Zt.length;ee<Re;ee++){const tt=j(Zt[ee],ue[ee],An);ze(tt.x,tt.y,-ve),yt===0&&le.push(tt)}yt===0&&je.push(le)}}Ce=Cd.triangulateShape(ke,je)}const Oe=Ce.length,nt=y+_;for(let ke=0;ke<te;ke++){const je=f?j(N[ke],ce[ke],nt):N[ke];T?(P.copy(E.normals[0]).multiplyScalar(je.x),R.copy(E.binormals[0]).multiplyScalar(je.y),I.copy(w[0]).add(P).add(R),ze(I.x,I.y,I.z)):ze(je.x,je.y,0)}for(let ke=1;ke<=c;ke++)for(let je=0;je<te;je++){const gt=f?j(N[je],ce[je],nt):N[je];T?(P.copy(E.normals[ke]).multiplyScalar(gt.x),R.copy(E.binormals[ke]).multiplyScalar(gt.y),I.copy(w[ke]).add(P).add(R),ze(I.x,I.y,I.z)):ze(gt.x,gt.y,d/c*ke)}for(let ke=S-1;ke>=0;ke--){const je=ke/S,gt=m*Math.cos(je*Math.PI/2),yt=y*Math.sin(je*Math.PI/2)+_;for(let ve=0,An=q.length;ve<An;ve++){const cn=j(q[ve],_e[ve],yt);ze(cn.x,cn.y,d+gt)}for(let ve=0,An=U.length;ve<An;ve++){const cn=U[ve];ue=Be[ve];for(let In=0,Zt=cn.length;In<Zt;In++){const le=j(cn[In],ue[In],yt);T?ze(le.x,le.y+w[c-1].y,w[c-1].x+gt):ze(le.x,le.y,d+gt)}}}Ae(),Ye();function Ae(){const ke=r.length/3;if(f){let je=0,gt=te*je;for(let yt=0;yt<Oe;yt++){const ve=Ce[yt];ot(ve[2]+gt,ve[1]+gt,ve[0]+gt)}je=c+S*2,gt=te*je;for(let yt=0;yt<Oe;yt++){const ve=Ce[yt];ot(ve[0]+gt,ve[1]+gt,ve[2]+gt)}}else{for(let je=0;je<Oe;je++){const gt=Ce[je];ot(gt[2],gt[1],gt[0])}for(let je=0;je<Oe;je++){const gt=Ce[je];ot(gt[0]+te*c,gt[1]+te*c,gt[2]+te*c)}}i.addGroup(ke,r.length/3-ke,0)}function Ye(){const ke=r.length/3;let je=0;ft(q,je),je+=q.length;for(let gt=0,yt=U.length;gt<yt;gt++){const ve=U[gt];ft(ve,je),je+=ve.length}i.addGroup(ke,r.length/3-ke,1)}function ft(ke,je){let gt=ke.length;for(;--gt>=0;){const yt=gt;let ve=gt-1;ve<0&&(ve=ke.length-1);for(let An=0,cn=c+S*2;An<cn;An++){const In=te*An,Zt=te*(An+1),le=je+yt+In,ee=je+ve+In,Re=je+ve+Zt,tt=je+yt+Zt;ut(le,ee,Re,tt)}}}function ze(ke,je,gt){l.push(ke),l.push(je),l.push(gt)}function ot(ke,je,gt){Wt(ke),Wt(je),Wt(gt);const yt=r.length/3,ve=M.generateTopUV(i,r,yt-3,yt-2,yt-1);It(ve[0]),It(ve[1]),It(ve[2])}function ut(ke,je,gt,yt){Wt(ke),Wt(je),Wt(yt),Wt(je),Wt(gt),Wt(yt);const ve=r.length/3,An=M.generateSideWallUV(i,r,ve-6,ve-3,ve-2,ve-1);It(An[0]),It(An[1]),It(An[3]),It(An[1]),It(An[2]),It(An[3])}function Wt(ke){r.push(l[ke*3+0]),r.push(l[ke*3+1]),r.push(l[ke*3+2])}function It(ke){s.push(ke.x),s.push(ke.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return CBe(t,i,e)}static fromJSON(e,t){const i=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=t[e.shapes[s]];i.push(o)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new RB[r.type]().fromJSON(r)),new bR(i,e.options)}}const TBe={generateTopUV:function(n,e,t,i,r){const s=e[t*3],a=e[t*3+1],o=e[i*3],l=e[i*3+1],u=e[r*3],c=e[r*3+1];return[new rt(s,a),new rt(o,l),new rt(u,c)]},generateSideWallUV:function(n,e,t,i,r,s){const a=e[t*3],o=e[t*3+1],l=e[t*3+2],u=e[i*3],c=e[i*3+1],d=e[i*3+2],f=e[r*3],m=e[r*3+1],y=e[r*3+2],_=e[s*3],S=e[s*3+1],b=e[s*3+2];return Math.abs(o-c)<Math.abs(a-u)?[new rt(a,1-l),new rt(u,1-d),new rt(f,1-y),new rt(_,1-b)]:[new rt(o,1-l),new rt(c,1-d),new rt(m,1-y),new rt(S,1-b)]}};function CBe(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++){const s=n[i];t.shapes.push(s.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class QM extends C0{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new QM(e.radius,e.detail)}}class _R extends wi{constructor(e=[new rt(0,-.5),new rt(.5,0),new rt(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=Ii(r,0,Math.PI*2);const s=[],a=[],o=[],l=[],u=[],c=1/t,d=new re,f=new rt,m=new re,y=new re,_=new re;let S=0,b=0;for(let M=0;M<=e.length-1;M++)switch(M){case 0:S=e[M+1].x-e[M].x,b=e[M+1].y-e[M].y,m.x=b*1,m.y=-S,m.z=b*0,_.copy(m),m.normalize(),l.push(m.x,m.y,m.z);break;case e.length-1:l.push(_.x,_.y,_.z);break;default:S=e[M+1].x-e[M].x,b=e[M+1].y-e[M].y,m.x=b*1,m.y=-S,m.z=b*0,y.copy(m),m.x+=_.x,m.y+=_.y,m.z+=_.z,m.normalize(),l.push(m.x,m.y,m.z),_.copy(y)}for(let M=0;M<=t;M++){const w=i+M*c*r,T=Math.sin(w),E=Math.cos(w);for(let R=0;R<=e.length-1;R++){d.x=e[R].x*T,d.y=e[R].y,d.z=e[R].x*E,a.push(d.x,d.y,d.z),f.x=M/t,f.y=R/(e.length-1),o.push(f.x,f.y);const P=l[3*R+0]*T,I=l[3*R+1],B=l[3*R+0]*E;u.push(P,I,B)}}for(let M=0;M<t;M++)for(let w=0;w<e.length-1;w++){const T=w+M*e.length,E=T,R=T+e.length,P=T+e.length+1,I=T+1;s.push(E,R,I),s.push(P,I,R)}this.setIndex(s),this.setAttribute("position",new qn(a,3)),this.setAttribute("uv",new qn(o,2)),this.setAttribute("normal",new qn(u,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _R(e.points,e.segments,e.phiStart,e.phiLength)}}class eA extends C0{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new eA(e.radius,e.detail)}}class ap extends wi{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,a=t/2,o=Math.floor(i),l=Math.floor(r),u=o+1,c=l+1,d=e/o,f=t/l,m=[],y=[],_=[],S=[];for(let b=0;b<c;b++){const M=b*f-a;for(let w=0;w<u;w++){const T=w*d-s;y.push(T,-M,0),_.push(0,0,1),S.push(w/o),S.push(1-b/l)}}for(let b=0;b<l;b++)for(let M=0;M<o;M++){const w=M+u*b,T=M+u*(b+1),E=M+1+u*(b+1),R=M+1+u*b;m.push(w,T,R),m.push(T,E,R)}this.setIndex(m),this.setAttribute("position",new qn(y,3)),this.setAttribute("normal",new qn(_,3)),this.setAttribute("uv",new qn(S,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ap(e.width,e.height,e.widthSegments,e.heightSegments)}}class SR extends wi{constructor(e=.5,t=1,i=32,r=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:s,thetaLength:a},i=Math.max(3,i),r=Math.max(1,r);const o=[],l=[],u=[],c=[];let d=e;const f=(t-e)/r,m=new re,y=new rt;for(let _=0;_<=r;_++){for(let S=0;S<=i;S++){const b=s+S/i*a;m.x=d*Math.cos(b),m.y=d*Math.sin(b),l.push(m.x,m.y,m.z),u.push(0,0,1),y.x=(m.x/t+1)/2,y.y=(m.y/t+1)/2,c.push(y.x,y.y)}d+=f}for(let _=0;_<r;_++){const S=_*(i+1);for(let b=0;b<i;b++){const M=b+S,w=M,T=M+i+1,E=M+i+2,R=M+1;o.push(w,T,R),o.push(T,E,R)}}this.setIndex(o),this.setAttribute("position",new qn(l,3)),this.setAttribute("normal",new qn(u,3)),this.setAttribute("uv",new qn(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new SR(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class MR extends wi{constructor(e=new iv([new rt(0,.5),new rt(-.5,-.5),new rt(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],s=[],a=[];let o=0,l=0;if(Array.isArray(e)===!1)u(e);else for(let c=0;c<e.length;c++)u(e[c]),this.addGroup(o,l,c),o+=l,l=0;this.setIndex(i),this.setAttribute("position",new qn(r,3)),this.setAttribute("normal",new qn(s,3)),this.setAttribute("uv",new qn(a,2));function u(c){const d=r.length/3,f=c.extractPoints(t);let m=f.shape;const y=f.holes;Cd.isClockWise(m)===!1&&(m=m.reverse());for(let S=0,b=y.length;S<b;S++){const M=y[S];Cd.isClockWise(M)===!0&&(y[S]=M.reverse())}const _=Cd.triangulateShape(m,y);for(let S=0,b=y.length;S<b;S++){const M=y[S];m=m.concat(M)}for(let S=0,b=m.length;S<b;S++){const M=m[S];r.push(M.x,M.y,0),s.push(0,0,1),a.push(M.x,M.y)}for(let S=0,b=_.length;S<b;S++){const M=_[S],w=M[0]+d,T=M[1]+d,E=M[2]+d;i.push(w,T,E),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return wBe(t,e)}static fromJSON(e,t){const i=[];for(let r=0,s=e.shapes.length;r<s;r++){const a=t[e.shapes[r]];i.push(a)}return new MR(i,e.curveSegments)}}function wBe(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const r=n[t];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}class Db extends wi{constructor(e=1,t=32,i=16,r=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(a+o,Math.PI);let u=0;const c=[],d=new re,f=new re,m=[],y=[],_=[],S=[];for(let b=0;b<=i;b++){const M=[],w=b/i;let T=0;b===0&&a===0?T=.5/t:b===i&&l===Math.PI&&(T=-.5/t);for(let E=0;E<=t;E++){const R=E/t;d.x=-e*Math.cos(r+R*s)*Math.sin(a+w*o),d.y=e*Math.cos(a+w*o),d.z=e*Math.sin(r+R*s)*Math.sin(a+w*o),y.push(d.x,d.y,d.z),f.copy(d).normalize(),_.push(f.x,f.y,f.z),S.push(R+T,1-w),M.push(u++)}c.push(M)}for(let b=0;b<i;b++)for(let M=0;M<t;M++){const w=c[b][M+1],T=c[b][M],E=c[b+1][M],R=c[b+1][M+1];(b!==0||a>0)&&m.push(w,T,R),(b!==i-1||l<Math.PI)&&m.push(T,E,R)}this.setIndex(m),this.setAttribute("position",new qn(y,3)),this.setAttribute("normal",new qn(_,3)),this.setAttribute("uv",new qn(S,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Db(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class AR extends C0{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new AR(e.radius,e.detail)}}class TR extends wi{constructor(e=1,t=.4,i=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:s},i=Math.floor(i),r=Math.floor(r);const a=[],o=[],l=[],u=[],c=new re,d=new re,f=new re;for(let m=0;m<=i;m++)for(let y=0;y<=r;y++){const _=y/r*s,S=m/i*Math.PI*2;d.x=(e+t*Math.cos(S))*Math.cos(_),d.y=(e+t*Math.cos(S))*Math.sin(_),d.z=t*Math.sin(S),o.push(d.x,d.y,d.z),c.x=e*Math.cos(_),c.y=e*Math.sin(_),f.subVectors(d,c).normalize(),l.push(f.x,f.y,f.z),u.push(y/r),u.push(m/i)}for(let m=1;m<=i;m++)for(let y=1;y<=r;y++){const _=(r+1)*m+y-1,S=(r+1)*(m-1)+y-1,b=(r+1)*(m-1)+y,M=(r+1)*m+y;a.push(_,S,M),a.push(S,b,M)}this.setIndex(a),this.setAttribute("position",new qn(o,3)),this.setAttribute("normal",new qn(l,3)),this.setAttribute("uv",new qn(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new TR(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class CR extends wi{constructor(e=1,t=.4,i=64,r=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:s,q:a},i=Math.floor(i),r=Math.floor(r);const o=[],l=[],u=[],c=[],d=new re,f=new re,m=new re,y=new re,_=new re,S=new re,b=new re;for(let w=0;w<=i;++w){const T=w/i*s*Math.PI*2;M(T,s,a,e,m),M(T+.01,s,a,e,y),S.subVectors(y,m),b.addVectors(y,m),_.crossVectors(S,b),b.crossVectors(_,S),_.normalize(),b.normalize();for(let E=0;E<=r;++E){const R=E/r*Math.PI*2,P=-t*Math.cos(R),I=t*Math.sin(R);d.x=m.x+(P*b.x+I*_.x),d.y=m.y+(P*b.y+I*_.y),d.z=m.z+(P*b.z+I*_.z),l.push(d.x,d.y,d.z),f.subVectors(d,m).normalize(),u.push(f.x,f.y,f.z),c.push(w/i),c.push(E/r)}}for(let w=1;w<=i;w++)for(let T=1;T<=r;T++){const E=(r+1)*(w-1)+(T-1),R=(r+1)*w+(T-1),P=(r+1)*w+T,I=(r+1)*(w-1)+T;o.push(E,R,I),o.push(R,P,I)}this.setIndex(o),this.setAttribute("position",new qn(l,3)),this.setAttribute("normal",new qn(u,3)),this.setAttribute("uv",new qn(c,2));function M(w,T,E,R,P){const I=Math.cos(w),B=Math.sin(w),N=E/T*w,U=Math.cos(N);P.x=R*(2+U)*.5*I,P.y=R*(2+U)*B*.5,P.z=R*Math.sin(N)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new CR(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class wR extends wi{constructor(e=new lF(new re(-1,-1,0),new re(-1,1,0),new re(1,1,0)),t=64,i=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new re,l=new re,u=new rt;let c=new re;const d=[],f=[],m=[],y=[];_(),this.setIndex(y),this.setAttribute("position",new qn(d,3)),this.setAttribute("normal",new qn(f,3)),this.setAttribute("uv",new qn(m,2));function _(){for(let w=0;w<t;w++)S(w);S(s===!1?t:0),M(),b()}function S(w){c=e.getPointAt(w/t,c);const T=a.normals[w],E=a.binormals[w];for(let R=0;R<=r;R++){const P=R/r*Math.PI*2,I=Math.sin(P),B=-Math.cos(P);l.x=B*T.x+I*E.x,l.y=B*T.y+I*E.y,l.z=B*T.z+I*E.z,l.normalize(),f.push(l.x,l.y,l.z),o.x=c.x+i*l.x,o.y=c.y+i*l.y,o.z=c.z+i*l.z,d.push(o.x,o.y,o.z)}}function b(){for(let w=1;w<=t;w++)for(let T=1;T<=r;T++){const E=(r+1)*(w-1)+(T-1),R=(r+1)*w+(T-1),P=(r+1)*w+T,I=(r+1)*(w-1)+T;y.push(E,R,I),y.push(R,P,I)}}function M(){for(let w=0;w<=t;w++)for(let T=0;T<=r;T++)u.x=w/t,u.y=T/r,m.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new wR(new RB[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class $9 extends wi{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,r=new re,s=new re;if(e.index!==null){const a=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let u=0,c=l.length;u<c;++u){const d=l[u],f=d.start,m=d.count;for(let y=f,_=f+m;y<_;y+=3)for(let S=0;S<3;S++){const b=o.getX(y+S),M=o.getX(y+(S+1)%3);r.fromBufferAttribute(a,b),s.fromBufferAttribute(a,M),nZ(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let u=0;u<3;u++){const c=3*o+u,d=3*o+(u+1)%3;r.fromBufferAttribute(a,c),s.fromBufferAttribute(a,d),nZ(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new qn(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function nZ(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(r)===!0?!1:(t.add(i),t.add(r),!0)}var iZ=Object.freeze({__proto__:null,BoxGeometry:Id,CapsuleGeometry:gR,CircleGeometry:yR,ConeGeometry:qM,CylinderGeometry:Pb,DodecahedronGeometry:vR,EdgesGeometry:H9,ExtrudeGeometry:bR,IcosahedronGeometry:QM,LatheGeometry:_R,OctahedronGeometry:eA,PlaneGeometry:ap,PolyhedronGeometry:C0,RingGeometry:SR,ShapeGeometry:MR,SphereGeometry:Db,TetrahedronGeometry:AR,TorusGeometry:TR,TorusKnotGeometry:CR,TubeGeometry:wR,WireframeGeometry:$9});class cF extends _a{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new en(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class hF extends Ds{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class mo extends _a{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new en(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new en(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fd,this.normalScale=new rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mu,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Kc extends mo{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new rt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ii(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new en(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new en(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new en(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class dF extends _a{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new en(16777215),this.specular=new en(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new en(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fd,this.normalScale=new rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mu,this.combine=Sb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class fF extends _a{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new en(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new en(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fd,this.normalScale=new rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class ER extends _a{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fd,this.normalScale=new rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class tA extends _a{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new en(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new en(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fd,this.normalScale=new rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mu,this.combine=Sb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pF extends _a{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=sp,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class mF extends _a{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class gF extends _a{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new en(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fd,this.normalScale=new rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class RR extends El{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function _x(n,e){return!n||n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function mte(n){function e(r,s){return n[r]-n[s]}const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i}function Z5(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,a=0;a!==i;++s){const o=t[s]*e;for(let l=0;l!==e;++l)r[a++]=n[o+l]}return r}function J9(n,e,t,i){let r=1,s=n[0];for(;s!==void 0&&s[i]===void 0;)s=n[r++];if(s===void 0)return;let a=s[i];if(a!==void 0)if(Array.isArray(a))do a=s[i],a!==void 0&&(e.push(s.time),t.push(...a)),s=n[r++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[i],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=n[r++];while(s!==void 0);else do a=s[i],a!==void 0&&(e.push(s.time),t.push(a)),s=n[r++];while(s!==void 0)}function EBe(n,e,t,i,r=30){const s=n.clone();s.name=e;const a=[];for(let l=0;l<s.tracks.length;++l){const u=s.tracks[l],c=u.getValueSize(),d=[],f=[];for(let m=0;m<u.times.length;++m){const y=u.times[m]*r;if(!(y<t||y>=i)){d.push(u.times[m]);for(let _=0;_<c;++_)f.push(u.values[m*c+_])}}d.length!==0&&(u.times=_x(d,u.times.constructor),u.values=_x(f,u.values.constructor),a.push(u))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function RBe(n,e=0,t=n,i=30){i<=0&&(i=30);const r=t.tracks.length,s=e/i;for(let a=0;a<r;++a){const o=t.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const u=n.tracks.find(function(b){return b.name===o.name&&b.ValueTypeName===l});if(u===void 0)continue;let c=0;const d=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=d/3);let f=0;const m=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=m/3);const y=o.times.length-1;let _;if(s<=o.times[0]){const b=c,M=d-c;_=o.values.slice(b,M)}else if(s>=o.times[y]){const b=y*d+c,M=b+d-c;_=o.values.slice(b,M)}else{const b=o.createInterpolant(),M=c,w=d-c;b.evaluate(s),_=b.resultBuffer.slice(M,w)}l==="quaternion"&&new ba().fromArray(_).normalize().conjugate().toArray(_);const S=u.times.length;for(let b=0;b<S;++b){const M=b*m+f;if(l==="quaternion")ba.multiplyQuaternionsFlat(u.values,M,_,0,u.values,M);else{const w=m-f*2;for(let T=0;T<w;++T)u.values[M+T]-=_[T]}}}return n.blendMode=W2,n}class gte{static convertArray(e,t){return _x(e,t)}static isTypedArray(e){return gM(e)}static getKeyframeOrder(e){return mte(e)}static sortedArray(e,t,i){return Z5(e,t,i)}static flattenJSON(e,t,i,r){J9(e,t,i,r)}static subclip(e,t,i,r,s=30){return EBe(e,t,i,r,s)}static makeClipAdditive(e,t=0,i=e,r=30){return RBe(e,t,i,r)}}class Nb{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let a;n:{i:if(!(e<r)){for(let o=i+2;;){if(r===void 0){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(s=r,r=t[++i],e<r)break t}a=t.length;break n}if(!(e>=s)){const o=t[1];e<o&&(i=2,s=o);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=t[--i-1],e>=s)break t}a=i,i=0;break n}break e}for(;i<a;){const o=i+a>>>1;e<t[o]?a=o:i=o+1}if(r=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let a=0;a!==r;++a)t[a]=i[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class q9 extends Nb{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Vy,endingEnd:Vy}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,a=e+1,o=r[s],l=r[a];if(o===void 0)switch(this.getSettings_().endingStart){case Hy:s=e,o=2*t-i;break;case mM:s=r.length-2,o=t+r[s]-r[s+1];break;default:s=e,o=i}if(l===void 0)switch(this.getSettings_().endingEnd){case Hy:a=e,l=2*i-t;break;case mM:a=1,l=i+r[1]-r[0];break;default:a=e-1,l=t}const u=(i-t)*.5,c=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(l-i),this._offsetPrev=s*c,this._offsetNext=a*c}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,u=l-o,c=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,m=this._weightNext,y=(i-t)/(r-t),_=y*y,S=_*y,b=-f*S+2*f*_-f*y,M=(1+f)*S+(-1.5-2*f)*_+(-.5+f)*y+1,w=(-1-m)*S+(1.5+m)*_+.5*y,T=m*S-m*_;for(let E=0;E!==o;++E)s[E]=b*a[c+E]+M*a[u+E]+w*a[l+E]+T*a[d+E];return s}}class yF extends Nb{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,u=l-o,c=(i-t)/(r-t),d=1-c;for(let f=0;f!==o;++f)s[f]=a[u+f]*d+a[l+f]*c;return s}}class Q9 extends Nb{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Nh{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=_x(t,this.TimeBufferType),this.values=_x(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:_x(e.times,Array),values:_x(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Q9(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new yF(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new q9(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case ab:t=this.InterpolantFactoryMethodDiscrete;break;case ob:t=this.InterpolantFactoryMethodLinear;break;case aw:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return mt("KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ab;case this.InterpolantFactoryMethodLinear:return ob;case this.InterpolantFactoryMethodSmooth:return aw}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,a=r-1;for(;s!==r&&i[s]<e;)++s;for(;a!==-1&&i[a]>t;)--a;if(++a,s!==0||a!==r){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=i.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(Tt("KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;s===0&&(Tt("KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const l=i[o];if(typeof l=="number"&&isNaN(l)){Tt("KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){Tt("KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(r!==void 0&&gM(r))for(let o=0,l=r.length;o!==l;++o){const u=r[o];if(isNaN(u)){Tt("KeyframeTrack: Value is not a valid number.",this,o,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===aw,s=e.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const u=e[o],c=e[o+1];if(u!==c&&(o!==1||u!==e[0]))if(r)l=!0;else{const d=o*i,f=d-i,m=d+i;for(let y=0;y!==i;++y){const _=t[d+y];if(_!==t[f+y]||_!==t[m+y]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const d=o*i,f=a*i;for(let m=0;m!==i;++m)t[f+m]=t[d+m]}++a}}if(s>0){e[a]=e[s];for(let o=s*i,l=a*i,u=0;u!==i;++u)t[l+u]=t[o+u];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Nh.prototype.ValueTypeName="";Nh.prototype.TimeBufferType=Float32Array;Nh.prototype.ValueBufferType=Float32Array;Nh.prototype.DefaultInterpolation=ob;class $v extends Nh{constructor(e,t,i){super(e,t,i)}}$v.prototype.ValueTypeName="bool";$v.prototype.ValueBufferType=Array;$v.prototype.DefaultInterpolation=ab;$v.prototype.InterpolantFactoryMethodLinear=void 0;$v.prototype.InterpolantFactoryMethodSmooth=void 0;class vF extends Nh{constructor(e,t,i,r){super(e,t,i,r)}}vF.prototype.ValueTypeName="color";class Ov extends Nh{constructor(e,t,i,r){super(e,t,i,r)}}Ov.prototype.ValueTypeName="number";class eV extends Nb{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(i-t)/(r-t);let u=e*o;for(let c=u+o;u!==c;u+=4)ba.slerpFlat(s,0,a,u-o,a,u,l);return s}}class Uv extends Nh{constructor(e,t,i,r){super(e,t,i,r)}InterpolantFactoryMethodLinear(e){return new eV(this.times,this.values,this.getValueSize(),e)}}Uv.prototype.ValueTypeName="quaternion";Uv.prototype.InterpolantFactoryMethodSmooth=void 0;class Jv extends Nh{constructor(e,t,i){super(e,t,i)}}Jv.prototype.ValueTypeName="string";Jv.prototype.ValueBufferType=Array;Jv.prototype.DefaultInterpolation=ab;Jv.prototype.InterpolantFactoryMethodLinear=void 0;Jv.prototype.InterpolantFactoryMethodSmooth=void 0;class kv extends Nh{constructor(e,t,i,r){super(e,t,i,r)}}kv.prototype.ValueTypeName="vector";class db{constructor(e="",t=-1,i=[],r=nR){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Ah(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let a=0,o=i.length;a!==o;++a)t.push(DBe(i[a]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s.userData=JSON.parse(e.userData||"{}"),s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let s=0,a=i.length;s!==a;++s)t.push(Nh.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,a=[];for(let o=0;o<s;o++){let l=[],u=[];l.push((o+s-1)%s,o,(o+1)%s),u.push(0,1,0);const c=mte(l);l=Z5(l,1,c),u=Z5(u,1,c),!r&&l[0]===0&&(l.push(s),u.push(u[0])),a.push(new Ov(".morphTargetInfluences["+t[o].name+"]",l,u).scale(1/i))}return new this(e,-1,a)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const u=e[o],c=u.name.match(s);if(c&&c.length>1){const d=c[1];let f=r[d];f||(r[d]=f=[]),f.push(u)}}const a=[];for(const o in r)a.push(this.CreateFromMorphTargetSequence(o,r[o],t,i));return a}static parseAnimation(e,t){if(mt("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return Tt("AnimationClip: No animation in JSONLoader data."),null;const i=function(d,f,m,y,_){if(m.length!==0){const S=[],b=[];J9(m,S,b,y),S.length!==0&&_.push(new d(f,S,b))}},r=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const u=e.hierarchy||[];for(let d=0;d<u.length;d++){const f=u[d].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const m={};let y;for(y=0;y<f.length;y++)if(f[y].morphTargets)for(let _=0;_<f[y].morphTargets.length;_++)m[f[y].morphTargets[_]]=-1;for(const _ in m){const S=[],b=[];for(let M=0;M!==f[y].morphTargets.length;++M){const w=f[y];S.push(w.time),b.push(w.morphTarget===_?1:0)}r.push(new Ov(".morphTargetInfluence["+_+"]",S,b))}l=m.length*a}else{const m=".bones["+t[d].name+"]";i(kv,m+".position",f,"pos",r),i(Uv,m+".quaternion",f,"rot",r),i(kv,m+".scale",f,"scl",r)}}return r.length===0?null:new this(s,l,r,o)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function PBe(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ov;case"vector":case"vector2":case"vector3":case"vector4":return kv;case"color":return vF;case"quaternion":return Uv;case"bool":case"boolean":return $v;case"string":return Jv}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function DBe(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=PBe(n.type);if(n.times===void 0){const t=[],i=[];J9(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Uf={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class PR{constructor(e,t,i){const r=this;let s=!1,a=0,o=0,l;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this._abortController=null,this.itemStart=function(c){o++,s===!1&&r.onStart!==void 0&&r.onStart(c,a,o),s=!0},this.itemEnd=function(c){a++,r.onProgress!==void 0&&r.onProgress(c,a,o),a===o&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,d){return u.push(c,d),this},this.removeHandler=function(c){const d=u.indexOf(c);return d!==-1&&u.splice(d,2),this},this.getHandler=function(c){for(let d=0,f=u.length;d<f;d+=2){const m=u[d],y=u[d+1];if(m.global&&(m.lastIndex=0),m.test(c))return y}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const Sx=new PR;let rl=class{constructor(e){this.manager=e!==void 0?e:Sx,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}};rl.DEFAULT_MATERIAL_NAME="__DEFAULT";const Cg={};class NBe extends Error{constructor(e,t){super(e),this.response=t}}class el extends rl{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Uf.get(`file:${e}`);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(Cg[e]!==void 0){Cg[e].push({onLoad:t,onProgress:i,onError:r});return}Cg[e]=[],Cg[e].push({onLoad:t,onProgress:i,onError:r});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,l=this.responseType;fetch(a).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&mt("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const c=Cg[e],d=u.body.getReader(),f=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),m=f?parseInt(f):0,y=m!==0;let _=0;const S=new ReadableStream({start(b){M();function M(){d.read().then(({done:w,value:T})=>{if(w)b.close();else{_+=T.byteLength;const E=new ProgressEvent("progress",{lengthComputable:y,loaded:_,total:m});for(let R=0,P=c.length;R<P;R++){const I=c[R];I.onProgress&&I.onProgress(E)}b.enqueue(T),M()}},w=>{b.error(w)})}}});return new Response(S)}else throw new NBe(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(l){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(c=>new DOMParser().parseFromString(c,o));case"json":return u.json();default:if(o==="")return u.text();{const d=/charset="?([^;"\s]*)"?/i.exec(o),f=d&&d[1]?d[1].toLowerCase():void 0,m=new TextDecoder(f);return u.arrayBuffer().then(y=>m.decode(y))}}}).then(u=>{Uf.add(`file:${e}`,u);const c=Cg[e];delete Cg[e];for(let d=0,f=c.length;d<f;d++){const m=c[d];m.onLoad&&m.onLoad(u)}}).catch(u=>{const c=Cg[e];if(c===void 0)throw this.manager.itemError(e),u;delete Cg[e];for(let d=0,f=c.length;d<f;d++){const m=c[d];m.onError&&m.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class yte extends rl{constructor(e){super(e)}load(e,t,i,r){const s=this,a=new el(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(l){r?r(l):Tt(l),s.manager.itemError(e)}},i,r)}parse(e){const t=[];for(let i=0;i<e.length;i++){const r=db.parse(e[i]);t.push(r)}return t}}class vte extends rl{constructor(e){super(e)}load(e,t,i,r){const s=this,a=[],o=new mR,l=new el(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let u=0;function c(d){l.load(e[d],function(f){const m=s.parse(f,!0);a[d]={width:m.width,height:m.height,format:m.format,mipmaps:m.mipmaps},u+=1,u===6&&(m.mipmapCount===1&&(o.minFilter=Jn),o.image=a,o.format=m.format,o.needsUpdate=!0,t&&t(o))},i,r)}if(Array.isArray(e))for(let d=0,f=e.length;d<f;++d)c(d);else l.load(e,function(d){const f=s.parse(d,!0);if(f.isCubemap){const m=f.mipmaps.length/f.mipmapCount;for(let y=0;y<m;y++){a[y]={mipmaps:[]};for(let _=0;_<f.mipmapCount;_++)a[y].mipmaps.push(f.mipmaps[y*f.mipmapCount+_]),a[y].format=f.format,a[y].width=f.width,a[y].height=f.height}o.image=a}else o.image.width=f.width,o.image.height=f.height,o.mipmaps=f.mipmaps;f.mipmapCount===1&&(o.minFilter=Jn),o.format=f.format,o.needsUpdate=!0,t&&t(o)},i,r);return o}}const nS=new WeakMap;class bM extends rl{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Uf.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0);else{let d=nS.get(a);d===void 0&&(d=[],nS.set(a,d)),d.push({onLoad:t,onError:r})}return a}const o=Ww("img");function l(){c(),t&&t(this);const d=nS.get(this)||[];for(let f=0;f<d.length;f++){const m=d[f];m.onLoad&&m.onLoad(this)}nS.delete(this),s.manager.itemEnd(e)}function u(d){c(),r&&r(d),Uf.remove(`image:${e}`);const f=nS.get(this)||[];for(let m=0;m<f.length;m++){const y=f[m];y.onError&&y.onError(d)}nS.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function c(){o.removeEventListener("load",l,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),Uf.add(`image:${e}`,o),s.manager.itemStart(e),o.src=e,o}}class tV extends rl{constructor(e){super(e)}load(e,t,i,r){const s=new T0;s.colorSpace=Ps;const a=new bM(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(u){a.load(e[u],function(c){s.images[u]=c,o++,o===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let u=0;u<e.length;++u)l(u);return s}}class xF extends rl{constructor(e){super(e)}load(e,t,i,r){const s=this,a=new xu,o=new el(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(l){let u;try{u=s.parse(l)}catch(c){if(r!==void 0)r(c);else{c(c);return}}u.image!==void 0?a.image=u.image:u.data!==void 0&&(a.image.width=u.width,a.image.height=u.height,a.image.data=u.data),a.wrapS=u.wrapS!==void 0?u.wrapS:ps,a.wrapT=u.wrapT!==void 0?u.wrapT:ps,a.magFilter=u.magFilter!==void 0?u.magFilter:Jn,a.minFilter=u.minFilter!==void 0?u.minFilter:Jn,a.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.colorSpace!==void 0&&(a.colorSpace=u.colorSpace),u.flipY!==void 0&&(a.flipY=u.flipY),u.format!==void 0&&(a.format=u.format),u.type!==void 0&&(a.type=u.type),u.mipmaps!==void 0&&(a.mipmaps=u.mipmaps,a.minFilter=Vo),u.mipmapCount===1&&(a.minFilter=Jn),u.generateMipmaps!==void 0&&(a.generateMipmaps=u.generateMipmaps),a.needsUpdate=!0,t&&t(a,u)},i,r),a}}class nA extends rl{constructor(e){super(e)}load(e,t,i,r){const s=new pr,a=new bM(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}class w0 extends Br{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new en(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class bF extends w0{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Br.DEFAULT_UP),this.updateMatrix(),this.groundColor=new en(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const QG=new Mn,rZ=new re,sZ=new re;class nV{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new rt(512,512),this.mapType=br,this.map=null,this.mapPass=null,this.matrix=new Mn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Kv,this._frameExtents=new rt(1,1),this._viewportCount=1,this._viewports=[new si(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;rZ.setFromMatrixPosition(e.matrixWorld),t.position.copy(rZ),sZ.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(sZ),t.updateMatrixWorld(),QG.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(QG,t.coordinateSystem,t.reversedDepth),t.reversedDepth?i.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(QG)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class BBe extends nV{constructor(){super(new ds(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,i=ub*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Bb extends w0{constructor(e,t,i=0,r=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Br.DEFAULT_UP),this.updateMatrix(),this.target=new Br,this.distance=i,this.angle=r,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new BBe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class FBe extends nV{constructor(){super(new ds(90,1,.5,500)),this.isPointLightShadow=!0}}class DR extends w0{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new FBe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class Tl extends Eb{constructor(e=-1,t=1,i=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,a=i+e,o=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,a=s+u*this.view.width,o-=c*this.view.offsetY,l=o-c*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class LBe extends nV{constructor(){super(new Tl(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class NR extends w0{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Br.DEFAULT_UP),this.updateMatrix(),this.target=new Br,this.shadow=new LBe}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class _F extends w0{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class SF extends w0{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class MF{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new re)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*i),t.addScaledVector(a[4],1.092548*(i*r)),t.addScaledVector(a[5],1.092548*(r*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(i*s)),t.addScaledVector(a[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*r),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*i),t.addScaledVector(a[4],2*.429043*i*r),t.addScaledVector(a[5],2*.429043*r*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*i*s),t.addScaledVector(a[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}}class AF extends w0{constructor(e=new MF,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class iA extends rl{constructor(e){super(e),this.textures={}}load(e,t,i,r){const s=this,a=new el(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(l){r?r(l):Tt(l),s.manager.itemError(e)}},i,r)}parse(e){const t=this.textures;function i(s){return t[s]===void 0&&mt("MaterialLoader: Undefined texture",s),t[s]}const r=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new en().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(r.dispersion=e.dispersion),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.allowOverride!==void 0&&(r.allowOverride=e.allowOverride),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(r.uniforms[s]={},a.type){case"t":r.uniforms[s].value=i(a.value);break;case"c":r.uniforms[s].value=new en().setHex(a.value);break;case"v2":r.uniforms[s].value=new rt().fromArray(a.value);break;case"v3":r.uniforms[s].value=new re().fromArray(a.value);break;case"v4":r.uniforms[s].value=new si().fromArray(a.value);break;case"m3":r.uniforms[s].value=new Li().fromArray(a.value);break;case"m4":r.uniforms[s].value=new Mn().fromArray(a.value);break;default:r.uniforms[s].value=a.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=i(e.map)),e.matcap!==void 0&&(r.matcap=i(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new rt().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=i(e.envMap)),e.envMapRotation!==void 0&&r.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new rt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return iA.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:cF,SpriteMaterial:dR,RawShaderMaterial:hF,ShaderMaterial:Ds,PointsMaterial:JM,MeshPhysicalMaterial:Kc,MeshStandardMaterial:mo,MeshPhongMaterial:dF,MeshToonMaterial:fF,MeshNormalMaterial:ER,MeshLambertMaterial:tA,MeshDepthMaterial:pF,MeshDistanceMaterial:mF,MeshBasicMaterial:La,MeshMatcapMaterial:gF,LineDashedMaterial:RR,LineBasicMaterial:El,Material:_a};return new t[e]}}class Qg{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class iV extends wi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class rV extends rl{constructor(e){super(e)}load(e,t,i,r){const s=this,a=new el(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(l){r?r(l):Tt(l),s.manager.itemError(e)}},i,r)}parse(e){const t={},i={};function r(m,y){if(t[y]!==void 0)return t[y];const S=m.interleavedBuffers[y],b=s(m,S.buffer),M=kS(S.type,b),w=new Rb(M,S.stride);return w.uuid=S.uuid,t[y]=w,w}function s(m,y){if(i[y]!==void 0)return i[y];const S=m.arrayBuffers[y],b=new Uint32Array(S).buffer;return i[y]=b,b}const a=e.isInstancedBufferGeometry?new iV:new wi,o=e.data.index;if(o!==void 0){const m=kS(o.type,o.array);a.setIndex(new Gi(m,1))}const l=e.data.attributes;for(const m in l){const y=l[m];let _;if(y.isInterleavedBufferAttribute){const S=r(e.data,y.data);_=new Tm(S,y.itemSize,y.offset,y.normalized)}else{const S=kS(y.type,y.array),b=y.isInstancedBufferAttribute?Vc:Gi;_=new b(S,y.itemSize,y.normalized)}y.name!==void 0&&(_.name=y.name),y.usage!==void 0&&_.setUsage(y.usage),a.setAttribute(m,_)}const u=e.data.morphAttributes;if(u)for(const m in u){const y=u[m],_=[];for(let S=0,b=y.length;S<b;S++){const M=y[S];let w;if(M.isInterleavedBufferAttribute){const T=r(e.data,M.data);w=new Tm(T,M.itemSize,M.offset,M.normalized)}else{const T=kS(M.type,M.array);w=new Gi(T,M.itemSize,M.normalized)}M.name!==void 0&&(w.name=M.name),_.push(w)}a.morphAttributes[m]=_}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let m=0,y=d.length;m!==y;++m){const _=d[m];a.addGroup(_.start,_.count,_.materialIndex)}const f=e.data.boundingSphere;return f!==void 0&&(a.boundingSphere=new fo().fromJSON(f)),e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class sV extends rl{constructor(e){super(e)}load(e,t,i,r){const s=this,a=this.path===""?Qg.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new el(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let u=null;try{u=JSON.parse(l)}catch(d){r!==void 0&&r(d),d("ObjectLoader: Can't parse "+e+".",d.message);return}const c=u.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),Tt("ObjectLoader: Can't load "+e);return}s.parse(u,t)},i,r)}async loadAsync(e,t){const i=this,r=this.path===""?Qg.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new el(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,t),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(o)}parse(e,t){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,function(){t!==void 0&&t(u)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),u=this.parseObject(e.object,s,l,o,i),c=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,c),this.bindLightTargets(u),t!==void 0){let d=!1;for(const f in a)if(a[f].data instanceof HTMLImageElement){d=!0;break}d===!1&&t(u)}return u}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,r,o,a,t),u=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,u),this.bindLightTargets(l),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,r=e.length;i<r;i++){const s=new iv().fromJSON(e[i]);t[s.uuid]=s}return t}parseSkeletons(e,t){const i={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=new KM().fromJSON(e[s],r);i[o.uuid]=o}return i}parseGeometries(e,t){const i={};if(e!==void 0){const r=new rV;for(let s=0,a=e.length;s<a;s++){let o;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(l);break;default:l.type in iZ?o=iZ[l.type].fromJSON(l,t):mt(`ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),i[l.uuid]=o}}return i}parseMaterials(e,t){const i={},r={};if(e!==void 0){const s=new iA;s.setTextures(t);for(let a=0,o=e.length;a<o;a++){const l=e[a];i[l.uuid]===void 0&&(i[l.uuid]=s.parse(l)),r[l.uuid]=i[l.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const r=e[i],s=db.parse(r);t[s.uuid]=s}return t}parseImages(e,t){const i=this,r={};let s;function a(l){return i.manager.itemStart(l),s.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const u=l,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:i.resourcePath+u;return a(c)}else return l.data?{data:kS(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new PR(t);s=new bM(l),s.setCrossOrigin(this.crossOrigin);for(let u=0,c=e.length;u<c;u++){const d=e[u],f=d.url;if(Array.isArray(f)){const m=[];for(let y=0,_=f.length;y<_;y++){const S=f[y],b=o(S);b!==null&&(b instanceof HTMLImageElement?m.push(b):m.push(new xu(b.data,b.width,b.height)))}r[d.uuid]=new Zg(m)}else{const m=o(d.url);r[d.uuid]=new Zg(m)}}}return r}async parseImagesAsync(e){const t=this,i={};let r;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o;return await r.loadAsync(l)}else return a.data?{data:kS(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){r=new bM(this.manager),r.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const l=e[a],u=l.url;if(Array.isArray(u)){const c=[];for(let d=0,f=u.length;d<f;d++){const m=u[d],y=await s(m);y!==null&&(y instanceof HTMLImageElement?c.push(y):c.push(new xu(y.data,y.width,y.height)))}i[l.uuid]=new Zg(c)}else{const c=await s(l.url);i[l.uuid]=new Zg(c)}}}return i}parseTextures(e,t){function i(s,a){return typeof s=="number"?s:(mt("ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const r={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=e[s];o.image===void 0&&mt('ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&mt("ObjectLoader: Undefined image",o.image);const l=t[o.image],u=l.data;let c;Array.isArray(u)?(c=new T0,u.length===6&&(c.needsUpdate=!0)):(u&&u.data?c=new xu:c=new pr,u&&(c.needsUpdate=!0)),c.source=l,c.uuid=o.uuid,o.name!==void 0&&(c.name=o.name),o.mapping!==void 0&&(c.mapping=i(o.mapping,IBe)),o.channel!==void 0&&(c.channel=o.channel),o.offset!==void 0&&c.offset.fromArray(o.offset),o.repeat!==void 0&&c.repeat.fromArray(o.repeat),o.center!==void 0&&c.center.fromArray(o.center),o.rotation!==void 0&&(c.rotation=o.rotation),o.wrap!==void 0&&(c.wrapS=i(o.wrap[0],aZ),c.wrapT=i(o.wrap[1],aZ)),o.format!==void 0&&(c.format=o.format),o.internalFormat!==void 0&&(c.internalFormat=o.internalFormat),o.type!==void 0&&(c.type=o.type),o.colorSpace!==void 0&&(c.colorSpace=o.colorSpace),o.minFilter!==void 0&&(c.minFilter=i(o.minFilter,oZ)),o.magFilter!==void 0&&(c.magFilter=i(o.magFilter,oZ)),o.anisotropy!==void 0&&(c.anisotropy=o.anisotropy),o.flipY!==void 0&&(c.flipY=o.flipY),o.generateMipmaps!==void 0&&(c.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(c.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(c.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(c.compareFunction=o.compareFunction),o.userData!==void 0&&(c.userData=o.userData),r[o.uuid]=c}return r}parseObject(e,t,i,r,s){let a;function o(f){return t[f]===void 0&&mt("ObjectLoader: Undefined geometry",f),t[f]}function l(f){if(f!==void 0){if(Array.isArray(f)){const m=[];for(let y=0,_=f.length;y<_;y++){const S=f[y];i[S]===void 0&&mt("ObjectLoader: Undefined material",S),m.push(i[S])}return m}return i[f]===void 0&&mt("ObjectLoader: Undefined material",f),i[f]}}function u(f){return r[f]===void 0&&mt("ObjectLoader: Undefined texture",f),r[f]}let c,d;switch(e.type){case"Scene":a=new Wc,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new en(e.background):a.background=u(e.background)),e.environment!==void 0&&(a.environment=u(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new YM(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new hR(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new ds(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Tl(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new _F(e.color,e.intensity);break;case"DirectionalLight":a=new NR(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new DR(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new SF(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Bb(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new bF(e.color,e.groundColor,e.intensity);break;case"LightProbe":const f=new MF().fromArray(e.sh);a=new AF(f,e.intensity);break;case"SkinnedMesh":c=o(e.geometry),d=l(e.material),a=new q2(c,d),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":c=o(e.geometry),d=l(e.material),a=new Fr(c,d);break;case"InstancedMesh":c=o(e.geometry),d=l(e.material);const m=e.count,y=e.instanceMatrix,_=e.instanceColor;a=new Q2(c,d,m),a.instanceMatrix=new Vc(new Float32Array(y.array),16),_!==void 0&&(a.instanceColor=new Vc(new Float32Array(_.array),_.itemSize));break;case"BatchedMesh":c=o(e.geometry),d=l(e.material),a=new z9(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,d),a.geometry=c,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(S=>{let b=null,M=null;return S.boundingBox!==void 0&&(b=new Ns().fromJSON(S.boundingBox)),S.boundingSphere!==void 0&&(M=new fo().fromJSON(S.boundingSphere)),{...S,boundingBox:b,boundingSphere:M}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=u(e.matricesTexture.uuid),a._indirectTexture=u(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=u(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(a.boundingSphere=new fo().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(a.boundingBox=new Ns().fromJSON(e.boundingBox));break;case"LOD":a=new k9;break;case"Line":a=new Cm(o(e.geometry),l(e.material));break;case"LineLoop":a=new eF(o(e.geometry),l(e.material));break;case"LineSegments":a=new Zd(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":a=new tF(o(e.geometry),l(e.material));break;case"Sprite":a=new U9(l(e.material));break;case"Group":a=new _h;break;case"Bone":a=new fR;break;default:a=new Br}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let m=0;m<f.length;m++)a.add(this.parseObject(f[m],t,i,r,s))}if(e.animations!==void 0){const f=e.animations;for(let m=0;m<f.length;m++){const y=f[m];a.animations.push(s[y])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const f=e.levels;for(let m=0;m<f.length;m++){const y=f[m],_=a.getObjectByProperty("uuid",y.object);_!==void 0&&a.addLevel(_,y.distance,y.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const r=t[i.skeleton];r===void 0?mt("ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(r,i.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const i=t.target,r=e.getObjectByProperty("uuid",i);r!==void 0?t.target=r:t.target=new Br}})}}const IBe={UVMapping:Sm,CubeReflectionMapping:_u,CubeRefractionMapping:wh,EquirectangularReflectionMapping:Mm,EquirectangularRefractionMapping:h0,CubeUVReflectionMapping:Am},aZ={RepeatWrapping:Xc,ClampToEdgeWrapping:ps,MirroredRepeatWrapping:jf},oZ={NearestFilter:xr,NearestMipmapNearestFilter:Mb,NearestMipmapLinearFilter:xh,LinearFilter:Jn,LinearMipmapNearestFilter:sm,LinearMipmapLinearFilter:Vo},eO=new WeakMap;class aV extends rl{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&mt("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&mt("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Uf.get(`image-bitmap:${e}`);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(u=>{if(eO.has(a)===!0)r&&r(eO.get(a)),s.manager.itemError(e),s.manager.itemEnd(e);else return t&&t(u),s.manager.itemEnd(e),u});return}return setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const l=fetch(e,o).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(u){return Uf.add(`image-bitmap:${e}`,u),t&&t(u),s.manager.itemEnd(e),u}).catch(function(u){r&&r(u),eO.set(l,u),Uf.remove(`image-bitmap:${e}`),s.manager.itemError(e),s.manager.itemEnd(e)});Uf.add(`image-bitmap:${e}`,l),s.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let hD,TF=class{static getContext(){return hD===void 0&&(hD=new(window.AudioContext||window.webkitAudioContext)),hD}static setContext(e){hD=e}};class xte extends rl{constructor(e){super(e)}load(e,t,i,r){const s=this,a=new el(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{const u=l.slice(0);TF.getContext().decodeAudioData(u,function(d){t(d)}).catch(o)}catch(u){o(u)}},i,r);function o(l){r?r(l):Tt(l),s.manager.itemError(e)}}}const lZ=new Mn,uZ=new Mn,Z1=new Mn;class bte{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ds,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ds,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Z1.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,a=t.near*Math.tan(Ix*t.fov*.5)/t.zoom;let o,l;uZ.elements[12]=-r,lZ.elements[12]=r,o=-a*t.aspect+s,l=a*t.aspect+s,Z1.elements[0]=2*t.near/(l-o),Z1.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(Z1),o=-a*t.aspect-s,l=a*t.aspect-s,Z1.elements[0]=2*t.near/(l-o),Z1.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(Z1)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(uZ),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(lZ)}}class CF extends ds{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class BR{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const j1=new re,tO=new ba,GBe=new re,Y1=new re,K1=new re;class oV extends Br{constructor(){super(),this.type="AudioListener",this.context=TF.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new BR}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(j1,tO,GBe),Y1.set(0,0,-1).applyQuaternion(tO),K1.set(0,1,0).applyQuaternion(tO),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(j1.x,i),t.positionY.linearRampToValueAtTime(j1.y,i),t.positionZ.linearRampToValueAtTime(j1.z,i),t.forwardX.linearRampToValueAtTime(Y1.x,i),t.forwardY.linearRampToValueAtTime(Y1.y,i),t.forwardZ.linearRampToValueAtTime(Y1.z,i),t.upX.linearRampToValueAtTime(K1.x,i),t.upY.linearRampToValueAtTime(K1.y,i),t.upZ.linearRampToValueAtTime(K1.z,i)}else t.setPosition(j1.x,j1.y,j1.z),t.setOrientation(Y1.x,Y1.y,Y1.z,K1.x,K1.y,K1.z)}}class lV extends Br{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){mt("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){mt("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){mt("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){mt("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){mt("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(mt("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){mt("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(mt("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const $1=new re,cZ=new ba,OBe=new re,J1=new re;class uV extends lV{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose($1,cZ,OBe),J1.set(0,0,1).applyQuaternion(cZ);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime($1.x,i),t.positionY.linearRampToValueAtTime($1.y,i),t.positionZ.linearRampToValueAtTime($1.z,i),t.orientationX.linearRampToValueAtTime(J1.x,i),t.orientationY.linearRampToValueAtTime(J1.y,i),t.orientationZ.linearRampToValueAtTime(J1.z,i)}else t.setPosition($1.x,$1.y,$1.z),t.setOrientation(J1.x,J1.y,J1.z)}}class _te{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class cV{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,s,a;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,s=e*r+r;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==r;++o)i[s+o]=i[o];a=t}else{a+=t;const o=t/a;this._mixBufferRegion(i,s,0,o,r)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(i,r,l,1-s,t)}a>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let l=t,u=t+t;l!==u;++l)if(i[l]!==i[l+t]){o.setValue(i,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let s=i,a=r;s!==a;++s)t[s]=t[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,s){if(r>=.5)for(let a=0;a!==s;++a)e[t+a]=e[i+a]}_slerp(e,t,i,r){ba.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,s){const a=this._workIndex*s;ba.multiplyQuaternionsFlat(e,a,e,t,e,i),ba.slerpFlat(e,t,e,t,e,a,r)}_lerp(e,t,i,r,s){const a=1-r;for(let o=0;o!==s;++o){const l=t+o;e[l]=e[l]*a+e[i+o]*r}}_lerpAdditive(e,t,i,r,s){for(let a=0;a!==s;++a){const o=t+a;e[o]=e[o]+e[i+a]*r}}}const hV="\\[\\]\\.:\\/",UBe=new RegExp("["+hV+"]","g"),dV="[^"+hV+"]",kBe="[^"+hV.replace("\\.","")+"]",zBe=/((?:WC+[\/:])*)/.source.replace("WC",dV),VBe=/(WCOD+)?/.source.replace("WCOD",kBe),HBe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",dV),XBe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",dV),WBe=new RegExp("^"+zBe+VBe+HBe+XBe+"$"),ZBe=["material","materials","bones","map"];class jBe{constructor(e,t,i){const r=i||Jr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class Jr{constructor(e,t,i){this.path=t,this.parsedPath=i||Jr.parseTrackName(t),this.node=Jr.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Jr.Composite(e,t,i):new Jr(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(UBe,"")}static parseTrackName(e){const t=WBe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=i.nodeName.substring(r+1);ZBe.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===t||o.uuid===t)return o;const l=i(o.children);if(l)return l}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=Jr.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){mt("PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let u=t.objectIndex;switch(i){case"materials":if(!e.material){Tt("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){Tt("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){Tt("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===u){u=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){Tt("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){Tt("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){Tt("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(u!==void 0){if(e[u]===void 0){Tt("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const a=e[r];if(a===void 0){const u=t.nodeName;Tt("PropertyBinding: Trying to update property for track: "+u+"."+r+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){Tt("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){Tt("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Jr.Composite=jBe;Jr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Jr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Jr.prototype.GetterByBindingType=[Jr.prototype._getValue_direct,Jr.prototype._getValue_array,Jr.prototype._getValue_arrayElement,Jr.prototype._getValue_toArray];Jr.prototype.SetterByBindingTypeAndVersioning=[[Jr.prototype._setValue_direct,Jr.prototype._setValue_direct_setNeedsUpdate,Jr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Jr.prototype._setValue_array,Jr.prototype._setValue_array_setNeedsUpdate,Jr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Jr.prototype._setValue_arrayElement,Jr.prototype._setValue_arrayElement_setNeedsUpdate,Jr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Jr.prototype._setValue_fromArray,Jr.prototype._setValue_fromArray_setNeedsUpdate,Jr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ste{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ah(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,r=arguments.length;i!==r;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length;let o,l=e.length,u=this.nCachedObjects_;for(let c=0,d=arguments.length;c!==d;++c){const f=arguments[c],m=f.uuid;let y=t[m];if(y===void 0){y=l++,t[m]=y,e.push(f);for(let _=0,S=a;_!==S;++_)s[_].push(new Jr(f,i[_],r[_]))}else if(y<u){o=e[y];const _=--u,S=e[_];t[S.uuid]=y,e[y]=S,t[m]=_,e[_]=f;for(let b=0,M=a;b!==M;++b){const w=s[b],T=w[_];let E=w[y];w[y]=T,E===void 0&&(E=new Jr(f,i[b],r[b])),w[_]=E}}else e[y]!==o&&Tt("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],u=l.uuid,c=t[u];if(c!==void 0&&c>=s){const d=s++,f=e[d];t[f.uuid]=c,e[c]=f,t[u]=d,e[d]=l;for(let m=0,y=r;m!==y;++m){const _=i[m],S=_[d],b=_[c];_[c]=S,_[d]=b}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_,a=e.length;for(let o=0,l=arguments.length;o!==l;++o){const u=arguments[o],c=u.uuid,d=t[c];if(d!==void 0)if(delete t[c],d<s){const f=--s,m=e[f],y=--a,_=e[y];t[m.uuid]=d,e[d]=m,t[_.uuid]=f,e[f]=_,e.pop();for(let S=0,b=r;S!==b;++S){const M=i[S],w=M[f],T=M[y];M[d]=w,M[f]=T,M.pop()}}else{const f=--a,m=e[f];f>0&&(t[m.uuid]=d),e[d]=m,e.pop();for(let y=0,_=r;y!==_;++y){const S=i[y];S[d]=S[f],S.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const i=this._bindingsIndicesByPath;let r=i[e];const s=this._bindings;if(r!==void 0)return s[r];const a=this._paths,o=this._parsedPaths,l=this._objects,u=l.length,c=this.nCachedObjects_,d=new Array(u);r=s.length,i[e]=r,a.push(e),o.push(t),s.push(d);for(let f=c,m=l.length;f!==m;++f){const y=l[f];d[f]=new Jr(y,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const r=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],u=e[o];t[u]=i,a[i]=l,a.pop(),s[i]=s[o],s.pop(),r[i]=r[o],r.pop()}}}class fV{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const s=t.tracks,a=s.length,o=new Array(a),l={endingStart:Vy,endingEnd:Vy};for(let u=0;u!==a;++u){const c=s[u].createInterpolant(null);o[u]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=v9,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i=!1){if(e.fadeOut(t),this.fadeIn(t),i===!0){const r=this._clip.duration,s=e._clip.duration,a=s/r,o=r/s;e.warp(1,a,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,i=!1){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,s=r.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,u=o.sampleValues;return l[0]=s,l[1]=s+i,u[0]=e/a,u[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case W2:for(let c=0,d=l.length;c!==d;++c)l[c].evaluate(a),u[c].accumulateAdditive(o);break;case nR:default:for(let c=0,d=l.length;c!==d;++c)l[c].evaluate(a),u[c].accumulate(r,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,s=this._loopCount;const a=i===x9;if(e===0)return s===-1?r:a&&(s&1)===1?t-r:r;if(i===y9){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),r>=t||r<0){const o=Math.floor(r/t);r-=t*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(a&&(s&1)===1)return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=Hy,r.endingEnd=Hy):(e?r.endingStart=this.zeroSlopeAtStart?Hy:Vy:r.endingStart=mM,t?r.endingEnd=this.zeroSlopeAtEnd?Hy:Vy:r.endingEnd=mM)}_scheduleFading(e,t,i){const r=this._mixer,s=r.time;let a=this._weightInterpolant;a===null&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=t,o[1]=s+e,l[1]=i,this}}const YBe=new Float32Array(1);class Mte extends wl{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,a=e._propertyBindings,o=e._interpolants,l=i.uuid,u=this._bindingsByRootAndName;let c=u[l];c===void 0&&(c={},u[l]=c);for(let d=0;d!==s;++d){const f=r[d],m=f.name;let y=c[m];if(y!==void 0)++y.referenceCount,a[d]=y;else{if(y=a[d],y!==void 0){y._cacheIndex===null&&(++y.referenceCount,this._addInactiveBinding(y,l,m));continue}const _=t&&t._propertyBindings[d].binding.parsedPath;y=new cV(Jr.create(i,m,_),f.ValueTypeName,f.getValueSize()),++y.referenceCount,this._addInactiveBinding(y,l,m),a[d]=y}o[d].resultBuffer=y.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,s=this._actionsByClip;let a=s[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,u=l[l.length-1],c=e._byClipCacheIndex;u._byClipCacheIndex=c,l[c]=u,l.pop(),e._byClipCacheIndex=null;const d=o.actionByRoot,f=(e._localRoot||this._root).uuid;delete d[f],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,s=this._bindings;let a=r[t];a===void 0&&(a={},r[t]=a),a[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,a=this._bindingsByRootAndName,o=a[r],l=t[t.length-1],u=e._cacheIndex;l._cacheIndex=u,t[u]=l,t.pop(),delete o[s],Object.keys(o).length===0&&delete a[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new yF(new Float32Array(2),new Float32Array(2),1,YBe),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const r=t||this._root,s=r.uuid;let a=typeof e=="string"?db.findByName(r,e):e;const o=a!==null?a.uuid:e,l=this._actionsByClip[o];let u=null;if(i===void 0&&(a!==null?i=a.blendMode:i=nR),l!==void 0){const d=l.actionByRoot[s];if(d!==void 0&&d.blendMode===i)return d;u=l.knownActions[0],a===null&&(a=u._clip)}if(a===null)return null;const c=new fV(this,a,t,i);return this._bindAction(c,u),this._addInactiveAction(c,o,s),c}existingAction(e,t){const i=t||this._root,r=i.uuid,s=typeof e=="string"?db.findByName(i,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let u=0;u!==i;++u)t[u]._update(r,e,s,a);const o=this._bindings,l=this._nActiveBindings;for(let u=0;u!==l;++u)o[u].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const u=a[o];this._deactivateAction(u);const c=u._cacheIndex,d=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,d._cacheIndex=c,t[c]=d,t.pop(),this._removeInactiveBindingsForAction(u)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const a in i){const o=i[a].actionByRoot,l=o[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Ate extends Wd{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isRenderTarget3D=!0,this.depth=i,this.texture=new lR(null,e,t,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}let mi=class Tte{constructor(e){this.value=e}clone(){return new Tte(this.value.clone===void 0?this.value:this.value.clone())}},KBe=0,Cte=class extends wl{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:KBe++}),this.name="",this.usage=p0,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,r=t.length;i<r;i++){const s=Array.isArray(t[i])?t[i]:[t[i]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}};class pV extends Rb{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class wte{constructor(e,t,i,r,s,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=s,this.normalized=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const hZ=new Mn;class FR{constructor(e,t,i=0,r=1/0){this.ray=new Im(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new cb,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):Tt("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return hZ.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(hZ),this}intersectObject(e,t=!0,i=[]){return j5(e,this,i,t),i.sort(dZ),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)j5(e[r],this,i,t);return i.sort(dZ),i}}function dZ(n,e){return n.distance-e.distance}function j5(n,e,t,i){let r=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(r=!1),r===!0&&i===!0){const s=n.children;for(let a=0,o=s.length;a<o;a++)j5(s[a],e,t,!0)}}let Ete=class{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=$Be.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}};function $Be(){this._document.hidden===!1&&this.reset()}class $w{constructor(e=1,t=0,i=0){this.radius=e,this.phi=t,this.theta=i}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Ii(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Ii(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Rte{constructor(e=1,t=0,i=0){this.radius=e,this.theta=t,this.y=i}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}class rA{constructor(e,t,i,r){rA.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,i,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let i=0;i<4;i++)this.elements[i]=e[i+t];return this}set(e,t,i,r){const s=this.elements;return s[0]=e,s[2]=t,s[1]=i,s[3]=r,this}}const fZ=new rt;class Pte{constructor(e=new rt(1/0,1/0),t=new rt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=fZ.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,fZ).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const pZ=new re,dD=new re,iS=new re,rS=new re,nO=new re,JBe=new re,qBe=new re;class Hc{constructor(e=new re,t=new re){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){pZ.subVectors(e,this.start),dD.subVectors(this.end,this.start);const i=dD.dot(dD);let s=dD.dot(pZ)/i;return t&&(s=Ii(s,0,1)),s}closestPointToPoint(e,t,i){const r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}distanceSqToLine3(e,t=JBe,i=qBe){const r=10000000000000001e-32;let s,a;const o=this.start,l=e.start,u=this.end,c=e.end;iS.subVectors(u,o),rS.subVectors(c,l),nO.subVectors(o,l);const d=iS.dot(iS),f=rS.dot(rS),m=rS.dot(nO);if(d<=r&&f<=r)return t.copy(o),i.copy(l),t.sub(i),t.dot(t);if(d<=r)s=0,a=m/f,a=Ii(a,0,1);else{const y=iS.dot(nO);if(f<=r)a=0,s=Ii(-y/d,0,1);else{const _=iS.dot(rS),S=d*f-_*_;S!==0?s=Ii((_*m-y*f)/S,0,1):s=0,a=(_*s+m)/f,a<0?(a=0,s=Ii(-y/d,0,1)):a>1&&(a=1,s=Ii((_-y)/d,0,1))}}return t.copy(o).add(iS.multiplyScalar(s)),i.copy(l).add(rS.multiplyScalar(a)),t.sub(i),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const mZ=new re;class Dte extends Br{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new wi,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const u=a/l*Math.PI*2,c=o/l*Math.PI*2;r.push(Math.cos(u),Math.sin(u),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new qn(r,3));const s=new El({fog:!1,toneMapped:!1});this.cone=new Zd(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),mZ.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(mZ),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const by=new re,fD=new Mn,iO=new Mn;class Nte extends Zd{constructor(e){const t=Bte(e),i=new wi,r=[],s=[];for(let u=0;u<t.length;u++){const c=t[u];c.parent&&c.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(0,0,0),s.push(0,0,0))}i.setAttribute("position",new qn(r,3)),i.setAttribute("color",new qn(s,3));const a=new El({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const o=new en(255),l=new en(65280);this.setColors(o,l)}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");iO.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<t.length;s++){const o=t[s];o.parent&&o.parent.isBone&&(fD.multiplyMatrices(iO,o.matrixWorld),by.setFromMatrixPosition(fD),r.setXYZ(a,by.x,by.y,by.z),fD.multiplyMatrices(iO,o.parent.matrixWorld),by.setFromMatrixPosition(fD),r.setXYZ(a+1,by.x,by.y,by.z),a+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const r=this.geometry.getAttribute("color");for(let s=0;s<r.count;s+=2)r.setXYZ(s,e.r,e.g,e.b),r.setXYZ(s+1,t.r,t.g,t.b);return r.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function Bte(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push(...Bte(n.children[t]));return e}class Fte extends Fr{constructor(e,t,i){const r=new Db(t,4,2),s=new La({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const QBe=new re,gZ=new en,yZ=new en;class Lte extends Br{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new eA(t);r.rotateY(Math.PI*.5),this.material=new La({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),a=new Float32Array(s.count*3);r.setAttribute("color",new Gi(a,3)),this.add(new Fr(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");gZ.copy(this.light.color),yZ.copy(this.light.groundColor);for(let i=0,r=t.count;i<r;i++){const s=i<r/2?gZ:yZ;t.setXYZ(i,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(QBe.setFromMatrixPosition(this.light.matrixWorld).negate())}}let Ite=class extends Zd{constructor(e=10,t=10,i=4473924,r=8947848){i=new en(i),r=new en(r);const s=t/2,a=e/t,o=e/2,l=[],u=[];for(let f=0,m=0,y=-o;f<=t;f++,y+=a){l.push(-o,0,y,o,0,y),l.push(y,0,-o,y,0,o);const _=f===s?i:r;_.toArray(u,m),m+=3,_.toArray(u,m),m+=3,_.toArray(u,m),m+=3,_.toArray(u,m),m+=3}const c=new wi;c.setAttribute("position",new qn(l,3)),c.setAttribute("color",new qn(u,3));const d=new El({vertexColors:!0,toneMapped:!1});super(c,d),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},Gte=class extends Zd{constructor(e=10,t=16,i=8,r=64,s=4473924,a=8947848){s=new en(s),a=new en(a);const o=[],l=[];if(t>1)for(let d=0;d<t;d++){const f=d/t*(Math.PI*2),m=Math.sin(f)*e,y=Math.cos(f)*e;o.push(0,0,0),o.push(m,0,y);const _=d&1?s:a;l.push(_.r,_.g,_.b),l.push(_.r,_.g,_.b)}for(let d=0;d<i;d++){const f=d&1?s:a,m=e-e/i*d;for(let y=0;y<r;y++){let _=y/r*(Math.PI*2),S=Math.sin(_)*m,b=Math.cos(_)*m;o.push(S,0,b),l.push(f.r,f.g,f.b),_=(y+1)/r*(Math.PI*2),S=Math.sin(_)*m,b=Math.cos(_)*m,o.push(S,0,b),l.push(f.r,f.g,f.b)}}const u=new wi;u.setAttribute("position",new qn(o,3)),u.setAttribute("color",new qn(l,3));const c=new El({vertexColors:!0,toneMapped:!1});super(u,c),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}};const vZ=new re,pD=new re,xZ=new re;class Ote extends Br{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new wi;r.setAttribute("position",new qn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new El({fog:!1,toneMapped:!1});this.lightPlane=new Cm(r,s),this.add(this.lightPlane),r=new wi,r.setAttribute("position",new qn([0,0,0,0,0,1],3)),this.targetLine=new Cm(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),vZ.setFromMatrixPosition(this.light.matrixWorld),pD.setFromMatrixPosition(this.light.target.matrixWorld),xZ.subVectors(pD,vZ),this.lightPlane.lookAt(pD),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(pD),this.targetLine.scale.z=xZ.length()}}const mD=new re,oo=new Eb;class Ute extends Zd{constructor(e){const t=new wi,i=new El({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(y,_){l(y),l(_)}function l(y){r.push(0,0,0),s.push(0,0,0),a[y]===void 0&&(a[y]=[]),a[y].push(r.length/3-1)}t.setAttribute("position",new qn(r,3)),t.setAttribute("color",new qn(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const u=new en(16755200),c=new en(16711680),d=new en(43775),f=new en(16777215),m=new en(3355443);this.setColors(u,c,d,f,m)}setColors(e,t,i,r,s){const o=this.geometry.getAttribute("color");return o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,i.r,i.g,i.b),o.setXYZ(33,i.r,i.g,i.b),o.setXYZ(34,i.r,i.g,i.b),o.setXYZ(35,i.r,i.g,i.b),o.setXYZ(36,i.r,i.g,i.b),o.setXYZ(37,i.r,i.g,i.b),o.setXYZ(38,r.r,r.g,r.b),o.setXYZ(39,r.r,r.g,r.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,i=1,r=1;let s,a;if(oo.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)s=1,a=0;else if(this.camera.coordinateSystem===Sl)s=-1,a=1;else if(this.camera.coordinateSystem===ic)s=0,a=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);So("c",t,e,oo,0,0,s),So("t",t,e,oo,0,0,a),So("n1",t,e,oo,-i,-r,s),So("n2",t,e,oo,i,-r,s),So("n3",t,e,oo,-i,r,s),So("n4",t,e,oo,i,r,s),So("f1",t,e,oo,-i,-r,a),So("f2",t,e,oo,i,-r,a),So("f3",t,e,oo,-i,r,a),So("f4",t,e,oo,i,r,a),So("u1",t,e,oo,i*.7,r*1.1,s),So("u2",t,e,oo,-i*.7,r*1.1,s),So("u3",t,e,oo,0,r*2,s),So("cf1",t,e,oo,-i,0,a),So("cf2",t,e,oo,i,0,a),So("cf3",t,e,oo,0,-r,a),So("cf4",t,e,oo,0,r,a),So("cn1",t,e,oo,-i,0,s),So("cn2",t,e,oo,i,0,s),So("cn3",t,e,oo,0,-r,s),So("cn4",t,e,oo,0,r,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function So(n,e,t,i,r,s,a){mD.set(r,s,a).unproject(i);const o=e[n];if(o!==void 0){const l=t.getAttribute("position");for(let u=0,c=o.length;u<c;u++)l.setXYZ(o[u],mD.x,mD.y,mD.z)}}const gD=new Ns;class kte extends Zd{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),s=new wi;s.setIndex(new Gi(i,1)),s.setAttribute("position",new Gi(r,3)),super(s,new El({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&gD.setFromObject(this.object),gD.isEmpty())return;const e=gD.min,t=gD.max,i=this.geometry.attributes.position,r=i.array;r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=e.x,r[4]=t.y,r[5]=t.z,r[6]=e.x,r[7]=e.y,r[8]=t.z,r[9]=t.x,r[10]=e.y,r[11]=t.z,r[12]=t.x,r[13]=t.y,r[14]=e.z,r[15]=e.x,r[16]=t.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=t.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class zte extends Zd{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new wi;s.setIndex(new Gi(i,1)),s.setAttribute("position",new qn(r,3)),super(s,new El({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Vte extends Cm{constructor(e,t=1,i=16776960){const r=i,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new wi;a.setAttribute("position",new qn(s,3)),a.computeBoundingSphere(),super(a,new El({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new wi;l.setAttribute("position",new qn(o,3)),l.computeBoundingSphere(),this.add(new Fr(l,new La({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const bZ=new re;let yD,rO;class Hte extends Br{constructor(e=new re(0,0,1),t=new re(0,0,0),i=1,r=16776960,s=i*.2,a=s*.2){super(),this.type="ArrowHelper",yD===void 0&&(yD=new wi,yD.setAttribute("position",new qn([0,0,0,0,1,0],3)),rO=new qM(.5,1,5,1),rO.translate(0,-.5,0)),this.position.copy(t),this.line=new Cm(yD,new El({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Fr(rO,new La({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{bZ.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(bZ,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Xte extends Zd{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new wi;r.setAttribute("position",new qn(t,3)),r.setAttribute("color",new qn(i,3));const s=new El({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,i){const r=new en,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Wte{constructor(){this.type="ShapePath",this.color=new en,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Zw,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,s,a){return this.currentPath.bezierCurveTo(e,t,i,r,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(b){const M=[];for(let w=0,T=b.length;w<T;w++){const E=b[w],R=new iv;R.curves=E.curves,M.push(R)}return M}function i(b,M){const w=M.length;let T=!1;for(let E=w-1,R=0;R<w;E=R++){let P=M[E],I=M[R],B=I.x-P.x,N=I.y-P.y;if(Math.abs(N)>Number.EPSILON){if(N<0&&(P=M[R],B=-B,I=M[E],N=-N),b.y<P.y||b.y>I.y)continue;if(b.y===P.y){if(b.x===P.x)return!0}else{const U=N*(b.x-P.x)-B*(b.y-P.y);if(U===0)return!0;if(U<0)continue;T=!T}}else{if(b.y!==P.y)continue;if(I.x<=b.x&&b.x<=P.x||P.x<=b.x&&b.x<=I.x)return!0}}return T}const r=Cd.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const u=[];if(s.length===1)return o=s[0],l=new iv,l.curves=o.curves,u.push(l),u;let c=!r(s[0].getPoints());c=e?!c:c;const d=[],f=[];let m=[],y=0,_;f[y]=void 0,m[y]=[];for(let b=0,M=s.length;b<M;b++)o=s[b],_=o.getPoints(),a=r(_),a=e?!a:a,a?(!c&&f[y]&&y++,f[y]={s:new iv,p:_},f[y].s.curves=o.curves,c&&y++,m[y]=[]):m[y].push({h:o,p:_[0]});if(!f[0])return t(s);if(f.length>1){let b=!1,M=0;for(let w=0,T=f.length;w<T;w++)d[w]=[];for(let w=0,T=f.length;w<T;w++){const E=m[w];for(let R=0;R<E.length;R++){const P=E[R];let I=!0;for(let B=0;B<f.length;B++)i(P.p,f[B].p)&&(w!==B&&M++,I?(I=!1,d[B].push(P)):b=!0);I&&d[w].push(P)}}M>0&&b===!1&&(m=d)}let S;for(let b=0,M=f.length;b<M;b++){l=f[b].s,u.push(l),S=m[b];for(let w=0,T=S.length;w<T;w++)l.holes.push(S[w].h)}return u}}class Zte extends wl{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){mt("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function e2e(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function t2e(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function n2e(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function PB(n,e,t,i){const r=i2e(i);switch(t){case tR:return n*e;case rp:return n*e/r.components*r.byteLength;case A0:return n*e/r.components*r.byteLength;case _l:return n*e*2/r.components*r.byteLength;case jv:return n*e*2/r.components*r.byteLength;case Ab:return n*e*3/r.components*r.byteLength;case Vr:return n*e*4/r.components*r.byteLength;case Yv:return n*e*4/r.components*r.byteLength;case lm:case um:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case cm:case hm:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case ib:case sb:return Math.max(n,16)*Math.max(e,8)/4;case nb:case rb:return Math.max(n,8)*Math.max(e,8)/2;case dv:case fv:case mv:case gv:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case pv:case d0:case yv:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case vv:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case xv:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case bv:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case _v:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case Sv:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case Mv:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case Av:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case Tv:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case Cv:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case wv:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case Ev:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case Rv:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case Pv:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case Dv:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Nv:case zw:case Vw:return Math.ceil(n/4)*Math.ceil(e/4)*16;case Bv:case Fv:return Math.ceil(n/4)*Math.ceil(e/4)*8;case f0:case Lv:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function i2e(n){switch(n){case br:case am:return{byteLength:1,components:1};case zc:case om:case zi:return{byteLength:2,components:1};case VM:case HM:return{byteLength:2,components:4};case qr:case Ao:case wr:return{byteLength:4,components:1};case XM:case WM:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}class jte{static contain(e,t){return e2e(e,t)}static cover(e,t){return t2e(e,t)}static fill(e){return n2e(e)}static getByteLength(e,t,i,r){return PB(e,t,i,r)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Xd}}));typeof window<"u"&&(window.__THREE__?mt("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Xd);function Yte(){let n=null,e=!1,t=null,i=null;function r(s,a){t(s,a),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function r2e(n){const e=new WeakMap;function t(o,l){const u=o.array,c=o.usage,d=u.byteLength,f=n.createBuffer();n.bindBuffer(l,f),n.bufferData(l,u,c),o.onUploadCallback();let m;if(u instanceof Float32Array)m=n.FLOAT;else if(typeof Float16Array<"u"&&u instanceof Float16Array)m=n.HALF_FLOAT;else if(u instanceof Uint16Array)o.isFloat16BufferAttribute?m=n.HALF_FLOAT:m=n.UNSIGNED_SHORT;else if(u instanceof Int16Array)m=n.SHORT;else if(u instanceof Uint32Array)m=n.UNSIGNED_INT;else if(u instanceof Int32Array)m=n.INT;else if(u instanceof Int8Array)m=n.BYTE;else if(u instanceof Uint8Array)m=n.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)m=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:f,type:m,bytesPerElement:u.BYTES_PER_ELEMENT,version:o.version,size:d}}function i(o,l,u){const c=l.array,d=l.updateRanges;if(n.bindBuffer(u,o),d.length===0)n.bufferSubData(u,0,c);else{d.sort((m,y)=>m.start-y.start);let f=0;for(let m=1;m<d.length;m++){const y=d[f],_=d[m];_.start<=y.start+y.count+1?y.count=Math.max(y.count,_.start+_.count-y.start):(++f,d[f]=_)}d.length=f+1;for(let m=0,y=d.length;m<y;m++){const _=d[m];n.bufferSubData(u,_.start*c.BYTES_PER_ELEMENT,c,_.start,_.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(n.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const c=e.get(o);(!c||c.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const u=e.get(o);if(u===void 0)e.set(o,t(o,l));else if(u.version<o.version){if(u.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(u.buffer,o,l),u.version=o.version}}return{get:r,remove:s,update:a}}var s2e=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,a2e=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,o2e=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,l2e=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,u2e=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,c2e=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,h2e=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,d2e=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,f2e=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,p2e=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,m2e=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,g2e=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,y2e=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,v2e=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,x2e=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,b2e=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,_2e=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,S2e=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,M2e=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,A2e=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,T2e=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,C2e=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,w2e=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,E2e=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,R2e=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,P2e=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,D2e=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,N2e=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,B2e=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,F2e=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,L2e="gl_FragColor = linearToOutputTexel( gl_FragColor );",I2e=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,G2e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,O2e=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,U2e=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,k2e=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,z2e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,V2e=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,H2e=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,X2e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,W2e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Z2e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,j2e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Y2e=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,K2e=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,$2e=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,J2e=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,q2e=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Q2e=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,eFe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,tFe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,nFe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,iFe=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,rFe=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,sFe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,aFe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,oFe=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,lFe=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,uFe=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,cFe=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,hFe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,dFe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,fFe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,pFe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,mFe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,gFe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,yFe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,vFe=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,xFe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,bFe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,_Fe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,SFe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,MFe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,AFe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,TFe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,CFe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,wFe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,EFe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,RFe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,PFe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,DFe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,NFe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,BFe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,FFe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,LFe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,IFe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,GFe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,OFe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,UFe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,kFe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadow = step( depth, dp );
			#else
				shadow = step( dp, depth );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,zFe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,VFe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,HFe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,XFe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,WFe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,ZFe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,jFe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,YFe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,KFe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,$Fe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,JFe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,qFe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,QFe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,eLe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,tLe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,nLe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,iLe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const rLe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,sLe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,aLe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,oLe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,lLe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,uLe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cLe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,hLe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,dLe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fLe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,pLe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,mLe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,gLe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,yLe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vLe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,xLe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bLe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_Le=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,SLe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,MLe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ALe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,TLe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,CLe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wLe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ELe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,RLe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PLe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,DLe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NLe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,BLe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,FLe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LLe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ILe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,GLe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,dr={alphahash_fragment:s2e,alphahash_pars_fragment:a2e,alphamap_fragment:o2e,alphamap_pars_fragment:l2e,alphatest_fragment:u2e,alphatest_pars_fragment:c2e,aomap_fragment:h2e,aomap_pars_fragment:d2e,batching_pars_vertex:f2e,batching_vertex:p2e,begin_vertex:m2e,beginnormal_vertex:g2e,bsdfs:y2e,iridescence_fragment:v2e,bumpmap_pars_fragment:x2e,clipping_planes_fragment:b2e,clipping_planes_pars_fragment:_2e,clipping_planes_pars_vertex:S2e,clipping_planes_vertex:M2e,color_fragment:A2e,color_pars_fragment:T2e,color_pars_vertex:C2e,color_vertex:w2e,common:E2e,cube_uv_reflection_fragment:R2e,defaultnormal_vertex:P2e,displacementmap_pars_vertex:D2e,displacementmap_vertex:N2e,emissivemap_fragment:B2e,emissivemap_pars_fragment:F2e,colorspace_fragment:L2e,colorspace_pars_fragment:I2e,envmap_fragment:G2e,envmap_common_pars_fragment:O2e,envmap_pars_fragment:U2e,envmap_pars_vertex:k2e,envmap_physical_pars_fragment:J2e,envmap_vertex:z2e,fog_vertex:V2e,fog_pars_vertex:H2e,fog_fragment:X2e,fog_pars_fragment:W2e,gradientmap_pars_fragment:Z2e,lightmap_pars_fragment:j2e,lights_lambert_fragment:Y2e,lights_lambert_pars_fragment:K2e,lights_pars_begin:$2e,lights_toon_fragment:q2e,lights_toon_pars_fragment:Q2e,lights_phong_fragment:eFe,lights_phong_pars_fragment:tFe,lights_physical_fragment:nFe,lights_physical_pars_fragment:iFe,lights_fragment_begin:rFe,lights_fragment_maps:sFe,lights_fragment_end:aFe,logdepthbuf_fragment:oFe,logdepthbuf_pars_fragment:lFe,logdepthbuf_pars_vertex:uFe,logdepthbuf_vertex:cFe,map_fragment:hFe,map_pars_fragment:dFe,map_particle_fragment:fFe,map_particle_pars_fragment:pFe,metalnessmap_fragment:mFe,metalnessmap_pars_fragment:gFe,morphinstance_vertex:yFe,morphcolor_vertex:vFe,morphnormal_vertex:xFe,morphtarget_pars_vertex:bFe,morphtarget_vertex:_Fe,normal_fragment_begin:SFe,normal_fragment_maps:MFe,normal_pars_fragment:AFe,normal_pars_vertex:TFe,normal_vertex:CFe,normalmap_pars_fragment:wFe,clearcoat_normal_fragment_begin:EFe,clearcoat_normal_fragment_maps:RFe,clearcoat_pars_fragment:PFe,iridescence_pars_fragment:DFe,opaque_fragment:NFe,packing:BFe,premultiplied_alpha_fragment:FFe,project_vertex:LFe,dithering_fragment:IFe,dithering_pars_fragment:GFe,roughnessmap_fragment:OFe,roughnessmap_pars_fragment:UFe,shadowmap_pars_fragment:kFe,shadowmap_pars_vertex:zFe,shadowmap_vertex:VFe,shadowmask_pars_fragment:HFe,skinbase_vertex:XFe,skinning_pars_vertex:WFe,skinning_vertex:ZFe,skinnormal_vertex:jFe,specularmap_fragment:YFe,specularmap_pars_fragment:KFe,tonemapping_fragment:$Fe,tonemapping_pars_fragment:JFe,transmission_fragment:qFe,transmission_pars_fragment:QFe,uv_pars_fragment:eLe,uv_pars_vertex:tLe,uv_vertex:nLe,worldpos_vertex:iLe,background_vert:rLe,background_frag:sLe,backgroundCube_vert:aLe,backgroundCube_frag:oLe,cube_vert:lLe,cube_frag:uLe,depth_vert:cLe,depth_frag:hLe,distance_vert:dLe,distance_frag:fLe,equirect_vert:pLe,equirect_frag:mLe,linedashed_vert:gLe,linedashed_frag:yLe,meshbasic_vert:vLe,meshbasic_frag:xLe,meshlambert_vert:bLe,meshlambert_frag:_Le,meshmatcap_vert:SLe,meshmatcap_frag:MLe,meshnormal_vert:ALe,meshnormal_frag:TLe,meshphong_vert:CLe,meshphong_frag:wLe,meshphysical_vert:ELe,meshphysical_frag:RLe,meshtoon_vert:PLe,meshtoon_frag:DLe,points_vert:NLe,points_frag:BLe,shadow_vert:FLe,shadow_frag:LLe,sprite_vert:ILe,sprite_frag:GLe},Vn={common:{diffuse:{value:new en(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Li},alphaMap:{value:null},alphaMapTransform:{value:new Li},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Li}},envmap:{envMap:{value:null},envMapRotation:{value:new Li},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Li}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Li}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Li},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Li},normalScale:{value:new rt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Li},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Li}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Li}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Li}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new en(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new en(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Li},alphaTest:{value:0},uvTransform:{value:new Li}},sprite:{diffuse:{value:new en(16777215)},opacity:{value:1},center:{value:new rt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Li},alphaMap:{value:null},alphaMapTransform:{value:new Li},alphaTest:{value:0}}},Ff={basic:{uniforms:zu([Vn.common,Vn.specularmap,Vn.envmap,Vn.aomap,Vn.lightmap,Vn.fog]),vertexShader:dr.meshbasic_vert,fragmentShader:dr.meshbasic_frag},lambert:{uniforms:zu([Vn.common,Vn.specularmap,Vn.envmap,Vn.aomap,Vn.lightmap,Vn.emissivemap,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.fog,Vn.lights,{emissive:{value:new en(0)}}]),vertexShader:dr.meshlambert_vert,fragmentShader:dr.meshlambert_frag},phong:{uniforms:zu([Vn.common,Vn.specularmap,Vn.envmap,Vn.aomap,Vn.lightmap,Vn.emissivemap,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.fog,Vn.lights,{emissive:{value:new en(0)},specular:{value:new en(1118481)},shininess:{value:30}}]),vertexShader:dr.meshphong_vert,fragmentShader:dr.meshphong_frag},standard:{uniforms:zu([Vn.common,Vn.envmap,Vn.aomap,Vn.lightmap,Vn.emissivemap,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.roughnessmap,Vn.metalnessmap,Vn.fog,Vn.lights,{emissive:{value:new en(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:dr.meshphysical_vert,fragmentShader:dr.meshphysical_frag},toon:{uniforms:zu([Vn.common,Vn.aomap,Vn.lightmap,Vn.emissivemap,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.gradientmap,Vn.fog,Vn.lights,{emissive:{value:new en(0)}}]),vertexShader:dr.meshtoon_vert,fragmentShader:dr.meshtoon_frag},matcap:{uniforms:zu([Vn.common,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.fog,{matcap:{value:null}}]),vertexShader:dr.meshmatcap_vert,fragmentShader:dr.meshmatcap_frag},points:{uniforms:zu([Vn.points,Vn.fog]),vertexShader:dr.points_vert,fragmentShader:dr.points_frag},dashed:{uniforms:zu([Vn.common,Vn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:dr.linedashed_vert,fragmentShader:dr.linedashed_frag},depth:{uniforms:zu([Vn.common,Vn.displacementmap]),vertexShader:dr.depth_vert,fragmentShader:dr.depth_frag},normal:{uniforms:zu([Vn.common,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,{opacity:{value:1}}]),vertexShader:dr.meshnormal_vert,fragmentShader:dr.meshnormal_frag},sprite:{uniforms:zu([Vn.sprite,Vn.fog]),vertexShader:dr.sprite_vert,fragmentShader:dr.sprite_frag},background:{uniforms:{uvTransform:{value:new Li},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:dr.background_vert,fragmentShader:dr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Li}},vertexShader:dr.backgroundCube_vert,fragmentShader:dr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:dr.cube_vert,fragmentShader:dr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:dr.equirect_vert,fragmentShader:dr.equirect_frag},distance:{uniforms:zu([Vn.common,Vn.displacementmap,{referencePosition:{value:new re},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:dr.distance_vert,fragmentShader:dr.distance_frag},shadow:{uniforms:zu([Vn.lights,Vn.fog,{color:{value:new en(0)},opacity:{value:1}}]),vertexShader:dr.shadow_vert,fragmentShader:dr.shadow_frag}};Ff.physical={uniforms:zu([Ff.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Li},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Li},clearcoatNormalScale:{value:new rt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Li},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Li},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Li},sheen:{value:0},sheenColor:{value:new en(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Li},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Li},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Li},transmissionSamplerSize:{value:new rt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Li},attenuationDistance:{value:0},attenuationColor:{value:new en(0)},specularColor:{value:new en(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Li},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Li},anisotropyVector:{value:new rt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Li}}]),vertexShader:dr.meshphysical_vert,fragmentShader:dr.meshphysical_frag};const vD={r:0,b:0,g:0},q1=new Mu,OLe=new Mn;function ULe(n,e,t,i,r,s,a){const o=new en(0);let l=s===!0?0:1,u,c,d=null,f=0,m=null;function y(w){let T=w.isScene===!0?w.background:null;return T&&T.isTexture&&(T=(w.backgroundBlurriness>0?t:e).get(T)),T}function _(w){let T=!1;const E=y(w);E===null?b(o,l):E&&E.isColor&&(b(E,1),T=!0);const R=n.xr.getEnvironmentBlendMode();R==="additive"?i.buffers.color.setClear(0,0,0,1,a):R==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,a),(n.autoClear||T)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function S(w,T){const E=y(T);E&&(E.isCubeTexture||E.mapping===Am)?(c===void 0&&(c=new Fr(new Id(1,1,1),new Ds({name:"BackgroundCubeMaterial",uniforms:yM(Ff.backgroundCube.uniforms),vertexShader:Ff.backgroundCube.vertexShader,fragmentShader:Ff.backgroundCube.fragmentShader,side:Er,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(R,P,I){this.matrixWorld.copyPosition(I.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),q1.copy(T.backgroundRotation),q1.x*=-1,q1.y*=-1,q1.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(q1.y*=-1,q1.z*=-1),c.material.uniforms.envMap.value=E,c.material.uniforms.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=T.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=T.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(OLe.makeRotationFromEuler(q1)),c.material.toneMapped=di.getTransfer(E.colorSpace)!==Hn,(d!==E||f!==E.version||m!==n.toneMapping)&&(c.material.needsUpdate=!0,d=E,f=E.version,m=n.toneMapping),c.layers.enableAll(),w.unshift(c,c.geometry,c.material,0,0,null)):E&&E.isTexture&&(u===void 0&&(u=new Fr(new ap(2,2),new Ds({name:"BackgroundMaterial",uniforms:yM(Ff.background.uniforms),vertexShader:Ff.background.vertexShader,fragmentShader:Ff.background.fragmentShader,side:wo,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(u)),u.material.uniforms.t2D.value=E,u.material.uniforms.backgroundIntensity.value=T.backgroundIntensity,u.material.toneMapped=di.getTransfer(E.colorSpace)!==Hn,E.matrixAutoUpdate===!0&&E.updateMatrix(),u.material.uniforms.uvTransform.value.copy(E.matrix),(d!==E||f!==E.version||m!==n.toneMapping)&&(u.material.needsUpdate=!0,d=E,f=E.version,m=n.toneMapping),u.layers.enableAll(),w.unshift(u,u.geometry,u.material,0,0,null))}function b(w,T){w.getRGB(vD,ate(n)),i.buffers.color.setClear(vD.r,vD.g,vD.b,T,a)}function M(){c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return o},setClearColor:function(w,T=1){o.set(w),l=T,b(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(w){l=w,b(o,l)},render:_,addToRenderList:S,dispose:M}}function kLe(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=f(null);let s=r,a=!1;function o(N,U,V,W,K){let q=!1;const j=d(W,V,U);s!==j&&(s=j,u(s.object)),q=m(N,W,V,K),q&&y(N,W,V,K),K!==null&&e.update(K,n.ELEMENT_ARRAY_BUFFER),(q||a)&&(a=!1,T(N,U,V,W),K!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(K).buffer))}function l(){return n.createVertexArray()}function u(N){return n.bindVertexArray(N)}function c(N){return n.deleteVertexArray(N)}function d(N,U,V){const W=V.wireframe===!0;let K=i[N.id];K===void 0&&(K={},i[N.id]=K);let q=K[U.id];q===void 0&&(q={},K[U.id]=q);let j=q[W];return j===void 0&&(j=f(l()),q[W]=j),j}function f(N){const U=[],V=[],W=[];for(let K=0;K<t;K++)U[K]=0,V[K]=0,W[K]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:V,attributeDivisors:W,object:N,attributes:{},index:null}}function m(N,U,V,W){const K=s.attributes,q=U.attributes;let j=0;const te=V.getAttributes();for(const he in te)if(te[he].location>=0){const Be=K[he];let ue=q[he];if(ue===void 0&&(he==="instanceMatrix"&&N.instanceMatrix&&(ue=N.instanceMatrix),he==="instanceColor"&&N.instanceColor&&(ue=N.instanceColor)),Be===void 0||Be.attribute!==ue||ue&&Be.data!==ue.data)return!0;j++}return s.attributesNum!==j||s.index!==W}function y(N,U,V,W){const K={},q=U.attributes;let j=0;const te=V.getAttributes();for(const he in te)if(te[he].location>=0){let Be=q[he];Be===void 0&&(he==="instanceMatrix"&&N.instanceMatrix&&(Be=N.instanceMatrix),he==="instanceColor"&&N.instanceColor&&(Be=N.instanceColor));const ue={};ue.attribute=Be,Be&&Be.data&&(ue.data=Be.data),K[he]=ue,j++}s.attributes=K,s.attributesNum=j,s.index=W}function _(){const N=s.newAttributes;for(let U=0,V=N.length;U<V;U++)N[U]=0}function S(N){b(N,0)}function b(N,U){const V=s.newAttributes,W=s.enabledAttributes,K=s.attributeDivisors;V[N]=1,W[N]===0&&(n.enableVertexAttribArray(N),W[N]=1),K[N]!==U&&(n.vertexAttribDivisor(N,U),K[N]=U)}function M(){const N=s.newAttributes,U=s.enabledAttributes;for(let V=0,W=U.length;V<W;V++)U[V]!==N[V]&&(n.disableVertexAttribArray(V),U[V]=0)}function w(N,U,V,W,K,q,j){j===!0?n.vertexAttribIPointer(N,U,V,K,q):n.vertexAttribPointer(N,U,V,W,K,q)}function T(N,U,V,W){_();const K=W.attributes,q=V.getAttributes(),j=U.defaultAttributeValues;for(const te in q){const he=q[te];if(he.location>=0){let _e=K[te];if(_e===void 0&&(te==="instanceMatrix"&&N.instanceMatrix&&(_e=N.instanceMatrix),te==="instanceColor"&&N.instanceColor&&(_e=N.instanceColor)),_e!==void 0){const Be=_e.normalized,ue=_e.itemSize,ce=e.get(_e);if(ce===void 0)continue;const Ce=ce.buffer,Oe=ce.type,nt=ce.bytesPerElement,Ae=Oe===n.INT||Oe===n.UNSIGNED_INT||_e.gpuType===Ao;if(_e.isInterleavedBufferAttribute){const Ye=_e.data,ft=Ye.stride,ze=_e.offset;if(Ye.isInstancedInterleavedBuffer){for(let ot=0;ot<he.locationSize;ot++)b(he.location+ot,Ye.meshPerAttribute);N.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=Ye.meshPerAttribute*Ye.count)}else for(let ot=0;ot<he.locationSize;ot++)S(he.location+ot);n.bindBuffer(n.ARRAY_BUFFER,Ce);for(let ot=0;ot<he.locationSize;ot++)w(he.location+ot,ue/he.locationSize,Oe,Be,ft*nt,(ze+ue/he.locationSize*ot)*nt,Ae)}else{if(_e.isInstancedBufferAttribute){for(let Ye=0;Ye<he.locationSize;Ye++)b(he.location+Ye,_e.meshPerAttribute);N.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=_e.meshPerAttribute*_e.count)}else for(let Ye=0;Ye<he.locationSize;Ye++)S(he.location+Ye);n.bindBuffer(n.ARRAY_BUFFER,Ce);for(let Ye=0;Ye<he.locationSize;Ye++)w(he.location+Ye,ue/he.locationSize,Oe,Be,ue*nt,ue/he.locationSize*Ye*nt,Ae)}}else if(j!==void 0){const Be=j[te];if(Be!==void 0)switch(Be.length){case 2:n.vertexAttrib2fv(he.location,Be);break;case 3:n.vertexAttrib3fv(he.location,Be);break;case 4:n.vertexAttrib4fv(he.location,Be);break;default:n.vertexAttrib1fv(he.location,Be)}}}}M()}function E(){I();for(const N in i){const U=i[N];for(const V in U){const W=U[V];for(const K in W)c(W[K].object),delete W[K];delete U[V]}delete i[N]}}function R(N){if(i[N.id]===void 0)return;const U=i[N.id];for(const V in U){const W=U[V];for(const K in W)c(W[K].object),delete W[K];delete U[V]}delete i[N.id]}function P(N){for(const U in i){const V=i[U];if(V[N.id]===void 0)continue;const W=V[N.id];for(const K in W)c(W[K].object),delete W[K];delete V[N.id]}}function I(){B(),a=!0,s!==r&&(s=r,u(s.object))}function B(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:o,reset:I,resetDefaultState:B,dispose:E,releaseStatesOfGeometry:R,releaseStatesOfProgram:P,initAttributes:_,enableAttribute:S,disableUnusedAttributes:M}}function zLe(n,e,t){let i;function r(u){i=u}function s(u,c){n.drawArrays(i,u,c),t.update(c,i,1)}function a(u,c,d){d!==0&&(n.drawArraysInstanced(i,u,c,d),t.update(c,i,d))}function o(u,c,d){if(d===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,u,0,c,0,d);let m=0;for(let y=0;y<d;y++)m+=c[y];t.update(m,i,1)}function l(u,c,d,f){if(d===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let y=0;y<u.length;y++)a(u[y],c[y],f[y]);else{m.multiDrawArraysInstancedWEBGL(i,u,0,c,0,f,0,d);let y=0;for(let _=0;_<d;_++)y+=c[_]*f[_];t.update(y,i,1)}}this.setMode=r,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function VLe(n,e,t,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const P=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(P.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(P){return!(P!==Vr&&i.convert(P)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(P){const I=P===zi&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(P!==br&&i.convert(P)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&P!==wr&&!I)}function l(P){if(P==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";P="mediump"}return P==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const c=l(u);c!==u&&(mt("WebGLRenderer:",u,"not supported, using",c,"instead."),u=c);const d=t.logarithmicDepthBuffer===!0,f=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),m=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),y=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_TEXTURE_SIZE),S=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),b=n.getParameter(n.MAX_VERTEX_ATTRIBS),M=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),w=n.getParameter(n.MAX_VARYING_VECTORS),T=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),E=n.getParameter(n.MAX_SAMPLES),R=n.getParameter(n.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:u,logarithmicDepthBuffer:d,reversedDepthBuffer:f,maxTextures:m,maxVertexTextures:y,maxTextureSize:_,maxCubemapSize:S,maxAttributes:b,maxVertexUniforms:M,maxVaryings:w,maxFragmentUniforms:T,maxSamples:E,samples:R}}function HLe(n){const e=this;let t=null,i=0,r=!1,s=!1;const a=new Xl,o=new Li,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f){const m=d.length!==0||f||i!==0||r;return r=f,i=d.length,m},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,f){t=c(d,f,0)},this.setState=function(d,f,m){const y=d.clippingPlanes,_=d.clipIntersection,S=d.clipShadows,b=n.get(d);if(!r||y===null||y.length===0||s&&!S)s?c(null):u();else{const M=s?0:i,w=M*4;let T=b.clippingState||null;l.value=T,T=c(y,f,w,m);for(let E=0;E!==w;++E)T[E]=t[E];b.clippingState=T,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=M}};function u(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(d,f,m,y){const _=d!==null?d.length:0;let S=null;if(_!==0){if(S=l.value,y!==!0||S===null){const b=m+_*4,M=f.matrixWorldInverse;o.getNormalMatrix(M),(S===null||S.length<b)&&(S=new Float32Array(b));for(let w=0,T=m;w!==_;++w,T+=4)a.copy(d[w]).applyMatrix4(M,o),a.normal.toArray(S,T),S[T+3]=a.constant}l.value=S,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,S}}function XLe(n){let e=new WeakMap;function t(a,o){return o===Mm?a.mapping=_u:o===h0&&(a.mapping=wh),a}function i(a){if(a&&a.isTexture){const o=a.mapping;if(o===Mm||o===h0)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const u=new jM(l.height);return u.fromEquirectangularTexture(n,a),e.set(a,u),a.addEventListener("dispose",r),t(u.texture,a.mapping)}else return null}}return a}function r(a){const o=a.target;o.removeEventListener("dispose",r);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}const Wy=4,_Z=[.125,.215,.35,.446,.526,.582],fx=20,WLe=256,eC=new Tl,SZ=new en;let sO=null,aO=0,oO=0,lO=!1;const ZLe=new re;let Y5=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,i=.1,r=100,s={}){const{size:a=256,position:o=ZLe}=s;sO=this._renderer.getRenderTarget(),aO=this._renderer.getActiveCubeFace(),oO=this._renderer.getActiveMipmapLevel(),lO=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,i,r,l,o),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=TZ(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=AZ(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(sO,aO,oO),this._renderer.xr.enabled=lO,e.scissorTest=!1,sS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===_u||e.mapping===wh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),sO=this._renderer.getRenderTarget(),aO=this._renderer.getActiveCubeFace(),oO=this._renderer.getActiveMipmapLevel(),lO=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Jn,minFilter:Jn,generateMipmaps:!1,type:zi,format:Vr,colorSpace:Su,depthBuffer:!1},r=MZ(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=MZ(e,t,i);const{_lodMax:s}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=jLe(s)),this._blurMaterial=KLe(s,e,t),this._ggxMaterial=YLe(s,e,t)}return r}_compileMaterial(e){const t=new Fr(new wi,e);this._renderer.compile(t,eC)}_sceneToCubeUV(e,t,i,r,s){const l=new ds(90,1,t,i),u=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],d=this._renderer,f=d.autoClear,m=d.toneMapping;d.getClearColor(SZ),d.toneMapping=ho,d.autoClear=!1,d.state.buffers.depth.getReversed()&&(d.setRenderTarget(r),d.clearDepth(),d.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new Fr(new Id,new La({name:"PMREM.Background",side:Er,depthWrite:!1,depthTest:!1})));const _=this._backgroundBox,S=_.material;let b=!1;const M=e.background;M?M.isColor&&(S.color.copy(M),e.background=null,b=!0):(S.color.copy(SZ),b=!0);for(let w=0;w<6;w++){const T=w%3;T===0?(l.up.set(0,u[w],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+c[w],s.y,s.z)):T===1?(l.up.set(0,0,u[w]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+c[w],s.z)):(l.up.set(0,u[w],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+c[w]));const E=this._cubeSize;sS(r,T*E,w>2?E:0,E,E),d.setRenderTarget(r),b&&d.render(_,l),d.render(e,l)}d.toneMapping=m,d.autoClear=f,e.background=M}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===_u||e.mapping===wh;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=TZ()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=AZ());const s=r?this._cubemapMaterial:this._equirectMaterial,a=this._lodMeshes[0];a.material=s;const o=s.uniforms;o.envMap.value=e;const l=this._cubeSize;sS(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(a,eC)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let s=1;s<r;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=i}_applyGGXFilter(e,t,i){const r=this._renderer,s=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[i];o.material=a;const l=a.uniforms,u=i/(this._lodMeshes.length-1),c=t/(this._lodMeshes.length-1),d=Math.sqrt(u*u-c*c),f=0+u*1.25,m=d*f,{_lodMax:y}=this,_=this._sizeLods[i],S=3*_*(i>y-Wy?i-y+Wy:0),b=4*(this._cubeSize-_);l.envMap.value=e.texture,l.roughness.value=m,l.mipInt.value=y-t,sS(s,S,b,3*_,2*_),r.setRenderTarget(s),r.render(o,eC),l.envMap.value=s.texture,l.roughness.value=0,l.mipInt.value=y-i,sS(e,S,b,3*_,2*_),r.setRenderTarget(e),r.render(o,eC)}_blur(e,t,i,r,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",s),this._halfBlur(a,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,a,o){const l=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&Tt("blur direction must be either latitudinal or longitudinal!");const c=3,d=this._lodMeshes[r];d.material=u;const f=u.uniforms,m=this._sizeLods[i]-1,y=isFinite(s)?Math.PI/(2*m):2*Math.PI/(2*fx-1),_=s/y,S=isFinite(s)?1+Math.floor(c*_):fx;S>fx&&mt(`sigmaRadians, ${s}, is too large and will clip, as it requested ${S} samples when the maximum is set to ${fx}`);const b=[];let M=0;for(let P=0;P<fx;++P){const I=P/_,B=Math.exp(-I*I/2);b.push(B),P===0?M+=B:P<S&&(M+=2*B)}for(let P=0;P<b.length;P++)b[P]=b[P]/M;f.envMap.value=e.texture,f.samples.value=S,f.weights.value=b,f.latitudinal.value=a==="latitudinal",o&&(f.poleAxis.value=o);const{_lodMax:w}=this;f.dTheta.value=y,f.mipInt.value=w-i;const T=this._sizeLods[r],E=3*T*(r>w-Wy?r-w+Wy:0),R=4*(this._cubeSize-T);sS(t,E,R,3*T,2*T),l.setRenderTarget(t),l.render(d,eC)}};function jLe(n){const e=[],t=[],i=[];let r=n;const s=n-Wy+1+_Z.length;for(let a=0;a<s;a++){const o=Math.pow(2,r);e.push(o);let l=1/o;a>n-Wy?l=_Z[a-n+Wy-1]:a===0&&(l=0),t.push(l);const u=1/(o-2),c=-u,d=1+u,f=[c,c,d,c,d,d,c,c,d,d,c,d],m=6,y=6,_=3,S=2,b=1,M=new Float32Array(_*y*m),w=new Float32Array(S*y*m),T=new Float32Array(b*y*m);for(let R=0;R<m;R++){const P=R%3*2/3-1,I=R>2?0:-1,B=[P,I,0,P+2/3,I,0,P+2/3,I+1,0,P,I,0,P+2/3,I+1,0,P,I+1,0];M.set(B,_*y*R),w.set(f,S*y*R);const N=[R,R,R,R,R,R];T.set(N,b*y*R)}const E=new wi;E.setAttribute("position",new Gi(M,_)),E.setAttribute("uv",new Gi(w,S)),E.setAttribute("faceIndex",new Gi(T,b)),i.push(new Fr(E,null)),r>Wy&&r--}return{lodMeshes:i,sizeLods:e,sigmas:t}}function MZ(n,e,t){const i=new Nr(n,e,t);return i.texture.mapping=Am,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function sS(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function YLe(n,e,t){return new Ds({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:WLe,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:wF(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:Oa,depthTest:!1,depthWrite:!1})}function KLe(n,e,t){const i=new Float32Array(fx),r=new re(0,1,0);return new Ds({name:"SphericalGaussianBlur",defines:{n:fx,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:wF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Oa,depthTest:!1,depthWrite:!1})}function AZ(){return new Ds({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:wF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Oa,depthTest:!1,depthWrite:!1})}function TZ(){return new Ds({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:wF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Oa,depthTest:!1,depthWrite:!1})}function wF(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function $Le(n){let e=new WeakMap,t=null;function i(o){if(o&&o.isTexture){const l=o.mapping,u=l===Mm||l===h0,c=l===_u||l===wh;if(u||c){let d=e.get(o);const f=d!==void 0?d.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==f)return t===null&&(t=new Y5(n)),d=u?t.fromEquirectangular(o,d):t.fromCubemap(o,d),d.texture.pmremVersion=o.pmremVersion,e.set(o,d),d.texture;if(d!==void 0)return d.texture;{const m=o.image;return u&&m&&m.height>0||c&&m&&r(m)?(t===null&&(t=new Y5(n)),d=u?t.fromEquirectangular(o):t.fromCubemap(o),d.texture.pmremVersion=o.pmremVersion,e.set(o,d),o.addEventListener("dispose",s),d.texture):null}}}return o}function r(o){let l=0;const u=6;for(let c=0;c<u;c++)o[c]!==void 0&&l++;return l===u}function s(o){const l=o.target;l.removeEventListener("dispose",s);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:a}}function JLe(n){const e={};function t(i){if(e[i]!==void 0)return e[i];const r=n.getExtension(i);return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&hs("WebGLRenderer: "+i+" extension not supported."),r}}}function qLe(n,e,t,i){const r={},s=new WeakMap;function a(d){const f=d.target;f.index!==null&&e.remove(f.index);for(const y in f.attributes)e.remove(f.attributes[y]);f.removeEventListener("dispose",a),delete r[f.id];const m=s.get(f);m&&(e.remove(m),s.delete(f)),i.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function o(d,f){return r[f.id]===!0||(f.addEventListener("dispose",a),r[f.id]=!0,t.memory.geometries++),f}function l(d){const f=d.attributes;for(const m in f)e.update(f[m],n.ARRAY_BUFFER)}function u(d){const f=[],m=d.index,y=d.attributes.position;let _=0;if(m!==null){const M=m.array;_=m.version;for(let w=0,T=M.length;w<T;w+=3){const E=M[w+0],R=M[w+1],P=M[w+2];f.push(E,R,R,P,P,E)}}else if(y!==void 0){const M=y.array;_=y.version;for(let w=0,T=M.length/3-1;w<T;w+=3){const E=w+0,R=w+1,P=w+2;f.push(E,R,R,P,P,E)}}else return;const S=new(I9(f)?cR:uR)(f,1);S.version=_;const b=s.get(d);b&&e.remove(b),s.set(d,S)}function c(d){const f=s.get(d);if(f){const m=d.index;m!==null&&f.version<m.version&&u(d)}else u(d);return s.get(d)}return{get:o,update:l,getWireframeAttribute:c}}function QLe(n,e,t){let i;function r(f){i=f}let s,a;function o(f){s=f.type,a=f.bytesPerElement}function l(f,m){n.drawElements(i,m,s,f*a),t.update(m,i,1)}function u(f,m,y){y!==0&&(n.drawElementsInstanced(i,m,s,f*a,y),t.update(m,i,y))}function c(f,m,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,m,0,s,f,0,y);let S=0;for(let b=0;b<y;b++)S+=m[b];t.update(S,i,1)}function d(f,m,y,_){if(y===0)return;const S=e.get("WEBGL_multi_draw");if(S===null)for(let b=0;b<f.length;b++)u(f[b]/a,m[b],_[b]);else{S.multiDrawElementsInstancedWEBGL(i,m,0,s,f,0,_,0,y);let b=0;for(let M=0;M<y;M++)b+=m[M]*_[M];t.update(b,i,1)}}this.setMode=r,this.setIndex=o,this.render=l,this.renderInstances=u,this.renderMultiDraw=c,this.renderMultiDrawInstances=d}function eIe(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,a,o){switch(t.calls++,a){case n.TRIANGLES:t.triangles+=o*(s/3);break;case n.LINES:t.lines+=o*(s/2);break;case n.LINE_STRIP:t.lines+=o*(s-1);break;case n.LINE_LOOP:t.lines+=o*s;break;case n.POINTS:t.points+=o*s;break;default:Tt("WebGLInfo: Unknown draw mode:",a);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function tIe(n,e,t){const i=new WeakMap,r=new si;function s(a,o,l){const u=a.morphTargetInfluences,c=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,d=c!==void 0?c.length:0;let f=i.get(o);if(f===void 0||f.count!==d){let B=function(){P.dispose(),i.delete(o),o.removeEventListener("dispose",B)};f!==void 0&&f.texture.dispose();const m=o.morphAttributes.position!==void 0,y=o.morphAttributes.normal!==void 0,_=o.morphAttributes.color!==void 0,S=o.morphAttributes.position||[],b=o.morphAttributes.normal||[],M=o.morphAttributes.color||[];let w=0;m===!0&&(w=1),y===!0&&(w=2),_===!0&&(w=3);let T=o.attributes.position.count*w,E=1;T>e.maxTextureSize&&(E=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const R=new Float32Array(T*E*4*d),P=new ZM(R,T,E,d);P.type=wr,P.needsUpdate=!0;const I=w*4;for(let N=0;N<d;N++){const U=S[N],V=b[N],W=M[N],K=T*E*4*N;for(let q=0;q<U.count;q++){const j=q*I;m===!0&&(r.fromBufferAttribute(U,q),R[K+j+0]=r.x,R[K+j+1]=r.y,R[K+j+2]=r.z,R[K+j+3]=0),y===!0&&(r.fromBufferAttribute(V,q),R[K+j+4]=r.x,R[K+j+5]=r.y,R[K+j+6]=r.z,R[K+j+7]=0),_===!0&&(r.fromBufferAttribute(W,q),R[K+j+8]=r.x,R[K+j+9]=r.y,R[K+j+10]=r.z,R[K+j+11]=W.itemSize===4?r.w:1)}}f={count:d,texture:P,size:new rt(T,E)},i.set(o,f),o.addEventListener("dispose",B)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",a.morphTexture,t);else{let m=0;for(let _=0;_<u.length;_++)m+=u[_];const y=o.morphTargetsRelative?1:1-m;l.getUniforms().setValue(n,"morphTargetBaseInfluence",y),l.getUniforms().setValue(n,"morphTargetInfluences",u)}l.getUniforms().setValue(n,"morphTargetsTexture",f.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",f.size)}return{update:s}}function nIe(n,e,t,i){let r=new WeakMap;function s(l){const u=i.render.frame,c=l.geometry,d=e.get(l,c);if(r.get(d)!==u&&(e.update(d),r.set(d,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),r.get(l)!==u&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,u))),l.isSkinnedMesh){const f=l.skeleton;r.get(f)!==u&&(f.update(),r.set(f,u))}return d}function a(){r=new WeakMap}function o(l){const u=l.target;u.removeEventListener("dispose",o),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:a}}const iIe={[$E]:"LINEAR_TONE_MAPPING",[JE]:"REINHARD_TONE_MAPPING",[qE]:"CINEON_TONE_MAPPING",[zM]:"ACES_FILMIC_TONE_MAPPING",[QE]:"AGX_TONE_MAPPING",[eR]:"NEUTRAL_TONE_MAPPING",[X2]:"CUSTOM_TONE_MAPPING"};function rIe(n,e,t,i,r){const s=new Nr(e,t,{type:n,depthBuffer:i,stencilBuffer:r}),a=new Nr(e,t,{type:zi,depthBuffer:!1,stencilBuffer:!1}),o=new wi;o.setAttribute("position",new qn([-1,3,0,-1,-1,0,3,-1,0],3)),o.setAttribute("uv",new qn([0,2,0,0,2,0],2));const l=new hF({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),u=new Fr(o,l),c=new Tl(-1,1,1,-1,0,1);let d=null,f=null,m=!1,y,_=null,S=[],b=!1;this.setSize=function(M,w){s.setSize(M,w),a.setSize(M,w);for(let T=0;T<S.length;T++){const E=S[T];E.setSize&&E.setSize(M,w)}},this.setEffects=function(M){S=M,b=S.length>0&&S[0].isRenderPass===!0;const w=s.width,T=s.height;for(let E=0;E<S.length;E++){const R=S[E];R.setSize&&R.setSize(w,T)}},this.begin=function(M,w){if(m||M.toneMapping===ho&&S.length===0)return!1;if(_=w,w!==null){const T=w.width,E=w.height;(s.width!==T||s.height!==E)&&this.setSize(T,E)}return b===!1&&M.setRenderTarget(s),y=M.toneMapping,M.toneMapping=ho,!0},this.hasRenderPass=function(){return b},this.end=function(M,w){M.toneMapping=y,m=!0;let T=s,E=a;for(let R=0;R<S.length;R++){const P=S[R];if(P.enabled!==!1&&(P.render(M,E,T,w),P.needsSwap!==!1)){const I=T;T=E,E=I}}if(d!==M.outputColorSpace||f!==M.toneMapping){d=M.outputColorSpace,f=M.toneMapping,l.defines={},di.getTransfer(d)===Hn&&(l.defines.SRGB_TRANSFER="");const R=iIe[f];R&&(l.defines[R]=""),l.needsUpdate=!0}l.uniforms.tDiffuse.value=T.texture,M.setRenderTarget(_),M.render(u,c),_=null,m=!1},this.isCompositing=function(){return m},this.dispose=function(){s.dispose(),a.dispose(),o.dispose(),l.dispose()}}const Kte=new pr,K5=new po(1,1),$te=new ZM,Jte=new lR,qte=new T0,CZ=[],wZ=[],EZ=new Float32Array(16),RZ=new Float32Array(9),PZ=new Float32Array(4);function sA(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=CZ[r];if(s===void 0&&(s=new Float32Array(r),CZ[r]=s),e!==0){i.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=t,n[a].toArray(s,o)}return s}function tl(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function nl(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function EF(n,e){let t=wZ[e];t===void 0&&(t=new Int32Array(e),wZ[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function sIe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function aIe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(tl(t,e))return;n.uniform2fv(this.addr,e),nl(t,e)}}function oIe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(tl(t,e))return;n.uniform3fv(this.addr,e),nl(t,e)}}function lIe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(tl(t,e))return;n.uniform4fv(this.addr,e),nl(t,e)}}function uIe(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(tl(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),nl(t,e)}else{if(tl(t,i))return;PZ.set(i),n.uniformMatrix2fv(this.addr,!1,PZ),nl(t,i)}}function cIe(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(tl(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),nl(t,e)}else{if(tl(t,i))return;RZ.set(i),n.uniformMatrix3fv(this.addr,!1,RZ),nl(t,i)}}function hIe(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(tl(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),nl(t,e)}else{if(tl(t,i))return;EZ.set(i),n.uniformMatrix4fv(this.addr,!1,EZ),nl(t,i)}}function dIe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function fIe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(tl(t,e))return;n.uniform2iv(this.addr,e),nl(t,e)}}function pIe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(tl(t,e))return;n.uniform3iv(this.addr,e),nl(t,e)}}function mIe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(tl(t,e))return;n.uniform4iv(this.addr,e),nl(t,e)}}function gIe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function yIe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(tl(t,e))return;n.uniform2uiv(this.addr,e),nl(t,e)}}function vIe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(tl(t,e))return;n.uniform3uiv(this.addr,e),nl(t,e)}}function xIe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(tl(t,e))return;n.uniform4uiv(this.addr,e),nl(t,e)}}function bIe(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);let s;this.type===n.SAMPLER_2D_SHADOW?(K5.compareFunction=t.isReversedDepthBuffer()?wb:Cb,s=K5):s=Kte,t.setTexture2D(e||s,r)}function _Ie(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||Jte,r)}function SIe(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||qte,r)}function MIe(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||$te,r)}function AIe(n){switch(n){case 5126:return sIe;case 35664:return aIe;case 35665:return oIe;case 35666:return lIe;case 35674:return uIe;case 35675:return cIe;case 35676:return hIe;case 5124:case 35670:return dIe;case 35667:case 35671:return fIe;case 35668:case 35672:return pIe;case 35669:case 35673:return mIe;case 5125:return gIe;case 36294:return yIe;case 36295:return vIe;case 36296:return xIe;case 35678:case 36198:case 36298:case 36306:case 35682:return bIe;case 35679:case 36299:case 36307:return _Ie;case 35680:case 36300:case 36308:case 36293:return SIe;case 36289:case 36303:case 36311:case 36292:return MIe}}function TIe(n,e){n.uniform1fv(this.addr,e)}function CIe(n,e){const t=sA(e,this.size,2);n.uniform2fv(this.addr,t)}function wIe(n,e){const t=sA(e,this.size,3);n.uniform3fv(this.addr,t)}function EIe(n,e){const t=sA(e,this.size,4);n.uniform4fv(this.addr,t)}function RIe(n,e){const t=sA(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function PIe(n,e){const t=sA(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function DIe(n,e){const t=sA(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function NIe(n,e){n.uniform1iv(this.addr,e)}function BIe(n,e){n.uniform2iv(this.addr,e)}function FIe(n,e){n.uniform3iv(this.addr,e)}function LIe(n,e){n.uniform4iv(this.addr,e)}function IIe(n,e){n.uniform1uiv(this.addr,e)}function GIe(n,e){n.uniform2uiv(this.addr,e)}function OIe(n,e){n.uniform3uiv(this.addr,e)}function UIe(n,e){n.uniform4uiv(this.addr,e)}function kIe(n,e,t){const i=this.cache,r=e.length,s=EF(t,r);tl(i,s)||(n.uniform1iv(this.addr,s),nl(i,s));let a;this.type===n.SAMPLER_2D_SHADOW?a=K5:a=Kte;for(let o=0;o!==r;++o)t.setTexture2D(e[o]||a,s[o])}function zIe(n,e,t){const i=this.cache,r=e.length,s=EF(t,r);tl(i,s)||(n.uniform1iv(this.addr,s),nl(i,s));for(let a=0;a!==r;++a)t.setTexture3D(e[a]||Jte,s[a])}function VIe(n,e,t){const i=this.cache,r=e.length,s=EF(t,r);tl(i,s)||(n.uniform1iv(this.addr,s),nl(i,s));for(let a=0;a!==r;++a)t.setTextureCube(e[a]||qte,s[a])}function HIe(n,e,t){const i=this.cache,r=e.length,s=EF(t,r);tl(i,s)||(n.uniform1iv(this.addr,s),nl(i,s));for(let a=0;a!==r;++a)t.setTexture2DArray(e[a]||$te,s[a])}function XIe(n){switch(n){case 5126:return TIe;case 35664:return CIe;case 35665:return wIe;case 35666:return EIe;case 35674:return RIe;case 35675:return PIe;case 35676:return DIe;case 5124:case 35670:return NIe;case 35667:case 35671:return BIe;case 35668:case 35672:return FIe;case 35669:case 35673:return LIe;case 5125:return IIe;case 36294:return GIe;case 36295:return OIe;case 36296:return UIe;case 35678:case 36198:case 36298:case 36306:case 35682:return kIe;case 35679:case 36299:case 36307:return zIe;case 35680:case 36300:case 36308:case 36293:return VIe;case 36289:case 36303:case 36311:case 36292:return HIe}}class WIe{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=AIe(t.type)}}class ZIe{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=XIe(t.type)}}class jIe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,a=r.length;s!==a;++s){const o=r[s];o.setValue(e,t[o.id],i)}}}const uO=/(\w+)(\])?(\[|\.)?/g;function DZ(n,e){n.seq.push(e),n.map[e.id]=e}function YIe(n,e,t){const i=n.name,r=i.length;for(uO.lastIndex=0;;){const s=uO.exec(i),a=uO.lastIndex;let o=s[1];const l=s[2]==="]",u=s[3];if(l&&(o=o|0),u===void 0||u==="["&&a+2===r){DZ(t,u===void 0?new WIe(o,n,e):new ZIe(o,n,e));break}else{let d=t.map[o];d===void 0&&(d=new jIe(o),DZ(t,d)),t=d}}}class VN{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let a=0;a<i;++a){const o=e.getActiveUniform(t,a),l=e.getUniformLocation(t,o.name);YIe(o,l,this)}const r=[],s=[];for(const a of this.seq)a.type===e.SAMPLER_2D_SHADOW||a.type===e.SAMPLER_CUBE_SHADOW||a.type===e.SAMPLER_2D_ARRAY_SHADOW?r.push(a):s.push(a);r.length>0&&(this.seq=r.concat(s))}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,a=t.length;s!==a;++s){const o=t[s],l=i[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const a=e[r];a.id in t&&i.push(a)}return i}}function NZ(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const KIe=37297;let $Ie=0;function JIe(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=r;a<s;a++){const o=a+1;i.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return i.join(`
`)}const BZ=new Li;function qIe(n){di._getMatrix(BZ,di.workingColorSpace,n);const e=`mat3( ${BZ.elements.map(t=>t.toFixed(4))} )`;switch(di.getTransfer(n)){case Iv:return[e,"LinearTransferOETF"];case Hn:return[e,"sRGBTransferOETF"];default:return mt("WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function FZ(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=(n.getShaderInfoLog(e)||"").trim();if(i&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const o=parseInt(a[1]);return t.toUpperCase()+`

`+s+`

`+JIe(n.getShaderSource(e),o)}else return s}function QIe(n,e){const t=qIe(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}const eGe={[$E]:"Linear",[JE]:"Reinhard",[qE]:"Cineon",[zM]:"ACESFilmic",[QE]:"AgX",[eR]:"Neutral",[X2]:"Custom"};function tGe(n,e){const t=eGe[e];return t===void 0?(mt("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+n+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const xD=new re;function nGe(){di.getLuminanceCoefficients(xD);const n=xD.x.toFixed(4),e=xD.y.toFixed(4),t=xD.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function iGe(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(qC).join(`
`)}function rGe(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function sGe(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),a=s.name;let o=1;s.type===n.FLOAT_MAT2&&(o=2),s.type===n.FLOAT_MAT3&&(o=3),s.type===n.FLOAT_MAT4&&(o=4),t[a]={type:s.type,location:n.getAttribLocation(e,a),locationSize:o}}return t}function qC(n){return n!==""}function LZ(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function IZ(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const aGe=/^[ \t]*#include +<([\w\d./]+)>/gm;function $5(n){return n.replace(aGe,lGe)}const oGe=new Map;function lGe(n,e){let t=dr[e];if(t===void 0){const i=oGe.get(e);if(i!==void 0)t=dr[i],mt('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return $5(t)}const uGe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function GZ(n){return n.replace(uGe,cGe)}function cGe(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function OZ(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}const hGe={[tv]:"SHADOWMAP_TYPE_PCF",[Ad]:"SHADOWMAP_TYPE_VSM"};function dGe(n){return hGe[n.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const fGe={[_u]:"ENVMAP_TYPE_CUBE",[wh]:"ENVMAP_TYPE_CUBE",[Am]:"ENVMAP_TYPE_CUBE_UV"};function pGe(n){return n.envMap===!1?"ENVMAP_TYPE_CUBE":fGe[n.envMapMode]||"ENVMAP_TYPE_CUBE"}const mGe={[wh]:"ENVMAP_MODE_REFRACTION"};function gGe(n){return n.envMap===!1?"ENVMAP_MODE_REFLECTION":mGe[n.envMapMode]||"ENVMAP_MODE_REFLECTION"}const yGe={[Sb]:"ENVMAP_BLENDING_MULTIPLY",[V2]:"ENVMAP_BLENDING_MIX",[H2]:"ENVMAP_BLENDING_ADD"};function vGe(n){return n.envMap===!1?"ENVMAP_BLENDING_NONE":yGe[n.combine]||"ENVMAP_BLENDING_NONE"}function xGe(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}function bGe(n,e,t,i){const r=n.getContext(),s=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=dGe(t),u=pGe(t),c=gGe(t),d=vGe(t),f=xGe(t),m=iGe(t),y=rGe(s),_=r.createProgram();let S,b,M=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(S=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(qC).join(`
`),S.length>0&&(S+=`
`),b=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(qC).join(`
`),b.length>0&&(b+=`
`)):(S=[OZ(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(qC).join(`
`),b=[OZ(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+c:"",t.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ho?"#define TONE_MAPPING":"",t.toneMapping!==ho?dr.tonemapping_pars_fragment:"",t.toneMapping!==ho?tGe("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",dr.colorspace_pars_fragment,QIe("linearToOutputTexel",t.outputColorSpace),nGe(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(qC).join(`
`)),a=$5(a),a=LZ(a,t),a=IZ(a,t),o=$5(o),o=LZ(o,t),o=IZ(o,t),a=GZ(a),o=GZ(o),t.isRawShaderMaterial!==!0&&(M=`#version 300 es
`,S=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+S,b=["#define varying in",t.glslVersion===CB?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===CB?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);const w=M+S+a,T=M+b+o,E=NZ(r,r.VERTEX_SHADER,w),R=NZ(r,r.FRAGMENT_SHADER,T);r.attachShader(_,E),r.attachShader(_,R),t.index0AttributeName!==void 0?r.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_);function P(U){if(n.debug.checkShaderErrors){const V=r.getProgramInfoLog(_)||"",W=r.getShaderInfoLog(E)||"",K=r.getShaderInfoLog(R)||"",q=V.trim(),j=W.trim(),te=K.trim();let he=!0,_e=!0;if(r.getProgramParameter(_,r.LINK_STATUS)===!1)if(he=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,_,E,R);else{const Be=FZ(r,E,"vertex"),ue=FZ(r,R,"fragment");Tt("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+`

Material Name: `+U.name+`
Material Type: `+U.type+`

Program Info Log: `+q+`
`+Be+`
`+ue)}else q!==""?mt("WebGLProgram: Program Info Log:",q):(j===""||te==="")&&(_e=!1);_e&&(U.diagnostics={runnable:he,programLog:q,vertexShader:{log:j,prefix:S},fragmentShader:{log:te,prefix:b}})}r.deleteShader(E),r.deleteShader(R),I=new VN(r,_),B=sGe(r,_)}let I;this.getUniforms=function(){return I===void 0&&P(this),I};let B;this.getAttributes=function(){return B===void 0&&P(this),B};let N=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return N===!1&&(N=r.getProgramParameter(_,KIe)),N},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=$Ie++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=E,this.fragmentShader=R,this}let _Ge=0;class SGe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return a.has(r)===!1&&(a.add(r),r.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new MGe(e),t.set(e,i)),i}}class MGe{constructor(e){this.id=_Ge++,this.code=e,this.usedTimes=0}}function AGe(n,e,t,i,r,s,a){const o=new cb,l=new SGe,u=new Set,c=[],d=new Map,f=r.logarithmicDepthBuffer;let m=r.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(B){return u.add(B),B===0?"uv":`uv${B}`}function S(B,N,U,V,W){const K=V.fog,q=W.geometry,j=B.isMeshStandardMaterial?V.environment:null,te=(B.isMeshStandardMaterial?t:e).get(B.envMap||j),he=te&&te.mapping===Am?te.image.height:null,_e=y[B.type];B.precision!==null&&(m=r.getMaxPrecision(B.precision),m!==B.precision&&mt("WebGLProgram.getParameters:",B.precision,"not supported, using",m,"instead."));const Be=q.morphAttributes.position||q.morphAttributes.normal||q.morphAttributes.color,ue=Be!==void 0?Be.length:0;let ce=0;q.morphAttributes.position!==void 0&&(ce=1),q.morphAttributes.normal!==void 0&&(ce=2),q.morphAttributes.color!==void 0&&(ce=3);let Ce,Oe,nt,Ae;if(_e){const ae=Ff[_e];Ce=ae.vertexShader,Oe=ae.fragmentShader}else Ce=B.vertexShader,Oe=B.fragmentShader,l.update(B),nt=l.getVertexShaderID(B),Ae=l.getFragmentShaderID(B);const Ye=n.getRenderTarget(),ft=n.state.buffers.depth.getReversed(),ze=W.isInstancedMesh===!0,ot=W.isBatchedMesh===!0,ut=!!B.map,Wt=!!B.matcap,It=!!te,ke=!!B.aoMap,je=!!B.lightMap,gt=!!B.bumpMap,yt=!!B.normalMap,ve=!!B.displacementMap,An=!!B.emissiveMap,cn=!!B.metalnessMap,In=!!B.roughnessMap,Zt=B.anisotropy>0,le=B.clearcoat>0,ee=B.dispersion>0,Re=B.iridescence>0,tt=B.sheen>0,et=B.transmission>0,at=Zt&&!!B.anisotropyMap,jt=le&&!!B.clearcoatMap,rn=le&&!!B.clearcoatNormalMap,Nn=le&&!!B.clearcoatRoughnessMap,Fn=Re&&!!B.iridescenceMap,Gt=Re&&!!B.iridescenceThicknessMap,st=tt&&!!B.sheenColorMap,Ft=tt&&!!B.sheenRoughnessMap,Se=!!B.specularMap,Je=!!B.specularColorMap,St=!!B.specularIntensityMap,Ne=et&&!!B.transmissionMap,it=et&&!!B.thicknessMap,kt=!!B.gradientMap,vn=!!B.alphaMap,Kt=B.alphaTest>0,Ut=!!B.alphaHash,z=!!B.extensions;let se=ho;B.toneMapped&&(Ye===null||Ye.isXRRenderTarget===!0)&&(se=n.toneMapping);const ne={shaderID:_e,shaderType:B.type,shaderName:B.name,vertexShader:Ce,fragmentShader:Oe,defines:B.defines,customVertexShaderID:nt,customFragmentShaderID:Ae,isRawShaderMaterial:B.isRawShaderMaterial===!0,glslVersion:B.glslVersion,precision:m,batching:ot,batchingColor:ot&&W._colorsTexture!==null,instancing:ze,instancingColor:ze&&W.instanceColor!==null,instancingMorph:ze&&W.morphTexture!==null,outputColorSpace:Ye===null?n.outputColorSpace:Ye.isXRRenderTarget===!0?Ye.texture.colorSpace:Su,alphaToCoverage:!!B.alphaToCoverage,map:ut,matcap:Wt,envMap:It,envMapMode:It&&te.mapping,envMapCubeUVHeight:he,aoMap:ke,lightMap:je,bumpMap:gt,normalMap:yt,displacementMap:ve,emissiveMap:An,normalMapObjectSpace:yt&&B.normalMapType===j2,normalMapTangentSpace:yt&&B.normalMapType===Fd,metalnessMap:cn,roughnessMap:In,anisotropy:Zt,anisotropyMap:at,clearcoat:le,clearcoatMap:jt,clearcoatNormalMap:rn,clearcoatRoughnessMap:Nn,dispersion:ee,iridescence:Re,iridescenceMap:Fn,iridescenceThicknessMap:Gt,sheen:tt,sheenColorMap:st,sheenRoughnessMap:Ft,specularMap:Se,specularColorMap:Je,specularIntensityMap:St,transmission:et,transmissionMap:Ne,thicknessMap:it,gradientMap:kt,opaque:B.transparent===!1&&B.blending===Al&&B.alphaToCoverage===!1,alphaMap:vn,alphaTest:Kt,alphaHash:Ut,combine:B.combine,mapUv:ut&&_(B.map.channel),aoMapUv:ke&&_(B.aoMap.channel),lightMapUv:je&&_(B.lightMap.channel),bumpMapUv:gt&&_(B.bumpMap.channel),normalMapUv:yt&&_(B.normalMap.channel),displacementMapUv:ve&&_(B.displacementMap.channel),emissiveMapUv:An&&_(B.emissiveMap.channel),metalnessMapUv:cn&&_(B.metalnessMap.channel),roughnessMapUv:In&&_(B.roughnessMap.channel),anisotropyMapUv:at&&_(B.anisotropyMap.channel),clearcoatMapUv:jt&&_(B.clearcoatMap.channel),clearcoatNormalMapUv:rn&&_(B.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Nn&&_(B.clearcoatRoughnessMap.channel),iridescenceMapUv:Fn&&_(B.iridescenceMap.channel),iridescenceThicknessMapUv:Gt&&_(B.iridescenceThicknessMap.channel),sheenColorMapUv:st&&_(B.sheenColorMap.channel),sheenRoughnessMapUv:Ft&&_(B.sheenRoughnessMap.channel),specularMapUv:Se&&_(B.specularMap.channel),specularColorMapUv:Je&&_(B.specularColorMap.channel),specularIntensityMapUv:St&&_(B.specularIntensityMap.channel),transmissionMapUv:Ne&&_(B.transmissionMap.channel),thicknessMapUv:it&&_(B.thicknessMap.channel),alphaMapUv:vn&&_(B.alphaMap.channel),vertexTangents:!!q.attributes.tangent&&(yt||Zt),vertexColors:B.vertexColors,vertexAlphas:B.vertexColors===!0&&!!q.attributes.color&&q.attributes.color.itemSize===4,pointsUvs:W.isPoints===!0&&!!q.attributes.uv&&(ut||vn),fog:!!K,useFog:B.fog===!0,fogExp2:!!K&&K.isFogExp2,flatShading:B.flatShading===!0&&B.wireframe===!1,sizeAttenuation:B.sizeAttenuation===!0,logarithmicDepthBuffer:f,reversedDepthBuffer:ft,skinning:W.isSkinnedMesh===!0,morphTargets:q.morphAttributes.position!==void 0,morphNormals:q.morphAttributes.normal!==void 0,morphColors:q.morphAttributes.color!==void 0,morphTargetsCount:ue,morphTextureStride:ce,numDirLights:N.directional.length,numPointLights:N.point.length,numSpotLights:N.spot.length,numSpotLightMaps:N.spotLightMap.length,numRectAreaLights:N.rectArea.length,numHemiLights:N.hemi.length,numDirLightShadows:N.directionalShadowMap.length,numPointLightShadows:N.pointShadowMap.length,numSpotLightShadows:N.spotShadowMap.length,numSpotLightShadowsWithMaps:N.numSpotLightShadowsWithMaps,numLightProbes:N.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:B.dithering,shadowMapEnabled:n.shadowMap.enabled&&U.length>0,shadowMapType:n.shadowMap.type,toneMapping:se,decodeVideoTexture:ut&&B.map.isVideoTexture===!0&&di.getTransfer(B.map.colorSpace)===Hn,decodeVideoTextureEmissive:An&&B.emissiveMap.isVideoTexture===!0&&di.getTransfer(B.emissiveMap.colorSpace)===Hn,premultipliedAlpha:B.premultipliedAlpha,doubleSided:B.side===fr,flipSided:B.side===Er,useDepthPacking:B.depthPacking>=0,depthPacking:B.depthPacking||0,index0AttributeName:B.index0AttributeName,extensionClipCullDistance:z&&B.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(z&&B.extensions.multiDraw===!0||ot)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:B.customProgramCacheKey()};return ne.vertexUv1s=u.has(1),ne.vertexUv2s=u.has(2),ne.vertexUv3s=u.has(3),u.clear(),ne}function b(B){const N=[];if(B.shaderID?N.push(B.shaderID):(N.push(B.customVertexShaderID),N.push(B.customFragmentShaderID)),B.defines!==void 0)for(const U in B.defines)N.push(U),N.push(B.defines[U]);return B.isRawShaderMaterial===!1&&(M(N,B),w(N,B),N.push(n.outputColorSpace)),N.push(B.customProgramCacheKey),N.join()}function M(B,N){B.push(N.precision),B.push(N.outputColorSpace),B.push(N.envMapMode),B.push(N.envMapCubeUVHeight),B.push(N.mapUv),B.push(N.alphaMapUv),B.push(N.lightMapUv),B.push(N.aoMapUv),B.push(N.bumpMapUv),B.push(N.normalMapUv),B.push(N.displacementMapUv),B.push(N.emissiveMapUv),B.push(N.metalnessMapUv),B.push(N.roughnessMapUv),B.push(N.anisotropyMapUv),B.push(N.clearcoatMapUv),B.push(N.clearcoatNormalMapUv),B.push(N.clearcoatRoughnessMapUv),B.push(N.iridescenceMapUv),B.push(N.iridescenceThicknessMapUv),B.push(N.sheenColorMapUv),B.push(N.sheenRoughnessMapUv),B.push(N.specularMapUv),B.push(N.specularColorMapUv),B.push(N.specularIntensityMapUv),B.push(N.transmissionMapUv),B.push(N.thicknessMapUv),B.push(N.combine),B.push(N.fogExp2),B.push(N.sizeAttenuation),B.push(N.morphTargetsCount),B.push(N.morphAttributeCount),B.push(N.numDirLights),B.push(N.numPointLights),B.push(N.numSpotLights),B.push(N.numSpotLightMaps),B.push(N.numHemiLights),B.push(N.numRectAreaLights),B.push(N.numDirLightShadows),B.push(N.numPointLightShadows),B.push(N.numSpotLightShadows),B.push(N.numSpotLightShadowsWithMaps),B.push(N.numLightProbes),B.push(N.shadowMapType),B.push(N.toneMapping),B.push(N.numClippingPlanes),B.push(N.numClipIntersection),B.push(N.depthPacking)}function w(B,N){o.disableAll(),N.instancing&&o.enable(0),N.instancingColor&&o.enable(1),N.instancingMorph&&o.enable(2),N.matcap&&o.enable(3),N.envMap&&o.enable(4),N.normalMapObjectSpace&&o.enable(5),N.normalMapTangentSpace&&o.enable(6),N.clearcoat&&o.enable(7),N.iridescence&&o.enable(8),N.alphaTest&&o.enable(9),N.vertexColors&&o.enable(10),N.vertexAlphas&&o.enable(11),N.vertexUv1s&&o.enable(12),N.vertexUv2s&&o.enable(13),N.vertexUv3s&&o.enable(14),N.vertexTangents&&o.enable(15),N.anisotropy&&o.enable(16),N.alphaHash&&o.enable(17),N.batching&&o.enable(18),N.dispersion&&o.enable(19),N.batchingColor&&o.enable(20),N.gradientMap&&o.enable(21),B.push(o.mask),o.disableAll(),N.fog&&o.enable(0),N.useFog&&o.enable(1),N.flatShading&&o.enable(2),N.logarithmicDepthBuffer&&o.enable(3),N.reversedDepthBuffer&&o.enable(4),N.skinning&&o.enable(5),N.morphTargets&&o.enable(6),N.morphNormals&&o.enable(7),N.morphColors&&o.enable(8),N.premultipliedAlpha&&o.enable(9),N.shadowMapEnabled&&o.enable(10),N.doubleSided&&o.enable(11),N.flipSided&&o.enable(12),N.useDepthPacking&&o.enable(13),N.dithering&&o.enable(14),N.transmission&&o.enable(15),N.sheen&&o.enable(16),N.opaque&&o.enable(17),N.pointsUvs&&o.enable(18),N.decodeVideoTexture&&o.enable(19),N.decodeVideoTextureEmissive&&o.enable(20),N.alphaToCoverage&&o.enable(21),B.push(o.mask)}function T(B){const N=y[B.type];let U;if(N){const V=Ff[N];U=vM.clone(V.uniforms)}else U=B.uniforms;return U}function E(B,N){let U=d.get(N);return U!==void 0?++U.usedTimes:(U=new bGe(n,N,B,s),c.push(U),d.set(N,U)),U}function R(B){if(--B.usedTimes===0){const N=c.indexOf(B);c[N]=c[c.length-1],c.pop(),d.delete(B.cacheKey),B.destroy()}}function P(B){l.remove(B)}function I(){l.dispose()}return{getParameters:S,getProgramCacheKey:b,getUniforms:T,acquireProgram:E,releaseProgram:R,releaseShaderCache:P,programs:c,dispose:I}}function TGe(){let n=new WeakMap;function e(a){return n.has(a)}function t(a){let o=n.get(a);return o===void 0&&(o={},n.set(a,o)),o}function i(a){n.delete(a)}function r(a,o,l){n.get(a)[o]=l}function s(){n=new WeakMap}return{has:e,get:t,remove:i,update:r,dispose:s}}function CGe(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function UZ(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function kZ(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function a(d,f,m,y,_,S){let b=n[e];return b===void 0?(b={id:d.id,object:d,geometry:f,material:m,groupOrder:y,renderOrder:d.renderOrder,z:_,group:S},n[e]=b):(b.id=d.id,b.object=d,b.geometry=f,b.material=m,b.groupOrder=y,b.renderOrder=d.renderOrder,b.z=_,b.group=S),e++,b}function o(d,f,m,y,_,S){const b=a(d,f,m,y,_,S);m.transmission>0?i.push(b):m.transparent===!0?r.push(b):t.push(b)}function l(d,f,m,y,_,S){const b=a(d,f,m,y,_,S);m.transmission>0?i.unshift(b):m.transparent===!0?r.unshift(b):t.unshift(b)}function u(d,f){t.length>1&&t.sort(d||CGe),i.length>1&&i.sort(f||UZ),r.length>1&&r.sort(f||UZ)}function c(){for(let d=e,f=n.length;d<f;d++){const m=n[d];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:o,unshift:l,finish:c,sort:u}}function wGe(){let n=new WeakMap;function e(i,r){const s=n.get(i);let a;return s===void 0?(a=new kZ,n.set(i,[a])):r>=s.length?(a=new kZ,s.push(a)):a=s[r],a}function t(){n=new WeakMap}return{get:e,dispose:t}}function EGe(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new re,color:new en};break;case"SpotLight":t={position:new re,direction:new re,color:new en,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new re,color:new en,distance:0,decay:0};break;case"HemisphereLight":t={direction:new re,skyColor:new en,groundColor:new en};break;case"RectAreaLight":t={color:new en,position:new re,halfWidth:new re,halfHeight:new re};break}return n[e.id]=t,t}}}function RGe(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new rt};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new rt};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new rt,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let PGe=0;function DGe(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function NGe(n){const e=new EGe,t=RGe(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)i.probe.push(new re);const r=new re,s=new Mn,a=new Mn;function o(u){let c=0,d=0,f=0;for(let B=0;B<9;B++)i.probe[B].set(0,0,0);let m=0,y=0,_=0,S=0,b=0,M=0,w=0,T=0,E=0,R=0,P=0;u.sort(DGe);for(let B=0,N=u.length;B<N;B++){const U=u[B],V=U.color,W=U.intensity,K=U.distance;let q=null;if(U.shadow&&U.shadow.map&&(U.shadow.map.texture.format===_l?q=U.shadow.map.texture:q=U.shadow.map.depthTexture||U.shadow.map.texture),U.isAmbientLight)c+=V.r*W,d+=V.g*W,f+=V.b*W;else if(U.isLightProbe){for(let j=0;j<9;j++)i.probe[j].addScaledVector(U.sh.coefficients[j],W);P++}else if(U.isDirectionalLight){const j=e.get(U);if(j.color.copy(U.color).multiplyScalar(U.intensity),U.castShadow){const te=U.shadow,he=t.get(U);he.shadowIntensity=te.intensity,he.shadowBias=te.bias,he.shadowNormalBias=te.normalBias,he.shadowRadius=te.radius,he.shadowMapSize=te.mapSize,i.directionalShadow[m]=he,i.directionalShadowMap[m]=q,i.directionalShadowMatrix[m]=U.shadow.matrix,M++}i.directional[m]=j,m++}else if(U.isSpotLight){const j=e.get(U);j.position.setFromMatrixPosition(U.matrixWorld),j.color.copy(V).multiplyScalar(W),j.distance=K,j.coneCos=Math.cos(U.angle),j.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),j.decay=U.decay,i.spot[_]=j;const te=U.shadow;if(U.map&&(i.spotLightMap[E]=U.map,E++,te.updateMatrices(U),U.castShadow&&R++),i.spotLightMatrix[_]=te.matrix,U.castShadow){const he=t.get(U);he.shadowIntensity=te.intensity,he.shadowBias=te.bias,he.shadowNormalBias=te.normalBias,he.shadowRadius=te.radius,he.shadowMapSize=te.mapSize,i.spotShadow[_]=he,i.spotShadowMap[_]=q,T++}_++}else if(U.isRectAreaLight){const j=e.get(U);j.color.copy(V).multiplyScalar(W),j.halfWidth.set(U.width*.5,0,0),j.halfHeight.set(0,U.height*.5,0),i.rectArea[S]=j,S++}else if(U.isPointLight){const j=e.get(U);if(j.color.copy(U.color).multiplyScalar(U.intensity),j.distance=U.distance,j.decay=U.decay,U.castShadow){const te=U.shadow,he=t.get(U);he.shadowIntensity=te.intensity,he.shadowBias=te.bias,he.shadowNormalBias=te.normalBias,he.shadowRadius=te.radius,he.shadowMapSize=te.mapSize,he.shadowCameraNear=te.camera.near,he.shadowCameraFar=te.camera.far,i.pointShadow[y]=he,i.pointShadowMap[y]=q,i.pointShadowMatrix[y]=U.shadow.matrix,w++}i.point[y]=j,y++}else if(U.isHemisphereLight){const j=e.get(U);j.skyColor.copy(U.color).multiplyScalar(W),j.groundColor.copy(U.groundColor).multiplyScalar(W),i.hemi[b]=j,b++}}S>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Vn.LTC_FLOAT_1,i.rectAreaLTC2=Vn.LTC_FLOAT_2):(i.rectAreaLTC1=Vn.LTC_HALF_1,i.rectAreaLTC2=Vn.LTC_HALF_2)),i.ambient[0]=c,i.ambient[1]=d,i.ambient[2]=f;const I=i.hash;(I.directionalLength!==m||I.pointLength!==y||I.spotLength!==_||I.rectAreaLength!==S||I.hemiLength!==b||I.numDirectionalShadows!==M||I.numPointShadows!==w||I.numSpotShadows!==T||I.numSpotMaps!==E||I.numLightProbes!==P)&&(i.directional.length=m,i.spot.length=_,i.rectArea.length=S,i.point.length=y,i.hemi.length=b,i.directionalShadow.length=M,i.directionalShadowMap.length=M,i.pointShadow.length=w,i.pointShadowMap.length=w,i.spotShadow.length=T,i.spotShadowMap.length=T,i.directionalShadowMatrix.length=M,i.pointShadowMatrix.length=w,i.spotLightMatrix.length=T+E-R,i.spotLightMap.length=E,i.numSpotLightShadowsWithMaps=R,i.numLightProbes=P,I.directionalLength=m,I.pointLength=y,I.spotLength=_,I.rectAreaLength=S,I.hemiLength=b,I.numDirectionalShadows=M,I.numPointShadows=w,I.numSpotShadows=T,I.numSpotMaps=E,I.numLightProbes=P,i.version=PGe++)}function l(u,c){let d=0,f=0,m=0,y=0,_=0;const S=c.matrixWorldInverse;for(let b=0,M=u.length;b<M;b++){const w=u[b];if(w.isDirectionalLight){const T=i.directional[d];T.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(S),d++}else if(w.isSpotLight){const T=i.spot[m];T.position.setFromMatrixPosition(w.matrixWorld),T.position.applyMatrix4(S),T.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(S),m++}else if(w.isRectAreaLight){const T=i.rectArea[y];T.position.setFromMatrixPosition(w.matrixWorld),T.position.applyMatrix4(S),a.identity(),s.copy(w.matrixWorld),s.premultiply(S),a.extractRotation(s),T.halfWidth.set(w.width*.5,0,0),T.halfHeight.set(0,w.height*.5,0),T.halfWidth.applyMatrix4(a),T.halfHeight.applyMatrix4(a),y++}else if(w.isPointLight){const T=i.point[f];T.position.setFromMatrixPosition(w.matrixWorld),T.position.applyMatrix4(S),f++}else if(w.isHemisphereLight){const T=i.hemi[_];T.direction.setFromMatrixPosition(w.matrixWorld),T.direction.transformDirection(S),_++}}}return{setup:o,setupView:l,state:i}}function zZ(n){const e=new NGe(n),t=[],i=[];function r(c){u.camera=c,t.length=0,i.length=0}function s(c){t.push(c)}function a(c){i.push(c)}function o(){e.setup(t)}function l(c){e.setupView(t,c)}const u={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:u,setupLights:o,setupLightsView:l,pushLight:s,pushShadow:a}}function BGe(n){let e=new WeakMap;function t(r,s=0){const a=e.get(r);let o;return a===void 0?(o=new zZ(n),e.set(r,[o])):s>=a.length?(o=new zZ(n),a.push(o)):o=a[s],o}function i(){e=new WeakMap}return{get:t,dispose:i}}const FGe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,LGe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,IGe=[new re(1,0,0),new re(-1,0,0),new re(0,1,0),new re(0,-1,0),new re(0,0,1),new re(0,0,-1)],GGe=[new re(0,-1,0),new re(0,-1,0),new re(0,0,1),new re(0,0,-1),new re(0,-1,0),new re(0,-1,0)],VZ=new Mn,tC=new re,cO=new re;function OGe(n,e,t){let i=new Kv;const r=new rt,s=new rt,a=new si,o=new pF,l=new mF,u={},c=t.maxTextureSize,d={[wo]:Er,[Er]:wo,[fr]:fr},f=new Ds({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new rt},radius:{value:4}},vertexShader:FGe,fragmentShader:LGe}),m=f.clone();m.defines.HORIZONTAL_PASS=1;const y=new wi;y.setAttribute("position",new Gi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new Fr(y,f),S=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=tv;let b=this.type;this.render=function(R,P,I){if(S.enabled===!1||S.autoUpdate===!1&&S.needsUpdate===!1||R.length===0)return;R.type===YS&&(mt("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),R.type=tv);const B=n.getRenderTarget(),N=n.getActiveCubeFace(),U=n.getActiveMipmapLevel(),V=n.state;V.setBlending(Oa),V.buffers.depth.getReversed()===!0?V.buffers.color.setClear(0,0,0,0):V.buffers.color.setClear(1,1,1,1),V.buffers.depth.setTest(!0),V.setScissorTest(!1);const W=b!==this.type;W&&P.traverse(function(K){K.material&&(Array.isArray(K.material)?K.material.forEach(q=>q.needsUpdate=!0):K.material.needsUpdate=!0)});for(let K=0,q=R.length;K<q;K++){const j=R[K],te=j.shadow;if(te===void 0){mt("WebGLShadowMap:",j,"has no shadow.");continue}if(te.autoUpdate===!1&&te.needsUpdate===!1)continue;r.copy(te.mapSize);const he=te.getFrameExtents();if(r.multiply(he),s.copy(te.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(s.x=Math.floor(c/he.x),r.x=s.x*he.x,te.mapSize.x=s.x),r.y>c&&(s.y=Math.floor(c/he.y),r.y=s.y*he.y,te.mapSize.y=s.y)),te.map===null||W===!0){if(te.map!==null&&(te.map.depthTexture!==null&&(te.map.depthTexture.dispose(),te.map.depthTexture=null),te.map.dispose()),this.type===Ad){if(j.isPointLight){mt("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}te.map=new Nr(r.x,r.y,{format:_l,type:zi,minFilter:Jn,magFilter:Jn,generateMipmaps:!1}),te.map.texture.name=j.name+".shadowMap",te.map.depthTexture=new po(r.x,r.y,wr),te.map.depthTexture.name=j.name+".shadowMapDepth",te.map.depthTexture.format=Xo,te.map.depthTexture.compareFunction=null,te.map.depthTexture.minFilter=xr,te.map.depthTexture.magFilter=xr}else{j.isPointLight?(te.map=new jM(r.x),te.map.depthTexture=new iF(r.x,qr)):(te.map=new Nr(r.x,r.y),te.map.depthTexture=new po(r.x,r.y,qr)),te.map.depthTexture.name=j.name+".shadowMap",te.map.depthTexture.format=Xo;const Be=n.state.buffers.depth.getReversed();this.type===tv?(te.map.depthTexture.compareFunction=Be?wb:Cb,te.map.depthTexture.minFilter=Jn,te.map.depthTexture.magFilter=Jn):(te.map.depthTexture.compareFunction=null,te.map.depthTexture.minFilter=xr,te.map.depthTexture.magFilter=xr)}te.camera.updateProjectionMatrix()}const _e=te.map.isWebGLCubeRenderTarget?6:1;for(let Be=0;Be<_e;Be++){if(te.map.isWebGLCubeRenderTarget)n.setRenderTarget(te.map,Be),n.clear();else{Be===0&&(n.setRenderTarget(te.map),n.clear());const ue=te.getViewport(Be);a.set(s.x*ue.x,s.y*ue.y,s.x*ue.z,s.y*ue.w),V.viewport(a)}if(j.isPointLight){const ue=te.camera,ce=te.matrix,Ce=j.distance||ue.far;Ce!==ue.far&&(ue.far=Ce,ue.updateProjectionMatrix()),tC.setFromMatrixPosition(j.matrixWorld),ue.position.copy(tC),cO.copy(ue.position),cO.add(IGe[Be]),ue.up.copy(GGe[Be]),ue.lookAt(cO),ue.updateMatrixWorld(),ce.makeTranslation(-tC.x,-tC.y,-tC.z),VZ.multiplyMatrices(ue.projectionMatrix,ue.matrixWorldInverse),te._frustum.setFromProjectionMatrix(VZ,ue.coordinateSystem,ue.reversedDepth)}else te.updateMatrices(j);i=te.getFrustum(),T(P,I,te.camera,j,this.type)}te.isPointLightShadow!==!0&&this.type===Ad&&M(te,I),te.needsUpdate=!1}b=this.type,S.needsUpdate=!1,n.setRenderTarget(B,N,U)};function M(R,P){const I=e.update(_);f.defines.VSM_SAMPLES!==R.blurSamples&&(f.defines.VSM_SAMPLES=R.blurSamples,m.defines.VSM_SAMPLES=R.blurSamples,f.needsUpdate=!0,m.needsUpdate=!0),R.mapPass===null&&(R.mapPass=new Nr(r.x,r.y,{format:_l,type:zi})),f.uniforms.shadow_pass.value=R.map.depthTexture,f.uniforms.resolution.value=R.mapSize,f.uniforms.radius.value=R.radius,n.setRenderTarget(R.mapPass),n.clear(),n.renderBufferDirect(P,null,I,f,_,null),m.uniforms.shadow_pass.value=R.mapPass.texture,m.uniforms.resolution.value=R.mapSize,m.uniforms.radius.value=R.radius,n.setRenderTarget(R.map),n.clear(),n.renderBufferDirect(P,null,I,m,_,null)}function w(R,P,I,B){let N=null;const U=I.isPointLight===!0?R.customDistanceMaterial:R.customDepthMaterial;if(U!==void 0)N=U;else if(N=I.isPointLight===!0?l:o,n.localClippingEnabled&&P.clipShadows===!0&&Array.isArray(P.clippingPlanes)&&P.clippingPlanes.length!==0||P.displacementMap&&P.displacementScale!==0||P.alphaMap&&P.alphaTest>0||P.map&&P.alphaTest>0||P.alphaToCoverage===!0){const V=N.uuid,W=P.uuid;let K=u[V];K===void 0&&(K={},u[V]=K);let q=K[W];q===void 0&&(q=N.clone(),K[W]=q,P.addEventListener("dispose",E)),N=q}if(N.visible=P.visible,N.wireframe=P.wireframe,B===Ad?N.side=P.shadowSide!==null?P.shadowSide:P.side:N.side=P.shadowSide!==null?P.shadowSide:d[P.side],N.alphaMap=P.alphaMap,N.alphaTest=P.alphaToCoverage===!0?.5:P.alphaTest,N.map=P.map,N.clipShadows=P.clipShadows,N.clippingPlanes=P.clippingPlanes,N.clipIntersection=P.clipIntersection,N.displacementMap=P.displacementMap,N.displacementScale=P.displacementScale,N.displacementBias=P.displacementBias,N.wireframeLinewidth=P.wireframeLinewidth,N.linewidth=P.linewidth,I.isPointLight===!0&&N.isMeshDistanceMaterial===!0){const V=n.properties.get(N);V.light=I}return N}function T(R,P,I,B,N){if(R.visible===!1)return;if(R.layers.test(P.layers)&&(R.isMesh||R.isLine||R.isPoints)&&(R.castShadow||R.receiveShadow&&N===Ad)&&(!R.frustumCulled||i.intersectsObject(R))){R.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,R.matrixWorld);const W=e.update(R),K=R.material;if(Array.isArray(K)){const q=W.groups;for(let j=0,te=q.length;j<te;j++){const he=q[j],_e=K[he.materialIndex];if(_e&&_e.visible){const Be=w(R,_e,B,N);R.onBeforeShadow(n,R,P,I,W,Be,he),n.renderBufferDirect(I,null,W,Be,R,he),R.onAfterShadow(n,R,P,I,W,Be,he)}}}else if(K.visible){const q=w(R,K,B,N);R.onBeforeShadow(n,R,P,I,W,q,null),n.renderBufferDirect(I,null,W,q,R,null),R.onAfterShadow(n,R,P,I,W,q,null)}}const V=R.children;for(let W=0,K=V.length;W<K;W++)T(V[W],P,I,B,N)}function E(R){R.target.removeEventListener("dispose",E);for(const I in u){const B=u[I],N=R.target.uuid;N in B&&(B[N].dispose(),delete B[N])}}}const UGe={[$x]:hv,[Jx]:eb,[qx]:tb,[_m]:Qx,[hv]:$x,[eb]:Jx,[tb]:qx,[Qx]:_m};function kGe(n,e){function t(){let Ne=!1;const it=new si;let kt=null;const vn=new si(0,0,0,0);return{setMask:function(Kt){kt!==Kt&&!Ne&&(n.colorMask(Kt,Kt,Kt,Kt),kt=Kt)},setLocked:function(Kt){Ne=Kt},setClear:function(Kt,Ut,z,se,ne){ne===!0&&(Kt*=se,Ut*=se,z*=se),it.set(Kt,Ut,z,se),vn.equals(it)===!1&&(n.clearColor(Kt,Ut,z,se),vn.copy(it))},reset:function(){Ne=!1,kt=null,vn.set(-1,0,0,0)}}}function i(){let Ne=!1,it=!1,kt=null,vn=null,Kt=null;return{setReversed:function(Ut){if(it!==Ut){const z=e.get("EXT_clip_control");Ut?z.clipControlEXT(z.LOWER_LEFT_EXT,z.ZERO_TO_ONE_EXT):z.clipControlEXT(z.LOWER_LEFT_EXT,z.NEGATIVE_ONE_TO_ONE_EXT),it=Ut;const se=Kt;Kt=null,this.setClear(se)}},getReversed:function(){return it},setTest:function(Ut){Ut?Ye(n.DEPTH_TEST):ft(n.DEPTH_TEST)},setMask:function(Ut){kt!==Ut&&!Ne&&(n.depthMask(Ut),kt=Ut)},setFunc:function(Ut){if(it&&(Ut=UGe[Ut]),vn!==Ut){switch(Ut){case $x:n.depthFunc(n.NEVER);break;case hv:n.depthFunc(n.ALWAYS);break;case Jx:n.depthFunc(n.LESS);break;case _m:n.depthFunc(n.LEQUAL);break;case qx:n.depthFunc(n.EQUAL);break;case Qx:n.depthFunc(n.GEQUAL);break;case eb:n.depthFunc(n.GREATER);break;case tb:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}vn=Ut}},setLocked:function(Ut){Ne=Ut},setClear:function(Ut){Kt!==Ut&&(it&&(Ut=1-Ut),n.clearDepth(Ut),Kt=Ut)},reset:function(){Ne=!1,kt=null,vn=null,Kt=null,it=!1}}}function r(){let Ne=!1,it=null,kt=null,vn=null,Kt=null,Ut=null,z=null,se=null,ne=null;return{setTest:function(ae){Ne||(ae?Ye(n.STENCIL_TEST):ft(n.STENCIL_TEST))},setMask:function(ae){it!==ae&&!Ne&&(n.stencilMask(ae),it=ae)},setFunc:function(ae,be,pt){(kt!==ae||vn!==be||Kt!==pt)&&(n.stencilFunc(ae,be,pt),kt=ae,vn=be,Kt=pt)},setOp:function(ae,be,pt){(Ut!==ae||z!==be||se!==pt)&&(n.stencilOp(ae,be,pt),Ut=ae,z=be,se=pt)},setLocked:function(ae){Ne=ae},setClear:function(ae){ne!==ae&&(n.clearStencil(ae),ne=ae)},reset:function(){Ne=!1,it=null,kt=null,vn=null,Kt=null,Ut=null,z=null,se=null,ne=null}}}const s=new t,a=new i,o=new r,l=new WeakMap,u=new WeakMap;let c={},d={},f=new WeakMap,m=[],y=null,_=!1,S=null,b=null,M=null,w=null,T=null,E=null,R=null,P=new en(0,0,0),I=0,B=!1,N=null,U=null,V=null,W=null,K=null;const q=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let j=!1,te=0;const he=n.getParameter(n.VERSION);he.indexOf("WebGL")!==-1?(te=parseFloat(/^WebGL (\d)/.exec(he)[1]),j=te>=1):he.indexOf("OpenGL ES")!==-1&&(te=parseFloat(/^OpenGL ES (\d)/.exec(he)[1]),j=te>=2);let _e=null,Be={};const ue=n.getParameter(n.SCISSOR_BOX),ce=n.getParameter(n.VIEWPORT),Ce=new si().fromArray(ue),Oe=new si().fromArray(ce);function nt(Ne,it,kt,vn){const Kt=new Uint8Array(4),Ut=n.createTexture();n.bindTexture(Ne,Ut),n.texParameteri(Ne,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Ne,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let z=0;z<kt;z++)Ne===n.TEXTURE_3D||Ne===n.TEXTURE_2D_ARRAY?n.texImage3D(it,0,n.RGBA,1,1,vn,0,n.RGBA,n.UNSIGNED_BYTE,Kt):n.texImage2D(it+z,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Kt);return Ut}const Ae={};Ae[n.TEXTURE_2D]=nt(n.TEXTURE_2D,n.TEXTURE_2D,1),Ae[n.TEXTURE_CUBE_MAP]=nt(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Ae[n.TEXTURE_2D_ARRAY]=nt(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Ae[n.TEXTURE_3D]=nt(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),Ye(n.DEPTH_TEST),a.setFunc(_m),gt(!1),yt(Uw),Ye(n.CULL_FACE),ke(Oa);function Ye(Ne){c[Ne]!==!0&&(n.enable(Ne),c[Ne]=!0)}function ft(Ne){c[Ne]!==!1&&(n.disable(Ne),c[Ne]=!1)}function ze(Ne,it){return d[Ne]!==it?(n.bindFramebuffer(Ne,it),d[Ne]=it,Ne===n.DRAW_FRAMEBUFFER&&(d[n.FRAMEBUFFER]=it),Ne===n.FRAMEBUFFER&&(d[n.DRAW_FRAMEBUFFER]=it),!0):!1}function ot(Ne,it){let kt=m,vn=!1;if(Ne){kt=f.get(it),kt===void 0&&(kt=[],f.set(it,kt));const Kt=Ne.textures;if(kt.length!==Kt.length||kt[0]!==n.COLOR_ATTACHMENT0){for(let Ut=0,z=Kt.length;Ut<z;Ut++)kt[Ut]=n.COLOR_ATTACHMENT0+Ut;kt.length=Kt.length,vn=!0}}else kt[0]!==n.BACK&&(kt[0]=n.BACK,vn=!0);vn&&n.drawBuffers(kt)}function ut(Ne){return y!==Ne?(n.useProgram(Ne),y=Ne,!0):!1}const Wt={[vl]:n.FUNC_ADD,[kE]:n.FUNC_SUBTRACT,[zE]:n.FUNC_REVERSE_SUBTRACT};Wt[k2]=n.MIN,Wt[z2]=n.MAX;const It={[Bf]:n.ZERO,[VE]:n.ONE,[HE]:n.SRC_COLOR,[Yx]:n.SRC_ALPHA,[KE]:n.SRC_ALPHA_SATURATE,[jE]:n.DST_COLOR,[WE]:n.DST_ALPHA,[XE]:n.ONE_MINUS_SRC_COLOR,[Kx]:n.ONE_MINUS_SRC_ALPHA,[YE]:n.ONE_MINUS_DST_COLOR,[ZE]:n.ONE_MINUS_DST_ALPHA,[h9]:n.CONSTANT_COLOR,[d9]:n.ONE_MINUS_CONSTANT_COLOR,[f9]:n.CONSTANT_ALPHA,[p9]:n.ONE_MINUS_CONSTANT_ALPHA};function ke(Ne,it,kt,vn,Kt,Ut,z,se,ne,ae){if(Ne===Oa){_===!0&&(ft(n.BLEND),_=!1);return}if(_===!1&&(Ye(n.BLEND),_=!0),Ne!==nv){if(Ne!==S||ae!==B){if((b!==vl||T!==vl)&&(n.blendEquation(n.FUNC_ADD),b=vl,T=vl),ae)switch(Ne){case Al:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case bm:n.blendFunc(n.ONE,n.ONE);break;case u0:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case c0:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:Tt("WebGLState: Invalid blending: ",Ne);break}else switch(Ne){case Al:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case bm:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case u0:Tt("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case c0:Tt("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Tt("WebGLState: Invalid blending: ",Ne);break}M=null,w=null,E=null,R=null,P.set(0,0,0),I=0,S=Ne,B=ae}return}Kt=Kt||it,Ut=Ut||kt,z=z||vn,(it!==b||Kt!==T)&&(n.blendEquationSeparate(Wt[it],Wt[Kt]),b=it,T=Kt),(kt!==M||vn!==w||Ut!==E||z!==R)&&(n.blendFuncSeparate(It[kt],It[vn],It[Ut],It[z]),M=kt,w=vn,E=Ut,R=z),(se.equals(P)===!1||ne!==I)&&(n.blendColor(se.r,se.g,se.b,ne),P.copy(se),I=ne),S=Ne,B=!1}function je(Ne,it){Ne.side===fr?ft(n.CULL_FACE):Ye(n.CULL_FACE);let kt=Ne.side===Er;it&&(kt=!kt),gt(kt),Ne.blending===Al&&Ne.transparent===!1?ke(Oa):ke(Ne.blending,Ne.blendEquation,Ne.blendSrc,Ne.blendDst,Ne.blendEquationAlpha,Ne.blendSrcAlpha,Ne.blendDstAlpha,Ne.blendColor,Ne.blendAlpha,Ne.premultipliedAlpha),a.setFunc(Ne.depthFunc),a.setTest(Ne.depthTest),a.setMask(Ne.depthWrite),s.setMask(Ne.colorWrite);const vn=Ne.stencilWrite;o.setTest(vn),vn&&(o.setMask(Ne.stencilWriteMask),o.setFunc(Ne.stencilFunc,Ne.stencilRef,Ne.stencilFuncMask),o.setOp(Ne.stencilFail,Ne.stencilZFail,Ne.stencilZPass)),An(Ne.polygonOffset,Ne.polygonOffsetFactor,Ne.polygonOffsetUnits),Ne.alphaToCoverage===!0?Ye(n.SAMPLE_ALPHA_TO_COVERAGE):ft(n.SAMPLE_ALPHA_TO_COVERAGE)}function gt(Ne){N!==Ne&&(Ne?n.frontFace(n.CW):n.frontFace(n.CCW),N=Ne)}function yt(Ne){Ne!==O2?(Ye(n.CULL_FACE),Ne!==U&&(Ne===Uw?n.cullFace(n.BACK):Ne===U2?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):ft(n.CULL_FACE),U=Ne}function ve(Ne){Ne!==V&&(j&&n.lineWidth(Ne),V=Ne)}function An(Ne,it,kt){Ne?(Ye(n.POLYGON_OFFSET_FILL),(W!==it||K!==kt)&&(n.polygonOffset(it,kt),W=it,K=kt)):ft(n.POLYGON_OFFSET_FILL)}function cn(Ne){Ne?Ye(n.SCISSOR_TEST):ft(n.SCISSOR_TEST)}function In(Ne){Ne===void 0&&(Ne=n.TEXTURE0+q-1),_e!==Ne&&(n.activeTexture(Ne),_e=Ne)}function Zt(Ne,it,kt){kt===void 0&&(_e===null?kt=n.TEXTURE0+q-1:kt=_e);let vn=Be[kt];vn===void 0&&(vn={type:void 0,texture:void 0},Be[kt]=vn),(vn.type!==Ne||vn.texture!==it)&&(_e!==kt&&(n.activeTexture(kt),_e=kt),n.bindTexture(Ne,it||Ae[Ne]),vn.type=Ne,vn.texture=it)}function le(){const Ne=Be[_e];Ne!==void 0&&Ne.type!==void 0&&(n.bindTexture(Ne.type,null),Ne.type=void 0,Ne.texture=void 0)}function ee(){try{n.compressedTexImage2D(...arguments)}catch(Ne){Tt("WebGLState:",Ne)}}function Re(){try{n.compressedTexImage3D(...arguments)}catch(Ne){Tt("WebGLState:",Ne)}}function tt(){try{n.texSubImage2D(...arguments)}catch(Ne){Tt("WebGLState:",Ne)}}function et(){try{n.texSubImage3D(...arguments)}catch(Ne){Tt("WebGLState:",Ne)}}function at(){try{n.compressedTexSubImage2D(...arguments)}catch(Ne){Tt("WebGLState:",Ne)}}function jt(){try{n.compressedTexSubImage3D(...arguments)}catch(Ne){Tt("WebGLState:",Ne)}}function rn(){try{n.texStorage2D(...arguments)}catch(Ne){Tt("WebGLState:",Ne)}}function Nn(){try{n.texStorage3D(...arguments)}catch(Ne){Tt("WebGLState:",Ne)}}function Fn(){try{n.texImage2D(...arguments)}catch(Ne){Tt("WebGLState:",Ne)}}function Gt(){try{n.texImage3D(...arguments)}catch(Ne){Tt("WebGLState:",Ne)}}function st(Ne){Ce.equals(Ne)===!1&&(n.scissor(Ne.x,Ne.y,Ne.z,Ne.w),Ce.copy(Ne))}function Ft(Ne){Oe.equals(Ne)===!1&&(n.viewport(Ne.x,Ne.y,Ne.z,Ne.w),Oe.copy(Ne))}function Se(Ne,it){let kt=u.get(it);kt===void 0&&(kt=new WeakMap,u.set(it,kt));let vn=kt.get(Ne);vn===void 0&&(vn=n.getUniformBlockIndex(it,Ne.name),kt.set(Ne,vn))}function Je(Ne,it){const vn=u.get(it).get(Ne);l.get(it)!==vn&&(n.uniformBlockBinding(it,vn,Ne.__bindingPointIndex),l.set(it,vn))}function St(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),a.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},_e=null,Be={},d={},f=new WeakMap,m=[],y=null,_=!1,S=null,b=null,M=null,w=null,T=null,E=null,R=null,P=new en(0,0,0),I=0,B=!1,N=null,U=null,V=null,W=null,K=null,Ce.set(0,0,n.canvas.width,n.canvas.height),Oe.set(0,0,n.canvas.width,n.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:Ye,disable:ft,bindFramebuffer:ze,drawBuffers:ot,useProgram:ut,setBlending:ke,setMaterial:je,setFlipSided:gt,setCullFace:yt,setLineWidth:ve,setPolygonOffset:An,setScissorTest:cn,activeTexture:In,bindTexture:Zt,unbindTexture:le,compressedTexImage2D:ee,compressedTexImage3D:Re,texImage2D:Fn,texImage3D:Gt,updateUBOMapping:Se,uniformBlockBinding:Je,texStorage2D:rn,texStorage3D:Nn,texSubImage2D:tt,texSubImage3D:et,compressedTexSubImage2D:at,compressedTexSubImage3D:jt,scissor:st,viewport:Ft,reset:St}}function zGe(n,e,t,i,r,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new rt,c=new WeakMap;let d;const f=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(le,ee){return m?new OffscreenCanvas(le,ee):Ww("canvas")}function _(le,ee,Re){let tt=1;const et=Zt(le);if((et.width>Re||et.height>Re)&&(tt=Re/Math.max(et.width,et.height)),tt<1)if(typeof HTMLImageElement<"u"&&le instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&le instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&le instanceof ImageBitmap||typeof VideoFrame<"u"&&le instanceof VideoFrame){const at=Math.floor(tt*et.width),jt=Math.floor(tt*et.height);d===void 0&&(d=y(at,jt));const rn=ee?y(at,jt):d;return rn.width=at,rn.height=jt,rn.getContext("2d").drawImage(le,0,0,at,jt),mt("WebGLRenderer: Texture has been resized from ("+et.width+"x"+et.height+") to ("+at+"x"+jt+")."),rn}else return"data"in le&&mt("WebGLRenderer: Image in DataTexture is too big ("+et.width+"x"+et.height+")."),le;return le}function S(le){return le.generateMipmaps}function b(le){n.generateMipmap(le)}function M(le){return le.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:le.isWebGL3DRenderTarget?n.TEXTURE_3D:le.isWebGLArrayRenderTarget||le.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function w(le,ee,Re,tt,et=!1){if(le!==null){if(n[le]!==void 0)return n[le];mt("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+le+"'")}let at=ee;if(ee===n.RED&&(Re===n.FLOAT&&(at=n.R32F),Re===n.HALF_FLOAT&&(at=n.R16F),Re===n.UNSIGNED_BYTE&&(at=n.R8)),ee===n.RED_INTEGER&&(Re===n.UNSIGNED_BYTE&&(at=n.R8UI),Re===n.UNSIGNED_SHORT&&(at=n.R16UI),Re===n.UNSIGNED_INT&&(at=n.R32UI),Re===n.BYTE&&(at=n.R8I),Re===n.SHORT&&(at=n.R16I),Re===n.INT&&(at=n.R32I)),ee===n.RG&&(Re===n.FLOAT&&(at=n.RG32F),Re===n.HALF_FLOAT&&(at=n.RG16F),Re===n.UNSIGNED_BYTE&&(at=n.RG8)),ee===n.RG_INTEGER&&(Re===n.UNSIGNED_BYTE&&(at=n.RG8UI),Re===n.UNSIGNED_SHORT&&(at=n.RG16UI),Re===n.UNSIGNED_INT&&(at=n.RG32UI),Re===n.BYTE&&(at=n.RG8I),Re===n.SHORT&&(at=n.RG16I),Re===n.INT&&(at=n.RG32I)),ee===n.RGB_INTEGER&&(Re===n.UNSIGNED_BYTE&&(at=n.RGB8UI),Re===n.UNSIGNED_SHORT&&(at=n.RGB16UI),Re===n.UNSIGNED_INT&&(at=n.RGB32UI),Re===n.BYTE&&(at=n.RGB8I),Re===n.SHORT&&(at=n.RGB16I),Re===n.INT&&(at=n.RGB32I)),ee===n.RGBA_INTEGER&&(Re===n.UNSIGNED_BYTE&&(at=n.RGBA8UI),Re===n.UNSIGNED_SHORT&&(at=n.RGBA16UI),Re===n.UNSIGNED_INT&&(at=n.RGBA32UI),Re===n.BYTE&&(at=n.RGBA8I),Re===n.SHORT&&(at=n.RGBA16I),Re===n.INT&&(at=n.RGBA32I)),ee===n.RGB&&(Re===n.UNSIGNED_INT_5_9_9_9_REV&&(at=n.RGB9_E5),Re===n.UNSIGNED_INT_10F_11F_11F_REV&&(at=n.R11F_G11F_B10F)),ee===n.RGBA){const jt=et?Iv:di.getTransfer(tt);Re===n.FLOAT&&(at=n.RGBA32F),Re===n.HALF_FLOAT&&(at=n.RGBA16F),Re===n.UNSIGNED_BYTE&&(at=jt===Hn?n.SRGB8_ALPHA8:n.RGBA8),Re===n.UNSIGNED_SHORT_4_4_4_4&&(at=n.RGBA4),Re===n.UNSIGNED_SHORT_5_5_5_1&&(at=n.RGB5_A1)}return(at===n.R16F||at===n.R32F||at===n.RG16F||at===n.RG32F||at===n.RGBA16F||at===n.RGBA32F)&&e.get("EXT_color_buffer_float"),at}function T(le,ee){let Re;return le?ee===null||ee===qr||ee===jl?Re=n.DEPTH24_STENCIL8:ee===wr?Re=n.DEPTH32F_STENCIL8:ee===zc&&(Re=n.DEPTH24_STENCIL8,mt("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):ee===null||ee===qr||ee===jl?Re=n.DEPTH_COMPONENT24:ee===wr?Re=n.DEPTH_COMPONENT32F:ee===zc&&(Re=n.DEPTH_COMPONENT16),Re}function E(le,ee){return S(le)===!0||le.isFramebufferTexture&&le.minFilter!==xr&&le.minFilter!==Jn?Math.log2(Math.max(ee.width,ee.height))+1:le.mipmaps!==void 0&&le.mipmaps.length>0?le.mipmaps.length:le.isCompressedTexture&&Array.isArray(le.image)?ee.mipmaps.length:1}function R(le){const ee=le.target;ee.removeEventListener("dispose",R),I(ee),ee.isVideoTexture&&c.delete(ee)}function P(le){const ee=le.target;ee.removeEventListener("dispose",P),N(ee)}function I(le){const ee=i.get(le);if(ee.__webglInit===void 0)return;const Re=le.source,tt=f.get(Re);if(tt){const et=tt[ee.__cacheKey];et.usedTimes--,et.usedTimes===0&&B(le),Object.keys(tt).length===0&&f.delete(Re)}i.remove(le)}function B(le){const ee=i.get(le);n.deleteTexture(ee.__webglTexture);const Re=le.source,tt=f.get(Re);delete tt[ee.__cacheKey],a.memory.textures--}function N(le){const ee=i.get(le);if(le.depthTexture&&(le.depthTexture.dispose(),i.remove(le.depthTexture)),le.isWebGLCubeRenderTarget)for(let tt=0;tt<6;tt++){if(Array.isArray(ee.__webglFramebuffer[tt]))for(let et=0;et<ee.__webglFramebuffer[tt].length;et++)n.deleteFramebuffer(ee.__webglFramebuffer[tt][et]);else n.deleteFramebuffer(ee.__webglFramebuffer[tt]);ee.__webglDepthbuffer&&n.deleteRenderbuffer(ee.__webglDepthbuffer[tt])}else{if(Array.isArray(ee.__webglFramebuffer))for(let tt=0;tt<ee.__webglFramebuffer.length;tt++)n.deleteFramebuffer(ee.__webglFramebuffer[tt]);else n.deleteFramebuffer(ee.__webglFramebuffer);if(ee.__webglDepthbuffer&&n.deleteRenderbuffer(ee.__webglDepthbuffer),ee.__webglMultisampledFramebuffer&&n.deleteFramebuffer(ee.__webglMultisampledFramebuffer),ee.__webglColorRenderbuffer)for(let tt=0;tt<ee.__webglColorRenderbuffer.length;tt++)ee.__webglColorRenderbuffer[tt]&&n.deleteRenderbuffer(ee.__webglColorRenderbuffer[tt]);ee.__webglDepthRenderbuffer&&n.deleteRenderbuffer(ee.__webglDepthRenderbuffer)}const Re=le.textures;for(let tt=0,et=Re.length;tt<et;tt++){const at=i.get(Re[tt]);at.__webglTexture&&(n.deleteTexture(at.__webglTexture),a.memory.textures--),i.remove(Re[tt])}i.remove(le)}let U=0;function V(){U=0}function W(){const le=U;return le>=r.maxTextures&&mt("WebGLTextures: Trying to use "+le+" texture units while this GPU supports only "+r.maxTextures),U+=1,le}function K(le){const ee=[];return ee.push(le.wrapS),ee.push(le.wrapT),ee.push(le.wrapR||0),ee.push(le.magFilter),ee.push(le.minFilter),ee.push(le.anisotropy),ee.push(le.internalFormat),ee.push(le.format),ee.push(le.type),ee.push(le.generateMipmaps),ee.push(le.premultiplyAlpha),ee.push(le.flipY),ee.push(le.unpackAlignment),ee.push(le.colorSpace),ee.join()}function q(le,ee){const Re=i.get(le);if(le.isVideoTexture&&cn(le),le.isRenderTargetTexture===!1&&le.isExternalTexture!==!0&&le.version>0&&Re.__version!==le.version){const tt=le.image;if(tt===null)mt("WebGLRenderer: Texture marked for update but no image data found.");else if(tt.complete===!1)mt("WebGLRenderer: Texture marked for update but image is incomplete");else{Ae(Re,le,ee);return}}else le.isExternalTexture&&(Re.__webglTexture=le.sourceTexture?le.sourceTexture:null);t.bindTexture(n.TEXTURE_2D,Re.__webglTexture,n.TEXTURE0+ee)}function j(le,ee){const Re=i.get(le);if(le.isRenderTargetTexture===!1&&le.version>0&&Re.__version!==le.version){Ae(Re,le,ee);return}else le.isExternalTexture&&(Re.__webglTexture=le.sourceTexture?le.sourceTexture:null);t.bindTexture(n.TEXTURE_2D_ARRAY,Re.__webglTexture,n.TEXTURE0+ee)}function te(le,ee){const Re=i.get(le);if(le.isRenderTargetTexture===!1&&le.version>0&&Re.__version!==le.version){Ae(Re,le,ee);return}t.bindTexture(n.TEXTURE_3D,Re.__webglTexture,n.TEXTURE0+ee)}function he(le,ee){const Re=i.get(le);if(le.isCubeDepthTexture!==!0&&le.version>0&&Re.__version!==le.version){Ye(Re,le,ee);return}t.bindTexture(n.TEXTURE_CUBE_MAP,Re.__webglTexture,n.TEXTURE0+ee)}const _e={[Xc]:n.REPEAT,[ps]:n.CLAMP_TO_EDGE,[jf]:n.MIRRORED_REPEAT},Be={[xr]:n.NEAREST,[Mb]:n.NEAREST_MIPMAP_NEAREST,[xh]:n.NEAREST_MIPMAP_LINEAR,[Jn]:n.LINEAR,[sm]:n.LINEAR_MIPMAP_NEAREST,[Vo]:n.LINEAR_MIPMAP_LINEAR},ue={[iR]:n.NEVER,[oR]:n.ALWAYS,[Tb]:n.LESS,[Cb]:n.LEQUAL,[rR]:n.EQUAL,[wb]:n.GEQUAL,[sR]:n.GREATER,[aR]:n.NOTEQUAL};function ce(le,ee){if(ee.type===wr&&e.has("OES_texture_float_linear")===!1&&(ee.magFilter===Jn||ee.magFilter===sm||ee.magFilter===xh||ee.magFilter===Vo||ee.minFilter===Jn||ee.minFilter===sm||ee.minFilter===xh||ee.minFilter===Vo)&&mt("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(le,n.TEXTURE_WRAP_S,_e[ee.wrapS]),n.texParameteri(le,n.TEXTURE_WRAP_T,_e[ee.wrapT]),(le===n.TEXTURE_3D||le===n.TEXTURE_2D_ARRAY)&&n.texParameteri(le,n.TEXTURE_WRAP_R,_e[ee.wrapR]),n.texParameteri(le,n.TEXTURE_MAG_FILTER,Be[ee.magFilter]),n.texParameteri(le,n.TEXTURE_MIN_FILTER,Be[ee.minFilter]),ee.compareFunction&&(n.texParameteri(le,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(le,n.TEXTURE_COMPARE_FUNC,ue[ee.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(ee.magFilter===xr||ee.minFilter!==xh&&ee.minFilter!==Vo||ee.type===wr&&e.has("OES_texture_float_linear")===!1)return;if(ee.anisotropy>1||i.get(ee).__currentAnisotropy){const Re=e.get("EXT_texture_filter_anisotropic");n.texParameterf(le,Re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ee.anisotropy,r.getMaxAnisotropy())),i.get(ee).__currentAnisotropy=ee.anisotropy}}}function Ce(le,ee){let Re=!1;le.__webglInit===void 0&&(le.__webglInit=!0,ee.addEventListener("dispose",R));const tt=ee.source;let et=f.get(tt);et===void 0&&(et={},f.set(tt,et));const at=K(ee);if(at!==le.__cacheKey){et[at]===void 0&&(et[at]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,Re=!0),et[at].usedTimes++;const jt=et[le.__cacheKey];jt!==void 0&&(et[le.__cacheKey].usedTimes--,jt.usedTimes===0&&B(ee)),le.__cacheKey=at,le.__webglTexture=et[at].texture}return Re}function Oe(le,ee,Re){return Math.floor(Math.floor(le/Re)/ee)}function nt(le,ee,Re,tt){const at=le.updateRanges;if(at.length===0)t.texSubImage2D(n.TEXTURE_2D,0,0,0,ee.width,ee.height,Re,tt,ee.data);else{at.sort((Gt,st)=>Gt.start-st.start);let jt=0;for(let Gt=1;Gt<at.length;Gt++){const st=at[jt],Ft=at[Gt],Se=st.start+st.count,Je=Oe(Ft.start,ee.width,4),St=Oe(st.start,ee.width,4);Ft.start<=Se+1&&Je===St&&Oe(Ft.start+Ft.count-1,ee.width,4)===Je?st.count=Math.max(st.count,Ft.start+Ft.count-st.start):(++jt,at[jt]=Ft)}at.length=jt+1;const rn=n.getParameter(n.UNPACK_ROW_LENGTH),Nn=n.getParameter(n.UNPACK_SKIP_PIXELS),Fn=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,ee.width);for(let Gt=0,st=at.length;Gt<st;Gt++){const Ft=at[Gt],Se=Math.floor(Ft.start/4),Je=Math.ceil(Ft.count/4),St=Se%ee.width,Ne=Math.floor(Se/ee.width),it=Je,kt=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,St),n.pixelStorei(n.UNPACK_SKIP_ROWS,Ne),t.texSubImage2D(n.TEXTURE_2D,0,St,Ne,it,kt,Re,tt,ee.data)}le.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,rn),n.pixelStorei(n.UNPACK_SKIP_PIXELS,Nn),n.pixelStorei(n.UNPACK_SKIP_ROWS,Fn)}}function Ae(le,ee,Re){let tt=n.TEXTURE_2D;(ee.isDataArrayTexture||ee.isCompressedArrayTexture)&&(tt=n.TEXTURE_2D_ARRAY),ee.isData3DTexture&&(tt=n.TEXTURE_3D);const et=Ce(le,ee),at=ee.source;t.bindTexture(tt,le.__webglTexture,n.TEXTURE0+Re);const jt=i.get(at);if(at.version!==jt.__version||et===!0){t.activeTexture(n.TEXTURE0+Re);const rn=di.getPrimaries(di.workingColorSpace),Nn=ee.colorSpace===xl?null:di.getPrimaries(ee.colorSpace),Fn=ee.colorSpace===xl||rn===Nn?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,ee.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ee.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,ee.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Fn);let Gt=_(ee.image,!1,r.maxTextureSize);Gt=In(ee,Gt);const st=s.convert(ee.format,ee.colorSpace),Ft=s.convert(ee.type);let Se=w(ee.internalFormat,st,Ft,ee.colorSpace,ee.isVideoTexture);ce(tt,ee);let Je;const St=ee.mipmaps,Ne=ee.isVideoTexture!==!0,it=jt.__version===void 0||et===!0,kt=at.dataReady,vn=E(ee,Gt);if(ee.isDepthTexture)Se=T(ee.format===bl,ee.type),it&&(Ne?t.texStorage2D(n.TEXTURE_2D,1,Se,Gt.width,Gt.height):t.texImage2D(n.TEXTURE_2D,0,Se,Gt.width,Gt.height,0,st,Ft,null));else if(ee.isDataTexture)if(St.length>0){Ne&&it&&t.texStorage2D(n.TEXTURE_2D,vn,Se,St[0].width,St[0].height);for(let Kt=0,Ut=St.length;Kt<Ut;Kt++)Je=St[Kt],Ne?kt&&t.texSubImage2D(n.TEXTURE_2D,Kt,0,0,Je.width,Je.height,st,Ft,Je.data):t.texImage2D(n.TEXTURE_2D,Kt,Se,Je.width,Je.height,0,st,Ft,Je.data);ee.generateMipmaps=!1}else Ne?(it&&t.texStorage2D(n.TEXTURE_2D,vn,Se,Gt.width,Gt.height),kt&&nt(ee,Gt,st,Ft)):t.texImage2D(n.TEXTURE_2D,0,Se,Gt.width,Gt.height,0,st,Ft,Gt.data);else if(ee.isCompressedTexture)if(ee.isCompressedArrayTexture){Ne&&it&&t.texStorage3D(n.TEXTURE_2D_ARRAY,vn,Se,St[0].width,St[0].height,Gt.depth);for(let Kt=0,Ut=St.length;Kt<Ut;Kt++)if(Je=St[Kt],ee.format!==Vr)if(st!==null)if(Ne){if(kt)if(ee.layerUpdates.size>0){const z=PB(Je.width,Je.height,ee.format,ee.type);for(const se of ee.layerUpdates){const ne=Je.data.subarray(se*z/Je.data.BYTES_PER_ELEMENT,(se+1)*z/Je.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Kt,0,0,se,Je.width,Je.height,1,st,ne)}ee.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Kt,0,0,0,Je.width,Je.height,Gt.depth,st,Je.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Kt,Se,Je.width,Je.height,Gt.depth,0,Je.data,0,0);else mt("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Ne?kt&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Kt,0,0,0,Je.width,Je.height,Gt.depth,st,Ft,Je.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Kt,Se,Je.width,Je.height,Gt.depth,0,st,Ft,Je.data)}else{Ne&&it&&t.texStorage2D(n.TEXTURE_2D,vn,Se,St[0].width,St[0].height);for(let Kt=0,Ut=St.length;Kt<Ut;Kt++)Je=St[Kt],ee.format!==Vr?st!==null?Ne?kt&&t.compressedTexSubImage2D(n.TEXTURE_2D,Kt,0,0,Je.width,Je.height,st,Je.data):t.compressedTexImage2D(n.TEXTURE_2D,Kt,Se,Je.width,Je.height,0,Je.data):mt("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ne?kt&&t.texSubImage2D(n.TEXTURE_2D,Kt,0,0,Je.width,Je.height,st,Ft,Je.data):t.texImage2D(n.TEXTURE_2D,Kt,Se,Je.width,Je.height,0,st,Ft,Je.data)}else if(ee.isDataArrayTexture)if(Ne){if(it&&t.texStorage3D(n.TEXTURE_2D_ARRAY,vn,Se,Gt.width,Gt.height,Gt.depth),kt)if(ee.layerUpdates.size>0){const Kt=PB(Gt.width,Gt.height,ee.format,ee.type);for(const Ut of ee.layerUpdates){const z=Gt.data.subarray(Ut*Kt/Gt.data.BYTES_PER_ELEMENT,(Ut+1)*Kt/Gt.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,Ut,Gt.width,Gt.height,1,st,Ft,z)}ee.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Gt.width,Gt.height,Gt.depth,st,Ft,Gt.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Se,Gt.width,Gt.height,Gt.depth,0,st,Ft,Gt.data);else if(ee.isData3DTexture)Ne?(it&&t.texStorage3D(n.TEXTURE_3D,vn,Se,Gt.width,Gt.height,Gt.depth),kt&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Gt.width,Gt.height,Gt.depth,st,Ft,Gt.data)):t.texImage3D(n.TEXTURE_3D,0,Se,Gt.width,Gt.height,Gt.depth,0,st,Ft,Gt.data);else if(ee.isFramebufferTexture){if(it)if(Ne)t.texStorage2D(n.TEXTURE_2D,vn,Se,Gt.width,Gt.height);else{let Kt=Gt.width,Ut=Gt.height;for(let z=0;z<vn;z++)t.texImage2D(n.TEXTURE_2D,z,Se,Kt,Ut,0,st,Ft,null),Kt>>=1,Ut>>=1}}else if(St.length>0){if(Ne&&it){const Kt=Zt(St[0]);t.texStorage2D(n.TEXTURE_2D,vn,Se,Kt.width,Kt.height)}for(let Kt=0,Ut=St.length;Kt<Ut;Kt++)Je=St[Kt],Ne?kt&&t.texSubImage2D(n.TEXTURE_2D,Kt,0,0,st,Ft,Je):t.texImage2D(n.TEXTURE_2D,Kt,Se,st,Ft,Je);ee.generateMipmaps=!1}else if(Ne){if(it){const Kt=Zt(Gt);t.texStorage2D(n.TEXTURE_2D,vn,Se,Kt.width,Kt.height)}kt&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,st,Ft,Gt)}else t.texImage2D(n.TEXTURE_2D,0,Se,st,Ft,Gt);S(ee)&&b(tt),jt.__version=at.version,ee.onUpdate&&ee.onUpdate(ee)}le.__version=ee.version}function Ye(le,ee,Re){if(ee.image.length!==6)return;const tt=Ce(le,ee),et=ee.source;t.bindTexture(n.TEXTURE_CUBE_MAP,le.__webglTexture,n.TEXTURE0+Re);const at=i.get(et);if(et.version!==at.__version||tt===!0){t.activeTexture(n.TEXTURE0+Re);const jt=di.getPrimaries(di.workingColorSpace),rn=ee.colorSpace===xl?null:di.getPrimaries(ee.colorSpace),Nn=ee.colorSpace===xl||jt===rn?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,ee.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ee.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,ee.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Nn);const Fn=ee.isCompressedTexture||ee.image[0].isCompressedTexture,Gt=ee.image[0]&&ee.image[0].isDataTexture,st=[];for(let Ut=0;Ut<6;Ut++)!Fn&&!Gt?st[Ut]=_(ee.image[Ut],!0,r.maxCubemapSize):st[Ut]=Gt?ee.image[Ut].image:ee.image[Ut],st[Ut]=In(ee,st[Ut]);const Ft=st[0],Se=s.convert(ee.format,ee.colorSpace),Je=s.convert(ee.type),St=w(ee.internalFormat,Se,Je,ee.colorSpace),Ne=ee.isVideoTexture!==!0,it=at.__version===void 0||tt===!0,kt=et.dataReady;let vn=E(ee,Ft);ce(n.TEXTURE_CUBE_MAP,ee);let Kt;if(Fn){Ne&&it&&t.texStorage2D(n.TEXTURE_CUBE_MAP,vn,St,Ft.width,Ft.height);for(let Ut=0;Ut<6;Ut++){Kt=st[Ut].mipmaps;for(let z=0;z<Kt.length;z++){const se=Kt[z];ee.format!==Vr?Se!==null?Ne?kt&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,z,0,0,se.width,se.height,Se,se.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,z,St,se.width,se.height,0,se.data):mt("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ne?kt&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,z,0,0,se.width,se.height,Se,Je,se.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,z,St,se.width,se.height,0,Se,Je,se.data)}}}else{if(Kt=ee.mipmaps,Ne&&it){Kt.length>0&&vn++;const Ut=Zt(st[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,vn,St,Ut.width,Ut.height)}for(let Ut=0;Ut<6;Ut++)if(Gt){Ne?kt&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,0,0,0,st[Ut].width,st[Ut].height,Se,Je,st[Ut].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,0,St,st[Ut].width,st[Ut].height,0,Se,Je,st[Ut].data);for(let z=0;z<Kt.length;z++){const ne=Kt[z].image[Ut].image;Ne?kt&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,z+1,0,0,ne.width,ne.height,Se,Je,ne.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,z+1,St,ne.width,ne.height,0,Se,Je,ne.data)}}else{Ne?kt&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,0,0,0,Se,Je,st[Ut]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,0,St,Se,Je,st[Ut]);for(let z=0;z<Kt.length;z++){const se=Kt[z];Ne?kt&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,z+1,0,0,Se,Je,se.image[Ut]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,z+1,St,Se,Je,se.image[Ut])}}}S(ee)&&b(n.TEXTURE_CUBE_MAP),at.__version=et.version,ee.onUpdate&&ee.onUpdate(ee)}le.__version=ee.version}function ft(le,ee,Re,tt,et,at){const jt=s.convert(Re.format,Re.colorSpace),rn=s.convert(Re.type),Nn=w(Re.internalFormat,jt,rn,Re.colorSpace),Fn=i.get(ee),Gt=i.get(Re);if(Gt.__renderTarget=ee,!Fn.__hasExternalTextures){const st=Math.max(1,ee.width>>at),Ft=Math.max(1,ee.height>>at);et===n.TEXTURE_3D||et===n.TEXTURE_2D_ARRAY?t.texImage3D(et,at,Nn,st,Ft,ee.depth,0,jt,rn,null):t.texImage2D(et,at,Nn,st,Ft,0,jt,rn,null)}t.bindFramebuffer(n.FRAMEBUFFER,le),An(ee)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,tt,et,Gt.__webglTexture,0,ve(ee)):(et===n.TEXTURE_2D||et>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&et<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,tt,et,Gt.__webglTexture,at),t.bindFramebuffer(n.FRAMEBUFFER,null)}function ze(le,ee,Re){if(n.bindRenderbuffer(n.RENDERBUFFER,le),ee.depthBuffer){const tt=ee.depthTexture,et=tt&&tt.isDepthTexture?tt.type:null,at=T(ee.stencilBuffer,et),jt=ee.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;An(ee)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ve(ee),at,ee.width,ee.height):Re?n.renderbufferStorageMultisample(n.RENDERBUFFER,ve(ee),at,ee.width,ee.height):n.renderbufferStorage(n.RENDERBUFFER,at,ee.width,ee.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,jt,n.RENDERBUFFER,le)}else{const tt=ee.textures;for(let et=0;et<tt.length;et++){const at=tt[et],jt=s.convert(at.format,at.colorSpace),rn=s.convert(at.type),Nn=w(at.internalFormat,jt,rn,at.colorSpace);An(ee)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ve(ee),Nn,ee.width,ee.height):Re?n.renderbufferStorageMultisample(n.RENDERBUFFER,ve(ee),Nn,ee.width,ee.height):n.renderbufferStorage(n.RENDERBUFFER,Nn,ee.width,ee.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function ot(le,ee,Re){const tt=ee.isWebGLCubeRenderTarget===!0;if(t.bindFramebuffer(n.FRAMEBUFFER,le),!(ee.depthTexture&&ee.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const et=i.get(ee.depthTexture);if(et.__renderTarget=ee,(!et.__webglTexture||ee.depthTexture.image.width!==ee.width||ee.depthTexture.image.height!==ee.height)&&(ee.depthTexture.image.width=ee.width,ee.depthTexture.image.height=ee.height,ee.depthTexture.needsUpdate=!0),tt){if(et.__webglInit===void 0&&(et.__webglInit=!0,ee.depthTexture.addEventListener("dispose",R)),et.__webglTexture===void 0){et.__webglTexture=n.createTexture(),t.bindTexture(n.TEXTURE_CUBE_MAP,et.__webglTexture),ce(n.TEXTURE_CUBE_MAP,ee.depthTexture);const Fn=s.convert(ee.depthTexture.format),Gt=s.convert(ee.depthTexture.type);let st;ee.depthTexture.format===Xo?st=n.DEPTH_COMPONENT24:ee.depthTexture.format===bl&&(st=n.DEPTH24_STENCIL8);for(let Ft=0;Ft<6;Ft++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ft,0,st,ee.width,ee.height,0,Fn,Gt,null)}}else q(ee.depthTexture,0);const at=et.__webglTexture,jt=ve(ee),rn=tt?n.TEXTURE_CUBE_MAP_POSITIVE_X+Re:n.TEXTURE_2D,Nn=ee.depthTexture.format===bl?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;if(ee.depthTexture.format===Xo)An(ee)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Nn,rn,at,0,jt):n.framebufferTexture2D(n.FRAMEBUFFER,Nn,rn,at,0);else if(ee.depthTexture.format===bl)An(ee)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Nn,rn,at,0,jt):n.framebufferTexture2D(n.FRAMEBUFFER,Nn,rn,at,0);else throw new Error("Unknown depthTexture format")}function ut(le){const ee=i.get(le),Re=le.isWebGLCubeRenderTarget===!0;if(ee.__boundDepthTexture!==le.depthTexture){const tt=le.depthTexture;if(ee.__depthDisposeCallback&&ee.__depthDisposeCallback(),tt){const et=()=>{delete ee.__boundDepthTexture,delete ee.__depthDisposeCallback,tt.removeEventListener("dispose",et)};tt.addEventListener("dispose",et),ee.__depthDisposeCallback=et}ee.__boundDepthTexture=tt}if(le.depthTexture&&!ee.__autoAllocateDepthBuffer)if(Re)for(let tt=0;tt<6;tt++)ot(ee.__webglFramebuffer[tt],le,tt);else{const tt=le.texture.mipmaps;tt&&tt.length>0?ot(ee.__webglFramebuffer[0],le,0):ot(ee.__webglFramebuffer,le,0)}else if(Re){ee.__webglDepthbuffer=[];for(let tt=0;tt<6;tt++)if(t.bindFramebuffer(n.FRAMEBUFFER,ee.__webglFramebuffer[tt]),ee.__webglDepthbuffer[tt]===void 0)ee.__webglDepthbuffer[tt]=n.createRenderbuffer(),ze(ee.__webglDepthbuffer[tt],le,!1);else{const et=le.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,at=ee.__webglDepthbuffer[tt];n.bindRenderbuffer(n.RENDERBUFFER,at),n.framebufferRenderbuffer(n.FRAMEBUFFER,et,n.RENDERBUFFER,at)}}else{const tt=le.texture.mipmaps;if(tt&&tt.length>0?t.bindFramebuffer(n.FRAMEBUFFER,ee.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,ee.__webglFramebuffer),ee.__webglDepthbuffer===void 0)ee.__webglDepthbuffer=n.createRenderbuffer(),ze(ee.__webglDepthbuffer,le,!1);else{const et=le.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,at=ee.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,at),n.framebufferRenderbuffer(n.FRAMEBUFFER,et,n.RENDERBUFFER,at)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Wt(le,ee,Re){const tt=i.get(le);ee!==void 0&&ft(tt.__webglFramebuffer,le,le.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),Re!==void 0&&ut(le)}function It(le){const ee=le.texture,Re=i.get(le),tt=i.get(ee);le.addEventListener("dispose",P);const et=le.textures,at=le.isWebGLCubeRenderTarget===!0,jt=et.length>1;if(jt||(tt.__webglTexture===void 0&&(tt.__webglTexture=n.createTexture()),tt.__version=ee.version,a.memory.textures++),at){Re.__webglFramebuffer=[];for(let rn=0;rn<6;rn++)if(ee.mipmaps&&ee.mipmaps.length>0){Re.__webglFramebuffer[rn]=[];for(let Nn=0;Nn<ee.mipmaps.length;Nn++)Re.__webglFramebuffer[rn][Nn]=n.createFramebuffer()}else Re.__webglFramebuffer[rn]=n.createFramebuffer()}else{if(ee.mipmaps&&ee.mipmaps.length>0){Re.__webglFramebuffer=[];for(let rn=0;rn<ee.mipmaps.length;rn++)Re.__webglFramebuffer[rn]=n.createFramebuffer()}else Re.__webglFramebuffer=n.createFramebuffer();if(jt)for(let rn=0,Nn=et.length;rn<Nn;rn++){const Fn=i.get(et[rn]);Fn.__webglTexture===void 0&&(Fn.__webglTexture=n.createTexture(),a.memory.textures++)}if(le.samples>0&&An(le)===!1){Re.__webglMultisampledFramebuffer=n.createFramebuffer(),Re.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,Re.__webglMultisampledFramebuffer);for(let rn=0;rn<et.length;rn++){const Nn=et[rn];Re.__webglColorRenderbuffer[rn]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,Re.__webglColorRenderbuffer[rn]);const Fn=s.convert(Nn.format,Nn.colorSpace),Gt=s.convert(Nn.type),st=w(Nn.internalFormat,Fn,Gt,Nn.colorSpace,le.isXRRenderTarget===!0),Ft=ve(le);n.renderbufferStorageMultisample(n.RENDERBUFFER,Ft,st,le.width,le.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+rn,n.RENDERBUFFER,Re.__webglColorRenderbuffer[rn])}n.bindRenderbuffer(n.RENDERBUFFER,null),le.depthBuffer&&(Re.__webglDepthRenderbuffer=n.createRenderbuffer(),ze(Re.__webglDepthRenderbuffer,le,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(at){t.bindTexture(n.TEXTURE_CUBE_MAP,tt.__webglTexture),ce(n.TEXTURE_CUBE_MAP,ee);for(let rn=0;rn<6;rn++)if(ee.mipmaps&&ee.mipmaps.length>0)for(let Nn=0;Nn<ee.mipmaps.length;Nn++)ft(Re.__webglFramebuffer[rn][Nn],le,ee,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+rn,Nn);else ft(Re.__webglFramebuffer[rn],le,ee,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+rn,0);S(ee)&&b(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(jt){for(let rn=0,Nn=et.length;rn<Nn;rn++){const Fn=et[rn],Gt=i.get(Fn);let st=n.TEXTURE_2D;(le.isWebGL3DRenderTarget||le.isWebGLArrayRenderTarget)&&(st=le.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(st,Gt.__webglTexture),ce(st,Fn),ft(Re.__webglFramebuffer,le,Fn,n.COLOR_ATTACHMENT0+rn,st,0),S(Fn)&&b(st)}t.unbindTexture()}else{let rn=n.TEXTURE_2D;if((le.isWebGL3DRenderTarget||le.isWebGLArrayRenderTarget)&&(rn=le.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(rn,tt.__webglTexture),ce(rn,ee),ee.mipmaps&&ee.mipmaps.length>0)for(let Nn=0;Nn<ee.mipmaps.length;Nn++)ft(Re.__webglFramebuffer[Nn],le,ee,n.COLOR_ATTACHMENT0,rn,Nn);else ft(Re.__webglFramebuffer,le,ee,n.COLOR_ATTACHMENT0,rn,0);S(ee)&&b(rn),t.unbindTexture()}le.depthBuffer&&ut(le)}function ke(le){const ee=le.textures;for(let Re=0,tt=ee.length;Re<tt;Re++){const et=ee[Re];if(S(et)){const at=M(le),jt=i.get(et).__webglTexture;t.bindTexture(at,jt),b(at),t.unbindTexture()}}}const je=[],gt=[];function yt(le){if(le.samples>0){if(An(le)===!1){const ee=le.textures,Re=le.width,tt=le.height;let et=n.COLOR_BUFFER_BIT;const at=le.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,jt=i.get(le),rn=ee.length>1;if(rn)for(let Fn=0;Fn<ee.length;Fn++)t.bindFramebuffer(n.FRAMEBUFFER,jt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Fn,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,jt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Fn,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,jt.__webglMultisampledFramebuffer);const Nn=le.texture.mipmaps;Nn&&Nn.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,jt.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,jt.__webglFramebuffer);for(let Fn=0;Fn<ee.length;Fn++){if(le.resolveDepthBuffer&&(le.depthBuffer&&(et|=n.DEPTH_BUFFER_BIT),le.stencilBuffer&&le.resolveStencilBuffer&&(et|=n.STENCIL_BUFFER_BIT)),rn){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,jt.__webglColorRenderbuffer[Fn]);const Gt=i.get(ee[Fn]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Gt,0)}n.blitFramebuffer(0,0,Re,tt,0,0,Re,tt,et,n.NEAREST),l===!0&&(je.length=0,gt.length=0,je.push(n.COLOR_ATTACHMENT0+Fn),le.depthBuffer&&le.resolveDepthBuffer===!1&&(je.push(at),gt.push(at),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,gt)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,je))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),rn)for(let Fn=0;Fn<ee.length;Fn++){t.bindFramebuffer(n.FRAMEBUFFER,jt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Fn,n.RENDERBUFFER,jt.__webglColorRenderbuffer[Fn]);const Gt=i.get(ee[Fn]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,jt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Fn,n.TEXTURE_2D,Gt,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,jt.__webglMultisampledFramebuffer)}else if(le.depthBuffer&&le.resolveDepthBuffer===!1&&l){const ee=le.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[ee])}}}function ve(le){return Math.min(r.maxSamples,le.samples)}function An(le){const ee=i.get(le);return le.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&ee.__useRenderToTexture!==!1}function cn(le){const ee=a.render.frame;c.get(le)!==ee&&(c.set(le,ee),le.update())}function In(le,ee){const Re=le.colorSpace,tt=le.format,et=le.type;return le.isCompressedTexture===!0||le.isVideoTexture===!0||Re!==Su&&Re!==xl&&(di.getTransfer(Re)===Hn?(tt!==Vr||et!==br)&&mt("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Tt("WebGLTextures: Unsupported texture color space:",Re)),ee}function Zt(le){return typeof HTMLImageElement<"u"&&le instanceof HTMLImageElement?(u.width=le.naturalWidth||le.width,u.height=le.naturalHeight||le.height):typeof VideoFrame<"u"&&le instanceof VideoFrame?(u.width=le.displayWidth,u.height=le.displayHeight):(u.width=le.width,u.height=le.height),u}this.allocateTextureUnit=W,this.resetTextureUnits=V,this.setTexture2D=q,this.setTexture2DArray=j,this.setTexture3D=te,this.setTextureCube=he,this.rebindTextures=Wt,this.setupRenderTarget=It,this.updateRenderTargetMipmap=ke,this.updateMultisampleRenderTarget=yt,this.setupDepthRenderbuffer=ut,this.setupFrameBufferTexture=ft,this.useMultisampledRTT=An,this.isReversedDepthBuffer=function(){return t.buffers.depth.getReversed()}}function Qte(n,e){function t(i,r=xl){let s;const a=di.getTransfer(r);if(i===br)return n.UNSIGNED_BYTE;if(i===VM)return n.UNSIGNED_SHORT_4_4_4_4;if(i===HM)return n.UNSIGNED_SHORT_5_5_5_1;if(i===XM)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===WM)return n.UNSIGNED_INT_10F_11F_11F_REV;if(i===am)return n.BYTE;if(i===om)return n.SHORT;if(i===zc)return n.UNSIGNED_SHORT;if(i===Ao)return n.INT;if(i===qr)return n.UNSIGNED_INT;if(i===wr)return n.FLOAT;if(i===zi)return n.HALF_FLOAT;if(i===tR)return n.ALPHA;if(i===Ab)return n.RGB;if(i===Vr)return n.RGBA;if(i===Xo)return n.DEPTH_COMPONENT;if(i===bl)return n.DEPTH_STENCIL;if(i===rp)return n.RED;if(i===A0)return n.RED_INTEGER;if(i===_l)return n.RG;if(i===jv)return n.RG_INTEGER;if(i===Yv)return n.RGBA_INTEGER;if(i===lm||i===um||i===cm||i===hm)if(a===Hn)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===lm)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===um)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===cm)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===hm)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===lm)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===um)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===cm)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===hm)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===nb||i===ib||i===rb||i===sb)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===nb)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===ib)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===rb)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===sb)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===dv||i===fv||i===pv||i===mv||i===gv||i===d0||i===yv)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===dv||i===fv)return a===Hn?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===pv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(i===mv)return s.COMPRESSED_R11_EAC;if(i===gv)return s.COMPRESSED_SIGNED_R11_EAC;if(i===d0)return s.COMPRESSED_RG11_EAC;if(i===yv)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(i===vv||i===xv||i===bv||i===_v||i===Sv||i===Mv||i===Av||i===Tv||i===Cv||i===wv||i===Ev||i===Rv||i===Pv||i===Dv)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===vv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===xv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===bv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===_v)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Sv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===Mv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===Av)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Tv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===Cv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===wv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Ev)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Rv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Pv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===Dv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Nv||i===zw||i===Vw)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===Nv)return a===Hn?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===zw)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Vw)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===Bv||i===Fv||i===f0||i===Lv)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===Bv)return s.COMPRESSED_RED_RGTC1_EXT;if(i===Fv)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===f0)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Lv)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===jl?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}const VGe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,HGe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class XGe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const i=new rF(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new Ds({vertexShader:VGe,fragmentShader:HGe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Fr(new ap(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class WGe extends wl{constructor(e,t){super();const i=this;let r=null,s=1,a=null,o="local-floor",l=1,u=null,c=null,d=null,f=null,m=null,y=null;const _=typeof XRWebGLBinding<"u",S=new XGe,b={},M=t.getContextAttributes();let w=null,T=null;const E=[],R=[],P=new rt;let I=null;const B=new ds;B.viewport=new si;const N=new ds;N.viewport=new si;const U=[B,N],V=new CF;let W=null,K=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ae){let Ye=E[Ae];return Ye===void 0&&(Ye=new $S,E[Ae]=Ye),Ye.getTargetRaySpace()},this.getControllerGrip=function(Ae){let Ye=E[Ae];return Ye===void 0&&(Ye=new $S,E[Ae]=Ye),Ye.getGripSpace()},this.getHand=function(Ae){let Ye=E[Ae];return Ye===void 0&&(Ye=new $S,E[Ae]=Ye),Ye.getHandSpace()};function q(Ae){const Ye=R.indexOf(Ae.inputSource);if(Ye===-1)return;const ft=E[Ye];ft!==void 0&&(ft.update(Ae.inputSource,Ae.frame,u||a),ft.dispatchEvent({type:Ae.type,data:Ae.inputSource}))}function j(){r.removeEventListener("select",q),r.removeEventListener("selectstart",q),r.removeEventListener("selectend",q),r.removeEventListener("squeeze",q),r.removeEventListener("squeezestart",q),r.removeEventListener("squeezeend",q),r.removeEventListener("end",j),r.removeEventListener("inputsourceschange",te);for(let Ae=0;Ae<E.length;Ae++){const Ye=R[Ae];Ye!==null&&(R[Ae]=null,E[Ae].disconnect(Ye))}W=null,K=null,S.reset();for(const Ae in b)delete b[Ae];e.setRenderTarget(w),m=null,f=null,d=null,r=null,T=null,nt.stop(),i.isPresenting=!1,e.setPixelRatio(I),e.setSize(P.width,P.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ae){s=Ae,i.isPresenting===!0&&mt("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ae){o=Ae,i.isPresenting===!0&&mt("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(Ae){u=Ae},this.getBaseLayer=function(){return f!==null?f:m},this.getBinding=function(){return d===null&&_&&(d=new XRWebGLBinding(r,t)),d},this.getFrame=function(){return y},this.getSession=function(){return r},this.setSession=async function(Ae){if(r=Ae,r!==null){if(w=e.getRenderTarget(),r.addEventListener("select",q),r.addEventListener("selectstart",q),r.addEventListener("selectend",q),r.addEventListener("squeeze",q),r.addEventListener("squeezestart",q),r.addEventListener("squeezeend",q),r.addEventListener("end",j),r.addEventListener("inputsourceschange",te),M.xrCompatible!==!0&&await t.makeXRCompatible(),I=e.getPixelRatio(),e.getSize(P),_&&"createProjectionLayer"in XRWebGLBinding.prototype){let ft=null,ze=null,ot=null;M.depth&&(ot=M.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ft=M.stencil?bl:Xo,ze=M.stencil?jl:qr);const ut={colorFormat:t.RGBA8,depthFormat:ot,scaleFactor:s};d=this.getBinding(),f=d.createProjectionLayer(ut),r.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),T=new Nr(f.textureWidth,f.textureHeight,{format:Vr,type:br,depthTexture:new po(f.textureWidth,f.textureHeight,ze,void 0,void 0,void 0,void 0,void 0,void 0,ft),stencilBuffer:M.stencil,colorSpace:e.outputColorSpace,samples:M.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}else{const ft={antialias:M.antialias,alpha:!0,depth:M.depth,stencil:M.stencil,framebufferScaleFactor:s};m=new XRWebGLLayer(r,t,ft),r.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),T=new Nr(m.framebufferWidth,m.framebufferHeight,{format:Vr,type:br,colorSpace:e.outputColorSpace,stencilBuffer:M.stencil,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1})}T.isXRRenderTarget=!0,this.setFoveation(l),u=null,a=await r.requestReferenceSpace(o),nt.setContext(r),nt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return S.getDepthTexture()};function te(Ae){for(let Ye=0;Ye<Ae.removed.length;Ye++){const ft=Ae.removed[Ye],ze=R.indexOf(ft);ze>=0&&(R[ze]=null,E[ze].disconnect(ft))}for(let Ye=0;Ye<Ae.added.length;Ye++){const ft=Ae.added[Ye];let ze=R.indexOf(ft);if(ze===-1){for(let ut=0;ut<E.length;ut++)if(ut>=R.length){R.push(ft),ze=ut;break}else if(R[ut]===null){R[ut]=ft,ze=ut;break}if(ze===-1)break}const ot=E[ze];ot&&ot.connect(ft)}}const he=new re,_e=new re;function Be(Ae,Ye,ft){he.setFromMatrixPosition(Ye.matrixWorld),_e.setFromMatrixPosition(ft.matrixWorld);const ze=he.distanceTo(_e),ot=Ye.projectionMatrix.elements,ut=ft.projectionMatrix.elements,Wt=ot[14]/(ot[10]-1),It=ot[14]/(ot[10]+1),ke=(ot[9]+1)/ot[5],je=(ot[9]-1)/ot[5],gt=(ot[8]-1)/ot[0],yt=(ut[8]+1)/ut[0],ve=Wt*gt,An=Wt*yt,cn=ze/(-gt+yt),In=cn*-gt;if(Ye.matrixWorld.decompose(Ae.position,Ae.quaternion,Ae.scale),Ae.translateX(In),Ae.translateZ(cn),Ae.matrixWorld.compose(Ae.position,Ae.quaternion,Ae.scale),Ae.matrixWorldInverse.copy(Ae.matrixWorld).invert(),ot[10]===-1)Ae.projectionMatrix.copy(Ye.projectionMatrix),Ae.projectionMatrixInverse.copy(Ye.projectionMatrixInverse);else{const Zt=Wt+cn,le=It+cn,ee=ve-In,Re=An+(ze-In),tt=ke*It/le*Zt,et=je*It/le*Zt;Ae.projectionMatrix.makePerspective(ee,Re,tt,et,Zt,le),Ae.projectionMatrixInverse.copy(Ae.projectionMatrix).invert()}}function ue(Ae,Ye){Ye===null?Ae.matrixWorld.copy(Ae.matrix):Ae.matrixWorld.multiplyMatrices(Ye.matrixWorld,Ae.matrix),Ae.matrixWorldInverse.copy(Ae.matrixWorld).invert()}this.updateCamera=function(Ae){if(r===null)return;let Ye=Ae.near,ft=Ae.far;S.texture!==null&&(S.depthNear>0&&(Ye=S.depthNear),S.depthFar>0&&(ft=S.depthFar)),V.near=N.near=B.near=Ye,V.far=N.far=B.far=ft,(W!==V.near||K!==V.far)&&(r.updateRenderState({depthNear:V.near,depthFar:V.far}),W=V.near,K=V.far),V.layers.mask=Ae.layers.mask|6,B.layers.mask=V.layers.mask&3,N.layers.mask=V.layers.mask&5;const ze=Ae.parent,ot=V.cameras;ue(V,ze);for(let ut=0;ut<ot.length;ut++)ue(ot[ut],ze);ot.length===2?Be(V,B,N):V.projectionMatrix.copy(B.projectionMatrix),ce(Ae,V,ze)};function ce(Ae,Ye,ft){ft===null?Ae.matrix.copy(Ye.matrixWorld):(Ae.matrix.copy(ft.matrixWorld),Ae.matrix.invert(),Ae.matrix.multiply(Ye.matrixWorld)),Ae.matrix.decompose(Ae.position,Ae.quaternion,Ae.scale),Ae.updateMatrixWorld(!0),Ae.projectionMatrix.copy(Ye.projectionMatrix),Ae.projectionMatrixInverse.copy(Ye.projectionMatrixInverse),Ae.isPerspectiveCamera&&(Ae.fov=ub*2*Math.atan(1/Ae.projectionMatrix.elements[5]),Ae.zoom=1)}this.getCamera=function(){return V},this.getFoveation=function(){if(!(f===null&&m===null))return l},this.setFoveation=function(Ae){l=Ae,f!==null&&(f.fixedFoveation=Ae),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=Ae)},this.hasDepthSensing=function(){return S.texture!==null},this.getDepthSensingMesh=function(){return S.getMesh(V)},this.getCameraTexture=function(Ae){return b[Ae]};let Ce=null;function Oe(Ae,Ye){if(c=Ye.getViewerPose(u||a),y=Ye,c!==null){const ft=c.views;m!==null&&(e.setRenderTargetFramebuffer(T,m.framebuffer),e.setRenderTarget(T));let ze=!1;ft.length!==V.cameras.length&&(V.cameras.length=0,ze=!0);for(let It=0;It<ft.length;It++){const ke=ft[It];let je=null;if(m!==null)je=m.getViewport(ke);else{const yt=d.getViewSubImage(f,ke);je=yt.viewport,It===0&&(e.setRenderTargetTextures(T,yt.colorTexture,yt.depthStencilTexture),e.setRenderTarget(T))}let gt=U[It];gt===void 0&&(gt=new ds,gt.layers.enable(It),gt.viewport=new si,U[It]=gt),gt.matrix.fromArray(ke.transform.matrix),gt.matrix.decompose(gt.position,gt.quaternion,gt.scale),gt.projectionMatrix.fromArray(ke.projectionMatrix),gt.projectionMatrixInverse.copy(gt.projectionMatrix).invert(),gt.viewport.set(je.x,je.y,je.width,je.height),It===0&&(V.matrix.copy(gt.matrix),V.matrix.decompose(V.position,V.quaternion,V.scale)),ze===!0&&V.cameras.push(gt)}const ot=r.enabledFeatures;if(ot&&ot.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&_){d=i.getBinding();const It=d.getDepthInformation(ft[0]);It&&It.isValid&&It.texture&&S.init(It,r.renderState)}if(ot&&ot.includes("camera-access")&&_){e.state.unbindTexture(),d=i.getBinding();for(let It=0;It<ft.length;It++){const ke=ft[It].camera;if(ke){let je=b[ke];je||(je=new rF,b[ke]=je);const gt=d.getCameraImage(ke);je.sourceTexture=gt}}}}for(let ft=0;ft<E.length;ft++){const ze=R[ft],ot=E[ft];ze!==null&&ot!==void 0&&ot.update(ze,Ye,u||a)}Ce&&Ce(Ae,Ye),Ye.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:Ye}),y=null}const nt=new Yte;nt.setAnimationLoop(Oe),this.setAnimationLoop=function(Ae){Ce=Ae},this.dispose=function(){}}}const Q1=new Mu,ZGe=new Mn;function jGe(n,e){function t(S,b){S.matrixAutoUpdate===!0&&S.updateMatrix(),b.value.copy(S.matrix)}function i(S,b){b.color.getRGB(S.fogColor.value,ate(n)),b.isFog?(S.fogNear.value=b.near,S.fogFar.value=b.far):b.isFogExp2&&(S.fogDensity.value=b.density)}function r(S,b,M,w,T){b.isMeshBasicMaterial||b.isMeshLambertMaterial?s(S,b):b.isMeshToonMaterial?(s(S,b),d(S,b)):b.isMeshPhongMaterial?(s(S,b),c(S,b)):b.isMeshStandardMaterial?(s(S,b),f(S,b),b.isMeshPhysicalMaterial&&m(S,b,T)):b.isMeshMatcapMaterial?(s(S,b),y(S,b)):b.isMeshDepthMaterial?s(S,b):b.isMeshDistanceMaterial?(s(S,b),_(S,b)):b.isMeshNormalMaterial?s(S,b):b.isLineBasicMaterial?(a(S,b),b.isLineDashedMaterial&&o(S,b)):b.isPointsMaterial?l(S,b,M,w):b.isSpriteMaterial?u(S,b):b.isShadowMaterial?(S.color.value.copy(b.color),S.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function s(S,b){S.opacity.value=b.opacity,b.color&&S.diffuse.value.copy(b.color),b.emissive&&S.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(S.map.value=b.map,t(b.map,S.mapTransform)),b.alphaMap&&(S.alphaMap.value=b.alphaMap,t(b.alphaMap,S.alphaMapTransform)),b.bumpMap&&(S.bumpMap.value=b.bumpMap,t(b.bumpMap,S.bumpMapTransform),S.bumpScale.value=b.bumpScale,b.side===Er&&(S.bumpScale.value*=-1)),b.normalMap&&(S.normalMap.value=b.normalMap,t(b.normalMap,S.normalMapTransform),S.normalScale.value.copy(b.normalScale),b.side===Er&&S.normalScale.value.negate()),b.displacementMap&&(S.displacementMap.value=b.displacementMap,t(b.displacementMap,S.displacementMapTransform),S.displacementScale.value=b.displacementScale,S.displacementBias.value=b.displacementBias),b.emissiveMap&&(S.emissiveMap.value=b.emissiveMap,t(b.emissiveMap,S.emissiveMapTransform)),b.specularMap&&(S.specularMap.value=b.specularMap,t(b.specularMap,S.specularMapTransform)),b.alphaTest>0&&(S.alphaTest.value=b.alphaTest);const M=e.get(b),w=M.envMap,T=M.envMapRotation;w&&(S.envMap.value=w,Q1.copy(T),Q1.x*=-1,Q1.y*=-1,Q1.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(Q1.y*=-1,Q1.z*=-1),S.envMapRotation.value.setFromMatrix4(ZGe.makeRotationFromEuler(Q1)),S.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,S.reflectivity.value=b.reflectivity,S.ior.value=b.ior,S.refractionRatio.value=b.refractionRatio),b.lightMap&&(S.lightMap.value=b.lightMap,S.lightMapIntensity.value=b.lightMapIntensity,t(b.lightMap,S.lightMapTransform)),b.aoMap&&(S.aoMap.value=b.aoMap,S.aoMapIntensity.value=b.aoMapIntensity,t(b.aoMap,S.aoMapTransform))}function a(S,b){S.diffuse.value.copy(b.color),S.opacity.value=b.opacity,b.map&&(S.map.value=b.map,t(b.map,S.mapTransform))}function o(S,b){S.dashSize.value=b.dashSize,S.totalSize.value=b.dashSize+b.gapSize,S.scale.value=b.scale}function l(S,b,M,w){S.diffuse.value.copy(b.color),S.opacity.value=b.opacity,S.size.value=b.size*M,S.scale.value=w*.5,b.map&&(S.map.value=b.map,t(b.map,S.uvTransform)),b.alphaMap&&(S.alphaMap.value=b.alphaMap,t(b.alphaMap,S.alphaMapTransform)),b.alphaTest>0&&(S.alphaTest.value=b.alphaTest)}function u(S,b){S.diffuse.value.copy(b.color),S.opacity.value=b.opacity,S.rotation.value=b.rotation,b.map&&(S.map.value=b.map,t(b.map,S.mapTransform)),b.alphaMap&&(S.alphaMap.value=b.alphaMap,t(b.alphaMap,S.alphaMapTransform)),b.alphaTest>0&&(S.alphaTest.value=b.alphaTest)}function c(S,b){S.specular.value.copy(b.specular),S.shininess.value=Math.max(b.shininess,1e-4)}function d(S,b){b.gradientMap&&(S.gradientMap.value=b.gradientMap)}function f(S,b){S.metalness.value=b.metalness,b.metalnessMap&&(S.metalnessMap.value=b.metalnessMap,t(b.metalnessMap,S.metalnessMapTransform)),S.roughness.value=b.roughness,b.roughnessMap&&(S.roughnessMap.value=b.roughnessMap,t(b.roughnessMap,S.roughnessMapTransform)),b.envMap&&(S.envMapIntensity.value=b.envMapIntensity)}function m(S,b,M){S.ior.value=b.ior,b.sheen>0&&(S.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),S.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(S.sheenColorMap.value=b.sheenColorMap,t(b.sheenColorMap,S.sheenColorMapTransform)),b.sheenRoughnessMap&&(S.sheenRoughnessMap.value=b.sheenRoughnessMap,t(b.sheenRoughnessMap,S.sheenRoughnessMapTransform))),b.clearcoat>0&&(S.clearcoat.value=b.clearcoat,S.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(S.clearcoatMap.value=b.clearcoatMap,t(b.clearcoatMap,S.clearcoatMapTransform)),b.clearcoatRoughnessMap&&(S.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap,t(b.clearcoatRoughnessMap,S.clearcoatRoughnessMapTransform)),b.clearcoatNormalMap&&(S.clearcoatNormalMap.value=b.clearcoatNormalMap,t(b.clearcoatNormalMap,S.clearcoatNormalMapTransform),S.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),b.side===Er&&S.clearcoatNormalScale.value.negate())),b.dispersion>0&&(S.dispersion.value=b.dispersion),b.iridescence>0&&(S.iridescence.value=b.iridescence,S.iridescenceIOR.value=b.iridescenceIOR,S.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],S.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(S.iridescenceMap.value=b.iridescenceMap,t(b.iridescenceMap,S.iridescenceMapTransform)),b.iridescenceThicknessMap&&(S.iridescenceThicknessMap.value=b.iridescenceThicknessMap,t(b.iridescenceThicknessMap,S.iridescenceThicknessMapTransform))),b.transmission>0&&(S.transmission.value=b.transmission,S.transmissionSamplerMap.value=M.texture,S.transmissionSamplerSize.value.set(M.width,M.height),b.transmissionMap&&(S.transmissionMap.value=b.transmissionMap,t(b.transmissionMap,S.transmissionMapTransform)),S.thickness.value=b.thickness,b.thicknessMap&&(S.thicknessMap.value=b.thicknessMap,t(b.thicknessMap,S.thicknessMapTransform)),S.attenuationDistance.value=b.attenuationDistance,S.attenuationColor.value.copy(b.attenuationColor)),b.anisotropy>0&&(S.anisotropyVector.value.set(b.anisotropy*Math.cos(b.anisotropyRotation),b.anisotropy*Math.sin(b.anisotropyRotation)),b.anisotropyMap&&(S.anisotropyMap.value=b.anisotropyMap,t(b.anisotropyMap,S.anisotropyMapTransform))),S.specularIntensity.value=b.specularIntensity,S.specularColor.value.copy(b.specularColor),b.specularColorMap&&(S.specularColorMap.value=b.specularColorMap,t(b.specularColorMap,S.specularColorMapTransform)),b.specularIntensityMap&&(S.specularIntensityMap.value=b.specularIntensityMap,t(b.specularIntensityMap,S.specularIntensityMapTransform))}function y(S,b){b.matcap&&(S.matcap.value=b.matcap)}function _(S,b){const M=e.get(b).light;S.referencePosition.value.setFromMatrixPosition(M.matrixWorld),S.nearDistance.value=M.shadow.camera.near,S.farDistance.value=M.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function YGe(n,e,t,i){let r={},s={},a=[];const o=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(M,w){const T=w.program;i.uniformBlockBinding(M,T)}function u(M,w){let T=r[M.id];T===void 0&&(y(M),T=c(M),r[M.id]=T,M.addEventListener("dispose",S));const E=w.program;i.updateUBOMapping(M,E);const R=e.render.frame;s[M.id]!==R&&(f(M),s[M.id]=R)}function c(M){const w=d();M.__bindingPointIndex=w;const T=n.createBuffer(),E=M.__size,R=M.usage;return n.bindBuffer(n.UNIFORM_BUFFER,T),n.bufferData(n.UNIFORM_BUFFER,E,R),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,w,T),T}function d(){for(let M=0;M<o;M++)if(a.indexOf(M)===-1)return a.push(M),M;return Tt("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(M){const w=r[M.id],T=M.uniforms,E=M.__cache;n.bindBuffer(n.UNIFORM_BUFFER,w);for(let R=0,P=T.length;R<P;R++){const I=Array.isArray(T[R])?T[R]:[T[R]];for(let B=0,N=I.length;B<N;B++){const U=I[B];if(m(U,R,B,E)===!0){const V=U.__offset,W=Array.isArray(U.value)?U.value:[U.value];let K=0;for(let q=0;q<W.length;q++){const j=W[q],te=_(j);typeof j=="number"||typeof j=="boolean"?(U.__data[0]=j,n.bufferSubData(n.UNIFORM_BUFFER,V+K,U.__data)):j.isMatrix3?(U.__data[0]=j.elements[0],U.__data[1]=j.elements[1],U.__data[2]=j.elements[2],U.__data[3]=0,U.__data[4]=j.elements[3],U.__data[5]=j.elements[4],U.__data[6]=j.elements[5],U.__data[7]=0,U.__data[8]=j.elements[6],U.__data[9]=j.elements[7],U.__data[10]=j.elements[8],U.__data[11]=0):(j.toArray(U.__data,K),K+=te.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,V,U.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function m(M,w,T,E){const R=M.value,P=w+"_"+T;if(E[P]===void 0)return typeof R=="number"||typeof R=="boolean"?E[P]=R:E[P]=R.clone(),!0;{const I=E[P];if(typeof R=="number"||typeof R=="boolean"){if(I!==R)return E[P]=R,!0}else if(I.equals(R)===!1)return I.copy(R),!0}return!1}function y(M){const w=M.uniforms;let T=0;const E=16;for(let P=0,I=w.length;P<I;P++){const B=Array.isArray(w[P])?w[P]:[w[P]];for(let N=0,U=B.length;N<U;N++){const V=B[N],W=Array.isArray(V.value)?V.value:[V.value];for(let K=0,q=W.length;K<q;K++){const j=W[K],te=_(j),he=T%E,_e=he%te.boundary,Be=he+_e;T+=_e,Be!==0&&E-Be<te.storage&&(T+=E-Be),V.__data=new Float32Array(te.storage/Float32Array.BYTES_PER_ELEMENT),V.__offset=T,T+=te.storage}}}const R=T%E;return R>0&&(T+=E-R),M.__size=T,M.__cache={},this}function _(M){const w={boundary:0,storage:0};return typeof M=="number"||typeof M=="boolean"?(w.boundary=4,w.storage=4):M.isVector2?(w.boundary=8,w.storage=8):M.isVector3||M.isColor?(w.boundary=16,w.storage=12):M.isVector4?(w.boundary=16,w.storage=16):M.isMatrix3?(w.boundary=48,w.storage=48):M.isMatrix4?(w.boundary=64,w.storage=64):M.isTexture?mt("WebGLRenderer: Texture samplers can not be part of an uniforms group."):mt("WebGLRenderer: Unsupported uniform value type.",M),w}function S(M){const w=M.target;w.removeEventListener("dispose",S);const T=a.indexOf(w.__bindingPointIndex);a.splice(T,1),n.deleteBuffer(r[w.id]),delete r[w.id],delete s[w.id]}function b(){for(const M in r)n.deleteBuffer(r[M]);a=[],r={},s={}}return{bind:l,update:u,dispose:b}}const KGe=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Vp=null;function $Ge(){return Vp===null&&(Vp=new xu(KGe,16,16,_l,zi),Vp.name="DFG_LUT",Vp.minFilter=Jn,Vp.magFilter=Jn,Vp.wrapS=ps,Vp.wrapT=ps,Vp.generateMipmaps=!1,Vp.needsUpdate=!0),Vp}class mV{constructor(e={}){const{canvas:t=K2(),context:i=null,depth:r=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:d=!1,reversedDepthBuffer:f=!1,outputBufferType:m=br}=e;this.isWebGLRenderer=!0;let y;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");y=i.getContextAttributes().alpha}else y=a;const _=m,S=new Set([Yv,jv,A0]),b=new Set([br,qr,zc,jl,VM,HM]),M=new Uint32Array(4),w=new Int32Array(4);let T=null,E=null;const R=[],P=[];let I=null;this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=ho,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const B=this;let N=!1;this._outputColorSpace=Ps;let U=0,V=0,W=null,K=-1,q=null;const j=new si,te=new si;let he=null;const _e=new en(0);let Be=0,ue=t.width,ce=t.height,Ce=1,Oe=null,nt=null;const Ae=new si(0,0,ue,ce),Ye=new si(0,0,ue,ce);let ft=!1;const ze=new Kv;let ot=!1,ut=!1;const Wt=new Mn,It=new re,ke=new si,je={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let gt=!1;function yt(){return W===null?Ce:1}let ve=i;function An(de,Fe){return t.getContext(de,Fe)}try{const de={alpha:!0,depth:r,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Xd}`),t.addEventListener("webglcontextlost",se,!1),t.addEventListener("webglcontextrestored",ne,!1),t.addEventListener("webglcontextcreationerror",ae,!1),ve===null){const Fe="webgl2";if(ve=An(Fe,de),ve===null)throw An(Fe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(de){throw Tt("WebGLRenderer: "+de.message),de}let cn,In,Zt,le,ee,Re,tt,et,at,jt,rn,Nn,Fn,Gt,st,Ft,Se,Je,St,Ne,it,kt,vn,Kt;function Ut(){cn=new JLe(ve),cn.init(),kt=new Qte(ve,cn),In=new VLe(ve,cn,e,kt),Zt=new kGe(ve,cn),In.reversedDepthBuffer&&f&&Zt.buffers.depth.setReversed(!0),le=new eIe(ve),ee=new TGe,Re=new zGe(ve,cn,Zt,ee,In,kt,le),tt=new XLe(B),et=new $Le(B),at=new r2e(ve),vn=new kLe(ve,at),jt=new qLe(ve,at,le,vn),rn=new nIe(ve,jt,at,le),St=new tIe(ve,In,Re),Ft=new HLe(ee),Nn=new AGe(B,tt,et,cn,In,vn,Ft),Fn=new jGe(B,ee),Gt=new wGe,st=new BGe(cn),Je=new ULe(B,tt,et,Zt,rn,y,l),Se=new OGe(B,rn,In),Kt=new YGe(ve,le,In,Zt),Ne=new zLe(ve,cn,le),it=new QLe(ve,cn,le),le.programs=Nn.programs,B.capabilities=In,B.extensions=cn,B.properties=ee,B.renderLists=Gt,B.shadowMap=Se,B.state=Zt,B.info=le}Ut(),_!==br&&(I=new rIe(_,t.width,t.height,r,s));const z=new WGe(B,ve);this.xr=z,this.getContext=function(){return ve},this.getContextAttributes=function(){return ve.getContextAttributes()},this.forceContextLoss=function(){const de=cn.get("WEBGL_lose_context");de&&de.loseContext()},this.forceContextRestore=function(){const de=cn.get("WEBGL_lose_context");de&&de.restoreContext()},this.getPixelRatio=function(){return Ce},this.setPixelRatio=function(de){de!==void 0&&(Ce=de,this.setSize(ue,ce,!1))},this.getSize=function(de){return de.set(ue,ce)},this.setSize=function(de,Fe,$e=!0){if(z.isPresenting){mt("WebGLRenderer: Can't change size while VR device is presenting.");return}ue=de,ce=Fe,t.width=Math.floor(de*Ce),t.height=Math.floor(Fe*Ce),$e===!0&&(t.style.width=de+"px",t.style.height=Fe+"px"),I!==null&&I.setSize(t.width,t.height),this.setViewport(0,0,de,Fe)},this.getDrawingBufferSize=function(de){return de.set(ue*Ce,ce*Ce).floor()},this.setDrawingBufferSize=function(de,Fe,$e){ue=de,ce=Fe,Ce=$e,t.width=Math.floor(de*$e),t.height=Math.floor(Fe*$e),this.setViewport(0,0,de,Fe)},this.setEffects=function(de){if(_===br){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(de){for(let Fe=0;Fe<de.length;Fe++)if(de[Fe].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}I.setEffects(de||[])},this.getCurrentViewport=function(de){return de.copy(j)},this.getViewport=function(de){return de.copy(Ae)},this.setViewport=function(de,Fe,$e,Ke){de.isVector4?Ae.set(de.x,de.y,de.z,de.w):Ae.set(de,Fe,$e,Ke),Zt.viewport(j.copy(Ae).multiplyScalar(Ce).round())},this.getScissor=function(de){return de.copy(Ye)},this.setScissor=function(de,Fe,$e,Ke){de.isVector4?Ye.set(de.x,de.y,de.z,de.w):Ye.set(de,Fe,$e,Ke),Zt.scissor(te.copy(Ye).multiplyScalar(Ce).round())},this.getScissorTest=function(){return ft},this.setScissorTest=function(de){Zt.setScissorTest(ft=de)},this.setOpaqueSort=function(de){Oe=de},this.setTransparentSort=function(de){nt=de},this.getClearColor=function(de){return de.copy(Je.getClearColor())},this.setClearColor=function(){Je.setClearColor(...arguments)},this.getClearAlpha=function(){return Je.getClearAlpha()},this.setClearAlpha=function(){Je.setClearAlpha(...arguments)},this.clear=function(de=!0,Fe=!0,$e=!0){let Ke=0;if(de){let Ze=!1;if(W!==null){const zt=W.texture.format;Ze=S.has(zt)}if(Ze){const zt=W.texture.type,Jt=b.has(zt),Vt=Je.getClearColor(),Rn=Je.getClearAlpha(),yn=Vt.r,jn=Vt.g,bn=Vt.b;Jt?(M[0]=yn,M[1]=jn,M[2]=bn,M[3]=Rn,ve.clearBufferuiv(ve.COLOR,0,M)):(w[0]=yn,w[1]=jn,w[2]=bn,w[3]=Rn,ve.clearBufferiv(ve.COLOR,0,w))}else Ke|=ve.COLOR_BUFFER_BIT}Fe&&(Ke|=ve.DEPTH_BUFFER_BIT),$e&&(Ke|=ve.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ve.clear(Ke)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",se,!1),t.removeEventListener("webglcontextrestored",ne,!1),t.removeEventListener("webglcontextcreationerror",ae,!1),Je.dispose(),Gt.dispose(),st.dispose(),ee.dispose(),tt.dispose(),et.dispose(),rn.dispose(),vn.dispose(),Kt.dispose(),Nn.dispose(),z.dispose(),z.removeEventListener("sessionstart",er),z.removeEventListener("sessionend",Vi),Zn.stop()};function se(de){de.preventDefault(),lb("WebGLRenderer: Context Lost."),N=!0}function ne(){lb("WebGLRenderer: Context Restored."),N=!1;const de=le.autoReset,Fe=Se.enabled,$e=Se.autoUpdate,Ke=Se.needsUpdate,Ze=Se.type;Ut(),le.autoReset=de,Se.enabled=Fe,Se.autoUpdate=$e,Se.needsUpdate=Ke,Se.type=Ze}function ae(de){Tt("WebGLRenderer: A WebGL context could not be created. Reason: ",de.statusMessage)}function be(de){const Fe=de.target;Fe.removeEventListener("dispose",be),pt(Fe)}function pt(de){Bt(de),ee.remove(de)}function Bt(de){const Fe=ee.get(de).programs;Fe!==void 0&&(Fe.forEach(function($e){Nn.releaseProgram($e)}),de.isShaderMaterial&&Nn.releaseShaderCache(de))}this.renderBufferDirect=function(de,Fe,$e,Ke,Ze,zt){Fe===null&&(Fe=je);const Jt=Ze.isMesh&&Ze.matrixWorld.determinant()<0,Vt=sn(de,Fe,$e,Ke,Ze);Zt.setMaterial(Ke,Jt);let Rn=$e.index,yn=1;if(Ke.wireframe===!0){if(Rn=jt.getWireframeAttribute($e),Rn===void 0)return;yn=2}const jn=$e.drawRange,bn=$e.attributes.position;let zn=jn.start*yn,Bi=(jn.start+jn.count)*yn;zt!==null&&(zn=Math.max(zn,zt.start*yn),Bi=Math.min(Bi,(zt.start+zt.count)*yn)),Rn!==null?(zn=Math.max(zn,0),Bi=Math.min(Bi,Rn.count)):bn!=null&&(zn=Math.max(zn,0),Bi=Math.min(Bi,bn.count));const _r=Bi-zn;if(_r<0||_r===1/0)return;vn.setup(Ze,Ke,Vt,$e,Rn);let Oi,On=Ne;if(Rn!==null&&(Oi=at.get(Rn),On=it,On.setIndex(Oi)),Ze.isMesh)Ke.wireframe===!0?(Zt.setLineWidth(Ke.wireframeLinewidth*yt()),On.setMode(ve.LINES)):On.setMode(ve.TRIANGLES);else if(Ze.isLine){let qt=Ke.linewidth;qt===void 0&&(qt=1),Zt.setLineWidth(qt*yt()),Ze.isLineSegments?On.setMode(ve.LINES):Ze.isLineLoop?On.setMode(ve.LINE_LOOP):On.setMode(ve.LINE_STRIP)}else Ze.isPoints?On.setMode(ve.POINTS):Ze.isSprite&&On.setMode(ve.TRIANGLES);if(Ze.isBatchedMesh)if(Ze._multiDrawInstances!==null)hs("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),On.renderMultiDrawInstances(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount,Ze._multiDrawInstances);else if(cn.get("WEBGL_multi_draw"))On.renderMultiDraw(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount);else{const qt=Ze._multiDrawStarts,ei=Ze._multiDrawCounts,Bn=Ze._multiDrawCount,tr=Rn?at.get(Rn).bytesPerElement:1,qs=ee.get(Ke).currentProgram.getUniforms();for(let Wi=0;Wi<Bn;Wi++)qs.setValue(ve,"_gl_DrawID",Wi),On.render(qt[Wi]/tr,ei[Wi])}else if(Ze.isInstancedMesh)On.renderInstances(zn,_r,Ze.count);else if($e.isInstancedBufferGeometry){const qt=$e._maxInstanceCount!==void 0?$e._maxInstanceCount:1/0,ei=Math.min($e.instanceCount,qt);On.renderInstances(zn,_r,ei)}else On.render(zn,_r)};function tn(de,Fe,$e){de.transparent===!0&&de.side===fr&&de.forceSinglePass===!1?(de.side=Er,de.needsUpdate=!0,dt(de,Fe,$e),de.side=wo,de.needsUpdate=!0,dt(de,Fe,$e),de.side=fr):dt(de,Fe,$e)}this.compile=function(de,Fe,$e=null){$e===null&&($e=de),E=st.get($e),E.init(Fe),P.push(E),$e.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(Fe.layers)&&(E.pushLight(Ze),Ze.castShadow&&E.pushShadow(Ze))}),de!==$e&&de.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(Fe.layers)&&(E.pushLight(Ze),Ze.castShadow&&E.pushShadow(Ze))}),E.setupLights();const Ke=new Set;return de.traverse(function(Ze){if(!(Ze.isMesh||Ze.isPoints||Ze.isLine||Ze.isSprite))return;const zt=Ze.material;if(zt)if(Array.isArray(zt))for(let Jt=0;Jt<zt.length;Jt++){const Vt=zt[Jt];tn(Vt,$e,Ze),Ke.add(Vt)}else tn(zt,$e,Ze),Ke.add(zt)}),E=P.pop(),Ke},this.compileAsync=function(de,Fe,$e=null){const Ke=this.compile(de,Fe,$e);return new Promise(Ze=>{function zt(){if(Ke.forEach(function(Jt){ee.get(Jt).currentProgram.isReady()&&Ke.delete(Jt)}),Ke.size===0){Ze(de);return}setTimeout(zt,10)}cn.get("KHR_parallel_shader_compile")!==null?zt():setTimeout(zt,10)})};let Tn=null;function yi(de){Tn&&Tn(de)}function er(){Zn.stop()}function Vi(){Zn.start()}const Zn=new Yte;Zn.setAnimationLoop(yi),typeof self<"u"&&Zn.setContext(self),this.setAnimationLoop=function(de){Tn=de,z.setAnimationLoop(de),de===null?Zn.stop():Zn.start()},z.addEventListener("sessionstart",er),z.addEventListener("sessionend",Vi),this.render=function(de,Fe){if(Fe!==void 0&&Fe.isCamera!==!0){Tt("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(N===!0)return;const $e=z.enabled===!0&&z.isPresenting===!0,Ke=I!==null&&(W===null||$e)&&I.begin(B,W);if(de.matrixWorldAutoUpdate===!0&&de.updateMatrixWorld(),Fe.parent===null&&Fe.matrixWorldAutoUpdate===!0&&Fe.updateMatrixWorld(),z.enabled===!0&&z.isPresenting===!0&&(I===null||I.isCompositing()===!1)&&(z.cameraAutoUpdate===!0&&z.updateCamera(Fe),Fe=z.getCamera()),de.isScene===!0&&de.onBeforeRender(B,de,Fe,W),E=st.get(de,P.length),E.init(Fe),P.push(E),Wt.multiplyMatrices(Fe.projectionMatrix,Fe.matrixWorldInverse),ze.setFromProjectionMatrix(Wt,Sl,Fe.reversedDepth),ut=this.localClippingEnabled,ot=Ft.init(this.clippingPlanes,ut),T=Gt.get(de,R.length),T.init(),R.push(T),z.enabled===!0&&z.isPresenting===!0){const Jt=B.xr.getDepthSensingMesh();Jt!==null&&Xs(Jt,Fe,-1/0,B.sortObjects)}Xs(de,Fe,0,B.sortObjects),T.finish(),B.sortObjects===!0&&T.sort(Oe,nt),gt=z.enabled===!1||z.isPresenting===!1||z.hasDepthSensing()===!1,gt&&Je.addToRenderList(T,de),this.info.render.frame++,ot===!0&&Ft.beginShadows();const Ze=E.state.shadowsArray;if(Se.render(Ze,de,Fe),ot===!0&&Ft.endShadows(),this.info.autoReset===!0&&this.info.reset(),(Ke&&I.hasRenderPass())===!1){const Jt=T.opaque,Vt=T.transmissive;if(E.setupLights(),Fe.isArrayCamera){const Rn=Fe.cameras;if(Vt.length>0)for(let yn=0,jn=Rn.length;yn<jn;yn++){const bn=Rn[yn];ie(Jt,Vt,de,bn)}gt&&Je.render(de);for(let yn=0,jn=Rn.length;yn<jn;yn++){const bn=Rn[yn];es(T,de,bn,bn.viewport)}}else Vt.length>0&&ie(Jt,Vt,de,Fe),gt&&Je.render(de),es(T,de,Fe)}W!==null&&V===0&&(Re.updateMultisampleRenderTarget(W),Re.updateRenderTargetMipmap(W)),Ke&&I.end(B),de.isScene===!0&&de.onAfterRender(B,de,Fe),vn.resetDefaultState(),K=-1,q=null,P.pop(),P.length>0?(E=P[P.length-1],ot===!0&&Ft.setGlobalState(B.clippingPlanes,E.state.camera)):E=null,R.pop(),R.length>0?T=R[R.length-1]:T=null};function Xs(de,Fe,$e,Ke){if(de.visible===!1)return;if(de.layers.test(Fe.layers)){if(de.isGroup)$e=de.renderOrder;else if(de.isLOD)de.autoUpdate===!0&&de.update(Fe);else if(de.isLight)E.pushLight(de),de.castShadow&&E.pushShadow(de);else if(de.isSprite){if(!de.frustumCulled||ze.intersectsSprite(de)){Ke&&ke.setFromMatrixPosition(de.matrixWorld).applyMatrix4(Wt);const Jt=rn.update(de),Vt=de.material;Vt.visible&&T.push(de,Jt,Vt,$e,ke.z,null)}}else if((de.isMesh||de.isLine||de.isPoints)&&(!de.frustumCulled||ze.intersectsObject(de))){const Jt=rn.update(de),Vt=de.material;if(Ke&&(de.boundingSphere!==void 0?(de.boundingSphere===null&&de.computeBoundingSphere(),ke.copy(de.boundingSphere.center)):(Jt.boundingSphere===null&&Jt.computeBoundingSphere(),ke.copy(Jt.boundingSphere.center)),ke.applyMatrix4(de.matrixWorld).applyMatrix4(Wt)),Array.isArray(Vt)){const Rn=Jt.groups;for(let yn=0,jn=Rn.length;yn<jn;yn++){const bn=Rn[yn],zn=Vt[bn.materialIndex];zn&&zn.visible&&T.push(de,Jt,zn,$e,ke.z,bn)}}else Vt.visible&&T.push(de,Jt,Vt,$e,ke.z,null)}}const zt=de.children;for(let Jt=0,Vt=zt.length;Jt<Vt;Jt++)Xs(zt[Jt],Fe,$e,Ke)}function es(de,Fe,$e,Ke){const{opaque:Ze,transmissive:zt,transparent:Jt}=de;E.setupLightsView($e),ot===!0&&Ft.setGlobalState(B.clippingPlanes,$e),Ke&&Zt.viewport(j.copy(Ke)),Ze.length>0&&ye(Ze,Fe,$e),zt.length>0&&ye(zt,Fe,$e),Jt.length>0&&ye(Jt,Fe,$e),Zt.buffers.depth.setTest(!0),Zt.buffers.depth.setMask(!0),Zt.buffers.color.setMask(!0),Zt.setPolygonOffset(!1)}function ie(de,Fe,$e,Ke){if(($e.isScene===!0?$e.overrideMaterial:null)!==null)return;if(E.state.transmissionRenderTarget[Ke.id]===void 0){const zn=cn.has("EXT_color_buffer_half_float")||cn.has("EXT_color_buffer_float");E.state.transmissionRenderTarget[Ke.id]=new Nr(1,1,{generateMipmaps:!0,type:zn?zi:br,minFilter:Vo,samples:In.samples,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:di.workingColorSpace})}const zt=E.state.transmissionRenderTarget[Ke.id],Jt=Ke.viewport||j;zt.setSize(Jt.z*B.transmissionResolutionScale,Jt.w*B.transmissionResolutionScale);const Vt=B.getRenderTarget(),Rn=B.getActiveCubeFace(),yn=B.getActiveMipmapLevel();B.setRenderTarget(zt),B.getClearColor(_e),Be=B.getClearAlpha(),Be<1&&B.setClearColor(16777215,.5),B.clear(),gt&&Je.render($e);const jn=B.toneMapping;B.toneMapping=ho;const bn=Ke.viewport;if(Ke.viewport!==void 0&&(Ke.viewport=void 0),E.setupLightsView(Ke),ot===!0&&Ft.setGlobalState(B.clippingPlanes,Ke),ye(de,$e,Ke),Re.updateMultisampleRenderTarget(zt),Re.updateRenderTargetMipmap(zt),cn.has("WEBGL_multisampled_render_to_texture")===!1){let zn=!1;for(let Bi=0,_r=Fe.length;Bi<_r;Bi++){const Oi=Fe[Bi],{object:On,geometry:qt,material:ei,group:Bn}=Oi;if(ei.side===fr&&On.layers.test(Ke.layers)){const tr=ei.side;ei.side=Er,ei.needsUpdate=!0,Ue(On,$e,Ke,qt,ei,Bn),ei.side=tr,ei.needsUpdate=!0,zn=!0}}zn===!0&&(Re.updateMultisampleRenderTarget(zt),Re.updateRenderTargetMipmap(zt))}B.setRenderTarget(Vt,Rn,yn),B.setClearColor(_e,Be),bn!==void 0&&(Ke.viewport=bn),B.toneMapping=jn}function ye(de,Fe,$e){const Ke=Fe.isScene===!0?Fe.overrideMaterial:null;for(let Ze=0,zt=de.length;Ze<zt;Ze++){const Jt=de[Ze],{object:Vt,geometry:Rn,group:yn}=Jt;let jn=Jt.material;jn.allowOverride===!0&&Ke!==null&&(jn=Ke),Vt.layers.test($e.layers)&&Ue(Vt,Fe,$e,Rn,jn,yn)}}function Ue(de,Fe,$e,Ke,Ze,zt){de.onBeforeRender(B,Fe,$e,Ke,Ze,zt),de.modelViewMatrix.multiplyMatrices($e.matrixWorldInverse,de.matrixWorld),de.normalMatrix.getNormalMatrix(de.modelViewMatrix),Ze.onBeforeRender(B,Fe,$e,Ke,de,zt),Ze.transparent===!0&&Ze.side===fr&&Ze.forceSinglePass===!1?(Ze.side=Er,Ze.needsUpdate=!0,B.renderBufferDirect($e,Fe,Ke,Ze,de,zt),Ze.side=wo,Ze.needsUpdate=!0,B.renderBufferDirect($e,Fe,Ke,Ze,de,zt),Ze.side=fr):B.renderBufferDirect($e,Fe,Ke,Ze,de,zt),de.onAfterRender(B,Fe,$e,Ke,Ze,zt)}function dt(de,Fe,$e){Fe.isScene!==!0&&(Fe=je);const Ke=ee.get(de),Ze=E.state.lights,zt=E.state.shadowsArray,Jt=Ze.state.version,Vt=Nn.getParameters(de,Ze.state,zt,Fe,$e),Rn=Nn.getProgramCacheKey(Vt);let yn=Ke.programs;Ke.environment=de.isMeshStandardMaterial?Fe.environment:null,Ke.fog=Fe.fog,Ke.envMap=(de.isMeshStandardMaterial?et:tt).get(de.envMap||Ke.environment),Ke.envMapRotation=Ke.environment!==null&&de.envMap===null?Fe.environmentRotation:de.envMapRotation,yn===void 0&&(de.addEventListener("dispose",be),yn=new Map,Ke.programs=yn);let jn=yn.get(Rn);if(jn!==void 0){if(Ke.currentProgram===jn&&Ke.lightsStateVersion===Jt)return wt(de,Vt),jn}else Vt.uniforms=Nn.getUniforms(de),de.onBeforeCompile(Vt,B),jn=Nn.acquireProgram(Vt,Rn),yn.set(Rn,jn),Ke.uniforms=Vt.uniforms;const bn=Ke.uniforms;return(!de.isShaderMaterial&&!de.isRawShaderMaterial||de.clipping===!0)&&(bn.clippingPlanes=Ft.uniform),wt(de,Vt),Ke.needsLights=on(de),Ke.lightsStateVersion=Jt,Ke.needsLights&&(bn.ambientLightColor.value=Ze.state.ambient,bn.lightProbe.value=Ze.state.probe,bn.directionalLights.value=Ze.state.directional,bn.directionalLightShadows.value=Ze.state.directionalShadow,bn.spotLights.value=Ze.state.spot,bn.spotLightShadows.value=Ze.state.spotShadow,bn.rectAreaLights.value=Ze.state.rectArea,bn.ltc_1.value=Ze.state.rectAreaLTC1,bn.ltc_2.value=Ze.state.rectAreaLTC2,bn.pointLights.value=Ze.state.point,bn.pointLightShadows.value=Ze.state.pointShadow,bn.hemisphereLights.value=Ze.state.hemi,bn.directionalShadowMap.value=Ze.state.directionalShadowMap,bn.directionalShadowMatrix.value=Ze.state.directionalShadowMatrix,bn.spotShadowMap.value=Ze.state.spotShadowMap,bn.spotLightMatrix.value=Ze.state.spotLightMatrix,bn.spotLightMap.value=Ze.state.spotLightMap,bn.pointShadowMap.value=Ze.state.pointShadowMap,bn.pointShadowMatrix.value=Ze.state.pointShadowMatrix),Ke.currentProgram=jn,Ke.uniformsList=null,jn}function Ct(de){if(de.uniformsList===null){const Fe=de.currentProgram.getUniforms();de.uniformsList=VN.seqWithValue(Fe.seq,de.uniforms)}return de.uniformsList}function wt(de,Fe){const $e=ee.get(de);$e.outputColorSpace=Fe.outputColorSpace,$e.batching=Fe.batching,$e.batchingColor=Fe.batchingColor,$e.instancing=Fe.instancing,$e.instancingColor=Fe.instancingColor,$e.instancingMorph=Fe.instancingMorph,$e.skinning=Fe.skinning,$e.morphTargets=Fe.morphTargets,$e.morphNormals=Fe.morphNormals,$e.morphColors=Fe.morphColors,$e.morphTargetsCount=Fe.morphTargetsCount,$e.numClippingPlanes=Fe.numClippingPlanes,$e.numIntersection=Fe.numClipIntersection,$e.vertexAlphas=Fe.vertexAlphas,$e.vertexTangents=Fe.vertexTangents,$e.toneMapping=Fe.toneMapping}function sn(de,Fe,$e,Ke,Ze){Fe.isScene!==!0&&(Fe=je),Re.resetTextureUnits();const zt=Fe.fog,Jt=Ke.isMeshStandardMaterial?Fe.environment:null,Vt=W===null?B.outputColorSpace:W.isXRRenderTarget===!0?W.texture.colorSpace:Su,Rn=(Ke.isMeshStandardMaterial?et:tt).get(Ke.envMap||Jt),yn=Ke.vertexColors===!0&&!!$e.attributes.color&&$e.attributes.color.itemSize===4,jn=!!$e.attributes.tangent&&(!!Ke.normalMap||Ke.anisotropy>0),bn=!!$e.morphAttributes.position,zn=!!$e.morphAttributes.normal,Bi=!!$e.morphAttributes.color;let _r=ho;Ke.toneMapped&&(W===null||W.isXRRenderTarget===!0)&&(_r=B.toneMapping);const Oi=$e.morphAttributes.position||$e.morphAttributes.normal||$e.morphAttributes.color,On=Oi!==void 0?Oi.length:0,qt=ee.get(Ke),ei=E.state.lights;if(ot===!0&&(ut===!0||de!==q)){const Zs=de===q&&Ke.id===K;Ft.setState(Ke,de,Zs)}let Bn=!1;Ke.version===qt.__version?(qt.needsLights&&qt.lightsStateVersion!==ei.state.version||qt.outputColorSpace!==Vt||Ze.isBatchedMesh&&qt.batching===!1||!Ze.isBatchedMesh&&qt.batching===!0||Ze.isBatchedMesh&&qt.batchingColor===!0&&Ze.colorTexture===null||Ze.isBatchedMesh&&qt.batchingColor===!1&&Ze.colorTexture!==null||Ze.isInstancedMesh&&qt.instancing===!1||!Ze.isInstancedMesh&&qt.instancing===!0||Ze.isSkinnedMesh&&qt.skinning===!1||!Ze.isSkinnedMesh&&qt.skinning===!0||Ze.isInstancedMesh&&qt.instancingColor===!0&&Ze.instanceColor===null||Ze.isInstancedMesh&&qt.instancingColor===!1&&Ze.instanceColor!==null||Ze.isInstancedMesh&&qt.instancingMorph===!0&&Ze.morphTexture===null||Ze.isInstancedMesh&&qt.instancingMorph===!1&&Ze.morphTexture!==null||qt.envMap!==Rn||Ke.fog===!0&&qt.fog!==zt||qt.numClippingPlanes!==void 0&&(qt.numClippingPlanes!==Ft.numPlanes||qt.numIntersection!==Ft.numIntersection)||qt.vertexAlphas!==yn||qt.vertexTangents!==jn||qt.morphTargets!==bn||qt.morphNormals!==zn||qt.morphColors!==Bi||qt.toneMapping!==_r||qt.morphTargetsCount!==On)&&(Bn=!0):(Bn=!0,qt.__version=Ke.version);let tr=qt.currentProgram;Bn===!0&&(tr=dt(Ke,Fe,Ze));let qs=!1,Wi=!1,Ss=!1;const Lr=tr.getUniforms(),Qs=qt.uniforms;if(Zt.useProgram(tr.program)&&(qs=!0,Wi=!0,Ss=!0),Ke.id!==K&&(K=Ke.id,Wi=!0),qs||q!==de){Zt.buffers.depth.getReversed()&&de.reversedDepth!==!0&&(de._reversedDepth=!0,de.updateProjectionMatrix()),Lr.setValue(ve,"projectionMatrix",de.projectionMatrix),Lr.setValue(ve,"viewMatrix",de.matrixWorldInverse);const la=Lr.map.cameraPosition;la!==void 0&&la.setValue(ve,It.setFromMatrixPosition(de.matrixWorld)),In.logarithmicDepthBuffer&&Lr.setValue(ve,"logDepthBufFC",2/(Math.log(de.far+1)/Math.LN2)),(Ke.isMeshPhongMaterial||Ke.isMeshToonMaterial||Ke.isMeshLambertMaterial||Ke.isMeshBasicMaterial||Ke.isMeshStandardMaterial||Ke.isShaderMaterial)&&Lr.setValue(ve,"isOrthographic",de.isOrthographicCamera===!0),q!==de&&(q=de,Wi=!0,Ss=!0)}if(qt.needsLights&&(ei.state.directionalShadowMap.length>0&&Lr.setValue(ve,"directionalShadowMap",ei.state.directionalShadowMap,Re),ei.state.spotShadowMap.length>0&&Lr.setValue(ve,"spotShadowMap",ei.state.spotShadowMap,Re),ei.state.pointShadowMap.length>0&&Lr.setValue(ve,"pointShadowMap",ei.state.pointShadowMap,Re)),Ze.isSkinnedMesh){Lr.setOptional(ve,Ze,"bindMatrix"),Lr.setOptional(ve,Ze,"bindMatrixInverse");const Zs=Ze.skeleton;Zs&&(Zs.boneTexture===null&&Zs.computeBoneTexture(),Lr.setValue(ve,"boneTexture",Zs.boneTexture,Re))}Ze.isBatchedMesh&&(Lr.setOptional(ve,Ze,"batchingTexture"),Lr.setValue(ve,"batchingTexture",Ze._matricesTexture,Re),Lr.setOptional(ve,Ze,"batchingIdTexture"),Lr.setValue(ve,"batchingIdTexture",Ze._indirectTexture,Re),Lr.setOptional(ve,Ze,"batchingColorTexture"),Ze._colorsTexture!==null&&Lr.setValue(ve,"batchingColorTexture",Ze._colorsTexture,Re));const Ws=$e.morphAttributes;if((Ws.position!==void 0||Ws.normal!==void 0||Ws.color!==void 0)&&St.update(Ze,$e,tr),(Wi||qt.receiveShadow!==Ze.receiveShadow)&&(qt.receiveShadow=Ze.receiveShadow,Lr.setValue(ve,"receiveShadow",Ze.receiveShadow)),Ke.isMeshGouraudMaterial&&Ke.envMap!==null&&(Qs.envMap.value=Rn,Qs.flipEnvMap.value=Rn.isCubeTexture&&Rn.isRenderTargetTexture===!1?-1:1),Ke.isMeshStandardMaterial&&Ke.envMap===null&&Fe.environment!==null&&(Qs.envMapIntensity.value=Fe.environmentIntensity),Qs.dfgLUT!==void 0&&(Qs.dfgLUT.value=$Ge()),Wi&&(Lr.setValue(ve,"toneMappingExposure",B.toneMappingExposure),qt.needsLights&&Qt(Qs,Ss),zt&&Ke.fog===!0&&Fn.refreshFogUniforms(Qs,zt),Fn.refreshMaterialUniforms(Qs,Ke,Ce,ce,E.state.transmissionRenderTarget[de.id]),VN.upload(ve,Ct(qt),Qs,Re)),Ke.isShaderMaterial&&Ke.uniformsNeedUpdate===!0&&(VN.upload(ve,Ct(qt),Qs,Re),Ke.uniformsNeedUpdate=!1),Ke.isSpriteMaterial&&Lr.setValue(ve,"center",Ze.center),Lr.setValue(ve,"modelViewMatrix",Ze.modelViewMatrix),Lr.setValue(ve,"normalMatrix",Ze.normalMatrix),Lr.setValue(ve,"modelMatrix",Ze.matrixWorld),Ke.isShaderMaterial||Ke.isRawShaderMaterial){const Zs=Ke.uniformsGroups;for(let la=0,Te=Zs.length;la<Te;la++){const ai=Zs[la];Kt.update(ai,tr),Kt.bind(ai,tr)}}return tr}function Qt(de,Fe){de.ambientLightColor.needsUpdate=Fe,de.lightProbe.needsUpdate=Fe,de.directionalLights.needsUpdate=Fe,de.directionalLightShadows.needsUpdate=Fe,de.pointLights.needsUpdate=Fe,de.pointLightShadows.needsUpdate=Fe,de.spotLights.needsUpdate=Fe,de.spotLightShadows.needsUpdate=Fe,de.rectAreaLights.needsUpdate=Fe,de.hemisphereLights.needsUpdate=Fe}function on(de){return de.isMeshLambertMaterial||de.isMeshToonMaterial||de.isMeshPhongMaterial||de.isMeshStandardMaterial||de.isShadowMaterial||de.isShaderMaterial&&de.lights===!0}this.getActiveCubeFace=function(){return U},this.getActiveMipmapLevel=function(){return V},this.getRenderTarget=function(){return W},this.setRenderTargetTextures=function(de,Fe,$e){const Ke=ee.get(de);Ke.__autoAllocateDepthBuffer=de.resolveDepthBuffer===!1,Ke.__autoAllocateDepthBuffer===!1&&(Ke.__useRenderToTexture=!1),ee.get(de.texture).__webglTexture=Fe,ee.get(de.depthTexture).__webglTexture=Ke.__autoAllocateDepthBuffer?void 0:$e,Ke.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(de,Fe){const $e=ee.get(de);$e.__webglFramebuffer=Fe,$e.__useDefaultFramebuffer=Fe===void 0};const ln=ve.createFramebuffer();this.setRenderTarget=function(de,Fe=0,$e=0){W=de,U=Fe,V=$e;let Ke=null,Ze=!1,zt=!1;if(de){const Vt=ee.get(de);if(Vt.__useDefaultFramebuffer!==void 0){Zt.bindFramebuffer(ve.FRAMEBUFFER,Vt.__webglFramebuffer),j.copy(de.viewport),te.copy(de.scissor),he=de.scissorTest,Zt.viewport(j),Zt.scissor(te),Zt.setScissorTest(he),K=-1;return}else if(Vt.__webglFramebuffer===void 0)Re.setupRenderTarget(de);else if(Vt.__hasExternalTextures)Re.rebindTextures(de,ee.get(de.texture).__webglTexture,ee.get(de.depthTexture).__webglTexture);else if(de.depthBuffer){const jn=de.depthTexture;if(Vt.__boundDepthTexture!==jn){if(jn!==null&&ee.has(jn)&&(de.width!==jn.image.width||de.height!==jn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Re.setupDepthRenderbuffer(de)}}const Rn=de.texture;(Rn.isData3DTexture||Rn.isDataArrayTexture||Rn.isCompressedArrayTexture)&&(zt=!0);const yn=ee.get(de).__webglFramebuffer;de.isWebGLCubeRenderTarget?(Array.isArray(yn[Fe])?Ke=yn[Fe][$e]:Ke=yn[Fe],Ze=!0):de.samples>0&&Re.useMultisampledRTT(de)===!1?Ke=ee.get(de).__webglMultisampledFramebuffer:Array.isArray(yn)?Ke=yn[$e]:Ke=yn,j.copy(de.viewport),te.copy(de.scissor),he=de.scissorTest}else j.copy(Ae).multiplyScalar(Ce).floor(),te.copy(Ye).multiplyScalar(Ce).floor(),he=ft;if($e!==0&&(Ke=ln),Zt.bindFramebuffer(ve.FRAMEBUFFER,Ke)&&Zt.drawBuffers(de,Ke),Zt.viewport(j),Zt.scissor(te),Zt.setScissorTest(he),Ze){const Vt=ee.get(de.texture);ve.framebufferTexture2D(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ve.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,Vt.__webglTexture,$e)}else if(zt){const Vt=Fe;for(let Rn=0;Rn<de.textures.length;Rn++){const yn=ee.get(de.textures[Rn]);ve.framebufferTextureLayer(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0+Rn,yn.__webglTexture,$e,Vt)}}else if(de!==null&&$e!==0){const Vt=ee.get(de.texture);ve.framebufferTexture2D(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ve.TEXTURE_2D,Vt.__webglTexture,$e)}K=-1},this.readRenderTargetPixels=function(de,Fe,$e,Ke,Ze,zt,Jt,Vt=0){if(!(de&&de.isWebGLRenderTarget)){Tt("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Rn=ee.get(de).__webglFramebuffer;if(de.isWebGLCubeRenderTarget&&Jt!==void 0&&(Rn=Rn[Jt]),Rn){Zt.bindFramebuffer(ve.FRAMEBUFFER,Rn);try{const yn=de.textures[Vt],jn=yn.format,bn=yn.type;if(!In.textureFormatReadable(jn)){Tt("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!In.textureTypeReadable(bn)){Tt("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Fe>=0&&Fe<=de.width-Ke&&$e>=0&&$e<=de.height-Ze&&(de.textures.length>1&&ve.readBuffer(ve.COLOR_ATTACHMENT0+Vt),ve.readPixels(Fe,$e,Ke,Ze,kt.convert(jn),kt.convert(bn),zt))}finally{const yn=W!==null?ee.get(W).__webglFramebuffer:null;Zt.bindFramebuffer(ve.FRAMEBUFFER,yn)}}},this.readRenderTargetPixelsAsync=async function(de,Fe,$e,Ke,Ze,zt,Jt,Vt=0){if(!(de&&de.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Rn=ee.get(de).__webglFramebuffer;if(de.isWebGLCubeRenderTarget&&Jt!==void 0&&(Rn=Rn[Jt]),Rn)if(Fe>=0&&Fe<=de.width-Ke&&$e>=0&&$e<=de.height-Ze){Zt.bindFramebuffer(ve.FRAMEBUFFER,Rn);const yn=de.textures[Vt],jn=yn.format,bn=yn.type;if(!In.textureFormatReadable(jn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!In.textureTypeReadable(bn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const zn=ve.createBuffer();ve.bindBuffer(ve.PIXEL_PACK_BUFFER,zn),ve.bufferData(ve.PIXEL_PACK_BUFFER,zt.byteLength,ve.STREAM_READ),de.textures.length>1&&ve.readBuffer(ve.COLOR_ATTACHMENT0+Vt),ve.readPixels(Fe,$e,Ke,Ze,kt.convert(jn),kt.convert(bn),0);const Bi=W!==null?ee.get(W).__webglFramebuffer:null;Zt.bindFramebuffer(ve.FRAMEBUFFER,Bi);const _r=ve.fenceSync(ve.SYNC_GPU_COMMANDS_COMPLETE,0);return ve.flush(),await sNe(ve,_r,4),ve.bindBuffer(ve.PIXEL_PACK_BUFFER,zn),ve.getBufferSubData(ve.PIXEL_PACK_BUFFER,0,zt),ve.deleteBuffer(zn),ve.deleteSync(_r),zt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(de,Fe=null,$e=0){const Ke=Math.pow(2,-$e),Ze=Math.floor(de.image.width*Ke),zt=Math.floor(de.image.height*Ke),Jt=Fe!==null?Fe.x:0,Vt=Fe!==null?Fe.y:0;Re.setTexture2D(de,0),ve.copyTexSubImage2D(ve.TEXTURE_2D,$e,0,0,Jt,Vt,Ze,zt),Zt.unbindTexture()};const gn=ve.createFramebuffer(),fn=ve.createFramebuffer();this.copyTextureToTexture=function(de,Fe,$e=null,Ke=null,Ze=0,zt=null){zt===null&&(Ze!==0?(hs("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),zt=Ze,Ze=0):zt=0);let Jt,Vt,Rn,yn,jn,bn,zn,Bi,_r;const Oi=de.isCompressedTexture?de.mipmaps[zt]:de.image;if($e!==null)Jt=$e.max.x-$e.min.x,Vt=$e.max.y-$e.min.y,Rn=$e.isBox3?$e.max.z-$e.min.z:1,yn=$e.min.x,jn=$e.min.y,bn=$e.isBox3?$e.min.z:0;else{const Ws=Math.pow(2,-Ze);Jt=Math.floor(Oi.width*Ws),Vt=Math.floor(Oi.height*Ws),de.isDataArrayTexture?Rn=Oi.depth:de.isData3DTexture?Rn=Math.floor(Oi.depth*Ws):Rn=1,yn=0,jn=0,bn=0}Ke!==null?(zn=Ke.x,Bi=Ke.y,_r=Ke.z):(zn=0,Bi=0,_r=0);const On=kt.convert(Fe.format),qt=kt.convert(Fe.type);let ei;Fe.isData3DTexture?(Re.setTexture3D(Fe,0),ei=ve.TEXTURE_3D):Fe.isDataArrayTexture||Fe.isCompressedArrayTexture?(Re.setTexture2DArray(Fe,0),ei=ve.TEXTURE_2D_ARRAY):(Re.setTexture2D(Fe,0),ei=ve.TEXTURE_2D),ve.pixelStorei(ve.UNPACK_FLIP_Y_WEBGL,Fe.flipY),ve.pixelStorei(ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Fe.premultiplyAlpha),ve.pixelStorei(ve.UNPACK_ALIGNMENT,Fe.unpackAlignment);const Bn=ve.getParameter(ve.UNPACK_ROW_LENGTH),tr=ve.getParameter(ve.UNPACK_IMAGE_HEIGHT),qs=ve.getParameter(ve.UNPACK_SKIP_PIXELS),Wi=ve.getParameter(ve.UNPACK_SKIP_ROWS),Ss=ve.getParameter(ve.UNPACK_SKIP_IMAGES);ve.pixelStorei(ve.UNPACK_ROW_LENGTH,Oi.width),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,Oi.height),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,yn),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,jn),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,bn);const Lr=de.isDataArrayTexture||de.isData3DTexture,Qs=Fe.isDataArrayTexture||Fe.isData3DTexture;if(de.isDepthTexture){const Ws=ee.get(de),Zs=ee.get(Fe),la=ee.get(Ws.__renderTarget),Te=ee.get(Zs.__renderTarget);Zt.bindFramebuffer(ve.READ_FRAMEBUFFER,la.__webglFramebuffer),Zt.bindFramebuffer(ve.DRAW_FRAMEBUFFER,Te.__webglFramebuffer);for(let ai=0;ai<Rn;ai++)Lr&&(ve.framebufferTextureLayer(ve.READ_FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ee.get(de).__webglTexture,Ze,bn+ai),ve.framebufferTextureLayer(ve.DRAW_FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ee.get(Fe).__webglTexture,zt,_r+ai)),ve.blitFramebuffer(yn,jn,Jt,Vt,zn,Bi,Jt,Vt,ve.DEPTH_BUFFER_BIT,ve.NEAREST);Zt.bindFramebuffer(ve.READ_FRAMEBUFFER,null),Zt.bindFramebuffer(ve.DRAW_FRAMEBUFFER,null)}else if(Ze!==0||de.isRenderTargetTexture||ee.has(de)){const Ws=ee.get(de),Zs=ee.get(Fe);Zt.bindFramebuffer(ve.READ_FRAMEBUFFER,gn),Zt.bindFramebuffer(ve.DRAW_FRAMEBUFFER,fn);for(let la=0;la<Rn;la++)Lr?ve.framebufferTextureLayer(ve.READ_FRAMEBUFFER,ve.COLOR_ATTACHMENT0,Ws.__webglTexture,Ze,bn+la):ve.framebufferTexture2D(ve.READ_FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ve.TEXTURE_2D,Ws.__webglTexture,Ze),Qs?ve.framebufferTextureLayer(ve.DRAW_FRAMEBUFFER,ve.COLOR_ATTACHMENT0,Zs.__webglTexture,zt,_r+la):ve.framebufferTexture2D(ve.DRAW_FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ve.TEXTURE_2D,Zs.__webglTexture,zt),Ze!==0?ve.blitFramebuffer(yn,jn,Jt,Vt,zn,Bi,Jt,Vt,ve.COLOR_BUFFER_BIT,ve.NEAREST):Qs?ve.copyTexSubImage3D(ei,zt,zn,Bi,_r+la,yn,jn,Jt,Vt):ve.copyTexSubImage2D(ei,zt,zn,Bi,yn,jn,Jt,Vt);Zt.bindFramebuffer(ve.READ_FRAMEBUFFER,null),Zt.bindFramebuffer(ve.DRAW_FRAMEBUFFER,null)}else Qs?de.isDataTexture||de.isData3DTexture?ve.texSubImage3D(ei,zt,zn,Bi,_r,Jt,Vt,Rn,On,qt,Oi.data):Fe.isCompressedArrayTexture?ve.compressedTexSubImage3D(ei,zt,zn,Bi,_r,Jt,Vt,Rn,On,Oi.data):ve.texSubImage3D(ei,zt,zn,Bi,_r,Jt,Vt,Rn,On,qt,Oi):de.isDataTexture?ve.texSubImage2D(ve.TEXTURE_2D,zt,zn,Bi,Jt,Vt,On,qt,Oi.data):de.isCompressedTexture?ve.compressedTexSubImage2D(ve.TEXTURE_2D,zt,zn,Bi,Oi.width,Oi.height,On,Oi.data):ve.texSubImage2D(ve.TEXTURE_2D,zt,zn,Bi,Jt,Vt,On,qt,Oi);ve.pixelStorei(ve.UNPACK_ROW_LENGTH,Bn),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,tr),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,qs),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,Wi),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,Ss),zt===0&&Fe.generateMipmaps&&ve.generateMipmap(ei),Zt.unbindTexture()},this.initRenderTarget=function(de){ee.get(de).__webglFramebuffer===void 0&&Re.setupRenderTarget(de)},this.initTexture=function(de){de.isCubeTexture?Re.setTextureCube(de,0):de.isData3DTexture?Re.setTexture3D(de,0):de.isDataArrayTexture||de.isCompressedArrayTexture?Re.setTexture2DArray(de,0):Re.setTexture2D(de,0),Zt.unbindTexture()},this.resetState=function(){U=0,V=0,W=null,Zt.reset(),vn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Sl}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=di._getDrawingBufferColorSpace(e),t.unpackColorSpace=di._getUnpackColorSpace()}}const ene=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:zM,AddEquation:vl,AddOperation:H2,AdditiveAnimationBlendMode:W2,AdditiveBlending:bm,AgXToneMapping:QE,AlphaFormat:tR,AlwaysCompare:oR,AlwaysDepth:hv,AlwaysStencilFunc:Xw,AmbientLight:_F,AnimationAction:fV,AnimationClip:db,AnimationLoader:yte,AnimationMixer:Mte,AnimationObjectGroup:Ste,AnimationUtils:gte,ArcCurve:X9,ArrayCamera:CF,ArrowHelper:Hte,AttachedBindMode:TB,Audio:lV,AudioAnalyser:_te,AudioContext:TF,AudioListener:oV,AudioLoader:xte,AxesHelper:Xte,BackSide:Er,BasicDepthPacking:sp,BasicShadowMap:UE,BatchedMesh:z9,Bone:fR,BooleanKeyframeTrack:$v,Box2:Pte,Box3:Ns,Box3Helper:zte,BoxGeometry:Id,BoxHelper:kte,BufferAttribute:Gi,BufferGeometry:wi,BufferGeometryLoader:rV,ByteType:am,Cache:Uf,Camera:Eb,CameraHelper:Ute,CanvasTexture:V9,CapsuleGeometry:gR,CatmullRomCurve3:Z9,CineonToneMapping:qE,CircleGeometry:yR,ClampToEdgeWrapping:ps,Clock:BR,Color:en,ColorKeyframeTrack:vF,ColorManagement:di,CompressedArrayTexture:ute,CompressedCubeTexture:cte,CompressedTexture:mR,CompressedTextureLoader:vte,ConeGeometry:qM,ConstantAlphaFactor:f9,ConstantColorFactor:h9,Controls:Zte,CubeCamera:J2,CubeDepthTexture:iF,CubeReflectionMapping:_u,CubeRefractionMapping:wh,CubeTexture:T0,CubeTextureLoader:tV,CubeUVReflectionMapping:Am,CubicBezierCurve:sF,CubicBezierCurve3:j9,CubicInterpolant:q9,CullFaceBack:Uw,CullFaceFront:U2,CullFaceFrontBack:Bee,CullFaceNone:O2,Curve:jd,CurvePath:K9,CustomBlending:nv,CustomToneMapping:X2,CylinderGeometry:Pb,Cylindrical:Rte,Data3DTexture:lR,DataArrayTexture:ZM,DataTexture:xu,DataTextureLoader:xF,DataUtils:Xy,DecrementStencilOp:T9,DecrementWrapStencilOp:w9,DefaultLoadingManager:Sx,DepthFormat:Xo,DepthStencilFormat:bl,DepthTexture:po,DetachedBindMode:m9,DirectionalLight:NR,DirectionalLightHelper:Ote,DiscreteInterpolant:Q9,DodecahedronGeometry:vR,DoubleSide:fr,DstAlphaFactor:WE,DstColorFactor:jE,DynamicCopyUsage:Wee,DynamicDrawUsage:bh,DynamicReadUsage:Vee,EdgesGeometry:H9,EllipseCurve:xR,EqualCompare:rR,EqualDepth:qx,EqualStencilFunc:D9,EquirectangularReflectionMapping:Mm,EquirectangularRefractionMapping:h0,Euler:Mu,EventDispatcher:wl,ExternalTexture:rF,ExtrudeGeometry:bR,FileLoader:el,Float16BufferAttribute:$2,Float32BufferAttribute:qn,FloatType:wr,Fog:YM,FogExp2:hR,FramebufferTexture:pR,FrontSide:wo,Frustum:Kv,FrustumArray:$M,GLBufferAttribute:wte,GLSL1:jee,GLSL3:CB,GreaterCompare:sR,GreaterDepth:eb,GreaterEqualCompare:wb,GreaterEqualDepth:Qx,GreaterEqualStencilFunc:L9,GreaterStencilFunc:B9,GridHelper:Ite,Group:_h,HalfFloatType:zi,HemisphereLight:bF,HemisphereLightHelper:Lte,IcosahedronGeometry:QM,ImageBitmapLoader:aV,ImageLoader:bM,ImageUtils:O9,IncrementStencilOp:A9,IncrementWrapStencilOp:C9,InstancedBufferAttribute:Vc,InstancedBufferGeometry:iV,InstancedInterleavedBuffer:pV,InstancedMesh:Q2,Int16BufferAttribute:rte,Int32BufferAttribute:ste,Int8BufferAttribute:tte,IntType:Ao,InterleavedBuffer:Rb,InterleavedBufferAttribute:Tm,Interpolant:Nb,InterpolateDiscrete:ab,InterpolateLinear:ob,InterpolateSmooth:aw,InterpolationSamplingMode:Kee,InterpolationSamplingType:Yee,InvertStencilOp:E9,KeepStencilOp:Og,KeyframeTrack:Nh,LOD:k9,LatheGeometry:_R,Layers:cb,LessCompare:Tb,LessDepth:Jx,LessEqualCompare:Cb,LessEqualDepth:_m,LessEqualStencilFunc:N9,LessStencilFunc:P9,Light:w0,LightProbe:AF,Line:Cm,Line3:Hc,LineBasicMaterial:El,LineCurve:aF,LineCurve3:Y9,LineDashedMaterial:RR,LineLoop:eF,LineSegments:Zd,LinearFilter:Jn,LinearInterpolant:yF,LinearMipMapLinearFilter:kw,LinearMipMapNearestFilter:Iee,LinearMipmapLinearFilter:Vo,LinearMipmapNearestFilter:sm,LinearSRGBColorSpace:Su,LinearToneMapping:$E,LinearTransfer:Iv,Loader:rl,LoaderUtils:Qg,LoadingManager:PR,LoopOnce:y9,LoopPingPong:x9,LoopRepeat:v9,MOUSE:Ly,Material:_a,MaterialLoader:iA,MathUtils:Wl,Matrix2:rA,Matrix3:Li,Matrix4:Mn,MaxEquation:z2,Mesh:Fr,MeshBasicMaterial:La,MeshDepthMaterial:pF,MeshDistanceMaterial:mF,MeshLambertMaterial:tA,MeshMatcapMaterial:gF,MeshNormalMaterial:ER,MeshPhongMaterial:dF,MeshPhysicalMaterial:Kc,MeshStandardMaterial:mo,MeshToonMaterial:fF,MinEquation:k2,MirroredRepeatWrapping:jf,MixOperation:V2,MultiplyBlending:c0,MultiplyOperation:Sb,NearestFilter:xr,NearestMipMapLinearFilter:Lee,NearestMipMapNearestFilter:Fee,NearestMipmapLinearFilter:xh,NearestMipmapNearestFilter:Mb,NeutralToneMapping:eR,NeverCompare:iR,NeverDepth:$x,NeverStencilFunc:R9,NoBlending:Oa,NoColorSpace:xl,NoNormalPacking:ow,NoToneMapping:ho,NormalAnimationBlendMode:nR,NormalBlending:Al,NormalGAPacking:_9,NormalRGPacking:Y2,NotEqualCompare:aR,NotEqualDepth:tb,NotEqualStencilFunc:F9,NumberKeyframeTrack:Ov,Object3D:Br,ObjectLoader:sV,ObjectSpaceNormalMap:j2,OctahedronGeometry:eA,OneFactor:VE,OneMinusConstantAlphaFactor:p9,OneMinusConstantColorFactor:d9,OneMinusDstAlphaFactor:ZE,OneMinusDstColorFactor:YE,OneMinusSrcAlphaFactor:Kx,OneMinusSrcColorFactor:XE,OrthographicCamera:Tl,PCFShadowMap:tv,PCFSoftShadowMap:YS,PMREMGenerator:Y5,Path:Zw,PerspectiveCamera:ds,Plane:Xl,PlaneGeometry:ap,PlaneHelper:Vte,PointLight:DR,PointLightHelper:Fte,Points:tF,PointsMaterial:JM,PolarGridHelper:Gte,PolyhedronGeometry:C0,PositionalAudio:uV,PropertyBinding:Jr,PropertyMixer:cV,QuadraticBezierCurve:oF,QuadraticBezierCurve3:lF,Quaternion:ba,QuaternionKeyframeTrack:Uv,QuaternionLinearInterpolant:eV,R11_EAC_Format:mv,RED_GREEN_RGTC2_Format:f0,RED_RGTC1_Format:Bv,REVISION:Xd,RG11_EAC_Format:d0,RGBADepthPacking:Gee,RGBAFormat:Vr,RGBAIntegerFormat:Yv,RGBA_ASTC_10x10_Format:Rv,RGBA_ASTC_10x5_Format:Cv,RGBA_ASTC_10x6_Format:wv,RGBA_ASTC_10x8_Format:Ev,RGBA_ASTC_12x10_Format:Pv,RGBA_ASTC_12x12_Format:Dv,RGBA_ASTC_4x4_Format:vv,RGBA_ASTC_5x4_Format:xv,RGBA_ASTC_5x5_Format:bv,RGBA_ASTC_6x5_Format:_v,RGBA_ASTC_6x6_Format:Sv,RGBA_ASTC_8x5_Format:Mv,RGBA_ASTC_8x6_Format:Av,RGBA_ASTC_8x8_Format:Tv,RGBA_BPTC_Format:Nv,RGBA_ETC2_EAC_Format:pv,RGBA_PVRTC_2BPPV1_Format:sb,RGBA_PVRTC_4BPPV1_Format:rb,RGBA_S3TC_DXT1_Format:um,RGBA_S3TC_DXT3_Format:cm,RGBA_S3TC_DXT5_Format:hm,RGBDepthPacking:Oee,RGBFormat:Ab,RGBIntegerFormat:g9,RGB_BPTC_SIGNED_Format:zw,RGB_BPTC_UNSIGNED_Format:Vw,RGB_ETC1_Format:dv,RGB_ETC2_Format:fv,RGB_PVRTC_2BPPV1_Format:ib,RGB_PVRTC_4BPPV1_Format:nb,RGB_S3TC_DXT1_Format:lm,RGDepthPacking:Uee,RGFormat:_l,RGIntegerFormat:jv,RawShaderMaterial:hF,Ray:Im,Raycaster:FR,RectAreaLight:SF,RedFormat:rp,RedIntegerFormat:A0,ReinhardToneMapping:JE,RenderTarget:Wd,RenderTarget3D:Ate,RepeatWrapping:Xc,ReplaceStencilOp:M9,ReverseSubtractEquation:zE,RingGeometry:SR,SIGNED_R11_EAC_Format:gv,SIGNED_RED_GREEN_RGTC2_Format:Lv,SIGNED_RED_RGTC1_Format:Fv,SIGNED_RG11_EAC_Format:yv,SRGBColorSpace:Ps,SRGBTransfer:Hn,Scene:Wc,ShaderChunk:dr,ShaderLib:Ff,ShaderMaterial:Ds,ShadowMaterial:cF,Shape:iv,ShapeGeometry:MR,ShapePath:Wte,ShapeUtils:Cd,ShortType:om,Skeleton:KM,SkeletonHelper:Nte,SkinnedMesh:q2,Source:Zg,Sphere:fo,SphereGeometry:Db,Spherical:$w,SphericalHarmonics3:MF,SplineCurve:uF,SpotLight:Bb,SpotLightHelper:Dte,Sprite:U9,SpriteMaterial:dR,SrcAlphaFactor:Yx,SrcAlphaSaturateFactor:KE,SrcColorFactor:HE,StaticCopyUsage:Xee,StaticDrawUsage:p0,StaticReadUsage:zee,StereoCamera:bte,StreamCopyUsage:Zee,StreamDrawUsage:kee,StreamReadUsage:Hee,StringKeyframeTrack:Jv,SubtractEquation:kE,SubtractiveBlending:u0,TOUCH:Iy,TangentSpaceNormalMap:Fd,TetrahedronGeometry:AR,Texture:pr,TextureLoader:nA,TextureUtils:jte,Timer:Ete,TimestampQuery:Td,TorusGeometry:TR,TorusKnotGeometry:CR,Triangle:Vs,TriangleFanDrawMode:Hw,TriangleStripDrawMode:Z2,TrianglesDrawMode:b9,TubeGeometry:wR,UVMapping:Sm,Uint16BufferAttribute:uR,Uint32BufferAttribute:cR,Uint8BufferAttribute:nte,Uint8ClampedBufferAttribute:ite,Uniform:mi,UniformsGroup:Cte,UniformsLib:Vn,UniformsUtils:vM,UnsignedByteType:br,UnsignedInt101111Type:WM,UnsignedInt248Type:jl,UnsignedInt5999Type:XM,UnsignedIntType:qr,UnsignedShort4444Type:VM,UnsignedShort5551Type:HM,UnsignedShortType:zc,VSMShadowMap:Ad,Vector2:rt,Vector3:re,Vector4:si,VectorKeyframeTrack:kv,VideoFrameTexture:lte,VideoTexture:nF,WebGL3DRenderTarget:Qee,WebGLArrayRenderTarget:qee,WebGLCoordinateSystem:Sl,WebGLCubeRenderTarget:jM,WebGLRenderTarget:Nr,WebGLRenderer:mV,WebGLUtils:Qte,WebGPUCoordinateSystem:ic,WebXRController:$S,WireframeGeometry:$9,WrapAroundEnding:mM,ZeroCurvatureEnding:Vy,ZeroFactor:Bf,ZeroSlopeEnding:Hy,ZeroStencilOp:S9,createCanvasElement:K2,error:Tt,getConsoleFunction:Jee,log:lb,setConsoleFunction:$ee,warn:mt,warnOnce:hs},Symbol.toStringTag,{value:"Module"}));var hO={exports:{}},dO={},fO={exports:{}},pO={};var HZ;function JGe(){if(HZ)return pO;HZ=1;var n=PE();function e(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var t=typeof Object.is=="function"?Object.is:e,i=n.useState,r=n.useEffect,s=n.useLayoutEffect,a=n.useDebugValue;function o(d,f){var m=f(),y=i({inst:{value:m,getSnapshot:f}}),_=y[0].inst,S=y[1];return s(function(){_.value=m,_.getSnapshot=f,l(_)&&S({inst:_})},[d,m,f]),r(function(){return l(_)&&S({inst:_}),d(function(){l(_)&&S({inst:_})})},[d]),a(m),m}function l(d){var f=d.getSnapshot;d=d.value;try{var m=f();return!t(d,m)}catch{return!0}}function u(d,f){return f()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return pO.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:c,pO}var XZ;function qGe(){return XZ||(XZ=1,fO.exports=JGe()),fO.exports}var WZ;function QGe(){if(WZ)return dO;WZ=1;var n=PE(),e=qGe();function t(u,c){return u===c&&(u!==0||1/u===1/c)||u!==u&&c!==c}var i=typeof Object.is=="function"?Object.is:t,r=e.useSyncExternalStore,s=n.useRef,a=n.useEffect,o=n.useMemo,l=n.useDebugValue;return dO.useSyncExternalStoreWithSelector=function(u,c,d,f,m){var y=s(null);if(y.current===null){var _={hasValue:!1,value:null};y.current=_}else _=y.current;y=o(function(){function b(R){if(!M){if(M=!0,w=R,R=f(R),m!==void 0&&_.hasValue){var P=_.value;if(m(P,R))return T=P}return T=R}if(P=T,i(w,R))return P;var I=f(R);return m!==void 0&&m(P,I)?(w=R,P):(w=R,T=I)}var M=!1,w,T,E=d===void 0?null:d;return[function(){return b(c())},E===null?void 0:function(){return b(E())}]},[c,d,f,m]);var S=r(u,y[0],y[1]);return a(function(){_.hasValue=!0,_.value=S},[S]),l(S),S},dO}var ZZ;function eOe(){return ZZ||(ZZ=1,hO.exports=QGe()),hO.exports}var tOe=eOe();const nOe=_0(tOe),jZ=n=>{let e;const t=new Set,i=(u,c)=>{const d=typeof u=="function"?u(e):u;if(!Object.is(d,e)){const f=e;e=c??(typeof d!="object"||d===null)?d:Object.assign({},e,d),t.forEach(m=>m(e,f))}},r=()=>e,o={setState:i,getState:r,getInitialState:()=>l,subscribe:u=>(t.add(u),()=>t.delete(u))},l=e=n(i,r,o);return o},tne=(n=>n?jZ(n):jZ),{useSyncExternalStoreWithSelector:iOe}=nOe,rOe=n=>n;function sOe(n,e=rOe,t){const i=iOe(n.subscribe,n.getState,n.getInitialState,e,t);return Ie.useDebugValue(i),i}const YZ=(n,e)=>{const t=tne(n),i=(r,s=e)=>sOe(t,r,s);return Object.assign(i,t),i},nne=((n,e)=>n?YZ(n,e):YZ),aOe=n=>typeof n=="object"&&typeof n.then=="function",Mx=[];function ine(n,e,t=(i,r)=>i===r){if(n===e)return!0;if(!n||!e)return!1;const i=n.length;if(e.length!==i)return!1;for(let r=0;r<i;r++)if(!t(n[r],e[r]))return!1;return!0}function rne(n,e=null,t=!1,i={}){e===null&&(e=[n]);for(const s of Mx)if(ine(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return i.lifespan&&i.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,i.lifespan)),s.response;if(!t)throw s.promise}const r={keys:e,equal:i.equal,remove:()=>{const s=Mx.indexOf(r);s!==-1&&Mx.splice(s,1)},promise:(aOe(n)?n:n(...e)).then(s=>{r.response=s,i.lifespan&&i.lifespan>0&&(r.timeout=setTimeout(r.remove,i.lifespan))}).catch(s=>r.error=s)};if(Mx.push(r),!t)throw r.promise}const oOe=(n,e,t)=>rne(n,e,!1,t),lOe=(n,e,t)=>{rne(n,e,!0,t)},uOe=n=>{if(n===void 0||n.length===0)Mx.splice(0,Mx.length);else{const e=Mx.find(t=>ine(n,t.keys,t.equal));e&&e.remove()}};var J5=Tq();const cOe=_0(J5);function gV(n,e,t){if(!n)return;if(t(n)===!0)return n;let i=e?n.return:n.child;for(;i;){const r=gV(i,e,t);if(r)return r;i=e?null:i.sibling}}function sne(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const yV=sne(G.createContext(null));class ane extends G.Component{render(){return G.createElement(yV.Provider,{value:this._reactInternals},this.props.children)}}function one(){const n=G.useContext(yV);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=G.useId();return G.useMemo(()=>{for(const t of[n,n?.alternate]){if(!t)continue;const i=gV(t,!1,r=>{let s=r.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(i)return i}},[n,e])}const hOe=Symbol.for("react.context"),dOe=n=>n!==null&&typeof n=="object"&&"$$typeof"in n&&n.$$typeof===hOe;function fOe(){const n=one(),[e]=G.useState(()=>new Map);e.clear();let t=n;for(;t;){const i=t.type;dOe(i)&&i!==yV&&!e.has(i)&&e.set(i,G.use(sne(i))),t=t.return}return e}function pOe(){const n=fOe();return G.useMemo(()=>Array.from(n.keys()).reduce((e,t)=>i=>G.createElement(e,null,G.createElement(t.Provider,{...i,value:n.get(t)})),e=>G.createElement(ane,{...e})),[n])}function lne(n){let e=n.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const une=n=>n&&n.isOrthographicCamera,mOe=n=>n&&n.hasOwnProperty("current"),gOe=n=>n!=null&&(typeof n=="string"||typeof n=="number"||n.isColor),LR=((n,e)=>typeof window<"u"&&(((n=window.document)==null?void 0:n.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?G.useLayoutEffect:G.useEffect;function vV(n){const e=G.useRef(n);return LR(()=>{e.current=n},[n]),e}function yOe(){const n=one(),e=pOe();return G.useMemo(()=>({children:t})=>{const r=!!gV(n,!0,s=>s.type===G.StrictMode)?G.StrictMode:G.Fragment;return $.jsx(r,{children:$.jsx(e,{children:t})})},[n,e])}function vOe({set:n}){return LR(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}const xOe=(n=>(n=class extends G.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}},n.getDerivedStateFromError=()=>({error:!0}),n))();function cne(n){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],t),n[1]):n}function aS(n){var e;return(e=n.__r3f)==null?void 0:e.root.getState()}const Fa={obj:n=>n===Object(n)&&!Fa.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,nul:n=>n===null,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:i="reference",strict:r=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(Fa.str(n)||Fa.num(n)||Fa.boo(n))return n===e;const s=Fa.obj(n);if(s&&i==="reference")return n===e;const a=Fa.arr(n);if(a&&t==="reference")return n===e;if((a||s)&&n===e)return!0;let o;for(o in n)if(!(o in e))return!1;if(s&&t==="shallow"&&i==="shallow"){for(o in r?e:n)if(!Fa.equ(n[o],e[o],{strict:r,objects:"reference"}))return!1}else for(o in r?e:n)if(n[o]!==e[o])return!1;if(Fa.und(o)){if(a&&n.length===0&&e.length===0||s&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function bOe(n){const e={nodes:{},materials:{},meshes:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material),t.isMesh&&!e.meshes[t.name]&&(e.meshes[t.name]=t)}),e}function _Oe(n){n.type!=="Scene"&&(n.dispose==null||n.dispose());for(const e in n){const t=n[e];t?.type!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const hne=["children","key","ref"];function SOe(n){const e={};for(const t in n)hne.includes(t)||(e[t]=n[t]);return e}function DB(n,e,t,i){const r=n;let s=r?.__r3f;return s||(s={root:e,type:t,parent:null,children:[],props:SOe(i),object:r,eventCount:0,handlers:{},isHidden:!1},r&&(r.__r3f=s)),s}function Jw(n,e){if(!e.includes("-"))return{root:n,key:e,target:n[e]};if(e in n)return{root:n,key:e,target:n[e]};let t=n;const i=e.split("-");for(const r of i){if(typeof t!="object"||t===null){if(t!==void 0){const s=i.slice(i.indexOf(r)).join("-");return{root:t,key:s,target:void 0}}return{root:n,key:e,target:void 0}}e=r,n=t,t=t[e]}return{root:n,key:e,target:t}}const KZ=/-\d+$/;function NB(n,e){if(Fa.str(e.props.attach)){if(KZ.test(e.props.attach)){const r=e.props.attach.replace(KZ,""),{root:s,key:a}=Jw(n.object,r);Array.isArray(s[a])||(s[a]=[])}const{root:t,key:i}=Jw(n.object,e.props.attach);e.previousAttach=t[i],t[i]=e.object}else Fa.fun(e.props.attach)&&(e.previousAttach=e.props.attach(n.object,e.object))}function BB(n,e){if(Fa.str(e.props.attach)){const{root:t,key:i}=Jw(n.object,e.props.attach),r=e.previousAttach;r===void 0?delete t[i]:t[i]=r}else e.previousAttach==null||e.previousAttach(n.object,e.object);delete e.previousAttach}const q5=[...hne,"args","dispose","attach","object","onUpdate","dispose"],$Z=new Map;function MOe(n){let e=$Z.get(n.constructor);try{e||(e=new n.constructor,$Z.set(n.constructor,e))}catch{}return e}function AOe(n,e){const t={};for(const i in e)if(!q5.includes(i)&&!Fa.equ(e[i],n.props[i])){t[i]=e[i];for(const r in e)r.startsWith(`${i}-`)&&(t[r]=e[r])}for(const i in n.props){if(q5.includes(i)||e.hasOwnProperty(i))continue;const{root:r,key:s}=Jw(n.object,i);if(r.constructor&&r.constructor.length===0){const a=MOe(r);Fa.und(a)||(t[s]=a[s])}else t[s]=0}return t}const TOe=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],COe=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function xd(n,e){var t;const i=n.__r3f,r=i&&lne(i).getState(),s=i?.eventCount;for(const o in e){let l=e[o];if(q5.includes(o))continue;if(i&&COe.test(o)){typeof l=="function"?i.handlers[o]=l:delete i.handlers[o],i.eventCount=Object.keys(i.handlers).length;continue}if(l===void 0)continue;let{root:u,key:c,target:d}=Jw(n,o);if(d===void 0&&(typeof u!="object"||u===null))throw Error(`R3F: Cannot set "${o}". Ensure it is an object before setting "${c}".`);if(d instanceof cb&&l instanceof cb)d.mask=l.mask;else if(d instanceof en&&gOe(l))d.set(l);else if(d!==null&&typeof d=="object"&&typeof d.set=="function"&&typeof d.copy=="function"&&l!=null&&l.constructor&&d.constructor===l.constructor)d.copy(l);else if(d!==null&&typeof d=="object"&&typeof d.set=="function"&&Array.isArray(l))typeof d.fromArray=="function"?d.fromArray(l):d.set(...l);else if(d!==null&&typeof d=="object"&&typeof d.set=="function"&&typeof l=="number")typeof d.setScalar=="function"?d.setScalar(l):d.set(l);else{var a;u[c]=l,r&&!r.linear&&TOe.includes(c)&&(a=u[c])!=null&&a.isTexture&&u[c].format===Vr&&u[c].type===br&&(u[c].colorSpace=Ps)}}if(i!=null&&i.parent&&r!=null&&r.internal&&(t=i.object)!=null&&t.isObject3D&&s!==i.eventCount){const o=i.object,l=r.internal.interaction.indexOf(o);l>-1&&r.internal.interaction.splice(l,1),i.eventCount&&o.raycast!==null&&r.internal.interaction.push(o)}return i&&i.props.attach===void 0&&(i.object.isBufferGeometry?i.props.attach="geometry":i.object.isMaterial&&(i.props.attach="material")),i&&aA(i),n}function aA(n){var e;if(!n.parent)return;n.props.onUpdate==null||n.props.onUpdate(n.object);const t=(e=n.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function dne(n,e){n.manual||(une(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix())}const Xu=n=>n?.isObject3D;function bD(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function fne(n,e,t,i){const r=t.get(e);r&&(t.delete(e),t.size===0&&(n.delete(i),r.target.releasePointerCapture(i)))}function wOe(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(i=>i!==e),t.initialHits=t.initialHits.filter(i=>i!==e),t.hovered.forEach((i,r)=>{(i.eventObject===e||i.object===e)&&t.hovered.delete(r)}),t.capturedMap.forEach((i,r)=>{fne(t.capturedMap,e,i,r)})}function EOe(n){function e(l){const{internal:u}=n.getState(),c=l.offsetX-u.initialClick[0],d=l.offsetY-u.initialClick[1];return Math.round(Math.sqrt(c*c+d*d))}function t(l){return l.filter(u=>["Move","Over","Enter","Out","Leave"].some(c=>{var d;return(d=u.__r3f)==null?void 0:d.handlers["onPointer"+c]}))}function i(l,u){const c=n.getState(),d=new Set,f=[],m=u?u(c.internal.interaction):c.internal.interaction;for(let b=0;b<m.length;b++){const M=aS(m[b]);M&&(M.raycaster.camera=void 0)}c.previousRoot||c.events.compute==null||c.events.compute(l,c);function y(b){const M=aS(b);if(!M||!M.events.enabled||M.raycaster.camera===null)return[];if(M.raycaster.camera===void 0){var w;M.events.compute==null||M.events.compute(l,M,(w=M.previousRoot)==null?void 0:w.getState()),M.raycaster.camera===void 0&&(M.raycaster.camera=null)}return M.raycaster.camera?M.raycaster.intersectObject(b,!0):[]}let _=m.flatMap(y).sort((b,M)=>{const w=aS(b.object),T=aS(M.object);return!w||!T?b.distance-M.distance:T.events.priority-w.events.priority||b.distance-M.distance}).filter(b=>{const M=bD(b);return d.has(M)?!1:(d.add(M),!0)});c.events.filter&&(_=c.events.filter(_,c));for(const b of _){let M=b.object;for(;M;){var S;(S=M.__r3f)!=null&&S.eventCount&&f.push({...b,eventObject:M}),M=M.parent}}if("pointerId"in l&&c.internal.capturedMap.has(l.pointerId))for(let b of c.internal.capturedMap.get(l.pointerId).values())d.has(bD(b.intersection))||f.push(b.intersection);return f}function r(l,u,c,d){if(l.length){const f={stopped:!1};for(const m of l){let y=aS(m.object);if(y||m.object.traverseAncestors(_=>{const S=aS(_);if(S)return y=S,!1}),y){const{raycaster:_,pointer:S,camera:b,internal:M}=y,w=new re(S.x,S.y,0).unproject(b),T=B=>{var N,U;return(N=(U=M.capturedMap.get(B))==null?void 0:U.has(m.eventObject))!=null?N:!1},E=B=>{const N={intersection:m,target:u.target};M.capturedMap.has(B)?M.capturedMap.get(B).set(m.eventObject,N):M.capturedMap.set(B,new Map([[m.eventObject,N]])),u.target.setPointerCapture(B)},R=B=>{const N=M.capturedMap.get(B);N&&fne(M.capturedMap,m.eventObject,N,B)};let P={};for(let B in u){let N=u[B];typeof N!="function"&&(P[B]=N)}let I={...m,...P,pointer:S,intersections:l,stopped:f.stopped,delta:c,unprojectedPoint:w,ray:_.ray,camera:b,stopPropagation(){const B="pointerId"in u&&M.capturedMap.get(u.pointerId);if((!B||B.has(m.eventObject))&&(I.stopped=f.stopped=!0,M.hovered.size&&Array.from(M.hovered.values()).find(N=>N.eventObject===m.eventObject))){const N=l.slice(0,l.indexOf(m));s([...N,m])}},target:{hasPointerCapture:T,setPointerCapture:E,releasePointerCapture:R},currentTarget:{hasPointerCapture:T,setPointerCapture:E,releasePointerCapture:R},nativeEvent:u};if(d(I),f.stopped===!0)break}}}return l}function s(l){const{internal:u}=n.getState();for(const c of u.hovered.values())if(!l.length||!l.find(d=>d.object===c.object&&d.index===c.index&&d.instanceId===c.instanceId)){const f=c.eventObject.__r3f;if(u.hovered.delete(bD(c)),f!=null&&f.eventCount){const m=f.handlers,y={...c,intersections:l};m.onPointerOut==null||m.onPointerOut(y),m.onPointerLeave==null||m.onPointerLeave(y)}}}function a(l,u){for(let c=0;c<u.length;c++){const d=u[c].__r3f;d==null||d.handlers.onPointerMissed==null||d.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return u=>{const{internal:c}=n.getState();"pointerId"in u&&c.capturedMap.has(u.pointerId)&&requestAnimationFrame(()=>{c.capturedMap.has(u.pointerId)&&(c.capturedMap.delete(u.pointerId),s([]))})}}return function(c){const{onPointerMissed:d,internal:f}=n.getState();f.lastEvent.current=c;const m=l==="onPointerMove",y=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",S=i(c,m?t:void 0),b=y?e(c):0;l==="onPointerDown"&&(f.initialClick=[c.offsetX,c.offsetY],f.initialHits=S.map(w=>w.eventObject)),y&&!S.length&&b<=2&&(a(c,f.interaction),d&&d(c)),m&&s(S);function M(w){const T=w.eventObject,E=T.__r3f;if(!(E!=null&&E.eventCount))return;const R=E.handlers;if(m){if(R.onPointerOver||R.onPointerEnter||R.onPointerOut||R.onPointerLeave){const P=bD(w),I=f.hovered.get(P);I?I.stopped&&w.stopPropagation():(f.hovered.set(P,w),R.onPointerOver==null||R.onPointerOver(w),R.onPointerEnter==null||R.onPointerEnter(w))}R.onPointerMove==null||R.onPointerMove(w)}else{const P=R[l];P?(!y||f.initialHits.includes(T))&&(a(c,f.interaction.filter(I=>!f.initialHits.includes(I))),P(w)):y&&f.initialHits.includes(T)&&a(c,f.interaction.filter(I=>!f.initialHits.includes(I)))}}r(S,c,b,M)}}return{handlePointer:o}}const JZ=n=>!!(n!=null&&n.render),xV=G.createContext(null),ROe=(n,e)=>{const t=nne((o,l)=>{const u=new re,c=new re,d=new re;function f(b=l().camera,M=c,w=l().size){const{width:T,height:E,top:R,left:P}=w,I=T/E;M.isVector3?d.copy(M):d.set(...M);const B=b.getWorldPosition(u).distanceTo(d);if(une(b))return{width:T/b.zoom,height:E/b.zoom,top:R,left:P,factor:1,distance:B,aspect:I};{const N=b.fov*Math.PI/180,U=2*Math.tan(N/2)*B,V=U*(T/E);return{width:V,height:U,top:R,left:P,factor:T/V,distance:B,aspect:I}}}let m;const y=b=>o(M=>({performance:{...M.performance,current:b}})),_=new rt;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(b=1)=>n(l(),b),advance:(b,M)=>e(b,M,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new BR,pointer:_,mouse:_,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const b=l();m&&clearTimeout(m),b.performance.current!==b.performance.min&&y(b.performance.min),m=setTimeout(()=>y(l().performance.max),b.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:b=>o(M=>({...M,events:{...M.events,...b}})),setSize:(b,M,w=0,T=0)=>{const E=l().camera,R={width:b,height:M,top:w,left:T};o(P=>({size:R,viewport:{...P.viewport,...f(E,c,R)}}))},setDpr:b=>o(M=>{const w=cne(b);return{viewport:{...M.viewport,dpr:w,initialDpr:M.viewport.initialDpr||w}}}),setFrameloop:(b="always")=>{const M=l().clock;M.stop(),M.elapsedTime=0,b!=="never"&&(M.start(),M.elapsedTime=0),o(()=>({frameloop:b}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:G.createRef(),active:!1,frames:0,priority:0,subscribe:(b,M,w)=>{const T=l().internal;return T.priority=T.priority+(M>0?1:0),T.subscribers.push({ref:b,priority:M,store:w}),T.subscribers=T.subscribers.sort((E,R)=>E.priority-R.priority),()=>{const E=l().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(M>0?1:0),E.subscribers=E.subscribers.filter(R=>R.ref!==b))}}}}}),i=t.getState();let r=i.size,s=i.viewport.dpr,a=i.camera;return t.subscribe(()=>{const{camera:o,size:l,viewport:u,gl:c,set:d}=t.getState();if(l.width!==r.width||l.height!==r.height||u.dpr!==s){r=l,s=u.dpr,dne(o,l),u.dpr>0&&c.setPixelRatio(u.dpr);const f=typeof HTMLCanvasElement<"u"&&c.domElement instanceof HTMLCanvasElement;c.setSize(l.width,l.height,f)}o!==a&&(a=o,d(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(o)}})))}),t.subscribe(o=>n(o)),t};function bV(){const n=G.useContext(xV);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function ir(n=t=>t,e){return bV()(n,e)}function rs(n,e=0){const t=bV(),i=t.getState().internal.subscribe,r=vV(n);return LR(()=>i(r,e,t),[e,i,t]),null}const qZ=new WeakMap,POe=n=>{var e;return typeof n=="function"&&(n==null||(e=n.prototype)==null?void 0:e.constructor)===n};function pne(n,e){return function(t,...i){let r;return POe(t)?(r=qZ.get(t),r||(r=new t,qZ.set(t,r))):r=t,n&&n(r),Promise.all(i.map(s=>new Promise((a,o)=>r.load(s,l=>{Xu(l?.scene)&&Object.assign(l,bOe(l.scene)),a(l)},e,l=>o(new Error(`Could not load ${s}: ${l?.message}`))))))}}function Gd(n,e,t,i){const r=Array.isArray(e)?e:[e],s=oOe(pne(t,i),[n,...r],{equal:Fa.equ});return Array.isArray(e)?s:s[0]}Gd.preload=function(n,e,t){const i=Array.isArray(e)?e:[e];return lOe(pne(t),[n,...i])};Gd.clear=function(n,e){const t=Array.isArray(e)?e:[e];return uOe([n,...t])};const DOe=1,NOe=8,BOe=32,FOe=2;var LOe={version:"9.5.0"};function IOe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var QZ={exports:{}},ej={exports:{}},tj;function GOe(){return tj||(tj=1,(function(n){n.exports=function(e){function t(g,v,C,D){return new OA(g,v,C,D)}function i(){}function r(g){var v="https://react.dev/errors/"+g;if(1<arguments.length){v+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)v+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+g+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(g){var v=g,C=g;if(g.alternate)for(;v.return;)v=v.return;else{g=v;do v=g,(v.flags&4098)!==0&&(C=v.return),g=v.return;while(g)}return v.tag===3?C:null}function a(g){if(s(g)!==g)throw Error(r(188))}function o(g){var v=g.alternate;if(!v){if(v=s(g),v===null)throw Error(r(188));return v!==g?null:g}for(var C=g,D=v;;){var k=C.return;if(k===null)break;var X=k.alternate;if(X===null){if(D=k.return,D!==null){C=D;continue}break}if(k.child===X.child){for(X=k.child;X;){if(X===C)return a(k),g;if(X===D)return a(k),v;X=X.sibling}throw Error(r(188))}if(C.return!==D.return)C=k,D=X;else{for(var fe=!1,Xe=k.child;Xe;){if(Xe===C){fe=!0,C=k,D=X;break}if(Xe===D){fe=!0,D=k,C=X;break}Xe=Xe.sibling}if(!fe){for(Xe=X.child;Xe;){if(Xe===C){fe=!0,C=X,D=k;break}if(Xe===D){fe=!0,D=X,C=k;break}Xe=Xe.sibling}if(!fe)throw Error(r(189))}}if(C.alternate!==D)throw Error(r(190))}if(C.tag!==3)throw Error(r(188));return C.stateNode.current===C?g:v}function l(g){var v=g.tag;if(v===5||v===26||v===27||v===6)return g;for(g=g.child;g!==null;){if(v=l(g),v!==null)return v;g=g.sibling}return null}function u(g){var v=g.tag;if(v===5||v===26||v===27||v===6)return g;for(g=g.child;g!==null;){if(g.tag!==4&&(v=u(g),v!==null))return v;g=g.sibling}return null}function c(g){return g===null||typeof g!="object"?null:(g=df&&g[df]||g["@@iterator"],typeof g=="function"?g:null)}function d(g){if(g==null)return null;if(typeof g=="function")return g.$$typeof===Mp?null:g.displayName||g.name||null;if(typeof g=="string")return g;switch(g){case ng:return"Fragment";case rg:return"Profiler";case ig:return"StrictMode";case r_:return"Suspense";case hf:return"SuspenseList";case _1:return"Activity"}if(typeof g=="object")switch(g.$$typeof){case tg:return"Portal";case bc:return g.displayName||"Context";case b1:return(g._context.displayName||"Context")+".Consumer";case W0:var v=g.render;return g=g.displayName,g||(g=v.displayName||v.name||"",g=g!==""?"ForwardRef("+g+")":"ForwardRef"),g;case s_:return v=g.displayName||null,v!==null?v:d(g.type)||"Memo";case Fl:v=g._payload,g=g._init;try{return d(g(v))}catch{}}return null}function f(g){return{current:g}}function m(g){0>ug||(g.current=v_[ug],v_[ug]=null,ug--)}function y(g,v){ug++,v_[ug]=g.current,g.current=v}function _(g){return g>>>=0,g===0?32:31-(x_(g)/nP|0)|0}function S(g){var v=g&42;if(v!==0)return v;switch(g&-g){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return g&261888;case 262144:case 524288:case 1048576:case 2097152:return g&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return g&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return g}}function b(g,v,C){var D=g.pendingLanes;if(D===0)return 0;var k=0,X=g.suspendedLanes,fe=g.pingedLanes;g=g.warmLanes;var Xe=D&134217727;return Xe!==0?(D=Xe&~X,D!==0?k=S(D):(fe&=Xe,fe!==0?k=S(fe):C||(C=Xe&~g,C!==0&&(k=S(C))))):(Xe=D&~X,Xe!==0?k=S(Xe):fe!==0?k=S(fe):C||(C=D&~g,C!==0&&(k=S(C)))),k===0?0:v!==0&&v!==k&&(v&X)===0&&(X=k&-k,C=v&-v,X>=C||X===32&&(C&4194048)!==0)?v:k}function M(g,v){return(g.pendingLanes&~(g.suspendedLanes&~g.pingedLanes)&v)===0}function w(g,v){switch(g){case 1:case 2:case 4:case 8:case 64:return v+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function T(){var g=q0;return q0<<=1,(q0&62914560)===0&&(q0=4194304),g}function E(g){for(var v=[],C=0;31>C;C++)v.push(g);return v}function R(g,v){g.pendingLanes|=v,v!==268435456&&(g.suspendedLanes=0,g.pingedLanes=0,g.warmLanes=0)}function P(g,v,C,D,k,X){var fe=g.pendingLanes;g.pendingLanes=C,g.suspendedLanes=0,g.pingedLanes=0,g.warmLanes=0,g.expiredLanes&=C,g.entangledLanes&=C,g.errorRecoveryDisabledLanes&=C,g.shellSuspendCounter=0;var Xe=g.entanglements,Rt=g.expirationTimes,an=g.hiddenUpdates;for(C=fe&~C;0<C;){var Pn=31-au(C),mn=1<<Pn;Xe[Pn]=0,Rt[Pn]=-1;var Yn=an[Pn];if(Yn!==null)for(an[Pn]=null,Pn=0;Pn<Yn.length;Pn++){var ji=Yn[Pn];ji!==null&&(ji.lane&=-536870913)}C&=~mn}D!==0&&I(g,D,0),X!==0&&k===0&&g.tag!==0&&(g.suspendedLanes|=X&~(fe&~v))}function I(g,v,C){g.pendingLanes|=v,g.suspendedLanes&=~v;var D=31-au(v);g.entangledLanes|=v,g.entanglements[D]=g.entanglements[D]|1073741824|C&261930}function B(g,v){var C=g.entangledLanes|=v;for(g=g.entanglements;C;){var D=31-au(C),k=1<<D;k&v|g[D]&v&&(g[D]|=v),C&=~k}}function N(g,v){var C=v&-v;return C=(C&42)!==0?1:U(C),(C&(g.suspendedLanes|v))!==0?0:C}function U(g){switch(g){case 2:g=1;break;case 8:g=4;break;case 32:g=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:g=128;break;case 268435456:g=134217728;break;default:g=0}return g}function V(g){return g&=-g,2<g?8<g?(g&134217727)!==0?32:268435456:8:2}function W(g){if(typeof MT=="function"&&sP(g),ou&&typeof ou.setStrictMode=="function")try{ou.setStrictMode(hg,g)}catch{}}function K(g,v){return g===v&&(g!==0||1/g===1/v)||g!==g&&v!==v}function q(g){if(T_===void 0)try{throw Error()}catch(C){var v=C.stack.trim().match(/\n( *(at )?)/);T_=v&&v[1]||"",Jh=-1<C.stack.indexOf(`
    at`)?" (<anonymous>)":-1<C.stack.indexOf("@")?"@unknown:0:0":""}return`
`+T_+g+Jh}function j(g,v){if(!g||P1)return"";P1=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var D={DetermineComponentFrameRoot:function(){try{if(v){var mn=function(){throw Error()};if(Object.defineProperty(mn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(mn,[])}catch(ji){var Yn=ji}Reflect.construct(g,[],mn)}else{try{mn.call()}catch(ji){Yn=ji}g.call(mn.prototype)}}else{try{throw Error()}catch(ji){Yn=ji}(mn=g())&&typeof mn.catch=="function"&&mn.catch(function(){})}}catch(ji){if(ji&&Yn&&typeof ji.stack=="string")return[ji.stack,Yn.stack]}return[null,null]}};D.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var k=Object.getOwnPropertyDescriptor(D.DetermineComponentFrameRoot,"name");k&&k.configurable&&Object.defineProperty(D.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var X=D.DetermineComponentFrameRoot(),fe=X[0],Xe=X[1];if(fe&&Xe){var Rt=fe.split(`
`),an=Xe.split(`
`);for(k=D=0;D<Rt.length&&!Rt[D].includes("DetermineComponentFrameRoot");)D++;for(;k<an.length&&!an[k].includes("DetermineComponentFrameRoot");)k++;if(D===Rt.length||k===an.length)for(D=Rt.length-1,k=an.length-1;1<=D&&0<=k&&Rt[D]!==an[k];)k--;for(;1<=D&&0<=k;D--,k--)if(Rt[D]!==an[k]){if(D!==1||k!==1)do if(D--,k--,0>k||Rt[D]!==an[k]){var Pn=`
`+Rt[D].replace(" at new "," at ");return g.displayName&&Pn.includes("<anonymous>")&&(Pn=Pn.replace("<anonymous>",g.displayName)),Pn}while(1<=D&&0<=k);break}}}finally{P1=!1,Error.prepareStackTrace=C}return(C=g?g.displayName||g.name:"")?q(C):""}function te(g,v){switch(g.tag){case 26:case 27:case 5:return q(g.type);case 16:return q("Lazy");case 13:return g.child!==v&&v!==null?q("Suspense Fallback"):q("Suspense");case 19:return q("SuspenseList");case 0:case 15:return j(g.type,!1);case 11:return j(g.type.render,!1);case 1:return j(g.type,!0);case 31:return q("Activity");default:return""}}function he(g){try{var v="",C=null;do v+=te(g,C),C=g,g=g.return;while(g);return v}catch(D){return`
Error generating stack: `+D.message+`
`+D.stack}}function _e(g,v){if(typeof g=="object"&&g!==null){var C=AT.get(g);return C!==void 0?C:(v={value:g,source:v,stack:he(v)},AT.set(g,v),v)}return{value:g,source:v,stack:he(v)}}function Be(g,v){mf[qh++]=D1,mf[qh++]=As,As=g,D1=v}function ue(g,v,C){Mc[Bu++]=Ko,Mc[Bu++]=ih,Mc[Bu++]=Ac,Ac=g;var D=Ko;g=ih;var k=32-au(D)-1;D&=~(1<<k),C+=1;var X=32-au(v)+k;if(30<X){var fe=k-k%5;X=(D&(1<<fe)-1).toString(32),D>>=fe,k-=fe,Ko=1<<32-au(v)+k|C<<k|D,ih=X+g}else Ko=1<<X|C<<k|D,ih=g}function ce(g){g.return!==null&&(Be(g,1),ue(g,1,0))}function Ce(g){for(;g===As;)As=mf[--qh],mf[qh]=null,D1=mf[--qh],mf[qh]=null;for(;g===Ac;)Ac=Mc[--Bu],Mc[Bu]=null,ih=Mc[--Bu],Mc[Bu]=null,Ko=Mc[--Bu],Mc[Bu]=null}function Oe(g,v){Mc[Bu++]=Ko,Mc[Bu++]=ih,Mc[Bu++]=Ac,Ko=v.id,ih=v.overflow,Ac=g}function nt(g,v){y($o,v),y(gf,g),y(Lo,null),g=v3(v),m(Lo),y(Lo,g)}function Ae(){m(Lo),m(gf),m($o)}function Ye(g){g.memoizedState!==null&&y(N1,g);var v=Lo.current,C=Y0(v,g.type);v!==C&&(y(gf,g),y(Lo,C))}function ft(g){gf.current===g&&(m(Lo),m(gf)),N1.current===g&&(m(N1),za?og._currentValue=ag:og._currentValue2=ag)}function ze(g){var v=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw je(_e(v,g)),C_}function ot(g,v){if(!ta)throw Error(r(175));X3(g.stateNode,g.type,g.memoizedProps,v,g)||ze(g,!0)}function ut(g){for(xo=g.return;xo;)switch(xo.tag){case 5:case 31:case 13:Il=!1;return;case 27:case 3:Il=!0;return;default:xo=xo.return}}function Wt(g){if(!ta||g!==xo)return!1;if(!Ar)return ut(g),Ar=!0,!1;var v=g.tag;if(vo?v!==3&&v!==27&&(v!==5||J0(g.type)&&!Ll(g.type,g.memoizedProps))&&na&&ze(g):v!==3&&(v!==5||J0(g.type)&&!Ll(g.type,g.memoizedProps))&&na&&ze(g),ut(g),v===13){if(!ta)throw Error(r(316));if(g=g.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(r(317));na=dT(g)}else if(v===31){if(g=g.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(r(317));na=Z3(g)}else na=vo&&v===27?I3(g.type,na):xo?L3(g.stateNode):null;return!0}function It(){ta&&(na=xo=null,Ar=!1)}function ke(){var g=Qh;return g!==null&&(cu===null?cu=g:cu.push.apply(cu,g),Qh=null),g}function je(g){Qh===null?Qh=[g]:Qh.push(g)}function gt(g,v,C){za?(y(Tc,v._currentValue),v._currentValue=C):(y(Tc,v._currentValue2),v._currentValue2=C)}function yt(g){var v=Tc.current;za?g._currentValue=v:g._currentValue2=v,m(Tc)}function ve(g,v,C){for(;g!==null;){var D=g.alternate;if((g.childLanes&v)!==v?(g.childLanes|=v,D!==null&&(D.childLanes|=v)):D!==null&&(D.childLanes&v)!==v&&(D.childLanes|=v),g===C)break;g=g.return}}function An(g,v,C,D){var k=g.child;for(k!==null&&(k.return=g);k!==null;){var X=k.dependencies;if(X!==null){var fe=k.child;X=X.firstContext;e:for(;X!==null;){var Xe=X;X=k;for(var Rt=0;Rt<v.length;Rt++)if(Xe.context===v[Rt]){X.lanes|=C,Xe=X.alternate,Xe!==null&&(Xe.lanes|=C),ve(X.return,C,g),D||(fe=null);break e}X=Xe.next}}else if(k.tag===18){if(fe=k.return,fe===null)throw Error(r(341));fe.lanes|=C,X=fe.alternate,X!==null&&(X.lanes|=C),ve(fe,C,g),fe=null}else fe=k.child;if(fe!==null)fe.return=k;else for(fe=k;fe!==null;){if(fe===g){fe=null;break}if(k=fe.sibling,k!==null){k.return=fe.return,fe=k;break}fe=fe.return}k=fe}}function cn(g,v,C,D){g=null;for(var k=v,X=!1;k!==null;){if(!X){if((k.flags&524288)!==0)X=!0;else if((k.flags&262144)!==0)break}if(k.tag===10){var fe=k.alternate;if(fe===null)throw Error(r(387));if(fe=fe.memoizedProps,fe!==null){var Xe=k.type;Ha(k.pendingProps.value,fe.value)||(g!==null?g.push(Xe):g=[Xe])}}else if(k===N1.current){if(fe=k.alternate,fe===null)throw Error(r(387));fe.memoizedState.memoizedState!==k.memoizedState.memoizedState&&(g!==null?g.push(og):g=[og])}k=k.return}g!==null&&An(v,g,C,D),v.flags|=262144}function In(g){for(g=g.firstContext;g!==null;){var v=g.context;if(!Ha(za?v._currentValue:v._currentValue2,g.memoizedValue))return!0;g=g.next}return!1}function Zt(g){Is=g,rh=null,g=g.dependencies,g!==null&&(g.firstContext=null)}function le(g){return Re(Is,g)}function ee(g,v){return Is===null&&Zt(g),Re(g,v)}function Re(g,v){var C=za?v._currentValue:v._currentValue2;if(v={context:v,memoizedValue:C,next:null},rh===null){if(g===null)throw Error(r(308));rh=v,g.dependencies={lanes:0,firstContext:v},g.flags|=524288}else rh=rh.next=v;return C}function tt(){return{controller:new aP,data:new Map,refCount:0}}function et(g){g.refCount--,g.refCount===0&&Io(xI,function(){g.controller.abort()})}function at(){}function jt(g){g!==ms&&g.next===null&&(ms===null?B1=ms=g:ms=ms.next=g),Cc=!0,hl||(hl=!0,Se())}function rn(g,v){if(!w_&&Cc){w_=!0;do for(var C=!1,D=B1;D!==null;){if(g!==0){var k=D.pendingLanes;if(k===0)var X=0;else{var fe=D.suspendedLanes,Xe=D.pingedLanes;X=(1<<31-au(42|g)+1)-1,X&=k&~(fe&~Xe),X=X&201326741?X&201326741|1:X?X|2:0}X!==0&&(C=!0,Ft(D,X))}else X=Tr,X=b(D,D===ar?X:0,D.cancelPendingCommit!==null||D.timeoutHandle!==su),(X&3)===0||M(D,X)||(C=!0,Ft(D,X));D=D.next}while(C);w_=!1}}function Nn(){Fn()}function Fn(){Cc=hl=!1;var g=0;Ep!==0&&sg()&&(g=Ep);for(var v=cl(),C=null,D=B1;D!==null;){var k=D.next,X=Gt(D,v);X===0?(D.next=null,C===null?B1=k:C.next=k,k===null&&(ms=C)):(C=D,(g!==0||(X&3)!==0)&&(Cc=!0)),D=k}ao!==0&&ao!==5||rn(g),Ep!==0&&(Ep=0)}function Gt(g,v){for(var C=g.suspendedLanes,D=g.pingedLanes,k=g.expirationTimes,X=g.pendingLanes&-62914561;0<X;){var fe=31-au(X),Xe=1<<fe,Rt=k[fe];Rt===-1?((Xe&C)===0||(Xe&D)!==0)&&(k[fe]=w(Xe,v)):Rt<=v&&(g.expiredLanes|=Xe),X&=~Xe}if(v=ar,C=Tr,C=b(g,g===v?C:0,g.cancelPendingCommit!==null||g.timeoutHandle!==su),D=g.callbackNode,C===0||g===v&&(ys===2||ys===9)||g.cancelPendingCommit!==null)return D!==null&&D!==null&&__(D),g.callbackNode=null,g.callbackPriority=0;if((C&3)===0||M(g,C)){if(v=C&-C,v===g.callbackPriority)return v;switch(D!==null&&__(D),V(C)){case 2:case 8:C=rP;break;case 32:C=R1;break;case 268435456:C=M_;break;default:C=R1}return D=st.bind(null,g),C=E1(C,D),g.callbackPriority=v,g.callbackNode=C,v}return D!==null&&D!==null&&__(D),g.callbackPriority=2,g.callbackNode=null,2}function st(g,v){if(ao!==0&&ao!==5)return g.callbackNode=null,g.callbackPriority=0,null;var C=g.callbackNode;if(Yh()&&g.callbackNode!==C)return null;var D=Tr;return D=b(g,g===ar?D:0,g.cancelPendingCommit!==null||g.timeoutHandle!==su),D===0?null:(nh(g,D,v),Gt(g,cl()),g.callbackNode!=null&&g.callbackNode===C?st.bind(null,g):null)}function Ft(g,v){if(Yh())return null;nh(g,v,!0)}function Se(){$A?JA(function(){(gr&6)!==0?E1(S_,Nn):Fn()}):E1(S_,Nn)}function Je(){if(Ep===0){var g=yf;g===0&&(g=b_,b_<<=1,(b_&261888)===0&&(b_=256)),Ep=g}return Ep}function St(g,v){if(Q0===null){var C=Q0=[];TT=0,yf=Je(),bo={status:"pending",value:void 0,then:function(D){C.push(D)}}}return TT++,v.then(Ne,Ne),v}function Ne(){if(--TT===0&&Q0!==null){bo!==null&&(bo.status="fulfilled");var g=Q0;Q0=null,yf=0,bo=null;for(var v=0;v<g.length;v++)(0,g[v])()}}function it(g,v){var C=[],D={status:"pending",value:null,reason:null,then:function(k){C.push(k)}};return g.then(function(){D.status="fulfilled",D.value=v;for(var k=0;k<C.length;k++)(0,C[k])(v)},function(k){for(D.status="rejected",D.reason=k,k=0;k<C.length;k++)(0,C[k])(void 0)}),D}function kt(){var g=Rp.current;return g!==null?g:ar.pooledCache}function vn(g,v){v===null?y(Rp,Rp.current):y(Rp,v.pool)}function Kt(){var g=kt();return g===null?null:{parent:za?ia._currentValue:ia._currentValue2,pool:g}}function Ut(g,v){if(Ha(g,v))return!0;if(typeof g!="object"||g===null||typeof v!="object"||v===null)return!1;var C=Object.keys(g),D=Object.keys(v);if(C.length!==D.length)return!1;for(D=0;D<C.length;D++){var k=C[D];if(!vI.call(v,k)||!Ha(g[k],v[k]))return!1}return!0}function z(g){return g=g.status,g==="fulfilled"||g==="rejected"}function se(g,v,C){switch(C=g[C],C===void 0?g.push(v):C!==v&&(v.then(at,at),v=C),v.status){case"fulfilled":return v.value;case"rejected":throw g=v.reason,be(g),g;default:if(typeof v.status=="string")v.then(at,at);else{if(g=ar,g!==null&&100<g.shellSuspendCounter)throw Error(r(482));g=v,g.status="pending",g.then(function(D){if(v.status==="pending"){var k=v;k.status="fulfilled",k.value=D}},function(D){if(v.status==="pending"){var k=v;k.status="rejected",k.reason=D}})}switch(v.status){case"fulfilled":return v.value;case"rejected":throw g=v.reason,be(g),g}throw Gl=v,_o}}function ne(g){try{var v=g._init;return v(g._payload)}catch(C){throw C!==null&&typeof C=="object"&&typeof C.then=="function"?(Gl=C,_o):C}}function ae(){if(Gl===null)throw Error(r(459));var g=Gl;return Gl=null,g}function be(g){if(g===_o||g===Ec)throw Error(r(483))}function pt(g){var v=dg;return dg+=1,Pp===null&&(Pp=[]),se(Pp,g,v)}function Bt(g,v){v=v.props.ref,g.ref=v!==void 0?v:null}function tn(g,v){throw v.$$typeof===eg?Error(r(525)):(g=Object.prototype.toString.call(v),Error(r(31,g==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":g)))}function Tn(g){function v(_t,ct){if(g){var Et=_t.deletions;Et===null?(_t.deletions=[ct],_t.flags|=16):Et.push(ct)}}function C(_t,ct){if(!g)return null;for(;ct!==null;)v(_t,ct),ct=ct.sibling;return null}function D(_t){for(var ct=new Map;_t!==null;)_t.key!==null?ct.set(_t.key,_t):ct.set(_t.index,_t),_t=_t.sibling;return ct}function k(_t,ct){return _t=Du(_t,ct),_t.index=0,_t.sibling=null,_t}function X(_t,ct,Et){return _t.index=Et,g?(Et=_t.alternate,Et!==null?(Et=Et.index,Et<ct?(_t.flags|=67108866,ct):Et):(_t.flags|=67108866,ct)):(_t.flags|=1048576,ct)}function fe(_t){return g&&_t.alternate===null&&(_t.flags|=67108866),_t}function Xe(_t,ct,Et,wn){return ct===null||ct.tag!==6?(ct=UA(Et,_t.mode,wn),ct.return=_t,ct):(ct=k(ct,Et),ct.return=_t,ct)}function Rt(_t,ct,Et,wn){var Si=Et.type;return Si===ng?Pn(_t,ct,Et.props.children,wn,Et.key):ct!==null&&(ct.elementType===Si||typeof Si=="object"&&Si!==null&&Si.$$typeof===Fl&&ne(Si)===ct.type)?(ct=k(ct,Et.props),Bt(ct,Et),ct.return=_t,ct):(ct=cf(Et.type,Et.key,Et.props,null,_t.mode,wn),Bt(ct,Et),ct.return=_t,ct)}function an(_t,ct,Et,wn){return ct===null||ct.tag!==4||ct.stateNode.containerInfo!==Et.containerInfo||ct.stateNode.implementation!==Et.implementation?(ct=zA(Et,_t.mode,wn),ct.return=_t,ct):(ct=k(ct,Et.children||[]),ct.return=_t,ct)}function Pn(_t,ct,Et,wn,Si){return ct===null||ct.tag!==7?(ct=xc(Et,_t.mode,wn,Si),ct.return=_t,ct):(ct=k(ct,Et),ct.return=_t,ct)}function mn(_t,ct,Et){if(typeof ct=="string"&&ct!==""||typeof ct=="number"||typeof ct=="bigint")return ct=UA(""+ct,_t.mode,Et),ct.return=_t,ct;if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case Kh:return Et=cf(ct.type,ct.key,ct.props,null,_t.mode,Et),Bt(Et,ct),Et.return=_t,Et;case tg:return ct=zA(ct,_t.mode,Et),ct.return=_t,ct;case Fl:return ct=ne(ct),mn(_t,ct,Et)}if(Ap(ct)||c(ct))return ct=xc(ct,_t.mode,Et,null),ct.return=_t,ct;if(typeof ct.then=="function")return mn(_t,pt(ct),Et);if(ct.$$typeof===bc)return mn(_t,ee(_t,ct),Et);tn(_t,ct)}return null}function Yn(_t,ct,Et,wn){var Si=ct!==null?ct.key:null;if(typeof Et=="string"&&Et!==""||typeof Et=="number"||typeof Et=="bigint")return Si!==null?null:Xe(_t,ct,""+Et,wn);if(typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case Kh:return Et.key===Si?Rt(_t,ct,Et,wn):null;case tg:return Et.key===Si?an(_t,ct,Et,wn):null;case Fl:return Et=ne(Et),Yn(_t,ct,Et,wn)}if(Ap(Et)||c(Et))return Si!==null?null:Pn(_t,ct,Et,wn,null);if(typeof Et.then=="function")return Yn(_t,ct,pt(Et),wn);if(Et.$$typeof===bc)return Yn(_t,ct,ee(_t,Et),wn);tn(_t,Et)}return null}function ji(_t,ct,Et,wn,Si){if(typeof wn=="string"&&wn!==""||typeof wn=="number"||typeof wn=="bigint")return _t=_t.get(Et)||null,Xe(ct,_t,""+wn,Si);if(typeof wn=="object"&&wn!==null){switch(wn.$$typeof){case Kh:return _t=_t.get(wn.key===null?Et:wn.key)||null,Rt(ct,_t,wn,Si);case tg:return _t=_t.get(wn.key===null?Et:wn.key)||null,an(ct,_t,wn,Si);case Fl:return wn=ne(wn),ji(_t,ct,Et,wn,Si)}if(Ap(wn)||c(wn))return _t=_t.get(Et)||null,Pn(ct,_t,wn,Si,null);if(typeof wn.then=="function")return ji(_t,ct,Et,pt(wn),Si);if(wn.$$typeof===bc)return ji(_t,ct,Et,ee(ct,wn),Si);tn(ct,wn)}return null}function Za(_t,ct,Et,wn){for(var Si=null,ya=null,Ai=ct,Hr=ct=0,Go=null;Ai!==null&&Hr<Et.length;Hr++){Ai.index>Hr?(Go=Ai,Ai=null):Go=Ai.sibling;var is=Yn(_t,Ai,Et[Hr],wn);if(is===null){Ai===null&&(Ai=Go);break}g&&Ai&&is.alternate===null&&v(_t,Ai),ct=X(is,ct,Hr),ya===null?Si=is:ya.sibling=is,ya=is,Ai=Go}if(Hr===Et.length)return C(_t,Ai),Ar&&Be(_t,Hr),Si;if(Ai===null){for(;Hr<Et.length;Hr++)Ai=mn(_t,Et[Hr],wn),Ai!==null&&(ct=X(Ai,ct,Hr),ya===null?Si=Ai:ya.sibling=Ai,ya=Ai);return Ar&&Be(_t,Hr),Si}for(Ai=D(Ai);Hr<Et.length;Hr++)Go=ji(Ai,_t,Hr,Et[Hr],wn),Go!==null&&(g&&Go.alternate!==null&&Ai.delete(Go.key===null?Hr:Go.key),ct=X(Go,ct,Hr),ya===null?Si=Go:ya.sibling=Go,ya=Go);return g&&Ai.forEach(function(Dc){return v(_t,Dc)}),Ar&&Be(_t,Hr),Si}function oy(_t,ct,Et,wn){if(Et==null)throw Error(r(151));for(var Si=null,ya=null,Ai=ct,Hr=ct=0,Go=null,is=Et.next();Ai!==null&&!is.done;Hr++,is=Et.next()){Ai.index>Hr?(Go=Ai,Ai=null):Go=Ai.sibling;var Dc=Yn(_t,Ai,is.value,wn);if(Dc===null){Ai===null&&(Ai=Go);break}g&&Ai&&Dc.alternate===null&&v(_t,Ai),ct=X(Dc,ct,Hr),ya===null?Si=Dc:ya.sibling=Dc,ya=Dc,Ai=Go}if(is.done)return C(_t,Ai),Ar&&Be(_t,Hr),Si;if(Ai===null){for(;!is.done;Hr++,is=Et.next())is=mn(_t,is.value,wn),is!==null&&(ct=X(is,ct,Hr),ya===null?Si=is:ya.sibling=is,ya=is);return Ar&&Be(_t,Hr),Si}for(Ai=D(Ai);!is.done;Hr++,is=Et.next())is=ji(Ai,_t,Hr,is.value,wn),is!==null&&(g&&is.alternate!==null&&Ai.delete(is.key===null?Hr:is.key),ct=X(is,ct,Hr),ya===null?Si=is:ya.sibling=is,ya=is);return g&&Ai.forEach(function(bI){return v(_t,bI)}),Ar&&Be(_t,Hr),Si}function Op(_t,ct,Et,wn){if(typeof Et=="object"&&Et!==null&&Et.type===ng&&Et.key===null&&(Et=Et.props.children),typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case Kh:e:{for(var Si=Et.key;ct!==null;){if(ct.key===Si){if(Si=Et.type,Si===ng){if(ct.tag===7){C(_t,ct.sibling),wn=k(ct,Et.props.children),wn.return=_t,_t=wn;break e}}else if(ct.elementType===Si||typeof Si=="object"&&Si!==null&&Si.$$typeof===Fl&&ne(Si)===ct.type){C(_t,ct.sibling),wn=k(ct,Et.props),Bt(wn,Et),wn.return=_t,_t=wn;break e}C(_t,ct);break}else v(_t,ct);ct=ct.sibling}Et.type===ng?(wn=xc(Et.props.children,_t.mode,wn,Et.key),wn.return=_t,_t=wn):(wn=cf(Et.type,Et.key,Et.props,null,_t.mode,wn),Bt(wn,Et),wn.return=_t,_t=wn)}return fe(_t);case tg:e:{for(Si=Et.key;ct!==null;){if(ct.key===Si)if(ct.tag===4&&ct.stateNode.containerInfo===Et.containerInfo&&ct.stateNode.implementation===Et.implementation){C(_t,ct.sibling),wn=k(ct,Et.children||[]),wn.return=_t,_t=wn;break e}else{C(_t,ct);break}else v(_t,ct);ct=ct.sibling}wn=zA(Et,_t.mode,wn),wn.return=_t,_t=wn}return fe(_t);case Fl:return Et=ne(Et),Op(_t,ct,Et,wn)}if(Ap(Et))return Za(_t,ct,Et,wn);if(c(Et)){if(Si=c(Et),typeof Si!="function")throw Error(r(150));return Et=Si.call(Et),oy(_t,ct,Et,wn)}if(typeof Et.then=="function")return Op(_t,ct,pt(Et),wn);if(Et.$$typeof===bc)return Op(_t,ct,ee(_t,Et),wn);tn(_t,Et)}return typeof Et=="string"&&Et!==""||typeof Et=="number"||typeof Et=="bigint"?(Et=""+Et,ct!==null&&ct.tag===6?(C(_t,ct.sibling),wn=k(ct,Et),wn.return=_t,_t=wn):(C(_t,ct),wn=UA(Et,_t.mode,wn),wn.return=_t,_t=wn),fe(_t)):C(_t,ct)}return function(_t,ct,Et,wn){try{dg=0;var Si=Op(_t,ct,Et,wn);return Pp=null,Si}catch(Ai){if(Ai===_o||Ai===Ec)throw Ai;var ya=t(29,Ai,null,_t.mode);return ya.lanes=wn,ya.return=_t,ya}}}function yi(){for(var g=td,v=fg=td=0;v<g;){var C=qo[v];qo[v++]=null;var D=qo[v];qo[v++]=null;var k=qo[v];qo[v++]=null;var X=qo[v];if(qo[v++]=null,D!==null&&k!==null){var fe=D.pending;fe===null?k.next=k:(k.next=fe.next,fe.next=k),D.pending=k}X!==0&&Xs(C,k,X)}}function er(g,v,C,D){qo[td++]=g,qo[td++]=v,qo[td++]=C,qo[td++]=D,fg|=D,g.lanes|=D,g=g.alternate,g!==null&&(g.lanes|=D)}function Vi(g,v,C,D){return er(g,v,C,D),es(g)}function Zn(g,v){return er(g,null,null,v),es(g)}function Xs(g,v,C){g.lanes|=C;var D=g.alternate;D!==null&&(D.lanes|=C);for(var k=!1,X=g.return;X!==null;)X.childLanes|=C,D=X.alternate,D!==null&&(D.childLanes|=C),X.tag===22&&(g=X.stateNode,g===null||g._visibility&1||(k=!0)),g=X,X=X.return;return g.tag===3?(X=g.stateNode,k&&v!==null&&(k=31-au(C),g=X.hiddenUpdates,D=g[k],D===null?g[k]=[v]:D.push(v),v.lane=C|536870912),X):null}function es(g){if(50<Kr)throw Kr=0,U1=null,Error(r(185));for(var v=g.return;v!==null;)g=v,v=g.return;return g.tag===3?g.stateNode:null}function ie(g){g.updateQueue={baseState:g.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ye(g,v){g=g.updateQueue,v.updateQueue===g&&(v.updateQueue={baseState:g.baseState,firstBaseUpdate:g.firstBaseUpdate,lastBaseUpdate:g.lastBaseUpdate,shared:g.shared,callbacks:null})}function Ue(g){return{lane:g,tag:0,payload:null,callback:null,next:null}}function dt(g,v,C){var D=g.updateQueue;if(D===null)return null;if(D=D.shared,(gr&2)!==0){var k=D.pending;return k===null?v.next=v:(v.next=k.next,k.next=v),D.pending=v,v=es(g),Xs(g,null,C),v}return er(g,D,v,C),es(g)}function Ct(g,v,C){if(v=v.updateQueue,v!==null&&(v=v.shared,(C&4194048)!==0)){var D=v.lanes;D&=g.pendingLanes,C|=D,v.lanes=C,B(g,C)}}function wt(g,v){var C=g.updateQueue,D=g.alternate;if(D!==null&&(D=D.updateQueue,C===D)){var k=null,X=null;if(C=C.firstBaseUpdate,C!==null){do{var fe={lane:C.lane,tag:C.tag,payload:C.payload,callback:null,next:null};X===null?k=X=fe:X=X.next=fe,C=C.next}while(C!==null);X===null?k=X=v:X=X.next=v}else k=X=v;C={baseState:D.baseState,firstBaseUpdate:k,lastBaseUpdate:X,shared:D.shared,callbacks:D.callbacks},g.updateQueue=C;return}g=C.lastBaseUpdate,g===null?C.firstBaseUpdate=v:g.next=v,C.lastBaseUpdate=v}function sn(){if(R_){var g=bo;if(g!==null)throw g}}function Qt(g,v,C,D){R_=!1;var k=g.updateQueue;Fu=!1;var X=k.firstBaseUpdate,fe=k.lastBaseUpdate,Xe=k.shared.pending;if(Xe!==null){k.shared.pending=null;var Rt=Xe,an=Rt.next;Rt.next=null,fe===null?X=an:fe.next=an,fe=Rt;var Pn=g.alternate;Pn!==null&&(Pn=Pn.updateQueue,Xe=Pn.lastBaseUpdate,Xe!==fe&&(Xe===null?Pn.firstBaseUpdate=an:Xe.next=an,Pn.lastBaseUpdate=Rt))}if(X!==null){var mn=k.baseState;fe=0,Pn=an=Rt=null,Xe=X;do{var Yn=Xe.lane&-536870913,ji=Yn!==Xe.lane;if(ji?(Tr&Yn)===Yn:(D&Yn)===Yn){Yn!==0&&Yn===yf&&(R_=!0),Pn!==null&&(Pn=Pn.next={lane:0,tag:Xe.tag,payload:Xe.payload,callback:null,next:null});e:{var Za=g,oy=Xe;Yn=v;var Op=C;switch(oy.tag){case 1:if(Za=oy.payload,typeof Za=="function"){mn=Za.call(Op,mn,Yn);break e}mn=Za;break e;case 3:Za.flags=Za.flags&-65537|128;case 0:if(Za=oy.payload,Yn=typeof Za=="function"?Za.call(Op,mn,Yn):Za,Yn==null)break e;mn=i_({},mn,Yn);break e;case 2:Fu=!0}}Yn=Xe.callback,Yn!==null&&(g.flags|=64,ji&&(g.flags|=8192),ji=k.callbacks,ji===null?k.callbacks=[Yn]:ji.push(Yn))}else ji={lane:Yn,tag:Xe.tag,payload:Xe.payload,callback:Xe.callback,next:null},Pn===null?(an=Pn=ji,Rt=mn):Pn=Pn.next=ji,fe|=Yn;if(Xe=Xe.next,Xe===null){if(Xe=k.shared.pending,Xe===null)break;ji=Xe,Xe=ji.next,ji.next=null,k.lastBaseUpdate=ji,k.shared.pending=null}}while(!0);Pn===null&&(Rt=mn),k.baseState=Rt,k.firstBaseUpdate=an,k.lastBaseUpdate=Pn,X===null&&(k.shared.lanes=0),xf|=fe,g.lanes=fe,g.memoizedState=mn}}function on(g,v){if(typeof g!="function")throw Error(r(191,g));g.call(v)}function ln(g,v){var C=g.callbacks;if(C!==null)for(g.callbacks=null,g=0;g<C.length;g++)on(C[g],v)}function gn(g,v){g=id,y(Dp,g),y(pg,v),id=g|v.baseLanes}function fn(){y(Dp,id),y(pg,pg.current)}function de(){id=Dp.current,m(pg),m(Dp)}function Fe(g){var v=g.alternate;y(Ra,Ra.current&1),y(lu,g),uu===null&&(v===null||pg.current!==null||v.memoizedState!==null)&&(uu=g)}function $e(g){y(Ra,Ra.current),y(lu,g),uu===null&&(uu=g)}function Ke(g){g.tag===22?(y(Ra,Ra.current),y(lu,g),uu===null&&(uu=g)):Ze()}function Ze(){y(Ra,Ra.current),y(lu,lu.current)}function zt(g){m(lu),uu===g&&(uu=null),m(Ra)}function Jt(g){for(var v=g;v!==null;){if(v.tag===13){var C=v.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||Cp(C)||h_(C)))return v}else if(v.tag===19&&(v.memoizedProps.revealOrder==="forwards"||v.memoizedProps.revealOrder==="backwards"||v.memoizedProps.revealOrder==="unstable_legacy-backwards"||v.memoizedProps.revealOrder==="together")){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===g)break;for(;v.sibling===null;){if(v.return===null||v.return===g)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}function Vt(){throw Error(r(321))}function Rn(g,v){if(v===null)return!1;for(var C=0;C<v.length&&C<g.length;C++)if(!Ha(g[C],v[C]))return!1;return!0}function yn(g,v,C,D,k,X){return vf=X,$i=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,bi.H=g===null||g.memoizedState===null?pa:nd,Ir=!1,X=C(D,k),Ir=!1,nr&&(X=bn(v,C,D,k)),jn(g),X}function jn(g){bi.H=Lu;var v=pi!==null&&pi.next!==null;if(vf=0,ki=pi=$i=null,sr=!1,Rc=0,sh=null,v)throw Error(r(300));g===null||js||(g=g.dependencies,g!==null&&In(g)&&(js=!0))}function bn(g,v,C,D){$i=g;var k=0;do{if(nr&&(sh=null),Rc=0,nr=!1,25<=k)throw Error(r(301));if(k+=1,ki=pi=null,g.updateQueue!=null){var X=g.updateQueue;X.lastEffect=null,X.events=null,X.stores=null,X.memoCache!=null&&(X.memoCache.index=0)}bi.H=Np,X=v(C,D)}while(nr);return X}function zn(){var g=bi.H,v=g.useState()[0];return v=typeof v.then=="function"?Bn(v):v,g=g.useState()[0],(pi!==null?pi.memoizedState:null)!==g&&($i.flags|=1024),v}function Bi(){var g=dl!==0;return dl=0,g}function _r(g,v,C){v.updateQueue=g.updateQueue,v.flags&=-2053,g.lanes&=~C}function Oi(g){if(sr){for(g=g.memoizedState;g!==null;){var v=g.queue;v!==null&&(v.pending=null),g=g.next}sr=!1}vf=0,ki=pi=$i=null,nr=!1,Rc=dl=0,sh=null}function On(){var g={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ki===null?$i.memoizedState=ki=g:ki=ki.next=g,ki}function qt(){if(pi===null){var g=$i.alternate;g=g!==null?g.memoizedState:null}else g=pi.next;var v=ki===null?$i.memoizedState:ki.next;if(v!==null)ki=v,pi=g;else{if(g===null)throw $i.alternate===null?Error(r(467)):Error(r(310));pi=g,g={memoizedState:pi.memoizedState,baseState:pi.baseState,baseQueue:pi.baseQueue,queue:pi.queue,next:null},ki===null?$i.memoizedState=ki=g:ki=ki.next=g}return ki}function ei(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Bn(g){var v=Rc;return Rc+=1,sh===null&&(sh=[]),g=se(sh,g,v),v=$i,(ki===null?v.memoizedState:ki.next)===null&&(v=v.alternate,bi.H=v===null||v.memoizedState===null?pa:nd),g}function tr(g){if(g!==null&&typeof g=="object"){if(typeof g.then=="function")return Bn(g);if(g.$$typeof===bc)return le(g)}throw Error(r(438,String(g)))}function qs(g){var v=null,C=$i.updateQueue;if(C!==null&&(v=C.memoCache),v==null){var D=$i.alternate;D!==null&&(D=D.updateQueue,D!==null&&(D=D.memoCache,D!=null&&(v={data:D.data.map(function(k){return k.slice()}),index:0})))}if(v==null&&(v={data:[],index:0}),C===null&&(C=ei(),$i.updateQueue=C),C.memoCache=v,C=v.data[v.index],C===void 0)for(C=v.data[v.index]=Array(g),D=0;D<g;D++)C[D]=HA;return v.index++,C}function Wi(g,v){return typeof v=="function"?v(g):v}function Ss(g){var v=qt();return Lr(v,pi,g)}function Lr(g,v,C){var D=g.queue;if(D===null)throw Error(r(311));D.lastRenderedReducer=C;var k=g.baseQueue,X=D.pending;if(X!==null){if(k!==null){var fe=k.next;k.next=X.next,X.next=fe}v.baseQueue=k=X,D.pending=null}if(X=g.baseState,k===null)g.memoizedState=X;else{v=k.next;var Xe=fe=null,Rt=null,an=v,Pn=!1;do{var mn=an.lane&-536870913;if(mn!==an.lane?(Tr&mn)===mn:(vf&mn)===mn){var Yn=an.revertLane;if(Yn===0)Rt!==null&&(Rt=Rt.next={lane:0,revertLane:0,gesture:null,action:an.action,hasEagerState:an.hasEagerState,eagerState:an.eagerState,next:null}),mn===yf&&(Pn=!0);else if((vf&Yn)===Yn){an=an.next,Yn===yf&&(Pn=!0);continue}else mn={lane:0,revertLane:an.revertLane,gesture:null,action:an.action,hasEagerState:an.hasEagerState,eagerState:an.eagerState,next:null},Rt===null?(Xe=Rt=mn,fe=X):Rt=Rt.next=mn,$i.lanes|=Yn,xf|=Yn;mn=an.action,Ir&&C(X,mn),X=an.hasEagerState?an.eagerState:C(X,mn)}else Yn={lane:mn,revertLane:an.revertLane,gesture:an.gesture,action:an.action,hasEagerState:an.hasEagerState,eagerState:an.eagerState,next:null},Rt===null?(Xe=Rt=Yn,fe=X):Rt=Rt.next=Yn,$i.lanes|=mn,xf|=mn;an=an.next}while(an!==null&&an!==v);if(Rt===null?fe=X:Rt.next=Xe,!Ha(X,g.memoizedState)&&(js=!0,Pn&&(C=bo,C!==null)))throw C;g.memoizedState=X,g.baseState=fe,g.baseQueue=Rt,D.lastRenderedState=X}return k===null&&(D.lanes=0),[g.memoizedState,D.dispatch]}function Qs(g){var v=qt(),C=v.queue;if(C===null)throw Error(r(311));C.lastRenderedReducer=g;var D=C.dispatch,k=C.pending,X=v.memoizedState;if(k!==null){C.pending=null;var fe=k=k.next;do X=g(X,fe.action),fe=fe.next;while(fe!==k);Ha(X,v.memoizedState)||(js=!0),v.memoizedState=X,v.baseQueue===null&&(v.baseState=X),C.lastRenderedState=X}return[X,D]}function Ws(g,v,C){var D=$i,k=qt(),X=Ar;if(X){if(C===void 0)throw Error(r(407));C=C()}else C=v();var fe=!Ha((pi||k).memoizedState,C);if(fe&&(k.memoizedState=C,js=!0),k=k.queue,fc(Te.bind(null,D,k,g),[g]),k.getSnapshot!==v||fe||ki!==null&&ki.memoizedState.tag&1){if(D.flags|=2048,Ro(9,{destroy:void 0},la.bind(null,D,k,C,v),null),ar===null)throw Error(r(349));X||(vf&127)!==0||Zs(D,v,C)}return C}function Zs(g,v,C){g.flags|=16384,g={getSnapshot:v,value:C},v=$i.updateQueue,v===null?(v=ei(),$i.updateQueue=v,v.stores=[g]):(C=v.stores,C===null?v.stores=[g]:C.push(g))}function la(g,v,C,D){v.value=C,v.getSnapshot=D,ai(v)&&$c(g)}function Te(g,v,C){return C(function(){ai(v)&&$c(g)})}function ai(g){var v=g.getSnapshot;g=g.value;try{var C=v();return!Ha(g,C)}catch{return!0}}function $c(g){var v=Zn(g,2);v!==null&&da(v,g,2)}function jo(g){var v=On();if(typeof g=="function"){var C=g;if(g=C(),Ir){W(!0);try{C()}finally{W(!1)}}}return v.memoizedState=v.baseState=g,v.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wi,lastRenderedState:g},v}function lc(g,v,C,D){return g.baseState=C,Lr(g,pi,typeof D=="function"?D:Wi)}function $n(g,v,C,D,k){if(dp(g))throw Error(r(485));if(g=v.action,g!==null){var X={payload:k,action:g,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(fe){X.listeners.push(fe)}};bi.T!==null?C(!0):X.isTransition=!1,D(X),C=v.pending,C===null?(X.next=v.pending=X,ql(v,X)):(X.next=C.next,v.pending=C.next=X)}}function ql(g,v){var C=v.action,D=v.payload,k=g.state;if(v.isTransition){var X=bi.T,fe={};bi.T=fe;try{var Xe=C(k,D),Rt=bi.S;Rt!==null&&Rt(fe,Xe),uc(g,v,Xe)}catch(an){Ui(g,v,an)}finally{X!==null&&fe.types!==null&&(X.types=fe.types),bi.T=X}}else try{X=C(k,D),uc(g,v,X)}catch(an){Ui(g,v,an)}}function uc(g,v,C){C!==null&&typeof C=="object"&&typeof C.then=="function"?C.then(function(D){cc(g,v,D)},function(D){return Ui(g,v,D)}):cc(g,v,C)}function cc(g,v,C){v.status="fulfilled",v.value=C,Pl(v),g.state=C,v=g.pending,v!==null&&(C=v.next,C===v?g.pending=null:(C=C.next,v.next=C,ql(g,C)))}function Ui(g,v,C){var D=g.pending;if(g.pending=null,D!==null){D=D.next;do v.status="rejected",v.reason=C,Pl(v),v=v.next;while(v!==D)}g.action=null}function Pl(g){g=g.listeners;for(var v=0;v<g.length;v++)(0,g[v])()}function op(g,v){return v}function Jc(g,v){if(Ar){var C=ar.formState;if(C!==null){e:{var D=$i;if(Ar){if(na){var k=F3(na,Il);if(k){na=L3(k),D=lT(k);break e}}ze(D)}D=!1}D&&(v=C[0])}}C=On(),C.memoizedState=C.baseState=v,D={pending:null,lanes:0,dispatch:null,lastRenderedReducer:op,lastRenderedState:v},C.queue=D,C=Xm.bind(null,$i,D),D.dispatch=C,D=jo(!1);var X=hp.bind(null,$i,!1,D.queue);return D=On(),k={state:v,dispatch:null,action:g,pending:null},D.queue=k,C=$n.bind(null,$i,k,X,C),k.dispatch=C,D.memoizedState=g,[v,C,!1]}function hc(g){var v=qt();return Yo(v,pi,g)}function Yo(g,v,C){if(v=Lr(g,v,op)[0],g=Ss(Wi)[0],typeof v=="object"&&v!==null&&typeof v.then=="function")try{var D=Bn(v)}catch(fe){throw fe===_o?Ec:fe}else D=v;v=qt();var k=v.queue,X=k.dispatch;return C!==v.memoizedState&&($i.flags|=2048,Ro(9,{destroy:void 0},ni.bind(null,k,C),null)),[D,X,g]}function ni(g,v){g.action=v}function to(g){var v=qt(),C=pi;if(C!==null)return Yo(v,C,g);qt(),v=v.memoizedState,C=qt();var D=C.queue.dispatch;return C.memoizedState=g,[v,D,!1]}function Ro(g,v,C,D){return g={tag:g,create:C,deps:D,inst:v,next:null},v=$i.updateQueue,v===null&&(v=ei(),$i.updateQueue=v),C=v.lastEffect,C===null?v.lastEffect=g.next=g:(D=C.next,C.next=g,g.next=D,v.lastEffect=g),g}function al(){return qt().memoizedState}function dc(g,v,C,D){var k=On();$i.flags|=g,k.memoizedState=Ro(1|v,{destroy:void 0},C,D===void 0?null:D)}function Ih(g,v,C,D){var k=qt();D=D===void 0?null:D;var X=k.memoizedState.inst;pi!==null&&D!==null&&Rn(D,pi.memoizedState.deps)?k.memoizedState=Ro(v,X,C,D):($i.flags|=g,k.memoizedState=Ro(1|v,X,C,D))}function qc(g,v){dc(8390656,8,g,v)}function fc(g,v){Ih(2048,8,g,v)}function Qc(g){$i.flags|=4;var v=$i.updateQueue;if(v===null)v=ei(),$i.updateQueue=v,v.events=[g];else{var C=v.events;C===null?v.events=[g]:C.push(g)}}function ua(g){var v=qt().memoizedState;return Qc({ref:v,nextImpl:g}),function(){if((gr&2)!==0)throw Error(r(440));return v.impl.apply(void 0,arguments)}}function Ql(g,v){return Ih(4,2,g,v)}function Qd(g,v){return Ih(4,4,g,v)}function ol(g,v){if(typeof v=="function"){g=g();var C=v(g);return function(){typeof C=="function"?C():v(null)}}if(v!=null)return g=g(),v.current=g,function(){v.current=null}}function ci(g,v,C){C=C!=null?C.concat([g]):null,Ih(4,4,ol.bind(null,v,g),C)}function Dl(){}function Gh(g,v){var C=qt();v=v===void 0?null:v;var D=C.memoizedState;return v!==null&&Rn(v,D[1])?D[0]:(C.memoizedState=[g,v],g)}function eh(g,v){var C=qt();v=v===void 0?null:v;var D=C.memoizedState;if(v!==null&&Rn(v,D[1]))return D[0];if(D=g(),Ir){W(!0);try{g()}finally{W(!1)}}return C.memoizedState=[D,v],D}function ll(g,v,C){return C===void 0||(vf&1073741824)!==0&&(Tr&261930)===0?g.memoizedState=v:(g.memoizedState=C,g=of(),$i.lanes|=g,xf|=g,C)}function Eu(g,v,C,D){return Ha(C,v)?C:pg.current!==null?(g=ll(g,C,D),Ha(g,v)||(js=!0),g):(vf&42)===0||(vf&1073741824)!==0&&(Tr&261930)===0?(js=!0,g.memoizedState=C):(g=of(),$i.lanes|=g,xf|=g,v)}function lp(g,v,C,D,k){var X=_c();Mr(X!==0&&8>X?X:8);var fe=bi.T,Xe={};bi.T=Xe,hp(g,!1,v,C);try{var Rt=k(),an=bi.S;if(an!==null&&an(Xe,Rt),Rt!==null&&typeof Rt=="object"&&typeof Rt.then=="function"){var Pn=it(Rt,D);tf(g,v,Pn,ea(g))}else tf(g,v,D,ea(g))}catch(mn){tf(g,v,{then:function(){},status:"rejected",reason:mn},ea())}finally{Mr(X),fe!==null&&Xe.types!==null&&(fe.types=Xe.types),bi.T=fe}}function D0(g){var v=g.memoizedState;if(v!==null)return v;v={memoizedState:ag,baseState:ag,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wi,lastRenderedState:ag},next:null};var C={};return v.next={memoizedState:C,baseState:C,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wi,lastRenderedState:C},next:null},g.memoizedState=v,g=g.alternate,g!==null&&(g.memoizedState=v),v}function up(){return le(og)}function ef(){return qt().memoizedState}function Hm(){return qt().memoizedState}function th(g){for(var v=g.return;v!==null;){switch(v.tag){case 24:case 3:var C=ea();g=Ue(C);var D=dt(v,g,C);D!==null&&(da(D,v,C),Ct(D,v,C)),v={cache:tt()},g.payload=v;return}v=v.return}}function cp(g,v,C){var D=ea();C={lane:D,revertLane:0,gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null},dp(g)?N0(v,C):(C=Vi(g,v,C,D),C!==null&&(da(C,g,D),Wm(C,v,D)))}function Xm(g,v,C){var D=ea();tf(g,v,C,D)}function tf(g,v,C,D){var k={lane:D,revertLane:0,gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null};if(dp(g))N0(v,k);else{var X=g.alternate;if(g.lanes===0&&(X===null||X.lanes===0)&&(X=v.lastRenderedReducer,X!==null))try{var fe=v.lastRenderedState,Xe=X(fe,C);if(k.hasEagerState=!0,k.eagerState=Xe,Ha(Xe,fe))return er(g,v,k,0),ar===null&&yi(),!1}catch{}if(C=Vi(g,v,k,D),C!==null)return da(C,g,D),Wm(C,v,D),!0}return!1}function hp(g,v,C,D){if(D={lane:2,revertLane:Je(),gesture:null,action:D,hasEagerState:!1,eagerState:null,next:null},dp(g)){if(v)throw Error(r(479))}else v=Vi(g,C,D,2),v!==null&&da(v,g,2)}function dp(g){var v=g.alternate;return g===$i||v!==null&&v===$i}function N0(g,v){nr=sr=!0;var C=g.pending;C===null?v.next=v:(v.next=C.next,C.next=v),g.pending=v}function Wm(g,v,C){if((C&4194048)!==0){var D=v.lanes;D&=g.pendingLanes,C|=D,v.lanes=C,B(g,C)}}function Zm(g,v,C,D){v=g.memoizedState,C=C(D,v),C=C==null?v:i_({},v,C),g.memoizedState=C,g.lanes===0&&(g.updateQueue.baseState=C)}function fp(g,v,C,D,k,X,fe){return g=g.stateNode,typeof g.shouldComponentUpdate=="function"?g.shouldComponentUpdate(D,X,fe):v.prototype&&v.prototype.isPureReactComponent?!Ut(C,D)||!Ut(k,X):!0}function pc(g,v,C,D){g=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(C,D),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(C,D),v.state!==g&&F1.enqueueReplaceState(v,v.state,null)}function Po(g,v){var C=v;if("ref"in v){C={};for(var D in v)D!=="ref"&&(C[D]=v[D])}if(g=g.defaultProps){C===v&&(C=i_({},C));for(var k in g)C[k]===void 0&&(C[k]=g[k])}return C}function nf(g,v){try{var C=g.onUncaughtError;C(v.value,{componentStack:v.stack})}catch(D){setTimeout(function(){throw D})}}function jm(g,v,C){try{var D=g.onCaughtError;D(C.value,{componentStack:C.stack,errorBoundary:v.tag===1?v.stateNode:null})}catch(k){setTimeout(function(){throw k})}}function Oh(g,v,C){return C=Ue(C),C.tag=3,C.payload={element:null},C.callback=function(){nf(g,v)},C}function Ym(g){return g=Ue(g),g.tag=3,g}function Km(g,v,C,D){var k=C.type.getDerivedStateFromError;if(typeof k=="function"){var X=D.value;g.payload=function(){return k(X)},g.callback=function(){jm(v,C,D)}}var fe=C.stateNode;fe!==null&&typeof fe.componentDidCatch=="function"&&(g.callback=function(){jm(v,C,D),typeof k!="function"&&(bf===null?bf=new Set([this]):bf.add(this));var Xe=D.stack;this.componentDidCatch(D.value,{componentStack:Xe!==null?Xe:""})})}function u1(g,v,C,D,k){if(C.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){if(v=C.alternate,v!==null&&cn(v,C,k,!0),C=lu.current,C!==null){switch(C.tag){case 31:case 13:return uu===null?z0():C.alternate===null&&ga===0&&(ga=3),C.flags&=-257,C.flags|=65536,C.lanes=k,D===ed?C.flags|=16384:(v=C.updateQueue,v===null?C.updateQueue=new Set([D]):v.add(D),X0(g,D,k)),!1;case 22:return C.flags|=65536,D===ed?C.flags|=16384:(v=C.updateQueue,v===null?(v={transitions:null,markerInstances:null,retryQueue:new Set([D])},C.updateQueue=v):(C=v.retryQueue,C===null?v.retryQueue=new Set([D]):C.add(D)),X0(g,D,k)),!1}throw Error(r(435,C.tag))}return X0(g,D,k),z0(),!1}if(Ar)return v=lu.current,v!==null?((v.flags&65536)===0&&(v.flags|=256),v.flags|=65536,v.lanes=k,D!==C_&&(g=Error(r(422),{cause:D}),je(_e(g,C)))):(D!==C_&&(v=Error(r(423),{cause:D}),je(_e(v,C))),g=g.current.alternate,g.flags|=65536,k&=-k,g.lanes|=k,D=_e(D,C),k=Oh(g.stateNode,D,k),wt(g,k),ga!==4&&(ga=2)),!1;var X=Error(r(520),{cause:D});if(X=_e(X,C),I1===null?I1=[X]:I1.push(X),ga!==4&&(ga=2),v===null)return!0;D=_e(D,C),C=v;do{switch(C.tag){case 3:return C.flags|=65536,g=k&-k,C.lanes|=g,g=Oh(C.stateNode,D,g),wt(C,g),!1;case 1:if(v=C.type,X=C.stateNode,(C.flags&128)===0&&(typeof v.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(bf===null||!bf.has(X))))return C.flags|=65536,k&=-k,C.lanes|=k,k=Ym(k),Km(k,g,C,D),wt(C,k),!1}C=C.return}while(C!==null);return!1}function wa(g,v,C,D){v.child=g===null?CT(v,null,C,D):Jo(v,g.child,C,D)}function $m(g,v,C,D,k){C=C.render;var X=v.ref;if("ref"in D){var fe={};for(var Xe in D)Xe!=="ref"&&(fe[Xe]=D[Xe])}else fe=D;return Zt(v),D=yn(g,v,C,fe,X,k),Xe=Bi(),g!==null&&!js?(_r(g,v,k),ns(g,v,k)):(Ar&&Xe&&ce(v),v.flags|=1,wa(g,v,D,k),v.child)}function F(g,v,C,D,k){if(g===null){var X=C.type;return typeof X=="function"&&!qm(X)&&X.defaultProps===void 0&&C.compare===null?(v.tag=15,v.type=X,H(g,v,X,D,k)):(g=cf(C.type,null,D,v,v.mode,k),g.ref=v.ref,g.return=v,v.child=g)}if(X=g.child,!Do(g,k)){var fe=X.memoizedProps;if(C=C.compare,C=C!==null?C:Ut,C(fe,D)&&g.ref===v.ref)return ns(g,v,k)}return v.flags|=1,g=Du(X,D),g.ref=v.ref,g.return=v,v.child=g}function H(g,v,C,D,k){if(g!==null){var X=g.memoizedProps;if(Ut(X,D)&&g.ref===v.ref)if(js=!1,v.pendingProps=D=X,Do(g,k))(g.flags&131072)!==0&&(js=!0);else return v.lanes=g.lanes,ns(g,v,k)}return un(g,v,C,D,k)}function J(g,v,C,D){var k=D.children,X=g!==null?g.memoizedState:null;if(g===null&&v.stateNode===null&&(v.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),D.mode==="hidden"){if((v.flags&128)!==0){if(X=X!==null?X.baseLanes|C:C,g!==null){for(D=v.child=g.child,k=0;D!==null;)k=k|D.lanes|D.childLanes,D=D.sibling;D=k&~X}else D=0,v.child=null;return Me(g,v,X,C,D)}if((C&536870912)!==0)v.memoizedState={baseLanes:0,cachePool:null},g!==null&&vn(v,X!==null?X.cachePool:null),X!==null?gn(v,X):fn(),Ke(v);else return D=v.lanes=536870912,Me(g,v,X!==null?X.baseLanes|C:C,C,D)}else X!==null?(vn(v,X.cachePool),gn(v,X),Ze(),v.memoizedState=null):(g!==null&&vn(v,null),fn(),Ze());return wa(g,v,k,C),v.child}function oe(g,v){return g!==null&&g.tag===22||v.stateNode!==null||(v.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),v.sibling}function Me(g,v,C,D,k){var X=kt();return X=X===null?null:{parent:za?ia._currentValue:ia._currentValue2,pool:X},v.memoizedState={baseLanes:C,cachePool:X},g!==null&&vn(v,null),fn(),Ke(v),g!==null&&cn(g,v,D,!0),v.childLanes=k,null}function De(g,v){return v=Sr({mode:v.mode,children:v.children},g.mode),v.ref=g.ref,g.child=v,v.return=g,v}function Ee(g,v,C){return Jo(v,g.child,null,C),g=De(v,v.pendingProps),g.flags|=2,zt(v),v.memoizedState=null,g}function qe(g,v,C){var D=v.pendingProps,k=(v.flags&128)!==0;if(v.flags&=-129,g===null){if(Ar){if(D.mode==="hidden")return g=De(v,D),v.lanes=536870912,oe(null,g);if($e(v),(g=na)?(g=cT(g,Il),g!==null&&(v.memoizedState={dehydrated:g,treeContext:Ac!==null?{id:Ko,overflow:ih}:null,retryLane:536870912,hydrationErrors:null},C=kA(g),C.return=v,v.child=C,xo=v,na=null)):g=null,g===null)throw ze(v);return v.lanes=536870912,null}return De(v,D)}var X=g.memoizedState;if(X!==null){var fe=X.dehydrated;if($e(v),k)if(v.flags&256)v.flags&=-257,v=Ee(g,v,C);else if(v.memoizedState!==null)v.child=g.child,v.flags|=128,v=null;else throw Error(r(558));else if(js||cn(g,v,C,!1),k=(C&g.childLanes)!==0,js||k){if(D=ar,D!==null&&(fe=N(D,C),fe!==0&&fe!==X.retryLane))throw X.retryLane=fe,Zn(g,fe),da(D,g,fe),Ol;z0(),v=Ee(g,v,C)}else g=X.treeContext,ta&&(na=U3(fe),xo=v,Ar=!0,Qh=null,Il=!1,g!==null&&Oe(v,g)),v=De(v,D),v.flags|=4096;return v}return g=Du(g.child,{mode:D.mode,children:D.children}),g.ref=v.ref,v.child=g,g.return=v,g}function bt(g,v){var C=v.ref;if(C===null)g!==null&&g.ref!==null&&(v.flags|=4194816);else{if(typeof C!="function"&&typeof C!="object")throw Error(r(284));(g===null||g.ref!==C)&&(v.flags|=4194816)}}function un(g,v,C,D,k){return Zt(v),C=yn(g,v,C,D,void 0,k),D=Bi(),g!==null&&!js?(_r(g,v,k),ns(g,v,k)):(Ar&&D&&ce(v),v.flags|=1,wa(g,v,C,k),v.child)}function Cn(g,v,C,D,k,X){return Zt(v),v.updateQueue=null,C=bn(v,D,C,k),jn(g),D=Bi(),g!==null&&!js?(_r(g,v,X),ns(g,v,X)):(Ar&&D&&ce(v),v.flags|=1,wa(g,v,C,X),v.child)}function fi(g,v,C,D,k){if(Zt(v),v.stateNode===null){var X=$h,fe=C.contextType;typeof fe=="object"&&fe!==null&&(X=le(fe)),X=new C(D,X),v.memoizedState=X.state!==null&&X.state!==void 0?X.state:null,X.updater=F1,v.stateNode=X,X._reactInternals=v,X=v.stateNode,X.props=D,X.state=v.memoizedState,X.refs={},ie(v),fe=C.contextType,X.context=typeof fe=="object"&&fe!==null?le(fe):$h,X.state=v.memoizedState,fe=C.getDerivedStateFromProps,typeof fe=="function"&&(Zm(v,C,fe,D),X.state=v.memoizedState),typeof C.getDerivedStateFromProps=="function"||typeof X.getSnapshotBeforeUpdate=="function"||typeof X.UNSAFE_componentWillMount!="function"&&typeof X.componentWillMount!="function"||(fe=X.state,typeof X.componentWillMount=="function"&&X.componentWillMount(),typeof X.UNSAFE_componentWillMount=="function"&&X.UNSAFE_componentWillMount(),fe!==X.state&&F1.enqueueReplaceState(X,X.state,null),Qt(v,D,X,k),sn(),X.state=v.memoizedState),typeof X.componentDidMount=="function"&&(v.flags|=4194308),D=!0}else if(g===null){X=v.stateNode;var Xe=v.memoizedProps,Rt=Po(C,Xe);X.props=Rt;var an=X.context,Pn=C.contextType;fe=$h,typeof Pn=="object"&&Pn!==null&&(fe=le(Pn));var mn=C.getDerivedStateFromProps;Pn=typeof mn=="function"||typeof X.getSnapshotBeforeUpdate=="function",Xe=v.pendingProps!==Xe,Pn||typeof X.UNSAFE_componentWillReceiveProps!="function"&&typeof X.componentWillReceiveProps!="function"||(Xe||an!==fe)&&pc(v,X,D,fe),Fu=!1;var Yn=v.memoizedState;X.state=Yn,Qt(v,D,X,k),sn(),an=v.memoizedState,Xe||Yn!==an||Fu?(typeof mn=="function"&&(Zm(v,C,mn,D),an=v.memoizedState),(Rt=Fu||fp(v,C,Rt,D,Yn,an,fe))?(Pn||typeof X.UNSAFE_componentWillMount!="function"&&typeof X.componentWillMount!="function"||(typeof X.componentWillMount=="function"&&X.componentWillMount(),typeof X.UNSAFE_componentWillMount=="function"&&X.UNSAFE_componentWillMount()),typeof X.componentDidMount=="function"&&(v.flags|=4194308)):(typeof X.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=D,v.memoizedState=an),X.props=D,X.state=an,X.context=fe,D=Rt):(typeof X.componentDidMount=="function"&&(v.flags|=4194308),D=!1)}else{X=v.stateNode,ye(g,v),fe=v.memoizedProps,Pn=Po(C,fe),X.props=Pn,mn=v.pendingProps,Yn=X.context,an=C.contextType,Rt=$h,typeof an=="object"&&an!==null&&(Rt=le(an)),Xe=C.getDerivedStateFromProps,(an=typeof Xe=="function"||typeof X.getSnapshotBeforeUpdate=="function")||typeof X.UNSAFE_componentWillReceiveProps!="function"&&typeof X.componentWillReceiveProps!="function"||(fe!==mn||Yn!==Rt)&&pc(v,X,D,Rt),Fu=!1,Yn=v.memoizedState,X.state=Yn,Qt(v,D,X,k),sn();var ji=v.memoizedState;fe!==mn||Yn!==ji||Fu||g!==null&&g.dependencies!==null&&In(g.dependencies)?(typeof Xe=="function"&&(Zm(v,C,Xe,D),ji=v.memoizedState),(Pn=Fu||fp(v,C,Pn,D,Yn,ji,Rt)||g!==null&&g.dependencies!==null&&In(g.dependencies))?(an||typeof X.UNSAFE_componentWillUpdate!="function"&&typeof X.componentWillUpdate!="function"||(typeof X.componentWillUpdate=="function"&&X.componentWillUpdate(D,ji,Rt),typeof X.UNSAFE_componentWillUpdate=="function"&&X.UNSAFE_componentWillUpdate(D,ji,Rt)),typeof X.componentDidUpdate=="function"&&(v.flags|=4),typeof X.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof X.componentDidUpdate!="function"||fe===g.memoizedProps&&Yn===g.memoizedState||(v.flags|=4),typeof X.getSnapshotBeforeUpdate!="function"||fe===g.memoizedProps&&Yn===g.memoizedState||(v.flags|=1024),v.memoizedProps=D,v.memoizedState=ji),X.props=D,X.state=ji,X.context=Rt,D=Pn):(typeof X.componentDidUpdate!="function"||fe===g.memoizedProps&&Yn===g.memoizedState||(v.flags|=4),typeof X.getSnapshotBeforeUpdate!="function"||fe===g.memoizedProps&&Yn===g.memoizedState||(v.flags|=1024),D=!1)}return X=D,bt(g,v),D=(v.flags&128)!==0,X||D?(X=v.stateNode,C=D&&typeof C.getDerivedStateFromError!="function"?null:X.render(),v.flags|=1,g!==null&&D?(v.child=Jo(v,g.child,null,k),v.child=Jo(v,null,C,k)):wa(g,v,C,k),v.memoizedState=X.state,g=v.child):g=ns(g,v,k),g}function oi(g,v,C,D){return It(),v.flags|=256,wa(g,v,C,D),v.child}function Gn(g){return{baseLanes:g,cachePool:Kt()}}function vi(g,v,C){return g=g!==null?g.childLanes&~C:0,v&&(g|=Ul),g}function Hi(g,v,C){var D=v.pendingProps,k=!1,X=(v.flags&128)!==0,fe;if((fe=X)||(fe=g!==null&&g.memoizedState===null?!1:(Ra.current&2)!==0),fe&&(k=!0,v.flags&=-129),fe=(v.flags&32)!==0,v.flags&=-33,g===null){if(Ar){if(k?Fe(v):Ze(),(g=na)?(g=H3(g,Il),g!==null&&(v.memoizedState={dehydrated:g,treeContext:Ac!==null?{id:Ko,overflow:ih}:null,retryLane:536870912,hydrationErrors:null},C=kA(g),C.return=v,v.child=C,xo=v,na=null)):g=null,g===null)throw ze(v);return h_(g)?v.lanes=32:v.lanes=536870912,null}var Xe=D.children;return D=D.fallback,k?(Ze(),k=v.mode,Xe=Sr({mode:"hidden",children:Xe},k),D=xc(D,k,C,null),Xe.return=v,D.return=v,Xe.sibling=D,v.child=Xe,D=v.child,D.memoizedState=Gn(C),D.childLanes=vi(g,fe,C),v.memoizedState=mg,oe(null,D)):(Fe(v),ts(v,Xe))}var Rt=g.memoizedState;if(Rt!==null&&(Xe=Rt.dehydrated,Xe!==null)){if(X)v.flags&256?(Fe(v),v.flags&=-257,v=Bs(g,v,C)):v.memoizedState!==null?(Ze(),v.child=g.child,v.flags|=128,v=null):(Ze(),Xe=D.fallback,k=v.mode,D=Sr({mode:"visible",children:D.children},k),Xe=xc(Xe,k,C,null),Xe.flags|=2,D.return=v,Xe.return=v,D.sibling=Xe,v.child=D,Jo(v,g.child,null,C),D=v.child,D.memoizedState=Gn(C),D.childLanes=vi(g,fe,C),v.memoizedState=mg,v=oe(null,D));else if(Fe(v),h_(Xe))fe=d_(Xe).digest,D=Error(r(419)),D.stack="",D.digest=fe,je({value:D,source:null,stack:null}),v=Bs(g,v,C);else if(js||cn(g,v,C,!1),fe=(C&g.childLanes)!==0,js||fe){if(fe=ar,fe!==null&&(D=N(fe,C),D!==0&&D!==Rt.retryLane))throw Rt.retryLane=D,Zn(g,D),da(fe,g,D),Ol;Cp(Xe)||z0(),v=Bs(g,v,C)}else Cp(Xe)?(v.flags|=192,v.child=g.child,v=null):(g=Rt.treeContext,ta&&(na=k3(Xe),xo=v,Ar=!0,Qh=null,Il=!1,g!==null&&Oe(v,g)),v=ts(v,D.children),v.flags|=4096);return v}return k?(Ze(),Xe=D.fallback,k=v.mode,Rt=g.child,X=Rt.sibling,D=Du(Rt,{mode:"hidden",children:D.children}),D.subtreeFlags=Rt.subtreeFlags&65011712,X!==null?Xe=Du(X,Xe):(Xe=xc(Xe,k,C,null),Xe.flags|=2),Xe.return=v,D.return=v,D.sibling=Xe,v.child=D,oe(null,D),D=v.child,Xe=g.child.memoizedState,Xe===null?Xe=Gn(C):(k=Xe.cachePool,k!==null?(Rt=za?ia._currentValue:ia._currentValue2,k=k.parent!==Rt?{parent:Rt,pool:Rt}:k):k=Kt(),Xe={baseLanes:Xe.baseLanes|C,cachePool:k}),D.memoizedState=Xe,D.childLanes=vi(g,fe,C),v.memoizedState=mg,oe(g.child,D)):(Fe(v),C=g.child,g=C.sibling,C=Du(C,{mode:"visible",children:D.children}),C.return=v,C.sibling=null,g!==null&&(fe=v.deletions,fe===null?(v.deletions=[g],v.flags|=16):fe.push(g)),v.child=C,v.memoizedState=null,C)}function ts(g,v){return v=Sr({mode:"visible",children:v},g.mode),v.return=g,g.child=v}function Sr(g,v){return g=t(22,g,null,v),g.lanes=0,g}function Bs(g,v,C){return Jo(v,g.child,null,C),g=ts(v,v.pendingProps.children),g.flags|=2,v.memoizedState=null,g}function no(g,v,C){g.lanes|=v;var D=g.alternate;D!==null&&(D.lanes|=v),ve(g.return,v,C)}function ca(g,v,C,D,k,X){var fe=g.memoizedState;fe===null?g.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:D,tail:C,tailMode:k,treeForkCount:X}:(fe.isBackwards=v,fe.rendering=null,fe.renderingStartTime=0,fe.last=D,fe.tail=C,fe.tailMode=k,fe.treeForkCount=X)}function mr(g,v,C){var D=v.pendingProps,k=D.revealOrder,X=D.tail;D=D.children;var fe=Ra.current,Xe=(fe&2)!==0;if(Xe?(fe=fe&1|2,v.flags|=128):fe&=1,y(Ra,fe),wa(g,v,D,C),D=Ar?D1:0,!Xe&&g!==null&&(g.flags&128)!==0)e:for(g=v.child;g!==null;){if(g.tag===13)g.memoizedState!==null&&no(g,C,v);else if(g.tag===19)no(g,C,v);else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===v)break e;for(;g.sibling===null;){if(g.return===null||g.return===v)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}switch(k){case"forwards":for(C=v.child,k=null;C!==null;)g=C.alternate,g!==null&&Jt(g)===null&&(k=C),C=C.sibling;C=k,C===null?(k=v.child,v.child=null):(k=C.sibling,C.sibling=null),ca(v,!1,k,C,X,D);break;case"backwards":case"unstable_legacy-backwards":for(C=null,k=v.child,v.child=null;k!==null;){if(g=k.alternate,g!==null&&Jt(g)===null){v.child=k;break}g=k.sibling,k.sibling=C,C=k,k=g}ca(v,!0,C,null,X,D);break;case"together":ca(v,!1,null,null,void 0,D);break;default:v.memoizedState=null}return v.child}function ns(g,v,C){if(g!==null&&(v.dependencies=g.dependencies),xf|=v.lanes,(C&v.childLanes)===0)if(g!==null){if(cn(g,v,C,!1),(C&v.childLanes)===0)return null}else return null;if(g!==null&&v.child!==g.child)throw Error(r(153));if(v.child!==null){for(g=v.child,C=Du(g,g.pendingProps),v.child=C,C.return=v;g.sibling!==null;)g=g.sibling,C=C.sibling=Du(g,g.pendingProps),C.return=v;C.sibling=null}return v.child}function Do(g,v){return(g.lanes&v)!==0?!0:(g=g.dependencies,!!(g!==null&&In(g)))}function Y(g,v,C){switch(v.tag){case 3:nt(v,v.stateNode.containerInfo),gt(v,ia,g.memoizedState.cache),It();break;case 27:case 5:Ye(v);break;case 4:nt(v,v.stateNode.containerInfo);break;case 10:gt(v,v.type,v.memoizedProps.value);break;case 31:if(v.memoizedState!==null)return v.flags|=128,$e(v),null;break;case 13:var D=v.memoizedState;if(D!==null)return D.dehydrated!==null?(Fe(v),v.flags|=128,null):(C&v.child.childLanes)!==0?Hi(g,v,C):(Fe(v),g=ns(g,v,C),g!==null?g.sibling:null);Fe(v);break;case 19:var k=(g.flags&128)!==0;if(D=(C&v.childLanes)!==0,D||(cn(g,v,C,!1),D=(C&v.childLanes)!==0),k){if(D)return mr(g,v,C);v.flags|=128}if(k=v.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),y(Ra,Ra.current),D)break;return null;case 22:return v.lanes=0,J(g,v,C,v.pendingProps);case 24:gt(v,ia,g.memoizedState.cache)}return ns(g,v,C)}function xe(g,v,C){if(g!==null)if(g.memoizedProps!==v.pendingProps)js=!0;else{if(!Do(g,C)&&(v.flags&128)===0)return js=!1,Y(g,v,C);js=(g.flags&131072)!==0}else js=!1,Ar&&(v.flags&1048576)!==0&&ue(v,D1,v.index);switch(v.lanes=0,v.tag){case 16:e:{var D=v.pendingProps;if(g=ne(v.elementType),v.type=g,typeof g=="function")qm(g)?(D=Po(g,D),v.tag=1,v=fi(null,v,g,D,C)):(v.tag=0,v=un(null,v,g,D,C));else{if(g!=null){var k=g.$$typeof;if(k===W0){v.tag=11,v=$m(null,v,g,D,C);break e}else if(k===s_){v.tag=14,v=F(null,v,g,D,C);break e}}throw v=d(g)||g,Error(r(306,v,""))}}return v;case 0:return un(g,v,v.type,v.pendingProps,C);case 1:return D=v.type,k=Po(D,v.pendingProps),fi(g,v,D,k,C);case 3:e:{if(nt(v,v.stateNode.containerInfo),g===null)throw Error(r(387));var X=v.pendingProps;k=v.memoizedState,D=k.element,ye(g,v),Qt(v,X,null,C);var fe=v.memoizedState;if(X=fe.cache,gt(v,ia,X),X!==k.cache&&An(v,[ia],C,!0),sn(),X=fe.element,ta&&k.isDehydrated)if(k={element:X,isDehydrated:!1,cache:fe.cache},v.updateQueue.baseState=k,v.memoizedState=k,v.flags&256){v=oi(g,v,X,C);break e}else if(X!==D){D=_e(Error(r(424)),v),je(D),v=oi(g,v,X,C);break e}else for(ta&&(na=O3(v.stateNode.containerInfo),xo=v,Ar=!0,Qh=null,Il=!0),C=CT(v,null,X,C),v.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(It(),X===D){v=ns(g,v,C);break e}wa(g,v,X,C)}v=v.child}return v;case 26:if(Sc)return bt(g,v),g===null?(C=mT(v.type,null,v.pendingProps,null))?v.memoizedState=C:Ar||(v.stateNode=g_(v.type,v.pendingProps,$o.current,v)):v.memoizedState=mT(v.type,g.memoizedProps,v.pendingProps,g.memoizedState),null;case 27:if(vo)return Ye(v),g===null&&vo&&Ar&&(D=v.stateNode=y_(v.type,v.pendingProps,$o.current,Lo.current,!1),xo=v,Il=!0,na=uT(v.type,D,na)),wa(g,v,v.pendingProps.children,C),bt(g,v),g===null&&(v.flags|=4194304),v.child;case 5:return g===null&&Ar&&(q3(v.type,v.pendingProps,Lo.current),(k=D=na)&&(D=z3(D,v.type,v.pendingProps,Il),D!==null?(v.stateNode=D,xo=v,na=G3(D),Il=!1,k=!0):k=!1),k||ze(v)),Ye(v),k=v.type,X=v.pendingProps,fe=g!==null?g.memoizedProps:null,D=X.children,Ll(k,X)?D=null:fe!==null&&Ll(k,fe)&&(v.flags|=32),v.memoizedState!==null&&(k=yn(g,v,zn,null,null,C),za?og._currentValue=k:og._currentValue2=k),bt(g,v),wa(g,v,D,C),v.child;case 6:return g===null&&Ar&&(pT(v.pendingProps,Lo.current),(g=C=na)&&(C=V3(C,v.pendingProps,Il),C!==null?(v.stateNode=C,xo=v,na=null,g=!0):g=!1),g||ze(v)),null;case 13:return Hi(g,v,C);case 4:return nt(v,v.stateNode.containerInfo),D=v.pendingProps,g===null?v.child=Jo(v,null,D,C):wa(g,v,D,C),v.child;case 11:return $m(g,v,v.type,v.pendingProps,C);case 7:return wa(g,v,v.pendingProps,C),v.child;case 8:return wa(g,v,v.pendingProps.children,C),v.child;case 12:return wa(g,v,v.pendingProps.children,C),v.child;case 10:return D=v.pendingProps,gt(v,v.type,D.value),wa(g,v,D.children,C),v.child;case 9:return k=v.type._context,D=v.pendingProps.children,Zt(v),k=le(k),D=D(k),v.flags|=1,wa(g,v,D,C),v.child;case 14:return F(g,v,v.type,v.pendingProps,C);case 15:return H(g,v,v.type,v.pendingProps,C);case 19:return mr(g,v,C);case 31:return qe(g,v,C);case 22:return J(g,v,C,v.pendingProps);case 24:return Zt(v),D=le(ia),g===null?(k=kt(),k===null&&(k=ar,X=tt(),k.pooledCache=X,X.refCount++,X!==null&&(k.pooledCacheLanes|=C),k=X),v.memoizedState={parent:D,cache:k},ie(v),gt(v,ia,k)):((g.lanes&C)!==0&&(ye(g,v),Qt(v,null,null,C),sn()),k=g.memoizedState,X=v.memoizedState,k.parent!==D?(k={parent:D,cache:D},v.memoizedState=k,v.lanes===0&&(v.memoizedState=v.updateQueue.baseState=k),gt(v,ia,D)):(D=X.cache,gt(v,ia,D),D!==k.cache&&An(v,[ia],C,!0))),wa(g,v,v.pendingProps.children,C),v.child;case 29:throw v.pendingProps}throw Error(r(156,v.tag))}function Pe(g){g.flags|=4}function Ot(g){Nu&&(g.flags|=8)}function li(g,v){if(g!==null&&g.child===v.child)return!1;if((v.flags&16)!==0)return!0;for(g=v.child;g!==null;){if((g.flags&8218)!==0||(g.subtreeFlags&8218)!==0)return!0;g=g.sibling}return!1}function Yr(g,v,C,D){if(Pr)for(C=v.child;C!==null;){if(C.tag===5||C.tag===6)M1(g,C.stateNode);else if(!(C.tag===4||vo&&C.tag===27)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===v)break;for(;C.sibling===null;){if(C.return===null||C.return===v)return;C=C.return}C.sibling.return=C.return,C=C.sibling}else if(Nu)for(var k=v.child;k!==null;){if(k.tag===5){var X=k.stateNode;C&&D&&(X=B3(X,k.type,k.memoizedProps)),M1(g,X)}else if(k.tag===6)X=k.stateNode,C&&D&&(X=oT(X,k.memoizedProps)),M1(g,X);else if(k.tag!==4){if(k.tag===22&&k.memoizedState!==null)X=k.child,X!==null&&(X.return=k),Yr(g,k,!0,!0);else if(k.child!==null){k.child.return=k,k=k.child;continue}}if(k===v)break;for(;k.sibling===null;){if(k.return===null||k.return===v)return;k=k.return}k.sibling.return=k.return,k=k.sibling}}function eu(g,v,C,D){var k=!1;if(Nu)for(var X=v.child;X!==null;){if(X.tag===5){var fe=X.stateNode;C&&D&&(fe=B3(fe,X.type,X.memoizedProps)),sT(g,fe)}else if(X.tag===6)fe=X.stateNode,C&&D&&(fe=oT(fe,X.memoizedProps)),sT(g,fe);else if(X.tag!==4){if(X.tag===22&&X.memoizedState!==null)k=X.child,k!==null&&(k.return=X),eu(g,X,!0,!0),k=!0;else if(X.child!==null){X.child.return=X,X=X.child;continue}}if(X===v)break;for(;X.sibling===null;){if(X.return===null||X.return===v)return k;X=X.return}X.sibling.return=X.return,X=X.sibling}return k}function rf(g,v){if(Nu&&li(g,v)){g=v.stateNode;var C=g.containerInfo,D=rT();eu(D,v,!1,!1),g.pendingChildren=D,Pe(v),N3(C,D)}}function NA(g,v,C,D){if(Pr)g.memoizedProps!==D&&Pe(v);else if(Nu){var k=g.stateNode,X=g.memoizedProps;if((g=li(g,v))||X!==D){var fe=Lo.current;X=D3(k,C,X,D,!g,null),X===k?v.stateNode=k:(Ot(v),ru(X,C,D,fe)&&Pe(v),v.stateNode=X,g&&Yr(X,v,!1,!1))}else v.stateNode=k}}function Nl(g,v,C,D,k){if((g.mode&32)!==0&&(C===null?A1(v,D):$0(v,C,D))){if(g.flags|=16777216,(k&335544128)===k||jA(v,D))if(fa(g.stateNode,v,D))g.flags|=8192;else if(Rr())g.flags|=8192;else throw Gl=ed,E_}else g.flags&=-16777217}function B0(g,v){if(xT(v)){if(g.flags|=16777216,!bT(v))if(Rr())g.flags|=8192;else throw Gl=ed,E_}else g.flags&=-16777217}function c1(g,v){v!==null&&(g.flags|=4),g.flags&16384&&(v=g.tag!==22?T():536870912,g.lanes|=v,sy|=v)}function F0(g,v){if(!Ar)switch(g.tailMode){case"hidden":v=g.tail;for(var C=null;v!==null;)v.alternate!==null&&(C=v),v=v.sibling;C===null?g.tail=null:C.sibling=null;break;case"collapsed":C=g.tail;for(var D=null;C!==null;)C.alternate!==null&&(D=C),C=C.sibling;D===null?v||g.tail===null?g.tail=null:g.tail.sibling=null:D.sibling=null}}function Fs(g){var v=g.alternate!==null&&g.alternate.child===g.child,C=0,D=0;if(v)for(var k=g.child;k!==null;)C|=k.lanes|k.childLanes,D|=k.subtreeFlags&65011712,D|=k.flags&65011712,k.return=g,k=k.sibling;else for(k=g.child;k!==null;)C|=k.lanes|k.childLanes,D|=k.subtreeFlags,D|=k.flags,k.return=g,k=k.sibling;return g.subtreeFlags|=D,g.childLanes=C,v}function l3(g,v,C){var D=v.pendingProps;switch(Ce(v),v.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fs(v),null;case 1:return Fs(v),null;case 3:return C=v.stateNode,D=null,g!==null&&(D=g.memoizedState.cache),v.memoizedState.cache!==D&&(v.flags|=2048),yt(ia),Ae(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(g===null||g.child===null)&&(Wt(v)?Pe(v):g===null||g.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,ke())),rf(g,v),Fs(v),null;case 26:if(Sc){var k=v.type,X=v.memoizedState;return g===null?(Pe(v),X!==null?(Fs(v),B0(v,X)):(Fs(v),Nl(v,k,null,D,C))):X?X!==g.memoizedState?(Pe(v),Fs(v),B0(v,X)):(Fs(v),v.flags&=-16777217):(X=g.memoizedProps,Pr?X!==D&&Pe(v):NA(g,v,k,D),Fs(v),Nl(v,k,X,D,C)),null}case 27:if(vo){if(ft(v),C=$o.current,k=v.type,g!==null&&v.stateNode!=null)Pr?g.memoizedProps!==D&&Pe(v):NA(g,v,k,D);else{if(!D){if(v.stateNode===null)throw Error(r(166));return Fs(v),null}g=Lo.current,Wt(v)?ot(v,g):(g=y_(k,D,C,g,!0),v.stateNode=g,Pe(v))}return Fs(v),null}case 5:if(ft(v),k=v.type,g!==null&&v.stateNode!=null)NA(g,v,k,D);else{if(!D){if(v.stateNode===null)throw Error(r(166));return Fs(v),null}if(X=Lo.current,Wt(v))ot(v,X),K3(v.stateNode,k,D,X)&&(v.flags|=64);else{var fe=WA(k,D,$o.current,X,v);Ot(v),Yr(fe,v,!1,!1),v.stateNode=fe,ru(fe,k,D,X)&&Pe(v)}}return Fs(v),Nl(v,v.type,g===null?null:g.memoizedProps,v.pendingProps,C),null;case 6:if(g&&v.stateNode!=null)C=g.memoizedProps,Pr?C!==D&&Pe(v):Nu&&(C!==D?(g=$o.current,C=Lo.current,Ot(v),v.stateNode=ff(D,g,C,v)):v.stateNode=g.stateNode);else{if(typeof D!="string"&&v.stateNode===null)throw Error(r(166));if(g=$o.current,C=Lo.current,Wt(v)){if(!ta)throw Error(r(176));if(g=v.stateNode,C=v.memoizedProps,D=null,k=xo,k!==null)switch(k.tag){case 27:case 5:D=k.memoizedProps}mI(g,C,v,D)||ze(v,!0)}else Ot(v),v.stateNode=ff(D,g,C,v)}return Fs(v),null;case 31:if(C=v.memoizedState,g===null||g.memoizedState!==null){if(D=Wt(v),C!==null){if(g===null){if(!D)throw Error(r(318));if(!ta)throw Error(r(556));if(g=v.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(r(557));hT(g,v)}else It(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;Fs(v),g=!1}else C=ke(),g!==null&&g.memoizedState!==null&&(g.memoizedState.hydrationErrors=C),g=!0;if(!g)return v.flags&256?(zt(v),v):(zt(v),null);if((v.flags&128)!==0)throw Error(r(558))}return Fs(v),null;case 13:if(D=v.memoizedState,g===null||g.memoizedState!==null&&g.memoizedState.dehydrated!==null){if(k=Wt(v),D!==null&&D.dehydrated!==null){if(g===null){if(!k)throw Error(r(318));if(!ta)throw Error(r(344));if(k=v.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(r(317));W3(k,v)}else It(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;Fs(v),k=!1}else k=ke(),g!==null&&g.memoizedState!==null&&(g.memoizedState.hydrationErrors=k),k=!0;if(!k)return v.flags&256?(zt(v),v):(zt(v),null)}return zt(v),(v.flags&128)!==0?(v.lanes=C,v):(C=D!==null,g=g!==null&&g.memoizedState!==null,C&&(D=v.child,k=null,D.alternate!==null&&D.alternate.memoizedState!==null&&D.alternate.memoizedState.cachePool!==null&&(k=D.alternate.memoizedState.cachePool.pool),X=null,D.memoizedState!==null&&D.memoizedState.cachePool!==null&&(X=D.memoizedState.cachePool.pool),X!==k&&(D.flags|=2048)),C!==g&&C&&(v.child.flags|=8192),c1(v,v.updateQueue),Fs(v),null);case 4:return Ae(),rf(g,v),g===null&&Ms(v.stateNode.containerInfo),Fs(v),null;case 10:return yt(v.type),Fs(v),null;case 19:if(m(Ra),D=v.memoizedState,D===null)return Fs(v),null;if(k=(v.flags&128)!==0,X=D.rendering,X===null)if(k)F0(D,!1);else{if(ga!==0||g!==null&&(g.flags&128)!==0)for(g=v.child;g!==null;){if(X=Jt(g),X!==null){for(v.flags|=128,F0(D,!1),g=X.updateQueue,v.updateQueue=g,c1(v,g),v.subtreeFlags=0,g=C,C=v.child;C!==null;)e_(C,g),C=C.sibling;return y(Ra,Ra.current&1|2),Ar&&Be(v,D.treeForkCount),v.child}g=g.sibling}D.tail!==null&&cl()>Gp&&(v.flags|=128,k=!0,F0(D,!1),v.lanes=4194304)}else{if(!k)if(g=Jt(X),g!==null){if(v.flags|=128,k=!0,g=g.updateQueue,v.updateQueue=g,c1(v,g),F0(D,!0),D.tail===null&&D.tailMode==="hidden"&&!X.alternate&&!Ar)return Fs(v),null}else 2*cl()-D.renderingStartTime>Gp&&C!==536870912&&(v.flags|=128,k=!0,F0(D,!1),v.lanes=4194304);D.isBackwards?(X.sibling=v.child,v.child=X):(g=D.last,g!==null?g.sibling=X:v.child=X,D.last=X)}return D.tail!==null?(g=D.tail,D.rendering=g,D.tail=g.sibling,D.renderingStartTime=cl(),g.sibling=null,C=Ra.current,y(Ra,k?C&1|2:C&1),Ar&&Be(v,D.treeForkCount),g):(Fs(v),null);case 22:case 23:return zt(v),de(),D=v.memoizedState!==null,g!==null?g.memoizedState!==null!==D&&(v.flags|=8192):D&&(v.flags|=8192),D?(C&536870912)!==0&&(v.flags&128)===0&&(Fs(v),v.subtreeFlags&6&&(v.flags|=8192)):Fs(v),C=v.updateQueue,C!==null&&c1(v,C.retryQueue),C=null,g!==null&&g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(C=g.memoizedState.cachePool.pool),D=null,v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(D=v.memoizedState.cachePool.pool),D!==C&&(v.flags|=2048),g!==null&&m(Rp),null;case 24:return C=null,g!==null&&(C=g.memoizedState.cache),v.memoizedState.cache!==C&&(v.flags|=2048),yt(ia),Fs(v),null;case 25:return null;case 30:return null}throw Error(r(156,v.tag))}function BA(g,v){switch(Ce(v),v.tag){case 1:return g=v.flags,g&65536?(v.flags=g&-65537|128,v):null;case 3:return yt(ia),Ae(),g=v.flags,(g&65536)!==0&&(g&128)===0?(v.flags=g&-65537|128,v):null;case 26:case 27:case 5:return ft(v),null;case 31:if(v.memoizedState!==null){if(zt(v),v.alternate===null)throw Error(r(340));It()}return g=v.flags,g&65536?(v.flags=g&-65537|128,v):null;case 13:if(zt(v),g=v.memoizedState,g!==null&&g.dehydrated!==null){if(v.alternate===null)throw Error(r(340));It()}return g=v.flags,g&65536?(v.flags=g&-65537|128,v):null;case 19:return m(Ra),null;case 4:return Ae(),null;case 10:return yt(v.type),null;case 22:case 23:return zt(v),de(),g!==null&&m(Rp),g=v.flags,g&65536?(v.flags=g&-65537|128,v):null;case 24:return yt(ia),null;case 25:return null;default:return null}}function u3(g,v){switch(Ce(v),v.tag){case 3:yt(ia),Ae();break;case 26:case 27:case 5:ft(v);break;case 4:Ae();break;case 31:v.memoizedState!==null&&zt(v);break;case 13:zt(v);break;case 19:m(Ra);break;case 10:yt(v.type);break;case 22:case 23:zt(v),de(),g!==null&&m(Rp);break;case 24:yt(ia)}}function Uh(g,v){try{var C=v.updateQueue,D=C!==null?C.lastEffect:null;if(D!==null){var k=D.next;C=k;do{if((C.tag&g)===g){D=void 0;var X=C.create,fe=C.inst;D=X(),fe.destroy=D}C=C.next}while(C!==k)}}catch(Xe){Fi(v,v.return,Xe)}}function kh(g,v,C){try{var D=v.updateQueue,k=D!==null?D.lastEffect:null;if(k!==null){var X=k.next;D=X;do{if((D.tag&g)===g){var fe=D.inst,Xe=fe.destroy;if(Xe!==void 0){fe.destroy=void 0,k=v;var Rt=C,an=Xe;try{an()}catch(Pn){Fi(k,Rt,Pn)}}}D=D.next}while(D!==X)}}catch(Pn){Fi(v,v.return,Pn)}}function L0(g){var v=g.updateQueue;if(v!==null){var C=g.stateNode;try{ln(v,C)}catch(D){Fi(g,g.return,D)}}}function Hb(g,v,C){C.props=Po(g.type,g.memoizedProps),C.state=g.memoizedState;try{C.componentWillUnmount()}catch(D){Fi(g,v,D)}}function I0(g,v){try{var C=g.ref;if(C!==null){switch(g.tag){case 26:case 27:case 5:var D=j0(g.stateNode);break;case 30:D=g.stateNode;break;default:D=g.stateNode}typeof C=="function"?g.refCleanup=C(D):C.current=D}}catch(k){Fi(g,v,k)}}function ul(g,v){var C=g.ref,D=g.refCleanup;if(C!==null)if(typeof D=="function")try{D()}catch(k){Fi(g,v,k)}finally{g.refCleanup=null,g=g.alternate,g!=null&&(g.refCleanup=null)}else if(typeof C=="function")try{C(null)}catch(k){Fi(g,v,k)}else C.current=null}function Jm(g){var v=g.type,C=g.memoizedProps,D=g.stateNode;try{M3(D,v,C,g)}catch(k){Fi(g,g.return,k)}}function h1(g,v,C){try{A3(g.stateNode,g.type,C,v,g)}catch(D){Fi(g,g.return,D)}}function FA(g){return g.tag===5||g.tag===3||(Sc?g.tag===26:!1)||(vo?g.tag===27&&lg(g.type):!1)||g.tag===4}function sf(g){e:for(;;){for(;g.sibling===null;){if(g.return===null||FA(g.return))return null;g=g.return}for(g.sibling.return=g.return,g=g.sibling;g.tag!==5&&g.tag!==6&&g.tag!==18;){if(vo&&g.tag===27&&lg(g.type)||g.flags&2||g.child===null||g.tag===4)continue e;g.child.return=g,g=g.child}if(!(g.flags&2))return g.stateNode}}function Xb(g,v,C){var D=g.tag;if(D===5||D===6)g=g.stateNode,v?C3(C,g,v):eT(C,g);else if(D!==4&&(vo&&D===27&&lg(g.type)&&(C=g.stateNode,v=null),g=g.child,g!==null))for(Xb(g,v,C),g=g.sibling;g!==null;)Xb(g,v,C),g=g.sibling}function d1(g,v,C){var D=g.tag;if(D===5||D===6)g=g.stateNode,v?T3(C,g,v):QA(C,g);else if(D!==4&&(vo&&D===27&&lg(g.type)&&(C=g.stateNode),g=g.child,g!==null))for(d1(g,v,C),g=g.sibling;g!==null;)d1(g,v,C),g=g.sibling}function LA(g,v,C){g=g.containerInfo;try{aT(g,C)}catch(D){Fi(v,v.return,D)}}function c3(g){var v=g.stateNode,C=g.memoizedProps;try{ro(g.type,C,v,g)}catch(D){Fi(g,g.return,D)}}function hI(g,v){for(a_(g.containerInfo),Xa=v;Xa!==null;)if(g=Xa,v=g.child,(g.subtreeFlags&1028)!==0&&v!==null)v.return=g,Xa=v;else for(;Xa!==null;){g=Xa;var C=g.alternate;switch(v=g.flags,g.tag){case 0:if((v&4)!==0&&(v=g.updateQueue,v=v!==null?v.events:null,v!==null))for(var D=0;D<v.length;D++){var k=v[D];k.ref.impl=k.nextImpl}break;case 11:case 15:break;case 1:if((v&1024)!==0&&C!==null){v=void 0,D=g,k=C.memoizedProps,C=C.memoizedState;var X=D.stateNode;try{var fe=Po(D.type,k);v=X.getSnapshotBeforeUpdate(fe,C),X.__reactInternalSnapshotBeforeUpdate=v}catch(Xe){Fi(D,D.return,Xe)}}break;case 3:(v&1024)!==0&&Pr&&iT(g.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((v&1024)!==0)throw Error(r(163))}if(v=g.sibling,v!==null){v.return=g.return,Xa=v;break}Xa=g.return}}function h3(g,v,C){var D=C.flags;switch(C.tag){case 0:case 11:case 15:Bl(g,C),D&4&&Uh(5,C);break;case 1:if(Bl(g,C),D&4)if(g=C.stateNode,v===null)try{g.componentDidMount()}catch(fe){Fi(C,C.return,fe)}else{var k=Po(C.type,v.memoizedProps);v=v.memoizedState;try{g.componentDidUpdate(k,v,g.__reactInternalSnapshotBeforeUpdate)}catch(fe){Fi(C,C.return,fe)}}D&64&&L0(C),D&512&&I0(C,C.return);break;case 3:if(Bl(g,C),D&64&&(D=C.updateQueue,D!==null)){if(g=null,C.child!==null)switch(C.child.tag){case 27:case 5:g=j0(C.child.stateNode);break;case 1:g=C.child.stateNode}try{ln(D,g)}catch(fe){Fi(C,C.return,fe)}}break;case 27:vo&&v===null&&D&4&&c3(C);case 26:case 5:if(Bl(g,C),v===null){if(D&4)Jm(C);else if(D&64){g=C.type,v=C.memoizedProps,k=C.stateNode;try{j3(k,g,v,C)}catch(fe){Fi(C,C.return,fe)}}}D&512&&I0(C,C.return);break;case 12:Bl(g,C);break;case 31:Bl(g,C),D&4&&gc(g,C);break;case 13:Bl(g,C),D&4&&p1(g,C),D&64&&(D=C.memoizedState,D!==null&&(D=D.dehydrated,D!==null&&(C=dI.bind(null,C),f_(D,C))));break;case 22:if(D=C.memoizedState!==null||Pa,!D){v=v!==null&&v.memoizedState!==null||Da,k=Pa;var X=Da;Pa=D,(Da=v)&&!X?vc(g,C,(C.subtreeFlags&8772)!==0):Bl(g,C),Pa=k,Da=X}break;case 30:break;default:Bl(g,C)}}function IA(g){var v=g.alternate;v!==null&&(g.alternate=null,IA(v)),g.child=null,g.deletions=null,g.sibling=null,g.tag===5&&(v=g.stateNode,v!==null&&o_(v)),g.stateNode=null,g.return=null,g.dependencies=null,g.memoizedProps=null,g.memoizedState=null,g.pendingProps=null,g.stateNode=null,g.updateQueue=null}function mc(g,v,C){for(C=C.child;C!==null;)f1(g,v,C),C=C.sibling}function f1(g,v,C){if(ou&&typeof ou.onCommitFiberUnmount=="function")try{ou.onCommitFiberUnmount(hg,C)}catch{}switch(C.tag){case 26:if(Sc){Da||ul(C,v),mc(g,v,C),C.memoizedState?wp(C.memoizedState):C.stateNode&&vT(C.stateNode);break}case 27:if(vo){Da||ul(C,v);var D=ma,k=Wa;lg(C.type)&&(ma=C.stateNode,Wa=!1),mc(g,v,C),Fo(C.stateNode),ma=D,Wa=k;break}case 5:Da||ul(C,v);case 6:if(Pr){if(D=ma,k=Wa,ma=null,mc(g,v,C),ma=D,Wa=k,ma!==null)if(Wa)try{tT(ma,C.stateNode)}catch(X){Fi(C,v,X)}else try{w3(ma,C.stateNode)}catch(X){Fi(C,v,X)}}else mc(g,v,C);break;case 18:Pr&&ma!==null&&(Wa?p_(ma,C.stateNode):fT(ma,C.stateNode));break;case 4:Pr?(D=ma,k=Wa,ma=C.stateNode.containerInfo,Wa=!0,mc(g,v,C),ma=D,Wa=k):(Nu&&LA(C.stateNode,C,rT()),mc(g,v,C));break;case 0:case 11:case 14:case 15:kh(2,C,v),Da||kh(4,C,v),mc(g,v,C);break;case 1:Da||(ul(C,v),D=C.stateNode,typeof D.componentWillUnmount=="function"&&Hb(C,v,D)),mc(g,v,C);break;case 21:mc(g,v,C);break;case 22:Da=(D=Da)||C.memoizedState!==null,mc(g,v,C),Da=D;break;default:mc(g,v,C)}}function gc(g,v){if(ta&&v.memoizedState===null&&(g=v.alternate,g!==null&&(g=g.memoizedState,g!==null))){g=g.dehydrated;try{gI(g)}catch(C){Fi(v,v.return,C)}}}function p1(g,v){if(ta&&v.memoizedState===null&&(g=v.alternate,g!==null&&(g=g.memoizedState,g!==null&&(g=g.dehydrated,g!==null))))try{yI(g)}catch(C){Fi(v,v.return,C)}}function yc(g){switch(g.tag){case 31:case 13:case 19:var v=g.stateNode;return v===null&&(v=g.stateNode=new ET),v;case 22:return g=g.stateNode,v=g._retryCache,v===null&&(v=g._retryCache=new ET),v;default:throw Error(r(435,g.tag))}}function af(g,v){var C=yc(g);v.forEach(function(D){if(!C.has(D)){C.add(D);var k=fI.bind(null,g,D);D.then(k,k)}})}function No(g,v){var C=v.deletions;if(C!==null)for(var D=0;D<C.length;D++){var k=C[D],X=g,fe=v;if(Pr){var Xe=fe;e:for(;Xe!==null;){switch(Xe.tag){case 27:if(vo){if(lg(Xe.type)){ma=Xe.stateNode,Wa=!1;break e}break}case 5:ma=Xe.stateNode,Wa=!1;break e;case 3:case 4:ma=Xe.stateNode.containerInfo,Wa=!0;break e}Xe=Xe.return}if(ma===null)throw Error(r(160));f1(X,fe,k),ma=null,Wa=!1}else f1(X,fe,k);X=k.alternate,X!==null&&(X.return=null),k.return=null}if(v.subtreeFlags&13886)for(v=v.child;v!==null;)m1(v,g),v=v.sibling}function m1(g,v){var C=g.alternate,D=g.flags;switch(g.tag){case 0:case 11:case 14:case 15:No(v,g),Bo(g),D&4&&(kh(3,g,g.return),Uh(3,g),kh(5,g,g.return));break;case 1:No(v,g),Bo(g),D&512&&(Da||C===null||ul(C,C.return)),D&64&&Pa&&(g=g.updateQueue,g!==null&&(D=g.callbacks,D!==null&&(C=g.shared.hiddenCallbacks,g.shared.hiddenCallbacks=C===null?D:C.concat(D))));break;case 26:if(Sc){var k=gs;if(No(v,g),Bo(g),D&512&&(Da||C===null||ul(C,C.return)),D&4){D=C!==null?C.memoizedState:null;var X=g.memoizedState;C===null?X===null?g.stateNode===null?g.stateNode=Q3(k,g.type,g.memoizedProps,g):yT(k,g.type,g.stateNode):g.stateNode=gT(k,X,g.memoizedProps):D!==X?(D===null?C.stateNode!==null&&vT(C.stateNode):wp(D),X===null?yT(k,g.type,g.stateNode):gT(k,X,g.memoizedProps)):X===null&&g.stateNode!==null&&h1(g,g.memoizedProps,C.memoizedProps)}break}case 27:if(vo){No(v,g),Bo(g),D&512&&(Da||C===null||ul(C,C.return)),C!==null&&D&4&&h1(g,g.memoizedProps,C.memoizedProps);break}case 5:if(No(v,g),Bo(g),D&512&&(Da||C===null||ul(C,C.return)),Pr){if(g.flags&32){k=g.stateNode;try{nT(k)}catch(mn){Fi(g,g.return,mn)}}D&4&&g.stateNode!=null&&(k=g.memoizedProps,h1(g,k,C!==null?C.memoizedProps:k)),D&1024&&(ey=!0)}else Nu&&g.alternate!==null&&(g.alternate.stateNode=g.stateNode);break;case 6:if(No(v,g),Bo(g),D&4&&Pr){if(g.stateNode===null)throw Error(r(162));D=g.memoizedProps,C=C!==null?C.memoizedProps:D,k=g.stateNode;try{S3(k,C,D)}catch(mn){Fi(g,g.return,mn)}}break;case 3:if(Sc?(eP(),k=gs,gs=w1(v.containerInfo),No(v,g),gs=k):No(v,g),Bo(g),D&4){if(Pr&&ta&&C!==null&&C.memoizedState.isDehydrated)try{Y3(v.containerInfo)}catch(mn){Fi(g,g.return,mn)}if(Nu){D=v.containerInfo,C=v.pendingChildren;try{aT(D,C)}catch(mn){Fi(g,g.return,mn)}}}ey&&(ey=!1,Wb(g));break;case 4:Sc?(C=gs,gs=w1(g.stateNode.containerInfo),No(v,g),Bo(g),gs=C):(No(v,g),Bo(g)),D&4&&Nu&&LA(g.stateNode,g,g.stateNode.pendingChildren);break;case 12:No(v,g),Bo(g);break;case 31:No(v,g),Bo(g),D&4&&(D=g.updateQueue,D!==null&&(g.updateQueue=null,af(g,D)));break;case 13:No(v,g),Bo(g),g.child.flags&8192&&g.memoizedState!==null!=(C!==null&&C.memoizedState!==null)&&(G1=cl()),D&4&&(D=g.updateQueue,D!==null&&(g.updateQueue=null,af(g,D)));break;case 22:k=g.memoizedState!==null;var fe=C!==null&&C.memoizedState!==null,Xe=Pa,Rt=Da;if(Pa=Xe||k,Da=Rt||fe,No(v,g),Da=Rt,Pa=Xe,Bo(g),D&8192&&(v=g.stateNode,v._visibility=k?v._visibility&-2:v._visibility|1,k&&(C===null||fe||Pa||Da||pp(g)),Pr)){e:if(C=null,Pr)for(v=g;;){if(v.tag===5||Sc&&v.tag===26){if(C===null){fe=C=v;try{X=fe.stateNode,k?pI(X):R3(fe.stateNode,fe.memoizedProps)}catch(mn){Fi(fe,fe.return,mn)}}}else if(v.tag===6){if(C===null){fe=v;try{var an=fe.stateNode;k?E3(an):P3(an,fe.memoizedProps)}catch(mn){Fi(fe,fe.return,mn)}}}else if(v.tag===18){if(C===null){fe=v;try{var Pn=fe.stateNode;k?$3(Pn):J3(fe.stateNode)}catch(mn){Fi(fe,fe.return,mn)}}}else if((v.tag!==22&&v.tag!==23||v.memoizedState===null||v===g)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===g)break e;for(;v.sibling===null;){if(v.return===null||v.return===g)break e;C===v&&(C=null),v=v.return}C===v&&(C=null),v.sibling.return=v.return,v=v.sibling}}D&4&&(D=g.updateQueue,D!==null&&(C=D.retryQueue,C!==null&&(D.retryQueue=null,af(g,C))));break;case 19:No(v,g),Bo(g),D&4&&(D=g.updateQueue,D!==null&&(g.updateQueue=null,af(g,D)));break;case 30:break;case 21:break;default:No(v,g),Bo(g)}}function Bo(g){var v=g.flags;if(v&2){try{for(var C,D=g.return;D!==null;){if(FA(D)){C=D;break}D=D.return}if(Pr){if(C==null)throw Error(r(160));switch(C.tag){case 27:if(vo){var k=C.stateNode,X=sf(g);d1(g,X,k);break}case 5:var fe=C.stateNode;C.flags&32&&(nT(fe),C.flags&=-33);var Xe=sf(g);d1(g,Xe,fe);break;case 3:case 4:var Rt=C.stateNode.containerInfo,an=sf(g);Xb(g,an,Rt);break;default:throw Error(r(161))}}}catch(Pn){Fi(g,g.return,Pn)}g.flags&=-3}v&4096&&(g.flags&=-4097)}function Wb(g){if(g.subtreeFlags&1024)for(g=g.child;g!==null;){var v=g;Wb(v),v.tag===5&&v.flags&1024&&KA(v.stateNode),g=g.sibling}}function Bl(g,v){if(v.subtreeFlags&8772)for(v=v.child;v!==null;)h3(g,v.alternate,v),v=v.sibling}function pp(g){for(g=g.child;g!==null;){var v=g;switch(v.tag){case 0:case 11:case 14:case 15:kh(4,v,v.return),pp(v);break;case 1:ul(v,v.return);var C=v.stateNode;typeof C.componentWillUnmount=="function"&&Hb(v,v.return,C),pp(v);break;case 27:vo&&Fo(v.stateNode);case 26:case 5:ul(v,v.return),pp(v);break;case 22:v.memoizedState===null&&pp(v);break;case 30:pp(v);break;default:pp(v)}g=g.sibling}}function vc(g,v,C){for(C=C&&(v.subtreeFlags&8772)!==0,v=v.child;v!==null;){var D=v.alternate,k=g,X=v,fe=X.flags;switch(X.tag){case 0:case 11:case 15:vc(k,X,C),Uh(4,X);break;case 1:if(vc(k,X,C),D=X,k=D.stateNode,typeof k.componentDidMount=="function")try{k.componentDidMount()}catch(an){Fi(D,D.return,an)}if(D=X,k=D.updateQueue,k!==null){var Xe=D.stateNode;try{var Rt=k.shared.hiddenCallbacks;if(Rt!==null)for(k.shared.hiddenCallbacks=null,k=0;k<Rt.length;k++)on(Rt[k],Xe)}catch(an){Fi(D,D.return,an)}}C&&fe&64&&L0(X),I0(X,X.return);break;case 27:vo&&c3(X);case 26:case 5:vc(k,X,C),C&&D===null&&fe&4&&Jm(X),I0(X,X.return);break;case 12:vc(k,X,C);break;case 31:vc(k,X,C),C&&fe&4&&gc(k,X);break;case 13:vc(k,X,C),C&&fe&4&&p1(k,X);break;case 22:X.memoizedState===null&&vc(k,X,C),I0(X,X.return);break;case 30:break;default:vc(k,X,C)}v=v.sibling}}function mp(g,v){var C=null;g!==null&&g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(C=g.memoizedState.cachePool.pool),g=null,v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(g=v.memoizedState.cachePool.pool),g!==C&&(g!=null&&g.refCount++,C!=null&&et(C))}function GA(g,v){g=null,v.alternate!==null&&(g=v.alternate.memoizedState.cache),v=v.memoizedState.cache,v!==g&&(v.refCount++,g!=null&&et(g))}function ha(g,v,C,D){if(v.subtreeFlags&10256)for(v=v.child;v!==null;)Zb(g,v,C,D),v=v.sibling}function Zb(g,v,C,D){var k=v.flags;switch(v.tag){case 0:case 11:case 15:ha(g,v,C,D),k&2048&&Uh(9,v);break;case 1:ha(g,v,C,D);break;case 3:ha(g,v,C,D),k&2048&&(g=null,v.alternate!==null&&(g=v.alternate.memoizedState.cache),v=v.memoizedState.cache,v!==g&&(v.refCount++,g!=null&&et(g)));break;case 12:if(k&2048){ha(g,v,C,D),g=v.stateNode;try{var X=v.memoizedProps,fe=X.id,Xe=X.onPostCommit;typeof Xe=="function"&&Xe(fe,v.alternate===null?"mount":"update",g.passiveEffectDuration,-0)}catch(Rt){Fi(v,v.return,Rt)}}else ha(g,v,C,D);break;case 31:ha(g,v,C,D);break;case 13:ha(g,v,C,D);break;case 23:break;case 22:X=v.stateNode,fe=v.alternate,v.memoizedState!==null?X._visibility&2?ha(g,v,C,D):G0(g,v):X._visibility&2?ha(g,v,C,D):(X._visibility|=2,tu(g,v,C,D,(v.subtreeFlags&10256)!==0||!1)),k&2048&&mp(fe,v);break;case 24:ha(g,v,C,D),k&2048&&GA(v.alternate,v);break;default:ha(g,v,C,D)}}function tu(g,v,C,D,k){for(k=k&&((v.subtreeFlags&10256)!==0||!1),v=v.child;v!==null;){var X=g,fe=v,Xe=C,Rt=D,an=fe.flags;switch(fe.tag){case 0:case 11:case 15:tu(X,fe,Xe,Rt,k),Uh(8,fe);break;case 23:break;case 22:var Pn=fe.stateNode;fe.memoizedState!==null?Pn._visibility&2?tu(X,fe,Xe,Rt,k):G0(X,fe):(Pn._visibility|=2,tu(X,fe,Xe,Rt,k)),k&&an&2048&&mp(fe.alternate,fe);break;case 24:tu(X,fe,Xe,Rt,k),k&&an&2048&&GA(fe.alternate,fe);break;default:tu(X,fe,Xe,Rt,k)}v=v.sibling}}function G0(g,v){if(v.subtreeFlags&10256)for(v=v.child;v!==null;){var C=g,D=v,k=D.flags;switch(D.tag){case 22:G0(C,D),k&2048&&mp(D.alternate,D);break;case 24:G0(C,D),k&2048&&GA(D.alternate,D);break;default:G0(C,D)}v=v.sibling}}function zh(g,v,C){if(g.subtreeFlags&Iu)for(g=g.child;g!==null;)gp(g,v,C),g=g.sibling}function gp(g,v,C){switch(g.tag){case 26:if(zh(g,v,C),g.flags&Iu)if(g.memoizedState!==null)tP(C,gs,g.memoizedState,g.memoizedProps);else{var D=g.stateNode,k=g.type;g=g.memoizedProps,((v&335544128)===v||jA(k,g))&&l_(C,D,k,g)}break;case 5:zh(g,v,C),g.flags&Iu&&(D=g.stateNode,k=g.type,g=g.memoizedProps,((v&335544128)===v||jA(k,g))&&l_(C,D,k,g));break;case 3:case 4:Sc?(D=gs,gs=w1(g.stateNode.containerInfo),zh(g,v,C),gs=D):zh(g,v,C);break;case 22:g.memoizedState===null&&(D=g.alternate,D!==null&&D.memoizedState!==null?(D=Iu,Iu=16777216,zh(g,v,C),Iu=D):zh(g,v,C));break;default:zh(g,v,C)}}function jb(g){var v=g.alternate;if(v!==null&&(g=v.child,g!==null)){v.child=null;do v=g.sibling,g.sibling=null,g=v;while(g!==null)}}function O0(g){var v=g.deletions;if((g.flags&16)!==0){if(v!==null)for(var C=0;C<v.length;C++){var D=v[C];Xa=D,Ru(D,g)}jb(g)}if(g.subtreeFlags&10256)for(g=g.child;g!==null;)Yb(g),g=g.sibling}function Yb(g){switch(g.tag){case 0:case 11:case 15:O0(g),g.flags&2048&&kh(9,g,g.return);break;case 3:O0(g);break;case 12:O0(g);break;case 22:var v=g.stateNode;g.memoizedState!==null&&v._visibility&2&&(g.return===null||g.return.tag!==13)?(v._visibility&=-3,g1(g)):O0(g);break;default:O0(g)}}function g1(g){var v=g.deletions;if((g.flags&16)!==0){if(v!==null)for(var C=0;C<v.length;C++){var D=v[C];Xa=D,Ru(D,g)}jb(g)}for(g=g.child;g!==null;){switch(v=g,v.tag){case 0:case 11:case 15:kh(8,v,v.return),g1(v);break;case 22:C=v.stateNode,C._visibility&2&&(C._visibility&=-3,g1(v));break;default:g1(v)}g=g.sibling}}function Ru(g,v){for(;Xa!==null;){var C=Xa;switch(C.tag){case 0:case 11:case 15:kh(8,C,v);break;case 23:case 22:if(C.memoizedState!==null&&C.memoizedState.cachePool!==null){var D=C.memoizedState.cachePool.pool;D!=null&&D.refCount++}break;case 24:et(C.memoizedState.cache)}if(D=C.child,D!==null)D.return=C,Xa=D;else e:for(C=g;Xa!==null;){D=Xa;var k=D.sibling,X=D.return;if(IA(D),D===C){Xa=null;break e}if(k!==null){k.return=X,Xa=k;break e}Xa=X}}}function yp(g){var v=Ki(g);if(v!=null){if(typeof v.memoizedProps["data-testname"]!="string")throw Error(r(364));return v}if(g=Va(g),g===null)throw Error(r(362));return g.stateNode.current}function vp(g,v){var C=g.tag;switch(v.$$typeof){case Pc:if(g.type===v.value)return!0;break;case ny:e:{for(v=v.value,g=[g,0],C=0;C<g.length;){var D=g[C++],k=D.tag,X=g[C++],fe=v[X];if(k!==5&&k!==26&&k!==27||!Tp(D)){for(;fe!=null&&vp(D,fe);)X++,fe=v[X];if(X===v.length){v=!0;break e}else for(D=D.child;D!==null;)g.push(D,X),D=D.sibling}}v=!1}return v;case iy:if((C===5||C===26||C===27)&&qA(g.stateNode,v.value))return!0;break;case Bp:if((C===5||C===6||C===26||C===27)&&(g=T1(g),g!==null&&0<=g.indexOf(v.value)))return!0;break;case L1:if((C===5||C===26||C===27)&&(g=g.memoizedProps["data-testname"],typeof g=="string"&&g.toLowerCase()===v.value.toLowerCase()))return!0;break;default:throw Error(r(365))}return!1}function U0(g){switch(g.$$typeof){case Pc:return"<"+(d(g.value)||"Unknown")+">";case ny:return":has("+(U0(g)||"")+")";case iy:return'[role="'+g.value+'"]';case Bp:return'"'+g.value+'"';case L1:return'[data-testname="'+g.value+'"]';default:throw Error(r(365))}}function k0(g,v){var C=[];g=[g,0];for(var D=0;D<g.length;){var k=g[D++],X=k.tag,fe=g[D++],Xe=v[fe];if(X!==5&&X!==26&&X!==27||!Tp(k)){for(;Xe!=null&&vp(k,Xe);)fe++,Xe=v[fe];if(fe===v.length)C.push(k);else for(k=k.child;k!==null;)g.push(k,fe),k=k.sibling}}return C}function nu(g,v){if(!yo)throw Error(r(363));g=yp(g),g=k0(g,v),v=[],g=Array.from(g);for(var C=0;C<g.length;){var D=g[C++],k=D.tag;if(k===5||k===26||k===27)Tp(D)||v.push(D.stateNode);else for(D=D.child;D!==null;)g.push(D),D=D.sibling}return v}function ea(){return(gr&2)!==0&&Tr!==0?Tr&-Tr:bi.T!==null?Je():K0()}function of(){if(Ul===0)if((Tr&536870912)===0||Ar){var g=cg;cg<<=1,(cg&3932160)===0&&(cg=262144),Ul=g}else Ul=536870912;return g=lu.current,g!==null&&(g.flags|=32),Ul}function da(g,v,C){(g===ar&&(ys===2||ys===9)||g.cancelPendingCommit!==null)&&(Ea(g,0),Hh(g,Tr,Ul,!1)),R(g,C),((gr&2)===0||g!==ar)&&(g===ar&&((gr&2)===0&&(Ip|=C),ga===4&&Hh(g,Tr,Ul,!1)),jt(g))}function nh(g,v,C){if((gr&6)!==0)throw Error(r(327));var D=!C&&(v&127)===0&&(v&g.expiredLanes)===0||M(g,v),k=D?p3(g,v):Xh(g,v,!0),X=D;do{if(k===0){Fp&&!D&&Hh(g,v,0,!1);break}else{if(C=g.current.alternate,X&&!d3(C)){k=Xh(g,v,!1),X=!1;continue}if(k===2){if(X=v,g.errorRecoveryDisabledLanes&X)var fe=0;else fe=g.pendingLanes&-536870913,fe=fe!==0?fe:fe&536870912?536870912:0;if(fe!==0){v=fe;e:{var Xe=g;k=I1;var Rt=ta&&Xe.current.memoizedState.isDehydrated;if(Rt&&(Ea(Xe,fe).flags|=256),fe=Xh(Xe,fe,!1),fe!==2){if(Lp&&!Rt){Xe.errorRecoveryDisabledLanes|=X,Ip|=X,k=4;break e}X=cu,cu=k,X!==null&&(cu===null?cu=X:cu.push.apply(cu,X))}k=fe}if(X=!1,k!==2)continue}}if(k===1){Ea(g,0),Hh(g,v,0,!0);break}e:{switch(D=g,X=k,X){case 0:case 1:throw Error(r(345));case 4:if((v&4194048)!==v)break;case 6:Hh(D,v,Ul,!ah);break e;case 2:cu=null;break;case 3:case 5:break;default:throw Error(r(329))}if((v&62914560)===v&&(k=G1+300-cl(),10<k)){if(Hh(D,v,Ul,!ah),b(D,0,!0)!==0)break e;rd=v,D.timeoutHandle=ZA(Vh.bind(null,D,C,cu,O1,P_,v,Ul,Ip,sy,ah,X,"Throttled",-0,0),k);break e}Vh(D,C,cu,O1,P_,v,Ul,Ip,sy,ah,X,null,-0,0)}}break}while(!0);jt(g)}function Vh(g,v,C,D,k,X,fe,Xe,Rt,an,Pn,mn,Yn,ji){if(g.timeoutHandle=su,mn=v.subtreeFlags,mn&8192||(mn&16785408)===16785408){mn=YA(),gp(v,X,mn);var Za=(X&62914560)===X?G1-cl():(X&4194048)===X?yg-cl():0;if(Za=_3(mn,Za),Za!==null){rd=X,g.cancelPendingCommit=Za(Zh.bind(null,g,v,X,C,D,k,fe,Xe,Rt,Pn,mn,null,Yn,ji)),Hh(g,X,fe,!an);return}}Zh(g,v,X,C,D,k,fe,Xe,Rt)}function d3(g){for(var v=g;;){var C=v.tag;if((C===0||C===11||C===15)&&v.flags&16384&&(C=v.updateQueue,C!==null&&(C=C.stores,C!==null)))for(var D=0;D<C.length;D++){var k=C[D],X=k.getSnapshot;k=k.value;try{if(!Ha(X(),k))return!1}catch{return!1}}if(C=v.child,v.subtreeFlags&16384&&C!==null)C.return=v,v=C;else{if(v===g)break;for(;v.sibling===null;){if(v.return===null||v.return===g)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function Hh(g,v,C,D){v&=~ry,v&=~Ip,g.suspendedLanes|=v,g.pingedLanes&=~v,D&&(g.warmLanes|=v),D=g.expirationTimes;for(var k=v;0<k;){var X=31-au(k),fe=1<<X;D[X]=-1,k&=~fe}C!==0&&I(g,C,v)}function Kb(){return(gr&6)===0?(rn(0),!1):!0}function $b(){if(yr!==null){if(ys===0)var g=yr.return;else g=yr,rh=Is=null,Oi(g),Pp=null,dg=0,g=yr;for(;g!==null;)u3(g.alternate,g),g=g.return;yr=null}}function Ea(g,v){var C=g.timeoutHandle;C!==su&&(g.timeoutHandle=su,b3(C)),C=g.cancelPendingCommit,C!==null&&(g.cancelPendingCommit=null,C()),rd=0,$b(),ar=g,yr=C=Du(g.current,null),Tr=v,ys=0,so=null,ah=!1,Fp=M(g,v),Lp=!1,sy=Ul=ry=Ip=xf=ga=0,cu=I1=null,P_=!1,(v&8)!==0&&(v|=v&32);var D=g.entangledLanes;if(D!==0)for(g=g.entanglements,D&=v;0<D;){var k=31-au(D),X=1<<k;v|=g[k],D&=~X}return id=v,yi(),C}function Ls(g,v){$i=null,bi.H=Lu,v===_o||v===Ec?(v=ae(),ys=3):v===E_?(v=ae(),ys=4):ys=v===Ol?8:v!==null&&typeof v=="object"&&typeof v.then=="function"?6:1,so=v,yr===null&&(ga=1,nf(g,_e(v,g.current)))}function Rr(){var g=lu.current;return g===null?!0:(Tr&4194048)===Tr?uu===null:(Tr&62914560)===Tr||(Tr&536870912)!==0?g===uu:!1}function lf(){var g=bi.H;return bi.H=Lu,g===null?Lu:g}function Pu(){var g=bi.A;return bi.A=ty,g}function z0(){ga=4,ah||(Tr&4194048)!==Tr&&lu.current!==null||(Fp=!0),(xf&134217727)===0&&(Ip&134217727)===0||ar===null||Hh(ar,Tr,Ul,!1)}function Xh(g,v,C){var D=gr;gr|=2;var k=lf(),X=Pu();(ar!==g||Tr!==v)&&(O1=null,Ea(g,v)),v=!1;var fe=ga;e:do try{if(ys!==0&&yr!==null){var Xe=yr,Rt=so;switch(ys){case 8:$b(),fe=6;break e;case 3:case 2:case 9:case 6:lu.current===null&&(v=!0);var an=ys;if(ys=0,so=null,Wh(g,Xe,Rt,an),C&&Fp){fe=0;break e}break;default:an=ys,ys=0,so=null,Wh(g,Xe,Rt,an)}}f3(),fe=ga;break}catch(Pn){Ls(g,Pn)}while(!0);return v&&g.shellSuspendCounter++,rh=Is=null,gr=D,bi.H=k,bi.A=X,yr===null&&(ar=null,Tr=0,yi()),fe}function f3(){for(;yr!==null;)xp(yr)}function p3(g,v){var C=gr;gr|=2;var D=lf(),k=Pu();ar!==g||Tr!==v?(O1=null,Gp=cl()+500,Ea(g,v)):Fp=M(g,v);e:do try{if(ys!==0&&yr!==null){v=yr;var X=so;t:switch(ys){case 1:ys=0,so=null,Wh(g,v,X,1);break;case 2:case 9:if(z(X)){ys=0,so=null,Jb(v);break}v=function(){ys!==2&&ys!==9||ar!==g||(ys=7),jt(g)},X.then(v,v);break e;case 3:ys=7;break e;case 4:ys=5;break e;case 7:z(X)?(ys=0,so=null,Jb(v)):(ys=0,so=null,Wh(g,v,X,7));break;case 5:var fe=null;switch(yr.tag){case 26:fe=yr.memoizedState;case 5:case 27:var Xe=yr,Rt=Xe.type,an=Xe.pendingProps;if(fe?bT(fe):fa(Xe.stateNode,Rt,an)){ys=0,so=null;var Pn=Xe.sibling;if(Pn!==null)yr=Pn;else{var mn=Xe.return;mn!==null?(yr=mn,H0(mn)):yr=null}break t}}ys=0,so=null,Wh(g,v,X,5);break;case 6:ys=0,so=null,Wh(g,v,X,6);break;case 8:$b(),ga=6;break e;default:throw Error(r(462))}}V0();break}catch(Yn){Ls(g,Yn)}while(!0);return rh=Is=null,bi.H=D,bi.A=k,gr=C,yr!==null?0:(ar=null,Tr=0,yi(),ga)}function V0(){for(;yr!==null&&!iP();)xp(yr)}function xp(g){var v=xe(g.alternate,g,id);g.memoizedProps=g.pendingProps,v===null?H0(g):yr=v}function Jb(g){var v=g,C=v.alternate;switch(v.tag){case 15:case 0:v=Cn(C,v,v.pendingProps,v.type,void 0,Tr);break;case 11:v=Cn(C,v,v.pendingProps,v.type.render,v.ref,Tr);break;case 5:Oi(v);default:u3(C,v),v=yr=e_(v,id),v=xe(C,v,id)}g.memoizedProps=g.pendingProps,v===null?H0(g):yr=v}function Wh(g,v,C,D){rh=Is=null,Oi(v),Pp=null,dg=0;var k=v.return;try{if(u1(g,k,v,C,Tr)){ga=1,nf(g,_e(C,g.current)),yr=null;return}}catch(X){if(k!==null)throw yr=k,X;ga=1,nf(g,_e(C,g.current)),yr=null;return}v.flags&32768?(Ar||D===1?g=!0:Fp||(Tr&536870912)!==0?g=!1:(ah=g=!0,(D===2||D===9||D===3||D===6)&&(D=lu.current,D!==null&&D.tag===13&&(D.flags|=16384))),bp(v,g)):H0(v)}function H0(g){var v=g;do{if((v.flags&32768)!==0){bp(v,ah);return}g=v.return;var C=l3(v.alternate,v,id);if(C!==null){yr=C;return}if(v=v.sibling,v!==null){yr=v;return}yr=v=g}while(v!==null);ga===0&&(ga=5)}function bp(g,v){do{var C=BA(g.alternate,g);if(C!==null){C.flags&=32767,yr=C;return}if(C=g.return,C!==null&&(C.flags|=32768,C.subtreeFlags=0,C.deletions=null),!v&&(g=g.sibling,g!==null)){yr=g;return}yr=g=C}while(g!==null);ga=6,yr=null}function Zh(g,v,C,D,k,X,fe,Xe,Rt){g.cancelPendingCommit=null;do Yh();while(ao!==0);if((gr&6)!==0)throw Error(r(327));if(v!==null){if(v===g.current)throw Error(r(177));if(X=v.lanes|v.childLanes,X|=fg,P(g,C,X,fe,Xe,Rt),g===ar&&(yr=ar=null,Tr=0),vg=v,_f=g,rd=C,ay=X,D_=k,RT=D,(v.subtreeFlags&10256)!==0||(v.flags&10256)!==0?(g.callbackNode=null,g.callbackPriority=0,io(R1,function(){return y1(),null})):(g.callbackNode=null,g.callbackPriority=0),D=(v.flags&13878)!==0,(v.subtreeFlags&13878)!==0||D){D=bi.T,bi.T=null,k=_c(),Mr(2),fe=gr,gr|=4;try{hI(g,v,C)}finally{gr=fe,Mr(k),bi.T=D}}ao=1,uf(),jh(),qb()}}function uf(){if(ao===1){ao=0;var g=_f,v=vg,C=(v.flags&13878)!==0;if((v.subtreeFlags&13878)!==0||C){C=bi.T,bi.T=null;var D=_c();Mr(2);var k=gr;gr|=4;try{m1(v,g),x3(g.containerInfo)}finally{gr=k,Mr(D),bi.T=C}}g.current=v,ao=2}}function jh(){if(ao===2){ao=0;var g=_f,v=vg,C=(v.flags&8772)!==0;if((v.subtreeFlags&8772)!==0||C){C=bi.T,bi.T=null;var D=_c();Mr(2);var k=gr;gr|=4;try{h3(g,v.alternate,v)}finally{gr=k,Mr(D),bi.T=C}}ao=3}}function qb(){if(ao===4||ao===3){ao=0,ST();var g=_f,v=vg,C=rd,D=RT;(v.subtreeFlags&10256)!==0||(v.flags&10256)!==0?ao=5:(ao=0,vg=_f=null,Qb(g,g.pendingLanes));var k=g.pendingLanes;if(k===0&&(bf=null),V(C),v=v.stateNode,ou&&typeof ou.onCommitFiberRoot=="function")try{ou.onCommitFiberRoot(hg,v,void 0,(v.current.flags&128)===128)}catch{}if(D!==null){v=bi.T,k=_c(),Mr(2),bi.T=null;try{for(var X=g.onRecoverableError,fe=0;fe<D.length;fe++){var Xe=D[fe];X(Xe.value,{componentStack:Xe.stack})}}finally{bi.T=v,Mr(k)}}(rd&3)!==0&&Yh(),jt(g),k=g.pendingLanes,(C&261930)!==0&&(k&42)!==0?g===U1?Kr++:(Kr=0,U1=g):Kr=0,ta&&C1(),rn(0)}}function Qb(g,v){(g.pooledCacheLanes&=v)===0&&(v=g.pooledCache,v!=null&&(g.pooledCache=null,et(v)))}function Yh(){return uf(),jh(),qb(),y1()}function y1(){if(ao!==5)return!1;var g=_f,v=ay;ay=0;var C=V(rd),D=32>C?32:C;C=bi.T;var k=_c();try{Mr(D),bi.T=null,D=D_,D_=null;var X=_f,fe=rd;if(ao=0,vg=_f=null,rd=0,(gr&6)!==0)throw Error(r(331));var Xe=gr;if(gr|=4,Yb(X.current),Zb(X,X.current,fe,D),gr=Xe,rn(0,!1),ou&&typeof ou.onPostCommitFiberRoot=="function")try{ou.onPostCommitFiberRoot(hg,X)}catch{}return!0}finally{Mr(k),bi.T=C,Qb(g,v)}}function _p(g,v,C){v=_e(C,v),v=Oh(g.stateNode,v,2),g=dt(g,v,2),g!==null&&(R(g,2),jt(g))}function Fi(g,v,C){if(g.tag===3)_p(g,g,C);else for(;v!==null;){if(v.tag===3){_p(v,g,C);break}else if(v.tag===1){var D=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(bf===null||!bf.has(D))){g=_e(C,g),C=Ym(2),D=dt(v,C,2),D!==null&&(Km(C,D,v,g),R(D,2),jt(D));break}}v=v.return}}function X0(g,v,C){var D=g.pingCache;if(D===null){D=g.pingCache=new Gu;var k=new Set;D.set(v,k)}else k=D.get(v),k===void 0&&(k=new Set,D.set(v,k));k.has(C)||(Lp=!0,k.add(C),g=m3.bind(null,g,v,C),v.then(g,g))}function m3(g,v,C){var D=g.pingCache;D!==null&&D.delete(v),g.pingedLanes|=g.suspendedLanes&C,g.warmLanes&=~C,ar===g&&(Tr&C)===C&&(ga===4||ga===3&&(Tr&62914560)===Tr&&300>cl()-G1?(gr&2)===0&&Ea(g,0):ry|=C,sy===Tr&&(sy=0)),jt(g)}function g3(g,v){v===0&&(v=T()),g=Zn(g,v),g!==null&&(R(g,v),jt(g))}function dI(g){var v=g.memoizedState,C=0;v!==null&&(C=v.retryLane),g3(g,C)}function fI(g,v){var C=0;switch(g.tag){case 31:case 13:var D=g.stateNode,k=g.memoizedState;k!==null&&(C=k.retryLane);break;case 19:D=g.stateNode;break;case 22:D=g.stateNode._retryCache;break;default:throw Error(r(314))}D!==null&&D.delete(v),g3(g,C)}function io(g,v){return E1(g,v)}function OA(g,v,C,D){this.tag=g,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qm(g){return g=g.prototype,!(!g||!g.isReactComponent)}function Du(g,v){var C=g.alternate;return C===null?(C=t(g.tag,v,g.key,g.mode),C.elementType=g.elementType,C.type=g.type,C.stateNode=g.stateNode,C.alternate=g,g.alternate=C):(C.pendingProps=v,C.type=g.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=g.flags&65011712,C.childLanes=g.childLanes,C.lanes=g.lanes,C.child=g.child,C.memoizedProps=g.memoizedProps,C.memoizedState=g.memoizedState,C.updateQueue=g.updateQueue,v=g.dependencies,C.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},C.sibling=g.sibling,C.index=g.index,C.ref=g.ref,C.refCleanup=g.refCleanup,C}function e_(g,v){g.flags&=65011714;var C=g.alternate;return C===null?(g.childLanes=0,g.lanes=v,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=C.childLanes,g.lanes=C.lanes,g.child=C.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=C.memoizedProps,g.memoizedState=C.memoizedState,g.updateQueue=C.updateQueue,g.type=C.type,v=C.dependencies,g.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext}),g}function cf(g,v,C,D,k,X){var fe=0;if(D=g,typeof g=="function")qm(g)&&(fe=1);else if(typeof g=="string")fe=Sc&&vo?m_(g,C,Lo.current)?26:_T(g)?27:5:Sc?m_(g,C,Lo.current)?26:5:vo&&_T(g)?27:5;else e:switch(g){case _1:return g=t(31,C,v,k),g.elementType=_1,g.lanes=X,g;case ng:return xc(C.children,k,X,v);case ig:fe=8,k|=24;break;case rg:return g=t(12,C,v,k|2),g.elementType=rg,g.lanes=X,g;case r_:return g=t(13,C,v,k),g.elementType=r_,g.lanes=X,g;case hf:return g=t(19,C,v,k),g.elementType=hf,g.lanes=X,g;default:if(typeof g=="object"&&g!==null)switch(g.$$typeof){case bc:fe=10;break e;case b1:fe=9;break e;case W0:fe=11;break e;case s_:fe=14;break e;case Fl:fe=16,D=null;break e}fe=29,C=Error(r(130,g===null?"null":typeof g,"")),D=null}return v=t(fe,C,v,k),v.elementType=g,v.type=D,v.lanes=X,v}function xc(g,v,C,D){return g=t(7,g,D,v),g.lanes=C,g}function UA(g,v,C){return g=t(6,g,null,v),g.lanes=C,g}function kA(g){var v=t(18,null,null,0);return v.stateNode=g,v}function zA(g,v,C){return v=t(4,g.children!==null?g.children:[],g.key,v),v.lanes=C,v.stateNode={containerInfo:g.containerInfo,pendingChildren:null,implementation:g.implementation},v}function y3(g,v,C,D,k,X,fe,Xe,Rt){this.tag=1,this.containerInfo=g,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=su,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=E(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=E(0),this.hiddenUpdates=E(null),this.identifierPrefix=D,this.onUncaughtError=k,this.onCaughtError=X,this.onRecoverableError=fe,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Rt,this.incompleteTransitions=new Map}function Sp(g,v,C,D,k,X,fe,Xe,Rt,an,Pn,mn){return g=new y3(g,v,C,fe,Rt,an,Pn,mn,Xe),v=1,X===!0&&(v|=24),X=t(3,null,null,v),g.current=X,X.stateNode=g,v=tt(),v.refCount++,g.pooledCache=v,v.refCount++,X.memoizedState={element:D,isDehydrated:C,cache:v},ie(X),g}function t_(g){return g?(g=$h,g):$h}function v1(g){var v=g._reactInternals;if(v===void 0)throw typeof g.render=="function"?Error(r(188)):(g=Object.keys(g).join(","),Error(r(268,g)));return g=o(v),g=g!==null?l(g):null,g===null?null:j0(g.stateNode)}function VA(g,v,C,D,k,X){k=t_(k),D.context===null?D.context=k:D.pendingContext=k,D=Ue(v),D.payload={element:C},X=X===void 0?null:X,X!==null&&(D.callback=X),C=dt(g,D,v),C!==null&&(da(C,g,v),Ct(C,g,v))}function Qm(g,v){if(g=g.memoizedState,g!==null&&g.dehydrated!==null){var C=g.retryLane;g.retryLane=C!==0&&C<v?C:v}}function x1(g,v){Qm(g,v),(g=g.alternate)&&Qm(g,v)}var rr={},n_=Ie,iu=cOe,i_=Object.assign,eg=Symbol.for("react.element"),Kh=Symbol.for("react.transitional.element"),tg=Symbol.for("react.portal"),ng=Symbol.for("react.fragment"),ig=Symbol.for("react.strict_mode"),rg=Symbol.for("react.profiler"),b1=Symbol.for("react.consumer"),bc=Symbol.for("react.context"),W0=Symbol.for("react.forward_ref"),r_=Symbol.for("react.suspense"),hf=Symbol.for("react.suspense_list"),s_=Symbol.for("react.memo"),Fl=Symbol.for("react.lazy"),_1=Symbol.for("react.activity"),HA=Symbol.for("react.memo_cache_sentinel"),df=Symbol.iterator,Mp=Symbol.for("react.client.reference"),Ap=Array.isArray,bi=n_.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,XA=e.rendererVersion,S1=e.rendererPackageName,Z0=e.extraDevToolsConfig,j0=e.getPublicInstance,v3=e.getRootHostContext,Y0=e.getChildHostContext,a_=e.prepareForCommit,x3=e.resetAfterCommit,WA=e.createInstance;e.cloneMutableInstance;var M1=e.appendInitialChild,ru=e.finalizeInitialChildren,Ll=e.shouldSetTextContent,ff=e.createTextInstance;e.cloneMutableTextInstance;var ZA=e.scheduleTimeout,b3=e.cancelTimeout,su=e.noTimeout,za=e.isPrimaryRenderer;e.warnsIfNotActing;var Pr=e.supportsMutation,Nu=e.supportsPersistence,ta=e.supportsHydration,Ki=e.getInstanceFromNode;e.beforeActiveInstanceBlur;var Ms=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var Mr=e.setCurrentUpdatePriority,_c=e.getCurrentUpdatePriority,K0=e.resolveUpdatePriority;e.trackSchedulerEvent,e.resolveEventType,e.resolveEventTimeStamp;var sg=e.shouldAttemptEagerTransition,o_=e.detachDeletedInstance;e.requestPostPaintCallback;var A1=e.maySuspendCommit,$0=e.maySuspendCommitOnUpdate,jA=e.maySuspendCommitInSyncRender,fa=e.preloadInstance,YA=e.startSuspendingCommit,l_=e.suspendInstance;e.suspendOnActiveViewTransition;var _3=e.waitForCommitToBeReady;e.getSuspendedCommitReason;var ag=e.NotPendingTransition,og=e.HostTransitionContext,KA=e.resetFormInstance;e.bindToConsole;var $A=e.supportsMicrotasks,JA=e.scheduleMicrotask,yo=e.supportsTestSelectors,Va=e.findFiberRoot,u_=e.getBoundingRect,T1=e.getTextContent,Tp=e.isHiddenSubtree,qA=e.matchAccessibilityRole,pf=e.setFocusIfFocusable,c_=e.setupIntersectionObserver,QA=e.appendChild,eT=e.appendChildToContainer,S3=e.commitTextUpdate,M3=e.commitMount,A3=e.commitUpdate,T3=e.insertBefore,C3=e.insertInContainerBefore,w3=e.removeChild,tT=e.removeChildFromContainer,nT=e.resetTextContent,pI=e.hideInstance,E3=e.hideTextInstance,R3=e.unhideInstance,P3=e.unhideTextInstance;e.cancelViewTransitionName,e.cancelRootViewTransitionName,e.restoreRootViewTransitionName,e.cloneRootViewTransitionContainer,e.removeRootViewTransitionClone,e.measureClonedInstance,e.hasInstanceChanged,e.hasInstanceAffectedParent,e.startViewTransition,e.startGestureTransition,e.stopViewTransition,e.getCurrentGestureOffset,e.createViewTransitionInstance;var iT=e.clearContainer;e.createFragmentInstance,e.updateFragmentInstanceFiber,e.commitNewChildToFragmentInstance,e.deleteChildFromFragmentInstance;var D3=e.cloneInstance,rT=e.createContainerChildSet,sT=e.appendChildToContainerChildSet,N3=e.finalizeContainerChildren,aT=e.replaceContainerChildren,B3=e.cloneHiddenInstance,oT=e.cloneHiddenTextInstance,Cp=e.isSuspenseInstancePending,h_=e.isSuspenseInstanceFallback,d_=e.getSuspenseInstanceFallbackErrorDetails,f_=e.registerSuspenseInstanceRetry,F3=e.canHydrateFormStateMarker,lT=e.isFormStateMarkerMatching,L3=e.getNextHydratableSibling,I3=e.getNextHydratableSiblingAfterSingleton,G3=e.getFirstHydratableChild,O3=e.getFirstHydratableChildWithinContainer,U3=e.getFirstHydratableChildWithinActivityInstance,k3=e.getFirstHydratableChildWithinSuspenseInstance,uT=e.getFirstHydratableChildWithinSingleton,z3=e.canHydrateInstance,V3=e.canHydrateTextInstance,cT=e.canHydrateActivityInstance,H3=e.canHydrateSuspenseInstance,X3=e.hydrateInstance,mI=e.hydrateTextInstance,hT=e.hydrateActivityInstance,W3=e.hydrateSuspenseInstance,Z3=e.getNextHydratableInstanceAfterActivityInstance,dT=e.getNextHydratableInstanceAfterSuspenseInstance,j3=e.commitHydratedInstance,Y3=e.commitHydratedContainer,gI=e.commitHydratedActivityInstance,yI=e.commitHydratedSuspenseInstance,K3=e.finalizeHydratedChildren,C1=e.flushHydrationEvents;e.clearActivityBoundary;var fT=e.clearSuspenseBoundary;e.clearActivityBoundaryFromContainer;var p_=e.clearSuspenseBoundaryFromContainer,$3=e.hideDehydratedBoundary,J3=e.unhideDehydratedBoundary,J0=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var q3=e.validateHydratableInstance,pT=e.validateHydratableTextInstance,Sc=e.supportsResources,m_=e.isHostHoistableType,w1=e.getHoistableRoot,mT=e.getResource,gT=e.acquireResource,wp=e.releaseResource,Q3=e.hydrateHoistable,yT=e.mountHoistable,vT=e.unmountHoistable,g_=e.createHoistableInstance,eP=e.prepareToCommitHoistables,xT=e.mayResourceSuspendCommit,bT=e.preloadResource,tP=e.suspendResource,vo=e.supportsSingletons,y_=e.resolveSingletonInstance,ro=e.acquireSingletonInstance,Fo=e.releaseSingletonInstance,_T=e.isHostSingletonType,lg=e.isSingletonScope,v_=[],ug=-1,$h={},au=Math.clz32?Math.clz32:_,x_=Math.log,nP=Math.LN2,b_=256,cg=262144,q0=4194304,E1=iu.unstable_scheduleCallback,__=iu.unstable_cancelCallback,iP=iu.unstable_shouldYield,ST=iu.unstable_requestPaint,cl=iu.unstable_now,S_=iu.unstable_ImmediatePriority,rP=iu.unstable_UserBlockingPriority,R1=iu.unstable_NormalPriority,M_=iu.unstable_IdlePriority,MT=iu.log,sP=iu.unstable_setDisableYieldValue,hg=null,ou=null,Ha=typeof Object.is=="function"?Object.is:K,A_=typeof reportError=="function"?reportError:function(g){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var v=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof g=="object"&&g!==null&&typeof g.message=="string"?String(g.message):String(g),error:g});if(!window.dispatchEvent(v))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",g);return}console.error(g)},vI=Object.prototype.hasOwnProperty,T_,Jh,P1=!1,AT=new WeakMap,mf=[],qh=0,As=null,D1=0,Mc=[],Bu=0,Ac=null,Ko=1,ih="",Lo=f(null),gf=f(null),$o=f(null),N1=f(null),xo=null,na=null,Ar=!1,Qh=null,Il=!1,C_=Error(r(519)),Tc=f(null),Is=null,rh=null,aP=typeof AbortController<"u"?AbortController:function(){var g=[],v=this.signal={aborted:!1,addEventListener:function(C,D){g.push(D)}};this.abort=function(){v.aborted=!0,g.forEach(function(C){return C()})}},Io=iu.unstable_scheduleCallback,xI=iu.unstable_NormalPriority,ia={$$typeof:bc,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},B1=null,ms=null,hl=!1,Cc=!1,w_=!1,Ep=0,Q0=null,TT=0,yf=0,bo=null,wc=bi.S;bi.S=function(g,v){yg=cl(),typeof v=="object"&&v!==null&&typeof v.then=="function"&&St(g,v),wc!==null&&wc(g,v)};var Rp=f(null),_o=Error(r(460)),E_=Error(r(474)),Ec=Error(r(542)),ed={then:function(){}},Gl=null,Pp=null,dg=0,Jo=Tn(!0),CT=Tn(!1),qo=[],td=0,fg=0,Fu=!1,R_=!1,pg=f(null),Dp=f(0),lu=f(null),uu=null,Ra=f(0),vf=0,$i=null,pi=null,ki=null,sr=!1,nr=!1,Ir=!1,dl=0,Rc=0,sh=null,wT=0,Lu={readContext:le,use:tr,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useLayoutEffect:Vt,useInsertionEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useSyncExternalStore:Vt,useId:Vt,useHostTransitionStatus:Vt,useFormState:Vt,useActionState:Vt,useOptimistic:Vt,useMemoCache:Vt,useCacheRefresh:Vt};Lu.useEffectEvent=Vt;var pa={readContext:le,use:tr,useCallback:function(g,v){return On().memoizedState=[g,v===void 0?null:v],g},useContext:le,useEffect:qc,useImperativeHandle:function(g,v,C){C=C!=null?C.concat([g]):null,dc(4194308,4,ol.bind(null,v,g),C)},useLayoutEffect:function(g,v){return dc(4194308,4,g,v)},useInsertionEffect:function(g,v){dc(4,2,g,v)},useMemo:function(g,v){var C=On();v=v===void 0?null:v;var D=g();if(Ir){W(!0);try{g()}finally{W(!1)}}return C.memoizedState=[D,v],D},useReducer:function(g,v,C){var D=On();if(C!==void 0){var k=C(v);if(Ir){W(!0);try{C(v)}finally{W(!1)}}}else k=v;return D.memoizedState=D.baseState=k,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:k},D.queue=g,g=g.dispatch=cp.bind(null,$i,g),[D.memoizedState,g]},useRef:function(g){var v=On();return g={current:g},v.memoizedState=g},useState:function(g){g=jo(g);var v=g.queue,C=Xm.bind(null,$i,v);return v.dispatch=C,[g.memoizedState,C]},useDebugValue:Dl,useDeferredValue:function(g,v){var C=On();return ll(C,g,v)},useTransition:function(){var g=jo(!1);return g=lp.bind(null,$i,g.queue,!0,!1),On().memoizedState=g,[!1,g]},useSyncExternalStore:function(g,v,C){var D=$i,k=On();if(Ar){if(C===void 0)throw Error(r(407));C=C()}else{if(C=v(),ar===null)throw Error(r(349));(Tr&127)!==0||Zs(D,v,C)}k.memoizedState=C;var X={value:C,getSnapshot:v};return k.queue=X,qc(Te.bind(null,D,X,g),[g]),D.flags|=2048,Ro(9,{destroy:void 0},la.bind(null,D,X,C,v),null),C},useId:function(){var g=On(),v=ar.identifierPrefix;if(Ar){var C=ih,D=Ko;C=(D&~(1<<32-au(D)-1)).toString(32)+C,v="_"+v+"R_"+C,C=dl++,0<C&&(v+="H"+C.toString(32)),v+="_"}else C=wT++,v="_"+v+"r_"+C.toString(32)+"_";return g.memoizedState=v},useHostTransitionStatus:up,useFormState:Jc,useActionState:Jc,useOptimistic:function(g){var v=On();v.memoizedState=v.baseState=g;var C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return v.queue=C,v=hp.bind(null,$i,!0,C),C.dispatch=v,[g,v]},useMemoCache:qs,useCacheRefresh:function(){return On().memoizedState=th.bind(null,$i)},useEffectEvent:function(g){var v=On(),C={impl:g};return v.memoizedState=C,function(){if((gr&2)!==0)throw Error(r(440));return C.impl.apply(void 0,arguments)}}},nd={readContext:le,use:tr,useCallback:Gh,useContext:le,useEffect:fc,useImperativeHandle:ci,useInsertionEffect:Ql,useLayoutEffect:Qd,useMemo:eh,useReducer:Ss,useRef:al,useState:function(){return Ss(Wi)},useDebugValue:Dl,useDeferredValue:function(g,v){var C=qt();return Eu(C,pi.memoizedState,g,v)},useTransition:function(){var g=Ss(Wi)[0],v=qt().memoizedState;return[typeof g=="boolean"?g:Bn(g),v]},useSyncExternalStore:Ws,useId:ef,useHostTransitionStatus:up,useFormState:hc,useActionState:hc,useOptimistic:function(g,v){var C=qt();return lc(C,pi,g,v)},useMemoCache:qs,useCacheRefresh:Hm};nd.useEffectEvent=ua;var Np={readContext:le,use:tr,useCallback:Gh,useContext:le,useEffect:fc,useImperativeHandle:ci,useInsertionEffect:Ql,useLayoutEffect:Qd,useMemo:eh,useReducer:Qs,useRef:al,useState:function(){return Qs(Wi)},useDebugValue:Dl,useDeferredValue:function(g,v){var C=qt();return pi===null?ll(C,g,v):Eu(C,pi.memoizedState,g,v)},useTransition:function(){var g=Qs(Wi)[0],v=qt().memoizedState;return[typeof g=="boolean"?g:Bn(g),v]},useSyncExternalStore:Ws,useId:ef,useHostTransitionStatus:up,useFormState:to,useActionState:to,useOptimistic:function(g,v){var C=qt();return pi!==null?lc(C,pi,g,v):(C.baseState=g,[g,C.queue.dispatch])},useMemoCache:qs,useCacheRefresh:Hm};Np.useEffectEvent=ua;var F1={enqueueSetState:function(g,v,C){g=g._reactInternals;var D=ea(),k=Ue(D);k.payload=v,C!=null&&(k.callback=C),v=dt(g,k,D),v!==null&&(da(v,g,D),Ct(v,g,D))},enqueueReplaceState:function(g,v,C){g=g._reactInternals;var D=ea(),k=Ue(D);k.tag=1,k.payload=v,C!=null&&(k.callback=C),v=dt(g,k,D),v!==null&&(da(v,g,D),Ct(v,g,D))},enqueueForceUpdate:function(g,v){g=g._reactInternals;var C=ea(),D=Ue(C);D.tag=2,v!=null&&(D.callback=v),v=dt(g,D,C),v!==null&&(da(v,g,C),Ct(v,g,C))}},Ol=Error(r(461)),js=!1,mg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null},Pa=!1,Da=!1,ey=!1,ET=typeof WeakSet=="function"?WeakSet:Set,Xa=null,ma=null,Wa=!1,gs=null,Iu=8192,ty={getCacheForType:function(g){var v=le(ia),C=v.data.get(g);return C===void 0&&(C=g(),v.data.set(g,C)),C},cacheSignal:function(){return le(ia).controller.signal}},Pc=0,ny=1,iy=2,L1=3,Bp=4;if(typeof Symbol=="function"&&Symbol.for){var gg=Symbol.for;Pc=gg("selector.component"),ny=gg("selector.has_pseudo_class"),iy=gg("selector.role"),L1=gg("selector.test_id"),Bp=gg("selector.text")}var Gu=typeof WeakMap=="function"?WeakMap:Map,gr=0,ar=null,yr=null,Tr=0,ys=0,so=null,ah=!1,Fp=!1,Lp=!1,id=0,ga=0,xf=0,Ip=0,ry=0,Ul=0,sy=0,I1=null,cu=null,P_=!1,G1=0,yg=0,Gp=1/0,O1=null,bf=null,ao=0,_f=null,vg=null,rd=0,ay=0,D_=null,RT=null,Kr=0,U1=null;return rr.attemptContinuousHydration=function(g){if(g.tag===13||g.tag===31){var v=Zn(g,67108864);v!==null&&da(v,g,67108864),x1(g,67108864)}},rr.attemptHydrationAtCurrentPriority=function(g){if(g.tag===13||g.tag===31){var v=ea();v=U(v);var C=Zn(g,v);C!==null&&da(C,g,v),x1(g,v)}},rr.attemptSynchronousHydration=function(g){switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var v=S(g.pendingLanes);if(v!==0){for(g.pendingLanes|=2,g.entangledLanes|=2;v;){var C=1<<31-au(v);g.entanglements[1]|=C,v&=~C}jt(g),(gr&6)===0&&(Gp=cl()+500,rn(0))}}break;case 31:case 13:v=Zn(g,2),v!==null&&da(v,g,2),Kb(),x1(g,2)}},rr.batchedUpdates=function(g,v){return g(v)},rr.createComponentSelector=function(g){return{$$typeof:Pc,value:g}},rr.createContainer=function(g,v,C,D,k,X,fe,Xe,Rt,an){return Sp(g,v,!1,null,C,D,X,null,fe,Xe,Rt,an)},rr.createHasPseudoClassSelector=function(g){return{$$typeof:ny,value:g}},rr.createHydrationContainer=function(g,v,C,D,k,X,fe,Xe,Rt,an,Pn,mn,Yn,ji){var Za;return g=Sp(C,D,!0,g,k,X,Xe,ji,Rt,an,Pn,mn),g.context=t_(null),C=g.current,D=ea(),D=U(D),k=Ue(D),k.callback=(Za=v)!=null?Za:null,dt(C,k,D),v=D,g.current.lanes=v,R(g,v),jt(g),g},rr.createPortal=function(g,v,C){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:tg,key:D==null?null:""+D,children:g,containerInfo:v,implementation:C}},rr.createRoleSelector=function(g){return{$$typeof:iy,value:g}},rr.createTestNameSelector=function(g){return{$$typeof:L1,value:g}},rr.createTextSelector=function(g){return{$$typeof:Bp,value:g}},rr.defaultOnCaughtError=function(g){console.error(g)},rr.defaultOnRecoverableError=function(g){A_(g)},rr.defaultOnUncaughtError=function(g){A_(g)},rr.deferredUpdates=function(g){var v=bi.T,C=_c();try{return Mr(32),bi.T=null,g()}finally{Mr(C),bi.T=v}},rr.discreteUpdates=function(g,v,C,D,k){var X=bi.T,fe=_c();try{return Mr(2),bi.T=null,g(v,C,D,k)}finally{Mr(fe),bi.T=X,gr===0&&(Gp=cl()+500)}},rr.findAllNodes=nu,rr.findBoundingRects=function(g,v){if(!yo)throw Error(r(363));v=nu(g,v),g=[];for(var C=0;C<v.length;C++)g.push(u_(v[C]));for(v=g.length-1;0<v;v--){C=g[v];for(var D=C.x,k=D+C.width,X=C.y,fe=X+C.height,Xe=v-1;0<=Xe;Xe--)if(v!==Xe){var Rt=g[Xe],an=Rt.x,Pn=an+Rt.width,mn=Rt.y,Yn=mn+Rt.height;if(D>=an&&X>=mn&&k<=Pn&&fe<=Yn){g.splice(v,1);break}else if(D!==an||C.width!==Rt.width||Yn<X||mn>fe){if(!(X!==mn||C.height!==Rt.height||Pn<D||an>k)){an>D&&(Rt.width+=an-D,Rt.x=D),Pn<k&&(Rt.width=k-an),g.splice(v,1);break}}else{mn>X&&(Rt.height+=mn-X,Rt.y=X),Yn<fe&&(Rt.height=fe-mn),g.splice(v,1);break}}}return g},rr.findHostInstance=v1,rr.findHostInstanceWithNoPortals=function(g){return g=o(g),g=g!==null?u(g):null,g===null?null:j0(g.stateNode)},rr.findHostInstanceWithWarning=function(g){return v1(g)},rr.flushPassiveEffects=Yh,rr.flushSyncFromReconciler=function(g){var v=gr;gr|=1;var C=bi.T,D=_c();try{if(Mr(2),bi.T=null,g)return g()}finally{Mr(D),bi.T=C,gr=v,(gr&6)===0&&rn(0)}},rr.flushSyncWork=Kb,rr.focusWithin=function(g,v){if(!yo)throw Error(r(363));for(g=yp(g),v=k0(g,v),v=Array.from(v),g=0;g<v.length;){var C=v[g++],D=C.tag;if(!Tp(C)){if((D===5||D===26||D===27)&&pf(C.stateNode))return!0;for(C=C.child;C!==null;)v.push(C),C=C.sibling}}return!1},rr.getFindAllNodesFailureDescription=function(g,v){if(!yo)throw Error(r(363));var C=0,D=[];g=[yp(g),0];for(var k=0;k<g.length;){var X=g[k++],fe=X.tag,Xe=g[k++],Rt=v[Xe];if((fe!==5&&fe!==26&&fe!==27||!Tp(X))&&(vp(X,Rt)&&(D.push(U0(Rt)),Xe++,Xe>C&&(C=Xe)),Xe<v.length))for(X=X.child;X!==null;)g.push(X,Xe),X=X.sibling}if(C<v.length){for(g=[];C<v.length;C++)g.push(U0(v[C]));return`findAllNodes was able to match part of the selector:
  `+(D.join(" > ")+`

No matching component was found for:
  `)+g.join(" > ")}return null},rr.getPublicRootInstance=function(g){if(g=g.current,!g.child)return null;switch(g.child.tag){case 27:case 5:return j0(g.child.stateNode);default:return g.child.stateNode}},rr.injectIntoDevTools=function(){var g={bundleType:0,version:XA,rendererPackageName:S1,currentDispatcherRef:bi,reconcilerVersion:"19.2.0"};if(Z0!==null&&(g.rendererConfig=Z0),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")g=!1;else{var v=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(v.isDisabled||!v.supportsFiber)g=!0;else{try{hg=v.inject(g),ou=v}catch{}g=!!v.checkDCE}}return g},rr.isAlreadyRendering=function(){return(gr&6)!==0},rr.observeVisibleRects=function(g,v,C,D){if(!yo)throw Error(r(363));g=nu(g,v);var k=c_(g,C,D).disconnect;return{disconnect:function(){k()}}},rr.shouldError=function(){return null},rr.shouldSuspend=function(){return!1},rr.startHostTransition=function(g,v,C,D){if(g.tag!==5)throw Error(r(476));var k=D0(g).queue;lp(g,k,v,ag,C===null?i:function(){var X=D0(g);return X.next===null&&(X=g.alternate.memoizedState),tf(g,X.next.queue,{},ea()),C(D)})},rr.updateContainer=function(g,v,C,D){var k=v.current,X=ea();return VA(k,X,g,v,C,D),X},rr.updateContainerSync=function(g,v,C,D){return VA(v.current,2,g,v,C,D),2},rr},n.exports.default=n.exports,Object.defineProperty(n.exports,"__esModule",{value:!0})})(ej)),ej.exports}var nj;function OOe(){return nj||(nj=1,QZ.exports=GOe()),QZ.exports}var UOe=OOe();const kOe=IOe(UOe);function zOe(n){const e=kOe(n);return e.injectIntoDevTools(),e}const mne=0,_M={},VOe=/^three(?=[A-Z])/,RF=n=>`${n[0].toUpperCase()}${n.slice(1)}`;let HOe=0;const XOe=n=>typeof n=="function";function eo(n){if(XOe(n)){const e=`${HOe++}`;return _M[e]=n,e}else Object.assign(_M,n)}function gne(n,e){const t=RF(n),i=_M[t];if(n!=="primitive"&&!i)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(n==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function WOe(n,e,t){var i;return n=RF(n)in _M?n:n.replace(VOe,""),gne(n,e),n==="primitive"&&(i=e.object)!=null&&i.__r3f&&delete e.object.__r3f,DB(e.object,t,n,e)}function ZOe(n){if(!n.isHidden){var e;n.props.attach&&(e=n.parent)!=null&&e.object?BB(n.parent,n):Xu(n.object)&&(n.object.visible=!1),n.isHidden=!0,aA(n)}}function yne(n){if(n.isHidden){var e;n.props.attach&&(e=n.parent)!=null&&e.object?NB(n.parent,n):Xu(n.object)&&n.props.visible!==!1&&(n.object.visible=!0),n.isHidden=!1,aA(n)}}function _V(n,e,t){const i=e.root.getState();if(!(!n.parent&&n.object!==i.scene)){if(!e.object){var r,s;const a=_M[RF(e.type)];e.object=(r=e.props.object)!=null?r:new a(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(xd(e.object,e.props),e.props.attach)NB(n,e);else if(Xu(e.object)&&Xu(n.object)){const a=n.object.children.indexOf(t?.object);if(t&&a!==-1){const o=n.object.children.indexOf(e.object);if(o!==-1){n.object.children.splice(o,1);const l=o<a?a-1:a;n.object.children.splice(l,0,e.object)}else e.object.parent=n.object,n.object.children.splice(a,0,e.object),e.object.dispatchEvent({type:"added"}),n.object.dispatchEvent({type:"childadded",child:e.object})}else n.object.add(e.object)}for(const a of e.children)_V(e,a);aA(e)}}function mO(n,e){e&&(e.parent=n,n.children.push(e),_V(n,e))}function ij(n,e,t){if(!e||!t)return;e.parent=n;const i=n.children.indexOf(t);i!==-1?n.children.splice(i,0,e):n.children.push(e),_V(n,e,t)}function vne(n){if(typeof n.dispose=="function"){const e=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():J5.unstable_scheduleCallback(J5.unstable_IdlePriority,e)}}function Q5(n,e,t){if(!e)return;e.parent=null;const i=n.children.indexOf(e);i!==-1&&n.children.splice(i,1),e.props.attach?BB(n,e):Xu(e.object)&&Xu(n.object)&&(n.object.remove(e.object),wOe(lne(e),e.object));const r=e.props.dispose!==null&&t!==!1;for(let s=e.children.length-1;s>=0;s--){const a=e.children[s];Q5(e,a,r)}e.children.length=0,delete e.object.__r3f,r&&e.type!=="primitive"&&e.object.type!=="Scene"&&vne(e.object),t===void 0&&aA(e)}function jOe(n,e){for(const t of[n,n.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const i=t.ref(e);typeof i=="function"&&(t.refCleanup=i)}else t.ref&&(t.ref.current=e)}const HN=[];function YOe(){for(const[t]of HN){const i=t.parent;if(i){t.props.attach?BB(i,t):Xu(t.object)&&Xu(i.object)&&i.object.remove(t.object);for(const r of t.children)r.props.attach?BB(t,r):Xu(r.object)&&Xu(t.object)&&t.object.remove(r.object)}t.isHidden&&yne(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&vne(t.object)}for(const[t,i,r]of HN){t.props=i;const s=t.parent;if(s){var n,e;const a=_M[RF(t.type)];t.object=(n=t.props.object)!=null?n:new a(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,jOe(r,t.object),xd(t.object,t.props),t.props.attach?NB(s,t):Xu(t.object)&&Xu(s.object)&&s.object.add(t.object);for(const o of t.children)o.props.attach?NB(t,o):Xu(o.object)&&Xu(t.object)&&t.object.add(o.object);aA(t)}}HN.length=0}const gO=()=>{},rj={};let _D=mne;const KOe=0,$Oe=4,FB=zOe({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:WOe,removeChild:Q5,appendChild:mO,appendInitialChild:mO,insertBefore:ij,appendChildToContainer(n,e){const t=n.getState().scene.__r3f;!e||!t||mO(t,e)},removeChildFromContainer(n,e){const t=n.getState().scene.__r3f;!e||!t||Q5(t,e)},insertInContainerBefore(n,e,t){const i=n.getState().scene.__r3f;!e||!t||!i||ij(i,e,t)},getRootHostContext:()=>rj,getChildHostContext:()=>rj,commitUpdate(n,e,t,i,r){var s,a,o;gne(e,i);let l=!1;if((n.type==="primitive"&&t.object!==i.object||((s=i.args)==null?void 0:s.length)!==((a=t.args)==null?void 0:a.length)||(o=i.args)!=null&&o.some((c,d)=>{var f;return c!==((f=t.args)==null?void 0:f[d])}))&&(l=!0),l)HN.push([n,{...i},r]);else{const c=AOe(n,i);Object.keys(c).length&&(Object.assign(n.props,c),xd(n.object,c))}(r.sibling===null||(r.flags&$Oe)===KOe)&&YOe()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:n=>n?.object,prepareForCommit:()=>null,preparePortalMount:n=>DB(n.getState().scene,n,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:ZOe,unhideInstance:yne,createTextInstance:gO,hideTextInstance:gO,unhideTextInstance:gO,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:G.createContext(null),setCurrentUpdatePriority(n){_D=n},getCurrentUpdatePriority(){return _D},resolveUpdatePriority(){var n;if(_D!==mne)return _D;switch(typeof window<"u"&&((n=window.event)==null?void 0:n.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return FOe;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return NOe;default:return BOe}},resetFormInstance(){},rendererPackageName:"@react-three/fiber",rendererVersion:LOe.version,applyViewTransitionName(n,e,t){},restoreViewTransitionName(n,e){},cancelViewTransitionName(n,e,t){},cancelRootViewTransitionName(n){},restoreRootViewTransitionName(n){},InstanceMeasurement:null,measureInstance:n=>null,wasInstanceInViewport:n=>!0,hasInstanceChanged:(n,e)=>!1,hasInstanceAffectedParent:(n,e)=>!1,suspendOnActiveViewTransition(n,e){},startGestureTransition:()=>null,startViewTransition:()=>null,stopViewTransition(n){},createViewTransitionInstance:n=>null,getCurrentGestureOffset(n){throw new Error("startGestureTransition is not yet supported in react-three-fiber.")},cloneMutableInstance(n,e){return n},cloneMutableTextInstance(n){return n},cloneRootViewTransitionContainer(n){throw new Error("Not implemented.")},removeRootViewTransitionClone(n,e){throw new Error("Not implemented.")},createFragmentInstance:n=>null,updateFragmentInstanceFiber(n,e){},commitNewChildToFragmentInstance(n,e){},deleteChildFromFragmentInstance(n,e){},measureClonedInstance:n=>null,maySuspendCommitOnUpdate:(n,e,t)=>!1,maySuspendCommitInSyncRender:(n,e)=>!1,startSuspendingCommit:()=>null,getSuspendedCommitReason:(n,e)=>null}),fb=new Map,oS={objects:"shallow",strict:!1};function JOe(n,e){if(!e&&typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:t,height:i,top:r,left:s}=n.parentElement.getBoundingClientRect();return{width:t,height:i,top:r,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function qOe(n){const e=fb.get(n),t=e?.fiber,i=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,s=i||ROe(nk,aj),a=t||FB.createContainer(s,DOe,null,!1,null,"",r,r,r,null);e||fb.set(n,{fiber:a,store:s});let o,l,u=!1,c=null;return{async configure(d={}){let f;c=new Promise(ue=>f=ue);let{gl:m,size:y,scene:_,events:S,onCreated:b,shadows:M=!1,linear:w=!1,flat:T=!1,legacy:E=!1,orthographic:R=!1,frameloop:P="always",dpr:I=[1,2],performance:B,raycaster:N,camera:U,onPointerMissed:V}=d,W=s.getState(),K=W.gl;if(!W.gl){const ue={canvas:n,powerPreference:"high-performance",antialias:!0,alpha:!0},ce=typeof m=="function"?await m(ue):m;JZ(ce)?K=ce:K=new mV({...ue,...m}),W.set({gl:K})}let q=W.raycaster;q||W.set({raycaster:q=new FR});const{params:j,...te}=N||{};if(Fa.equ(te,q,oS)||xd(q,{...te}),Fa.equ(j,q.params,oS)||xd(q,{params:{...q.params,...j}}),!W.camera||W.camera===l&&!Fa.equ(l,U,oS)){l=U;const ue=U?.isCamera,ce=ue?U:R?new Tl(0,0,0,0,.1,1e3):new ds(75,0,.1,1e3);ue||(ce.position.z=5,U&&(xd(ce,U),ce.manual||("aspect"in U||"left"in U||"right"in U||"bottom"in U||"top"in U)&&(ce.manual=!0,ce.updateProjectionMatrix())),!W.camera&&!(U!=null&&U.rotation)&&ce.lookAt(0,0,0)),W.set({camera:ce}),q.camera=ce}if(!W.scene){let ue;_!=null&&_.isScene?(ue=_,DB(ue,s,"",{})):(ue=new Wc,DB(ue,s,"",{}),_&&xd(ue,_)),W.set({scene:ue})}S&&!W.events.handlers&&W.set({events:S(s)});const he=JOe(n,y);if(Fa.equ(he,W.size,oS)||W.setSize(he.width,he.height,he.top,he.left),I&&W.viewport.dpr!==cne(I)&&W.setDpr(I),W.frameloop!==P&&W.setFrameloop(P),W.onPointerMissed||W.set({onPointerMissed:V}),B&&!Fa.equ(B,W.performance,oS)&&W.set(ue=>({performance:{...ue.performance,...B}})),!W.xr){var _e;const ue=(Oe,nt)=>{const Ae=s.getState();Ae.frameloop!=="never"&&aj(Oe,!0,Ae,nt)},ce=()=>{const Oe=s.getState();Oe.gl.xr.enabled=Oe.gl.xr.isPresenting,Oe.gl.xr.setAnimationLoop(Oe.gl.xr.isPresenting?ue:null),Oe.gl.xr.isPresenting||nk(Oe)},Ce={connect(){const Oe=s.getState().gl;Oe.xr.addEventListener("sessionstart",ce),Oe.xr.addEventListener("sessionend",ce)},disconnect(){const Oe=s.getState().gl;Oe.xr.removeEventListener("sessionstart",ce),Oe.xr.removeEventListener("sessionend",ce)}};typeof((_e=K.xr)==null?void 0:_e.addEventListener)=="function"&&Ce.connect(),W.set({xr:Ce})}if(K.shadowMap){const ue=K.shadowMap.enabled,ce=K.shadowMap.type;if(K.shadowMap.enabled=!!M,Fa.boo(M))K.shadowMap.type=YS;else if(Fa.str(M)){var Be;const Ce={basic:UE,percentage:tv,soft:YS,variance:Ad};K.shadowMap.type=(Be=Ce[M])!=null?Be:YS}else Fa.obj(M)&&Object.assign(K.shadowMap,M);(ue!==K.shadowMap.enabled||ce!==K.shadowMap.type)&&(K.shadowMap.needsUpdate=!0)}return di.enabled=!E,u||(K.outputColorSpace=w?Su:Ps,K.toneMapping=T?ho:zM),W.legacy!==E&&W.set(()=>({legacy:E})),W.linear!==w&&W.set(()=>({linear:w})),W.flat!==T&&W.set(()=>({flat:T})),m&&!Fa.fun(m)&&!JZ(m)&&!Fa.equ(m,K,oS)&&xd(K,m),o=b,u=!0,f(),this},render(d){return!u&&!c&&this.configure(),c.then(()=>{FB.updateContainer($.jsx(QOe,{store:s,children:d,onCreated:o,rootElement:n}),a,null,()=>{})}),s},unmount(){xne(n)}}}function QOe({store:n,children:e,onCreated:t,rootElement:i}){return LR(()=>{const r=n.getState();r.set(s=>({internal:{...s.internal,active:!0}})),t&&t(r),n.getState().events.connected||r.events.connect==null||r.events.connect(i)},[]),$.jsx(xV.Provider,{value:n,children:e})}function xne(n,e){const t=fb.get(n),i=t?.fiber;if(i){const r=t?.store.getState();r&&(r.internal.active=!1),FB.updateContainer(null,i,null,()=>{r&&setTimeout(()=>{try{var s,a,o,l;r.events.disconnect==null||r.events.disconnect(),(s=r.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=r.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=r.gl)!=null&&l.xr&&r.xr.disconnect(),_Oe(r.scene),fb.delete(n)}catch{}},500)})}}function SV(n,e,t){return $.jsx(eUe,{children:n,container:e,state:t})}function eUe({state:n={},children:e,container:t}){const{events:i,size:r,...s}=n,a=bV(),[o]=G.useState(()=>new FR),[l]=G.useState(()=>new rt),u=vV((d,f)=>{let m;if(f.camera&&r){const y=f.camera;m=d.viewport.getCurrentViewport(y,new re,r),y!==d.camera&&dne(y,r)}return{...d,...f,scene:t,raycaster:o,pointer:l,mouse:l,previousRoot:a,events:{...d.events,...f.events,...i},size:{...d.size,...r},viewport:{...d.viewport,...m},setEvents:y=>f.set(_=>({..._,events:{..._.events,...y}}))}}),c=G.useMemo(()=>{const d=nne((m,y)=>({...s,set:m,get:y})),f=m=>d.setState(y=>u.current(m,y));return f(a.getState()),a.subscribe(f),d},[a,t]);return $.jsx($.Fragment,{children:FB.createPortal($.jsx(xV.Provider,{value:c,children:e}),c,null)})}function bne(n,e){const t={callback:n};return e.add(t),()=>{e.delete(t)}}const _ne=new Set,Sne=new Set,tUe=new Set,Mne=n=>bne(n,_ne),nUe=n=>bne(n,Sne);function yO(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function hw(n,e){switch(n){case"before":return yO(_ne,e);case"after":return yO(Sne,e);case"tail":return yO(tUe,e)}}let vO,xO;function ek(n,e,t){let i=e.clock.getDelta();e.frameloop==="never"&&typeof n=="number"&&(i=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),vO=e.internal.subscribers;for(let r=0;r<vO.length;r++)xO=vO[r],xO.ref.current(xO.store.getState(),i,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let LB=!1,tk=!1,bO,sj,lS;function Ane(n){sj=requestAnimationFrame(Ane),LB=!0,bO=0,hw("before",n),tk=!0;for(const t of fb.values()){var e;lS=t.store.getState(),lS.internal.active&&(lS.frameloop==="always"||lS.internal.frames>0)&&!((e=lS.gl.xr)!=null&&e.isPresenting)&&(bO+=ek(n,lS))}if(tk=!1,hw("after",n),bO===0)return hw("tail",n),LB=!1,cancelAnimationFrame(sj)}function nk(n,e=1){var t;if(!n)return fb.forEach(i=>nk(i.store.getState(),e));(t=n.gl.xr)!=null&&t.isPresenting||!n.internal.active||n.frameloop==="never"||(e>1?n.internal.frames=Math.min(60,n.internal.frames+e):tk?n.internal.frames=2:n.internal.frames=1,LB||(LB=!0,requestAnimationFrame(Ane)))}function aj(n,e=!0,t,i){if(e&&hw("before",n),t)ek(n,t,i);else for(const r of fb.values())ek(n,r.store.getState());e&&hw("after",n)}const _O={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function iUe(n){const{handlePointer:e}=EOe(n);return{priority:1,enabled:!0,compute(t,i,r){i.pointer.set(t.offsetX/i.size.width*2-1,-(t.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(_O).reduce((t,i)=>({...t,[i]:e(i)}),{}),update:()=>{var t;const{events:i,internal:r}=n.getState();(t=r.lastEvent)!=null&&t.current&&i.handlers&&i.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{const{set:i,events:r}=n.getState();if(r.disconnect==null||r.disconnect(),i(s=>({events:{...s.events,connected:t}})),r.handlers)for(const s in r.handlers){const a=r.handlers[s],[o,l]=_O[s];t.addEventListener(o,a,{passive:l})}},disconnect:()=>{const{set:t,events:i}=n.getState();if(i.connected){if(i.handlers)for(const r in i.handlers){const s=i.handlers[r],[a]=_O[r];i.connected.removeEventListener(a,s)}t(r=>({events:{...r.events,connected:void 0}}))}}}}function oj(n,e){let t;return(...i)=>{window.clearTimeout(t),t=window.setTimeout(()=>n(...i),e)}}function rUe({debounce:n,scroll:e,polyfill:t,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const r=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=G.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=G.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=n?typeof n=="number"?n:n.scroll:null,u=n?typeof n=="number"?n:n.resize:null,c=G.useRef(!1);G.useEffect(()=>(c.current=!0,()=>{c.current=!1}));const[d,f,m]=G.useMemo(()=>{const b=()=>{if(!o.current.element)return;const{left:M,top:w,width:T,height:E,bottom:R,right:P,x:I,y:B}=o.current.element.getBoundingClientRect(),N={left:M,top:w,width:T,height:E,bottom:R,right:P,x:I,y:B};o.current.element instanceof HTMLElement&&i&&(N.height=o.current.element.offsetHeight,N.width=o.current.element.offsetWidth),Object.freeze(N),c.current&&!lUe(o.current.lastBounds,N)&&a(o.current.lastBounds=N)};return[b,u?oj(b,u):b,l?oj(b,l):b]},[a,i,l,u]);function y(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(b=>b.removeEventListener("scroll",m,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function _(){o.current.element&&(o.current.resizeObserver=new r(m),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(b=>b.addEventListener("scroll",m,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{m()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const S=b=>{!b||b===o.current.element||(y(),o.current.element=b,o.current.scrollContainers=Tne(b),_())};return aUe(m,!!e),sUe(f),G.useEffect(()=>{y(),_()},[e,m,f]),G.useEffect(()=>y,[]),[S,s,d]}function sUe(n){G.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[n])}function aUe(n,e){G.useEffect(()=>{if(e){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[n,e])}function Tne(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:i,overflowY:r}=window.getComputedStyle(n);return[t,i,r].some(s=>s==="auto"||s==="scroll")&&e.push(n),[...e,...Tne(n.parentElement)]}const oUe=["x","y","top","bottom","left","right","width","height"],lUe=(n,e)=>oUe.every(t=>n[t]===e[t]);function uUe({ref:n,children:e,fallback:t,resize:i,style:r,gl:s,events:a=iUe,eventSource:o,eventPrefix:l,shadows:u,linear:c,flat:d,legacy:f,orthographic:m,frameloop:y,dpr:_,performance:S,raycaster:b,camera:M,scene:w,onPointerMissed:T,onCreated:E,...R}){G.useMemo(()=>eo(ene),[]);const P=yOe(),[I,B]=rUe({scroll:!0,debounce:{scroll:50,resize:0},...i}),N=G.useRef(null),U=G.useRef(null);G.useImperativeHandle(n,()=>N.current);const V=vV(T),[W,K]=G.useState(!1),[q,j]=G.useState(!1);if(W)throw W;if(q)throw q;const te=G.useRef(null);LR(()=>{const _e=N.current;if(B.width>0&&B.height>0&&_e){te.current||(te.current=qOe(_e));async function Be(){await te.current.configure({gl:s,scene:w,events:a,shadows:u,linear:c,flat:d,legacy:f,orthographic:m,frameloop:y,dpr:_,performance:S,raycaster:b,camera:M,size:B,onPointerMissed:(...ue)=>V.current==null?void 0:V.current(...ue),onCreated:ue=>{ue.events.connect==null||ue.events.connect(o?mOe(o)?o.current:o:U.current),l&&ue.setEvents({compute:(ce,Ce)=>{const Oe=ce[l+"X"],nt=ce[l+"Y"];Ce.pointer.set(Oe/Ce.size.width*2-1,-(nt/Ce.size.height)*2+1),Ce.raycaster.setFromCamera(Ce.pointer,Ce.camera)}}),E?.(ue)}}),te.current.render($.jsx(P,{children:$.jsx(xOe,{set:j,children:$.jsx(G.Suspense,{fallback:$.jsx(vOe,{set:K}),children:e??null})})}))}Be()}}),G.useEffect(()=>{const _e=N.current;if(_e)return()=>xne(_e)},[]);const he=o?"none":"auto";return $.jsx("div",{ref:U,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:he,...r},...R,children:$.jsx("div",{ref:I,style:{width:"100%",height:"100%"},children:$.jsx("canvas",{ref:N,style:{display:"block"},children:t})})})}function Cne(n){return $.jsx(ane,{children:$.jsx(uUe,{...n})})}function cUe({children:n}){return $.jsx(Cne,{shadows:!0,gl:{preserveDrawingBuffer:!0,depth:!0},children:n})}const hUe=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],SO=new WeakMap;class wne{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=hUe,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:i,material:r,object:s}=e;if(t={material:this.getMaterialData(r),geometry:{id:i.id,attributes:this.getAttributesData(i.attributes),indexVersion:i.index?i.index.version:null,drawRange:{start:i.drawRange.start,count:i.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:a,height:o}=e.context;t.bufferWidth=a,t.bufferHeight=o}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const i in e){const r=e[i];t[i]={version:r.version}}return t}containsNode(e){const t=e.material;for(const i in t)if(t[i]&&t[i].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const i of this.refreshUniforms){const r=e[i];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[i]={id:r.id,version:r.version}:t[i]=r.clone():t[i]=r)}return t}equals(e,t){const{object:i,material:r,geometry:s}=e,a=this.getRenderObjectData(e);if(a.worldMatrix.equals(i.matrixWorld)!==!0)return a.worldMatrix.copy(i.matrixWorld),!1;const o=a.material;for(const S in o){const b=o[S],M=r[S];if(b.equals!==void 0){if(b.equals(M)===!1)return b.copy(M),!1}else if(M.isTexture===!0){if(b.id!==M.id||b.version!==M.version)return b.id=M.id,b.version=M.version,!1}else if(b!==M)return o[S]=M,!1}if(o.transmission>0){const{width:S,height:b}=e.context;if(a.bufferWidth!==S||a.bufferHeight!==b)return a.bufferWidth=S,a.bufferHeight=b,!1}const l=a.geometry,u=s.attributes,c=l.attributes,d=Object.keys(c),f=Object.keys(u);if(l.id!==s.id)return l.id=s.id,!1;if(d.length!==f.length)return a.geometry.attributes=this.getAttributesData(u),!1;for(const S of d){const b=c[S],M=u[S];if(M===void 0)return delete c[S],!1;if(b.version!==M.version)return b.version=M.version,!1}const m=s.index,y=l.indexVersion,_=m?m.version:null;if(y!==_)return l.indexVersion=_,!1;if(l.drawRange.start!==s.drawRange.start||l.drawRange.count!==s.drawRange.count)return l.drawRange.start=s.drawRange.start,l.drawRange.count=s.drawRange.count,!1;if(a.morphTargetInfluences){let S=!1;for(let b=0;b<a.morphTargetInfluences.length;b++)a.morphTargetInfluences[b]!==i.morphTargetInfluences[b]&&(a.morphTargetInfluences[b]=i.morphTargetInfluences[b],S=!0);if(S)return!1}if(a.lights){for(let S=0;S<t.length;S++)if(a.lights[S].map!==t[S].map)return!1}return a.center&&a.center.equals(i.center)===!1?(a.center.copy(i.center),!0):(e.bundle!==null&&(a.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const i of e)i.isSpotLight===!0&&i.map!==null&&t.push({map:i.map.version});return t}getLights(e,t){if(SO.has(e)){const r=SO.get(e);if(r.renderId===t)return r.lightsData}const i=this.getLightsData(e.getLights());return SO.set(e,{renderId:t,lightsData:i}),i}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:i}=t;if(this.renderId!==i)return this.renderId=i,!0;const r=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(r||s)return!1;const a=this.getLights(e.lightsNode,i);return this.equals(e,a)!==!0}}function MV(n,e=0){let t=3735928559^e,i=1103547991^e;if(n instanceof Array)for(let r=0,s;r<n.length;r++)s=n[r],t=Math.imul(t^s,2654435761),i=Math.imul(i^s,1597334677);else for(let r=0,s;r<n.length;r++)s=n.charCodeAt(r),t=Math.imul(t^s,2654435761),i=Math.imul(i^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&i)+(t>>>0)}const oA=n=>MV(n),Fb=n=>MV(n),JS=(...n)=>MV(n),dUe=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),lj=new WeakMap;function AV(n){return dUe.get(n)}function qw(n){if(/[iu]?vec\d/.test(n))return n.startsWith("ivec")?Int32Array:n.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(n)||/float/.test(n))return Float32Array;if(/uint/.test(n))return Uint32Array;if(/int/.test(n))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${n}`)}function TV(n){if(/float|int|uint/.test(n))return 1;if(/vec2/.test(n))return 2;if(/vec3/.test(n))return 3;if(/vec4/.test(n)||/mat2/.test(n))return 4;if(/mat3/.test(n))return 9;if(/mat4/.test(n))return 16;Tt("TSL: Unsupported type:",n)}function Ene(n){if(/float|int|uint/.test(n))return 1;if(/vec2/.test(n))return 2;if(/vec3/.test(n))return 3;if(/vec4/.test(n)||/mat2/.test(n))return 4;if(/mat3/.test(n))return 12;if(/mat4/.test(n))return 16;Tt("TSL: Unsupported type:",n)}function Rne(n){if(/float|int|uint/.test(n))return 4;if(/vec2/.test(n))return 8;if(/vec3/.test(n)||/vec4/.test(n))return 16;if(/mat2/.test(n))return 8;if(/mat3/.test(n)||/mat4/.test(n))return 16;Tt("TSL: Unsupported type:",n)}function jg(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix2===!0?"mat2":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function PF(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new en(...e):t==="vec2"?new rt(...e):t==="vec3"?new re(...e):t==="vec4"?new si(...e):t==="mat2"?new rA(...e):t==="mat3"?new Li(...e):t==="mat4"?new Mn(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?EV(e[0]):null}function CV(n){let e=lj.get(n);return e===void 0&&(e={},lj.set(n,e)),e}function wV(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function EV(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}var fUe=Object.freeze({__proto__:null,arrayBufferToBase64:wV,base64ToArrayBuffer:EV,getAlignmentFromType:Rne,getDataFromObject:CV,getLengthFromType:TV,getMemoryLengthFromType:Ene,getTypeFromLength:AV,getTypedArrayFromType:qw,getValueFromType:PF,getValueType:jg,hash:JS,hashArray:Fb,hashString:oA});const zS={VERTEX:"vertex",FRAGMENT:"fragment"},Ni={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Pne={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},Ml={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},RV=["fragment","vertex"],IB=["setup","analyze","generate"],GB=[...RV,"compute"],qv=["x","y","z","w"],pUe={analyze:"setup",generate:"analyze"};let mUe=0,Wn=class extends wl{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Ni.NONE,this.updateBeforeType=Ni.NONE,this.updateAfterType=Ni.NONE,this.uuid=Wl.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:mUe++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,Ni.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Ni.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Ni.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const i of Object.getOwnPropertyNames(this)){const r=this[i];if(!(i.startsWith("_")===!0||e.has(r))){if(Array.isArray(r)===!0)for(let s=0;s<r.length;s++){const a=r[s];a&&a.isNode===!0&&t.push({property:i,index:s,childNode:a})}else if(r&&r.isNode===!0)t.push({property:i,childNode:r});else if(r&&Object.getPrototypeOf(r)===Object.prototype)for(const s in r){if(s.startsWith("_")===!0)continue;const a=r[s];a&&a.isNode===!0&&t.push({property:i,index:s,childNode:a})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const i=[];for(const{property:r,childNode:s}of this._getChildren(t))i.push(oA(r.slice(0,-4)),s.getCacheKey(e,t));this._cacheKey=JS(Fb(i),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let i=0;for(const r of this.getChildren())t["node"+i++]=r;return t.outputNode||null}analyze(e,t=null){const i=e.increaseUsage(this);if(this.parents===!0){const r=e.getDataFromNode(this,"any");r.stages=r.stages||{},r.stages[e.shaderStage]=r.stages[e.shaderStage]||[],r.stages[e.shaderStage].push(t)}if(i===1){const r=e.getNodeProperties(this);for(const s of Object.values(r))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:i}=e.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(e,t)}updateBefore(){mt("Abstract function.")}updateAfter(){mt("Abstract function.")}update(){mt("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const i=this.getShared(e);if(this!==i)return i.build(e,t);if(this._beforeNodes!==null){const l=this._beforeNodes;this._beforeNodes=null;for(const u of l)u.build(e,t);this._beforeNodes=l}const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const s=pUe[e.buildStage];if(s&&r.buildStages[s]!==!0){const l=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(l)}e.addNode(this),e.addChain(this);let a=null;const o=e.getBuildStage();if(o==="setup"){this.updateReference(e);const l=e.getNodeProperties(this);if(l.initialized!==!0){l.initialized=!0,l.outputNode=this.setup(e)||l.outputNode||null;for(const u of Object.values(l))if(u&&u.isNode===!0){if(u.parents===!0){const c=e.getNodeProperties(u);c.parents=c.parents||[],c.parents.push(this)}u.build(e)}}a=l.outputNode}else if(o==="analyze")this.analyze(e,t);else if(o==="generate"){if(this.generate.length<2){const u=this.getNodeType(e),c=e.getDataFromNode(this);a=c.snippet,a===void 0?c.generated===void 0?(c.generated=!0,a=this.generate(e)||"",c.snippet=a):(mt("Node: Recursion detected.",this),a="/* Recursion detected. */"):c.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),a=e.format(a,u,t)}else a=this.generate(e,t)||"";a===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(Tt(`TSL: Invalid generated code, expected a "${t}".`),a=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),a}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),i={};for(const{property:r,index:s,childNode:a}of t)s!==void 0?(i[r]===void 0&&(i[r]=Number.isInteger(s)?[]:{}),i[r][s]=a.toJSON(e.meta).uuid):i[r]=a.toJSON(e.meta).uuid;Object.keys(i).length>0&&(e.inputNodes=i)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const i in e.inputNodes)if(Array.isArray(e.inputNodes[i])){const r=[];for(const s of e.inputNodes[i])r.push(t[s]);this[i]=r}else if(typeof e.inputNodes[i]=="object"){const r={};for(const s in e.inputNodes[i]){const a=e.inputNodes[i][s];r[s]=t[a]}this[i]=r}else{const r=e.inputNodes[i];this[i]=t[r]}}}toJSON(e){const{uuid:t,type:i}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:i,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function a(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}if(r){const o=a(e.textures),l=a(e.images),u=a(e.nodes);o.length>0&&(s.textures=o),l.length>0&&(s.images=l),u.length>0&&(s.nodes=u)}return s}};class Qv extends Wn{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e),i=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${i}[ ${r} ]`}}class PV extends Wn{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let i=null;for(const r of this.convertTo.split("|"))(i===null||e.getTypeLength(t)===e.getTypeLength(r))&&(i=r);return i}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const i=this.node,r=this.getNodeType(e),s=i.build(e,r);return e.format(s,r,t)}}class Ca extends Wn{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const a=super.build(e,r),o=e.getVarFromNode(this,null,r),l=e.getPropertyName(o);return e.addLineFlowCode(`${l} = ${a}`,this),s.snippet=a,s.propertyName=l,e.format(s.propertyName,r,t)}}return super.build(e,t)}}class Dne extends Ca{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,i)=>t+e.getTypeLength(i.getNodeType(e)),0))}generate(e,t){const i=this.getNodeType(e),r=e.getTypeLength(i),s=this.nodes,a=e.getComponentType(i),o=[];let l=0;for(const c of s){if(l>=r){Tt(`TSL: Length of parameters exceeds maximum length of function '${i}()' type.`);break}let d=c.getNodeType(e),f=e.getTypeLength(d),m;if(l+f>r&&(Tt(`TSL: Length of '${i}()' data exceeds maximum length of output type.`),f=r-l,d=e.getTypeFromLength(f)),l+=f,m=c.build(e,d),e.getComponentType(d)!==a){const _=e.getTypeFromLength(f,a);m=e.format(m,d,_)}o.push(m)}const u=`${e.getType(i)}( ${o.join(", ")} )`;return e.format(u,i,t)}}const gUe=qv.join("");class DV extends Wn{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(qv.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const i=this.node,r=e.getTypeLength(i.getNodeType(e));let s=null;if(r>1){let a=null;this.getVectorLength()>=r&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=i.build(e,a);this.components.length===r&&this.components===gUe.slice(0,this.components.length)?s=e.format(l,a,t):s=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else s=i.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class Nne extends Ca{static get type(){return"SetNode"}constructor(e,t,i){super(),this.sourceNode=e,this.components=t,this.targetNode=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:i,targetNode:r}=this,s=this.getNodeType(e),a=e.getComponentType(r.getNodeType(e)),o=e.getTypeFromLength(i.length,a),l=r.build(e,o),u=t.build(e,s),c=e.getTypeLength(s),d=[];for(let f=0;f<c;f++){const m=qv[f];m===i[0]?(d.push(l),f+=i.length-1):d.push(u+"."+m)}return`${e.getType(s)}( ${d.join(", ")} )`}}class yUe extends Ca{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:i}=this,r=this.getNodeType(e),s=i.build(e),a=e.getVarFromNode(this),o=e.getPropertyName(a);e.addLineFlowCode(o+" = "+s,this);const l=e.getTypeLength(r),u=[];let c=0;for(let d=0;d<l;d++){const f=qv[d];f===t[c]?(u.push("1.0 - "+(o+"."+f)),c++):u.push(o+"."+f)}return`${e.getType(r)}( ${u.join(", ")} )`}}class NV extends Wn{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?jg(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=jg(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=wV(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?PF(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){mt("Abstract function.")}}const uj=/float|u?int/;class Bh extends NV{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const i=this.getNodeType(e);return uj.test(i)&&uj.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),i,t)}}class Bne extends Wn{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const i=this.getNodeType(e);return e.getStructTypeNode(i).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){mt(`TSL: Member "${this.property}" does not exist in struct.`);const i=this.getNodeType(e);return e.generateConst(i)}return this.structNode.build(e)+"."+this.property}}let zv=null;const ik=new Map;function Pt(n,e){if(ik.has(n)){mt(`TSL: Redefinition of method chaining '${n}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${n} is not a function`);ik.set(n,e),n!=="assign"&&(Wn.prototype[n]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},Wn.prototype[n+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const vUe=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),cj=n=>vUe(n).split("").sort().join("");Wn.prototype.assign=function(...n){if(this.isStackNode!==!0)return zv!==null?zv.assign(this,...n):Tt("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=ik.get("assign");return this.addToStack(e(...n))}};Wn.prototype.toVarIntent=function(){return this};Wn.prototype.get=function(n){return new Bne(this,n)};const dw={};function SD(n,e,t){dw[n]=dw[e]=dw[t]={get(){this._cache=this._cache||{};let a=this._cache[n];return a===void 0&&(a=new DV(this,n),this._cache[n]=a),a},set(a){this[n].assign(Dn(a))}};const i=n.toUpperCase(),r=e.toUpperCase(),s=t.toUpperCase();Wn.prototype["set"+i]=Wn.prototype["set"+r]=Wn.prototype["set"+s]=function(a){const o=cj(n);return new Nne(this,o,Dn(a))},Wn.prototype["flip"+i]=Wn.prototype["flip"+r]=Wn.prototype["flip"+s]=function(){const a=cj(n);return new yUe(this,a)}}const Hp=["x","y","z","w"],Xp=["r","g","b","a"],Wp=["s","t","p","q"];for(let n=0;n<4;n++){let e=Hp[n],t=Xp[n],i=Wp[n];SD(e,t,i);for(let r=0;r<4;r++){e=Hp[n]+Hp[r],t=Xp[n]+Xp[r],i=Wp[n]+Wp[r],SD(e,t,i);for(let s=0;s<4;s++){e=Hp[n]+Hp[r]+Hp[s],t=Xp[n]+Xp[r]+Xp[s],i=Wp[n]+Wp[r]+Wp[s],SD(e,t,i);for(let a=0;a<4;a++)e=Hp[n]+Hp[r]+Hp[s]+Hp[a],t=Xp[n]+Xp[r]+Xp[s]+Xp[a],i=Wp[n]+Wp[r]+Wp[s]+Wp[a],SD(e,t,i)}}}for(let n=0;n<32;n++)dw[n]={get(){this._cache=this._cache||{};let e=this._cache[n];return e===void 0&&(e=new Qv(this,new Bh(n,"uint")),this._cache[n]=e),e},set(e){this[n].assign(Dn(e))}};Object.defineProperties(Wn.prototype,dw);const hj=new WeakMap,xUe=function(n,e=null){const t=jg(n);return t==="node"?n:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?Dn(rk(n,e)):t==="shader"?n.isFn?n:We(n):n},bUe=function(n,e=null){for(const t in n)n[t]=Dn(n[t],e);return n},_Ue=function(n,e=null){const t=n.length;for(let i=0;i<t;i++)n[i]=Dn(n[i],e);return n},Fne=function(n,e=null,t=null,i=null){function r(c){return i!==null?(c=Dn(Object.assign(c,i)),i.intent===!0&&(c=c.toVarIntent())):c=Dn(c),c}let s,a=e,o,l;function u(c){let d;return a?d=/[a-z]/i.test(a)?a+"()":a:d=n.type,o!==void 0&&c.length<o?(Tt(`TSL: "${d}" parameter length is less than minimum required.`),c.concat(new Array(o-c.length).fill(0))):l!==void 0&&c.length>l?(Tt(`TSL: "${d}" parameter length exceeds limit.`),c.slice(0,l)):c}return e===null?s=(...c)=>r(new n(...Gx(u(c)))):t!==null?(t=Dn(t),s=(...c)=>r(new n(e,...Gx(u(c)),t))):s=(...c)=>r(new n(e,...Gx(u(c)))),s.setParameterLength=(...c)=>(c.length===1?o=l=c[0]:c.length===2&&([o,l]=c),s),s.setName=c=>(a=c,s),s},SUe=function(n,...e){return new n(...Gx(e))};class MUe extends Wn{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:i}=this,r=e.getNodeProperties(t),s=e.getClosestSubBuild(t.subBuilds)||"",a=s||"default";if(r[a])return r[a];const o=e.subBuildFn,l=e.fnCall;e.subBuildFn=s,e.fnCall=this;let u=null;if(t.layout){let c=hj.get(e.constructor);c===void 0&&(c=new WeakMap,hj.set(e.constructor,c));let d=c.get(t);d===void 0&&(d=Dn(e.buildFunctionNode(t)),c.set(t,d)),e.addInclude(d);const f=i?AUe(i):null;u=Dn(d.call(f))}else{const c=new Proxy(e,{get:(_,S,b)=>{let M;return Symbol.iterator===S?M=function*(){yield void 0}:M=Reflect.get(_,S,b),M}}),d=i?TUe(i):null,f=Array.isArray(i)?i.length>0:i!==null,m=t.jsFunc,y=f||m.length>1?m(d,c):m(c);u=Dn(y)}return e.subBuildFn=o,e.fnCall=l,t.once&&(r[a]=u),u}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),i=e.getSubBuildOutput(this);return t[i]=t[i]||this.setupOutput(e),t[i].subBuild=e.getClosestSubBuild(this),t[i]}build(e,t=null){let i=null;const r=e.getBuildStage(),s=e.getNodeProperties(this),a=e.getSubBuildOutput(this),o=this.getOutputNode(e),l=e.fnCall;if(e.fnCall=this,r==="setup"){const u=e.getSubBuildProperty("initialized",this);if(s[u]!==!0&&(s[u]=!0,s[a]=this.getOutputNode(e),s[a].build(e),this.shaderNode.subBuilds))for(const c of e.chaining){const d=e.getDataFromNode(c,"any");d.subBuilds=d.subBuilds||new Set;for(const f of this.shaderNode.subBuilds)d.subBuilds.add(f)}i=s[a]}else r==="analyze"?o.build(e,t):r==="generate"&&(i=o.build(e,t)||"");return e.fnCall=l,i}}function AUe(n){let e;return BF(n),n[0]&&(n[0].isNode||Object.getPrototypeOf(n[0])!==Object.prototype)?e=[...n]:e=n[0],e}function TUe(n){let e=0;return BF(n),new Proxy(n,{get:(t,i,r)=>{let s;if(i==="length")return s=n.length,s;if(Symbol.iterator===i)s=function*(){for(const a of n)yield Dn(a)};else{if(n.length>0)if(Object.getPrototypeOf(n[0])===Object.prototype){const a=n[0];a[i]===void 0?s=a[e++]:s=Reflect.get(a,i,r)}else n[0]instanceof Wn&&(n[i]===void 0?s=n[e++]:s=Reflect.get(n,i,r));else s=Reflect.get(t,i,r);s=Dn(s)}return s}})}class CUe extends Wn{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new MUe(this,e)}setup(){return this.call()}}const wUe=[!1,!0],EUe=[0,1,2,3],RUe=[-1,-2],Lne=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],BV=new Map;for(const n of wUe)BV.set(n,new Bh(n));const FV=new Map;for(const n of EUe)FV.set(n,new Bh(n,"uint"));const LV=new Map([...FV].map(n=>new Bh(n.value,"int")));for(const n of RUe)LV.set(n,new Bh(n,"int"));const DF=new Map([...LV].map(n=>new Bh(n.value)));for(const n of Lne)DF.set(n,new Bh(n));for(const n of Lne)DF.set(-n,new Bh(-n));const NF={bool:BV,uint:FV,ints:LV,float:DF},dj=new Map([...BV,...DF]),rk=(n,e)=>dj.has(n)?dj.get(n):n.isNode===!0?n:new Bh(n,e),Wo=function(n,e=null){return(...t)=>{for(const r of t)if(r===void 0)return Tt(`TSL: Invalid parameter for the type "${n}".`),new Bh(0,n);if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(r=>{const s=typeof r;return s!=="object"&&s!=="function"}))&&(t=[PF(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return QC(e.get(t[0]));if(t.length===1){const r=rk(t[0],n);return r.nodeType===n?QC(r):QC(new PV(r,n))}const i=t.map(r=>rk(r));return QC(new Dne(i,n))}},Qw=n=>typeof n=="object"&&n!==null?n.value:n,Ine=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function VS(n,e){return new CUe(n,e)}const Dn=(n,e=null)=>xUe(n,e),QC=(n,e=null)=>Dn(n,e).toVarIntent(),BF=(n,e=null)=>new bUe(n,e),Gx=(n,e=null)=>new _Ue(n,e),Ri=(n,e=null,t=null,i=null)=>new Fne(n,e,t,i),En=(n,...e)=>new SUe(n,...e),dn=(n,e=null,t=null,i={})=>new Fne(n,e,t,{...i,intent:!0});let PUe=0;class DUe extends Wn{constructor(e,t=null){super();let i=null;t!==null&&(typeof t=="object"?i=t.return:(typeof t=="string"?i=t:Tt("TSL: Invalid layout type."),t=null)),this.shaderNode=new VS(e,i),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const i={name:"fn"+PUe++,type:t,inputs:[]};for(const r in e)r!=="return"&&i.inputs.push({name:r,type:e[r]});e=i}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return Tt('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function We(n,e=null){const t=new DUe(n,e);return new Proxy(()=>{},{apply(i,r,s){return t.call(...s)},get(i,r,s){return Reflect.get(t,r,s)},set(i,r,s,a){return Reflect.set(t,r,s,a)}})}const eE=n=>{zv=n},IV=()=>zv,Kn=(...n)=>zv.If(...n),NUe=(...n)=>zv.Switch(...n);function FF(n){return zv&&zv.addToStack(n),n}Pt("toStack",FF);const Gne=new Wo("color"),ge=new Wo("float",NF.float),Le=new Wo("int",NF.ints),Yt=new Wo("uint",NF.uint),Od=new Wo("bool",NF.bool),nn=new Wo("vec2"),ko=new Wo("ivec2"),GV=new Wo("uvec2"),One=new Wo("bvec2"),Ge=new Wo("vec3"),OV=new Wo("ivec3"),Lb=new Wo("uvec3"),UV=new Wo("bvec3"),Un=new Wo("vec4"),kV=new Wo("ivec4"),zV=new Wo("uvec4"),Une=new Wo("bvec4"),LF=new Wo("mat2"),Yl=new Wo("mat3"),rv=new Wo("mat4"),BUe=(n="")=>new Bh(n,"string"),FUe=n=>new Bh(n,"ArrayBuffer");Pt("toColor",Gne);Pt("toFloat",ge);Pt("toInt",Le);Pt("toUint",Yt);Pt("toBool",Od);Pt("toVec2",nn);Pt("toIVec2",ko);Pt("toUVec2",GV);Pt("toBVec2",One);Pt("toVec3",Ge);Pt("toIVec3",OV);Pt("toUVec3",Lb);Pt("toBVec3",UV);Pt("toVec4",Un);Pt("toIVec4",kV);Pt("toUVec4",zV);Pt("toBVec4",Une);Pt("toMat2",LF);Pt("toMat3",Yl);Pt("toMat4",rv);const kne=Ri(Qv).setParameterLength(2),zne=(n,e)=>Dn(new PV(Dn(n),e)),LUe=(n,e)=>Dn(new DV(Dn(n),e));Pt("element",kne);Pt("convert",zne);const IUe=n=>(mt("TSL: append() has been renamed to Stack()."),FF(n));Pt("append",n=>(mt("TSL: .append() has been renamed to .toStack()."),FF(n)));class ss extends Wn{static get type(){return"PropertyNode"}constructor(e,t=null,i=!1){super(e),this.name=t,this.varying=i,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return oA(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Vf=(n,e)=>new ss(n,e),fh=(n,e)=>new ss(n,e,!0),xs=En(ss,"vec4","DiffuseColor"),px=En(ss,"vec3","DiffuseContribution"),sk=En(ss,"vec3","EmissiveColor"),Qp=En(ss,"float","Roughness"),Yg=En(ss,"float","Metalness"),OB=En(ss,"float","Clearcoat"),tE=En(ss,"float","ClearcoatRoughness"),dh=En(ss,"vec3","Sheen"),Uy=En(ss,"float","SheenRoughness"),IF=En(ss,"float","Iridescence"),UB=En(ss,"float","IridescenceIOR"),kB=En(ss,"float","IridescenceThickness"),zB=En(ss,"float","AlphaT"),Gy=En(ss,"float","Anisotropy"),fw=En(ss,"vec3","AnisotropyT"),Ox=En(ss,"vec3","AnisotropyB"),Vv=En(ss,"color","SpecularColor"),Ax=En(ss,"color","SpecularColorBlended"),qS=En(ss,"float","SpecularF90"),VB=En(ss,"float","Shininess"),QS=En(ss,"vec4","Output"),Ux=En(ss,"float","dashSize"),nE=En(ss,"float","gapSize"),GUe=En(ss,"float","pointWidth"),pw=En(ss,"float","IOR"),HB=En(ss,"float","Transmission"),VV=En(ss,"float","Thickness"),HV=En(ss,"float","AttenuationDistance"),XV=En(ss,"color","AttenuationColor"),WV=En(ss,"float","Dispersion");class ZV extends Wn{static get type(){return"UniformGroupNode"}constructor(e,t=!1,i=1){super("string"),this.name=e,this.shared=t,this.order=i,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const Vne=n=>new ZV(n),GF=(n,e=0)=>new ZV(n,!0,e),Hne=GF("frame"),ti=GF("render"),jV=Vne("object");class lA extends NV{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=jV}setName(e){return this.name=e,this}label(e){return mt('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(i=>{const r=e(i,this);r!==void 0&&(this.value=r)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const i=this.getNodeType(e),r=this.getUniformHash(e);let s=e.getNodeFromHash(r);s===void 0&&(e.setHashNode(this,r),s=this);const a=s.getInputType(e),o=e.getUniformFromNode(s,a,e.shaderStage,this.name||e.context.nodeName),l=e.getPropertyName(o);e.context.nodeName!==void 0&&delete e.context.nodeName;let u=l;if(i==="bool"){const c=e.getDataFromNode(this);let d=c.propertyName;if(d===void 0){const f=e.getVarFromNode(this,null,"bool");d=e.getPropertyName(f),c.propertyName=d,u=e.format(l,a,i),e.addLineFlowCode(`${d} = ${u}`,this)}u=d}return e.format(u,i,t)}}const Qn=(n,e)=>{const t=Ine(e||n);if(t===n&&(n=PF(t)),n&&n.isNode===!0){let i=n.value;n.traverse(r=>{r.isConstNode===!0&&(i=r.value)}),n=i}return new lA(n,t)};class ak extends Ca{static get type(){return"ArrayNode"}constructor(e,t,i=null){super(e),this.count=t,this.values=i,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return this.nodeType===null?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const Xne=(...n)=>{let e;if(n.length===1){const t=n[0];e=new ak(null,t.length,t)}else{const t=n[0],i=n[1];e=new ak(t,i)}return Dn(e)};Pt("toArray",(n,e)=>Xne(Array(e).fill(n)));class Wne extends Ca{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const i=e.getTypeLength(t.node.getNodeType(e));return qv.join("").slice(0,i)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:i}=this,r=t.getScope(),s=e.getDataFromNode(r);s.assign=!0;const a=e.getNodeProperties(this);a.sourceNode=i,a.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:i,sourceNode:r}=e.getNodeProperties(this),s=this.needsSplitAssign(e),a=i.build(e),o=i.getNodeType(e),l=r.build(e,o),u=r.getNodeType(e),c=e.getDataFromNode(this);let d;if(c.initialized===!0)t!=="void"&&(d=a);else if(s){const f=e.getVarFromNode(this,null,o),m=e.getPropertyName(f);e.addLineFlowCode(`${m} = ${l}`,this);const y=i.node,S=y.node.context({assign:!0}).build(e);for(let b=0;b<y.components.length;b++){const M=y.components[b];e.addLineFlowCode(`${S}.${M} = ${m}[ ${b} ]`,this)}t!=="void"&&(d=a)}else d=`${a} = ${l}`,(t==="void"||u==="void")&&(e.addLineFlowCode(d,this),t!=="void"&&(d=a));return c.initialized=!0,e.format(d,o,t)}}const Zne=Ri(Wne).setParameterLength(2);Pt("assign",Zne);class jne extends Ca{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],i=this.functionNode,r=i.getInputs(e),s=this.parameters,a=(l,u)=>{const c=u.type,d=c==="pointer";let f;return d?f="&"+l.build(e):f=l.build(e,c),f};if(Array.isArray(s)){if(s.length>r.length)Tt("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=r.length;else if(s.length<r.length)for(Tt("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<r.length;)s.push(ge(0));for(let l=0;l<s.length;l++)t.push(a(s[l],r[l]))}else for(const l of r){const u=s[l.name];u!==void 0?t.push(a(u,l)):(Tt(`TSL: Input '${l.name}' not found in 'Fn()'.`),t.push(a(ge(0),l)))}return`${i.build(e,"property")}( ${t.join(", ")} )`}}const Yne=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Gx(e):BF(e[0]),new jne(Dn(n),e));Pt("call",Yne);const OUe={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Ua extends Ca{static get type(){return"OperatorNode"}constructor(e,t,i,...r){if(super(),r.length>0){let s=new Ua(e,t,i);for(let a=0;a<r.length-1;a++)s=new Ua(e,s,r[a]);t=s,i=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=i,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(OUe[this.op],t)}getNodeType(e,t=null){const i=this.op,r=this.aNode,s=this.bNode,a=r.getNodeType(e),o=s?s.getNodeType(e):null;if(a==="void"||o==="void")return t||"void";if(i==="%")return a;if(i==="~"||i==="&"||i==="|"||i==="^"||i===">>"||i==="<<")return e.getIntegerType(a);if(i==="!"||i==="&&"||i==="||"||i==="^^")return"bool";if(i==="=="||i==="!="||i==="<"||i===">"||i==="<="||i===">="){const l=Math.max(e.getTypeLength(a),e.getTypeLength(o));return l>1?`bvec${l}`:"bool"}else{if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a);if(e.isMatrix(o))return a}else if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(a)?o:a}}generate(e,t){const i=this.op,{aNode:r,bNode:s}=this,a=this.getNodeType(e,t);let o=null,l=null;a!=="void"?(o=r.getNodeType(e),l=s?s.getNodeType(e):null,i==="<"||i===">"||i==="<="||i===">="||i==="=="||i==="!="?e.isVector(o)?l=o:e.isVector(l)?o=l:o!==l&&(o=l="float"):i===">>"||i==="<<"?(o=a,l=e.changeComponentType(l,"uint")):i==="%"?(o=a,l=e.isInteger(o)&&e.isInteger(l)?l:o):e.isMatrix(o)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(o):e.isMatrix(l)||(o=l=a):e.isMatrix(l)?o==="float"?o="float":e.isVector(o)?o=e.getVectorFromMatrix(l):o=l=a:o=l=a):o=l=a;const u=r.build(e,o),c=s?s.build(e,l):null,d=e.getFunctionOperator(i);if(t!=="void"){const f=e.renderer.coordinateSystem===Sl;if(i==="=="||i==="!="||i==="<"||i===">"||i==="<="||i===">=")return f?e.isVector(o)?e.format(`${this.getOperatorMethod(e,t)}( ${u}, ${c} )`,a,t):e.format(`( ${u} ${i} ${c} )`,a,t):e.format(`( ${u} ${i} ${c} )`,a,t);if(i==="%")return e.isInteger(l)?e.format(`( ${u} % ${c} )`,a,t):e.format(`${this.getOperatorMethod(e,a)}( ${u}, ${c} )`,a,t);if(i==="!"||i==="~")return e.format(`(${i}${u})`,o,t);if(d)return e.format(`${d}( ${u}, ${c} )`,a,t);if(e.isMatrix(o)&&l==="float")return e.format(`( ${c} ${i} ${u} )`,a,t);if(o==="float"&&e.isMatrix(l))return e.format(`${u} ${i} ${c}`,a,t);{let m=`( ${u} ${i} ${c} )`;return!f&&a==="bool"&&e.isVector(o)&&e.isVector(l)&&(m=`all${m}`),e.format(m,a,t)}}else if(o!=="void")return d?e.format(`${d}( ${u}, ${c} )`,a,t):e.isMatrix(o)&&l==="float"?e.format(`${c} ${i} ${u}`,a,t):e.format(`${u} ${i} ${c}`,a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Eo=dn(Ua,"+").setParameterLength(2,1/0).setName("add"),Dr=dn(Ua,"-").setParameterLength(2,1/0).setName("sub"),Ci=dn(Ua,"*").setParameterLength(2,1/0).setName("mul"),Eh=dn(Ua,"/").setParameterLength(2,1/0).setName("div"),IR=dn(Ua,"%").setParameterLength(2).setName("mod"),YV=dn(Ua,"==").setParameterLength(2).setName("equal"),Kne=dn(Ua,"!=").setParameterLength(2).setName("notEqual"),$ne=dn(Ua,"<").setParameterLength(2).setName("lessThan"),KV=dn(Ua,">").setParameterLength(2).setName("greaterThan"),Jne=dn(Ua,"<=").setParameterLength(2).setName("lessThanEqual"),qne=dn(Ua,">=").setParameterLength(2).setName("greaterThanEqual"),Qne=dn(Ua,"&&").setParameterLength(2,1/0).setName("and"),eie=dn(Ua,"||").setParameterLength(2,1/0).setName("or"),tie=dn(Ua,"!").setParameterLength(1).setName("not"),nie=dn(Ua,"^^").setParameterLength(2).setName("xor"),iie=dn(Ua,"&").setParameterLength(2).setName("bitAnd"),rie=dn(Ua,"~").setParameterLength(1).setName("bitNot"),sie=dn(Ua,"|").setParameterLength(2).setName("bitOr"),aie=dn(Ua,"^").setParameterLength(2).setName("bitXor"),oie=dn(Ua,"<<").setParameterLength(2).setName("shiftLeft"),lie=dn(Ua,">>").setParameterLength(2).setName("shiftRight"),uie=We(([n])=>(n.addAssign(1),n)),cie=We(([n])=>(n.subAssign(1),n)),hie=We(([n])=>{const e=Le(n).toConst();return n.addAssign(1),e}),die=We(([n])=>{const e=Le(n).toConst();return n.subAssign(1),e});Pt("add",Eo);Pt("sub",Dr);Pt("mul",Ci);Pt("div",Eh);Pt("mod",IR);Pt("equal",YV);Pt("notEqual",Kne);Pt("lessThan",$ne);Pt("greaterThan",KV);Pt("lessThanEqual",Jne);Pt("greaterThanEqual",qne);Pt("and",Qne);Pt("or",eie);Pt("not",tie);Pt("xor",nie);Pt("bitAnd",iie);Pt("bitNot",rie);Pt("bitOr",sie);Pt("bitXor",aie);Pt("shiftLeft",oie);Pt("shiftRight",lie);Pt("incrementBefore",uie);Pt("decrementBefore",cie);Pt("increment",hie);Pt("decrement",die);const fie=(n,e)=>(mt('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),IR(Le(n),Le(e)));Pt("modInt",fie);class ht extends Ca{static get type(){return"MathNode"}constructor(e,t,i=null,r=null){if(super(),(e===ht.MAX||e===ht.MIN)&&arguments.length>3){let s=new ht(e,t,i);for(let a=2;a<arguments.length-1;a++)s=new ht(e,s,arguments[a]);t=s,i=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=i,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),i=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(i)?0:e.getTypeLength(i),o=e.isMatrix(r)?0:e.getTypeLength(r);return s>a&&s>o?t:a>o?i:o>s?r:t}getNodeType(e){const t=this.method;return t===ht.LENGTH||t===ht.DISTANCE||t===ht.DOT?"float":t===ht.CROSS?"vec3":t===ht.ALL||t===ht.ANY?"bool":t===ht.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:i,method:r}=this;let s=null;if(r===ht.ONE_MINUS)s=Dr(1,t);else if(r===ht.RECIPROCAL)s=Eh(1,t);else if(r===ht.DIFFERENCE)s=zs(Dr(t,i));else if(r===ht.TRANSFORM_DIRECTION){let a=t,o=i;e.isMatrix(a.getNodeType(e))?o=Un(Ge(o),0):a=Un(Ge(a),0);const l=Ci(a,o).xyz;s=nc(l)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let r=this.method;const s=this.getNodeType(e),a=this.getInputType(e),o=this.aNode,l=this.bNode,u=this.cNode,c=e.renderer.coordinateSystem;if(r===ht.NEGATE)return e.format("( - "+o.build(e,a)+" )",s,t);{const d=[];return r===ht.CROSS?d.push(o.build(e,s),l.build(e,s)):c===Sl&&r===ht.STEP?d.push(o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":a),l.build(e,a)):c===Sl&&(r===ht.MIN||r===ht.MAX)?d.push(o.build(e,a),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":a)):r===ht.REFRACT?d.push(o.build(e,a),l.build(e,a),u.build(e,"float")):r===ht.MIX?d.push(o.build(e,a),l.build(e,a),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":a)):(c===ic&&r===ht.ATAN&&l!==null&&(r="atan2"),e.shaderStage!=="fragment"&&(r===ht.DFDX||r===ht.DFDY)&&(mt(`TSL: '${r}' is not supported in the ${e.shaderStage} stage.`),r="/*"+r+"*/"),d.push(o.build(e,a)),l!==null&&d.push(l.build(e,a)),u!==null&&d.push(u.build(e,a))),e.format(`${e.getMethod(r,s)}( ${d.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}ht.ALL="all";ht.ANY="any";ht.RADIANS="radians";ht.DEGREES="degrees";ht.EXP="exp";ht.EXP2="exp2";ht.LOG="log";ht.LOG2="log2";ht.SQRT="sqrt";ht.INVERSE_SQRT="inversesqrt";ht.FLOOR="floor";ht.CEIL="ceil";ht.NORMALIZE="normalize";ht.FRACT="fract";ht.SIN="sin";ht.COS="cos";ht.TAN="tan";ht.ASIN="asin";ht.ACOS="acos";ht.ATAN="atan";ht.ABS="abs";ht.SIGN="sign";ht.LENGTH="length";ht.NEGATE="negate";ht.ONE_MINUS="oneMinus";ht.DFDX="dFdx";ht.DFDY="dFdy";ht.ROUND="round";ht.RECIPROCAL="reciprocal";ht.TRUNC="trunc";ht.FWIDTH="fwidth";ht.TRANSPOSE="transpose";ht.DETERMINANT="determinant";ht.INVERSE="inverse";ht.EQUALS="equals";ht.MIN="min";ht.MAX="max";ht.STEP="step";ht.REFLECT="reflect";ht.DISTANCE="distance";ht.DIFFERENCE="difference";ht.DOT="dot";ht.CROSS="cross";ht.POW="pow";ht.TRANSFORM_DIRECTION="transformDirection";ht.MIX="mix";ht.CLAMP="clamp";ht.REFRACT="refract";ht.SMOOTHSTEP="smoothstep";ht.FACEFORWARD="faceforward";const $V=ge(1e-6),UUe=ge(1e6),XB=ge(Math.PI),kUe=ge(Math.PI*2),zUe=ge(Math.PI*2),VUe=ge(Math.PI*.5),pie=dn(ht,ht.ALL).setParameterLength(1),mie=dn(ht,ht.ANY).setParameterLength(1),gie=dn(ht,ht.RADIANS).setParameterLength(1),yie=dn(ht,ht.DEGREES).setParameterLength(1),JV=dn(ht,ht.EXP).setParameterLength(1),SM=dn(ht,ht.EXP2).setParameterLength(1),OF=dn(ht,ht.LOG).setParameterLength(1),dm=dn(ht,ht.LOG2).setParameterLength(1),vu=dn(ht,ht.SQRT).setParameterLength(1),qV=dn(ht,ht.INVERSE_SQRT).setParameterLength(1),fm=dn(ht,ht.FLOOR).setParameterLength(1),UF=dn(ht,ht.CEIL).setParameterLength(1),nc=dn(ht,ht.NORMALIZE).setParameterLength(1),Yf=dn(ht,ht.FRACT).setParameterLength(1),Wu=dn(ht,ht.SIN).setParameterLength(1),Lf=dn(ht,ht.COS).setParameterLength(1),vie=dn(ht,ht.TAN).setParameterLength(1),xie=dn(ht,ht.ASIN).setParameterLength(1),QV=dn(ht,ht.ACOS).setParameterLength(1),kF=dn(ht,ht.ATAN).setParameterLength(1,2),zs=dn(ht,ht.ABS).setParameterLength(1),e4=dn(ht,ht.SIGN).setParameterLength(1),pm=dn(ht,ht.LENGTH).setParameterLength(1),t4=dn(ht,ht.NEGATE).setParameterLength(1),bie=dn(ht,ht.ONE_MINUS).setParameterLength(1),n4=dn(ht,ht.DFDX).setParameterLength(1),i4=dn(ht,ht.DFDY).setParameterLength(1),_ie=dn(ht,ht.ROUND).setParameterLength(1),Sie=dn(ht,ht.RECIPROCAL).setParameterLength(1),r4=dn(ht,ht.TRUNC).setParameterLength(1),s4=dn(ht,ht.FWIDTH).setParameterLength(1),Mie=dn(ht,ht.TRANSPOSE).setParameterLength(1),Aie=dn(ht,ht.DETERMINANT).setParameterLength(1),Tie=dn(ht,ht.INVERSE).setParameterLength(1),Cie=(n,e)=>(mt('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),YV(n,e)),Zc=dn(ht,ht.MIN).setParameterLength(2,1/0),ka=dn(ht,ht.MAX).setParameterLength(2,1/0),zF=dn(ht,ht.STEP).setParameterLength(2),wie=dn(ht,ht.REFLECT).setParameterLength(2),Eie=dn(ht,ht.DISTANCE).setParameterLength(2),Rie=dn(ht,ht.DIFFERENCE).setParameterLength(2),Ud=dn(ht,ht.DOT).setParameterLength(2),m0=dn(ht,ht.CROSS).setParameterLength(2),wd=dn(ht,ht.POW).setParameterLength(2),a4=n=>Ci(n,n),Pie=n=>Ci(n,n,n),o4=n=>Ci(n,n,n,n),Die=dn(ht,ht.TRANSFORM_DIRECTION).setParameterLength(2),Nie=n=>Ci(e4(n),wd(zs(n),1/3)),l4=n=>Ud(n,n),vr=dn(ht,ht.MIX).setParameterLength(3),Kf=(n,e=0,t=1)=>Dn(new ht(ht.CLAMP,Dn(n),Dn(e),Dn(t))),VF=n=>Kf(n),u4=dn(ht,ht.REFRACT).setParameterLength(3),Rh=dn(ht,ht.SMOOTHSTEP).setParameterLength(3),c4=dn(ht,ht.FACEFORWARD).setParameterLength(3),Bie=We(([n])=>{const i=43758.5453,r=Ud(n.xy,nn(12.9898,78.233)),s=IR(r,XB);return Yf(Wu(s).mul(i))}),Fie=(n,e,t)=>vr(e,t,n),Lie=(n,e,t)=>Rh(e,t,n),Iie=(n,e)=>zF(e,n),Gie=(n,e)=>(mt('TSL: "atan2" is overloaded. Use "atan" instead.'),kF(n,e)),HUe=c4,XUe=qV;Pt("all",pie);Pt("any",mie);Pt("equals",Cie);Pt("radians",gie);Pt("degrees",yie);Pt("exp",JV);Pt("exp2",SM);Pt("log",OF);Pt("log2",dm);Pt("sqrt",vu);Pt("inverseSqrt",qV);Pt("floor",fm);Pt("ceil",UF);Pt("normalize",nc);Pt("fract",Yf);Pt("sin",Wu);Pt("cos",Lf);Pt("tan",vie);Pt("asin",xie);Pt("acos",QV);Pt("atan",kF);Pt("abs",zs);Pt("sign",e4);Pt("length",pm);Pt("lengthSq",l4);Pt("negate",t4);Pt("oneMinus",bie);Pt("dFdx",n4);Pt("dFdy",i4);Pt("round",_ie);Pt("reciprocal",Sie);Pt("trunc",r4);Pt("fwidth",s4);Pt("atan2",Gie);Pt("min",Zc);Pt("max",ka);Pt("step",Iie);Pt("reflect",wie);Pt("distance",Eie);Pt("dot",Ud);Pt("cross",m0);Pt("pow",wd);Pt("pow2",a4);Pt("pow3",Pie);Pt("pow4",o4);Pt("transformDirection",Die);Pt("mix",Fie);Pt("clamp",Kf);Pt("refract",u4);Pt("smoothstep",Lie);Pt("faceForward",c4);Pt("difference",Rie);Pt("saturate",VF);Pt("cbrt",Nie);Pt("transpose",Mie);Pt("determinant",Aie);Pt("inverse",Tie);Pt("rand",Bie);class WUe extends Wn{static get type(){return"ConditionalNode"}constructor(e,t,i=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=i}getNodeType(e){const{ifNode:t,elseNode:i}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const r=t.getNodeType(e);if(i!==null){const s=i.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(r))return s}return r}setup(e){const t=this.condNode,i=this.ifNode.isolate(),r=this.elseNode?this.elseNode.isolate():null,s=e.context.nodeBlock;e.getDataFromNode(i).parentNodeBlock=s,r!==null&&(e.getDataFromNode(r).parentNodeBlock=s);const a=e.context.uniformFlow,o=e.getNodeProperties(this);o.condNode=t,o.ifNode=a?i:i.context({nodeBlock:i}),o.elseNode=r?a?r:r.context({nodeBlock:r}):null}generate(e,t){const i=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:s,ifNode:a,elseNode:o}=e.getNodeProperties(this),l=e.currentFunctionNode,u=t!=="void",c=u?Vf(i).build(e):"";r.nodeProperty=c;const d=s.build(e,"bool");if(e.context.uniformFlow&&o!==null){const y=a.build(e,i),_=o.build(e,i),S=e.getTernary(d,y,_);return e.format(S,i,t)}e.addFlowCode(`
${e.tab}if ( ${d} ) {

`).addFlowTab();let m=a.build(e,i);if(m&&(u?m=c+" = "+m+";":(m="return "+m+";",l===null&&(mt("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),m="// "+m))),e.removeFlowTab().addFlowCode(e.tab+"	"+m+`

`+e.tab+"}"),o!==null){e.addFlowCode(` else {

`).addFlowTab();let y=o.build(e,i);y&&(u?y=c+" = "+y+";":(y="return "+y+";",l===null&&(mt("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),y="// "+y))),e.removeFlowTab().addFlowCode(e.tab+"	"+y+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(c,i,t)}}const Zl=Ri(WUe).setParameterLength(2,3);Pt("select",Zl);class h4 extends Wn{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{t.isContextNode===!0&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const i=e.addContext(this.value),r=this.node.build(e,t);return e.setContext(i),r}}const E0=(n=null,e={})=>{let t=n;return(t===null||t.isNode!==!0)&&(e=t||e,t=null),new h4(t,e)},Oie=n=>E0(n,{uniformFlow:!0}),d4=(n,e)=>E0(n,{nodeName:e});function Uie(n,e,t=null){return E0(t,{getShadow:({light:i,shadowColorNode:r})=>e===i?r.mul(n):r})}function kie(n,e=null){return E0(e,{getAO:(t,{material:i})=>i.transparent===!0?t:t!==null?t.mul(n):n})}function zie(n,e){return mt('TSL: "label()" has been deprecated. Use "setName()" instead.'),d4(n,e)}Pt("context",E0);Pt("label",zie);Pt("uniformFlow",Oie);Pt("setName",d4);Pt("builtinShadowContext",(n,e,t)=>Uie(e,t,n));Pt("builtinAOContext",(n,e)=>kie(e,n));class mw extends Wn{static get type(){return"VarNode"}constructor(e,t=null,i=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=i,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return e.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)){let i=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&t.fnCall&&t.fnCall.shaderNode&&t.getDataFromNode(this.node.shaderNode).hasLoop){const a=t.getDataFromNode(this);a.forceDeclaration=!0,i=!0}const r=t.getBaseStack();i?r.addToStackBefore(this):r.addToStack(this)}return this.isIntent(t)&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:i,readOnly:r}=this,{renderer:s}=e,a=s.backend.isWebGPUBackend===!0;let o=!1,l=!1;r&&(o=e.isDeterministic(t),l=a?r:o);const u=this.getNodeType(e);if(u=="void")return this.isIntent(e)!==!0&&Tt('TSL: ".toVar()" can not be used with void type.'),t.build(e);const c=e.getVectorType(u),d=t.build(e,c),f=e.getVarFromNode(this,i,c,void 0,l),m=e.getPropertyName(f);let y=m;if(l)if(a)y=o?`const ${m}`:`let ${m}`;else{const _=t.getArrayCount(e);y=`const ${e.getVar(f.type,m,_)}`}return e.addLineFlowCode(`${y} = ${d}`,this),m}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const f4=Ri(mw),Vie=(n,e=null)=>f4(n,e).toStack(),Hie=(n,e=null)=>f4(n,e,!0).toStack(),Xie=n=>f4(n).setIntent(!0).toStack();Pt("toVar",Vie);Pt("toConst",Hie);Pt("toVarIntent",Xie);class Wie extends Wn{static get type(){return"SubBuild"}constructor(e,t,i=null){super(i),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const i=this.node.build(e,...t);return e.removeSubBuild(),i}}const eM=(n,e,t=null)=>Dn(new Wie(Dn(n),e,t));class Zie extends Wn{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let i=t.varying;if(i===void 0){const r=this.name,s=this.getNodeType(e),a=this.interpolationType,o=this.interpolationSampling;t.varying=i=e.getVaryingFromNode(this,r,s,a,o),t.node=eM(this.node,"VERTEX")}return i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment"),i}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(zS.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(zS.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),i=e.getNodeProperties(this),r=this.setupVarying(e);if(i[t]===void 0){const s=this.getNodeType(e),a=e.getPropertyName(r,zS.VERTEX);e.flowNodeFromShaderStage(zS.VERTEX,i.node,s,a),i[t]=a}return e.getPropertyName(r)}}const Gm=Ri(Zie).setParameterLength(1,2),jie=n=>Gm(n);Pt("toVarying",Gm);Pt("toVertexStage",jie);Pt("varying",(...n)=>(mt("TSL: .varying() has been renamed to .toVarying()."),Gm(...n)));Pt("vertexStage",(...n)=>(mt("TSL: .vertexStage() has been renamed to .toVertexStage()."),Gm(...n)));const Yie=We(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),i=n.lessThanEqual(.04045);return vr(e,t,i)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Kie=We(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),i=n.lessThanEqual(.0031308);return vr(e,t,i)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),p4="WorkingColorSpace",ZUe="OutputColorSpace";class HF extends Ca{static get type(){return"ColorSpaceNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.source=t,this.target=i}resolveColorSpace(e,t){return t===p4?di.workingColorSpace:t===ZUe?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,i=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let s=t;return di.enabled===!1||i===r||!i||!r||(di.getTransfer(i)===Hn&&(s=Un(Yie(s.rgb),s.a)),di.getPrimaries(i)!==di.getPrimaries(r)&&(s=Un(Yl(di._getMatrix(new Li,i,r)).mul(s.rgb),s.a)),di.getTransfer(r)===Hn&&(s=Un(Kie(s.rgb),s.a))),s}}const $ie=(n,e)=>Dn(new HF(Dn(n),p4,e)),XF=(n,e)=>Dn(new HF(Dn(n),e,p4)),jUe=(n,e,t)=>Dn(new HF(Dn(n),e,t));Pt("workingToColorSpace",$ie);Pt("colorSpaceToWorking",XF);let YUe=class extends Qv{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,i,r)}};class Jie extends Wn{static get type(){return"ReferenceBaseNode"}constructor(e,t,i=null,r=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=r,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.updateType=Ni.OBJECT}setGroup(e){return this.group=e,this}element(e){return new YUe(this,Dn(e))}setNodeType(e){const t=Qn(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let r=1;r<t.length;r++)i=i[t[r]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const KUe=(n,e,t)=>new Jie(n,e,t);class qie extends Jie{static get type(){return"RendererReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.renderer=i,this.setGroup(ti)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const Qie=(n,e,t=null)=>new qie(n,e,t);class ere extends Ca{static get type(){return"ToneMappingNode"}constructor(e,t=nre,i=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=i}customCacheKey(){return JS(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,i=this._toneMapping;if(i===ho)return t;let r=null;const s=e.renderer.library.getToneMappingFunction(i);return s!==null?r=Un(s(t.rgb,this.exposureNode),t.a):(Tt("ToneMappingNode: Unsupported Tone Mapping configuration.",i),r=t),r}}const tre=(n,e,t)=>Dn(new ere(n,Dn(e),Dn(t))),nre=Qie("toneMappingExposure","float");Pt("toneMapping",(n,e,t)=>tre(e,t,n));const fj=new WeakMap;function pj(n,e){let t=fj.get(n);return t===void 0&&(t=new Rb(n,e),fj.set(n,t)),t}class Bg extends NV{static get type(){return"BufferAttributeNode"}constructor(e,t=null,i=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=i,this.bufferOffset=r,this.usage=p0,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),i=e.getTypeLength(t),r=this.value,s=this.bufferStride||i,a=this.bufferOffset;let o;r.isInterleavedBuffer===!0?o=r:r.isBufferAttribute===!0?o=pj(r.array,s):o=pj(r,s);const l=new Tm(o,i,a);o.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),i=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(i);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,s=r):s=Gm(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}function WF(n,e=null,t=0,i=0,r=p0,s=!1){return e==="mat3"||e===null&&n.itemSize===9?Yl(new Bg(n,"vec3",9,0).setUsage(r).setInstanced(s),new Bg(n,"vec3",9,3).setUsage(r).setInstanced(s),new Bg(n,"vec3",9,6).setUsage(r).setInstanced(s)):e==="mat4"||e===null&&n.itemSize===16?rv(new Bg(n,"vec4",16,0).setUsage(r).setInstanced(s),new Bg(n,"vec4",16,4).setUsage(r).setInstanced(s),new Bg(n,"vec4",16,8).setUsage(r).setInstanced(s),new Bg(n,"vec4",16,12).setUsage(r).setInstanced(s)):new Bg(n,e,t,i)}const m4=(n,e=null,t=0,i=0)=>WF(n,e,t,i),$Ue=(n,e=null,t=0,i=0)=>WF(n,e,t,i,bh),WB=(n,e=null,t=0,i=0)=>WF(n,e,t,i,p0,!0),ok=(n,e=null,t=0,i=0)=>WF(n,e,t,i,bh,!0);Pt("toAttribute",n=>m4(n.value));class ire extends Wn{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=Ni.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return mt('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const i=e.getNodeProperties(this);i.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:i}=e;if(i==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const g4=(n,e=[64])=>{(e.length===0||e.length>3)&&Tt("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const i=e[t];(typeof i!="number"||i<=0||!Number.isInteger(i))&&Tt(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return Dn(new ire(Dn(n),e))},rre=(n,e,t)=>g4(n,t).setCount(e);Pt("compute",rre);Pt("computeKernel",g4);class sre extends Wn{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const i=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const s=this.node.build(e,...t);return e.setCache(i),s}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const tM=n=>new sre(Dn(n));function are(n,e=!0){return mt('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),tM(n).setParent(e)}Pt("cache",are);Pt("isolate",tM);class ore extends Wn{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const lre=Ri(ore).setParameterLength(2);Pt("bypass",lre);class y4 extends Wn{static get type(){return"RemapNode"}constructor(e,t,i,r=ge(0),s=ge(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=i,this.outLowNode=r,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:i,outLowNode:r,outHighNode:s,doClamp:a}=this;let o=e.sub(t).div(i.sub(t));return a===!0&&(o=o.clamp()),o.mul(s.sub(r)).add(r)}}const ure=Ri(y4,null,null,{doClamp:!1}).setParameterLength(3,5),cre=Ri(y4).setParameterLength(3,5);Pt("remap",ure);Pt("remapClamp",cre);class gw extends Wn{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const i=this.getNodeType(e),r=this.snippet;if(i==="void")e.addLineFlowCode(r,this);else return e.format(r,i,t)}}const g0=Ri(gw).setParameterLength(1,2),hre=n=>(n?Zl(n,g0("discard")):g0("discard")).toStack(),JUe=()=>g0("return").toStack();Pt("discard",hre);class dre extends Ca{static get type(){return"RenderOutputNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=i,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const i=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||ho,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||xl;return i!==ho&&(t=t.toneMapping(i)),r!==xl&&r!==di.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}const v4=(n,e=null,t=null)=>Dn(new dre(Dn(n),e,t));Pt("renderOutput",v4);class fre extends Ca{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,i=this.node.build(e),r="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(r.length);let a="";return a+="// #"+r+`#
`,a+=e.flow.code.replace(/^\t/mg,"")+`
`,a+="/* ... */ "+i+` /* ... */
`,a+="// #"+s+`#
`,t!==null?t(e,a):lb(a),i}}const pre=(n,e=null)=>Dn(new fre(Dn(n),e)).toStack();Pt("debug",pre);class x4{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class qUe extends Wn{static get type(){return"InspectorNode"}constructor(e,t="",i=null){super(),this.node=e,this.name=t,this.callback=i,this.updateType=Ni.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==x4&&hs('TSL: ".toInspector()" is only available with WebGPU.'),t}}function mre(n,e="",t=null){return n=Dn(n),n.before(new qUe(n,e,t))}Pt("toInspector",mre);function QUe(n){mt("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",n)}class b4 extends Wn{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const i=this.getAttributeName(e);if(e.hasGeometryAttribute(i)){const r=e.geometry.getAttribute(i);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),i=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),a=e.getTypeFromAttribute(s),o=e.getAttribute(t,a);return e.shaderStage==="vertex"?e.format(o.name,a,i):Gm(this).build(e,i)}else return mt(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(i)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Zu=(n,e=null)=>new b4(n,e),_s=(n=0)=>Zu("uv"+(n>0?n:""),"vec2");class gre extends Wn{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const i=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${i}, ${r} )`,this.getNodeType(e),t)}}const e0=Ri(gre).setParameterLength(1,2);class yre extends lA{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Ni.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,i=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(i&&i.width!==void 0){const{width:r,height:s}=i;this.value=Math.log2(Math.max(r,s))}}}const _4=Ri(yre).setParameterLength(1),S4=new pr;class $f extends lA{static get type(){return"TextureNode"}constructor(e=S4,t=null,i=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=i,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Ni.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===qr?"uvec4":this.value.type===Ao?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return _s(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Qn(this.value.matrix)),this._matrixUniform.mul(Ge(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=Qn(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(Le(e0(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const i=this.value;if(!i||i.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const r=We(()=>{let a=this.uvNode;return(a===null||e.context.forceUVContext===!0)&&e.context.getUV&&(a=e.context.getUV(this,e)),a||(a=this.getDefaultUV()),this.updateMatrix===!0&&(a=this.getTransformedUV(a)),a=this.setupUV(e,a),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?Ni.OBJECT:Ni.NONE,a})();let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,i,r,s,a,o,l,u){const c=this.value;let d;return s?d=e.generateTextureBias(c,t,i,s,a,u):l?d=e.generateTextureGrad(c,t,i,l,a,u):o?d=e.generateTextureCompare(c,t,i,o,a,u):this.sampler===!1?d=e.generateTextureLoad(c,t,i,r,a,u):r?d=e.generateTextureLevel(c,t,i,r,a,u):d=e.generateTexture(c,t,i,a,u),d}generate(e,t){const i=this.value,r=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const a=e.getDataFromNode(this);let o=a.propertyName;if(o===void 0){const{uvNode:c,levelNode:d,biasNode:f,compareNode:m,depthNode:y,gradNode:_,offsetNode:S}=r,b=this.generateUV(e,c),M=d?d.build(e,"float"):null,w=f?f.build(e,"float"):null,T=y?y.build(e,"int"):null,E=m?m.build(e,"float"):null,R=_?[_[0].build(e,"vec2"),_[1].build(e,"vec2")]:null,P=S?this.generateOffset(e,S):null,I=e.getVarFromNode(this);o=e.getPropertyName(I);const B=this.generateSnippet(e,s,b,M,w,T,E,R,P);e.addLineFlowCode(`${o} = ${B}`,this),a.snippet=B,a.propertyName=o}let l=o;const u=this.getNodeType(e);return e.needsToWorkingColorSpace(i)&&(l=XF(g0(l,u),i.colorSpace).setup(e).build(e,u)),e.format(l,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return mt("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Dn(e),t.referenceNode=this.getBase(),Dn(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=Dn(e).mul(_4(t)),t.referenceNode=this.getBase();const i=t.value;return t.generateMipmaps===!1&&(i&&i.generateMipmaps===!1||i.minFilter===xr||i.magFilter===xr)&&(mt("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Dn(t)}level(e){const t=this.clone();return t.levelNode=Dn(e),t.referenceNode=this.getBase(),Dn(t)}size(e){return e0(this,e)}bias(e){const t=this.clone();return t.biasNode=Dn(e),t.referenceNode=this.getBase(),Dn(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=Dn(e),t.referenceNode=this.getBase(),Dn(t)}grad(e,t){const i=this.clone();return i.gradNode=[Dn(e),Dn(t)],i.referenceNode=this.getBase(),Dn(i)}depth(e){const t=this.clone();return t.depthNode=Dn(e),t.referenceNode=this.getBase(),Dn(t)}offset(e){const t=this.clone();return t.offsetNode=Dn(e),t.referenceNode=this.getBase(),Dn(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const i=this._flipYUniform;i!==null&&(i.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const e5e=Ri($f).setParameterLength(1,4).setName("texture"),Qr=(n=S4,e=null,t=null,i=null)=>{let r;return n&&n.isTextureNode===!0?(r=Dn(n.clone()),r.referenceNode=n.getBase(),e!==null&&(r.uvNode=Dn(e)),t!==null&&(r.levelNode=Dn(t)),i!==null&&(r.biasNode=Dn(i))):r=e5e(n,e,t,i),r},t5e=(n=S4)=>Qr(n),$a=(...n)=>Qr(...n).setSampler(!1),n5e=(n,e,t)=>Qr(n,e).level(t),i5e=n=>(n.isNode===!0?n:Qr(n)).convert("sampler"),r5e=n=>(n.isNode===!0?n:Qr(n)).convert("samplerComparison");class ZF extends lA{static get type(){return"BufferNode"}constructor(e,t,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=i,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const GR=(n,e,t)=>new ZF(n,e,t);class s5e extends Qv{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),i=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,i)}}class vre extends ZF{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?jg(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Ni.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,i=this.elementType;if(i==="float"||i==="int"||i==="uint")for(let r=0;r<e.length;r++){const s=r*4;t[s]=e[r]}else if(i==="color")for(let r=0;r<e.length;r++){const s=r*4,a=e[r];t[s]=a.r,t[s+1]=a.g,t[s+2]=a.b||0}else if(i==="mat2")for(let r=0;r<e.length;r++){const s=r*4,a=e[r];t[s]=a.elements[0],t[s+1]=a.elements[1],t[s+2]=a.elements[2],t[s+3]=a.elements[3]}else if(i==="mat3")for(let r=0;r<e.length;r++){const s=r*16,a=e[r];t[s]=a.elements[0],t[s+1]=a.elements[1],t[s+2]=a.elements[2],t[s+4]=a.elements[3],t[s+5]=a.elements[4],t[s+6]=a.elements[5],t[s+8]=a.elements[6],t[s+9]=a.elements[7],t[s+10]=a.elements[8],t[s+15]=1}else if(i==="mat4")for(let r=0;r<e.length;r++){const s=r*16,a=e[r];for(let o=0;o<a.elements.length;o++)t[s+o]=a.elements[o]}else for(let r=0;r<e.length;r++){const s=r*4,a=e[r];t[s]=a.x,t[s+1]=a.y,t[s+2]=a.z||0,t[s+3]=a.w||0}}setup(e){const t=this.array.length,i=this.elementType;let r=Float32Array;const s=this.paddedType,a=e.getTypeLength(s);return i.charAt(0)==="i"&&(r=Int32Array),i.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*a),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return new s5e(this,Dn(e))}}const gu=(n,e)=>new vre(n,e);class a5e extends Wn{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const R0=Ri(a5e).setParameterLength(1);let nC,iC;class ks extends Wn{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===ks.DPR?"float":this.scope===ks.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Ni.NONE;return(this.scope===ks.SIZE||this.scope===ks.VIEWPORT||this.scope===ks.DPR)&&(e=Ni.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===ks.VIEWPORT?t!==null?iC.copy(t.viewport):(e.getViewport(iC),iC.multiplyScalar(e.getPixelRatio())):this.scope===ks.DPR?this._output.value=e.getPixelRatio():t!==null?(nC.width=t.width,nC.height=t.height):e.getDrawingBufferSize(nC)}setup(){const e=this.scope;let t=null;return e===ks.SIZE?t=Qn(nC||(nC=new rt)):e===ks.VIEWPORT?t=Qn(iC||(iC=new si)):e===ks.DPR?t=Qn(1):t=nn(Ib.div(pb)),this._output=t,t}generate(e){if(this.scope===ks.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const i=e.getNodeProperties(pb).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${i}.y - ${t}.y )`}return t}return super.generate(e)}}ks.COORDINATE="coordinate";ks.VIEWPORT="viewport";ks.SIZE="size";ks.UV="uv";ks.DPR="dpr";const M4=En(ks,ks.DPR),t0=En(ks,ks.UV),pb=En(ks,ks.SIZE),Ib=En(ks,ks.COORDINATE),nM=En(ks,ks.VIEWPORT),A4=nM.zw,xre=Ib.sub(nM.xy),o5e=xre.div(A4),l5e=We(()=>(mt('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),pb),"vec2").once()(),e1=Qn(0,"uint").setName("u_cameraIndex").setGroup(GF("cameraIndex")).toVarying("v_cameraIndex"),Hg=Qn("float").setName("cameraNear").setGroup(ti).onRenderUpdate(({camera:n})=>n.near),Xg=Qn("float").setName("cameraFar").setGroup(ti).onRenderUpdate(({camera:n})=>n.far),ju=We(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const r of n.cameras)t.push(r.projectionMatrix);e=gu(t).setGroup(ti).setName("cameraProjectionMatrices").element(n.isMultiViewCamera?R0("gl_ViewID_OVR"):e1).toConst("cameraProjectionMatrix")}else e=Qn("mat4").setName("cameraProjectionMatrix").setGroup(ti).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),u5e=We(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const r of n.cameras)t.push(r.projectionMatrixInverse);e=gu(t).setGroup(ti).setName("cameraProjectionMatricesInverse").element(n.isMultiViewCamera?R0("gl_ViewID_OVR"):e1).toConst("cameraProjectionMatrixInverse")}else e=Qn("mat4").setName("cameraProjectionMatrixInverse").setGroup(ti).onRenderUpdate(({camera:t})=>t.projectionMatrixInverse);return e}).once()(),Fh=We(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const r of n.cameras)t.push(r.matrixWorldInverse);e=gu(t).setGroup(ti).setName("cameraViewMatrices").element(n.isMultiViewCamera?R0("gl_ViewID_OVR"):e1).toConst("cameraViewMatrix")}else e=Qn("mat4").setName("cameraViewMatrix").setGroup(ti).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),c5e=We(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const r of n.cameras)t.push(r.matrixWorld);e=gu(t).setGroup(ti).setName("cameraWorldMatrices").element(n.isMultiViewCamera?R0("gl_ViewID_OVR"):e1).toConst("cameraWorldMatrix")}else e=Qn("mat4").setName("cameraWorldMatrix").setGroup(ti).onRenderUpdate(({camera:t})=>t.matrixWorld);return e}).once()(),h5e=We(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const r of n.cameras)t.push(r.normalMatrix);e=gu(t).setGroup(ti).setName("cameraNormalMatrices").element(n.isMultiViewCamera?R0("gl_ViewID_OVR"):e1).toConst("cameraNormalMatrix")}else e=Qn("mat3").setName("cameraNormalMatrix").setGroup(ti).onRenderUpdate(({camera:t})=>t.normalMatrix);return e}).once()(),yw=We(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(let r=0,s=n.cameras.length;r<s;r++)t.push(new re);e=gu(t).setGroup(ti).setName("cameraPositions").onRenderUpdate(({camera:r},s)=>{const a=r.cameras,o=s.array;for(let l=0,u=a.length;l<u;l++)o[l].setFromMatrixPosition(a[l].matrixWorld)}).element(n.isMultiViewCamera?R0("gl_ViewID_OVR"):e1).toConst("cameraPosition")}else e=Qn(new re).setName("cameraPosition").setGroup(ti).onRenderUpdate(({camera:t},i)=>i.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),d5e=We(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const r of n.cameras)t.push(r.viewport);e=gu(t,"vec4").setGroup(ti).setName("cameraViewports").element(e1).toConst("cameraViewport")}else e=Un(0,0,pb.x,pb.y).toConst("cameraViewport");return e}).once()(),mj=new fo;class Cr extends Wn{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Ni.OBJECT,this.uniformNode=new lA(null)}getNodeType(){const e=this.scope;if(e===Cr.WORLD_MATRIX)return"mat4";if(e===Cr.POSITION||e===Cr.VIEW_POSITION||e===Cr.DIRECTION||e===Cr.SCALE)return"vec3";if(e===Cr.RADIUS)return"float"}update(e){const t=this.object3d,i=this.uniformNode,r=this.scope;if(r===Cr.WORLD_MATRIX)i.value=t.matrixWorld;else if(r===Cr.POSITION)i.value=i.value||new re,i.value.setFromMatrixPosition(t.matrixWorld);else if(r===Cr.SCALE)i.value=i.value||new re,i.value.setFromMatrixScale(t.matrixWorld);else if(r===Cr.DIRECTION)i.value=i.value||new re,t.getWorldDirection(i.value);else if(r===Cr.VIEW_POSITION){const s=e.camera;i.value=i.value||new re,i.value.setFromMatrixPosition(t.matrixWorld),i.value.applyMatrix4(s.matrixWorldInverse)}else if(r===Cr.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),mj.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),i.value=mj.radius}}generate(e){const t=this.scope;return t===Cr.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===Cr.POSITION||t===Cr.VIEW_POSITION||t===Cr.DIRECTION||t===Cr.SCALE?this.uniformNode.nodeType="vec3":t===Cr.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Cr.WORLD_MATRIX="worldMatrix";Cr.POSITION="position";Cr.SCALE="scale";Cr.VIEW_POSITION="viewPosition";Cr.DIRECTION="direction";Cr.RADIUS="radius";const f5e=Ri(Cr,Cr.DIRECTION).setParameterLength(1),p5e=Ri(Cr,Cr.WORLD_MATRIX).setParameterLength(1),bre=Ri(Cr,Cr.POSITION).setParameterLength(1),m5e=Ri(Cr,Cr.SCALE).setParameterLength(1),g5e=Ri(Cr,Cr.VIEW_POSITION).setParameterLength(1),y5e=Ri(Cr,Cr.RADIUS).setParameterLength(1);class Ph extends Cr{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const v5e=En(Ph,Ph.DIRECTION),Ed=En(Ph,Ph.WORLD_MATRIX),x5e=En(Ph,Ph.POSITION),b5e=En(Ph,Ph.SCALE),_5e=En(Ph,Ph.VIEW_POSITION),_re=En(Ph,Ph.RADIUS),Sre=Qn(new Li).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),S5e=Qn(new Mn).onObjectUpdate(({object:n},e)=>e.value.copy(n.matrixWorld).invert()),wm=We(n=>n.context.modelViewMatrix||Mre).once()().toVar("modelViewMatrix"),Mre=Fh.mul(Ed),lk=We(n=>(n.context.isHighPrecisionModelViewMatrix=!0,Qn("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),uk=We(n=>{const e=n.context.isHighPrecisionModelViewMatrix;return Qn("mat3").onObjectUpdate(({object:t,camera:i})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),Hl=Zu("position","vec3"),Ia=Hl.toVarying("positionLocal"),ZB=Hl.toVarying("positionPrevious"),Th=We(n=>Ed.mul(Ia).xyz.toVarying(n.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),T4=We(()=>Ia.transformDirection(Ed).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),co=We(n=>n.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Cs=We(n=>{let e;return n.camera.isOrthographicCamera?e=Ge(0,0,1):e=co.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class Are extends Wn{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===Er?"false":e.getFrontFacing()}}const Tre=En(Are),C4=ge(Tre).mul(2).sub(1),uA=We(([n],{material:e})=>{const t=e.side;return t===Er?n=n.mul(-1):t===fr&&(n=n.mul(C4)),n}),jF=Zu("normal","vec3"),jc=We(n=>n.geometry.hasAttribute("normal")===!1?(mt('TSL: Vertex attribute "normal" not found on geometry.'),Ge(0,1,0)):jF,"vec3").once()().toVar("normalLocal"),Cre=co.dFdx().cross(co.dFdy()).normalize().toVar("normalFlat"),MM=We(n=>{let e;return n.material.flatShading===!0?e=Cre:e=w4(jc).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),wre=We(n=>{let e=MM.transformDirection(Fh);return n.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),Ur=We(({subBuildFn:n,material:e,context:t})=>{let i;return n==="NORMAL"||n==="VERTEX"?(i=MM,e.flatShading!==!0&&(i=uA(i))):i=t.setupNormal().context({getUV:null}),i},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),t1=Ur.transformDirection(Fh).toVar("normalWorld"),Tx=We(({subBuildFn:n,context:e})=>{let t;return n==="NORMAL"||n==="VERTEX"?t=Ur:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),Ere=We(([n,e=Ed])=>{const t=Yl(e),i=n.div(Ge(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(i).xyz}),w4=We(([n],e)=>{const t=e.context.modelNormalViewMatrix;if(t)return t.transformDirection(n);const i=Sre.mul(n);return Fh.transformDirection(i)}),M5e=We(()=>(mt('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),Ur)).once(["NORMAL","VERTEX"])(),A5e=We(()=>(mt('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),t1)).once(["NORMAL","VERTEX"])(),T5e=We(()=>(mt('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Tx)).once(["NORMAL","VERTEX"])(),gj=new Mu,MO=new Mn,Rre=Qn(0).onReference(({material:n})=>n).onObjectUpdate(({material:n})=>n.refractionRatio),XN=Qn(1).onReference(({material:n})=>n).onObjectUpdate(function({material:n,scene:e}){return n.envMap?n.envMapIntensity:e.environmentIntensity}),E4=Qn(new Mn).onReference(function(n){return n.material}).onObjectUpdate(function({material:n,scene:e}){const t=e.environment!==null&&n.envMap===null?e.environmentRotation:n.envMapRotation;return t?(gj.copy(t),MO.makeRotationFromEuler(gj)):MO.identity(),MO}),Pre=Cs.negate().reflect(Ur),Dre=Cs.negate().refract(Ur,Rre),Nre=Pre.transformDirection(Fh).toVar("reflectVector"),Bre=Dre.transformDirection(Fh).toVar("reflectVector"),Fre=new T0;class Lre extends $f{static get type(){return"CubeTextureNode"}constructor(e,t=null,i=null,r=null){super(e,t,i,r),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===_u?Nre:e.mapping===wh?Bre:(Tt('CubeTextureNode: Mapping "%s" not supported.',e.mapping),Ge(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const i=this.value;return i.isDepthTexture===!0?e.renderer.coordinateSystem===ic?Ge(t.x,t.y.negate(),t.z):t:((e.renderer.coordinateSystem===ic||!i.isRenderTargetTexture)&&(t=Ge(t.x.negate(),t.yz)),E4.mul(t))}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const R4=Ri(Lre).setParameterLength(1,4).setName("cubeTexture"),$u=(n=Fre,e=null,t=null,i=null)=>{let r;return n&&n.isCubeTextureNode===!0?(r=Dn(n.clone()),r.referenceNode=n,e!==null&&(r.uvNode=Dn(e)),t!==null&&(r.levelNode=Dn(t)),i!==null&&(r.biasNode=Dn(i))):r=R4(n,e,t,i),r},C5e=(n=Fre)=>R4(n);class w5e extends Qv{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,i,r)}}class OR extends Wn{static get type(){return"ReferenceNode"}constructor(e,t,i=null,r=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=r,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.name=null,this.updateType=Ni.OBJECT}element(e){return new w5e(this,Dn(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return mt('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=GR(null,e,this.count):Array.isArray(this.getValueFromReference())?t=gu(null,e):e==="texture"?t=Qr(null):e==="cubeTexture"?t=$u(null):t=Qn(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let r=1;r<t.length;r++)i=i[t[r]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Es=(n,e,t)=>new OR(n,e,t),ck=(n,e,t,i)=>new OR(n,e,i,t);class Ire extends OR{static get type(){return"MaterialReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.material=i,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Wg=(n,e,t=null)=>new Ire(n,e,t),Gre=_s(),E5e=co.dFdx(),R5e=co.dFdy(),Ore=Gre.dFdx(),Ure=Gre.dFdy(),kre=Ur,zre=R5e.cross(kre),Vre=kre.cross(E5e),hk=zre.mul(Ore.x).add(Vre.mul(Ure.x)),dk=zre.mul(Ore.y).add(Vre.mul(Ure.y)),yj=hk.dot(hk).max(dk.dot(dk)),Hre=yj.equal(0).select(0,yj.inverseSqrt()),P5e=hk.mul(Hre).toVar("tangentViewFrame"),D5e=dk.mul(Hre).toVar("bitangentViewFrame"),YF=Zu("tangent","vec4"),UR=YF.xyz.toVar("tangentLocal"),KF=We(({subBuildFn:n,geometry:e,material:t})=>{let i;return n==="VERTEX"||e.hasAttribute("tangent")?i=wm.mul(Un(UR,0)).xyz.toVarying("v_tangentView").normalize():i=P5e,t.flatShading!==!0&&(i=uA(i)),i},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),Xre=KF.transformDirection(Fh).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),$F=We(([n,e],{subBuildFn:t,material:i})=>{let r=n.mul(YF.w).xyz;return t==="NORMAL"&&i.flatShading!==!0&&(r=r.toVarying(e)),r}).once(["NORMAL"]),N5e=$F(jF.cross(YF),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),B5e=$F(jc.cross(UR),"v_bitangentLocal").normalize().toVar("bitangentLocal"),Wre=We(({subBuildFn:n,geometry:e,material:t})=>{let i;return n==="VERTEX"||e.hasAttribute("tangent")?i=$F(Ur.cross(KF),"v_bitangentView").normalize():i=D5e,t.flatShading!==!0&&(i=uA(i)),i},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),F5e=$F(t1.cross(Xre),"v_bitangentWorld").normalize().toVar("bitangentWorld"),Cx=Yl(KF,Wre,Ur).toVar("TBNViewMatrix"),Zre=Cs.mul(Cx),L5e=(n,e)=>n.sub(Zre.mul(e)),jre=We(()=>{let n=Ox.cross(Cs);return n=n.cross(Ox).normalize(),n=vr(n,Ur,Gy.mul(Qp.oneMinus()).oneMinus().pow2().pow2()).normalize(),n}).once()(),Yre=n=>Dn(n).mul(.5).add(.5),I5e=n=>Dn(n).mul(2).sub(1),fk=n=>Ge(n,vu(VF(ge(1).sub(Ud(n,n)))));class Kre extends Ca{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Fd,this.unpackNormalMode=ow}setup({material:e}){const{normalMapType:t,scaleNode:i,unpackNormalMode:r}=this;let s=this.node.mul(2).sub(1);if(t===Fd?r===Y2?s=fk(s.xy):r===_9?s=fk(s.yw):r!==ow&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${r}`):r!==ow&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${r}'`),i!==null){let o=i;e.flatShading===!0&&(o=uA(o)),s=Ge(s.xy.mul(o),s.z)}let a=null;return t===j2?a=w4(s):t===Fd?a=Cx.mul(s).normalize():(Tt(`NodeMaterial: Unsupported normal map type: ${t}`),a=Ur),a}}const pk=Ri(Kre).setParameterLength(1,2),G5e=We(({textureNode:n,bumpScale:e})=>{const t=r=>n.isolate().context({getUV:s=>r(s.uvNode||_s()),forceUVContext:!0}),i=ge(t(r=>r));return nn(ge(t(r=>r.add(r.dFdx()))).sub(i),ge(t(r=>r.add(r.dFdy()))).sub(i)).mul(e)}),O5e=We(n=>{const{surf_pos:e,surf_norm:t,dHdxy:i}=n,r=e.dFdx().normalize(),s=e.dFdy().normalize(),a=t,o=s.cross(a),l=a.cross(r),u=r.dot(o).mul(C4),c=u.sign().mul(i.x.mul(o).add(i.y.mul(l)));return u.abs().mul(t).sub(c).normalize()});class $re extends Ca{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=G5e({textureNode:this.textureNode,bumpScale:e});return O5e({surf_pos:co,surf_norm:Ur,dHdxy:t})}}const P4=Ri($re).setParameterLength(1,2),vj=new Map;class Lt extends Wn{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let i=vj.get(e);return i===void 0&&(i=Wg(e,t),vj.set(e,i)),i}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,i=this.scope;let r=null;if(i===Lt.COLOR){const s=t.color!==void 0?this.getColor(i):Ge();t.map&&t.map.isTexture===!0?r=s.mul(this.getTexture("map")):r=s}else if(i===Lt.OPACITY){const s=this.getFloat(i);t.alphaMap&&t.alphaMap.isTexture===!0?r=s.mul(this.getTexture("alpha")):r=s}else if(i===Lt.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=ge(1);else if(i===Lt.SPECULAR_INTENSITY){const s=this.getFloat(i);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=s.mul(this.getTexture(i).a):r=s}else if(i===Lt.SPECULAR_COLOR){const s=this.getColor(i);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=s.mul(this.getTexture(i).rgb):r=s}else if(i===Lt.ROUGHNESS){const s=this.getFloat(i);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).g):r=s}else if(i===Lt.METALNESS){const s=this.getFloat(i);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=s.mul(this.getTexture(i).b):r=s}else if(i===Lt.EMISSIVE){const s=this.getFloat("emissiveIntensity"),a=this.getColor(i).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=a.mul(this.getTexture(i)):r=a}else if(i===Lt.NORMAL)t.normalMap?(r=pk(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType,(t.normalMap.format==_l||t.normalMap.format==f0||t.normalMap.format==d0)&&(r.unpackNormalMode=Y2)):t.bumpMap?r=P4(this.getTexture("bump").r,this.getFloat("bumpScale")):r=Ur;else if(i===Lt.CLEARCOAT){const s=this.getFloat(i);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=s.mul(this.getTexture(i).r):r=s}else if(i===Lt.CLEARCOAT_ROUGHNESS){const s=this.getFloat(i);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).r):r=s}else if(i===Lt.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=pk(this.getTexture(i),this.getCache(i+"Scale","vec2")):r=Ur;else if(i===Lt.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=s.mul(this.getTexture("sheenColor").rgb):r=s}else if(i===Lt.SHEEN_ROUGHNESS){const s=this.getFloat(i);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(i).a):r=s,r=r.clamp(1e-4,1)}else if(i===Lt.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(i);r=LF(IS.x,IS.y,IS.y.negate(),IS.x).mul(s.rg.mul(2).sub(nn(1)).normalize().mul(s.b))}else r=IS;else if(i===Lt.IRIDESCENCE_THICKNESS){const s=Es("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const a=Es("0","float",t.iridescenceThicknessRange);r=s.sub(a).mul(this.getTexture(i).g).add(a)}else r=s}else if(i===Lt.TRANSMISSION){const s=this.getFloat(i);t.transmissionMap?r=s.mul(this.getTexture(i).r):r=s}else if(i===Lt.THICKNESS){const s=this.getFloat(i);t.thicknessMap?r=s.mul(this.getTexture(i).g):r=s}else if(i===Lt.IOR)r=this.getFloat(i);else if(i===Lt.LIGHT_MAP)r=this.getTexture(i).rgb.mul(this.getFloat("lightMapIntensity"));else if(i===Lt.AO)r=this.getTexture(i).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(i===Lt.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(i):ge(0);else{const s=this.getNodeType(e);r=this.getCache(i,s)}return r}}Lt.ALPHA_TEST="alphaTest";Lt.COLOR="color";Lt.OPACITY="opacity";Lt.SHININESS="shininess";Lt.SPECULAR="specular";Lt.SPECULAR_STRENGTH="specularStrength";Lt.SPECULAR_INTENSITY="specularIntensity";Lt.SPECULAR_COLOR="specularColor";Lt.REFLECTIVITY="reflectivity";Lt.ROUGHNESS="roughness";Lt.METALNESS="metalness";Lt.NORMAL="normal";Lt.CLEARCOAT="clearcoat";Lt.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Lt.CLEARCOAT_NORMAL="clearcoatNormal";Lt.EMISSIVE="emissive";Lt.ROTATION="rotation";Lt.SHEEN="sheen";Lt.SHEEN_ROUGHNESS="sheenRoughness";Lt.ANISOTROPY="anisotropy";Lt.IRIDESCENCE="iridescence";Lt.IRIDESCENCE_IOR="iridescenceIOR";Lt.IRIDESCENCE_THICKNESS="iridescenceThickness";Lt.IOR="ior";Lt.TRANSMISSION="transmission";Lt.THICKNESS="thickness";Lt.ATTENUATION_DISTANCE="attenuationDistance";Lt.ATTENUATION_COLOR="attenuationColor";Lt.LINE_SCALE="scale";Lt.LINE_DASH_SIZE="dashSize";Lt.LINE_GAP_SIZE="gapSize";Lt.LINE_WIDTH="linewidth";Lt.LINE_DASH_OFFSET="dashOffset";Lt.POINT_SIZE="size";Lt.DISPERSION="dispersion";Lt.LIGHT_MAP="light";Lt.AO="ao";const Jre=En(Lt,Lt.ALPHA_TEST),jB=En(Lt,Lt.COLOR),qre=En(Lt,Lt.SHININESS),Qre=En(Lt,Lt.EMISSIVE),JF=En(Lt,Lt.OPACITY),ese=En(Lt,Lt.SPECULAR),mk=En(Lt,Lt.SPECULAR_INTENSITY),tse=En(Lt,Lt.SPECULAR_COLOR),vw=En(Lt,Lt.SPECULAR_STRENGTH),WN=En(Lt,Lt.REFLECTIVITY),nse=En(Lt,Lt.ROUGHNESS),ise=En(Lt,Lt.METALNESS),rse=En(Lt,Lt.NORMAL),sse=En(Lt,Lt.CLEARCOAT),ase=En(Lt,Lt.CLEARCOAT_ROUGHNESS),ose=En(Lt,Lt.CLEARCOAT_NORMAL),lse=En(Lt,Lt.ROTATION),use=En(Lt,Lt.SHEEN),cse=En(Lt,Lt.SHEEN_ROUGHNESS),hse=En(Lt,Lt.ANISOTROPY),dse=En(Lt,Lt.IRIDESCENCE),fse=En(Lt,Lt.IRIDESCENCE_IOR),pse=En(Lt,Lt.IRIDESCENCE_THICKNESS),mse=En(Lt,Lt.TRANSMISSION),gse=En(Lt,Lt.THICKNESS),yse=En(Lt,Lt.IOR),vse=En(Lt,Lt.ATTENUATION_DISTANCE),xse=En(Lt,Lt.ATTENUATION_COLOR),D4=En(Lt,Lt.LINE_SCALE),N4=En(Lt,Lt.LINE_DASH_SIZE),B4=En(Lt,Lt.LINE_GAP_SIZE),ZN=En(Lt,Lt.LINE_WIDTH),F4=En(Lt,Lt.LINE_DASH_OFFSET),bse=En(Lt,Lt.POINT_SIZE),_se=En(Lt,Lt.DISPERSION),L4=En(Lt,Lt.LIGHT_MAP),Sse=En(Lt,Lt.AO),IS=Qn(new rt).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),Mse=We(n=>n.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Ase extends Qv{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const i=this.storageBufferNode.structTypeNode;return i?i.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let i;const r=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&r!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?i=e.generatePBO(this):i=this.node.build(e):i=super.generate(e),r!==!0){const s=this.getNodeType(e);i=e.format(i,s,t)}return i}}const U5e=Ri(Ase).setParameterLength(2);class Tse extends ZF{static get type(){return"StorageBufferNode"}constructor(e,t=null,i=0){let r,s=null;t&&t.isStruct?(r="struct",s=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(i=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(r=AV(e.itemSize),i=e.count):r=t,super(e,r,i),this.isStorageBufferNode=!0,this.structTypeNode=s,this.access=Ml.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return U5e(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(Ml.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=m4(this.value),this._varying=Gm(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:i}=this.getAttributeData(),r=i.build(e);return e.registerTransform(r,t),r}}const n0=(n,e=null,t=0)=>new Tse(n,e,t),k5e=(n,e,t)=>(mt('TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),n0(n,e,t).setPBO(!0));class aa extends Wn{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),i=this.scope;let r;if(i===aa.VERTEX)r=e.getVertexIndex();else if(i===aa.INSTANCE)r=e.getInstanceIndex();else if(i===aa.DRAW)r=e.getDrawIndex();else if(i===aa.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(i===aa.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(i===aa.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+i);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=r:s=Gm(this).build(e,t),s}}aa.VERTEX="vertex";aa.INSTANCE="instance";aa.SUBGROUP="subgroup";aa.INVOCATION_LOCAL="invocationLocal";aa.INVOCATION_SUBGROUP="invocationSubgroup";aa.DRAW="draw";const Cse=En(aa,aa.VERTEX),mm=En(aa,aa.INSTANCE),z5e=En(aa,aa.SUBGROUP),V5e=En(aa,aa.INVOCATION_SUBGROUP),H5e=En(aa,aa.INVOCATION_LOCAL),wse=En(aa,aa.DRAW);class I4 extends Wn{static get type(){return"InstanceNode"}constructor(e,t,i=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=i,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Ni.FRAME,this.buffer=null,this.bufferColor=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}setup(e){const{instanceMatrix:t,instanceColor:i,isStorageMatrix:r,isStorageColor:s}=this,{count:a}=t;let{instanceMatrixNode:o,instanceColorNode:l}=this;if(o===null){if(r)o=n0(t,"mat4",Math.max(a,1)).element(mm);else if(a<=1e3)o=GR(t.array,"mat4",Math.max(a,1)).element(mm);else{const c=new pV(t.array,16,1);this.buffer=c;const d=t.usage===bh?ok:WB,f=[d(c,"vec4",16,0),d(c,"vec4",16,4),d(c,"vec4",16,8),d(c,"vec4",16,12)];o=rv(...f)}this.instanceMatrixNode=o}if(i&&l===null){if(s)l=n0(i,"vec3",Math.max(i.count,1)).element(mm);else{const c=new Vc(i.array,3),d=i.usage===bh?ok:WB;this.bufferColor=c,l=Ge(d(c,"vec3",3,0))}this.instanceColorNode=l}const u=o.mul(Ia).xyz;if(Ia.assign(u),e.hasGeometryAttribute("normal")){const c=Ere(jc,o);jc.assign(c)}this.instanceColorNode!==null&&fh("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==bh&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==bh&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}const X5e=Ri(I4).setParameterLength(2,3);class Ese extends I4{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:i,instanceColor:r}=e;super(t,i,r),this.instancedMesh=e}}const Rse=Ri(Ese).setParameterLength(1);class Pse extends Wn{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=mm:this.batchingIdNode=wse);const i=We(([y])=>{const _=Le(e0($a(this.batchMesh._indirectTexture),0).x).toConst(),S=Le(y).mod(_).toConst(),b=Le(y).div(_).toConst();return $a(this.batchMesh._indirectTexture,ko(S,b)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Le(this.batchingIdNode)),r=this.batchMesh._matricesTexture,s=Le(e0($a(r),0).x).toConst(),a=ge(i).mul(4).toInt().toConst(),o=a.mod(s).toConst(),l=a.div(s).toConst(),u=rv($a(r,ko(o,l)),$a(r,ko(o.add(1),l)),$a(r,ko(o.add(2),l)),$a(r,ko(o.add(3),l))),c=this.batchMesh._colorsTexture;if(c!==null){const _=We(([S])=>{const b=Le(e0($a(c),0).x).toConst(),M=S,w=M.mod(b).toConst(),T=M.div(b).toConst();return $a(c,ko(w,T)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(i);fh("vec3","vBatchColor").assign(_)}const d=Yl(u);Ia.assign(u.mul(Ia));const f=jc.div(Ge(d[0].dot(d[0]),d[1].dot(d[1]),d[2].dot(d[2]))),m=d.mul(f).xyz;jc.assign(m),e.hasGeometryAttribute("tangent")&&UR.mulAssign(d)}}const Dse=Ri(Pse).setParameterLength(1),xj=new WeakMap;class G4 extends Wn{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Ni.OBJECT,this.skinIndexNode=Zu("skinIndex","uvec4"),this.skinWeightNode=Zu("skinWeight","vec4"),this.bindMatrixNode=Es("bindMatrix","mat4"),this.bindMatrixInverseNode=Es("bindMatrixInverse","mat4"),this.boneMatricesNode=ck("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Ia,this.toPositionNode=Ia,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:i,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:a}=this,o=e.element(i.x),l=e.element(i.y),u=e.element(i.z),c=e.element(i.w),d=s.mul(t),f=Eo(o.mul(r.x).mul(d),l.mul(r.y).mul(d),u.mul(r.z).mul(d),c.mul(r.w).mul(d));return a.mul(f).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=jc){const{skinIndexNode:i,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:a}=this,o=e.element(i.x),l=e.element(i.y),u=e.element(i.z),c=e.element(i.w);let d=Eo(r.x.mul(o),r.y.mul(l),r.z.mul(u),r.w.mul(c));return d=a.mul(d).mul(s),d.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=ck("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,ZB)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||CV(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&ZB.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const i=this.getSkinnedNormal();jc.assign(i),e.hasGeometryAttribute("tangent")&&UR.assign(i)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;xj.get(t)!==e.frameId&&(xj.set(t,e.frameId),this.previousBoneMatricesNode!==null&&(t.previousBoneMatrices===null&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}}const Nse=n=>new G4(n),W5e=(n,e=null)=>{const t=new G4(n);return t.positionNode=n0(new Vc(n.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(mm).toVar(),t.skinIndexNode=n0(new Vc(new Uint32Array(n.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(mm).toVar(),t.skinWeightNode=n0(new Vc(n.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(mm).toVar(),t.bindMatrixNode=Qn(n.bindMatrix,"mat4"),t.bindMatrixInverseNode=Qn(n.bindMatrixInverse,"mat4"),t.boneMatricesNode=GR(n.skeleton.boneMatrices,"mat4",n.skeleton.bones.length),t.toPositionNode=e,Dn(t)};class Bse extends Wn{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const i={};for(let o=0,l=this.params.length-1;o<l;o++){const u=this.params[o],c=u.isNode!==!0&&u.name||this.getVarName(o),d=u.isNode!==!0&&u.type||"int";i[c]=g0(c,d)}const r=e.addStack(),s=this.params[this.params.length-1](i);t.returnsNode=s.context({nodeLoop:s}),t.stackNode=r;const a=this.params[0];if(a.isNode!==!0&&typeof a.update=="function"){const o=We(this.params[0].update)(i);t.updateNode=o.context({nodeLoop:o})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),i=this.params,r=t.stackNode;for(let a=0,o=i.length-1;a<o;a++){const l=i[a];let u=!1,c=null,d=null,f=null,m=null,y=null,_=null;l.isNode?l.getNodeType(e)==="bool"?(u=!0,m="bool",d=l.build(e,m)):(m="int",f=this.getVarName(a),c="0",d=l.build(e,m),y="<"):(m=l.type||"int",f=l.name||this.getVarName(a),c=l.start,d=l.end,y=l.condition,_=l.update,typeof c=="number"?c=e.generateConst(m,c):c&&c.isNode&&(c=c.build(e,m)),typeof d=="number"?d=e.generateConst(m,d):d&&d.isNode&&(d=d.build(e,m)),c!==void 0&&d===void 0?(c=c+" - 1",d="0",y=">="):d!==void 0&&c===void 0&&(c="0",y="<"),y===void 0&&(Number(c)>Number(d)?y=">=":y="<"));let S;if(u)S=`while ( ${d} )`;else{const b={start:c,end:d},M=b.start,w=b.end;let T;const E=()=>y.includes("<")?"+=":"-=";if(_!=null)switch(typeof _){case"function":T=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":T=f+" "+E()+" "+e.generateConst(m,_);break;case"string":T=f+" "+_;break;default:_.isNode?T=f+" "+E()+" "+_.build(e):(Tt("TSL: 'Loop( { update: ... } )' is not a function, string or number."),T="break /* invalid update */")}else m==="int"||m==="uint"?_=y.includes("<")?"++":"--":_=E()+" 1.",T=f+" "+_;const R=e.getVar(m,f)+" = "+M,P=f+" "+y+" "+w;S=`for ( ${R}; ${P}; ${T} )`}e.addFlowCode((a===0?`
`:"")+e.tab+S+` {

`).addFlowTab()}const s=r.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let a=0,o=this.params.length-1;a<o;a++)e.addFlowCode((a===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const fs=(...n)=>new Bse(Gx(n,"int")).toStack(),Z5e=()=>g0("continue").toStack(),Fse=()=>g0("break").toStack(),AO=new WeakMap,uh=new si,bj=We(({bufferMap:n,influence:e,stride:t,width:i,depth:r,offset:s})=>{const a=Le(Cse).mul(t).add(s),o=a.div(i),l=a.sub(o.mul(i));return $a(n,ko(l,o)).depth(r).xyz.mul(e)});function j5e(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,i=n.morphAttributes.color!==void 0,r=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,s=r!==void 0?r.length:0;let a=AO.get(n);if(a===void 0||a.count!==s){let b=function(){_.dispose(),AO.delete(n),n.removeEventListener("dispose",b)};a!==void 0&&a.texture.dispose();const o=n.morphAttributes.position||[],l=n.morphAttributes.normal||[],u=n.morphAttributes.color||[];let c=0;e===!0&&(c=1),t===!0&&(c=2),i===!0&&(c=3);let d=n.attributes.position.count*c,f=1;const m=4096;d>m&&(f=Math.ceil(d/m),d=m);const y=new Float32Array(d*f*4*s),_=new ZM(y,d,f,s);_.type=wr,_.needsUpdate=!0;const S=c*4;for(let M=0;M<s;M++){const w=o[M],T=l[M],E=u[M],R=d*f*4*M;for(let P=0;P<w.count;P++){const I=P*S;e===!0&&(uh.fromBufferAttribute(w,P),y[R+I+0]=uh.x,y[R+I+1]=uh.y,y[R+I+2]=uh.z,y[R+I+3]=0),t===!0&&(uh.fromBufferAttribute(T,P),y[R+I+4]=uh.x,y[R+I+5]=uh.y,y[R+I+6]=uh.z,y[R+I+7]=0),i===!0&&(uh.fromBufferAttribute(E,P),y[R+I+8]=uh.x,y[R+I+9]=uh.y,y[R+I+10]=uh.z,y[R+I+11]=E.itemSize===4?uh.w:1)}}a={count:s,texture:_,stride:c,size:new rt(d,f)},AO.set(n,a),n.addEventListener("dispose",b)}return a}class Lse extends Wn{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Qn(1),this.updateType=Ni.OBJECT}setup(e){const{geometry:t}=e,i=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=s!==void 0?s.length:0,{texture:o,stride:l,size:u}=j5e(t);i===!0&&Ia.mulAssign(this.morphBaseInfluence),r===!0&&jc.mulAssign(this.morphBaseInfluence);const c=Le(u.width);fs(a,({i:d})=>{const f=ge(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?f.assign($a(this.mesh.morphTexture,ko(Le(d).add(1),Le(mm))).r):f.assign(Es("morphTargetInfluences","float").element(d).toVar()),Kn(f.notEqual(0),()=>{i===!0&&Ia.addAssign(bj({bufferMap:o,influence:f,stride:l,width:c,depth:d,offset:Le(0)})),r===!0&&jc.addAssign(bj({bufferMap:o,influence:f,stride:l,width:c,depth:d,offset:Le(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,i)=>t+i,0)}}const Ise=Ri(Lse).setParameterLength(1);class Gb extends Wn{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class Gse extends Gb{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class Ose extends h4{static get type(){return"LightingContextNode"}constructor(e,t=null,i=null,r=null){super(e),this.lightingModel=t,this.backdropNode=i,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,i=Ge().toVar("directDiffuse"),r=Ge().toVar("directSpecular"),s=Ge().toVar("indirectDiffuse"),a=Ge().toVar("indirectSpecular"),o={directDiffuse:i,directSpecular:r,indirectDiffuse:s,indirectSpecular:a};return{radiance:Ge().toVar("radiance"),irradiance:Ge().toVar("irradiance"),iblIrradiance:Ge().toVar("iblIrradiance"),ambientOcclusion:ge(1).toVar("ambientOcclusion"),reflectedLight:o,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Use=Ri(Ose);class kse extends Gb{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const uS=new rt;class kR extends $f{static get type(){return"ViewportTextureNode"}constructor(e=t0,t=null,i=null){let r=null;i===null?(r=new pR,r.minFilter=Vo,i=r):r=i,super(i,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=r,this.isOutputTextureNode=!0,this.updateBeforeType=Ni.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,i;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,i=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,i=this._cacheTextures),e===null)return t;if(i.has(e)===!1){const r=t.clone();i.set(e,r)}return i.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,i=t.getRenderTarget();i===null?t.getDrawingBufferSize(uS):uS.set(i.width,i.height);const r=this.getTextureForReference(i);(r.image.width!==uS.width||r.image.height!==uS.height)&&(r.image.width=uS.width,r.image.height=uS.height,r.needsUpdate=!0);const s=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(r),r.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const Y5e=Ri(kR).setParameterLength(0,3),O4=Ri(kR,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let MD=null;class zse extends kR{static get type(){return"ViewportDepthTextureNode"}constructor(e=t0,t=null){MD===null&&(MD=new po),super(e,t,MD)}getTextureForReference(){return MD}}const U4=Ri(zse).setParameterLength(0,2);class qu extends Wn{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===qu.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,i=this.valueNode;let r=null;if(t===qu.DEPTH_BASE)i!==null&&(r=Vse().assign(i));else if(t===qu.DEPTH)e.isPerspectiveCamera?r=k4(co.z,Hg,Xg):r=iM(co.z,Hg,Xg);else if(t===qu.LINEAR_DEPTH)if(i!==null)if(e.isPerspectiveCamera){const s=z4(i,Hg,Xg);r=iM(s,Hg,Xg)}else r=i;else r=iM(co.z,Hg,Xg);return r}}qu.DEPTH_BASE="depthBase";qu.DEPTH="depth";qu.LINEAR_DEPTH="linearDepth";const iM=(n,e,t)=>n.add(e).div(e.sub(t)),K5e=(n,e,t)=>e.sub(t).mul(n).sub(e),k4=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),z4=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),V4=(n,e,t)=>{e=e.max(1e-6).toVar();const i=dm(n.negate().div(e)),r=dm(t.div(e));return i.div(r)},$5e=(n,e,t)=>{const i=n.mul(OF(t.div(e)));return ge(Math.E).pow(i).mul(e).negate()},Vse=Ri(qu,qu.DEPTH_BASE),H4=En(qu,qu.DEPTH),AM=Ri(qu,qu.LINEAR_DEPTH).setParameterLength(0,1),J5e=AM(U4());H4.assign=n=>Vse(n);class Ld extends Wn{static get type(){return"ClippingNode"}constructor(e=Ld.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:i,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Ld.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(i,r):this.scope===Ld.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(i,r)}setupAlphaToCoverage(e,t){return We(()=>{const i=ge().toVar("distanceToPlane"),r=ge().toVar("distanceToGradient"),s=ge(1).toVar("clipOpacity"),a=t.length;if(this.hardwareClipping===!1&&a>0){const l=gu(t).setGroup(ti);fs(a,({i:u})=>{const c=l.element(u);i.assign(co.dot(c.xyz).negate().add(c.w)),r.assign(i.fwidth().div(2)),s.mulAssign(Rh(r.negate(),r,i))})}const o=e.length;if(o>0){const l=gu(e).setGroup(ti),u=ge(1).toVar("intersectionClipOpacity");fs(o,({i:c})=>{const d=l.element(c);i.assign(co.dot(d.xyz).negate().add(d.w)),r.assign(i.fwidth().div(2)),u.mulAssign(Rh(r.negate(),r,i).oneMinus())}),s.mulAssign(u.oneMinus())}xs.a.mulAssign(s),xs.a.equal(0).discard()})()}setupDefault(e,t){return We(()=>{const i=t.length;if(this.hardwareClipping===!1&&i>0){const s=gu(t).setGroup(ti);fs(i,({i:a})=>{const o=s.element(a);co.dot(o.xyz).greaterThan(o.w).discard()})}const r=e.length;if(r>0){const s=gu(e).setGroup(ti),a=Od(!0).toVar("clipped");fs(r,({i:o})=>{const l=s.element(o);a.assign(co.dot(l.xyz).greaterThan(l.w).and(a))}),a.discard()}})()}setupHardwareClipping(e,t){const i=e.length;return t.enableHardwareClipping(i),We(()=>{const r=gu(e).setGroup(ti),s=R0(t.getClipDistance());fs(i,({i:a})=>{const o=r.element(a),l=co.dot(o.xyz).sub(o.w).negate();s.element(a).assign(l)})})()}}Ld.ALPHA_TO_COVERAGE="alphaToCoverage";Ld.DEFAULT="default";Ld.HARDWARE="hardware";const q5e=()=>new Ld,Q5e=()=>new Ld(Ld.ALPHA_TO_COVERAGE),eke=()=>new Ld(Ld.HARDWARE),tke=.05,_j=We(([n])=>Yf(Ci(1e4,Wu(Ci(17,n.x).add(Ci(.1,n.y)))).mul(Eo(.1,zs(Wu(Ci(13,n.y).add(n.x))))))),Sj=We(([n])=>_j(nn(_j(n.xy),n.z))),nke=We(([n])=>{const e=ka(pm(n4(n.xyz)),pm(i4(n.xyz))),t=ge(1).div(ge(tke).mul(e)).toVar("pixScale"),i=nn(SM(fm(dm(t))),SM(UF(dm(t)))),r=nn(Sj(fm(i.x.mul(n.xyz))),Sj(fm(i.y.mul(n.xyz)))),s=Yf(dm(t)),a=Eo(Ci(s.oneMinus(),r.x),Ci(s,r.y)),o=Zc(s,s.oneMinus()),l=Ge(a.mul(a).div(Ci(2,o).mul(Dr(1,o))),a.sub(Ci(.5,o)).div(Dr(1,o)),Dr(1,Dr(1,a).mul(Dr(1,a)).div(Ci(2,o).mul(Dr(1,o))))),u=a.lessThan(o.oneMinus()).select(a.lessThan(o).select(l.x,l.y),l.z);return Kf(u,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class Hse extends b4{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),i=e.hasGeometryAttribute(t);let r;return i===!0?r=super.generate(e):r=e.generateConst(this.nodeType,new si(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const Xse=(n=0)=>new Hse(n),Wse=We(([n,e])=>Zc(1,n.oneMinus().div(e)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Zse=We(([n,e])=>Zc(n.div(e.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),jse=We(([n,e])=>n.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Yse=We(([n,e])=>vr(n.mul(2).mul(e),n.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),zF(.5,n))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),ike=We(([n,e])=>{const t=e.a.add(n.a.mul(e.a.oneMinus()));return Un(e.rgb.mul(e.a).add(n.rgb.mul(n.a).mul(e.a.oneMinus())).div(t),t)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),Kse=We(([n])=>Un(n.rgb.mul(n.a),n.a),{color:"vec4",return:"vec4"}),rke=We(([n])=>(Kn(n.a.equal(0),()=>Un(0)),Un(n.rgb.div(n.a),n.a)),{color:"vec4",return:"vec4"}),ske=(...n)=>(mt('TSL: "burn" has been renamed. Use "blendBurn" instead.'),Wse(n)),ake=(...n)=>(mt('TSL: "dodge" has been renamed. Use "blendDodge" instead.'),Zse(n)),oke=(...n)=>(mt('TSL: "screen" has been renamed. Use "blendScreen" instead.'),jse(n)),lke=(...n)=>(mt('TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),Yse(n));class Js extends _a{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{mt('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const i=this[t];i&&i.isNode===!0&&e.push({property:t,childNode:i})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:i}of this._getNodeChildren())e.push(oA(t.slice(0,-4)),i.getCacheKey());return this.type+Fb(e)}build(e){this.setup(e)}setupObserver(e){return new wne(e)}setup(e){e.context.setupNormal=()=>eM(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,i=t.getRenderTarget();t.contextNode.isContextNode===!0?e.context={...e.context,...t.contextNode.getFlowContextData()}:Tt('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?e.context={...e.context,...this.contextNode.getFlowContextData()}:Tt('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const r=eM(this.setupVertex(e),"VERTEX"),s=this.vertexNode||r;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let a;const o=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(i!==null?i.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const l=this.setupLighting(e);o!==null&&e.stack.addToStack(o);const u=Un(l,xs.a).max(0);a=this.setupOutput(e,u),QS.assign(a);const c=this.outputNode!==null;if(c&&(a=this.outputNode),e.context.getOutput&&(a=e.context.getOutput(a,e)),i!==null){const d=t.getMRT(),f=this.mrtNode;d!==null?(c&&QS.assign(a),a=d,f!==null&&(a=d.merge(f))):f!==null&&(a=f)}}else{let l=this.fragmentNode;l.isOutputStructNode!==!0&&(l=Un(l)),a=this.setupOutput(e,l)}e.stack.outputNode=a,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:i}=e.clippingContext;let r=null;if(t.length>0||i.length>0){const s=e.renderer.currentSamples;this.alphaToCoverage&&s>1?r=Q5e():e.stack.addToStack(q5e())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(eke()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:i}=e;let r=this.depthNode;if(r===null){const s=t.getMRT();s&&s.has("depth")?r=s.get("depth"):t.logarithmicDepthBuffer===!0&&(i.isPerspectiveCamera?r=V4(co.z,Hg,Xg):r=iM(co.z,Hg,Xg))}r!==null&&H4.assign(r).toStack()}setupPositionView(){return wm.mul(Ia).xyz}setupModelViewProjection(){return ju.mul(co)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),Mse}setupPosition(e){const{object:t,geometry:i}=e;if((i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color)&&Ise(t).toStack(),t.isSkinnedMesh===!0&&Nse(t).toStack(),this.displacementMap){const r=Wg("displacementMap","texture"),s=Wg("displacementScale","float"),a=Wg("displacementBias","float");Ia.addAssign(jc.normalize().mul(r.x.mul(s).add(a)))}return t.isBatchedMesh&&Dse(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&Rse(t).toStack(),this.positionNode!==null&&Ia.assign(eM(this.positionNode,"POSITION","vec3")),Ia}setupDiffuseColor(e){const{object:t,geometry:i}=e;this.maskNode!==null&&Od(this.maskNode).not().discard();let r=this.colorNode?Un(this.colorNode):jB;this.vertexColors===!0&&i.hasAttribute("color")&&(r=r.mul(Xse())),t.instanceColor&&(r=fh("vec3","vInstanceColor").mul(r)),t.isBatchedMesh&&t._colorsTexture&&(r=fh("vec3","vBatchColor").mul(r)),xs.assign(r);const s=this.opacityNode?ge(this.opacityNode):JF;xs.a.assign(xs.a.mul(s));let a=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(a=this.alphaTestNode!==null?ge(this.alphaTestNode):Jre,this.alphaToCoverage===!0?(xs.a=Rh(a,a.add(s4(xs.a)),xs.a),xs.a.lessThanEqual(0).discard()):xs.a.lessThanEqual(a).discard()),this.alphaHash===!0&&xs.a.lessThan(nke(Ia)).discard(),e.isOpaque()&&xs.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Ge(0):xs.rgb}setupNormal(){return this.normalNode?Ge(this.normalNode):rse}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Wg("envMap","cubeTexture"):Wg("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new kse(L4)),t}setupLights(e){const t=[],i=this.setupEnvironment(e);i&&i.isLightingNode&&t.push(i);const r=this.setupLightMap(e);r&&r.isLightingNode&&t.push(r);let s=this.aoNode;s===null&&e.material.aoMap&&(s=Sse),e.context.getAO&&(s=e.context.getAO(s,e)),s&&t.push(new Gse(s));let a=this.lightsNode||e.lightsNode;return t.length>0&&(a=e.renderer.lighting.createNode([...a.getLights(),...t])),a}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:i,backdropAlphaNode:r,emissiveNode:s}=this,o=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(o&&o.getScope().hasLights){const u=this.setupLightingModel(e)||null;l=Use(o,u,i,r)}else i!==null&&(l=Ge(r!==null?vr(l,i,r):i));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(sk.assign(Ge(s||Qre)),l=l.add(sk)),l}setupFog(e,t){const i=e.fogNode;return i&&(QS.assign(t),t=Un(i.toVar())),t}setupPremultipliedAlpha(e,t){return Kse(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const i in e){const r=e[i];this[i]===void 0&&(this[i]=r,r&&r.clone&&(this[i]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const i in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,i)===void 0&&t[i].get!==void 0&&Object.defineProperty(this.constructor.prototype,i,t[i])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const i=_a.prototype.toJSON.call(this,e);i.inputNodes={};for(const{property:s,childNode:a}of this._getNodeChildren())i.inputNodes[s]=a.toJSON(e).uuid;function r(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(t){const s=r(e.textures),a=r(e.images),o=r(e.nodes);s.length>0&&(i.textures=s),a.length>0&&(i.images=a),o.length>0&&(i.nodes=o)}return i}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}}const uke=new El;class $se extends Js{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(uke),this.setValues(e)}}const cke=new RR;class Jse extends Js{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(cke),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?ge(this.offsetNode):F4,t=this.dashScaleNode?ge(this.dashScaleNode):D4,i=this.dashSizeNode?ge(this.dashSizeNode):N4,r=this.gapSizeNode?ge(this.gapSizeNode):B4;Ux.assign(i),nE.assign(r);const s=Gm(Zu("lineDistance").mul(t));(e?s.add(e):s).mod(Ux.add(nE)).greaterThan(Ux).discard()}}let AD=null;class qse extends kR{static get type(){return"ViewportSharedTextureNode"}constructor(e=t0,t=null){AD===null&&(AD=new pR),super(e,t,AD)}getTextureForReference(){return AD}updateReference(){return this}}const Qse=Ri(qse).setParameterLength(0,2),hke=new RR;class dke extends Js{static get type(){return"Line2NodeMaterial"}constructor(e={}){super(),this.isLine2NodeMaterial=!0,this.setDefaultValues(hke),this.useColor=e.vertexColors,this.dashOffset=0,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.blending=Oa,this._useDash=e.dashed,this._useAlphaToCoverage=!0,this._useWorldUnits=!1,this.setValues(e)}setup(e){const{renderer:t}=e,i=this._useAlphaToCoverage,r=this.useColor,s=this._useDash,a=this._useWorldUnits,o=We(({start:u,end:c})=>{const d=ju.element(2).element(2),y=ju.element(3).element(2).mul(-.5).div(d).sub(u.z).div(c.z.sub(u.z));return Un(vr(u.xyz,c.xyz,y),c.w)}).setLayout({name:"trimSegment",type:"vec4",inputs:[{name:"start",type:"vec4"},{name:"end",type:"vec4"}]});this.vertexNode=We(()=>{const u=Zu("instanceStart"),c=Zu("instanceEnd"),d=Un(wm.mul(Un(u,1))).toVar("start"),f=Un(wm.mul(Un(c,1))).toVar("end");if(s){const E=this.dashScaleNode?ge(this.dashScaleNode):D4,R=this.offsetNode?ge(this.offsetNode):F4,P=Zu("instanceDistanceStart"),I=Zu("instanceDistanceEnd");let B=Hl.y.lessThan(.5).select(E.mul(P),E.mul(I));B=B.add(R),fh("float","lineDistance").assign(B)}a&&(fh("vec3","worldStart").assign(d.xyz),fh("vec3","worldEnd").assign(f.xyz));const m=nM.z.div(nM.w),y=ju.element(2).element(3).equal(-1);Kn(y,()=>{Kn(d.z.lessThan(0).and(f.z.greaterThan(0)),()=>{f.assign(o({start:d,end:f}))}).ElseIf(f.z.lessThan(0).and(d.z.greaterThanEqual(0)),()=>{d.assign(o({start:f,end:d}))})});const _=ju.mul(d),S=ju.mul(f),b=_.xyz.div(_.w),M=S.xyz.div(S.w),w=M.xy.sub(b.xy).toVar();w.x.assign(w.x.mul(m)),w.assign(w.normalize());const T=Un().toVar();if(a){const E=f.xyz.sub(d.xyz).normalize(),R=vr(d.xyz,f.xyz,.5).normalize(),P=E.cross(R).normalize(),I=E.cross(P),B=fh("vec4","worldPos");B.assign(Hl.y.lessThan(.5).select(d,f));const N=ZN.mul(.5);B.addAssign(Un(Hl.x.lessThan(0).select(P.mul(N),P.mul(N).negate()),0)),s||(B.addAssign(Un(Hl.y.lessThan(.5).select(E.mul(N).negate(),E.mul(N)),0)),B.addAssign(Un(I.mul(N),0)),Kn(Hl.y.greaterThan(1).or(Hl.y.lessThan(0)),()=>{B.subAssign(Un(I.mul(2).mul(N),0))})),T.assign(ju.mul(B));const U=Ge().toVar();U.assign(Hl.y.lessThan(.5).select(b,M)),T.z.assign(U.z.mul(T.w))}else{const E=nn(w.y,w.x.negate()).toVar("offset");w.x.assign(w.x.div(m)),E.x.assign(E.x.div(m)),E.assign(Hl.x.lessThan(0).select(E.negate(),E)),Kn(Hl.y.lessThan(0),()=>{E.assign(E.sub(w))}).ElseIf(Hl.y.greaterThan(1),()=>{E.assign(E.add(w))}),E.assign(E.mul(ZN)),E.assign(E.div(nM.w.div(M4))),T.assign(Hl.y.lessThan(.5).select(_,S)),E.assign(E.mul(T.w)),T.assign(T.add(Un(E,0,0)))}return T})();const l=We(({p1:u,p2:c,p3:d,p4:f})=>{const m=u.sub(d),y=f.sub(d),_=c.sub(u),S=m.dot(y),b=y.dot(_),M=m.dot(_),w=y.dot(y),E=_.dot(_).mul(w).sub(b.mul(b)),P=S.mul(b).sub(M.mul(w)).div(E).clamp(),I=S.add(b.mul(P)).div(w).clamp();return nn(P,I)});if(this.colorNode=We(()=>{const u=_s();if(s){const f=this.dashSizeNode?ge(this.dashSizeNode):N4,m=this.gapSizeNode?ge(this.gapSizeNode):B4;Ux.assign(f),nE.assign(m);const y=fh("float","lineDistance");u.y.lessThan(-1).or(u.y.greaterThan(1)).discard(),y.mod(Ux.add(nE)).greaterThan(Ux).discard()}const c=ge(1).toVar("alpha");if(a){const f=fh("vec3","worldStart"),m=fh("vec3","worldEnd"),y=fh("vec4","worldPos").xyz.normalize().mul(1e5),_=m.sub(f),S=l({p1:f,p2:m,p3:Ge(0,0,0),p4:y}),b=f.add(_.mul(S.x)),M=y.mul(S.y),E=b.sub(M).length().div(ZN);if(!s)if(i&&t.currentSamples>0){const R=E.fwidth();c.assign(Rh(R.negate().add(.5),R.add(.5),E).oneMinus())}else E.greaterThan(.5).discard()}else if(i&&t.currentSamples>0){const f=u.x,m=u.y.greaterThan(0).select(u.y.sub(1),u.y.add(1)),y=f.mul(f).add(m.mul(m)),_=ge(y.fwidth()).toVar("dlen");Kn(u.y.abs().greaterThan(1),()=>{c.assign(Rh(_.oneMinus(),_.add(1),y).oneMinus())})}else Kn(u.y.abs().greaterThan(1),()=>{const f=u.x,m=u.y.greaterThan(0).select(u.y.sub(1),u.y.add(1));f.mul(f).add(m.mul(m)).greaterThan(1).discard()});let d;if(this.lineColorNode)d=this.lineColorNode;else if(r){const f=Zu("instanceColorStart"),m=Zu("instanceColorEnd");d=Hl.y.lessThan(.5).select(f,m).mul(jB)}else d=jB;return Un(d,c)})(),this.transparent){const u=this.opacityNode?ge(this.opacityNode):JF;this.outputNode=Un(this.colorNode.rgb.mul(u).add(Qse().rgb.mul(u.oneMinus())),this.colorNode.a)}super.setup(e)}get worldUnits(){return this._useWorldUnits}set worldUnits(e){this._useWorldUnits!==e&&(this._useWorldUnits=e,this.needsUpdate=!0)}get dashed(){return this._useDash}set dashed(e){this._useDash!==e&&(this._useDash=e,this.needsUpdate=!0)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const fke=new ER;class eae extends Js{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(fke),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?ge(this.opacityNode):JF;xs.assign(XF(Un(Yre(Ur),e),Ps))}}const X4=We(([n=T4])=>{const e=n.z.atan(n.x).mul(1/(Math.PI*2)).add(.5),t=n.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return nn(e,t)});class tae extends jM{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const i=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new Id(5,5,5),a=X4(T4),o=new Js;o.colorNode=Qr(t,a,0),o.side=Er,o.blending=Oa;const l=new Fr(s,o),u=new Wc;u.add(l),t.minFilter===Vo&&(t.minFilter=Jn);const c=new J2(1,10,this),d=e.getMRT();return e.setMRT(null),c.update(e,u),e.setMRT(d),t.minFilter=i,t.currentGenerateMipmaps=r,l.geometry.dispose(),l.material.dispose(),this}}const xw=new WeakMap;class pke extends Ca{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=$u(null);const t=new T0;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Ni.RENDER}updateBefore(e){const{renderer:t,material:i}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const s=r.isTextureNode?r.value:i[r.property];if(s&&s.isTexture){const a=s.mapping;if(a===Mm||a===h0){if(xw.has(s)){const o=xw.get(s);Mj(o,s.mapping),this._cubeTexture=o}else{const o=s.image;if(mke(o)){const l=new tae(o.height);l.fromEquirectangularTexture(t,s),Mj(l.texture,s.mapping),this._cubeTexture=l.texture,xw.set(s,l.texture),s.addEventListener("dispose",nae)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function mke(n){return n==null?!1:n.height>0}function nae(n){const e=n.target;e.removeEventListener("dispose",nae);const t=xw.get(e);t!==void 0&&(xw.delete(e),t.dispose())}function Mj(n,e){e===Mm?n.mapping=_u:e===h0&&(n.mapping=wh)}const iae=Ri(pke).setParameterLength(1);class qF extends Gb{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=iae(this.envNode)}}class gke extends Gb{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=ge(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class cA{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class rae extends cA{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,i=e.reflectedLight,r=e.irradianceLightMap;i.indirectDiffuse.assign(Un(0)),r?i.indirectDiffuse.addAssign(r):i.indirectDiffuse.addAssign(Un(1,1,1,0)),i.indirectDiffuse.mulAssign(t),i.indirectDiffuse.mulAssign(xs.rgb)}finish(e){const{material:t,context:i}=e,r=i.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case Sb:r.rgb.assign(vr(r.rgb,r.rgb.mul(s.rgb),vw.mul(WN)));break;case V2:r.rgb.assign(vr(r.rgb,s.rgb,vw.mul(WN)));break;case H2:r.rgb.addAssign(s.rgb.mul(vw.mul(WN)));break;default:mt("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const yke=new La;class sae extends Js{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(yke),this.setValues(e)}setupNormal(){return uA(MM)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new qF(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new gke(L4)),t}setupOutgoingLight(){return xs.rgb}setupLightingModel(){return new rae}}const TM=We(({f0:n,f90:e,dotVH:t})=>{const i=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(i.oneMinus()).add(e.mul(i))}),mb=We(n=>n.diffuseColor.mul(1/Math.PI)),vke=()=>ge(.25),xke=We(({dotNH:n})=>VB.mul(ge(.5)).add(1).mul(ge(1/Math.PI)).mul(n.pow(VB))),bke=We(({lightDirection:n})=>{const e=n.add(Cs).normalize(),t=Ur.dot(e).clamp(),i=Cs.dot(e).clamp(),r=TM({f0:Vv,f90:1,dotVH:i}),s=vke(),a=xke({dotNH:t});return r.mul(s).mul(a)});class W4 extends rae{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:i}){const s=Ur.dot(e).clamp().mul(t);i.directDiffuse.addAssign(s.mul(mb({diffuseColor:xs.rgb}))),this.specular===!0&&i.directSpecular.addAssign(s.mul(bke({lightDirection:e})).mul(vw))}indirect(e){const{ambientOcclusion:t,irradiance:i,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(i.mul(mb({diffuseColor:xs}))),r.indirectDiffuse.mulAssign(t)}}const _ke=new tA;class aae extends Js{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(_ke),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new qF(t):null}setupLightingModel(){return new W4(!1)}}const Ske=new dF;class oae extends Js{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Ske),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new qF(t):null}setupLightingModel(){return new W4}setupVariants(){const e=(this.shininessNode?ge(this.shininessNode):qre).max(1e-4);VB.assign(e);const t=this.specularNode||ese;Vv.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const lae=We(n=>{if(n.geometry.hasAttribute("normal")===!1)return ge(0);const e=MM.dFdx().abs().max(MM.dFdy().abs());return e.x.max(e.y).max(e.z)}),Z4=We(n=>{const{roughness:e}=n,t=lae();let i=e.max(.0525);return i=i.add(t),i=i.min(1),i}),uae=We(({alpha:n,dotNL:e,dotNV:t})=>{const i=n.pow2(),r=e.mul(i.add(i.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(i.add(i.oneMinus().mul(e.pow2())).sqrt());return Eh(.5,r.add(s).max($V))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Mke=We(({alphaT:n,alphaB:e,dotTV:t,dotBV:i,dotTL:r,dotBL:s,dotNV:a,dotNL:o})=>{const l=o.mul(Ge(n.mul(t),e.mul(i),a).length()),u=a.mul(Ge(n.mul(r),e.mul(s),o).length());return Eh(.5,l.add(u))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),cae=We(({alpha:n,dotNH:e})=>{const t=n.pow2(),i=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(i.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Ake=ge(1/Math.PI),Tke=We(({alphaT:n,alphaB:e,dotNH:t,dotTH:i,dotBH:r})=>{const s=n.mul(e),a=Ge(e.mul(i),n.mul(r),s.mul(t)),o=a.dot(a),l=s.div(o);return Ake.mul(s.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),j4=We(({lightDirection:n,f0:e,f90:t,roughness:i,f:r,normalView:s=Ur,USE_IRIDESCENCE:a,USE_ANISOTROPY:o})=>{const l=i.pow2(),u=n.add(Cs).normalize(),c=s.dot(n).clamp(),d=s.dot(Cs).clamp(),f=s.dot(u).clamp(),m=Cs.dot(u).clamp();let y=TM({f0:e,f90:t,dotVH:m}),_,S;if(Qw(a)&&(y=IF.mix(y,r)),Qw(o)){const b=fw.dot(n),M=fw.dot(Cs),w=fw.dot(u),T=Ox.dot(n),E=Ox.dot(Cs),R=Ox.dot(u);_=Mke({alphaT:zB,alphaB:l,dotTV:M,dotBV:E,dotTL:b,dotBL:T,dotNV:d,dotNL:c}),S=Tke({alphaT:zB,alphaB:l,dotNH:f,dotTH:w,dotBH:R})}else _=uae({alpha:l,dotNL:c,dotNV:d}),S=cae({alpha:l,dotNH:f});return y.mul(_).mul(S)}),Cke=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Zp=null;const iE=We(({roughness:n,dotNV:e})=>{Zp===null&&(Zp=new xu(Cke,16,16,_l,zi),Zp.name="DFG_LUT",Zp.minFilter=Jn,Zp.magFilter=Jn,Zp.wrapS=ps,Zp.wrapT=ps,Zp.generateMipmaps=!1,Zp.needsUpdate=!0);const t=nn(n,e);return Qr(Zp,t).rg}),wke=We(({lightDirection:n,f0:e,f90:t,roughness:i,f:r,USE_IRIDESCENCE:s,USE_ANISOTROPY:a})=>{const o=j4({lightDirection:n,f0:e,f90:t,roughness:i,f:r,USE_IRIDESCENCE:s,USE_ANISOTROPY:a}),l=Ur.dot(n).clamp(),u=Ur.dot(Cs).clamp(),c=iE({roughness:i,dotNV:u}),d=iE({roughness:i,dotNV:l}),f=e.mul(c.x).add(t.mul(c.y)),m=e.mul(d.x).add(t.mul(d.y)),y=c.x.add(c.y),_=d.x.add(d.y),S=ge(1).sub(y),b=ge(1).sub(_),M=e.add(e.oneMinus().mul(.047619)),w=f.mul(m).mul(M).div(ge(1).sub(S.mul(b).mul(M).mul(M)).add($V)),T=S.mul(b),E=w.mul(T);return o.add(E)}),hae=We(n=>{const{dotNV:e,specularColor:t,specularF90:i,roughness:r}=n,s=iE({dotNV:e,roughness:r});return t.mul(s.x).add(i.mul(s.y))}),gk=We(({f:n,f90:e,dotVH:t})=>{const i=t.oneMinus().saturate(),r=i.mul(i),s=i.mul(r,r).clamp(0,.9999);return n.sub(Ge(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Eke=We(({roughness:n,dotNH:e})=>{const t=n.pow2(),i=ge(1).div(t),s=e.pow2().oneMinus().max(.0078125);return ge(2).add(i).mul(s.pow(i.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Rke=We(({dotNV:n,dotNL:e})=>ge(1).div(ge(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Pke=We(({lightDirection:n})=>{const e=n.add(Cs).normalize(),t=Ur.dot(n).clamp(),i=Ur.dot(Cs).clamp(),r=Ur.dot(e).clamp(),s=Eke({roughness:Uy,dotNH:r}),a=Rke({dotNV:i,dotNL:t});return dh.mul(s).mul(a)}),Dke=We(({N:n,V:e,roughness:t})=>{const s=.0078125,a=n.dot(e).saturate(),o=nn(t,a.oneMinus().sqrt());return o.assign(o.mul(.984375).add(s)),o}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),dae=We(({f:n})=>{const e=n.length();return ka(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Zy=We(({v1:n,v2:e})=>{const t=n.dot(e),i=t.abs().toVar(),r=i.mul(.0145206).add(.4965155).mul(i).add(.8543985).toVar(),s=i.add(4.1616724).mul(i).add(3.417594).toVar(),a=r.div(s),o=t.greaterThan(0).select(a,ka(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return n.cross(e).mul(o)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),Aj=We(({N:n,V:e,P:t,mInv:i,p0:r,p1:s,p2:a,p3:o})=>{const l=s.sub(r).toVar(),u=o.sub(r).toVar(),c=l.cross(u),d=Ge().toVar();return Kn(c.dot(t.sub(r)).greaterThanEqual(0),()=>{const f=e.sub(n.mul(e.dot(n))).normalize(),m=n.cross(f).negate(),y=i.mul(Yl(f,m,n).transpose()).toVar(),_=y.mul(r.sub(t)).normalize().toVar(),S=y.mul(s.sub(t)).normalize().toVar(),b=y.mul(a.sub(t)).normalize().toVar(),M=y.mul(o.sub(t)).normalize().toVar(),w=Ge(0).toVar();w.addAssign(Zy({v1:_,v2:S})),w.addAssign(Zy({v1:S,v2:b})),w.addAssign(Zy({v1:b,v2:M})),w.addAssign(Zy({v1:M,v2:_})),d.assign(Ge(dae({f:w})))}),d}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Nke=We(({P:n,p0:e,p1:t,p2:i,p3:r})=>{const s=t.sub(e).toVar(),a=r.sub(e).toVar(),o=s.cross(a),l=Ge().toVar();return Kn(o.dot(n.sub(e)).greaterThanEqual(0),()=>{const u=e.sub(n).normalize().toVar(),c=t.sub(n).normalize().toVar(),d=i.sub(n).normalize().toVar(),f=r.sub(n).normalize().toVar(),m=Ge(0).toVar();m.addAssign(Zy({v1:u,v2:c})),m.addAssign(Zy({v1:c,v2:d})),m.addAssign(Zy({v1:d,v2:f})),m.addAssign(Zy({v1:f,v2:u})),l.assign(Ge(dae({f:m.abs()})))}),l}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"P",type:"vec3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),QF=1/6,fae=n=>Ci(QF,Ci(n,Ci(n,n.negate().add(3)).sub(3)).add(1)),yk=n=>Ci(QF,Ci(n,Ci(n,Ci(3,n).sub(6))).add(4)),pae=n=>Ci(QF,Ci(n,Ci(n,Ci(-3,n).add(3)).add(3)).add(1)),vk=n=>Ci(QF,wd(n,3)),Tj=n=>fae(n).add(yk(n)),Cj=n=>pae(n).add(vk(n)),wj=n=>Eo(-1,yk(n).div(fae(n).add(yk(n)))),Ej=n=>Eo(1,vk(n).div(pae(n).add(vk(n)))),Rj=(n,e,t)=>{const i=n.uvNode,r=Ci(i,e.zw).add(.5),s=fm(r),a=Yf(r),o=Tj(a.x),l=Cj(a.x),u=wj(a.x),c=Ej(a.x),d=wj(a.y),f=Ej(a.y),m=nn(s.x.add(u),s.y.add(d)).sub(.5).mul(e.xy),y=nn(s.x.add(c),s.y.add(d)).sub(.5).mul(e.xy),_=nn(s.x.add(u),s.y.add(f)).sub(.5).mul(e.xy),S=nn(s.x.add(c),s.y.add(f)).sub(.5).mul(e.xy),b=Tj(a.y).mul(Eo(o.mul(n.sample(m).level(t)),l.mul(n.sample(y).level(t)))),M=Cj(a.y).mul(Eo(o.mul(n.sample(_).level(t)),l.mul(n.sample(S).level(t))));return b.add(M)},Y4=We(([n,e])=>{const t=nn(n.size(Le(e))),i=nn(n.size(Le(e.add(1)))),r=Eh(1,t),s=Eh(1,i),a=Rj(n,Un(r,t),fm(e)),o=Rj(n,Un(s,i),UF(e));return Yf(e).mix(a,o)}),Bke=We(([n,e])=>{const t=e.mul(_4(n));return Y4(n,t)}),Pj=We(([n,e,t,i,r])=>{const s=Ge(u4(e.negate(),nc(n),Eh(1,i))),a=Ge(pm(r[0].xyz),pm(r[1].xyz),pm(r[2].xyz));return nc(s).mul(t.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Fke=We(([n,e])=>n.mul(Kf(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Lke=O4(),Ike=O4(),Dj=We(([n,e,t],{material:i})=>{const s=(i.side===Er?Lke:Ike).sample(n),a=dm(pb.x).mul(Fke(e,t));return Y4(s,a)}),Nj=We(([n,e,t])=>(Kn(t.notEqual(0),()=>{const i=OF(e).negate().div(t);return JV(i.negate().mul(n))}),Ge(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),Gke=We(([n,e,t,i,r,s,a,o,l,u,c,d,f,m,y])=>{let _,S;if(y){_=Un().toVar(),S=Ge().toVar();const E=c.sub(1).mul(y.mul(.025)),R=Ge(c.sub(E),c,c.add(E));fs({start:0,end:3},({i:P})=>{const I=R.element(P),B=Pj(n,e,d,I,o),N=a.add(B),U=u.mul(l.mul(Un(N,1))),V=nn(U.xy.div(U.w)).toVar();V.addAssign(1),V.divAssign(2),V.assign(nn(V.x,V.y.oneMinus()));const W=Dj(V,t,I);_.element(P).assign(W.element(P)),_.a.addAssign(W.a),S.element(P).assign(i.element(P).mul(Nj(pm(B),f,m).element(P)))}),_.a.divAssign(3)}else{const E=Pj(n,e,d,c,o),R=a.add(E),P=u.mul(l.mul(Un(R,1))),I=nn(P.xy.div(P.w)).toVar();I.addAssign(1),I.divAssign(2),I.assign(nn(I.x,I.y.oneMinus())),_=Dj(I,t,c),S=i.mul(Nj(pm(E),f,m))}const b=S.rgb.mul(_.rgb),M=n.dot(e).clamp(),w=Ge(hae({dotNV:M,specularColor:r,specularF90:s,roughness:t})),T=S.r.add(S.g,S.b).div(3);return Un(w.oneMinus().mul(b),_.a.oneMinus().mul(T).oneMinus())}),Oke=Yl(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Uke=n=>{const e=n.sqrt();return Ge(1).add(e).div(Ge(1).sub(e))},Bj=(n,e)=>n.sub(e).div(n.add(e)).pow2(),kke=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),i=Ge(54856e-17,44201e-17,52481e-17),r=Ge(1681e3,1795300,2208400),s=Ge(43278e5,93046e5,66121e5),a=ge(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let o=i.mul(s.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return o=Ge(o.x.add(a),o.y,o.z).div(10685e-11),Oke.mul(o)},Fj=We(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:i,baseF0:r})=>{const s=vr(n,e,Rh(0,.03,i)),o=n.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();Kn(o.lessThan(0),()=>Ge(1));const l=o.sqrt(),u=Bj(s,n),c=TM({f0:u,f90:1,dotVH:t}),d=c.oneMinus(),f=s.lessThan(n).select(Math.PI,0),m=ge(Math.PI).sub(f),y=Uke(r.clamp(0,.9999)),_=Bj(y,s.toVec3()),S=TM({f0:_,f90:1,dotVH:l}),b=Ge(y.x.lessThan(s).select(Math.PI,0),y.y.lessThan(s).select(Math.PI,0),y.z.lessThan(s).select(Math.PI,0)),M=s.mul(i,l,2),w=Ge(m).add(b),T=c.mul(S).clamp(1e-5,.9999),E=T.sqrt(),R=d.pow2().mul(S).div(Ge(1).sub(T)),I=c.add(R).toVar(),B=R.sub(d).toVar();return fs({start:1,end:2,condition:"<=",name:"m"},({m:N})=>{B.mulAssign(E);const U=kke(ge(N).mul(M),ge(N).mul(w)).mul(2);I.addAssign(B.mul(U))}),I.max(Ge(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),rC=We(({normal:n,viewDir:e,roughness:t})=>{const i=n.dot(e).saturate(),r=t.mul(t),s=t.add(.1).reciprocal(),a=ge(-1.9362).add(t.mul(1.0678)).add(r.mul(.4573)).sub(s.mul(.8469)),o=ge(-.6014).add(t.mul(.5538)).sub(r.mul(.467)).sub(s.mul(.1255));return a.mul(i).add(o).exp().saturate()}),TO=Ge(.04),CO=ge(1);class eL extends cA{constructor(e=!1,t=!1,i=!1,r=!1,s=!1,a=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=i,this.anisotropy=r,this.transmission=s,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Ge().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Ge().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Ge().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Ge().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Ge().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=Ur.dot(Cs).clamp(),i=Fj({outsideIOR:ge(1),eta2:UB,cosTheta1:t,thinFilmThickness:kB,baseF0:Vv}),r=Fj({outsideIOR:ge(1),eta2:UB,cosTheta1:t,thinFilmThickness:kB,baseF0:xs.rgb});this.iridescenceFresnel=vr(i,r,Yg),this.iridescenceF0Dielectric=gk({f:i,f90:1,dotVH:t}),this.iridescenceF0Metallic=gk({f:r,f90:1,dotVH:t}),this.iridescenceF0=vr(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,Yg)}if(this.transmission===!0){const t=Th,i=yw.sub(Th).normalize(),r=t1,s=e.context;s.backdrop=Gke(r,i,Qp,px,Ax,qS,t,Ed,Fh,ju,pw,VV,XV,HV,this.dispersion?WV:null),s.backdropAlpha=HB,xs.a.mulAssign(vr(1,s.backdrop.a,HB))}super.start(e)}computeMultiscattering(e,t,i,r,s=null){const a=Ur.dot(Cs).clamp(),o=iE({roughness:Qp,dotNV:a}),l=s?IF.mix(r,s):r,u=l.mul(o.x).add(i.mul(o.y)),d=o.x.add(o.y).oneMinus(),f=l.add(l.oneMinus().mul(.047619)),m=u.mul(f).div(d.mul(f).oneMinus());e.addAssign(u),t.addAssign(m.mul(d))}direct({lightDirection:e,lightColor:t,reflectedLight:i}){const s=Ur.dot(e).clamp().mul(t).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(s.mul(Pke({lightDirection:e})));const a=rC({normal:Ur,viewDir:Cs,roughness:Uy}),o=rC({normal:Ur,viewDir:e,roughness:Uy}),l=dh.r.max(dh.g).max(dh.b).mul(a.max(o)).oneMinus();s.mulAssign(l)}if(this.clearcoat===!0){const o=Tx.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(o.mul(j4({lightDirection:e,f0:TO,f90:CO,roughness:tE,normalView:Tx})))}i.directDiffuse.addAssign(s.mul(mb({diffuseColor:px}))),i.directSpecular.addAssign(s.mul(wke({lightDirection:e,f0:Ax,f90:1,roughness:Qp,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:i,halfHeight:r,reflectedLight:s,ltc_1:a,ltc_2:o}){const l=t.add(i).sub(r),u=t.sub(i).sub(r),c=t.sub(i).add(r),d=t.add(i).add(r),f=Ur,m=Cs,y=co.toVar(),_=Dke({N:f,V:m,roughness:Qp}),S=a.sample(_).toVar(),b=o.sample(_).toVar(),M=Yl(Ge(S.x,0,S.y),Ge(0,1,0),Ge(S.z,0,S.w)).toVar(),w=Ax.mul(b.x).add(Ax.oneMinus().mul(b.y)).toVar();s.directSpecular.addAssign(e.mul(w).mul(Aj({N:f,V:m,P:y,mInv:M,p0:l,p1:u,p2:c,p3:d}))),s.directDiffuse.addAssign(e.mul(px).mul(Aj({N:f,V:m,P:y,mInv:Yl(1,0,0,0,1,0,0,0,1),p0:l,p1:u,p2:c,p3:d})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:i}=e.context,r=t.mul(mb({diffuseColor:px})).toVar();if(this.sheen===!0){const s=rC({normal:Ur,viewDir:Cs,roughness:Uy}),a=dh.r.max(dh.g).max(dh.b).mul(s).oneMinus();r.mulAssign(a)}i.indirectDiffuse.addAssign(r)}indirectSpecular(e){const{radiance:t,iblIrradiance:i,reflectedLight:r}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(i.mul(dh,rC({normal:Ur,viewDir:Cs,roughness:Uy}))),this.clearcoat===!0){const S=Tx.dot(Cs).clamp(),b=hae({dotNV:S,specularColor:TO,specularF90:CO,roughness:tE});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(b))}const s=Ge().toVar("singleScatteringDielectric"),a=Ge().toVar("multiScatteringDielectric"),o=Ge().toVar("singleScatteringMetallic"),l=Ge().toVar("multiScatteringMetallic");this.computeMultiscattering(s,a,qS,Vv,this.iridescenceF0Dielectric),this.computeMultiscattering(o,l,qS,xs.rgb,this.iridescenceF0Metallic);const u=vr(s,o,Yg),c=vr(a,l,Yg),d=s.add(a),f=px.mul(d.oneMinus()),m=i.mul(1/Math.PI),y=t.mul(u).add(c.mul(m)).toVar(),_=f.mul(m).toVar();if(this.sheen===!0){const S=rC({normal:Ur,viewDir:Cs,roughness:Uy}),b=dh.r.max(dh.g).max(dh.b).mul(S).oneMinus();y.mulAssign(b),_.mulAssign(b)}r.indirectSpecular.addAssign(y),r.indirectDiffuse.addAssign(_)}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:i}=e.context,s=Ur.dot(Cs).clamp().add(t),a=Qp.mul(-16).oneMinus().negate().exp2(),o=t.sub(s.pow(a).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),i.indirectDiffuse.mulAssign(t),i.indirectSpecular.mulAssign(o)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const i=Tx.dot(Cs).clamp(),r=TM({dotVH:i,f0:TO,f90:CO}),s=t.mul(OB.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(OB));t.assign(s)}if(this.sheen===!0){const i=t.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));t.assign(i)}}}const Lj=ge(1),xk=ge(-2),TD=ge(.8),wO=ge(-1),CD=ge(.4),EO=ge(2),wD=ge(.305),RO=ge(3),Ij=ge(.21),zke=ge(4),Gj=ge(4),Vke=ge(16),Hke=We(([n])=>{const e=Ge(zs(n)).toVar(),t=ge(-1).toVar();return Kn(e.x.greaterThan(e.z),()=>{Kn(e.x.greaterThan(e.y),()=>{t.assign(Zl(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Zl(n.y.greaterThan(0),1,4))})}).Else(()=>{Kn(e.z.greaterThan(e.y),()=>{t.assign(Zl(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Zl(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),Xke=We(([n,e])=>{const t=nn().toVar();return Kn(e.equal(0),()=>{t.assign(nn(n.z,n.y).div(zs(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(nn(n.x.negate(),n.z.negate()).div(zs(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(nn(n.x.negate(),n.y).div(zs(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(nn(n.z.negate(),n.y).div(zs(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(nn(n.x.negate(),n.z).div(zs(n.y)))}).Else(()=>{t.assign(nn(n.x,n.y).div(zs(n.z)))}),Ci(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),Wke=We(([n])=>{const e=ge(0).toVar();return Kn(n.greaterThanEqual(TD),()=>{e.assign(Lj.sub(n).mul(wO.sub(xk)).div(Lj.sub(TD)).add(xk))}).ElseIf(n.greaterThanEqual(CD),()=>{e.assign(TD.sub(n).mul(EO.sub(wO)).div(TD.sub(CD)).add(wO))}).ElseIf(n.greaterThanEqual(wD),()=>{e.assign(CD.sub(n).mul(RO.sub(EO)).div(CD.sub(wD)).add(EO))}).ElseIf(n.greaterThanEqual(Ij),()=>{e.assign(wD.sub(n).mul(zke.sub(RO)).div(wD.sub(Ij)).add(RO))}).Else(()=>{e.assign(ge(-2).mul(dm(Ci(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),mae=We(([n,e])=>{const t=n.toVar();t.assign(Ci(2,t).sub(1));const i=Ge(t,1).toVar();return Kn(e.equal(0),()=>{i.assign(i.zyx)}).ElseIf(e.equal(1),()=>{i.assign(i.xzy),i.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{i.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{i.assign(i.zyx),i.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{i.assign(i.xzy),i.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{i.z.mulAssign(-1)}),i}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),gae=We(([n,e,t,i,r,s])=>{const a=ge(t),o=Ge(e),l=Kf(Wke(a),xk,s),u=Yf(l),c=fm(l),d=Ge(rE(n,o,c,i,r,s)).toVar();return Kn(u.notEqual(0),()=>{const f=Ge(rE(n,o,c.add(1),i,r,s)).toVar();d.assign(vr(d,f,u))}),d}),rE=We(([n,e,t,i,r,s])=>{const a=ge(t).toVar(),o=Ge(e),l=ge(Hke(o)).toVar(),u=ge(ka(Gj.sub(a),0)).toVar();a.assign(ka(a,Gj));const c=ge(SM(a)).toVar(),d=nn(Xke(o,l).mul(c.sub(2)).add(1)).toVar();return Kn(l.greaterThan(2),()=>{d.y.addAssign(c),l.subAssign(3)}),d.x.addAssign(l.mul(c)),d.x.addAssign(u.mul(Ci(3,Vke))),d.y.addAssign(Ci(4,SM(s).sub(c))),d.x.mulAssign(i),d.y.mulAssign(r),n.sample(d).grad(nn(),nn())}),PO=We(({envMap:n,mipInt:e,outputDirection:t,theta:i,axis:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:o})=>{const l=Lf(i),u=t.mul(l).add(r.cross(t).mul(Wu(i))).add(r.mul(r.dot(t).mul(l.oneMinus())));return rE(n,u,e,s,a,o)}),yae=We(({n,latitudinal:e,poleAxis:t,outputDirection:i,weights:r,samples:s,dTheta:a,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d})=>{const f=Ge(Zl(e,t,m0(t,i))).toVar();Kn(f.equal(Ge(0)),()=>{f.assign(Ge(i.z,0,i.x.negate()))}),f.assign(nc(f));const m=Ge().toVar();return m.addAssign(r.element(0).mul(PO({theta:0,axis:f,outputDirection:i,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d}))),fs({start:Le(1),end:n},({i:y})=>{Kn(y.greaterThanEqual(s),()=>{Fse()});const _=ge(a.mul(ge(y))).toVar();m.addAssign(r.element(y).mul(PO({theta:_.mul(-1),axis:f,outputDirection:i,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d}))),m.addAssign(r.element(y).mul(PO({theta:_,axis:f,outputDirection:i,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d})))}),Un(m,1)}),Zke=We(([n])=>{const e=Yt(n).toVar();return e.assign(e.shiftLeft(Yt(16)).bitOr(e.shiftRight(Yt(16)))),e.assign(e.bitAnd(Yt(1431655765)).shiftLeft(Yt(1)).bitOr(e.bitAnd(Yt(2863311530)).shiftRight(Yt(1)))),e.assign(e.bitAnd(Yt(858993459)).shiftLeft(Yt(2)).bitOr(e.bitAnd(Yt(3435973836)).shiftRight(Yt(2)))),e.assign(e.bitAnd(Yt(252645135)).shiftLeft(Yt(4)).bitOr(e.bitAnd(Yt(4042322160)).shiftRight(Yt(4)))),e.assign(e.bitAnd(Yt(16711935)).shiftLeft(Yt(8)).bitOr(e.bitAnd(Yt(4278255360)).shiftRight(Yt(8)))),ge(e).mul(23283064365386963e-26)}),jke=We(([n,e])=>nn(ge(n).div(ge(e)),Zke(n))),Yke=We(([n,e,t])=>{const i=Ge(e).toVar(),r=ge(t),s=r.mul(r).toVar(),a=nc(Ge(s.mul(i.x),s.mul(i.y),i.z)).toVar(),o=a.x.mul(a.x).add(a.y.mul(a.y)),l=Zl(o.greaterThan(0),Ge(a.y.negate(),a.x,0).div(vu(o)),Ge(1,0,0)).toVar(),u=m0(a,l).toVar(),c=vu(n.x),d=Ci(2,3.14159265359).mul(n.y),f=c.mul(Lf(d)).toVar(),m=c.mul(Wu(d)).toVar(),y=Ci(.5,a.z.add(1));m.assign(y.oneMinus().mul(vu(f.mul(f).oneMinus())).add(y.mul(m)));const _=l.mul(f).add(u.mul(m)).add(a.mul(vu(ka(0,f.mul(f).add(m.mul(m)).oneMinus()))));return nc(Ge(s.mul(_.x),s.mul(_.y),ka(0,_.z)))}),vae=We(({roughness:n,mipInt:e,envMap:t,N_immutable:i,GGX_SAMPLES:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:o})=>{const l=Ge(i).toVar(),u=Ge(0).toVar(),c=ge(0).toVar();return Kn(n.lessThan(.001),()=>{u.assign(rE(t,l,e,s,a,o))}).Else(()=>{const d=Zl(zs(l.z).lessThan(.999),Ge(0,0,1),Ge(1,0,0)),f=nc(m0(d,l)).toVar(),m=m0(l,f).toVar();fs({start:Yt(0),end:r},({i:y})=>{const _=jke(y,r),S=Yke(_,Ge(0,0,1),n),b=nc(f.mul(S.x).add(m.mul(S.y)).add(l.mul(S.z))),M=nc(b.mul(Ud(l,b).mul(2)).sub(l)),w=ka(Ud(l,M),0);Kn(w.greaterThan(0),()=>{const T=rE(t,M,e,s,a,o);u.addAssign(T.mul(w)),c.addAssign(w)})}),Kn(c.greaterThan(0),()=>{u.assign(u.div(c))})}),Un(u,1)}),jy=4,Oj=[.125,.215,.35,.446,.526,.582],mx=20,Kke=512,sC=new Tl(-1,1,1,-1,0,1),$ke=new ds(90,1),Uj=new en;let DO=null,NO=0,BO=0;const Jke=new re,YB=new WeakMap,qke=[3,1,5,0,4,2],FO=mae(_s(),Zu("faceIndex")).normalize(),tL=Ge(FO.x,FO.y,FO.z);class xae{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,i=.1,r=100,s={}){const{size:a=256,position:o=Jke,renderTarget:l=null}=s;if(this._setSize(a),this._hasInitialized===!1){mt('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const c=l||this._allocateTarget();return s.renderTarget=c,this.fromSceneAsync(e,t,i,r,s),c}DO=this._renderer.getRenderTarget(),NO=this._renderer.getActiveCubeFace(),BO=this._renderer.getActiveMipmapLevel();const u=l||this._allocateTarget();return u.depthBuffer=!0,this._init(u),this._sceneToCubeUV(e,i,r,u,o),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}async fromSceneAsync(e,t=0,i=.1,r=100,s={}){return hs('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,i,r,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){mt('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const i=t||this._allocateTarget();return this.fromEquirectangularAsync(e,i),i}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return hs('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){mt("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const i=t||this._allocateTarget();return this.fromCubemapAsync(e,t),i}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return hs('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=zj(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Vj(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===_u||e.mapping===wh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(DO,NO,BO),e.scissorTest=!1,cS(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),DO=this._renderer.getRenderTarget(),NO=this._renderer.getActiveCubeFace(),BO=this._renderer.getActiveMipmapLevel();const i=t||this._allocateTarget();return this._init(i),this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return kj(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=kj(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=Qke(t)),this._blurMaterial=eze(t,e.width,e.height),this._ggxMaterial=tze(t,e.width,e.height)}}async _compileMaterial(e){const t=new Fr(new wi,e);await this._renderer.compile(t,sC)}_sceneToCubeUV(e,t,i,r,s){const a=$ke;a.near=t,a.far=i;const o=[1,1,1,1,-1,1],l=[1,-1,1,-1,1,-1],u=this._renderer,c=u.autoClear;u.getClearColor(Uj),u.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new Fr(new Id,new La({name:"PMREM.Background",side:Er,depthWrite:!1,depthTest:!1})));const d=this._backgroundBox,f=d.material;let m=!1;const y=e.background;y?y.isColor&&(f.color.copy(y),e.background=null,m=!0):(f.color.copy(Uj),m=!0),u.setRenderTarget(r),u.clear(),m&&u.render(d,a);for(let _=0;_<6;_++){const S=_%3;S===0?(a.up.set(0,o[_],0),a.position.set(s.x,s.y,s.z),a.lookAt(s.x+l[_],s.y,s.z)):S===1?(a.up.set(0,0,o[_]),a.position.set(s.x,s.y,s.z),a.lookAt(s.x,s.y+l[_],s.z)):(a.up.set(0,o[_],0),a.position.set(s.x,s.y,s.z),a.lookAt(s.x,s.y,s.z+l[_]));const b=this._cubeSize;cS(r,S*b,_>2?b:0,b,b),u.render(e,a)}u.autoClear=c,e.background=y}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===_u||e.mapping===wh;r?this._cubemapMaterial===null&&(this._cubemapMaterial=zj(e)):this._equirectMaterial===null&&(this._equirectMaterial=Vj(e));const s=r?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const a=this._lodMeshes[0];a.material=s;const o=this._cubeSize;cS(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(a,sC)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let s=1;s<r;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=i}_applyGGXFilter(e,t,i){const r=this._renderer,s=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[i];o.material=a;const l=YB.get(a),u=i/(this._lodMeshes.length-1),c=t/(this._lodMeshes.length-1),d=Math.sqrt(u*u-c*c),f=0+u*1.25,m=d*f,{_lodMax:y}=this,_=this._sizeLods[i],S=3*_*(i>y-jy?i-y+jy:0),b=4*(this._cubeSize-_);e.texture.frame=(e.texture.frame||0)+1,l.envMap.value=e.texture,l.roughness.value=m,l.mipInt.value=y-t,cS(s,S,b,3*_,2*_),r.setRenderTarget(s),r.render(o,sC),s.texture.frame=(s.texture.frame||0)+1,l.envMap.value=s.texture,l.roughness.value=0,l.mipInt.value=y-i,cS(e,S,b,3*_,2*_),r.setRenderTarget(e),r.render(o,sC)}_blur(e,t,i,r,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",s),this._halfBlur(a,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,a,o){const l=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&Tt("blur direction must be either latitudinal or longitudinal!");const c=3,d=this._lodMeshes[r];d.material=u;const f=YB.get(u),m=this._sizeLods[i]-1,y=isFinite(s)?Math.PI/(2*m):2*Math.PI/(2*mx-1),_=s/y,S=isFinite(s)?1+Math.floor(c*_):mx;S>mx&&mt(`sigmaRadians, ${s}, is too large and will clip, as it requested ${S} samples when the maximum is set to ${mx}`);const b=[];let M=0;for(let P=0;P<mx;++P){const I=P/_,B=Math.exp(-I*I/2);b.push(B),P===0?M+=B:P<S&&(M+=2*B)}for(let P=0;P<b.length;P++)b[P]=b[P]/M;e.texture.frame=(e.texture.frame||0)+1,f.envMap.value=e.texture,f.samples.value=S,f.weights.array=b,f.latitudinal.value=a==="latitudinal"?1:0,o&&(f.poleAxis.value=o);const{_lodMax:w}=this;f.dTheta.value=y,f.mipInt.value=w-i;const T=this._sizeLods[r],E=3*T*(r>w-jy?r-w+jy:0),R=4*(this._cubeSize-T);cS(t,E,R,3*T,2*T),l.setRenderTarget(t),l.render(d,sC)}}function Qke(n){const e=[],t=[],i=[];let r=n;const s=n-jy+1+Oj.length;for(let a=0;a<s;a++){const o=Math.pow(2,r);e.push(o);let l=1/o;a>n-jy?l=Oj[a-n+jy-1]:a===0&&(l=0),t.push(l);const u=1/(o-2),c=-u,d=1+u,f=[c,c,d,c,d,d,c,c,d,d,c,d],m=6,y=6,_=3,S=2,b=1,M=new Float32Array(_*y*m),w=new Float32Array(S*y*m),T=new Float32Array(b*y*m);for(let R=0;R<m;R++){const P=R%3*2/3-1,I=R>2?0:-1,B=[P,I,0,P+2/3,I,0,P+2/3,I+1,0,P,I,0,P+2/3,I+1,0,P,I+1,0],N=qke[R];M.set(B,_*y*N),w.set(f,S*y*N);const U=[N,N,N,N,N,N];T.set(U,b*y*N)}const E=new wi;E.setAttribute("position",new Gi(M,_)),E.setAttribute("uv",new Gi(w,S)),E.setAttribute("faceIndex",new Gi(T,b)),i.push(new Fr(E,null)),r>jy&&r--}return{lodMeshes:i,sizeLods:e,sigmas:t}}function kj(n,e){const t={magFilter:Jn,minFilter:Jn,generateMipmaps:!1,type:zi,format:Vr,colorSpace:Su},i=new Wd(n,e,t);return i.texture.mapping=Am,i.texture.name="PMREM.cubeUv",i.texture.isPMREMTexture=!0,i.scissorTest=!0,i}function cS(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function nL(n){const e=new Js;return e.depthTest=!1,e.depthWrite=!1,e.blending=Oa,e.name=`PMREM_${n}`,e}function eze(n,e,t){const i=gu(new Array(mx).fill(0)),r=Qn(new re(0,1,0)),s=Qn(0),a=ge(mx),o=Qn(0),l=Qn(1),u=Qr(),c=Qn(0),d=ge(1/e),f=ge(1/t),m=ge(n),y={n:a,latitudinal:o,weights:i,poleAxis:r,outputDirection:tL,dTheta:s,samples:l,envMap:u,mipInt:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m},_=nL("blur");return _.fragmentNode=yae({...y,latitudinal:o.equal(1)}),YB.set(_,y),_}function tze(n,e,t){const i=Qr(),r=Qn(0),s=Qn(0),a=ge(1/e),o=ge(1/t),l=ge(n),u={envMap:i,roughness:r,mipInt:s,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:l},c=nL("ggx");return c.fragmentNode=vae({...u,N_immutable:tL,GGX_SAMPLES:Yt(Kke)}),YB.set(c,u),c}function zj(n){const e=nL("cubemap");return e.fragmentNode=$u(n,tL),e}function Vj(n){const e=nL("equirect");return e.fragmentNode=Qr(n,X4(tL),0),e}const Hj=new WeakMap;function nze(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function ize(n,e,t){const i=rze(e);let r=i.get(n);if((r!==void 0?r.pmremVersion:-1)!==n.pmremVersion){const a=n.image;if(n.isCubeTexture)if(sze(a))r=t.fromCubemap(n,r);else return null;else if(aze(a))r=t.fromEquirectangular(n,r);else return null;r.pmremVersion=n.pmremVersion,i.set(n,r)}return r.texture}function rze(n){let e=Hj.get(n);return e===void 0&&(e=new WeakMap,Hj.set(n,e)),e}class bae extends Ca{static get type(){return"PMREMNode"}constructor(e,t=null,i=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=i,this._generator=null;const r=new pr;r.isRenderTargetTexture=!0,this._texture=Qr(r),this._width=Qn(0),this._height=Qn(0),this._maxMip=Qn(0),this.updateBeforeType=Ni.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=nze(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const i=t?t.pmremVersion:-1,r=this._value;i!==r.pmremVersion&&(r.isPMREMTexture===!0?t=r:t=ize(r,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new xae(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this,e)),t=E4.mul(Ge(t.x,t.y.negate(),t.z));let i=this.levelNode;return i===null&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this)),gae(this._texture,t,i,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function sze(n){if(n==null)return!1;let e=0;const t=6;for(let i=0;i<t;i++)n[i]!==void 0&&e++;return e===t}function aze(n){return n==null?!1:n.height>0}const K4=Ri(bae).setParameterLength(1,3),Xj=new WeakMap;class _ae extends Gb{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const d=i.isTextureNode?i.value:t[i.property];let f=Xj.get(d);f===void 0&&(f=K4(d),Xj.set(d,f)),i=f}const s=t.useAnisotropy===!0||t.anisotropy>0?jre:Ur,a=i.context(Wj(Qp,s)).mul(XN),o=i.context(oze(t1)).mul(Math.PI).mul(XN),l=tM(a),u=tM(o);e.context.radiance.addAssign(l),e.context.iblIrradiance.addAssign(u);const c=e.context.lightingModel.clearcoatRadiance;if(c){const d=i.context(Wj(tE,Tx)).mul(XN),f=tM(d);c.addAssign(f)}}}const Wj=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Cs.negate().reflect(e),t=o4(n).mix(t,e).normalize(),t=t.transformDirection(Fh)),t),getTextureLevel:()=>n}},oze=n=>({getUV:()=>n,getTextureLevel:()=>ge(1)}),lze=new mo;class $4 extends Js{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(lze),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new _ae(t):null}setupLightingModel(){return new eL}setupSpecular(){const e=vr(Ge(.04),xs.rgb,Yg);Vv.assign(Ge(.04)),Ax.assign(e),qS.assign(1)}setupVariants(){const e=this.metalnessNode?ge(this.metalnessNode):ise;Yg.assign(e);let t=this.roughnessNode?ge(this.roughnessNode):nse;t=Z4({roughness:t}),Qp.assign(t),this.setupSpecular(),px.assign(xs.rgb.mul(e.oneMinus()))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const uze=new Kc;class J4 extends $4{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(uze),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?ge(this.iorNode):yse;pw.assign(e),Vv.assign(Zc(a4(pw.sub(1).div(pw.add(1))).mul(tse),Ge(1)).mul(mk)),Ax.assign(vr(Vv,xs.rgb,Yg)),qS.assign(vr(mk,1,Yg))}setupLightingModel(){return new eL(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?ge(this.clearcoatNode):sse,i=this.clearcoatRoughnessNode?ge(this.clearcoatRoughnessNode):ase;OB.assign(t),tE.assign(Z4({roughness:i}))}if(this.useSheen){const t=this.sheenNode?Ge(this.sheenNode):use,i=this.sheenRoughnessNode?ge(this.sheenRoughnessNode):cse;dh.assign(t),Uy.assign(i)}if(this.useIridescence){const t=this.iridescenceNode?ge(this.iridescenceNode):dse,i=this.iridescenceIORNode?ge(this.iridescenceIORNode):fse,r=this.iridescenceThicknessNode?ge(this.iridescenceThicknessNode):pse;IF.assign(t),UB.assign(i),kB.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?nn(this.anisotropyNode):hse).toVar();Gy.assign(t.length()),Kn(Gy.equal(0),()=>{t.assign(nn(1,0))}).Else(()=>{t.divAssign(nn(Gy)),Gy.assign(Gy.saturate())}),zB.assign(Gy.pow2().mix(Qp.pow2(),1)),fw.assign(Cx[0].mul(t.x).add(Cx[1].mul(t.y))),Ox.assign(Cx[1].mul(t.x).sub(Cx[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?ge(this.transmissionNode):mse,i=this.thicknessNode?ge(this.thicknessNode):gse,r=this.attenuationDistanceNode?ge(this.attenuationDistanceNode):vse,s=this.attenuationColorNode?Ge(this.attenuationColorNode):xse;if(HB.assign(t),VV.assign(i),HV.assign(r),XV.assign(s),this.useDispersion){const a=this.dispersionNode?ge(this.dispersionNode):_se;WV.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Ge(this.clearcoatNormalNode):ose}setup(e){e.context.setupClearcoatNormal=()=>eM(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}class cze extends eL{constructor(e=!1,t=!1,i=!1,r=!1,s=!1,a=!1,o=!1){super(e,t,i,r,s,a),this.useSSS=o}direct({lightDirection:e,lightColor:t,reflectedLight:i},r){if(this.useSSS===!0){const s=r.material,{thicknessColorNode:a,thicknessDistortionNode:o,thicknessAmbientNode:l,thicknessAttenuationNode:u,thicknessPowerNode:c,thicknessScaleNode:d}=s,f=e.add(Ur.mul(o)).normalize(),m=ge(Cs.dot(f.negate()).saturate().pow(c).mul(d)),y=Ge(m.add(l).mul(a));i.directDiffuse.addAssign(y.mul(u.mul(t)))}super.direct({lightDirection:e,lightColor:t,reflectedLight:i},r)}}class hze extends J4{static get type(){return"MeshSSSNodeMaterial"}constructor(e){super(e),this.thicknessColorNode=null,this.thicknessDistortionNode=ge(.1),this.thicknessAmbientNode=ge(0),this.thicknessAttenuationNode=ge(.1),this.thicknessPowerNode=ge(2),this.thicknessScaleNode=ge(10)}get useSSS(){return this.thicknessColorNode!==null}setupLightingModel(){return new cze(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion,this.useSSS)}copy(e){return this.thicknessColorNode=e.thicknessColorNode,this.thicknessDistortionNode=e.thicknessDistortionNode,this.thicknessAmbientNode=e.thicknessAmbientNode,this.thicknessAttenuationNode=e.thicknessAttenuationNode,this.thicknessPowerNode=e.thicknessPowerNode,this.thicknessScaleNode=e.thicknessScaleNode,super.copy(e)}}const dze=We(({normal:n,lightDirection:e,builder:t})=>{const i=n.dot(e),r=nn(i.mul(.5).add(.5),0);if(t.material.gradientMap){const s=Wg("gradientMap","texture").context({getUV:()=>r});return Ge(s.r)}else{const s=r.fwidth().mul(.5);return vr(Ge(.7),Ge(1),Rh(ge(.7).sub(s.x),ge(.7).add(s.x),r.x))}});class fze extends cA{direct({lightDirection:e,lightColor:t,reflectedLight:i},r){const s=dze({normal:jF,lightDirection:e,builder:r}).mul(t);i.directDiffuse.addAssign(s.mul(mb({diffuseColor:xs.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:i,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(i.mul(mb({diffuseColor:xs}))),r.indirectDiffuse.mulAssign(t)}}const pze=new fF;class Sae extends Js{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(pze),this.setValues(e)}setupLightingModel(){return new fze}}const Mae=We(()=>{const n=Ge(Cs.z,0,Cs.x.negate()).normalize(),e=Cs.cross(n);return nn(n.dot(Ur),e.dot(Ur)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),mze=new gF;class Aae extends Js{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(mze),this.setValues(e)}setupVariants(e){const t=Mae;let i;e.material.matcap?i=Wg("matcap","texture").context({getUV:()=>t}):i=Ge(vr(.2,.8,t.y)),xs.rgb.mulAssign(i.rgb)}}class Tae extends Ca{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:i}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),a=t.sin();return LF(s,a,a.negate(),s).mul(i)}else{const s=t,a=rv(Un(1,0,0,0),Un(0,Lf(s.x),Wu(s.x).negate(),0),Un(0,Wu(s.x),Lf(s.x),0),Un(0,0,0,1)),o=rv(Un(Lf(s.y),0,Wu(s.y),0),Un(0,1,0,0),Un(Wu(s.y).negate(),0,Lf(s.y),0),Un(0,0,0,1)),l=rv(Un(Lf(s.z),Wu(s.z).negate(),0,0),Un(Wu(s.z),Lf(s.z),0,0),Un(0,0,1,0),Un(0,0,0,1));return a.mul(o).mul(l).mul(Un(i,1)).xyz}}}const zR=Ri(Tae).setParameterLength(2),gze=new dR;class q4 extends Js{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(gze),this.setValues(e)}setupPositionView(e){const{object:t,camera:i}=e,{positionNode:r,rotationNode:s,scaleNode:a,sizeAttenuation:o}=this,l=wm.mul(Ge(r||0));let u=nn(Ed[0].xyz.length(),Ed[1].xyz.length());a!==null&&(u=u.mul(nn(a))),i.isPerspectiveCamera&&o===!1&&(u=u.mul(l.z.negate()));let c=Hl.xy;if(t.center&&t.center.isVector2===!0){const m=KUe("center","vec2",t);c=c.sub(m.sub(.5))}c=c.mul(u);const d=ge(s||lse),f=zR(c,d);return Un(l.xy.add(f),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const yze=new JM,vze=new rt;class Cae extends q4{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(yze),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return wm.mul(Ge(e||Ia)).xyz}setupVertexSprite(e){const{material:t,camera:i}=e,{rotationNode:r,scaleNode:s,sizeNode:a,sizeAttenuation:o}=this;let l=super.setupVertex(e);if(t.isNodeMaterial!==!0)return l;let u=a!==null?nn(a):bse;u=u.mul(M4),i.isPerspectiveCamera&&o===!0&&(u=u.mul(xze.div(co.z.negate()))),s&&s.isNode&&(u=u.mul(nn(s)));let c=Hl.xy;if(r&&r.isNode){const d=ge(r);c=zR(c,d)}return c=c.mul(u),c=c.div(A4.div(2)),c=c.mul(l.w),l=l.add(Un(c,0,0)),l}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const xze=Qn(1).onFrameUpdate(function({renderer:n}){const e=n.getSize(vze);this.value=.5*e.y});class bze extends cA{constructor(){super(),this.shadowNode=ge(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){xs.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(xs.rgb)}}const _ze=new cF;class wae extends Js{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(_ze),this.setValues(e)}setupLightingModel(){return new bze}}const aC=Vf("vec3"),Zj=Vf("vec3"),jj=Vf("vec3");class Sze extends cA{constructor(){super()}start(e){const{material:t}=e,i=Vf("vec3"),r=Vf("vec3");Kn(yw.sub(Th).length().greaterThan(_re.mul(2)),()=>{i.assign(yw),r.assign(Th)}).Else(()=>{i.assign(Th),r.assign(yw)});const s=r.sub(i),a=Qn("int").onRenderUpdate(({material:d})=>d.steps),o=s.length().div(a).toVar(),l=s.normalize().toVar(),u=ge(0).toVar(),c=Ge(1).toVar();t.offsetNode&&u.addAssign(t.offsetNode.mul(o)),fs(a,()=>{const d=i.add(l.mul(u)),f=Fh.mul(Un(d,1)).xyz;t.depthNode!==null&&(Zj.assign(AM(k4(f.z,Hg,Xg))),e.context.sceneDepthNode=AM(t.depthNode).toVar()),e.context.positionWorld=d,e.context.shadowPositionWorld=d,e.context.positionView=f,aC.assign(0);let m;t.scatteringNode&&(m=t.scatteringNode({positionRay:d})),super.start(e),m&&aC.mulAssign(m);const y=aC.mul(.01).negate().mul(o).exp();c.mulAssign(y),u.addAssign(o)}),jj.addAssign(c.saturate().oneMinus())}scatteringLight(e,t){const i=t.context.sceneDepthNode;i?Kn(i.greaterThanEqual(Zj),()=>{aC.addAssign(e)}):aC.addAssign(e)}direct({lightNode:e,lightColor:t},i){if(e.light.distance===void 0)return;const r=t.xyz.toVar();r.mulAssign(e.shadowNode),this.scatteringLight(r,i)}directRectArea({lightColor:e,lightPosition:t,halfWidth:i,halfHeight:r},s){const a=t.add(i).sub(r),o=t.sub(i).sub(r),l=t.sub(i).add(r),u=t.add(i).add(r),c=s.context.positionView,d=e.xyz.mul(Nke({P:c,p0:a,p1:o,p2:l,p3:u})).pow(1.5);this.scatteringLight(d,s)}finish(e){e.context.outgoingLight.assign(jj)}}class Mze extends Js{static get type(){return"VolumeNodeMaterial"}constructor(e){super(),this.isVolumeNodeMaterial=!0,this.steps=25,this.offsetNode=null,this.scatteringNode=null,this.lights=!0,this.transparent=!0,this.side=Er,this.depthTest=!1,this.depthWrite=!1,this.setValues(e)}setupLightingModel(){return new Sze}}let Aze=class{constructor(e,t,i){this.renderer=e,this.nodes=t,this.info=i,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,i)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,i),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}};class Jf{constructor(){this.weakMaps={}}_getWeakMap(e){const t=e.length;let i=this.weakMaps[t];return i===void 0&&(i=new WeakMap,this.weakMaps[t]=i),i}get(e){let t=this._getWeakMap(e);for(let i=0;i<e.length-1;i++)if(t=t.get(e[i]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let i=this._getWeakMap(e);for(let r=0;r<e.length-1;r++){const s=e[r];i.has(s)===!1&&i.set(s,new WeakMap),i=i.get(s)}return i.set(e[e.length-1],t),this}delete(e){let t=this._getWeakMap(e);for(let i=0;i<e.length-1;i++)if(t=t.get(e[i]),t===void 0)return!1;return t.delete(e[e.length-1])}}let Tze=0;function Cze(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const i=Object.getOwnPropertyDescriptors(t);for(const r in i)if(i[r]!==void 0){const s=i[r];s&&typeof s.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}class wze{constructor(e,t,i,r,s,a,o,l,u,c){this.id=Tze++,this._nodes=e,this._geometries=t,this.renderer=i,this.object=r,this.material=s,this.scene=a,this.camera=o,this.lightsNode=l,this.context=u,this.geometry=r.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=c,this.clippingContextCacheKey=c!==null?c.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,i=[],r=new Set,s={};for(const a of e){let o;if(a.node&&a.node.attribute?o=a.node.attribute:(o=t.getAttribute(a.name),s[a.name]=o.version),o===void 0)continue;i.push(o);const l=o.isInterleavedBufferAttribute?o.data:o;r.add(l)}return this.attributes=i,this.attributesId=s,this.vertexBuffers=Array.from(r.values()),i}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:i,group:r,drawRange:s}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),l=o!==null;let u=1;if(i.isInstancedBufferGeometry===!0?u=i.instanceCount:e.count!==void 0&&(u=Math.max(0,e.count)),u===0)return null;if(a.instanceCount=u,e.isBatchedMesh===!0)return a;let c=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(c=2);let d=s.start*c,f=(s.start+s.count)*c;r!==null&&(d=Math.max(d,r.start*c),f=Math.min(f,(r.start+r.count)*c));const m=i.attributes.position;let y=1/0;l?y=o.count:m!=null&&(y=m.count),d=Math.max(d,0),f=Math.min(f,y);const _=f-d;return _<0||_===1/0?null:(a.vertexCount=_,a.firstVertex=d,a)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const i of Object.keys(e.attributes).sort()){const r=e.attributes[i];t+=i+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const i of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[i];t+="morph-"+i+",";for(let s=0,a=r.length;s<a;s++){const o=r[s];t+=o.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:i}=this;let r=t.customProgramCacheKey();for(const s of Cze(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;const a=t[s];let o;if(a!==null){const l=typeof a;l==="number"?o=a!==0?"1":"0":l==="object"?(o="{",a.isTexture&&(o+=a.mapping,i.backend.isWebGPUBackend===!0&&(o+=a.magFilter,o+=a.minFilter,o+=a.wrapS,o+=a.wrapT,o+=a.wrapR)),o+="}"):o=String(a)}else o=String(a);r+=o+","}return r+=this.clippingContextCacheKey+",",e.geometry&&(r+=this.getGeometryCacheKey()),e.skeleton&&(r+=e.skeleton.bones.length+","),e.isBatchedMesh&&(r+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(r+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(r+=e.uuid+","),r+=this.context.id+",",r+=e.receiveShadow+",",oA(r)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const i=this.geometry.getAttribute(t);if(i===void 0||e[t]!==i.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=JS(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=JS(e,1)),e=JS(e,this.camera.id,this.renderer.contextNode.id,this.renderer.contextNode.version),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const ex=[];class Eze{constructor(e,t,i,r,s,a){this.renderer=e,this.nodes=t,this.geometries=i,this.pipelines=r,this.bindings=s,this.info=a,this.chainMaps={}}get(e,t,i,r,s,a,o,l){const u=this.getChainMap(l);ex[0]=e,ex[1]=t,ex[2]=a,ex[3]=s;let c=u.get(ex);return c===void 0?(c=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,i,r,s,a,o,l),u.set(ex,c)):(c.updateClipping(o),c.needsGeometryUpdate&&c.setGeometry(e.geometry),(c.version!==t.version||c.needsUpdate)&&(c.initialCacheKey!==c.getCacheKey()?(c.dispose(),c=this.get(e,t,i,r,s,a,o,l)):c.version=t.version)),ex.length=0,c}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Jf)}dispose(){this.chainMaps={}}createRenderObject(e,t,i,r,s,a,o,l,u,c,d){const f=this.getChainMap(d),m=new wze(e,t,i,r,s,a,o,l,u,c);return m.onDispose=()=>{this.pipelines.delete(m),this.bindings.deleteForRender(m),this.nodes.delete(m),f.delete(m.getChainArray())},m}}class n1{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const Rd={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},ky=16,Rze=211,Pze=212;class Dze extends n1{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const i=this.get(e);if(i.version===void 0)t===Rd.VERTEX?this.backend.createAttribute(e):t===Rd.INDEX?this.backend.createIndexAttribute(e):t===Rd.STORAGE?this.backend.createStorageAttribute(e):t===Rd.INDIRECT&&this.backend.createIndirectStorageAttribute(e),i.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(i.version<r.version||r.usage===bh)&&(this.backend.updateAttribute(e),i.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function Eae(n){return n.index!==null?n.index.version:n.attributes.position.version}function Yj(n){const e=[],t=n.index,i=n.attributes.position;if(t!==null){const s=t.array;for(let a=0,o=s.length;a<o;a+=3){const l=s[a+0],u=s[a+1],c=s[a+2];e.push(l,u,u,c,c,l)}}else{const s=i.array;for(let a=0,o=s.length/3-1;a<o;a+=3){const l=a+0,u=a+1,c=a+2;e.push(l,u,u,c,c,l)}}const r=new(I9(e)?cR:uR)(e,1);return r.version=Eae(n),r}class Nze extends n1{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,i=this.get(t);i.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const s=t.index,a=e.getAttributes();s!==null&&this.attributes.delete(s);for(const l of a)this.attributes.delete(l);const o=this.wireframes.get(t);o!==void 0&&this.attributes.delete(o),t.removeEventListener("dispose",r),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",r),this._geometryDisposeListeners.set(t,r)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,Rd.STORAGE):this.updateAttribute(s,Rd.VERTEX);const i=this.getIndex(e);i!==null&&this.updateAttribute(i,Rd.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,Rd.INDIRECT)}updateAttribute(e,t){const i=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,i)):this.attributeCall.get(e.data)!==i&&(this.attributes.update(e,t),this.attributeCall.set(e.data,i),this.attributeCall.set(e,i)):this.attributeCall.get(e)!==i&&(this.attributes.update(e,t),this.attributeCall.set(e,i))}getIndirect(e){return e.geometry.indirect}getIndirectOffset(e){return e.geometry.indirectOffset}getIndex(e){const{geometry:t,material:i}=e;let r=t.index;if(i.wireframe===!0){const s=this.wireframes;let a=s.get(t);a===void 0?(a=Yj(t),s.set(t,a)):a.version!==Eae(t)&&(this.attributes.delete(a),a=Yj(t),s.set(t,a)),r=a}return r}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class Bze{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,i){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=i*(t/3):e.isPoints?this.render.points+=i*t:e.isLineSegments?this.render.lines+=i*(t/2):e.isLine?this.render.lines+=i*(t-1):Tt("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class Rae{constructor(e){this.cacheKey=e,this.usedTimes=0}}class Fze extends Rae{constructor(e,t,i){super(e),this.vertexProgram=t,this.fragmentProgram=i}}class Lze extends Rae{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let Ize=0;class LO{constructor(e,t,i,r=null,s=null){this.id=Ize++,this.code=e,this.stage=t,this.name=i,this.transforms=r,this.attributes=s,this.usedTimes=0}}class Gze extends n1{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:i}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const a=this.nodes.getForCompute(e);let o=this.programs.compute.get(a.computeShader);o===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),o=new LO(a.computeShader,"compute",e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,o),i.createProgram(o));const l=this._getComputeCacheKey(e,o);let u=this.caches.get(l);u===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),u=this._getComputePipeline(e,o,l,t)),u.usedTimes++,o.usedTimes++,r.version=e.version,r.pipeline=u}return r.pipeline}getForRender(e,t=null){const{backend:i}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const a=e.getNodeBuilderState(),o=e.material?e.material.name:"";let l=this.programs.vertex.get(a.vertexShader);l===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),l=new LO(a.vertexShader,"vertex",o),this.programs.vertex.set(a.vertexShader,l),i.createProgram(l));let u=this.programs.fragment.get(a.fragmentShader);u===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),u=new LO(a.fragmentShader,"fragment",o),this.programs.fragment.set(a.fragmentShader,u),i.createProgram(u));const c=this._getRenderCacheKey(e,l,u);let d=this.caches.get(c);d===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),d=this._getRenderPipeline(e,l,u,c,t)):e.pipeline=d,d.usedTimes++,l.usedTimes++,u.usedTimes++,r.pipeline=d}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,i,r){i=i||this._getComputeCacheKey(e,t);let s=this.caches.get(i);return s===void 0&&(s=new Lze(i,t),this.caches.set(i,s),this.backend.createComputePipeline(s,r)),s}_getRenderPipeline(e,t,i,r,s){r=r||this._getRenderCacheKey(e,t,i);let a=this.caches.get(r);return a===void 0&&(a=new Fze(r,t,i),this.caches.set(r,a),e.pipeline=a,this.backend.createRenderPipeline(e,s)),a}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,i){return t.id+","+i.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,i=e.stage;this.programs[i].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class Oze extends n1{constructor(e,t,i,r,s,a){super(),this.backend=e,this.textures=i,this.pipelines=s,this.attributes=r,this.nodes=t,this.info=a,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const i of t){const r=this.get(i);r.bindGroup===void 0&&(this._init(i),this.backend.createBindings(i,t,0),r.bindGroup=i)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const i of t){const r=this.get(i);r.bindGroup===void 0&&(this._init(i),this.backend.createBindings(i,t,0),r.bindGroup=i)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const i of t)this.backend.deleteBindGroupData(i),this.delete(i)}deleteForRender(e){const t=e.getBindings();for(const i of t)this.backend.deleteBindGroupData(i),this.delete(i)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const i=t.attribute,r=i.isIndirectStorageBufferAttribute?Rd.INDIRECT:Rd.STORAGE;this.attributes.update(i,r)}}_update(e,t){const{backend:i}=this;let r=!1,s=!0,a=0,o=0;for(const l of e.bindings)if(this.nodes.updateGroup(l)!==!1){if(l.isStorageBuffer){const c=l.attribute,d=c.isIndirectStorageBufferAttribute?Rd.INDIRECT:Rd.STORAGE;this.attributes.update(c,d)}if(l.isUniformBuffer)l.update()&&i.updateBinding(l);else if(l.isSampledTexture){const c=l.update(),d=l.texture,f=this.textures.get(d);if(c&&(this.textures.updateTexture(d),l.generation!==f.generation&&(l.generation=f.generation,r=!0,s=!1)),i.get(d).externalTexture!==void 0||f.isDefaultTexture?s=!1:(a=a*10+d.id,o+=d.version),d.isStorageTexture===!0&&d.mipmapsAutoUpdate===!0){const y=this.get(d);l.store===!0?y.needsMipmap=!0:this.textures.needsMipmaps(d)&&y.needsMipmap===!0&&(this.backend.generateMipmaps(d),y.needsMipmap=!1)}}else if(l.isSampler&&l.update()){const d=this.textures.updateSampler(l.texture);l.samplerKey!==d&&(l.samplerKey=d,r=!0,s=!1)}}r===!0&&this.backend.updateBindings(e,t,s?a:0,o)}}function Uze(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?n.z-e.z:n.id-e.id}function Kj(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function $j(n){return(n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode)&&n.side===fr&&n.forceSinglePass===!1}class kze{constructor(e,t,i){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,i),this.lightsArray=[],this.scene=t,this.camera=i,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,i,r,s,a,o){let l=this.renderItems[this.renderItemsIndex];return l===void 0?(l={id:e.id,object:e,geometry:t,material:i,groupOrder:r,renderOrder:e.renderOrder,z:s,group:a,clippingContext:o},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=t,l.material=i,l.groupOrder=r,l.renderOrder=e.renderOrder,l.z=s,l.group=a,l.clippingContext=o),this.renderItemsIndex++,l}push(e,t,i,r,s,a,o){const l=this.getNextRenderItem(e,t,i,r,s,a,o);e.occlusionTest===!0&&this.occlusionQueryCount++,i.transparent===!0||i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode||i.backdropNode&&i.backdropNode.isNode?($j(i)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,t,i,r,s,a,o){const l=this.getNextRenderItem(e,t,i,r,s,a,o);i.transparent===!0||i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode||i.backdropNode&&i.backdropNode.isNode?($j(i)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||Uze),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||Kj),this.transparent.length>1&&this.transparent.sort(t||Kj)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const i=this.renderItems[e];if(i.id===null)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.groupOrder=null,i.renderOrder=null,i.z=null,i.group=null,i.clippingContext=null}}}const oC=[];class zze{constructor(e){this.lighting=e,this.lists=new Jf}get(e,t){const i=this.lists;oC[0]=e,oC[1]=t;let r=i.get(oC);return r===void 0&&(r=new kze(this.lighting,e,t),i.set(oC,r)),oC.length=0,r}dispose(){this.lists=new Jf}}let Vze=0;class Hze{constructor(){this.id=Vze++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new si,this.scissor=!1,this.scissorValue=new si,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return Pae(this)}}function Pae(n){const{textures:e,activeCubeFace:t,activeMipmapLevel:i}=n,r=[t,i];for(const s of e)r.push(s.id);return Fb(r)}const hS=[],Xze=new Wc,Wze=new Eb;class Zze{constructor(){this.chainMaps={}}get(e,t,i=null,r=null){hS[0]=e,hS[1]=t,r!==null&&(hS[2]=r);let s;if(i===null)s="default";else{const l=i.texture.format;s=`${i.textures.length}:${l}:${i.samples}:${i.depthBuffer}:${i.stencilBuffer}`}const a=this._getChainMap(s);let o=a.get(hS);return o===void 0&&(o=new Hze,a.set(hS,o)),hS.length=0,i!==null&&(o.sampleCount=i.samples===0?1:i.samples),o}getForClear(e=null){return this.get(Xze,Wze,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Jf)}dispose(){this.chainMaps={}}}const jze=new re;class Yze extends n1{constructor(e,t,i){super(),this.renderer=e,this.backend=t,this.info=i}updateRenderTarget(e,t=0){const i=this.get(e),r=e.samples===0?1:e.samples,s=i.depthTextureMips||(i.depthTextureMips={}),a=e.textures,o=this.getSize(a[0]),l=o.width>>t,u=o.height>>t;let c=e.depthTexture||s[t];const d=e.depthBuffer===!0||e.stencilBuffer===!0;let f=!1;c===void 0&&d&&(c=new po,c.format=e.stencilBuffer?bl:Xo,c.type=e.stencilBuffer?jl:qr,c.image.width=l,c.image.height=u,c.image.depth=o.depth,c.renderTarget=e,c.isArrayTexture=e.multiview===!0&&o.depth>1,s[t]=c),(i.width!==o.width||o.height!==i.height)&&(f=!0,c&&(c.needsUpdate=!0,c.image.width=l,c.image.height=u,c.image.depth=c.isArrayTexture?c.image.depth:1)),i.width=o.width,i.height=o.height,i.textures=a,i.depthTexture=c||null,i.depth=e.depthBuffer,i.stencil=e.stencilBuffer,i.renderTarget=e,i.sampleCount!==r&&(f=!0,c&&(c.needsUpdate=!0),i.sampleCount=r);const m={sampleCount:r};if(e.isXRRenderTarget!==!0){for(let y=0;y<a.length;y++){const _=a[y];f&&(_.needsUpdate=!0),this.updateTexture(_,m)}c&&this.updateTexture(c,m)}i.initialized!==!0&&(i.initialized=!0,i.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",i.onDispose))}updateTexture(e,t={}){const i=this.get(e);if(i.initialized===!0&&i.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(r&&i.initialized===!0&&s.destroyTexture(e),e.isFramebufferTexture){const u=this.renderer.getRenderTarget();u?e.type=u.texture.type:e.type=br}const{width:a,height:o,depth:l}=this.getSize(e);if(t.width=a,t.height=o,t.depth=l,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,a,o):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,r||e.isStorageTexture===!0||e.isExternalTexture===!0)s.createTexture(e,t),i.generation=e.version;else if(e.version>0){const u=e.image;if(u===void 0)mt("Renderer: Texture marked for update but image is undefined.");else if(u.complete===!1)mt("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const d=[];for(const f of e.images)d.push(f);t.images=d}else t.image=u;(i.isDefaultTexture===void 0||i.isDefaultTexture===!0)&&(s.createTexture(e,t),i.isDefaultTexture=!1,i.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t);const c=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!c&&s.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else s.createDefaultTexture(e),i.isDefaultTexture=!0,i.generation=e.version;i.initialized!==!0&&(i.initialized=!0,i.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&di.enabled===!0&&di.getTransfer(e.colorSpace)!==Hn&&mt("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),i.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",i.onDispose)),i.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=jze){let i=e.images?e.images[0]:e.image;return i?(i.image!==void 0&&(i=i.image),typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?(t.width=i.videoWidth||1,t.height=i.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&i instanceof VideoFrame?(t.width=i.displayWidth||1,t.height=i.displayHeight||1,t.depth=1):(t.width=i.width||1,t.height=i.height||1,t.depth=e.isCubeTexture?6:i.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,i){let r;return e.mipmaps.length>0?r=e.mipmaps.length:e.isCompressedTexture===!0?r=1:r=Math.floor(Math.log2(Math.max(t,i)))+1,r}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),i=t.textures,r=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let s=0;s<i.length;s++)this._destroyTexture(i[s]);r&&this._destroyTexture(r),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const i=t.isDefaultTexture;this.backend.destroyTexture(e,i),this.delete(e),this.info.memory.textures--}}}class Q4 extends en{constructor(e,t,i,r=1){super(e,t,i),this.a=r}set(e,t,i,r=1){return this.a=r,super.set(e,t,i)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class eH extends ss{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const i=this.getNodeType(e),r=e.getStructTypeNode(i);let s;return r!==null?s=r.getMemberType(e,t):(Tt(`TSL: Member "${t}" not found in struct "${i}".`),s="float"),s}getHash(){return this.uuid}generate(){return this.name}}const Kze=(n,e)=>new eH(n,e);class Dae extends Wn{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e,t=this.nodes.length){return e.isNode!==!0?(Tt("TSL: Invalid node added to stack."),this):(this.nodes.splice(t,0,e),this)}addToStackBefore(e){const t=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(e,t)}If(e,t){const i=new VS(t);return this._currentCond=Zl(e,i),this.addToStack(this._currentCond)}ElseIf(e,t){const i=new VS(t),r=Zl(e,i);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new VS(e),this}Switch(e){return this._expressionNode=Dn(e),this}Case(...e){const t=[];if(e.length>=2)for(let o=0;o<e.length-1;o++)t.push(this._expressionNode.equal(Dn(e[o])));else Tt("TSL: Invalid parameter length. Case() requires at least two parameters.");const i=e[e.length-1],r=new VS(i);let s=t[0];for(let o=1;o<t.length;o++)s=s.or(t[o]);const a=Zl(s,r);return this._currentCond===null?(this._currentCond=a,this.addToStack(this._currentCond)):(this._currentCond.elseNode=a,this._currentCond=a,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let i=0;for(const r of this.getChildren())r.isVarNode&&r.isIntent(e)&&r.isAssign(e)!==!0||(t["node"+i++]=r);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const i=IV(),r=e.buildStage;eE(this),e.setActiveStack(this);const s=u=>{if(this._currentNode=u,!(u.isVarNode&&u.isIntent(e)&&u.isAssign(e)!==!0)){if(r==="setup")u.build(e);else if(r==="analyze")u.build(e,this);else if(r==="generate"){const c=e.getDataFromNode(u,"any").stages,d=c&&c[e.shaderStage];if(u.isVarNode&&d&&d.length===1&&d[0]&&d[0].isStackNode)return;u.build(e,"void")}}},a=[...this.nodes];for(const u of a)s(u);this._currentNode=null;const o=this.nodes.filter(u=>a.indexOf(u)===-1);for(const u of o)s(u);let l;return this.hasOutput?l=this.outputNode.build(e,...t):l=super.build(e,...t),eE(i),e.removeActiveStack(this),l}}const jN=Ri(Dae).setParameterLength(0,1);function $ze(n){return Object.entries(n).map(([e,t])=>typeof t=="string"?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}class Nae extends Wn{static get type(){return"StructTypeNode"}constructor(e,t=null){super("struct"),this.membersLayout=$ze(e),this.name=t,this.isStructLayoutNode=!0}getLength(){const e=Float32Array.BYTES_PER_ELEMENT;let t=1,i=0;for(const r of this.membersLayout){const s=r.type,a=Ene(s),o=Rne(s)/e;t=Math.max(t,o);const u=i%t%o;u!==0&&(i+=o-u),i+=a}return Math.ceil(i/t)*t}getMemberType(e,t){const i=this.membersLayout.find(r=>r.name===t);return i?i.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}}class Bae extends Wn{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),i=t.type,r=e.getPropertyName(t);return e.addLineFlowCode(`${r} = ${e.generateStruct(i,this.structTypeNode.membersLayout,this.values)}`,this),t.name}}const Jze=(n,e=null)=>{const t=new Nae(n,e),i=(...r)=>{let s=null;if(r.length>0)if(r[0].isNode){s={};const a=Object.keys(n);for(let o=0;o<r.length;o++)s[a[o]]=r[o]}else s=r[0];return new Bae(t,s)};return i.layout=t,i.isStruct=!0,i};class tH extends Wn{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(t.membersLayout===void 0){const i=this.members,r=[];for(let s=0;s<i.length;s++){const a="m"+s,o=i[s].getNodeType(e);r.push({name:a,type:o,index:s})}t.membersLayout=r,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),i=this.members,r=t!==""?t+".":"";for(let s=0;s<i.length;s++){const a=i[s].build(e);e.addLineFlowCode(`${r}m${s} = ${a}`,this)}return t}}const qze=Ri(tH);function Fae(n,e){for(let t=0;t<n.length;t++)if(n[t].name===e)return t;return-1}class Lae extends tH{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return Iae(t)}setup(e){const t=this.outputNodes,i=e.renderer.getRenderTarget(),r=[],s=i.textures;for(const a in t){const o=Fae(s,a);r[o]=Un(t[a])}return this.members=r,super.setup(e)}}const Iae=Ri(Lae);class hA extends Ca{static get type(){return"BitcastNode"}constructor(e,t,i=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=i,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),i=e.getTypeLength(t);return e.getTypeFromLength(i,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let i="";if(this.inputType!==null){const r=this.valueNode.getNodeType(e);i=e.getTypeLength(r)===1?this.inputType:e.changeComponentType(r,this.inputType)}else i=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,i)}( ${this.valueNode.build(e,i)} )`}}const Gae=dn(hA).setParameterLength(2),Qze=n=>new hA(n,"int","float"),Oae=n=>new hA(n,"uint","float"),e9e=n=>new hA(n,"float","int"),t9e=n=>new hA(n,"float","uint"),ED={};class Ch extends ht{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,i){i==="int"?t.assign(Gae(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return Yt;case"int":return Le;case"uvec2":return GV;case"uvec3":return Lb;case"uvec4":return zV;case"ivec2":return ko;case"ivec3":return OV;case"ivec4":return kV}}_createTrailingZerosBaseLayout(e,t){const i=this._returnDataNode(t);return We(([s])=>{const a=Yt(0);this._resolveElementType(s,a,t);const o=ge(a.bitAnd(t4(a))),u=Oae(o).shiftRight(23).sub(127);return i(u)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createLeadingZerosBaseLayout(e,t){const i=this._returnDataNode(t);return We(([s])=>{Kn(s.equal(Yt(0)),()=>Yt(32));const a=Yt(0),o=Yt(0);return this._resolveElementType(s,a,t),Kn(a.shiftRight(16).equal(0),()=>{o.addAssign(16),a.shiftLeftAssign(16)}),Kn(a.shiftRight(24).equal(0),()=>{o.addAssign(8),a.shiftLeftAssign(8)}),Kn(a.shiftRight(28).equal(0),()=>{o.addAssign(4),a.shiftLeftAssign(4)}),Kn(a.shiftRight(30).equal(0),()=>{o.addAssign(2),a.shiftLeftAssign(2)}),Kn(a.shiftRight(31).equal(0),()=>{o.addAssign(1)}),i(o)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createOneBitsBaseLayout(e,t){const i=this._returnDataNode(t);return We(([s])=>{const a=Yt(0);this._resolveElementType(s,a,t),a.assign(a.sub(a.shiftRight(Yt(1)).bitAnd(Yt(1431655765)))),a.assign(a.bitAnd(Yt(858993459)).add(a.shiftRight(Yt(2)).bitAnd(Yt(858993459))));const o=a.add(a.shiftRight(Yt(4))).bitAnd(Yt(252645135)).mul(Yt(16843009)).shiftRight(Yt(24));return i(o)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createMainLayout(e,t,i,r){const s=this._returnDataNode(t);return We(([o])=>{if(i===1)return s(r(o));{const l=s(0),u=["x","y","z","w"];for(let c=0;c<i;c++){const d=u[c];l[d].assign(r(o[d]))}return l}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}setup(e){const{method:t,aNode:i}=this,{renderer:r}=e;if(r.backend.isWebGPUBackend)return super.setup(e);const s=this.getInputType(e),a=e.getElementType(s),o=e.getTypeLength(s),l=`${t}_base_${a}`,u=`${t}_${s}`;let c=ED[l];if(c===void 0){switch(t){case Ch.COUNT_LEADING_ZEROS:{c=this._createLeadingZerosBaseLayout(l,a);break}case Ch.COUNT_TRAILING_ZEROS:{c=this._createTrailingZerosBaseLayout(l,a);break}case Ch.COUNT_ONE_BITS:{c=this._createOneBitsBaseLayout(l,a);break}}ED[l]=c}let d=ED[u];return d===void 0&&(d=this._createMainLayout(u,s,o,c),ED[u]=d),We(()=>d(i))()}}Ch.COUNT_TRAILING_ZEROS="countTrailingZeros";Ch.COUNT_LEADING_ZEROS="countLeadingZeros";Ch.COUNT_ONE_BITS="countOneBits";const n9e=dn(Ch,Ch.COUNT_TRAILING_ZEROS).setParameterLength(1),i9e=dn(Ch,Ch.COUNT_LEADING_ZEROS).setParameterLength(1),r9e=dn(Ch,Ch.COUNT_ONE_BITS).setParameterLength(1),s9e=We(([n])=>{const e=n.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),bk=(n,e)=>wd(Ci(4,n.mul(Dr(1,n))),e),a9e=(n,e)=>n.lessThan(.5)?bk(n.mul(2),e).div(2):Dr(1,bk(Ci(Dr(1,n),2),e).div(2)),o9e=(n,e,t)=>wd(Eh(wd(n,e),Eo(wd(n,e),wd(Dr(1,n),t))),1/e),l9e=(n,e)=>Wu(XB.mul(e.mul(n).sub(1))).div(XB.mul(e.mul(n).sub(1)));class nH extends Ca{static get type(){return"PackFloatNode"}constructor(e,t){super(),this.vectorNode=t,this.encoding=e,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(e){const t=this.vectorNode.getNodeType(e);return`${e.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(e,t)})`}}const u9e=dn(nH,"snorm").setParameterLength(1),c9e=dn(nH,"unorm").setParameterLength(1),h9e=dn(nH,"float16").setParameterLength(1);class iH extends Ca{static get type(){return"UnpackFloatNode"}constructor(e,t){super(),this.uintNode=t,this.encoding=e,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(e){const t=this.uintNode.getNodeType(e);return`${e.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(e,t)})`}}const d9e=dn(iH,"snorm").setParameterLength(1),f9e=dn(iH,"unorm").setParameterLength(1),p9e=dn(iH,"float16").setParameterLength(1),Ug=We(([n])=>n.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),m9e=We(([n])=>Ge(Ug(n.z.add(Ug(n.y.mul(1)))),Ug(n.z.add(Ug(n.x.mul(1)))),Ug(n.y.add(Ug(n.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),g9e=We(([n,e,t])=>{const i=Ge(n).toVar(),r=ge(1.4).toVar(),s=ge(0).toVar(),a=Ge(i).toVar();return fs({start:ge(0),end:ge(3),type:"float",condition:"<="},()=>{const o=Ge(m9e(a.mul(2))).toVar();i.addAssign(o.add(t.mul(ge(.1).mul(e)))),a.mulAssign(1.8),r.mulAssign(1.5),i.mulAssign(1.2);const l=ge(Ug(i.z.add(Ug(i.x.add(Ug(i.y)))))).toVar();s.addAssign(l.div(r)),a.addAssign(.14)}),s}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class Uae extends Wn{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){const t=this.parametersNodes;let i=this._candidateFn;if(i===null){let r=null,s=-1;for(const a of this.functionNodes){const l=a.shaderNode.layout;if(l===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const u=l.inputs;if(t.length===u.length){let c=0;for(let d=0;d<t.length;d++){const f=t[d],m=u[d];f.getNodeType(e)===m.type&&c++}c>s&&(r=a,s=c)}}this._candidateFn=i=r}return i}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}const y9e=Ri(Uae),Jl=n=>(...e)=>y9e(n,...e),dA=Qn(0).setGroup(ti).onRenderUpdate(n=>n.time),v9e=Qn(0).setGroup(ti).onRenderUpdate(n=>n.deltaTime),kae=Qn(0,"uint").setGroup(ti).onRenderUpdate(n=>n.frameId),x9e=(n=dA)=>n.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),b9e=(n=dA)=>n.fract().round(),_9e=(n=dA)=>n.add(.5).fract().mul(2).sub(1).abs(),S9e=(n=dA)=>n.fract();function M9e(n,e=null){return E0(e,{getUV:n})}const A9e=We(([n,e,t=nn(.5)])=>zR(n.sub(t),e).add(t)),T9e=We(([n,e,t=nn(.5)])=>{const i=n.sub(t),r=i.dot(i),a=r.mul(r).mul(e);return n.add(i.mul(a))}),C9e=We(({position:n=null,horizontal:e=!0,vertical:t=!1})=>{let i;n!==null?(i=Ed.toVar(),i[3][0]=n.x,i[3][1]=n.y,i[3][2]=n.z):i=Ed;const r=Fh.mul(i);return Qw(e)&&(r[0][0]=Ed[0].length(),r[0][1]=0,r[0][2]=0),Qw(t)&&(r[1][0]=0,r[1][1]=Ed[1].length(),r[1][2]=0),r[2][0]=0,r[2][1]=0,r[2][2]=1,ju.mul(r).mul(Ia)}),w9e=We(([n=null])=>{const e=AM();return AM(U4(n)).sub(e).lessThan(0).select(t0,n)});class zae extends Wn{static get type(){return"SpriteSheetUVNode"}constructor(e,t=_s(),i=ge(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=i}setup(){const{frameNode:e,uvNode:t,countNode:i}=this,{width:r,height:s}=i,a=e.mod(r.mul(s)).floor(),o=a.mod(r),l=s.sub(a.add(1).div(r).ceil()),u=i.reciprocal(),c=nn(o,l);return t.add(c).mul(u)}}const E9e=Ri(zae).setParameterLength(3),Vae=We(([n,e=null,t=null,i=ge(1),r=Ia,s=jc])=>{let a=s.abs().normalize();a=a.div(a.dot(Ge(1)));const o=r.yz.mul(i),l=r.zx.mul(i),u=r.xy.mul(i),c=n.value,d=e!==null?e.value:c,f=t!==null?t.value:c,m=Qr(c,o).mul(a.x),y=Qr(d,l).mul(a.y),_=Qr(f,u).mul(a.z);return Eo(m,y,_)}),R9e=(...n)=>Vae(...n),dS=new Xl,tx=new re,fS=new re,IO=new re,lC=new Mn,RD=new re(0,0,-1),jp=new si,uC=new re,PD=new re,cC=new si,DD=new rt,KB=new Wd,P9e=t0.flipX();KB.depthTexture=new po(1,1);let ND=!1;class iL extends $f{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||KB.texture,P9e),this._reflectorBaseNode=e.reflector||new D9e(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=Dn(new iL({defaultTexture:KB.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class D9e extends Wn{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:i=new Br,resolutionScale:r=1,generateMipmaps:s=!1,bounces:a=!0,depth:o=!1,samples:l=0}=t;this.textureNode=e,this.target=i,this.resolutionScale=r,t.resolution!==void 0&&(hs('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=t.resolution),this.generateMipmaps=s,this.bounces=a,this.depth=o,this.samples=l,this.updateBeforeType=a?Ni.RENDER:Ni.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const i=this.resolutionScale;t.getDrawingBufferSize(DD),e.setSize(Math.round(DD.width*i),Math.round(DD.height*i))}setup(e){return this._updateResolution(KB,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new Wd(0,0,{type:zi,samples:this.samples}),this.generateMipmaps===!0&&(t.texture.minFilter=kw,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new po),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&ND)return!1;ND=!0;const{scene:t,camera:i,renderer:r,material:s}=e,{target:a}=this,o=this.getVirtualCamera(i),l=this.getRenderTarget(o);r.getDrawingBufferSize(DD),this._updateResolution(l,r),fS.setFromMatrixPosition(a.matrixWorld),IO.setFromMatrixPosition(i.matrixWorld),lC.extractRotation(a.matrixWorld),tx.set(0,0,1),tx.applyMatrix4(lC),uC.subVectors(fS,IO);const u=uC.dot(tx)>0;let c=!1;if(u===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){ND=!1;return}c=!0}uC.reflect(tx).negate(),uC.add(fS),lC.extractRotation(i.matrixWorld),RD.set(0,0,-1),RD.applyMatrix4(lC),RD.add(IO),PD.subVectors(fS,RD),PD.reflect(tx).negate(),PD.add(fS),o.coordinateSystem=i.coordinateSystem,o.position.copy(uC),o.up.set(0,1,0),o.up.applyMatrix4(lC),o.up.reflect(tx),o.lookAt(PD),o.near=i.near,o.far=i.far,o.updateMatrixWorld(),o.projectionMatrix.copy(i.projectionMatrix),dS.setFromNormalAndCoplanarPoint(tx,fS),dS.applyMatrix4(o.matrixWorldInverse),jp.set(dS.normal.x,dS.normal.y,dS.normal.z,dS.constant);const d=o.projectionMatrix;cC.x=(Math.sign(jp.x)+d.elements[8])/d.elements[0],cC.y=(Math.sign(jp.y)+d.elements[9])/d.elements[5],cC.z=-1,cC.w=(1+d.elements[10])/d.elements[14],jp.multiplyScalar(1/jp.dot(cC));const f=0;d.elements[2]=jp.x,d.elements[6]=jp.y,d.elements[10]=r.coordinateSystem===ic?jp.z-f:jp.z+1-f,d.elements[14]=jp.w,this.textureNode.value=l.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=l.depthTexture),s.visible=!1;const m=r.getRenderTarget(),y=r.getMRT(),_=r.autoClear;r.setMRT(null),r.setRenderTarget(l),r.autoClear=!0;const S=t.name;t.name=(t.name||"Scene")+" [ Reflector ]",c?(r.clear(),this.hasOutput=!1):(r.render(t,o),this.hasOutput=!0),t.name=S,r.setMRT(y),r.setRenderTarget(m),r.autoClear=_,s.visible=!0,ND=!1,this.forceUpdate=!1}get resolution(){return hs('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(e){hs('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=e}}const N9e=n=>new iL(n),GO=new Tl(-1,1,1,-1,0,1);class B9e extends wi{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new qn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new qn(t,2))}}const F9e=new B9e;class fA extends Fr{constructor(e=null){super(F9e,e),this.camera=GO,this.isQuadMesh=!0}async renderAsync(e){hs('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,GO)}render(e){e.render(this,GO)}}const L9e=new rt;class Hae extends $f{static get type(){return"RTTNode"}constructor(e,t=null,i=null,r={type:zi}){const s=new Wd(t,i,r);super(s.texture,_s()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=i,this.pixelRatio=1,this.renderTarget=s,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new fA(new Js),this.updateBeforeType=Ni.RENDER}get autoResize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const i=e*this.pixelRatio,r=t*this.pixelRatio;this.renderTarget.setSize(i,r),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const r=e.getPixelRatio(),s=e.getSize(L9e),a=Math.floor(s.width*r),o=Math.floor(s.height*r);(a!==this.renderTarget.width||o!==this.renderTarget.height)&&(this.renderTarget.setSize(a,o),this.textureNeedsUpdate=!0)}let t="RTT";this.node.name&&(t=this.node.name+" [ "+t+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;const i=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(i)}clone(){const e=new $f(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const Xae=(n,...e)=>Dn(new Hae(Dn(n),...e)),I9e=(n,...e)=>n.isSampleNode||n.isTextureNode?n:n.isPassNode?n.getTextureNode():Xae(n,...e),GS=We(([n,e,t],i)=>{let r;i.renderer.coordinateSystem===ic?(n=nn(n.x,n.y.oneMinus()).mul(2).sub(1),r=Un(Ge(n,e),1)):r=Un(Ge(n.x,n.y.oneMinus(),e).mul(2).sub(1),1);const s=Un(t.mul(r));return s.xyz.div(s.w)}),G9e=We(([n,e])=>{const t=e.mul(Un(n,1)),i=t.xy.div(t.w).mul(.5).add(.5).toVar();return nn(i.x,i.y.oneMinus())}),O9e=We(([n,e,t])=>{const i=e0($a(e)),r=ko(n.mul(i)).toVar(),s=$a(e,r).toVar(),a=$a(e,r.sub(ko(2,0))).toVar(),o=$a(e,r.sub(ko(1,0))).toVar(),l=$a(e,r.add(ko(1,0))).toVar(),u=$a(e,r.add(ko(2,0))).toVar(),c=$a(e,r.add(ko(0,2))).toVar(),d=$a(e,r.add(ko(0,1))).toVar(),f=$a(e,r.sub(ko(0,1))).toVar(),m=$a(e,r.sub(ko(0,2))).toVar(),y=zs(Dr(ge(2).mul(o).sub(a),s)).toVar(),_=zs(Dr(ge(2).mul(l).sub(u),s)).toVar(),S=zs(Dr(ge(2).mul(d).sub(c),s)).toVar(),b=zs(Dr(ge(2).mul(f).sub(m),s)).toVar(),M=GS(n,s,t).toVar(),w=y.lessThan(_).select(M.sub(GS(n.sub(nn(ge(1).div(i.x),0)),o,t)),M.negate().add(GS(n.add(nn(ge(1).div(i.x),0)),l,t))),T=S.lessThan(b).select(M.sub(GS(n.add(nn(0,ge(1).div(i.y))),d,t)),M.negate().add(GS(n.sub(nn(0,ge(1).div(i.y))),f,t)));return nc(m0(w,T))}),rH=We(([n])=>Yf(ge(52.9829189).mul(Yf(Ud(n,nn(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),Gf=We(([n,e,t])=>{const i=ge(2.399963229728653),r=vu(ge(n).add(.5).div(ge(e))),s=ge(n).mul(i).add(t);return nn(Lf(s),Wu(s)).mul(r)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class U9e extends Wn{static get type(){return"SampleNode"}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(_s())}sample(e){return this.callback(e)}}const k9e=(n,e=null)=>new U9e(n,Dn(e));class Qu extends Wn{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===Qu.OBJECT?this.updateType=Ni.OBJECT:e===Qu.MATERIAL?this.updateType=Ni.RENDER:e===Qu.BEFORE_OBJECT?this.updateBeforeType=Ni.OBJECT:e===Qu.BEFORE_MATERIAL&&(this.updateBeforeType=Ni.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}Qu.OBJECT="object";Qu.MATERIAL="material";Qu.BEFORE_OBJECT="beforeObject";Qu.BEFORE_MATERIAL="beforeMaterial";const rL=(n,e)=>new Qu(n,e).toStack(),z9e=n=>rL(Qu.OBJECT,n),V9e=n=>rL(Qu.MATERIAL,n),H9e=n=>rL(Qu.BEFORE_OBJECT,n),X9e=n=>rL(Qu.BEFORE_MATERIAL,n);class Wae extends Vc{constructor(e,t,i=Float32Array){const r=ArrayBuffer.isView(e)?e:new i(e*t);super(r,t),this.isStorageInstancedBufferAttribute=!0}}class sH extends Gi{constructor(e,t,i=Float32Array){const r=ArrayBuffer.isView(e)?e:new i(e*t);super(r,t),this.isStorageBufferAttribute=!0}}const W9e=(n,e="float")=>{let t,i;e.isStruct===!0?(t=e.layout.getLength(),i=qw("float")):(t=TV(e),i=qw(e));const r=new sH(n,t,i);return n0(r,e,n)},Z9e=(n,e="float")=>{let t,i;e.isStruct===!0?(t=e.layout.getLength(),i=qw("float")):(t=TV(e),i=qw(e));const r=new Wae(n,t,i);return n0(r,e,n)};class Zae extends Wn{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const j9e=En(Zae),hC=new Mu,OO=new Mn;class ec extends Wn{static get type(){return"SceneNode"}constructor(e=ec.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,i=this.scene!==null?this.scene:e.scene;let r;return t===ec.BACKGROUND_BLURRINESS?r=Es("backgroundBlurriness","float",i):t===ec.BACKGROUND_INTENSITY?r=Es("backgroundIntensity","float",i):t===ec.BACKGROUND_ROTATION?r=Qn("mat4").setName("backgroundRotation").setGroup(ti).onRenderUpdate(()=>{const s=i.background;return s!==null&&s.isTexture&&s.mapping!==Sm?(hC.copy(i.backgroundRotation),hC.x*=-1,hC.y*=-1,hC.z*=-1,OO.makeRotationFromEuler(hC)):OO.identity(),OO}):Tt("SceneNode: Unknown scope:",t),r}}ec.BACKGROUND_BLURRINESS="backgroundBlurriness";ec.BACKGROUND_INTENSITY="backgroundIntensity";ec.BACKGROUND_ROTATION="backgroundRotation";const jae=En(ec,ec.BACKGROUND_BLURRINESS),_k=En(ec,ec.BACKGROUND_INTENSITY),Yae=En(ec,ec.BACKGROUND_ROTATION);class Kae extends $f{static get type(){return"StorageTextureNode"}constructor(e,t,i=null){super(e,t),this.storeNode=i,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=Ml.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let i;return this.storeNode!==null?i=this.generateStore(e):i=super.generate(e,t),i}toReadWrite(){return this.setAccess(Ml.READ_WRITE)}toReadOnly(){return this.setAccess(Ml.READ_ONLY)}toWriteOnly(){return this.setAccess(Ml.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:i,storeNode:r,depthNode:s}=t,a=super.generate(e,"property"),o=i.build(e,this.value.is3DTexture===!0?"uvec3":"uvec2"),l=r.build(e,"vec4"),u=s?s.build(e,"int"):null,c=e.generateTextureStore(e,a,o,u,l);e.addLineFlowCode(c,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e}}const $ae=Ri(Kae).setParameterLength(1,3),Y9e=(n,e,t)=>{const i=$ae(n,e,t);return t!==null&&i.toStack(),i},K9e=We(({texture:n,uv:e})=>{const i=Ge().toVar();return Kn(e.x.lessThan(1e-4),()=>{i.assign(Ge(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{i.assign(Ge(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{i.assign(Ge(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{i.assign(Ge(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{i.assign(Ge(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{i.assign(Ge(0,0,-1))}).Else(()=>{const s=n.sample(e.add(Ge(-.01,0,0))).r.sub(n.sample(e.add(Ge(.01,0,0))).r),a=n.sample(e.add(Ge(0,-.01,0))).r.sub(n.sample(e.add(Ge(0,.01,0))).r),o=n.sample(e.add(Ge(0,0,-.01))).r.sub(n.sample(e.add(Ge(0,0,.01))).r);i.assign(Ge(s,a,o))}),i.normalize()});class Jae extends $f{static get type(){return"Texture3DNode"}constructor(e,t=null,i=null){super(e,t,i),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return Ge(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const i=this.value;return e.isFlipY()&&(i.isRenderTargetTexture===!0||i.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Le(e0(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return K9e({texture:this,uv:e})}}const sL=Ri(Jae).setParameterLength(1,3),$9e=(...n)=>sL(...n).setSampler(!1),J9e=(n,e,t)=>sL(n,e).level(t);class qae extends OR{static get type(){return"UserDataNode"}constructor(e,t,i=null){super(e,t,i),this.userData=i}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const q9e=(n,e,t)=>new qae(n,e,t),Jj=new WeakMap;class Q9e extends Ca{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=Ni.OBJECT,this.updateAfterType=Ni.OBJECT,this.previousModelWorldMatrix=Qn(new Mn),this.previousProjectionMatrix=Qn(new Mn).setGroup(ti),this.previousCameraViewMatrix=Qn(new Mn)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:i}){const r=qj(i);this.previousModelWorldMatrix.value.copy(r);const s=Qae(t);s.frameId!==e&&(s.frameId=e,s.previousProjectionMatrix===void 0?(s.previousProjectionMatrix=new Mn,s.previousCameraViewMatrix=new Mn,s.currentProjectionMatrix=new Mn,s.currentCameraViewMatrix=new Mn,s.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),s.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(s.previousProjectionMatrix.copy(s.currentProjectionMatrix),s.previousCameraViewMatrix.copy(s.currentCameraViewMatrix)),s.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),s.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(s.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(s.previousCameraViewMatrix))}updateAfter({object:e}){qj(e).copy(e.matrixWorld)}setup(){const e=this.projectionMatrix===null?ju:Qn(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),i=e.mul(wm).mul(Ia),r=this.previousProjectionMatrix.mul(t).mul(ZB),s=i.xy.div(i.w),a=r.xy.div(r.w);return Dr(s,a)}}function Qae(n){let e=Jj.get(n);return e===void 0&&(e={},Jj.set(n,e)),e}function qj(n,e=0){const t=Qae(n);let i=t[e];return i===void 0&&(t[e]=i=new Mn,t[e].copy(n.matrixWorld)),i}const eVe=En(Q9e),tVe=We(([n])=>aH(n.rgb)),nVe=We(([n,e=ge(1)])=>e.mix(aH(n.rgb),n.rgb)),iVe=We(([n,e=ge(1)])=>{const t=Eo(n.r,n.g,n.b).div(3),i=n.r.max(n.g.max(n.b)),r=i.sub(t).mul(e).mul(-3);return vr(n.rgb,i,r)}),rVe=We(([n,e=ge(1)])=>{const t=Ge(.57735,.57735,.57735),i=e.cos();return Ge(n.rgb.mul(i).add(t.cross(n.rgb).mul(e.sin()).add(t.mul(Ud(t,n.rgb).mul(i.oneMinus())))))}),aH=(n,e=Ge(di.getLuminanceCoefficients(new re)))=>Ud(n,e),sVe=We(([n,e=Ge(1),t=Ge(0),i=Ge(1),r=ge(1),s=Ge(di.getLuminanceCoefficients(new re,Su))])=>{const a=n.rgb.dot(Ge(s)),o=ka(n.rgb.mul(e).add(t),0).toVar(),l=o.pow(i).toVar();return Kn(o.r.greaterThan(0),()=>{o.r.assign(l.r)}),Kn(o.g.greaterThan(0),()=>{o.g.assign(l.g)}),Kn(o.b.greaterThan(0),()=>{o.b.assign(l.b)}),o.assign(a.add(o.sub(a).mul(r))),Un(o.rgb,n.a)});class eoe extends Ca{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const aVe=Ri(eoe).setParameterLength(2),BD=new rt;class toe extends $f{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Qj extends toe{static get type(){return"PassMultipleTextureNode"}constructor(e,t,i=!1){super(e,null),this.textureName=t,this.previousTexture=i}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class qf extends Ca{static get type(){return"PassNode"}constructor(e,t,i,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=i,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const s=new po;s.isRenderTargetTexture=!0,s.name="depth";const a=new Wd(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:zi,...r});a.texture.name="output",a.depthTexture=s,this.renderTarget=a,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:a.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Qn(0),this._cameraFar=Qn(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Ni.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return mt("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return mt("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const i=this._textures[e],r=this.renderTarget.textures.indexOf(i);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=i,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=new Qj(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=new Qj(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const i=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=z4(this.getTextureNode(e),i,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const i=this._cameraNear,r=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=iM(s,i,r)}return t}async compileAsync(e){const t=e.getRenderTarget(),i=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(i)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===qf.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:i}=this;let r,s;const a=t.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(s=1,r=t.xr.getCamera(),t.xr.updateCamera(r),BD.set(a.width,a.height)):(r=this.camera,s=t.getPixelRatio(),t.getSize(BD)),this._pixelRatio=s,this.setSize(BD.width,BD.height);const o=t.getRenderTarget(),l=t.getMRT(),u=t.autoClear,c=t.transparent,d=t.opaque,f=r.layers.mask,m=t.contextNode,y=i.overrideMaterial;this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask);for(const S in this._previousTextures)this.toggleTexture(S);this.overrideMaterial!==null&&(i.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:E0({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const _=i.name;i.name=this.name?this.name:i.name,t.render(i,r),i.name=_,i.overrideMaterial=y,t.setRenderTarget(o),t.setMRT(l),t.autoClear=u,t.transparent=c,t.opaque=d,t.contextNode=m,r.layers.mask=f}setSize(e,t){this._width=e,this._height=t;const i=Math.floor(this._width*this._pixelRatio*this._resolutionScale),r=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(i,r),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,i,r){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new si),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,i,r),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,i,r){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new si),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,i,r),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}qf.COLOR="color";qf.DEPTH="depth";const oVe=(n,e,t)=>new qf(qf.COLOR,n,e,t),lVe=(n,e)=>new toe(n,e),uVe=(n,e,t)=>new qf(qf.DEPTH,n,e,t);class noe extends qf{static get type(){return"ToonOutlinePassNode"}constructor(e,t,i,r,s){super(qf.COLOR,e,t),this.colorNode=i,this.thicknessNode=r,this.alphaNode=s,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(e){const{renderer:t}=e,i=t.getRenderObjectFunction();t.setRenderObjectFunction((r,s,a,o,l,u,c,d)=>{if((l.isMeshToonMaterial||l.isMeshToonNodeMaterial)&&l.wireframe===!1){const f=this._getOutlineMaterial(l);t.renderObject(r,s,a,o,f,u,c,d)}t.renderObject(r,s,a,o,l,u,c,d)}),super.updateBefore(e),t.setRenderObjectFunction(i)}_createMaterial(){const e=new Js;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=Er;const t=jc.negate(),i=ju.mul(wm),r=ge(1),s=i.mul(Un(Ia,1)),a=i.mul(Un(Ia.add(t),1)),o=nc(s.sub(a));return e.vertexNode=s.add(o.mul(this.thicknessNode).mul(s.w).mul(r)),e.colorNode=Un(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const cVe=(n,e,t=new en(0,0,0),i=.003,r=1)=>Dn(new noe(n,e,Dn(t),Dn(i),Dn(r))),ioe=We(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),roe=We(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),soe=We(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),i=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(i).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),hVe=We(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),aoe=We(([n,e])=>{const t=Yl(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),i=Yl(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=hVe(n),n=i.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),dVe=Yl(Ge(1.6605,-.1246,-.0182),Ge(-.5876,1.1329,-.1006),Ge(-.0728,-.0083,1.1187)),fVe=Yl(Ge(.6274,.0691,.0164),Ge(.3293,.9195,.088),Ge(.0433,.0113,.8956)),pVe=We(([n])=>{const e=Ge(n).toVar(),t=Ge(e.mul(e)).toVar(),i=Ge(t.mul(t)).toVar();return ge(15.5).mul(i.mul(t)).sub(Ci(40.14,i.mul(e))).add(Ci(31.96,i).sub(Ci(6.868,t.mul(e))).add(Ci(.4298,t).add(Ci(.1191,e).sub(.00232))))}),ooe=We(([n,e])=>{const t=Ge(n).toVar(),i=Yl(Ge(.856627153315983,.137318972929847,.11189821299995),Ge(.0951212405381588,.761241990602591,.0767994186031903),Ge(.0482516061458583,.101439036467562,.811302368396859)),r=Yl(Ge(1.1271005818144368,-.1413297634984383,-.14132976349843826),Ge(-.11060664309660323,1.157823702216272,-.11060664309660294),Ge(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=ge(-12.47393),a=ge(4.026069);return t.mulAssign(e),t.assign(fVe.mul(t)),t.assign(i.mul(t)),t.assign(ka(t,1e-10)),t.assign(dm(t)),t.assign(t.sub(s).div(a.sub(s))),t.assign(Kf(t,0,1)),t.assign(pVe(t)),t.assign(r.mul(t)),t.assign(wd(ka(Ge(0),t),Ge(2.2))),t.assign(dVe.mul(t)),t.assign(Kf(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),loe=We(([n,e])=>{const t=ge(.76),i=ge(.15);n=n.mul(e);const r=Zc(n.r,Zc(n.g,n.b)),s=Zl(r.lessThan(.08),r.sub(Ci(6.25,r.mul(r))),.04);n.subAssign(s);const a=ka(n.r,ka(n.g,n.b));Kn(a.lessThan(t),()=>n);const o=Dr(1,t),l=Dr(1,o.mul(o).div(a.add(o.sub(t))));n.mulAssign(l.div(a));const u=Dr(1,Eh(1,i.mul(a.sub(l)).add(1)));return vr(n,Ge(l),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Qo extends Wn{static get type(){return"CodeNode"}constructor(e="",t=[],i=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=i}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const i=e.getCodeFromNode(this,this.getNodeType(e));return i.code=this.code,i.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const aL=Ri(Qo).setParameterLength(1,3),mVe=(n,e)=>aL(n,e,"js"),gVe=(n,e)=>aL(n,e,"wgsl"),yVe=(n,e)=>aL(n,e,"glsl");class oH extends Qo{static get type(){return"FunctionNode"}constructor(e="",t=[],i=""){super(e,t,i)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const i=this.getNodeType(e);return e.getStructTypeNode(i).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let i=t.nodeFunction;return i===void 0&&(i=e.parser.parseFunction(this.code),t.nodeFunction=i),i}generate(e,t){super.generate(e);const i=this.getNodeFunction(e),r=i.name,s=i.type,a=e.getCodeFromNode(this,s);r!==""&&(a.name=r);const o=e.getPropertyName(a),l=this.getNodeFunction(e).getCode(o);return a.code=l+`
`,t==="property"?o:e.format(`${o}()`,s,t)}}const uoe=(n,e=[],t="")=>{for(let s=0;s<e.length;s++){const a=e[s];typeof a=="function"&&(e[s]=a.functionNode)}const i=new oH(n,e,t),r=(...s)=>i.call(...s);return r.functionNode=i,r},vVe=(n,e)=>uoe(n,e,"glsl"),xVe=(n,e)=>uoe(n,e,"wgsl");class coe extends Wn{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new wl,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:ge()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=wV(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=EV(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const YN=Ri(coe).setParameterLength(1);class hoe extends Map{get(e,t=null,...i){if(this.has(e))return super.get(e);if(t!==null){const r=t(...i);return this.set(e,r),r}}}class bVe{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const KN=new hoe;class doe extends Wn{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new hoe,this._output=YN(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const i=this._outputs;return i[e]===void 0?i[e]=YN(t):i[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const i=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),i[e]=t,i[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),i[e]=t,i[e].events.addEventListener("refresh",this.onRefresh)):i[e]===void 0?(i[e]=YN(t),i[e].events.addEventListener("refresh",this.onRefresh)):i[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const r=this.getObject()[e];if(typeof r=="function")return r(...t)}async callAsync(e,...t){const r=this.getObject()[e];if(typeof r=="function")return r.constructor.name==="AsyncFunction"?await r(...t):r(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(u,c)=>this.setOutput(u,c),i=new bVe(this),r=KN.get("THREE"),s=KN.get("TSL"),a=this.getMethod(),o=[i,this._local,KN,e,t,r,s];this._object=a(...o);const l=this._object.layout;if(l&&(l.cache===!1&&this._local.clear(),this._output.outputType=l.outputType||null,Array.isArray(l.elements)))for(const u of l.elements){const c=u.id||u.name;u.inputType&&(this.getParameter(c)===void 0&&this.setParameter(c,null),this.getParameter(c).inputType=u.inputType),u.outputType&&(this.getOutput(c)===void 0&&this.setOutput(c,null),this.getOutput(c).outputType=u.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let i=this.parameters[t];i.isScriptableNode&&(i=i.getDefaultOutput()),i.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:ge()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],i=["layout","init","main","dispose"].join(", "),r="var "+i+`; var output = {};
`,s=`
return { ...output, `+i+" };",a=r+this.codeNode.code+s;return this._method=new Function(...e,a),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[oA(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const i in this.parameters)t.push(this.parameters[i].getCacheKey(e));return Fb(t)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const _Ve=Ri(doe).setParameterLength(1,2);function foe(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||co.z).negate()}const lH=We(([n,e],t)=>{const i=foe(t);return Rh(n,e,i)}),uH=We(([n],e)=>{const t=foe(e);return n.mul(n,t,t).negate().exp().oneMinus()}),sE=We(([n,e])=>Un(e.toFloat().mix(QS.rgb,n.toVec3()),QS.a));function SVe(n,e,t){return mt('TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),sE(n,lH(e,t))}function MVe(n,e){return mt('TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),sE(n,uH(e))}let nx=null,ix=null;class poe extends Wn{static get type(){return"RangeNode"}constructor(e=ge(),t=ge()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=this.getConstNode(this.minNode),i=this.getConstNode(this.maxNode),r=e.getTypeLength(jg(t.value)),s=e.getTypeLength(jg(i.value));return r>s?r:s}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}getConstNode(e){let t=null;if(e.traverse(i=>{i.isConstNode===!0&&(t=i)}),t===null)throw new Error('THREE.TSL: No "ConstNode" found in node graph.');return t}setup(e){const t=e.object;let i=null;if(t.count>1){const r=this.getConstNode(this.minNode),s=this.getConstNode(this.maxNode),a=r.value,o=s.value,l=e.getTypeLength(jg(a)),u=e.getTypeLength(jg(o));nx=nx||new si,ix=ix||new si,nx.setScalar(0),ix.setScalar(0),l===1?nx.setScalar(a):a.isColor?nx.set(a.r,a.g,a.b,1):nx.set(a.x,a.y,a.z||0,a.w||0),u===1?ix.setScalar(o):o.isColor?ix.set(o.r,o.g,o.b,1):ix.set(o.x,o.y,o.z||0,o.w||0);const c=4,d=c*t.count,f=new Float32Array(d);for(let y=0;y<d;y++){const _=y%c,S=nx.getComponent(_),b=ix.getComponent(_);f[y]=Wl.lerp(S,b,Math.random())}const m=this.getNodeType(e);if(t.count<=4096)i=GR(f,"vec4",t.count).element(mm).convert(m);else{const y=new Vc(f,4);e.geometry.setAttribute("__range"+this.id,y),i=WB(y).convert(m)}}else i=ge(0);return i}}const AVe=Ri(poe).setParameterLength(2);class TVe extends Wn{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const i=this.getBuiltinName(e),r=this.getNodeType(e);return e.shaderStage==="compute"?e.format(i,r,t):(mt(`ComputeBuiltinNode: Compute built-in value ${i} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(r))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const VR=(n,e)=>new TVe(n,e),CVe=VR("numWorkgroups","uvec3"),wVe=VR("workgroupId","uvec3"),EVe=VR("globalId","uvec3"),RVe=VR("localId","uvec3"),PVe=VR("subgroupSize","uint");class DVe extends Wn{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:i}=e;i.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}const cH=Ri(DVe),NVe=()=>cH("workgroup").toStack(),BVe=()=>cH("storage").toStack(),FVe=()=>cH("texture").toStack();class LVe extends Qv{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let i;const r=e.context.assign;if(i=super.generate(e),r!==!0){const s=this.getNodeType(e);i=e.format(i,s,t)}return i}}class IVe extends Wn{constructor(e,t,i=0){super(t),this.bufferType=t,this.bufferCount=i,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=""}setName(e){return this.name=e,this}label(e){return mt('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return new LVe(this,e)}generate(e){const t=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const GVe=(n,e)=>new IVe("Workgroup",n,e);class sl extends Wn{static get type(){return"AtomicFunctionNode"}constructor(e,t,i){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=i,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),i=t.parents,r=this.method,s=this.getNodeType(e),a=this.getInputType(e),o=this.pointerNode,l=this.valueNode,u=[];u.push(`&${o.build(e,a)}`),l!==null&&u.push(l.build(e,a));const c=`${e.getMethod(r,s)}( ${u.join(", ")} )`;if(i?i.length===1&&i[0].isStackNode===!0:!1)e.addLineFlowCode(c,this);else return t.constNode===void 0&&(t.constNode=g0(c,s).toConst()),t.constNode.build(e)}}sl.ATOMIC_LOAD="atomicLoad";sl.ATOMIC_STORE="atomicStore";sl.ATOMIC_ADD="atomicAdd";sl.ATOMIC_SUB="atomicSub";sl.ATOMIC_MAX="atomicMax";sl.ATOMIC_MIN="atomicMin";sl.ATOMIC_AND="atomicAnd";sl.ATOMIC_OR="atomicOr";sl.ATOMIC_XOR="atomicXor";const OVe=Ri(sl),Om=(n,e,t)=>OVe(n,e,t).toStack(),UVe=n=>Om(sl.ATOMIC_LOAD,n,null),kVe=(n,e)=>Om(sl.ATOMIC_STORE,n,e),zVe=(n,e)=>Om(sl.ATOMIC_ADD,n,e),VVe=(n,e)=>Om(sl.ATOMIC_SUB,n,e),HVe=(n,e)=>Om(sl.ATOMIC_MAX,n,e),XVe=(n,e)=>Om(sl.ATOMIC_MIN,n,e),WVe=(n,e)=>Om(sl.ATOMIC_AND,n,e),ZVe=(n,e)=>Om(sl.ATOMIC_OR,n,e),jVe=(n,e)=>Om(sl.ATOMIC_XOR,n,e);class Ln extends Ca{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,i=null){super(),this.method=e,this.aNode=t,this.bNode=i}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,i=this.bNode?this.bNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),s=e.isMatrix(i)?0:e.getTypeLength(i);return r>s?t:i}getNodeType(e){const t=this.method;return t===Ln.SUBGROUP_ELECT?"bool":t===Ln.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const i=this.method,r=this.getNodeType(e),s=this.getInputType(e),a=this.aNode,o=this.bNode,l=[];if(i===Ln.SUBGROUP_BROADCAST||i===Ln.SUBGROUP_SHUFFLE||i===Ln.QUAD_BROADCAST){const c=o.getNodeType(e);l.push(a.build(e,r),o.build(e,c==="float"?"int":r))}else i===Ln.SUBGROUP_SHUFFLE_XOR||i===Ln.SUBGROUP_SHUFFLE_DOWN||i===Ln.SUBGROUP_SHUFFLE_UP?l.push(a.build(e,r),o.build(e,"uint")):(a!==null&&l.push(a.build(e,s)),o!==null&&l.push(o.build(e,s)));const u=l.length===0?"()":`( ${l.join(", ")} )`;return e.format(`${e.getMethod(i,r)}${u}`,r,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Ln.SUBGROUP_ELECT="subgroupElect";Ln.SUBGROUP_BALLOT="subgroupBallot";Ln.SUBGROUP_ADD="subgroupAdd";Ln.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";Ln.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";Ln.SUBGROUP_MUL="subgroupMul";Ln.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";Ln.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";Ln.SUBGROUP_AND="subgroupAnd";Ln.SUBGROUP_OR="subgroupOr";Ln.SUBGROUP_XOR="subgroupXor";Ln.SUBGROUP_MIN="subgroupMin";Ln.SUBGROUP_MAX="subgroupMax";Ln.SUBGROUP_ALL="subgroupAll";Ln.SUBGROUP_ANY="subgroupAny";Ln.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";Ln.QUAD_SWAP_X="quadSwapX";Ln.QUAD_SWAP_Y="quadSwapY";Ln.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";Ln.SUBGROUP_BROADCAST="subgroupBroadcast";Ln.SUBGROUP_SHUFFLE="subgroupShuffle";Ln.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";Ln.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";Ln.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";Ln.QUAD_BROADCAST="quadBroadcast";const YVe=dn(Ln,Ln.SUBGROUP_ELECT).setParameterLength(0),KVe=dn(Ln,Ln.SUBGROUP_BALLOT).setParameterLength(1),$Ve=dn(Ln,Ln.SUBGROUP_ADD).setParameterLength(1),JVe=dn(Ln,Ln.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),qVe=dn(Ln,Ln.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),QVe=dn(Ln,Ln.SUBGROUP_MUL).setParameterLength(1),e4e=dn(Ln,Ln.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),t4e=dn(Ln,Ln.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),n4e=dn(Ln,Ln.SUBGROUP_AND).setParameterLength(1),i4e=dn(Ln,Ln.SUBGROUP_OR).setParameterLength(1),r4e=dn(Ln,Ln.SUBGROUP_XOR).setParameterLength(1),s4e=dn(Ln,Ln.SUBGROUP_MIN).setParameterLength(1),a4e=dn(Ln,Ln.SUBGROUP_MAX).setParameterLength(1),o4e=dn(Ln,Ln.SUBGROUP_ALL).setParameterLength(0),l4e=dn(Ln,Ln.SUBGROUP_ANY).setParameterLength(0),u4e=dn(Ln,Ln.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),c4e=dn(Ln,Ln.QUAD_SWAP_X).setParameterLength(1),h4e=dn(Ln,Ln.QUAD_SWAP_Y).setParameterLength(1),d4e=dn(Ln,Ln.QUAD_SWAP_DIAGONAL).setParameterLength(1),f4e=dn(Ln,Ln.SUBGROUP_BROADCAST).setParameterLength(2),p4e=dn(Ln,Ln.SUBGROUP_SHUFFLE).setParameterLength(2),m4e=dn(Ln,Ln.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),g4e=dn(Ln,Ln.SUBGROUP_SHUFFLE_UP).setParameterLength(2),y4e=dn(Ln,Ln.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),v4e=dn(Ln,Ln.QUAD_BROADCAST).setParameterLength(1);let FD;function oL(n){FD=FD||new WeakMap;let e=FD.get(n);return e===void 0&&FD.set(n,e={}),e}function lL(n){const e=oL(n);return e.shadowMatrix||(e.shadowMatrix=Qn("mat4").setGroup(ti).onRenderUpdate(t=>((n.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(n.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(n.shadow.camera.coordinateSystem=t.camera.coordinateSystem,n.shadow.camera.updateProjectionMatrix()),n.shadow.updateMatrices(n)),n.shadow.matrix)))}function moe(n,e=Th){const t=lL(n).mul(e);return t.xyz.div(t.w)}function hH(n){const e=oL(n);return e.position||(e.position=Qn(new re).setGroup(ti).onRenderUpdate((t,i)=>i.value.setFromMatrixPosition(n.matrixWorld)))}function goe(n){const e=oL(n);return e.targetPosition||(e.targetPosition=Qn(new re).setGroup(ti).onRenderUpdate((t,i)=>i.value.setFromMatrixPosition(n.target.matrixWorld)))}function dH(n){const e=oL(n);return e.viewPosition||(e.viewPosition=Qn(new re).setGroup(ti).onRenderUpdate(({camera:t},i)=>{i.value=i.value||new re,i.value.setFromMatrixPosition(n.matrixWorld),i.value.applyMatrix4(t.matrixWorldInverse)}))}const fH=n=>Fh.transformDirection(hH(n).sub(goe(n))),x4e=n=>n.sort((e,t)=>e.id-t.id),b4e=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},UO=new WeakMap,dC=[];class uL extends Wn{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Vf("vec3","totalDiffuse"),this.totalSpecularNode=Vf("vec3","totalSpecular"),this.outgoingLightNode=Vf("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let i=0;i<e.length;i++){const r=e[i];if(dC.push(r.id),dC.push(r.castShadow?1:0),r.isSpotLight===!0){const s=r.map!==null?r.map.id:-1,a=r.colorNode?r.colorNode.getCacheKey():-1;dC.push(s,a)}}const t=Fb(dC);return dC.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const i of this._lightNodes)t.push(i.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const i of t.nodes)i.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],i=this._lightNodes,r=x4e(this._lights),s=e.renderer.library;for(const a of r)if(a.isNode)t.push(Dn(a));else{let o=null;if(i!==null&&(o=b4e(a.id,i)),o===null){const l=s.getLightNodeClass(a.constructor);if(l===null){mt(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let u=null;UO.has(a)?u=UO.get(a):(u=new l(a),UO.set(a,u)),t.push(u)}}this._lightNodes=t}setupDirectLight(e,t,i){const{lightingModel:r,reflectedLight:s}=e.context;r.direct({...i,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,i){const{lightingModel:r,reflectedLight:s}=e.context;r.directRectArea({...i,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const i of t)i.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let i=this.outgoingLightNode;const r=e.context,s=r.lightingModel,a=e.getNodeProperties(this);if(s){const{totalDiffuseNode:o,totalSpecularNode:l}=this;r.outgoingLight=i;const u=e.addStack();a.nodes=u.nodes,s.start(e);const{backdrop:c,backdropAlpha:d}=r,{directDiffuse:f,directSpecular:m,indirectDiffuse:y,indirectSpecular:_}=r.reflectedLight;let S=f.add(y);c!==null&&(d!==null?S=Ge(d.mix(S,c)):S=Ge(c)),o.assign(S),l.assign(m.add(_)),i.assign(o.add(l)),s.finish(e),i=i.bypass(e.removeStack())}else a.nodes=[];return e.lightsNode=t,i}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const _4e=(n=[])=>new uL().setLights(n);class yoe extends Wn{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Ni.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){pH.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Th)}}const pH=Vf("vec3","shadowPositionWorld");function mH(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new en),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function voe(n,e){return e=mH(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function xoe(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function gH(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function boe(n,e){return e=gH(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function _oe(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function S4e(n,e,t={}){return t=mH(n,t),t=gH(e,t),t}function Soe(n,e,t){return t=voe(n,t),t=boe(e,t),t}function Moe(n,e,t){xoe(n,t),_oe(e,t)}var M4e=Object.freeze({__proto__:null,resetRendererAndSceneState:Soe,resetRendererState:voe,resetSceneState:boe,restoreRendererAndSceneState:Moe,restoreRendererState:xoe,restoreSceneState:_oe,saveRendererAndSceneState:S4e,saveRendererState:mH,saveSceneState:gH});const $B=new WeakMap,Aoe=We(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let i=Qr(n,e.xy).setName("t_basic");return n.isArrayTexture&&(i=i.depth(t)),i.compare(e.z)}),Toe=We(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:i})=>{const r=(c,d)=>{let f=Qr(n,c);return n.isArrayTexture&&(f=f.depth(i)),f.compare(d)},s=Es("mapSize","vec2",t).setGroup(ti),a=Es("radius","float",t).setGroup(ti),o=nn(1).div(s),l=a.mul(o.x),u=rH(Ib.xy).mul(6.28318530718);return Eo(r(e.xy.add(Gf(0,5,u).mul(l)),e.z),r(e.xy.add(Gf(1,5,u).mul(l)),e.z),r(e.xy.add(Gf(2,5,u).mul(l)),e.z),r(e.xy.add(Gf(3,5,u).mul(l)),e.z),r(e.xy.add(Gf(4,5,u).mul(l)),e.z)).mul(1/5)}),Coe=We(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:i})=>{const r=(d,f)=>{let m=Qr(n,d);return n.isArrayTexture&&(m=m.depth(i)),m.compare(f)},s=Es("mapSize","vec2",t).setGroup(ti),a=nn(1).div(s),o=a.x,l=a.y,u=e.xy,c=Yf(u.mul(s).add(.5));return u.subAssign(c.mul(a)),Eo(r(u,e.z),r(u.add(nn(o,0)),e.z),r(u.add(nn(0,l)),e.z),r(u.add(a),e.z),vr(r(u.add(nn(o.negate(),0)),e.z),r(u.add(nn(o.mul(2),0)),e.z),c.x),vr(r(u.add(nn(o.negate(),l)),e.z),r(u.add(nn(o.mul(2),l)),e.z),c.x),vr(r(u.add(nn(0,l.negate())),e.z),r(u.add(nn(0,l.mul(2))),e.z),c.y),vr(r(u.add(nn(o,l.negate())),e.z),r(u.add(nn(o,l.mul(2))),e.z),c.y),vr(vr(r(u.add(nn(o.negate(),l.negate())),e.z),r(u.add(nn(o.mul(2),l.negate())),e.z),c.x),vr(r(u.add(nn(o.negate(),l.mul(2))),e.z),r(u.add(nn(o.mul(2),l.mul(2))),e.z),c.x),c.y)).mul(1/9)}),woe=We(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let i=Qr(n).sample(e.xy);n.isArrayTexture&&(i=i.depth(t)),i=i.rg;const r=i.x,s=ka(1e-7,i.y.mul(i.y)),a=zF(e.z,r);Kn(a.equal(1),()=>ge(1));const o=e.z.sub(r);let l=s.div(s.add(o.mul(o)));return l=Kf(Dr(l,.3).div(.65)),ka(a,l)}),A4e=We(([n,e,t])=>{let i=Th.sub(n).length();return i=i.sub(e).div(t.sub(e)),i=i.saturate(),i}),T4e=n=>{const e=n.shadow.camera,t=Es("near","float",e).setGroup(ti),i=Es("far","float",e).setGroup(ti),r=bre(n);return A4e(r,t,i)},Eoe=n=>{let e=$B.get(n);if(e===void 0){const t=n.isPointLight?T4e(n):null;e=new Js,e.colorNode=Un(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,$B.set(n,e)}return e},Roe=n=>{const e=$B.get(n);e!==void 0&&(e.dispose(),$B.delete(n))},eY=new Jf,pS=[],Poe=(n,e,t,i)=>{pS[0]=n,pS[1]=e;let r=eY.get(pS);return(r===void 0||r.shadowType!==t||r.useVelocity!==i)&&(r=(s,a,o,l,u,c,...d)=>{(s.castShadow===!0||s.receiveShadow&&t===Ad)&&(i&&(CV(s).useVelocity=!0),s.onBeforeShadow(n,s,o,e.camera,l,a.overrideMaterial,c),n.renderObject(s,a,o,l,u,c,...d),s.onAfterShadow(n,s,o,e.camera,l,a.overrideMaterial,c))},r.shadowType=t,r.useVelocity=i,eY.set(pS,r)),pS[0]=null,pS[1]=null,r},C4e=We(({samples:n,radius:e,size:t,shadowPass:i,depthLayer:r})=>{const s=ge(0).toVar("meanVertical"),a=ge(0).toVar("squareMeanVertical"),o=n.lessThanEqual(ge(1)).select(ge(0),ge(2).div(n.sub(1))),l=n.lessThanEqual(ge(1)).select(ge(0),ge(-1));fs({start:Le(0),end:Le(n),type:"int",condition:"<"},({i:c})=>{const d=l.add(ge(c).mul(o));let f=i.sample(Eo(Ib.xy,nn(0,d).mul(e)).div(t));i.value.isArrayTexture&&(f=f.depth(r)),f=f.x,s.addAssign(f),a.addAssign(f.mul(f))}),s.divAssign(n),a.divAssign(n);const u=vu(a.sub(s.mul(s)).max(0));return nn(s,u)}),w4e=We(({samples:n,radius:e,size:t,shadowPass:i,depthLayer:r})=>{const s=ge(0).toVar("meanHorizontal"),a=ge(0).toVar("squareMeanHorizontal"),o=n.lessThanEqual(ge(1)).select(ge(0),ge(2).div(n.sub(1))),l=n.lessThanEqual(ge(1)).select(ge(0),ge(-1));fs({start:Le(0),end:Le(n),type:"int",condition:"<"},({i:c})=>{const d=l.add(ge(c).mul(o));let f=i.sample(Eo(Ib.xy,nn(d,0).mul(e)).div(t));i.value.isArrayTexture&&(f=f.depth(r)),s.addAssign(f.x),a.addAssign(Eo(f.y.mul(f.y),f.x.mul(f.x)))}),s.divAssign(n),a.divAssign(n);const u=vu(a.sub(s.mul(s)).max(0));return nn(s,u)}),E4e=[Aoe,Toe,Coe,woe];let kO;const LD=new fA;class yH extends yoe{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:i,shadowCoord:r,shadow:s,depthLayer:a}){const o=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),l=t({depthTexture:i,shadowCoord:r,shadow:s,depthLayer:a});return o.select(l,ge(1))}setupShadowCoord(e,t){const{shadow:i}=this,{renderer:r}=e,s=Es("bias","float",i).setGroup(ti);let a=t,o;if(i.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)a=a.xyz.div(a.w),o=a.z,r.coordinateSystem===ic&&(o=o.mul(2).sub(1));else{const l=a.w;a=a.xy.div(l);const u=Es("near","float",i.camera).setGroup(ti),c=Es("far","float",i.camera).setGroup(ti);o=V4(l.negate(),u,c)}return a=Ge(a.x,a.y.oneMinus(),o.add(s)),a}getShadowFilterFn(e){return E4e[e]}setupRenderTarget(e,t){const i=new po(e.mapSize.width,e.mapSize.height);i.name="ShadowDepthTexture",i.compareFunction=Tb;const r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name="ShadowMap",r.texture.type=e.mapType,r.depthTexture=i,{shadowMap:r,depthTexture:i}}setupShadow(e){const{renderer:t,camera:i}=e,{light:r,shadow:s}=this,a=t.shadowMap.type,{depthTexture:o,shadowMap:l}=this.setupRenderTarget(s,e);if(s.camera.coordinateSystem=i.coordinateSystem,s.camera.updateProjectionMatrix(),a===Ad&&s.isPointLightShadow!==!0){o.compareFunction=null,l.depth>1?(l._vsmShadowMapVertical||(l._vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:_l,type:zi,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=l._vsmShadowMapVertical,l._vsmShadowMapHorizontal||(l._vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:_l,type:zi,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=l._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:_l,type:zi,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:_l,type:zi,depthBuffer:!1}));let w=Qr(o);o.isArrayTexture&&(w=w.depth(this.depthLayer));let T=Qr(this.vsmShadowMapVertical.texture);o.isArrayTexture&&(T=T.depth(this.depthLayer));const E=Es("blurSamples","float",s).setGroup(ti),R=Es("radius","float",s).setGroup(ti),P=Es("mapSize","vec2",s).setGroup(ti);let I=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Js);I.fragmentNode=C4e({samples:E,radius:R,size:P,shadowPass:w,depthLayer:this.depthLayer}).context(e.getSharedContext()),I.name="VSMVertical",I=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Js),I.fragmentNode=w4e({samples:E,radius:R,size:P,shadowPass:T,depthLayer:this.depthLayer}).context(e.getSharedContext()),I.name="VSMHorizontal"}const u=Es("intensity","float",s).setGroup(ti),c=Es("normalBias","float",s).setGroup(ti),d=lL(r).mul(pH.add(t1.mul(c))),f=this.setupShadowCoord(e,d),m=s.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(m===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const y=a===Ad&&s.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:o,_=this.setupShadowFilter(e,{filterFn:m,shadowTexture:l.texture,depthTexture:y,shadowCoord:f,shadow:s,depthLayer:this.depthLayer});let S;l.texture.isCubeTexture?S=$u(l.texture,f.xyz):(S=Qr(l.texture,f),o.isArrayTexture&&(S=S.depth(this.depthLayer)));const b=vr(1,_.rgb.mix(S,1),u.mul(S.a)).toVar();this.shadowMap=l,this.shadow.map=l;const M=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return b.toInspector(`${M} / Color`,()=>this.shadowMap.texture.isCubeTexture?$u(this.shadowMap.texture):Qr(this.shadowMap.texture)).toInspector(`${M} / Depth`,()=>this.shadowMap.texture.isCubeTexture?$u(this.shadowMap.texture).r.oneMinus():$a(this.shadowMap.depthTexture,_s().mul(e0(Qr(this.shadowMap.depthTexture)))).r.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return We(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let i=this._node;return this.setupShadowPosition(e),i===null&&(this._node=i=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&mt('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(i=e.material.receivedShadowNode(i)),i})()}renderShadow(e){const{shadow:t,shadowMap:i,light:r}=this,{renderer:s,scene:a}=e;t.updateMatrices(r),i.setSize(t.mapSize.width,t.mapSize.height,i.depth);const o=a.name;a.name=`Shadow Map [ ${r.name||"ID: "+r.id} ]`,s.render(a,t.camera),a.name=o}updateShadow(e){const{shadowMap:t,light:i,shadow:r}=this,{renderer:s,scene:a,camera:o}=e,l=s.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u;const c=r.camera.layers.mask;(r.camera.layers.mask&4294967294)===0&&(r.camera.layers.mask=o.layers.mask);const d=s.getRenderObjectFunction(),f=s.getMRT(),m=f?f.has("velocity"):!1;kO=Soe(s,a,kO),a.overrideMaterial=Eoe(i),s.setRenderObjectFunction(Poe(s,r,l,m)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(d),l===Ad&&r.isPointLightShadow!==!0&&this.vsmPass(s),r.camera.layers.mask=c,Moe(s,a,kO)}vsmPass(e){const{shadow:t}=this,i=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,i),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,i),e.setRenderTarget(this.vsmShadowMapVertical),LD.material=this.vsmMaterialVertical,LD.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),LD.material=this.vsmMaterialHorizontal,LD.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,Roe(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let i=t.needsUpdate||t.autoUpdate;i&&(this._cameraFrameId[e.camera]===e.frameId&&(i=!1),this._cameraFrameId[e.camera]=e.frameId),i&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const Doe=(n,e)=>new yH(n,e),R4e=new en,tY=new Mn,fC=new re,zO=new re,P4e=[new re(1,0,0),new re(-1,0,0),new re(0,-1,0),new re(0,1,0),new re(0,0,1),new re(0,0,-1)],D4e=[new re(0,-1,0),new re(0,-1,0),new re(0,0,-1),new re(0,0,1),new re(0,-1,0),new re(0,-1,0)],N4e=[new re(1,0,0),new re(-1,0,0),new re(0,1,0),new re(0,-1,0),new re(0,0,1),new re(0,0,-1)],B4e=[new re(0,-1,0),new re(0,-1,0),new re(0,0,1),new re(0,0,-1),new re(0,-1,0),new re(0,-1,0)],Noe=We(({depthTexture:n,bd3D:e,dp:t})=>$u(n,e).compare(t)),Boe=We(({depthTexture:n,bd3D:e,dp:t,shadow:i})=>{const r=Es("radius","float",i).setGroup(ti),s=Es("mapSize","vec2",i).setGroup(ti),a=r.div(s.x),o=zs(e),l=nc(m0(e,o.x.greaterThan(o.z).select(Ge(0,1,0),Ge(1,0,0)))),u=m0(e,l),c=rH(Ib.xy).mul(6.28318530718),d=Gf(0,5,c),f=Gf(1,5,c),m=Gf(2,5,c),y=Gf(3,5,c),_=Gf(4,5,c);return $u(n,e.add(l.mul(d.x).add(u.mul(d.y)).mul(a))).compare(t).add($u(n,e.add(l.mul(f.x).add(u.mul(f.y)).mul(a))).compare(t)).add($u(n,e.add(l.mul(m.x).add(u.mul(m.y)).mul(a))).compare(t)).add($u(n,e.add(l.mul(y.x).add(u.mul(y.y)).mul(a))).compare(t)).add($u(n,e.add(l.mul(_.x).add(u.mul(_.y)).mul(a))).compare(t)).mul(1/5)}),F4e=We(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:i})=>{const r=t.xyz.toVar(),s=r.length(),a=Qn("float").setGroup(ti).onRenderUpdate(()=>i.camera.near),o=Qn("float").setGroup(ti).onRenderUpdate(()=>i.camera.far),l=Es("bias","float",i).setGroup(ti),u=ge(1).toVar();return Kn(s.sub(o).lessThanEqual(0).and(s.sub(a).greaterThanEqual(0)),()=>{const c=s.sub(a).div(o.sub(a)).toVar();c.addAssign(l);const d=r.normalize();u.assign(n({depthTexture:e,bd3D:d,dp:c,shadow:i}))}),u});class L4e extends yH{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===UE?Noe:Boe}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,depthTexture:i,shadowCoord:r,shadow:s}){return F4e({filterFn:t,depthTexture:i,shadowCoord:r,shadow:s})}setupRenderTarget(e,t){const i=new iF(e.mapSize.width);i.name="PointShadowDepthTexture",i.compareFunction=Tb;const r=t.createCubeRenderTarget(e.mapSize.width);return r.texture.name="PointShadowMap",r.depthTexture=i,{shadowMap:r,depthTexture:i}}renderShadow(e){const{shadow:t,shadowMap:i,light:r}=this,{renderer:s,scene:a}=e,o=t.camera,l=t.matrix,u=s.coordinateSystem===ic,c=u?P4e:N4e,d=u?D4e:B4e;i.setSize(t.mapSize.width,t.mapSize.width);const f=s.autoClear,m=s.getClearColor(R4e),y=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha);for(let _=0;_<6;_++){s.setRenderTarget(i,_),s.clear();const S=r.distance||o.far;S!==o.far&&(o.far=S,o.updateProjectionMatrix()),fC.setFromMatrixPosition(r.matrixWorld),o.position.copy(fC),zO.copy(o.position),zO.add(c[_]),o.up.copy(d[_]),o.lookAt(zO),o.updateMatrixWorld(),l.makeTranslation(-fC.x,-fC.y,-fC.z),tY.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),t._frustum.setFromProjectionMatrix(tY,o.coordinateSystem,o.reversedDepth);const b=a.name;a.name=`Point Light Shadow [ ${r.name||"ID: "+r.id} ] - Face ${_+1}`,s.render(a,o),a.name=b}s.autoClear=f,s.setClearColor(m,y)}}const Foe=(n,e)=>new L4e(n,e);class i1 extends Gb{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new en,this.colorNode=e&&e.colorNode||Qn(this.color).setGroup(ti),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Ni.FRAME,e&&e.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},e.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(e){return dH(this.light).sub(e.context.positionView||co)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return Doe(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let i=this.shadowColorNode;if(i===null){const r=this.light.shadow.shadowNode;let s;r!==void 0?s=Dn(r):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=i=this.colorNode.mul(s),this.baseColorNode=this.colorNode}e.context.getShadow&&(i=e.context.getShadow(this,e)),this.colorNode=i}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),i=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),i&&e.lightsNode.setupDirectRectAreaLight(e,this,i)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const vH=We(({lightDistance:n,cutoffDistance:e,decayExponent:t})=>{const i=n.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(i.mul(n.div(e).pow4().oneMinus().clamp().pow2()),i)}),Loe=({color:n,lightVector:e,cutoffDistance:t,decayExponent:i})=>{const r=e.normalize(),s=e.length(),a=vH({lightDistance:s,cutoffDistance:t,decayExponent:i}),o=n.mul(a);return{lightDirection:r,lightColor:o}};class Ioe extends i1{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Qn(0).setGroup(ti),this.decayExponentNode=Qn(2).setGroup(ti)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return Foe(this.light)}setupDirect(e){return Loe({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const I4e=We(([n=_s()])=>{const e=n.mul(2),t=e.x.floor(),i=e.y.floor();return t.add(i).mod(2).sign()}),G4e=We(([n=_s()],{renderer:e,material:t})=>{const i=l4(n.mul(2).sub(1));let r;if(t.alphaToCoverage&&e.currentSamples>0){const s=ge(i.fwidth()).toVar();r=Rh(s.oneMinus(),s.add(1),i).oneMinus()}else r=Zl(i.greaterThan(1),0,1);return r}),bw=We(([n,e,t])=>{const i=ge(t).toVar(),r=ge(e).toVar(),s=Od(n).toVar();return Zl(s,r,i)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),JB=We(([n,e])=>{const t=Od(e).toVar(),i=ge(n).toVar();return Zl(t,i.negate(),i)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),Co=We(([n])=>{const e=ge(n).toVar();return Le(fm(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Sa=We(([n,e])=>{const t=ge(n).toVar();return e.assign(Co(t)),t.sub(ge(e))}),O4e=We(([n,e,t,i,r,s])=>{const a=ge(s).toVar(),o=ge(r).toVar(),l=ge(i).toVar(),u=ge(t).toVar(),c=ge(e).toVar(),d=ge(n).toVar(),f=ge(Dr(1,o)).toVar();return Dr(1,a).mul(d.mul(f).add(c.mul(o))).add(a.mul(u.mul(f).add(l.mul(o))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),U4e=We(([n,e,t,i,r,s])=>{const a=ge(s).toVar(),o=ge(r).toVar(),l=Ge(i).toVar(),u=Ge(t).toVar(),c=Ge(e).toVar(),d=Ge(n).toVar(),f=ge(Dr(1,o)).toVar();return Dr(1,a).mul(d.mul(f).add(c.mul(o))).add(a.mul(u.mul(f).add(l.mul(o))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),Goe=Jl([O4e,U4e]),k4e=We(([n,e,t,i,r,s,a,o,l,u,c])=>{const d=ge(c).toVar(),f=ge(u).toVar(),m=ge(l).toVar(),y=ge(o).toVar(),_=ge(a).toVar(),S=ge(s).toVar(),b=ge(r).toVar(),M=ge(i).toVar(),w=ge(t).toVar(),T=ge(e).toVar(),E=ge(n).toVar(),R=ge(Dr(1,m)).toVar(),P=ge(Dr(1,f)).toVar();return ge(Dr(1,d)).toVar().mul(P.mul(E.mul(R).add(T.mul(m))).add(f.mul(w.mul(R).add(M.mul(m))))).add(d.mul(P.mul(b.mul(R).add(S.mul(m))).add(f.mul(_.mul(R).add(y.mul(m))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),z4e=We(([n,e,t,i,r,s,a,o,l,u,c])=>{const d=ge(c).toVar(),f=ge(u).toVar(),m=ge(l).toVar(),y=Ge(o).toVar(),_=Ge(a).toVar(),S=Ge(s).toVar(),b=Ge(r).toVar(),M=Ge(i).toVar(),w=Ge(t).toVar(),T=Ge(e).toVar(),E=Ge(n).toVar(),R=ge(Dr(1,m)).toVar(),P=ge(Dr(1,f)).toVar();return ge(Dr(1,d)).toVar().mul(P.mul(E.mul(R).add(T.mul(m))).add(f.mul(w.mul(R).add(M.mul(m))))).add(d.mul(P.mul(b.mul(R).add(S.mul(m))).add(f.mul(_.mul(R).add(y.mul(m))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),Ooe=Jl([k4e,z4e]),V4e=We(([n,e,t])=>{const i=ge(t).toVar(),r=ge(e).toVar(),s=Yt(n).toVar(),a=Yt(s.bitAnd(Yt(7))).toVar(),o=ge(bw(a.lessThan(Yt(4)),r,i)).toVar(),l=ge(Ci(2,bw(a.lessThan(Yt(4)),i,r))).toVar();return JB(o,Od(a.bitAnd(Yt(1)))).add(JB(l,Od(a.bitAnd(Yt(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),H4e=We(([n,e,t,i])=>{const r=ge(i).toVar(),s=ge(t).toVar(),a=ge(e).toVar(),o=Yt(n).toVar(),l=Yt(o.bitAnd(Yt(15))).toVar(),u=ge(bw(l.lessThan(Yt(8)),a,s)).toVar(),c=ge(bw(l.lessThan(Yt(4)),s,bw(l.equal(Yt(12)).or(l.equal(Yt(14))),a,r))).toVar();return JB(u,Od(l.bitAnd(Yt(1)))).add(JB(c,Od(l.bitAnd(Yt(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),yl=Jl([V4e,H4e]),X4e=We(([n,e,t])=>{const i=ge(t).toVar(),r=ge(e).toVar(),s=Lb(n).toVar();return Ge(yl(s.x,r,i),yl(s.y,r,i),yl(s.z,r,i))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),W4e=We(([n,e,t,i])=>{const r=ge(i).toVar(),s=ge(t).toVar(),a=ge(e).toVar(),o=Lb(n).toVar();return Ge(yl(o.x,a,s,r),yl(o.y,a,s,r),yl(o.z,a,s,r))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),fd=Jl([X4e,W4e]),Z4e=We(([n])=>{const e=ge(n).toVar();return Ci(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),j4e=We(([n])=>{const e=ge(n).toVar();return Ci(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Y4e=We(([n])=>{const e=Ge(n).toVar();return Ci(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),Uoe=Jl([Z4e,Y4e]),K4e=We(([n])=>{const e=Ge(n).toVar();return Ci(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),koe=Jl([j4e,K4e]),ph=We(([n,e])=>{const t=Le(e).toVar(),i=Yt(n).toVar();return i.shiftLeft(t).bitOr(i.shiftRight(Le(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),zoe=We(([n,e,t])=>{n.subAssign(t),n.bitXorAssign(ph(t,Le(4))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(ph(n,Le(6))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(ph(e,Le(8))),e.addAssign(n),n.subAssign(t),n.bitXorAssign(ph(t,Le(16))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(ph(n,Le(19))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(ph(e,Le(4))),e.addAssign(n)}),HR=We(([n,e,t])=>{const i=Yt(t).toVar(),r=Yt(e).toVar(),s=Yt(n).toVar();return i.bitXorAssign(r),i.subAssign(ph(r,Le(14))),s.bitXorAssign(i),s.subAssign(ph(i,Le(11))),r.bitXorAssign(s),r.subAssign(ph(s,Le(25))),i.bitXorAssign(r),i.subAssign(ph(r,Le(16))),s.bitXorAssign(i),s.subAssign(ph(i,Le(4))),r.bitXorAssign(s),r.subAssign(ph(s,Le(14))),i.bitXorAssign(r),i.subAssign(ph(r,Le(24))),i}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),bu=We(([n])=>{const e=Yt(n).toVar();return ge(e).div(ge(Yt(Le(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),gm=We(([n])=>{const e=ge(n).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),$4e=We(([n])=>{const e=Le(n).toVar(),t=Yt(Yt(1)).toVar(),i=Yt(Yt(Le(3735928559)).add(t.shiftLeft(Yt(2))).add(Yt(13))).toVar();return HR(i.add(Yt(e)),i,i)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),J4e=We(([n,e])=>{const t=Le(e).toVar(),i=Le(n).toVar(),r=Yt(Yt(2)).toVar(),s=Yt().toVar(),a=Yt().toVar(),o=Yt().toVar();return s.assign(a.assign(o.assign(Yt(Le(3735928559)).add(r.shiftLeft(Yt(2))).add(Yt(13))))),s.addAssign(Yt(i)),a.addAssign(Yt(t)),HR(s,a,o)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),q4e=We(([n,e,t])=>{const i=Le(t).toVar(),r=Le(e).toVar(),s=Le(n).toVar(),a=Yt(Yt(3)).toVar(),o=Yt().toVar(),l=Yt().toVar(),u=Yt().toVar();return o.assign(l.assign(u.assign(Yt(Le(3735928559)).add(a.shiftLeft(Yt(2))).add(Yt(13))))),o.addAssign(Yt(s)),l.addAssign(Yt(r)),u.addAssign(Yt(i)),HR(o,l,u)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Q4e=We(([n,e,t,i])=>{const r=Le(i).toVar(),s=Le(t).toVar(),a=Le(e).toVar(),o=Le(n).toVar(),l=Yt(Yt(4)).toVar(),u=Yt().toVar(),c=Yt().toVar(),d=Yt().toVar();return u.assign(c.assign(d.assign(Yt(Le(3735928559)).add(l.shiftLeft(Yt(2))).add(Yt(13))))),u.addAssign(Yt(o)),c.addAssign(Yt(a)),d.addAssign(Yt(s)),zoe(u,c,d),u.addAssign(Yt(r)),HR(u,c,d)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),eHe=We(([n,e,t,i,r])=>{const s=Le(r).toVar(),a=Le(i).toVar(),o=Le(t).toVar(),l=Le(e).toVar(),u=Le(n).toVar(),c=Yt(Yt(5)).toVar(),d=Yt().toVar(),f=Yt().toVar(),m=Yt().toVar();return d.assign(f.assign(m.assign(Yt(Le(3735928559)).add(c.shiftLeft(Yt(2))).add(Yt(13))))),d.addAssign(Yt(u)),f.addAssign(Yt(l)),m.addAssign(Yt(o)),zoe(d,f,m),d.addAssign(Yt(a)),f.addAssign(Yt(s)),HR(d,f,m)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),Rs=Jl([$4e,J4e,q4e,Q4e,eHe]),tHe=We(([n,e])=>{const t=Le(e).toVar(),i=Le(n).toVar(),r=Yt(Rs(i,t)).toVar(),s=Lb().toVar();return s.x.assign(r.bitAnd(Le(255))),s.y.assign(r.shiftRight(Le(8)).bitAnd(Le(255))),s.z.assign(r.shiftRight(Le(16)).bitAnd(Le(255))),s}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),nHe=We(([n,e,t])=>{const i=Le(t).toVar(),r=Le(e).toVar(),s=Le(n).toVar(),a=Yt(Rs(s,r,i)).toVar(),o=Lb().toVar();return o.x.assign(a.bitAnd(Le(255))),o.y.assign(a.shiftRight(Le(8)).bitAnd(Le(255))),o.z.assign(a.shiftRight(Le(16)).bitAnd(Le(255))),o}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),pd=Jl([tHe,nHe]),iHe=We(([n])=>{const e=nn(n).toVar(),t=Le().toVar(),i=Le().toVar(),r=ge(Sa(e.x,t)).toVar(),s=ge(Sa(e.y,i)).toVar(),a=ge(gm(r)).toVar(),o=ge(gm(s)).toVar(),l=ge(Goe(yl(Rs(t,i),r,s),yl(Rs(t.add(Le(1)),i),r.sub(1),s),yl(Rs(t,i.add(Le(1))),r,s.sub(1)),yl(Rs(t.add(Le(1)),i.add(Le(1))),r.sub(1),s.sub(1)),a,o)).toVar();return Uoe(l)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),rHe=We(([n])=>{const e=Ge(n).toVar(),t=Le().toVar(),i=Le().toVar(),r=Le().toVar(),s=ge(Sa(e.x,t)).toVar(),a=ge(Sa(e.y,i)).toVar(),o=ge(Sa(e.z,r)).toVar(),l=ge(gm(s)).toVar(),u=ge(gm(a)).toVar(),c=ge(gm(o)).toVar(),d=ge(Ooe(yl(Rs(t,i,r),s,a,o),yl(Rs(t.add(Le(1)),i,r),s.sub(1),a,o),yl(Rs(t,i.add(Le(1)),r),s,a.sub(1),o),yl(Rs(t.add(Le(1)),i.add(Le(1)),r),s.sub(1),a.sub(1),o),yl(Rs(t,i,r.add(Le(1))),s,a,o.sub(1)),yl(Rs(t.add(Le(1)),i,r.add(Le(1))),s.sub(1),a,o.sub(1)),yl(Rs(t,i.add(Le(1)),r.add(Le(1))),s,a.sub(1),o.sub(1)),yl(Rs(t.add(Le(1)),i.add(Le(1)),r.add(Le(1))),s.sub(1),a.sub(1),o.sub(1)),l,u,c)).toVar();return koe(d)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),xH=Jl([iHe,rHe]),sHe=We(([n])=>{const e=nn(n).toVar(),t=Le().toVar(),i=Le().toVar(),r=ge(Sa(e.x,t)).toVar(),s=ge(Sa(e.y,i)).toVar(),a=ge(gm(r)).toVar(),o=ge(gm(s)).toVar(),l=Ge(Goe(fd(pd(t,i),r,s),fd(pd(t.add(Le(1)),i),r.sub(1),s),fd(pd(t,i.add(Le(1))),r,s.sub(1)),fd(pd(t.add(Le(1)),i.add(Le(1))),r.sub(1),s.sub(1)),a,o)).toVar();return Uoe(l)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),aHe=We(([n])=>{const e=Ge(n).toVar(),t=Le().toVar(),i=Le().toVar(),r=Le().toVar(),s=ge(Sa(e.x,t)).toVar(),a=ge(Sa(e.y,i)).toVar(),o=ge(Sa(e.z,r)).toVar(),l=ge(gm(s)).toVar(),u=ge(gm(a)).toVar(),c=ge(gm(o)).toVar(),d=Ge(Ooe(fd(pd(t,i,r),s,a,o),fd(pd(t.add(Le(1)),i,r),s.sub(1),a,o),fd(pd(t,i.add(Le(1)),r),s,a.sub(1),o),fd(pd(t.add(Le(1)),i.add(Le(1)),r),s.sub(1),a.sub(1),o),fd(pd(t,i,r.add(Le(1))),s,a,o.sub(1)),fd(pd(t.add(Le(1)),i,r.add(Le(1))),s.sub(1),a,o.sub(1)),fd(pd(t,i.add(Le(1)),r.add(Le(1))),s,a.sub(1),o.sub(1)),fd(pd(t.add(Le(1)),i.add(Le(1)),r.add(Le(1))),s.sub(1),a.sub(1),o.sub(1)),l,u,c)).toVar();return koe(d)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),XR=Jl([sHe,aHe]),oHe=We(([n])=>{const e=ge(n).toVar(),t=Le(Co(e)).toVar();return bu(Rs(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),lHe=We(([n])=>{const e=nn(n).toVar(),t=Le(Co(e.x)).toVar(),i=Le(Co(e.y)).toVar();return bu(Rs(t,i))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),uHe=We(([n])=>{const e=Ge(n).toVar(),t=Le(Co(e.x)).toVar(),i=Le(Co(e.y)).toVar(),r=Le(Co(e.z)).toVar();return bu(Rs(t,i,r))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),cHe=We(([n])=>{const e=Un(n).toVar(),t=Le(Co(e.x)).toVar(),i=Le(Co(e.y)).toVar(),r=Le(Co(e.z)).toVar(),s=Le(Co(e.w)).toVar();return bu(Rs(t,i,r,s))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),hHe=Jl([oHe,lHe,uHe,cHe]),dHe=We(([n])=>{const e=ge(n).toVar(),t=Le(Co(e)).toVar();return Ge(bu(Rs(t,Le(0))),bu(Rs(t,Le(1))),bu(Rs(t,Le(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),fHe=We(([n])=>{const e=nn(n).toVar(),t=Le(Co(e.x)).toVar(),i=Le(Co(e.y)).toVar();return Ge(bu(Rs(t,i,Le(0))),bu(Rs(t,i,Le(1))),bu(Rs(t,i,Le(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),pHe=We(([n])=>{const e=Ge(n).toVar(),t=Le(Co(e.x)).toVar(),i=Le(Co(e.y)).toVar(),r=Le(Co(e.z)).toVar();return Ge(bu(Rs(t,i,r,Le(0))),bu(Rs(t,i,r,Le(1))),bu(Rs(t,i,r,Le(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),mHe=We(([n])=>{const e=Un(n).toVar(),t=Le(Co(e.x)).toVar(),i=Le(Co(e.y)).toVar(),r=Le(Co(e.z)).toVar(),s=Le(Co(e.w)).toVar();return Ge(bu(Rs(t,i,r,s,Le(0))),bu(Rs(t,i,r,s,Le(1))),bu(Rs(t,i,r,s,Le(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),cL=Jl([dHe,fHe,pHe,mHe]),qB=We(([n,e,t,i])=>{const r=ge(i).toVar(),s=ge(t).toVar(),a=Le(e).toVar(),o=Ge(n).toVar(),l=ge(0).toVar(),u=ge(1).toVar();return fs(a,()=>{l.addAssign(u.mul(xH(o))),u.mulAssign(r),o.mulAssign(s)}),l}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),hL=We(([n,e,t,i])=>{const r=ge(i).toVar(),s=ge(t).toVar(),a=Le(e).toVar(),o=Ge(n).toVar(),l=Ge(0).toVar(),u=ge(1).toVar();return fs(a,()=>{l.addAssign(u.mul(XR(o))),u.mulAssign(r),o.mulAssign(s)}),l}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),gHe=We(([n,e,t,i])=>{const r=ge(i).toVar(),s=ge(t).toVar(),a=Le(e).toVar(),o=Ge(n).toVar();return nn(qB(o,a,s,r),qB(o.add(Ge(Le(19),Le(193),Le(17))),a,s,r))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),yHe=We(([n,e,t,i])=>{const r=ge(i).toVar(),s=ge(t).toVar(),a=Le(e).toVar(),o=Ge(n).toVar(),l=Ge(hL(o,a,s,r)).toVar(),u=ge(qB(o.add(Ge(Le(19),Le(193),Le(17))),a,s,r)).toVar();return Un(l,u)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),vHe=We(([n,e,t,i,r,s,a])=>{const o=Le(a).toVar(),l=ge(s).toVar(),u=Le(r).toVar(),c=Le(i).toVar(),d=Le(t).toVar(),f=Le(e).toVar(),m=nn(n).toVar(),y=Ge(cL(nn(f.add(c),d.add(u)))).toVar(),_=nn(y.x,y.y).toVar();_.subAssign(.5),_.mulAssign(l),_.addAssign(.5);const S=nn(nn(ge(f),ge(d)).add(_)).toVar(),b=nn(S.sub(m)).toVar();return Kn(o.equal(Le(2)),()=>zs(b.x).add(zs(b.y))),Kn(o.equal(Le(3)),()=>ka(zs(b.x),zs(b.y))),Ud(b,b)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),xHe=We(([n,e,t,i,r,s,a,o,l])=>{const u=Le(l).toVar(),c=ge(o).toVar(),d=Le(a).toVar(),f=Le(s).toVar(),m=Le(r).toVar(),y=Le(i).toVar(),_=Le(t).toVar(),S=Le(e).toVar(),b=Ge(n).toVar(),M=Ge(cL(Ge(S.add(m),_.add(f),y.add(d)))).toVar();M.subAssign(.5),M.mulAssign(c),M.addAssign(.5);const w=Ge(Ge(ge(S),ge(_),ge(y)).add(M)).toVar(),T=Ge(w.sub(b)).toVar();return Kn(u.equal(Le(2)),()=>zs(T.x).add(zs(T.y)).add(zs(T.z))),Kn(u.equal(Le(3)),()=>ka(zs(T.x),zs(T.y),zs(T.z))),Ud(T,T)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),pA=Jl([vHe,xHe]),bHe=We(([n,e,t])=>{const i=Le(t).toVar(),r=ge(e).toVar(),s=nn(n).toVar(),a=Le().toVar(),o=Le().toVar(),l=nn(Sa(s.x,a),Sa(s.y,o)).toVar(),u=ge(1e6).toVar();return fs({start:-1,end:Le(1),name:"x",condition:"<="},({x:c})=>{fs({start:-1,end:Le(1),name:"y",condition:"<="},({y:d})=>{const f=ge(pA(l,c,d,a,o,r,i)).toVar();u.assign(Zc(u,f))})}),Kn(i.equal(Le(0)),()=>{u.assign(vu(u))}),u}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),_He=We(([n,e,t])=>{const i=Le(t).toVar(),r=ge(e).toVar(),s=nn(n).toVar(),a=Le().toVar(),o=Le().toVar(),l=nn(Sa(s.x,a),Sa(s.y,o)).toVar(),u=nn(1e6,1e6).toVar();return fs({start:-1,end:Le(1),name:"x",condition:"<="},({x:c})=>{fs({start:-1,end:Le(1),name:"y",condition:"<="},({y:d})=>{const f=ge(pA(l,c,d,a,o,r,i)).toVar();Kn(f.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(f)}).ElseIf(f.lessThan(u.y),()=>{u.y.assign(f)})})}),Kn(i.equal(Le(0)),()=>{u.assign(vu(u))}),u}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),SHe=We(([n,e,t])=>{const i=Le(t).toVar(),r=ge(e).toVar(),s=nn(n).toVar(),a=Le().toVar(),o=Le().toVar(),l=nn(Sa(s.x,a),Sa(s.y,o)).toVar(),u=Ge(1e6,1e6,1e6).toVar();return fs({start:-1,end:Le(1),name:"x",condition:"<="},({x:c})=>{fs({start:-1,end:Le(1),name:"y",condition:"<="},({y:d})=>{const f=ge(pA(l,c,d,a,o,r,i)).toVar();Kn(f.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(f)}).ElseIf(f.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(f)}).ElseIf(f.lessThan(u.z),()=>{u.z.assign(f)})})}),Kn(i.equal(Le(0)),()=>{u.assign(vu(u))}),u}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),MHe=We(([n,e,t])=>{const i=Le(t).toVar(),r=ge(e).toVar(),s=Ge(n).toVar(),a=Le().toVar(),o=Le().toVar(),l=Le().toVar(),u=Ge(Sa(s.x,a),Sa(s.y,o),Sa(s.z,l)).toVar(),c=ge(1e6).toVar();return fs({start:-1,end:Le(1),name:"x",condition:"<="},({x:d})=>{fs({start:-1,end:Le(1),name:"y",condition:"<="},({y:f})=>{fs({start:-1,end:Le(1),name:"z",condition:"<="},({z:m})=>{const y=ge(pA(u,d,f,m,a,o,l,r,i)).toVar();c.assign(Zc(c,y))})})}),Kn(i.equal(Le(0)),()=>{c.assign(vu(c))}),c}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),AHe=Jl([bHe,MHe]),THe=We(([n,e,t])=>{const i=Le(t).toVar(),r=ge(e).toVar(),s=Ge(n).toVar(),a=Le().toVar(),o=Le().toVar(),l=Le().toVar(),u=Ge(Sa(s.x,a),Sa(s.y,o),Sa(s.z,l)).toVar(),c=nn(1e6,1e6).toVar();return fs({start:-1,end:Le(1),name:"x",condition:"<="},({x:d})=>{fs({start:-1,end:Le(1),name:"y",condition:"<="},({y:f})=>{fs({start:-1,end:Le(1),name:"z",condition:"<="},({z:m})=>{const y=ge(pA(u,d,f,m,a,o,l,r,i)).toVar();Kn(y.lessThan(c.x),()=>{c.y.assign(c.x),c.x.assign(y)}).ElseIf(y.lessThan(c.y),()=>{c.y.assign(y)})})})}),Kn(i.equal(Le(0)),()=>{c.assign(vu(c))}),c}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),CHe=Jl([_He,THe]),wHe=We(([n,e,t])=>{const i=Le(t).toVar(),r=ge(e).toVar(),s=Ge(n).toVar(),a=Le().toVar(),o=Le().toVar(),l=Le().toVar(),u=Ge(Sa(s.x,a),Sa(s.y,o),Sa(s.z,l)).toVar(),c=Ge(1e6,1e6,1e6).toVar();return fs({start:-1,end:Le(1),name:"x",condition:"<="},({x:d})=>{fs({start:-1,end:Le(1),name:"y",condition:"<="},({y:f})=>{fs({start:-1,end:Le(1),name:"z",condition:"<="},({z:m})=>{const y=ge(pA(u,d,f,m,a,o,l,r,i)).toVar();Kn(y.lessThan(c.x),()=>{c.z.assign(c.y),c.y.assign(c.x),c.x.assign(y)}).ElseIf(y.lessThan(c.y),()=>{c.z.assign(c.y),c.y.assign(y)}).ElseIf(y.lessThan(c.z),()=>{c.z.assign(y)})})})}),Kn(i.equal(Le(0)),()=>{c.assign(vu(c))}),c}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),bH=Jl([SHe,wHe]),EHe=We(([n,e,t,i,r,s,a,o,l,u,c])=>{const d=Le(n).toVar(),f=nn(e).toVar(),m=nn(t).toVar(),y=nn(i).toVar(),_=ge(r).toVar(),S=ge(s).toVar(),b=ge(a).toVar(),M=Od(o).toVar(),w=Le(l).toVar(),T=ge(u).toVar(),E=ge(c).toVar(),R=f.mul(m).add(y),P=ge(0).toVar();return Kn(d.equal(Le(0)),()=>{P.assign(XR(R))}),Kn(d.equal(Le(1)),()=>{P.assign(cL(R))}),Kn(d.equal(Le(2)),()=>{P.assign(bH(R,_,Le(0)))}),Kn(d.equal(Le(3)),()=>{P.assign(hL(Ge(R,0),w,T,E))}),P.assign(P.mul(b.sub(S)).add(S)),Kn(M,()=>{P.assign(Kf(P,S,b))}),P}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),RHe=We(([n,e,t,i,r,s,a,o,l,u,c])=>{const d=Le(n).toVar(),f=Ge(e).toVar(),m=Ge(t).toVar(),y=Ge(i).toVar(),_=ge(r).toVar(),S=ge(s).toVar(),b=ge(a).toVar(),M=Od(o).toVar(),w=Le(l).toVar(),T=ge(u).toVar(),E=ge(c).toVar(),R=f.mul(m).add(y),P=ge(0).toVar();return Kn(d.equal(Le(0)),()=>{P.assign(XR(R))}),Kn(d.equal(Le(1)),()=>{P.assign(cL(R))}),Kn(d.equal(Le(2)),()=>{P.assign(bH(R,_,Le(0)))}),Kn(d.equal(Le(3)),()=>{P.assign(hL(R,w,T,E))}),P.assign(P.mul(b.sub(S)).add(S)),Kn(M,()=>{P.assign(Kf(P,S,b))}),P}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),PHe=We(([n])=>{const e=n.y,t=n.z,i=Ge().toVar();return Kn(e.lessThan(1e-4),()=>{i.assign(Ge(t,t,t))}).Else(()=>{let r=n.x;r=r.sub(fm(r)).mul(6).toVar();const s=Le(r4(r)),a=r.sub(ge(s)),o=t.mul(e.oneMinus()),l=t.mul(e.mul(a).oneMinus()),u=t.mul(e.mul(a.oneMinus()).oneMinus());Kn(s.equal(Le(0)),()=>{i.assign(Ge(t,u,o))}).ElseIf(s.equal(Le(1)),()=>{i.assign(Ge(l,t,o))}).ElseIf(s.equal(Le(2)),()=>{i.assign(Ge(o,t,u))}).ElseIf(s.equal(Le(3)),()=>{i.assign(Ge(o,l,t))}).ElseIf(s.equal(Le(4)),()=>{i.assign(Ge(u,o,t))}).Else(()=>{i.assign(Ge(t,o,l))})}),i}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),DHe=We(([n])=>{const e=Ge(n).toVar(),t=ge(e.x).toVar(),i=ge(e.y).toVar(),r=ge(e.z).toVar(),s=ge(Zc(t,Zc(i,r))).toVar(),a=ge(ka(t,ka(i,r))).toVar(),o=ge(a.sub(s)).toVar(),l=ge().toVar(),u=ge().toVar(),c=ge().toVar();return c.assign(a),Kn(a.greaterThan(0),()=>{u.assign(o.div(a))}).Else(()=>{u.assign(0)}),Kn(u.lessThanEqual(0),()=>{l.assign(0)}).Else(()=>{Kn(t.greaterThanEqual(a),()=>{l.assign(i.sub(r).div(o))}).ElseIf(i.greaterThanEqual(a),()=>{l.assign(Eo(2,r.sub(t).div(o)))}).Else(()=>{l.assign(Eo(4,t.sub(i).div(o)))}),l.mulAssign(1/6),Kn(l.lessThan(0),()=>{l.addAssign(1)})}),Ge(l,u,c)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),NHe=We(([n])=>{const e=Ge(n).toVar(),t=UV(KV(e,Ge(.04045))).toVar(),i=Ge(e.div(12.92)).toVar(),r=Ge(wd(ka(e.add(Ge(.055)),Ge(0)).div(1.055),Ge(2.4))).toVar();return vr(i,r,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Voe=(n,e)=>{n=ge(n),e=ge(e);const t=nn(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Rh(n.sub(t),n.add(t),e)},Hoe=(n,e,t,i)=>vr(n,e,t[i].clamp()),BHe=(n,e,t=_s())=>Hoe(n,e,t,"x"),FHe=(n,e,t=_s())=>Hoe(n,e,t,"y"),LHe=(n,e,t,i,r=_s())=>{const s=r.x.clamp(),a=r.y.clamp(),o=vr(n,e,s),l=vr(t,i,s);return vr(o,l,a)},Xoe=(n,e,t,i,r)=>vr(n,e,Voe(t,i[r])),IHe=(n,e,t,i=_s())=>Xoe(n,e,t,i,"x"),GHe=(n,e,t,i=_s())=>Xoe(n,e,t,i,"y"),OHe=(n=1,e=0,t=_s())=>t.mul(n).add(e),UHe=(n,e=1)=>(n=ge(n),n.abs().pow(e).mul(n.sign())),kHe=(n,e=1,t=.5)=>ge(n).sub(t).mul(e).add(t),zHe=(n=_s(),e=1,t=0)=>xH(n.convert("vec2|vec3")).mul(e).add(t),VHe=(n=_s(),e=1,t=0)=>XR(n.convert("vec2|vec3")).mul(e).add(t),HHe=(n=_s(),e=1,t=0)=>(n=n.convert("vec2|vec3"),Un(XR(n),xH(n.add(nn(19,73)))).mul(e).add(t)),XHe=(n,e=_s(),t=nn(1,1),i=nn(0,0),r=1,s=0,a=1,o=!1,l=1,u=2,c=.5)=>EHe(n,e.convert("vec2|vec3"),t,i,r,s,a,o,l,u,c),WHe=(n,e=_s(),t=nn(1,1),i=nn(0,0),r=1,s=0,a=1,o=!1,l=1,u=2,c=.5)=>RHe(n,e.convert("vec2|vec3"),t,i,r,s,a,o,l,u,c),ZHe=(n=_s(),e=1)=>AHe(n.convert("vec2|vec3"),e,Le(1)),jHe=(n=_s(),e=1)=>CHe(n.convert("vec2|vec3"),e,Le(1)),YHe=(n=_s(),e=1)=>bH(n.convert("vec2|vec3"),e,Le(1)),KHe=(n=_s())=>hHe(n.convert("vec2|vec3")),$He=(n=_s(),e=3,t=2,i=.5,r=1)=>qB(n,Le(e),t,i).mul(r),JHe=(n=_s(),e=3,t=2,i=.5,r=1)=>gHe(n,Le(e),t,i).mul(r),qHe=(n=_s(),e=3,t=2,i=.5,r=1)=>hL(n,Le(e),t,i).mul(r),QHe=(n=_s(),e=3,t=2,i=.5,r=1)=>yHe(n,Le(e),t,i).mul(r),e6e=(n,e=ge(0))=>Eo(n,e),t6e=(n,e=ge(0))=>Dr(n,e),n6e=(n,e=ge(1))=>Ci(n,e),i6e=(n,e=ge(1))=>Eh(n,e),r6e=(n,e=ge(1))=>IR(n,e),s6e=(n,e=ge(1))=>wd(n,e),a6e=(n=ge(0),e=ge(1))=>kF(n,e),o6e=()=>dA,l6e=()=>kae,u6e=(n,e=ge(1))=>Dr(e,n),c6e=(n,e,t,i)=>n.greaterThan(e).mix(t,i),h6e=(n,e,t,i)=>n.greaterThanEqual(e).mix(t,i),d6e=(n,e,t,i)=>n.equal(e).mix(t,i),f6e=(n,e=null)=>{if(typeof e=="string"){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},i=e.replace(/^out/,"").toLowerCase();if(t[i]!==void 0)return n.element(t[i])}if(typeof e=="number")return n.element(e);if(typeof e=="string"&&e.length===1){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(t[e]!==void 0)return n.element(t[e])}return n},p6e=(n,e=nn(.5,.5),t=nn(1,1),i=ge(0),r=nn(0,0))=>{let s=n;if(e&&(s=s.sub(e)),t&&(s=s.mul(t)),i){const a=i.mul(Math.PI/180),o=a.cos(),l=a.sin();s=nn(s.x.mul(o).sub(s.y.mul(l)),s.x.mul(l).add(s.y.mul(o)))}return e&&(s=s.add(e)),r&&(s=s.add(r)),s},m6e=(n,e)=>{n=nn(n),e=ge(e);const t=e.mul(Math.PI/180);return zR(n,t)},g6e=(n,e,t)=>{n=Ge(n),e=ge(e),t=Ge(t);const i=e.mul(Math.PI/180),r=t.normalize(),s=i.cos(),a=i.sin(),o=ge(1).sub(s);return n.mul(s).add(r.cross(n).mul(a)).add(r.mul(r.dot(n)).mul(o))},y6e=(n,e)=>(n=Ge(n),e=ge(e),P4(n,e)),v6e=We(([n,e,t])=>{const i=nc(n).toVar(),r=Dr(ge(.5).mul(e.sub(t)),Th).div(i).toVar(),s=Dr(ge(-.5).mul(e.sub(t)),Th).div(i).toVar(),a=Ge().toVar();a.x=i.x.greaterThan(ge(0)).select(r.x,s.x),a.y=i.y.greaterThan(ge(0)).select(r.y,s.y),a.z=i.z.greaterThan(ge(0)).select(r.z,s.z);const o=Zc(a.x,a.y,a.z).toVar();return Th.add(i.mul(o)).toVar().sub(t)}),Woe=We(([n,e])=>{const t=n.x,i=n.y,r=n.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(i)),s=s.add(e.element(2).mul(2*.511664).mul(r)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(i)),s=s.add(e.element(5).mul(2*.429043).mul(i).mul(r)),s=s.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(8).mul(.429043).mul(Ci(t,t).sub(Ci(i,i)))),s});var Z=Object.freeze({__proto__:null,BRDF_GGX:j4,BRDF_Lambert:mb,BasicPointShadowFilter:Noe,BasicShadowFilter:Aoe,Break:Fse,Const:Hie,Continue:Z5e,DFGLUT:iE,D_GGX:cae,Discard:hre,EPSILON:$V,F_Schlick:TM,Fn:We,HALF_PI:VUe,INFINITY:UUe,If:Kn,Loop:fs,NodeAccess:Ml,NodeShaderStage:zS,NodeType:Pne,NodeUpdateType:Ni,OnBeforeMaterialUpdate:X9e,OnBeforeObjectUpdate:H9e,OnMaterialUpdate:V9e,OnObjectUpdate:z9e,PCFShadowFilter:Toe,PCFSoftShadowFilter:Coe,PI:XB,PI2:kUe,PointShadowFilter:Boe,Return:JUe,Schlick_to_F0:gk,ScriptableNodeResources:KN,ShaderNode:VS,Stack:FF,Switch:NUe,TBNViewMatrix:Cx,TWO_PI:zUe,VSMShadowFilter:woe,V_GGX_SmithCorrelated:uae,Var:Vie,VarIntent:Xie,abs:zs,acesFilmicToneMapping:aoe,acos:QV,add:Eo,addMethodChaining:Pt,addNodeElement:QUe,agxToneMapping:ooe,all:pie,alphaT:zB,and:Qne,anisotropy:Gy,anisotropyB:Ox,anisotropyT:fw,any:mie,append:IUe,array:Xne,arrayBuffer:FUe,asin:xie,assign:Zne,atan:kF,atan2:Gie,atomicAdd:zVe,atomicAnd:WVe,atomicFunc:Om,atomicLoad:UVe,atomicMax:HVe,atomicMin:XVe,atomicOr:ZVe,atomicStore:kVe,atomicSub:VVe,atomicXor:jVe,attenuationColor:XV,attenuationDistance:HV,attribute:Zu,attributeArray:W9e,backgroundBlurriness:jae,backgroundIntensity:_k,backgroundRotation:Yae,batch:Dse,bentNormalView:jre,billboarding:C9e,bitAnd:iie,bitNot:rie,bitOr:sie,bitXor:aie,bitangentGeometry:N5e,bitangentLocal:B5e,bitangentView:Wre,bitangentWorld:F5e,bitcast:Gae,blendBurn:Wse,blendColor:ike,blendDodge:Zse,blendOverlay:Yse,blendScreen:jse,blur:yae,bool:Od,buffer:GR,bufferAttribute:m4,builtin:R0,builtinAOContext:kie,builtinShadowContext:Uie,bumpMap:P4,burn:ske,bvec2:One,bvec3:UV,bvec4:Une,bypass:lre,cache:are,call:Yne,cameraFar:Xg,cameraIndex:e1,cameraNear:Hg,cameraNormalMatrix:h5e,cameraPosition:yw,cameraProjectionMatrix:ju,cameraProjectionMatrixInverse:u5e,cameraViewMatrix:Fh,cameraViewport:d5e,cameraWorldMatrix:c5e,cbrt:Nie,cdl:sVe,ceil:UF,checker:I4e,cineonToneMapping:soe,clamp:Kf,clearcoat:OB,clearcoatNormalView:Tx,clearcoatRoughness:tE,code:aL,color:Gne,colorSpaceToWorking:XF,colorToDirection:I5e,compute:rre,computeKernel:g4,computeSkinning:W5e,context:E0,convert:zne,convertColorSpace:jUe,convertToTexture:I9e,cos:Lf,countLeadingZeros:i9e,countOneBits:r9e,countTrailingZeros:n9e,cross:m0,cubeTexture:$u,cubeTextureBase:R4,dFdx:n4,dFdy:i4,dashSize:Ux,debug:pre,decrement:die,decrementBefore:cie,defaultBuildStages:IB,defaultShaderStages:RV,defined:Qw,degrees:yie,deltaTime:v9e,densityFog:MVe,densityFogFactor:uH,depth:H4,depthPass:uVe,determinant:Aie,difference:Rie,diffuseColor:xs,diffuseContribution:px,directPointLight:Loe,directionToColor:Yre,directionToFaceDirection:uA,dispersion:WV,disposeShadowMaterial:Roe,distance:Eie,div:Eh,dodge:ake,dot:Ud,drawIndex:wse,dynamicBufferAttribute:$Ue,element:kne,emissive:sk,equal:YV,equals:Cie,equirectUV:X4,exp:JV,exp2:SM,expression:g0,faceDirection:C4,faceForward:c4,faceforward:HUe,float:ge,floatBitsToInt:Qze,floatBitsToUint:Oae,floor:fm,fog:sE,fract:Yf,frameGroup:Hne,frameId:kae,frontFacing:Tre,fwidth:s4,gain:a9e,gapSize:nE,getConstNodeType:Ine,getCurrentStack:IV,getDirection:mae,getDistanceAttenuation:vH,getGeometryRoughness:lae,getNormalFromDepth:O9e,getParallaxCorrectNormal:v6e,getRoughness:Z4,getScreenPosition:G9e,getShIrradianceAt:Woe,getShadowMaterial:Eoe,getShadowRenderObjectFunction:Poe,getTextureIndex:Fae,getViewPosition:GS,ggxConvolution:vae,globalId:EVe,glsl:yVe,glslFn:vVe,grayscale:tVe,greaterThan:KV,greaterThanEqual:qne,hash:s9e,highpModelNormalViewMatrix:uk,highpModelViewMatrix:lk,hue:rVe,increment:hie,incrementBefore:uie,inspector:mre,instance:X5e,instanceIndex:mm,instancedArray:Z9e,instancedBufferAttribute:WB,instancedDynamicBufferAttribute:ok,instancedMesh:Rse,int:Le,intBitsToFloat:e9e,interleavedGradientNoise:rH,inverse:Tie,inverseSqrt:qV,inversesqrt:XUe,invocationLocalIndex:H5e,invocationSubgroupIndex:V5e,ior:pw,iridescence:IF,iridescenceIOR:UB,iridescenceThickness:kB,isolate:tM,ivec2:ko,ivec3:OV,ivec4:kV,js:mVe,label:zie,length:pm,lengthSq:l4,lessThan:$ne,lessThanEqual:Jne,lightPosition:hH,lightProjectionUV:moe,lightShadowMatrix:lL,lightTargetDirection:fH,lightTargetPosition:goe,lightViewPosition:dH,lightingContext:Use,lights:_4e,linearDepth:AM,linearToneMapping:ioe,localId:RVe,log:OF,log2:dm,logarithmicDepthToViewZ:$5e,luminance:aH,mat2:LF,mat3:Yl,mat4:rv,matcapUV:Mae,materialAO:Sse,materialAlphaTest:Jre,materialAnisotropy:hse,materialAnisotropyVector:IS,materialAttenuationColor:xse,materialAttenuationDistance:vse,materialClearcoat:sse,materialClearcoatNormal:ose,materialClearcoatRoughness:ase,materialColor:jB,materialDispersion:_se,materialEmissive:Qre,materialEnvIntensity:XN,materialEnvRotation:E4,materialIOR:yse,materialIridescence:dse,materialIridescenceIOR:fse,materialIridescenceThickness:pse,materialLightMap:L4,materialLineDashOffset:F4,materialLineDashSize:N4,materialLineGapSize:B4,materialLineScale:D4,materialLineWidth:ZN,materialMetalness:ise,materialNormal:rse,materialOpacity:JF,materialPointSize:bse,materialReference:Wg,materialReflectivity:WN,materialRefractionRatio:Rre,materialRotation:lse,materialRoughness:nse,materialSheen:use,materialSheenRoughness:cse,materialShininess:qre,materialSpecular:ese,materialSpecularColor:tse,materialSpecularIntensity:mk,materialSpecularStrength:vw,materialThickness:gse,materialTransmission:mse,max:ka,maxMipLevel:_4,mediumpModelViewMatrix:Mre,metalness:Yg,min:Zc,mix:vr,mixElement:Fie,mod:IR,modInt:fie,modelDirection:v5e,modelNormalMatrix:Sre,modelPosition:x5e,modelRadius:_re,modelScale:b5e,modelViewMatrix:wm,modelViewPosition:_5e,modelViewProjection:Mse,modelWorldMatrix:Ed,modelWorldMatrixInverse:S5e,morphReference:Ise,mrt:Iae,mul:Ci,mx_aastep:Voe,mx_add:e6e,mx_atan2:a6e,mx_cell_noise_float:KHe,mx_contrast:kHe,mx_divide:i6e,mx_fractal_noise_float:$He,mx_fractal_noise_vec2:JHe,mx_fractal_noise_vec3:qHe,mx_fractal_noise_vec4:QHe,mx_frame:l6e,mx_heighttonormal:y6e,mx_hsvtorgb:PHe,mx_ifequal:d6e,mx_ifgreater:c6e,mx_ifgreatereq:h6e,mx_invert:u6e,mx_modulo:r6e,mx_multiply:n6e,mx_noise_float:zHe,mx_noise_vec3:VHe,mx_noise_vec4:HHe,mx_place2d:p6e,mx_power:s6e,mx_ramp4:LHe,mx_ramplr:BHe,mx_ramptb:FHe,mx_rgbtohsv:DHe,mx_rotate2d:m6e,mx_rotate3d:g6e,mx_safepower:UHe,mx_separate:f6e,mx_splitlr:IHe,mx_splittb:GHe,mx_srgb_texture_to_lin_rec709:NHe,mx_subtract:t6e,mx_timer:o6e,mx_transform_uv:OHe,mx_unifiednoise2d:XHe,mx_unifiednoise3d:WHe,mx_worley_noise_float:ZHe,mx_worley_noise_vec2:jHe,mx_worley_noise_vec3:YHe,negate:t4,neutralToneMapping:loe,nodeArray:Gx,nodeImmutable:En,nodeObject:Dn,nodeObjectIntent:QC,nodeObjects:BF,nodeProxy:Ri,nodeProxyIntent:dn,normalFlat:Cre,normalGeometry:jF,normalLocal:jc,normalMap:pk,normalView:Ur,normalViewGeometry:MM,normalWorld:t1,normalWorldGeometry:wre,normalize:nc,not:tie,notEqual:Kne,numWorkgroups:CVe,objectDirection:f5e,objectGroup:jV,objectPosition:bre,objectRadius:y5e,objectScale:m5e,objectViewPosition:g5e,objectWorldMatrix:p5e,oneMinus:bie,or:eie,orthographicDepthToViewZ:K5e,oscSawtooth:S9e,oscSine:x9e,oscSquare:b9e,oscTriangle:_9e,output:QS,outputStruct:qze,overlay:lke,overloadingFn:Jl,packHalf2x16:h9e,packSnorm2x16:u9e,packUnorm2x16:c9e,parabola:bk,parallaxDirection:Zre,parallaxUV:L5e,parameter:Kze,pass:oVe,passTexture:lVe,pcurve:o9e,perspectiveDepthToViewZ:z4,pmremTexture:K4,pointShadow:Foe,pointUV:j9e,pointWidth:GUe,positionGeometry:Hl,positionLocal:Ia,positionPrevious:ZB,positionView:co,positionViewDirection:Cs,positionWorld:Th,positionWorldDirection:T4,posterize:aVe,pow:wd,pow2:a4,pow3:Pie,pow4:o4,premultiplyAlpha:Kse,property:Vf,quadBroadcast:v4e,quadSwapDiagonal:d4e,quadSwapX:c4e,quadSwapY:h4e,radians:gie,rand:Bie,range:AVe,rangeFog:SVe,rangeFogFactor:lH,reciprocal:Sie,reference:Es,referenceBuffer:ck,reflect:wie,reflectVector:Nre,reflectView:Pre,reflector:N9e,refract:u4,refractVector:Bre,refractView:Dre,reinhardToneMapping:roe,remap:ure,remapClamp:cre,renderGroup:ti,renderOutput:v4,rendererReference:Qie,replaceDefaultUV:M9e,rotate:zR,rotateUV:A9e,roughness:Qp,round:_ie,rtt:Xae,sRGBTransferEOTF:Yie,sRGBTransferOETF:Kie,sample:k9e,sampler:i5e,samplerComparison:r5e,saturate:VF,saturation:nVe,screen:oke,screenCoordinate:Ib,screenDPR:M4,screenSize:pb,screenUV:t0,scriptable:_Ve,scriptableValue:YN,select:Zl,setCurrentStack:eE,setName:d4,shaderStages:GB,shadow:Doe,shadowPositionWorld:pH,shapeCircle:G4e,sharedUniformGroup:GF,sheen:dh,sheenRoughness:Uy,shiftLeft:oie,shiftRight:lie,shininess:VB,sign:e4,sin:Wu,sinc:l9e,skinning:Nse,smoothstep:Rh,smoothstepElement:Lie,specularColor:Vv,specularColorBlended:Ax,specularF90:qS,spherizeUV:T9e,split:LUe,spritesheetUV:E9e,sqrt:vu,stack:jN,step:zF,stepElement:Iie,storage:n0,storageBarrier:BVe,storageObject:k5e,storageTexture:$ae,string:BUe,struct:Jze,sub:Dr,subBuild:eM,subgroupAdd:$Ve,subgroupAll:o4e,subgroupAnd:n4e,subgroupAny:l4e,subgroupBallot:KVe,subgroupBroadcast:f4e,subgroupBroadcastFirst:u4e,subgroupElect:YVe,subgroupExclusiveAdd:qVe,subgroupExclusiveMul:t4e,subgroupInclusiveAdd:JVe,subgroupInclusiveMul:e4e,subgroupIndex:z5e,subgroupMax:a4e,subgroupMin:s4e,subgroupMul:QVe,subgroupOr:i4e,subgroupShuffle:p4e,subgroupShuffleDown:y4e,subgroupShuffleUp:g4e,subgroupShuffleXor:m4e,subgroupSize:PVe,subgroupXor:r4e,tan:vie,tangentGeometry:YF,tangentLocal:UR,tangentView:KF,tangentWorld:Xre,texture:Qr,texture3D:sL,texture3DLevel:J9e,texture3DLoad:$9e,textureBarrier:FVe,textureBicubic:Bke,textureBicubicLevel:Y4,textureCubeUV:gae,textureLevel:n5e,textureLoad:$a,textureSize:e0,textureStore:Y9e,thickness:VV,time:dA,toneMapping:tre,toneMappingExposure:nre,toonOutlinePass:cVe,transformDirection:Die,transformNormal:Ere,transformNormalToView:w4,transformedClearcoatNormalView:T5e,transformedNormalView:M5e,transformedNormalWorld:A5e,transmission:HB,transpose:Mie,triNoise3D:g9e,triplanarTexture:R9e,triplanarTextures:Vae,trunc:r4,uint:Yt,uintBitsToFloat:t9e,uniform:Qn,uniformArray:gu,uniformCubeTexture:C5e,uniformFlow:Oie,uniformGroup:Vne,uniformTexture:t5e,unpackHalf2x16:p9e,unpackNormal:fk,unpackSnorm2x16:d9e,unpackUnorm2x16:f9e,unpremultiplyAlpha:rke,userData:q9e,uv:_s,uvec2:GV,uvec3:Lb,uvec4:zV,varying:Gm,varyingProperty:fh,vec2:nn,vec3:Ge,vec4:Un,vectorComponents:qv,velocity:eVe,vertexColor:Xse,vertexIndex:Cse,vertexStage:jie,vibrance:iVe,viewZToLogarithmicDepth:V4,viewZToOrthographicDepth:iM,viewZToPerspectiveDepth:k4,viewport:nM,viewportCoordinate:xre,viewportDepthTexture:U4,viewportLinearDepth:J5e,viewportMipTexture:O4,viewportResolution:l5e,viewportSafeUV:w9e,viewportSharedTexture:Qse,viewportSize:A4,viewportTexture:Y5e,viewportUV:o5e,vogelDiskSample:Gf,wgsl:gVe,wgslFn:xVe,workgroupArray:GVe,workgroupBarrier:NVe,workgroupId:wVe,workingToColorSpace:$ie,xor:nie});const Tf=new Q4;class x6e extends n1{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,i){const r=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let a=!1;if(s===null)r._clearColor.getRGB(Tf),Tf.a=r._clearColor.a;else if(s.isColor===!0)s.getRGB(Tf),Tf.a=1,a=!0;else if(s.isNode===!0){const l=this.get(e),u=s;Tf.copy(r._clearColor);let c=l.backgroundMesh;if(c===void 0){let M=function(){s.removeEventListener("dispose",M),c.material.dispose(),c.geometry.dispose()};const f=Un(u).mul(_k).context({getUV:()=>Yae.mul(wre),getTextureLevel:()=>jae}),m=ju.element(3).element(3).equal(1),y=Eh(1,ju.element(1).element(1)).mul(3),_=m.select(Ia.mul(y),Ia);let S=ju.mul(wm.mul(Un(_,0)));S=S.setZ(S.w);const b=new Js;b.name="Background.material",b.side=Er,b.depthTest=!1,b.depthWrite=!1,b.allowOverride=!1,b.fog=!1,b.lights=!1,b.vertexNode=S,b.colorNode=f,l.backgroundMeshNode=f,l.backgroundMesh=c=new Fr(new Db(1,32,32),b),c.frustumCulled=!1,c.name="Background.mesh",s.addEventListener("dispose",M)}const d=u.getCacheKey();l.backgroundCacheKey!==d&&(l.backgroundMeshNode.node=Un(u).mul(_k),l.backgroundMeshNode.needsUpdate=!0,c.material.needsUpdate=!0,l.backgroundCacheKey=d),t.unshift(c,c.geometry,c.material,0,0,null,null)}else Tt("Renderer: Unsupported background configuration.",s);const o=r.xr.getEnvironmentBlendMode();if(o==="additive"?Tf.set(0,0,0,1):o==="alpha-blend"&&Tf.set(0,0,0,0),r.autoClear===!0||a===!0){const l=i.clearColorValue;l.r=Tf.r,l.g=Tf.g,l.b=Tf.b,l.a=Tf.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(l.r*=l.a,l.g*=l.a,l.b*=l.a),i.depthClearValue=r._clearDepth,i.stencilClearValue=r._clearStencil,i.clearColor=r.autoClearColor===!0,i.clearDepth=r.autoClearDepth===!0,i.clearStencil=r.autoClearStencil===!0}else i.clearColor=!1,i.clearDepth=!1,i.clearStencil=!1}}let b6e=0;class Sk{constructor(e="",t=[],i=0,r=[]){this.name=e,this.bindings=t,this.index=i,this.bindingsReference=r,this.id=b6e++}}class _6e{constructor(e,t,i,r,s,a,o,l,u,c=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=i,this.transforms=c,this.nodeAttributes=r,this.bindings=s,this.updateNodes=a,this.updateBeforeNodes=o,this.updateAfterNodes=l,this.observer=u,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new Sk(t.name,[],t.index,t.bindingsReference);e.push(r);for(const s of t.bindings)r.bindings.push(s.clone())}else e.push(t);return e}}class Mk{constructor(e,t,i=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=i}}class Zoe{constructor(e,t,i){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=i}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class _H{constructor(e,t,i=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=i,this.count=r}}class joe extends _H{constructor(e,t,i=null,r=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=i,this.interpolationSampling=r}}class Yoe{constructor(e,t,i=""){this.name=e,this.type=t,this.code=i,Object.defineProperty(this,"isNodeCode",{value:!0})}}let S6e=0;class $N{constructor(e=null){this.id=S6e++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class M6e{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class r1{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class A6e extends r1{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class T6e extends r1{constructor(e,t=new rt){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class C6e extends r1{constructor(e,t=new re){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class w6e extends r1{constructor(e,t=new si){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class E6e extends r1{constructor(e,t=new en){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class R6e extends r1{constructor(e,t=new rA){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class P6e extends r1{constructor(e,t=new Li){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class D6e extends r1{constructor(e,t=new Mn){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class N6e extends A6e{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class B6e extends T6e{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class F6e extends C6e{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class L6e extends w6e{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class I6e extends E6e{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class G6e extends R6e{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class O6e extends P6e{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class U6e extends D6e{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let k6e=0;const z6e=new WeakMap,nY=new WeakMap,V6e=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),ID=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class SH{constructor(e,t,i){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=i,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=jN(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new $N,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:k6e++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===Al&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=nY.get(this.renderer);return e===void 0&&(e=new Jf,nY.set(this.renderer,e)),e}createRenderTarget(e,t,i){return new Wd(e,t,i)}createCubeRenderTarget(e,t){return new tae(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const i=this.getBindGroupsCache(),r=[];let s=!0;for(const o of t)r.push(o),s=s&&o.groupNode.shared!==!0;let a;return s?(a=i.get(r),a===void 0&&(a=new Sk(e,r,this.bindingsIndexes[e].group,r),i.set(r,a))):a=new Sk(e,r,this.bindingsIndexes[e].group,r),a}getBindGroupArray(e,t){const i=this.bindings[t];let r=i[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),i[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},i=this.bindings;for(const r of GB)for(const s in i[r]){const a=i[r][s];(t[s]||(t[s]=[])).push(...a)}e=[];for(const r in t){const s=t[r],a=this._getBindGroup(r,s);e.push(a)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,i)=>t.bindings[0].groupNode.order-i.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const i=e[t];this.bindingsIndexes[i.name].group=t,i.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==Ni.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),i=e.getUpdateAfterType();t!==Ni.NONE&&this.updateBeforeNodes.push(e),i!==Ni.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Jn||e.magFilter===sm||e.magFilter===xh||e.magFilter===Vo||e.minFilter===Jn||e.minFilter===sm||e.minFilter===xh||e.minFilter===Vo}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){const e={...this.context};return delete e.material,delete e.getUV,delete e.getOutput,delete e.getTextureLevel,delete e.getAO,delete e.getShadow,e}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const i=this.getDataFromNode(e);return i.cache===void 0&&(i.cache=new $N(t?this.getCache():null)),i.cache}isAvailable(){return!1}getVertexIndex(){mt("Abstract function.")}getInstanceIndex(){mt("Abstract function.")}getDrawIndex(){mt("Abstract function.")}getFrontFacing(){mt("Abstract function.")}getFragCoord(){mt("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){mt("Abstract function.")}generateTextureLod(){mt("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,i=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const a=i?i[s]:null;a!==null?r+=a.build(this,e):r+=this.generateConst(e),s<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,i=null){const r=[];for(const s of t){const{name:a,type:o}=s;i&&i[a]&&i[a].isNode?r.push(i[a].build(this,o)):r.push(this.generateConst(o))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new en:e==="vec2"||e==="uvec2"||e==="ivec2"?t=new rt:e==="vec3"||e==="uvec3"||e==="ivec3"?t=new re:(e==="vec4"||e==="uvec4"||e==="ivec4")&&(t=new si)),e==="float")return ID(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${ID(t.r)}, ${ID(t.g)}, ${ID(t.b)} )`;const i=this.getTypeLength(e),r=this.getComponentType(e),s=a=>this.generateConst(r,a);if(i===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(i===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(i===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(i>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(i>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const i=this.attributes;for(const s of i)if(s.name===e)return s;const r=new Mk(e,t);return this.registerDeclaration(r),i.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Ao)return"int";if(t===qr)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let i=AV(e);const r=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(i=i.replace("vec","mat")),r+i}getTypeFromArray(e){return V6e.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const i=t.array,r=e.itemSize,s=e.normalized;let a;return!(e instanceof $2)&&s!==!0&&(a=this.getTypeFromArray(i)),this.getTypeFromLength(r,a)}getTypeLength(e){const t=this.getVectorType(e),i=/vec([2-4])/.exec(t);return i!==null?Number(i[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=jN(this.stack);const e=IV();return this.stacks.push(e),eE(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const i=this.getDataFromNode(t);i.stack=e}return this.stack=e.parent,eE(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,i=null){i=i===null?e.isGlobal(this)?this.globalCache:this.cache:i;let r=i.getData(e);r===void 0&&(r={},i.setData(e,r)),r[t]===void 0&&(r[t]={});let s=r[t];const a=r.any?r.any.subBuilds:null,o=this.getClosestSubBuild(a);return o&&(s.subBuildsCache===void 0&&(s.subBuildsCache={}),s=s.subBuildsCache[o]||(s.subBuildsCache[o]={}),s.subBuilds=a),s}getNodeProperties(e,t="any"){const i=this.getDataFromNode(e,t);return i.properties||(i.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const i=this.getDataFromNode(e,"vertex");let r=i.bufferAttribute;if(r===void 0){const s=this.uniforms.index++;r=new Mk("nodeAttribute"+s,t,e),this.bufferAttributes.push(r),i.bufferAttribute=r}return r}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,i=null,r=this.shaderStage){const s=this.getDataFromNode(e,r,this.globalCache);let a=s.structType;if(a===void 0){const o=this.structs.index++;i===null&&(i="StructType"+o),a=new M6e(i,t),this.structs[r].push(a),this.types[r][i]=e,s.structType=a}return a}getOutputStructTypeFromNode(e,t){const i=this.getStructTypeFromNode(e,t,"OutputType","fragment");return i.output=!0,i}getUniformFromNode(e,t,i=this.shaderStage,r=null){const s=this.getDataFromNode(e,i,this.globalCache);let a=s.uniform;if(a===void 0){const o=this.uniforms.index++;a=new Zoe(r||"nodeUniform"+o,t,e),this.uniforms[i].push(a),this.registerDeclaration(a),s.uniform=a}return a}getVarFromNode(e,t=null,i=e.getNodeType(this),r=this.shaderStage,s=!1){const a=this.getDataFromNode(e,r),o=this.getSubBuildProperty("variable",a.subBuilds);let l=a[o];if(l===void 0){const u=s?"_const":"_var",c=this.vars[r]||(this.vars[r]=[]),d=this.vars[u]||(this.vars[u]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+d,this.vars[u]++),o!=="variable"&&(t=this.getSubBuildProperty(t,a.subBuilds));const f=e.getArrayCount(this);l=new _H(t,i,s,f),s||c.push(l),this.registerDeclaration(l),a[o]=l}return l}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,i=e.getNodeType(this),r=null,s=null){const a=this.getDataFromNode(e,"any"),o=this.getSubBuildProperty("varying",a.subBuilds);let l=a[o];if(l===void 0){const u=this.varyings,c=u.length;t===null&&(t="nodeVarying"+c),o!=="varying"&&(t=this.getSubBuildProperty(t,a.subBuilds)),l=new joe(t,i,r,s),u.push(l),this.registerDeclaration(l),a[o]=l}return l}registerDeclaration(e){const t=this.shaderStage,i=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let s=1,a=r;for(;i[a]!==void 0;)a=r+"_"+s++;s>1&&(e.name=a,mt(`TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${a}'.`)),i[a]=e}getCodeFromNode(e,t,i=this.shaderStage){const r=this.getDataFromNode(e);let s=r.code;if(s===void 0){const a=this.codes[i]||(this.codes[i]=[]),o=a.length;s=new Yoe("nodeCode"+o,t),a.push(s),r.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:i,flowCodeBlock:r}=this.getDataFromNode(e);let s=!0,a=t;for(;a;){if(r.get(a)===!0){s=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(s)for(const o of i)this.addLineFlowCode(o)}addLineFlowCodeBlock(e,t,i){const r=this.getDataFromNode(e),s=r.flowCodes||(r.flowCodes=[]),a=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);s.push(t),a.set(i,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),i=this.flowChildNode(e,t);return this.flowsData.set(e,i),i}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new oH,i=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=i,t}flowShaderNode(e){const t=e.layout,i={[Symbol.iterator](){let a=0;const o=Object.values(this);return{next:()=>({value:o[a],done:a++>=o.length})}}};for(const a of t.inputs)i[a.name]=new eH(a.type,a.name);e.layout=null;const r=e.call(i),s=this.flowStagesNode(r,t.type);return e.layout=t,s}flowBuildStage(e,t,i=null){const r=this.getBuildStage();this.setBuildStage(t);const s=e.build(this,i);return this.setBuildStage(r),s}flowStagesNode(e,t=null){const i=this.flow,r=this.vars,s=this.declarations,a=this.cache,o=this.buildStage,l=this.stack,u={code:""};this.flow=u,this.vars={},this.declarations={},this.cache=new $N,this.stack=jN();for(const c of IB)this.setBuildStage(c),u.result=e.build(this,t);return u.vars=this.getVars(this.shaderStage),this.flow=i,this.vars=r,this.declarations=s,this.cache=a,this.stack=l,this.setBuildStage(o),u}getFunctionOperator(){return null}buildFunctionCode(){mt("Abstract function.")}flowChildNode(e,t=null){const i=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=i,r}flowNodeFromShaderStage(e,t,i=null,r=null){const s=this.tab,a=this.cache,o=this.shaderStage,l=this.context;this.setShaderStage(e);const u={...this.context};delete u.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=u;let c=null;if(this.buildStage==="generate"){const d=this.flowChildNode(t,i);r!==null&&(d.code+=`${this.tab+r} = ${d.result};
`),this.flowCode[e]=this.flowCode[e]+d.code,c=d}else c=t.build(this);return this.setShaderStage(o),this.cache=a,this.tab=s,this.context=l,c}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){mt("Abstract function.")}getVaryings(){mt("Abstract function.")}getVar(e,t,i=null){return`${i!==null?this.generateArrayDeclaration(e,i):this.getType(e)} ${t}`}getVars(e){let t="";const i=this.vars[e];if(i!==void 0)for(const r of i)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){mt("Abstract function.")}getCodes(e){const t=this.codes[e];let i="";if(t!==void 0)for(const r of t)i+=r.code+`
`;return i}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){mt("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const i=this.subBuildLayers;for(let r=t.length-1;r>=0;r--){const s=t[r];if(i.includes(s))return s}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let i;t!==null?i=this.getClosestSubBuild(t):i=this.subBuildFn;let r;return i?r=e?i+"_"+e:i:r=e,r}build(){const{object:e,material:t,renderer:i}=this;if(t!==null){let r=i.library.fromMaterial(t);r===null&&(Tt(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new Js),r.build(this)}else this.addFlow("compute",e);for(const r of IB){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of GB){this.setShaderStage(s);const a=this.flowNodes[s];for(const o of a)r==="generate"?this.flowNode(o):o.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(e){let t=z6e.get(e);return t===void 0&&(t={}),t}getNodeUniform(e,t){const i=this.getSharedDataFromNode(e);let r=i.cache;if(r===void 0){if(t==="float"||t==="int"||t==="uint")r=new N6e(e);else if(t==="vec2"||t==="ivec2"||t==="uvec2")r=new B6e(e);else if(t==="vec3"||t==="ivec3"||t==="uvec3")r=new F6e(e);else if(t==="vec4"||t==="ivec4"||t==="uvec4")r=new L6e(e);else if(t==="color")r=new I6e(e);else if(t==="mat2")r=new G6e(e);else if(t==="mat3")r=new O6e(e);else if(t==="mat4")r=new U6e(e);else throw new Error(`Uniform "${t}" not implemented.`);i.cache=r}return r}format(e,t,i){if(t=this.getVectorType(t),i=this.getVectorType(i),t===i||i===null||this.isReference(i))return e;const r=this.getTypeLength(t),s=this.getTypeLength(i);return r===16&&s===9?`${this.getType(i)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:r===9&&s===4?`${this.getType(i)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||s>4||s===0?e:r===s?`${this.getType(i)}( ${e} )`:r>s?(e=i==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),i)):s===4&&r>1?`${this.getType(i)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(i)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&s>1&&t!==this.getComponentType(i)&&(e=`${this.getType(this.getComponentType(i))}( ${e} )`),`${this.getType(i)}( ${e} )`)}getSignature(){return`// Three.js r${Xd} - Node System
`}}class Ak{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let i=e.get(t);return i===void 0&&(i={renderId:0,frameId:0},e.set(t,i)),i}updateBeforeNode(e){const t=e.getUpdateBeforeType(),i=e.updateReference(this);if(t===Ni.FRAME){const r=this._getMaps(this.updateBeforeMap,i);if(r.frameId!==this.frameId){const s=r.frameId;r.frameId=this.frameId,e.updateBefore(this)===!1&&(r.frameId=s)}}else if(t===Ni.RENDER){const r=this._getMaps(this.updateBeforeMap,i);if(r.renderId!==this.renderId){const s=r.renderId;r.renderId=this.renderId,e.updateBefore(this)===!1&&(r.renderId=s)}}else t===Ni.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),i=e.updateReference(this);if(t===Ni.FRAME){const r=this._getMaps(this.updateAfterMap,i);r.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(r.frameId=this.frameId)}else if(t===Ni.RENDER){const r=this._getMaps(this.updateAfterMap,i);r.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(r.renderId=this.renderId)}else t===Ni.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),i=e.updateReference(this);if(t===Ni.FRAME){const r=this._getMaps(this.updateMap,i);r.frameId!==this.frameId&&e.update(this)!==!1&&(r.frameId=this.frameId)}else if(t===Ni.RENDER){const r=this._getMaps(this.updateMap,i);r.renderId!==this.renderId&&e.update(this)!==!1&&(r.renderId=this.renderId)}else t===Ni.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class dL{constructor(e,t,i=null,r="",s=!1){this.type=e,this.name=t,this.count=i,this.qualifier=r,this.isConst=s}}dL.isNodeFunctionInput=!0;class Koe extends i1{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:fH(this.light),lightColor:e}}}const VO=new Mn,GD=new Mn;let pC=null;class $oe extends i1{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Qn(new re).setGroup(ti),this.halfWidth=Qn(new re).setGroup(ti),this.updateType=Ni.RENDER}update(e){super.update(e);const{light:t}=this,i=e.camera.matrixWorldInverse;GD.identity(),VO.copy(t.matrixWorld),VO.premultiply(i),GD.extractRotation(VO),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(GD),this.halfHeight.value.applyMatrix4(GD)}setupDirectRectArea(e){let t,i;e.isAvailable("float32Filterable")?(t=Qr(pC.LTC_FLOAT_1),i=Qr(pC.LTC_FLOAT_2)):(t=Qr(pC.LTC_HALF_1),i=Qr(pC.LTC_HALF_2));const{colorNode:r,light:s}=this,a=dH(s);return{lightColor:r,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:i}}static setLTC(e){pC=e}}class fL extends i1{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Qn(0).setGroup(ti),this.penumbraCosNode=Qn(0).setGroup(ti),this.cutoffDistanceNode=Qn(0).setGroup(ti),this.decayExponentNode=Qn(0).setGroup(ti),this.colorNode=Qn(this.color).setGroup(ti)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:i,penumbraCosNode:r}=this;return Rh(i,r,t)}getLightCoord(e){const t=e.getNodeProperties(this);let i=t.projectionUV;return i===void 0&&(i=moe(this.light,e.context.positionWorld),t.projectionUV=i),i}setupDirect(e){const{colorNode:t,cutoffDistanceNode:i,decayExponentNode:r,light:s}=this,a=this.getLightVector(e),o=a.normalize(),l=o.dot(fH(s)),u=this.getSpotAttenuation(e,l),c=a.length(),d=vH({lightDistance:c,cutoffDistance:i,decayExponent:r});let f=t.mul(u).mul(d),m,y;return s.colorNode?(y=this.getLightCoord(e),m=s.colorNode(y)):s.map&&(y=this.getLightCoord(e),m=Qr(s.map,y.xy).onRenderUpdate(()=>s.map)),m&&(f=y.mul(2).sub(1).abs().lessThan(1).all().select(f.mul(m),f)),{lightColor:f,lightDirection:o}}}class Joe extends fL{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const i=this.light.iesMap;let r=null;if(i&&i.isTexture===!0){const s=t.acos().mul(1/Math.PI);r=Qr(i,nn(s,0),0).r}else r=super.getSpotAttenuation(t);return r}}const H6e=We(([n,e])=>{const t=n.abs().sub(e);return pm(ka(t,0)).add(Zc(ka(t.x,t.y),0))});class qoe extends fL{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let i=1;t.map!==null&&(i=t.map.width/t.map.height),t.shadow.aspect=i}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=ge(0),i=this.penumbraCosNode,r=lL(this.light).mul(e.context.positionWorld||Th);return Kn(r.w.greaterThan(0),()=>{const s=r.xyz.div(r.w),a=H6e(s.xy.sub(nn(.5)),nn(.5)),o=Eh(-1,Dr(1,QV(i)).sub(1));t.assign(VF(a.mul(-2).mul(o)))}),t}}class Qoe extends i1{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class ele extends i1{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=hH(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Qn(new en).setGroup(ti)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:i,lightDirectionNode:r}=this,a=t1.dot(r).mul(.5).add(.5),o=vr(i,t,a);e.context.irradiance.addAssign(o)}}class tle extends i1{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let i=0;i<9;i++)t.push(new re);this.lightProbe=gu(t)}update(e){const{light:t}=this;super.update(e);for(let i=0;i<9;i++)this.lightProbe.array[i].copy(t.sh.coefficients[i]).multiplyScalar(t.intensity)}setup(e){const t=Woe(t1,this.lightProbe);e.context.irradiance.addAssign(t)}}class nle{parseFunction(){mt("Abstract function.")}}class MH{constructor(e,t,i="",r=""){this.type=e,this.inputs=t,this.name=i,this.precision=r}getCode(){mt("Abstract function.")}}MH.isNodeFunction=!0;const X6e=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,W6e=/[a-z_0-9]+/ig,iY="#pragma main",Z6e=n=>{n=n.trim();const e=n.indexOf(iY),t=e!==-1?n.slice(e+iY.length):n,i=t.match(X6e);if(i!==null&&i.length===5){const r=i[4],s=[];let a=null;for(;(a=W6e.exec(r))!==null;)s.push(a);const o=[];let l=0;for(;l<s.length;){const y=s[l][0]==="const";y===!0&&l++;let _=s[l][0];_==="in"||_==="out"||_==="inout"?l++:_="";const S=s[l++][0];let b=Number.parseInt(s[l][0]);Number.isNaN(b)===!1?l++:b=null;const M=s[l++][0];o.push(new dL(S,M,b,_,y))}const u=t.substring(i[0].length),c=i[3]!==void 0?i[3]:"",d=i[2],f=i[1]!==void 0?i[1]:"",m=e!==-1?n.slice(0,e):"";return{type:d,inputs:o,name:c,precision:f,inputsCode:r,blockCode:u,headerCode:m}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class j6e extends MH{constructor(e){const{type:t,inputs:i,name:r,precision:s,inputsCode:a,blockCode:o,headerCode:l}=Z6e(e);super(t,i,r,s),this.inputsCode=a,this.blockCode=o,this.headerCode=l}getCode(e=this.name){let t;const i=this.blockCode;if(i!==""){const{type:r,inputsCode:s,headerCode:a,precision:o}=this;let l=`${r} ${e} ( ${s.trim()} )`;o!==""&&(l=`${o} ${l}`),t=a+l+i}else t="";return t}}class ile extends nle{parseFunction(e){return new j6e(e)}}const rY=new WeakMap,Yp=[],_y=[];class Y6e extends n1{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new Ak,this.nodeBuilderCache=new Map,this.callHashCache=new Jf,this.groupsData=new Jf,this.cacheLib={}}updateGroup(e){const t=e.groupNode,i=t.name;if(i===jV.name)return!0;if(i===ti.name){const s=this.get(e),a=this.nodeFrame.renderId;return s.renderId!==a?(s.renderId=a,!0):!1}if(i===Hne.name){const s=this.get(e),a=this.nodeFrame.frameId;return s.frameId!==a?(s.frameId=a,!0):!1}Yp[0]=t,Yp[1]=e;let r=this.groupsData.get(Yp);return r===void 0&&this.groupsData.set(Yp,r={}),Yp.length=0,r.version!==t.version?(r.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let i=t.nodeBuilderState;if(i===void 0){const{nodeBuilderCache:r}=this,s=this.getForRenderCacheKey(e);if(i=r.get(s),i===void 0){const a=l=>{const u=this.backend.createNodeBuilder(e.object,this.renderer);return u.scene=e.scene,u.material=l,u.camera=e.camera,u.context.material=l,u.lightsNode=e.lightsNode,u.environmentNode=this.getEnvironmentNode(e.scene),u.fogNode=this.getFogNode(e.scene),u.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&u.enableMultiview(),u};let o=a(e.material);try{o.build()}catch(l){o=a(new Js),o.build(),Tt("TSL: "+l)}i=this._createNodeBuilderState(o),r.set(s,i)}i.usedTimes++,t.nodeBuilderState=i}return i}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let i=t.nodeBuilderState;if(i===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),i=this._createNodeBuilderState(r),t.nodeBuilderState=i}return i}_createNodeBuilderState(e){return new _6e(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const i=this.get(e);i.environmentNode&&(t=i.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const i=this.get(e);i.backgroundNode&&(t=i.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){Yp[0]=e,Yp[1]=t;const i=this.renderer.info.calls,r=this.callHashCache.get(Yp)||{};if(r.callId!==i){const s=this.getEnvironmentNode(e),a=this.getFogNode(e);t&&_y.push(t.getCacheKey(!0)),s&&_y.push(s.getCacheKey()),a&&_y.push(a.getCacheKey()),_y.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),_y.push(this.renderer.shadowMap.enabled?1:0),_y.push(this.renderer.shadowMap.type),r.callId=i,r.cacheKey=Fb(_y),this.callHashCache.set(Yp,r),_y.length=0}return Yp.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),i=e.background;if(i){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==i||r){const s=this.getCacheNode("background",i,()=>{if(i.isCubeTexture===!0||i.mapping===Mm||i.mapping===h0||i.mapping===Am){if(e.backgroundBlurriness>0||i.mapping===Am)return K4(i);{let a;return i.isCubeTexture===!0?a=$u(i):a=Qr(i),iae(a)}}else{if(i.isTexture===!0)return Qr(i,t0.flipY()).setUpdateMatrix(!0);i.isColor!==!0&&Tt("WebGPUNodes: Unsupported background configuration.",i)}},r);t.backgroundNode=s,t.background=i,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,i,r=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let a=s.get(t);return(a===void 0||r)&&(a=i(),s.set(t,a)),a}updateFog(e){const t=this.get(e),i=e.fog;if(i){if(t.fog!==i){const r=this.getCacheNode("fog",i,()=>{if(i.isFogExp2){const s=Es("color","color",i).setGroup(ti),a=Es("density","float",i).setGroup(ti);return sE(s,uH(a))}else if(i.isFog){const s=Es("color","color",i).setGroup(ti),a=Es("near","float",i).setGroup(ti),o=Es("far","float",i).setGroup(ti);return sE(s,lH(a,o))}else Tt("Renderer: Unsupported fog configuration.",i)});t.fogNode=r,t.fog=i}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),i=e.environment;if(i){if(t.environment!==i){const r=this.getCacheNode("environment",i,()=>{if(i.isCubeTexture===!0)return $u(i);if(i.isTexture===!0)return Qr(i);Tt("Nodes: Unsupported environment configuration.",i)});t.environmentNode=r,t.environment=i}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,i=null,r=null,s=null){const a=this.nodeFrame;return a.renderer=e,a.scene=t,a.object=i,a.camera=r,a.material=s,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return rY.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,i=this.getOutputCacheKey(),r=e.isArrayTexture?sL(e,Ge(t0,R0("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):Qr(e,t0).renderOutput(t.toneMapping,t.currentColorSpace);return rY.set(e,i),r}updateBefore(e){const t=e.getNodeBuilderState();for(const i of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(i)}updateAfter(e){const t=e.getNodeBuilderState();for(const i of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(i)}updateForCompute(e){const t=this.getNodeFrame(),i=this.getForCompute(e);for(const r of i.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),i=e.getNodeBuilderState();for(const r of i.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new Ak,this.nodeBuilderCache=new Map,this.cacheLib={}}}const HO=new Xl;class QB{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Li,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,i){const r=e.length;for(let s=0;s<r;s++){HO.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const a=t[i+s],o=HO.normal;a.x=-o.x,a.y=-o.y,a.z=-o.z,a.w=HO.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let i=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,s=r.length;let a,o;if(this.clipIntersection?(a=this.intersectionPlanes,o=e.intersectionPlanes.length):(a=this.unionPlanes,o=e.unionPlanes.length),a.length!==o+s){a.length=o+s;for(let l=0;l<s;l++)a[o+l]=new si;i=!0}this.projectPlanes(r,a,o),i&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new QB(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class K6e{constructor(e,t){this.bundleGroup=e,this.camera=t}}const mC=[];class $6e{constructor(){this.bundles=new Jf}get(e,t){const i=this.bundles;mC[0]=e,mC[1]=t;let r=i.get(mC);return r===void 0&&(r=new K6e(e,t),i.set(mC,r)),mC.length=0,r}dispose(){this.bundles=new Jf}}class rle{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const i=this.getMaterialNodeClass(e.type);if(i!==null){t=new i;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,i){if(i.has(t)){mt(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);i.set(t,e)}addClass(e,t,i){if(i.has(t)){mt(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);i.set(t,e)}}const J6e=new uL,gC=[];class sle extends Jf{constructor(){super()}createNode(e=[]){return new uL().setLights(e)}getNode(e,t){if(e.isQuadMesh)return J6e;gC[0]=e,gC[1]=t;let i=this.get(gC);return i===void 0&&(i=this.createNode(),this.set(gC,i)),gC.length=0,i}}class ew extends Wd{constructor(e=1,t=1,i={}){super(e,t,i),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const sY=new re,aY=new re;class q6e extends wl{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new ds,this._cameraL.viewport=new si,this._cameraR=new ds,this._cameraR.viewport=new si,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new CF,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=r8e.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new rt,this._onSessionEvent=t8e.bind(this),this._onSessionEnd=n8e.bind(this),this._onInputSourcesChange=i8e.bind(this),this._onAnimationFrame=s8e.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&mt("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&mt("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,i,r,s,a,o,l={}){const u=new ap(e,t),c=new ew(s,a,{format:Vr,type:br,depthTexture:new po(s,a,l.stencil?jl:qr,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?bl:Xo),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});c._autoAllocateDepthBuffer=!0;const d=new La({color:16777215,side:wo});d.map=c.texture,d.map.offset.y=1,d.map.repeat.y=-1;const f=new Fr(u,d);f.position.copy(i),f.quaternion.copy(r);const m={type:"quad",width:e,height:t,translation:i,quaternion:r,pixelwidth:s,pixelheight:a,plane:f,material:d,rendercall:o,renderTarget:c};if(this._layers.push(m),this._session!==null){m.plane.material=new La({color:16777215,side:wo}),m.plane.material.blending=nv,m.plane.material.blendEquation=vl,m.plane.material.blendSrc=Bf,m.plane.material.blendDst=Bf,m.xrlayer=this._createXRLayer(m);const y=this._session.renderState.layers;y.unshift(m.xrlayer),this._session.updateRenderState({layers:y})}else c.isXRRenderTarget=!1;return f}createCylinderLayer(e,t,i,r,s,a,o,l,u={}){const c=new Pb(e,e,e*t/i,64,64,!0,Math.PI-t/2,t),d=new ew(a,o,{format:Vr,type:br,depthTexture:new po(a,o,u.stencil?jl:qr,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?bl:Xo),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});d._autoAllocateDepthBuffer=!0;const f=new La({color:16777215,side:Er});f.map=d.texture,f.map.offset.y=1,f.map.repeat.y=-1;const m=new Fr(c,f);m.position.copy(r),m.quaternion.copy(s);const y={type:"cylinder",radius:e,centralAngle:t,aspectratio:i,translation:r,quaternion:s,pixelwidth:a,pixelheight:o,plane:m,material:f,rendercall:l,renderTarget:d};if(this._layers.push(y),this._session!==null){y.plane.material=new La({color:16777215,side:Er}),y.plane.material.blending=nv,y.plane.material.blendEquation=vl,y.plane.material.blendSrc=Bf,y.plane.material.blendDst=Bf,y.xrlayer=this._createXRLayer(y);const _=this._session.renderState.layers;_.unshift(y.xrlayer),this._session.updateRenderState({layers:_})}else d.isXRRenderTarget=!1;return m}renderLayers(){const e=new re,t=new ba,i=this._renderer,r=this.isPresenting,s=i.getOutputRenderTarget(),a=i._frameBufferTarget;this.isPresenting=!1;const o=new rt;i.getSize(o);const l=i._quad;for(const u of this._layers)if(u.renderTarget.isXRRenderTarget=this._session!==null,u.renderTarget._hasExternalTextures=u.renderTarget.isXRRenderTarget,u.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){u.xrlayer.transform=new XRRigidTransform(u.plane.getWorldPosition(e),u.plane.getWorldQuaternion(t));const c=this._glBinding.getSubImage(u.xrlayer,this._xrFrame);i.backend.setXRRenderTargetTextures(u.renderTarget,c.colorTexture,void 0),i._setXRLayerSize(u.renderTarget.width,u.renderTarget.height),i.setOutputRenderTarget(u.renderTarget),i.setRenderTarget(null),i._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:d,quad:f}=this._frameBufferTargets.get(u.renderTarget)||{frameBufferTarget:null,quad:null};d?(i._frameBufferTarget=d,i._quad=f):(i._quad=new fA(new Js),this._frameBufferTargets.set(u.renderTarget,{frameBufferTarget:i._getFrameBufferTarget(),quad:i._quad})),u.rendercall(),i._frameBufferTarget=null}else i.setRenderTarget(u.renderTarget),u.rendercall();i.setRenderTarget(null),i.setOutputRenderTarget(s),i._frameBufferTarget=a,i._setXRLayerSize(o.x,o.y),i._quad=l,this.isPresenting=r}getSession(){return this._session}async setSession(e){const t=this._renderer,i=t.backend;this._gl=t.getContext();const r=this._gl,s=r.getContextAttributes();if(this._session=e,e!==null){if(i.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await i.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let a=null,o=null,l=null;t.depth&&(l=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,a=t.stencil?bl:Xo,o=t.stencil?jl:qr);const u={colorFormat:r.RGBA8,depthFormat:l,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(u.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const c=this._glBinding.createProjectionLayer(u),d=[c];this._glProjLayer=c,t.setPixelRatio(1),t._setXRLayerSize(c.textureWidth,c.textureHeight);const f=this._useMultiview?2:1,m=new po(c.textureWidth,c.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,a,f);if(this._xrRenderTarget=new ew(c.textureWidth,c.textureHeight,{format:Vr,type:br,colorSpace:t.outputColorSpace,depthTexture:m,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:c.ignoreDepthValues===!1,resolveStencilBuffer:c.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const y of this._layers)y.plane.material=new La({color:16777215,side:y.type==="cylinder"?Er:wo}),y.plane.material.blending=nv,y.plane.material.blendEquation=vl,y.plane.material.blendSrc=Bf,y.plane.material.blendDst=Bf,y.xrlayer=this._createXRLayer(y),d.unshift(y.xrlayer);e.updateRenderState({layers:d})}else{const a={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},o=new XRWebGLLayer(e,r,a);this._glBaseLayer=o,e.updateRenderState({baseLayer:o}),t.setPixelRatio(1),t._setXRLayerSize(o.framebufferWidth,o.framebufferHeight),this._xrRenderTarget=new ew(o.framebufferWidth,o.framebufferHeight,{format:Vr,type:br,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:o.ignoreDepthValues===!1,resolveStencilBuffer:o.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const i=e.near,r=e.far,s=this._cameraXR,a=this._cameraL,o=this._cameraR;s.near=o.near=a.near=i,s.far=o.far=a.far=r,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),s.layers.mask=e.layers.mask|6,a.layers.mask=s.layers.mask&3,o.layers.mask=s.layers.mask&5;const l=e.parent,u=s.cameras;oY(s,l);for(let c=0;c<u.length;c++)oY(u[c],l);u.length===2?Q6e(s,a,o):s.projectionMatrix.copy(a.projectionMatrix),e8e(e,s,l)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new $S,this._controllers[e]=t),t}}function Q6e(n,e,t){sY.setFromMatrixPosition(e.matrixWorld),aY.setFromMatrixPosition(t.matrixWorld);const i=sY.distanceTo(aY),r=e.projectionMatrix.elements,s=t.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],u=(r[9]-1)/r[5],c=(r[8]-1)/r[0],d=(s[8]+1)/s[0],f=a*c,m=a*d,y=i/(-c+d),_=y*-c;if(e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.translateX(_),n.translateZ(y),n.matrixWorld.compose(n.position,n.quaternion,n.scale),n.matrixWorldInverse.copy(n.matrixWorld).invert(),r[10]===-1)n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const S=a+y,b=o+y,M=f-_,w=m+(i-_),T=l*o/b*S,E=u*o/b*S;n.projectionMatrix.makePerspective(M,w,T,E,S,b),n.projectionMatrixInverse.copy(n.projectionMatrix).invert()}}function oY(n,e){e===null?n.matrixWorld.copy(n.matrix):n.matrixWorld.multiplyMatrices(e.matrixWorld,n.matrix),n.matrixWorldInverse.copy(n.matrixWorld).invert()}function e8e(n,e,t){t===null?n.matrix.copy(e.matrixWorld):(n.matrix.copy(t.matrixWorld),n.matrix.invert(),n.matrix.multiply(e.matrixWorld)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=ub*2*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)}function t8e(n){const e=this._controllerInputSources.indexOf(n.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const i=this.getReferenceSpace();t.update(n.inputSource,n.frame,i),t.dispatchEvent({type:n.type,data:n.inputSource})}}function n8e(){const n=this._session,e=this._renderer;n.removeEventListener("select",this._onSessionEvent),n.removeEventListener("selectstart",this._onSessionEvent),n.removeEventListener("selectend",this._onSessionEvent),n.removeEventListener("squeeze",this._onSessionEvent),n.removeEventListener("squeezestart",this._onSessionEvent),n.removeEventListener("squeezeend",this._onSessionEvent),n.removeEventListener("end",this._onSessionEnd),n.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const i=this._controllerInputSources[t];i!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(i))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new ew(t.pixelwidth,t.pixelheight,{format:Vr,type:br,depthTexture:new po(t.pixelwidth,t.pixelheight,t.stencilBuffer?jl:qr,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?bl:Xo),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function i8e(n){const e=this._controllers,t=this._controllerInputSources;for(let i=0;i<n.removed.length;i++){const r=n.removed[i],s=t.indexOf(r);s>=0&&(t[s]=null,e[s].disconnect(r))}for(let i=0;i<n.added.length;i++){const r=n.added[i];let s=t.indexOf(r);if(s===-1){for(let o=0;o<e.length;o++)if(o>=t.length){t.push(r),s=o;break}else if(t[o]===null){t[o]=r,s=o;break}if(s===-1)break}const a=e[s];a&&a.connect(r)}}function r8e(n){return n.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(n.translation,n.quaternion),width:n.width/2,height:n.height/2,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(n.translation,n.quaternion),radius:n.radius,centralAngle:n.centralAngle,aspectRatio:n.aspectRatio,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1})}function s8e(n,e){if(e===void 0)return;const t=this._cameraXR,i=this._renderer,r=i.backend,s=this._glBaseLayer,a=this.getReferenceSpace(),o=e.getViewerPose(a);if(this._xrFrame=e,o!==null){const l=o.views;this._glBaseLayer!==null&&r.setXRTarget(s.framebuffer);let u=!1;l.length!==t.cameras.length&&(t.cameras.length=0,u=!0);for(let c=0;c<l.length;c++){const d=l[c];let f;if(this._supportsLayers===!0){const y=this._glBinding.getViewSubImage(this._glProjLayer,d);f=y.viewport,c===0&&r.setXRRenderTargetTextures(this._xrRenderTarget,y.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:y.depthStencilTexture)}else f=s.getViewport(d);let m=this._cameras[c];m===void 0&&(m=new ds,m.layers.enable(c),m.viewport=new si,this._cameras[c]=m),m.matrix.fromArray(d.transform.matrix),m.matrix.decompose(m.position,m.quaternion,m.scale),m.projectionMatrix.fromArray(d.projectionMatrix),m.projectionMatrixInverse.copy(m.projectionMatrix).invert(),m.viewport.set(f.x,f.y,f.width,f.height),c===0&&(t.matrix.copy(m.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),u===!0&&t.cameras.push(m)}i.setOutputRenderTarget(this._xrRenderTarget)}for(let l=0;l<this._controllers.length;l++){const u=this._controllerInputSources[l],c=this._controllers[l];u!==null&&c!==void 0&&c.update(u,e,a)}this._currentAnimationLoop&&this._currentAnimationLoop(n,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class ale extends wl{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new si(0,0,this._width,this._height),this._scissor=new si(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new pR,this.depthTexture=new po}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,i){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=i,this.domElement.width=Math.floor(e*i),this.domElement.height=Math.floor(t*i),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,i=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),i===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,i,r){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,i,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,i,r,s=0,a=1){const o=this._viewport;e.isVector4?o.copy(e):o.set(e,t,i,r),o.minDepth=s,o.maxDepth=a}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const lY=new Wc,mS=new rt,XO=new si,WO=new Kv,ZO=new $M,OD=new Mn,wg=new si;class a8e{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:i=!1,alpha:r=!0,depth:s=!0,stencil:a=!1,antialias:o=!1,samples:l=0,getFallback:u=null,outputBufferType:c=zi,multiview:d=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=i,this.outputColorSpace=Ps,this.toneMapping=ho,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=a,this.info=new Bze,this.contextNode=E0(),this.library=new rle,this.lighting=new sle,this._samples=l||o===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new ale(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new x4,this._inspector.setRenderer(this),this._getFallback=u,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new fA(new Js),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const f=this.alpha===!0?0:1;this._clearColor=new Q4(0,0,0,f),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=c,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:tv},this.xr=new q6e(this,d),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(m,y,_)=>{await this.compileAsync(m,y);const S=this._renderLists.get(m,y),b=this._renderContexts.get(m,y,this._renderTarget,this._mrt),M=m.overrideMaterial||_.material,w=this._objects.get(_,M,m,y,S.lightsNode,b,b.clippingContext),{fragmentShader:T,vertexShader:E}=w.getNodeBuilderState();return{fragmentShader:T,vertexShader:E}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let i=this.backend;try{await i.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=i=this._getFallback(r),await i.init(this)}catch(s){t(s);return}else{t(r);return}}this._nodes=new Y6e(this,i),this._animation=new Aze(this,this._nodes,this.info),this._attributes=new Dze(i),this._background=new x6e(this,this._nodes),this._geometries=new Nze(this._attributes,this.info),this._textures=new Yze(this,i,this.info),this._pipelines=new Gze(i,this._nodes),this._bindings=new Oze(i,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Eze(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new zze(this.lighting),this._bundles=new $6e,this._renderContexts=new Zze,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,i=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,s=r.renderId,a=this._currentRenderContext,o=this._currentRenderObjectFunction,l=this._compilationPromises,u=e.isScene===!0?e:lY;i===null&&(i=e);const c=this._renderTarget,d=this._renderContexts.get(i,t,c,this._mrt),f=this._activeMipmapLevel,m=[];this._currentRenderContext=d,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=m,r.renderId++,r.update(),d.depth=this.depth,d.stencil=this.stencil,d.clippingContext||(d.clippingContext=new QB),d.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,c);const y=this._renderLists.get(e,t);if(y.begin(),this._projectObject(e,t,0,y,d.clippingContext),i!==e&&i.traverseVisible(function(w){w.isLight&&w.layers.test(t.layers)&&y.pushLight(w)}),y.finish(),c!==null){this._textures.updateRenderTarget(c,f);const w=this._textures.get(c);d.textures=w.textures,d.depthTexture=w.depthTexture}else d.textures=null,d.depthTexture=null;this._background.update(u,y,d);const _=y.opaque,S=y.transparent,b=y.transparentDoublePass,M=y.lightsNode;this.opaque===!0&&_.length>0&&this._renderObjects(_,t,u,M),this.transparent===!0&&S.length>0&&this._renderTransparents(S,b,t,u,M),r.renderId=s,this._currentRenderContext=a,this._currentRenderObjectFunction=o,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(m)}async renderAsync(e,t){hs('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){Tt("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){const t=this.contextNode.value;e===!0?(t.modelViewMatrix=lk,t.modelNormalViewMatrix=uk):this.highPrecision&&(delete t.modelViewMatrix,delete t.modelNormalViewMatrix)}get highPrecision(){const e=this.contextNode.value;return e.modelViewMatrix===lk&&e.modelNormalViewMatrix===uk}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return hs('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),Tt(t),this._isDeviceLost=!0}_renderBundle(e,t,i){const{bundleGroup:r,camera:s,renderList:a}=e,o=this._currentRenderContext,l=this._bundles.get(r,s),u=this.backend.get(l);u.renderContexts===void 0&&(u.renderContexts=new Set);const c=r.version!==u.version,d=u.renderContexts.has(o)===!1||c;if(u.renderContexts.add(o),d){this.backend.beginBundle(o),(u.renderObjects===void 0||c)&&(u.renderObjects=[]),this._currentRenderBundle=l;const{transparentDoublePass:f,transparent:m,opaque:y}=a;this.opaque===!0&&y.length>0&&this._renderObjects(y,s,t,i),this.transparent===!0&&m.length>0&&this._renderTransparents(m,f,s,t,i),this._currentRenderBundle=null,this.backend.finishBundle(o,l),u.version=r.version}else{const{renderObjects:f}=u;for(let m=0,y=f.length;m<y;m++){const _=f[m];this._nodes.needsRefresh(_)&&(this._nodes.updateBefore(_),this._nodes.updateForRender(_),this._bindings.updateForRender(_),this._nodes.updateAfter(_))}}this.backend.addBundle(o,l)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,i=e!==ho,r=t!==di.workingColorSpace;if(i===!1&&r===!1)return null;const{width:s,height:a}=this.getDrawingBufferSize(mS),{depth:o,stencil:l}=this;let u=this._frameBufferTarget;u===null&&(u=new Wd(s,a,{depthBuffer:o,stencilBuffer:l,type:this._outputBufferType,format:Vr,colorSpace:di.workingColorSpace,generateMipmaps:!1,minFilter:Jn,magFilter:Jn,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u);const c=this.getOutputRenderTarget();u.depthBuffer=o,u.stencilBuffer=l,c!==null?u.setSize(c.width,c.height,c.depth):u.setSize(s,a,1);const d=this._canvasTarget;return u.viewport.copy(d._viewport),u.scissor.copy(d._scissor),u.viewport.multiplyScalar(d._pixelRatio),u.scissor.multiplyScalar(d._pixelRatio),u.scissorTest=d._scissorTest,u.multiview=c!==null?c.multiview:!1,u.resolveDepthBuffer=c!==null?c.resolveDepthBuffer:!0,u._autoAllocateDepthBuffer=c!==null?c._autoAllocateDepthBuffer:!1,u}_renderScene(e,t,i=!0){if(this._isDeviceLost===!0)return;const r=i?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,a=s.renderId,o=this._currentRenderContext,l=this._currentRenderObjectFunction,u=e.isScene===!0?e:lY,c=this._renderTarget||this._outputRenderTarget,d=this._activeCubeFace,f=this._activeMipmapLevel;let m;r!==null?(m=r,this.setRenderTarget(m)):m=c;const y=this._renderContexts.get(e,t,m,this._mrt);this._currentRenderContext=y,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls,this.backend.updateTimeStampUID(y),this.inspector.beginRender(this.backend.getTimestampUID(y),e,t,m);const _=this.coordinateSystem,S=this.xr;if(t.coordinateSystem!==_&&S.isPresenting===!1&&(t.coordinateSystem=_,t.updateProjectionMatrix(),t.isArrayCamera))for(const K of t.cameras)K.coordinateSystem=_,K.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),S.enabled===!0&&S.isPresenting===!0&&(S.cameraAutoUpdate===!0&&S.updateCamera(t),t=S.getCamera());const b=this._canvasTarget;let M=b._viewport,w=b._scissor,T=b._pixelRatio;m!==null&&(M=m.viewport,w=m.scissor,T=1),this.getDrawingBufferSize(mS),XO.set(0,0,mS.width,mS.height);const E=M.minDepth===void 0?0:M.minDepth,R=M.maxDepth===void 0?1:M.maxDepth;y.viewportValue.copy(M).multiplyScalar(T).floor(),y.viewportValue.width>>=f,y.viewportValue.height>>=f,y.viewportValue.minDepth=E,y.viewportValue.maxDepth=R,y.viewport=y.viewportValue.equals(XO)===!1,y.scissorValue.copy(w).multiplyScalar(T).floor(),y.scissor=b._scissorTest&&y.scissorValue.equals(XO)===!1,y.scissorValue.width>>=f,y.scissorValue.height>>=f,y.clippingContext||(y.clippingContext=new QB),y.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,m);const P=t.isArrayCamera?ZO:WO;t.isArrayCamera||(OD.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),P.setFromProjectionMatrix(OD,t.coordinateSystem,t.reversedDepth));const I=this._renderLists.get(e,t);if(I.begin(),this._projectObject(e,t,0,I,y.clippingContext),I.finish(),this.sortObjects===!0&&I.sort(this._opaqueSort,this._transparentSort),m!==null){this._textures.updateRenderTarget(m,f);const K=this._textures.get(m);y.textures=K.textures,y.depthTexture=K.depthTexture,y.width=K.width,y.height=K.height,y.renderTarget=m,y.depth=m.depthBuffer,y.stencil=m.stencilBuffer}else y.textures=null,y.depthTexture=null,y.width=mS.width,y.height=mS.height,y.depth=this.depth,y.stencil=this.stencil;y.width>>=f,y.height>>=f,y.activeCubeFace=d,y.activeMipmapLevel=f,y.occlusionQueryCount=I.occlusionQueryCount,y.scissorValue.max(wg.set(0,0,0,0)),y.scissorValue.x+y.scissorValue.width>y.width&&(y.scissorValue.width=Math.max(y.width-y.scissorValue.x,0)),y.scissorValue.y+y.scissorValue.height>y.height&&(y.scissorValue.height=Math.max(y.height-y.scissorValue.y,0)),this._background.update(u,I,y),y.camera=t,this.backend.beginRender(y);const{bundles:B,lightsNode:N,transparentDoublePass:U,transparent:V,opaque:W}=I;return B.length>0&&this._renderBundles(B,u,N),this.opaque===!0&&W.length>0&&this._renderObjects(W,t,u,N),this.transparent===!0&&V.length>0&&this._renderTransparents(V,U,t,u,N),this.backend.finishRender(y),s.renderId=a,this._currentRenderContext=o,this._currentRenderObjectFunction=l,r!==null&&(this.setRenderTarget(c,d,f),this._renderOutput(m)),u.onAfterRender(this,e,t,m),this.inspector.finishRender(this.backend.getTimestampUID(y)),y}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const i=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=i,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,i){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,i)}setSize(e,t,i=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,i)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,i,r){this._canvasTarget.setScissor(e,t,i,r)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,i,r,s=0,a=1){this._canvasTarget.setViewport(e,t,i,r,s,a)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,i=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const r=this._renderTarget||this._getFrameBufferTarget();let s=null;if(r!==null){this._textures.updateRenderTarget(r);const a=this._textures.get(r);s=this._renderContexts.getForClear(r),s.textures=a.textures,s.depthTexture=a.depthTexture,s.width=a.width,s.height=a.height,s.renderTarget=r,s.depth=r.depthBuffer,s.stencil=r.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,i,s),r!==null&&this._renderTarget===null&&this._renderOutput(r)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,i=!0){hs('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,i)}async clearColorAsync(){hs('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){hs('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){hs('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==ho,t=this.currentColorSpace!==di.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:ho}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:di.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,i=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=i}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return mt("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const i=this._nodes.nodeFrame,r=i.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,i.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const s=this.backend,a=this._pipelines,o=this._bindings,l=this._nodes,u=Array.isArray(e)?e:[e];if(u[0]===void 0||u[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const c of u){if(a.has(c)===!1){const m=()=>{c.removeEventListener("dispose",m),a.delete(c),o.deleteForCompute(c),l.delete(c)};c.addEventListener("dispose",m);const y=c.onInitFunction;y!==null&&y.call(c,{renderer:this})}l.updateForCompute(c),o.updateForCompute(c);const d=o.getForCompute(c),f=a.getForCompute(c,d);s.compute(e,c,d,f,t)}s.finishCompute(e),i.renderId=r,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return hs('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){hs('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=wg.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=wg.copy(t).floor();else{Tt("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=wg.set(0,0,e.image.width,e.image.height);let i=this._currentRenderContext,r;i!==null?r=i.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),i=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,i,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,i=null,r=null,s=0,a=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,i,r,s,a),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,i,r,s,a=0,o=0){return this.backend.copyTextureToBuffer(e.textures[a],t,i,r,s,o)}_projectObject(e,t,i,r,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)i=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){const l=t.isArrayCamera?ZO:WO;if(!e.frustumCulled||l.intersectsSprite(e,t)){this.sortObjects===!0&&wg.setFromMatrixPosition(e.matrixWorld).applyMatrix4(OD);const{geometry:u,material:c}=e;c.visible&&r.push(e,u,c,i,wg.z,null,s)}}else if(e.isLineLoop)Tt("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const l=t.isArrayCamera?ZO:WO;if(!e.frustumCulled||l.intersectsObject(e,t)){const{geometry:u,material:c}=e;if(this.sortObjects===!0&&(u.boundingSphere===null&&u.computeBoundingSphere(),wg.copy(u.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(OD)),Array.isArray(c)){const d=u.groups;for(let f=0,m=d.length;f<m;f++){const y=d[f],_=c[y.materialIndex];_&&_.visible&&r.push(e,u,_,i,wg.z,y,s)}}else c.visible&&r.push(e,u,c,i,wg.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=r;r=this._renderLists.get(e,t),r.begin(),l.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const o=e.children;for(let l=0,u=o.length;l<u;l++)this._projectObject(o[l],t,i,r,s)}_renderBundles(e,t,i){for(const r of e)this._renderBundle(r,t,i)}_renderTransparents(e,t,i,r,s){if(t.length>0){for(const{material:a}of t)a.side=Er;this._renderObjects(t,i,r,s,"backSide");for(const{material:a}of t)a.side=wo;this._renderObjects(e,i,r,s);for(const{material:a}of t)a.side=fr}else this._renderObjects(e,i,r,s)}_renderObjects(e,t,i,r,s=null){for(let a=0,o=e.length;a<o;a++){const{object:l,geometry:u,material:c,group:d,clippingContext:f}=e[a];this._currentRenderObjectFunction(l,i,t,u,c,d,r,f,s)}}_getShadowNodes(e){const t=e.version;let i=this._cacheShadowNodes.get(e);if(i===void 0||i.version!==t){const r=e.map!==null,s=e.colorNode&&e.colorNode.isNode,a=e.castShadowNode&&e.castShadowNode.isNode;let o=null,l=null,u=null;if(r||s||a){let c,d;a?(c=e.castShadowNode.rgb,d=e.castShadowNode.a):(c=Ge(0),d=ge(1)),r&&(d=d.mul(Es("map","texture",e).a)),s&&(d=d.mul(e.colorNode.a)),l=Un(c,d)}e.depthNode&&e.depthNode.isNode&&(u=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?o=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(o=e.positionNode),i={version:t,colorNode:l,depthNode:u,positionNode:o},this._cacheShadowNodes.set(e,i)}return i}renderObject(e,t,i,r,s,a,o,l=null,u=null){let c=!1,d,f,m,y;if(e.onBeforeRender(this,t,i,r,s,a),s.allowOverride===!0&&t.overrideMaterial!==null){const _=t.overrideMaterial;if(c=!0,d=t.overrideMaterial.colorNode,f=t.overrideMaterial.depthNode,m=t.overrideMaterial.positionNode,y=t.overrideMaterial.side,s.positionNode&&s.positionNode.isNode&&(_.positionNode=s.positionNode),_.alphaTest=s.alphaTest,_.alphaMap=s.alphaMap,_.transparent=s.transparent||s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode||s.backdropNode&&s.backdropNode.isNode,_.isShadowPassMaterial){const{colorNode:S,depthNode:b,positionNode:M}=this._getShadowNodes(s);_.side=s.shadowSide===null?s.side:s.shadowSide,S!==null&&(_.colorNode=S),b!==null&&(_.depthNode=b),M!==null&&(_.positionNode=M)}s=_}s.transparent===!0&&s.side===fr&&s.forceSinglePass===!1?(s.side=Er,this._handleObjectFunction(e,s,t,i,o,a,l,"backSide"),s.side=wo,this._handleObjectFunction(e,s,t,i,o,a,l,u),s.side=fr):this._handleObjectFunction(e,s,t,i,o,a,l,u),c&&(t.overrideMaterial.colorNode=d,t.overrideMaterial.depthNode=f,t.overrideMaterial.positionNode=m,t.overrideMaterial.side=y),e.onAfterRender(this,t,i,r,s,a)}_renderObjectDirect(e,t,i,r,s,a,o,l){const u=this._objects.get(e,t,i,r,s,this._currentRenderContext,o,l);u.drawRange=e.geometry.drawRange,u.group=a;const c=this._nodes.needsRefresh(u);c&&(this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u)),this._pipelines.updateForRender(u),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(u),u.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(u,this.info),c&&this._nodes.updateAfter(u)}_createObjectPipeline(e,t,i,r,s,a,o,l){const u=this._objects.get(e,t,i,r,s,this._currentRenderContext,o,l);u.drawRange=e.geometry.drawRange,u.group=a,this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class ole{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function o8e(n){return n+(ky-n%ky)%ky}class lle extends ole{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return o8e(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class ule extends lle{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let l8e=0;class cle extends ule{constructor(e,t){super("UniformBuffer_"+l8e++,e?e.value:null),this.nodeUniform=e,this.groupNode=t,this.isNodeUniformBuffer=!0}set updateRanges(e){this.nodeUniform.updateRanges=e}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(e,t){this.nodeUniform.addUpdateRange(e,t)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class u8e extends ule{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let i=0,r=this.uniforms.length;i<r;i++){const s=this.uniforms[i],a=s.boundary,o=s.itemSize*e,l=t%ky,u=l%a,c=l+u;t+=u,c!==0&&ky-c<o&&(t+=ky-c),s.offset=t/e,t+=o}return Math.ceil(t/ky)*ky}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);Tt("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(i[s]!==r){const o=this._getBufferForType(a);o[s]=i[s]=r,t=!0}return t}updateVector2(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y){const o=this._getBufferForType(a);o[s+0]=i[s+0]=r.x,o[s+1]=i[s+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y||i[s+2]!==r.z){const o=this._getBufferForType(a);o[s+0]=i[s+0]=r.x,o[s+1]=i[s+1]=r.y,o[s+2]=i[s+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(i[s+0]!==r.x||i[s+1]!==r.y||i[s+2]!==r.z||i[s+4]!==r.w){const o=this._getBufferForType(a);o[s+0]=i[s+0]=r.x,o[s+1]=i[s+1]=r.y,o[s+2]=i[s+2]=r.z,o[s+3]=i[s+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const i=this.values,r=e.getValue(),s=e.offset;if(i[s+0]!==r.r||i[s+1]!==r.g||i[s+2]!==r.b){const a=this.buffer;a[s+0]=i[s+0]=r.r,a[s+1]=i[s+1]=r.g,a[s+2]=i[s+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const i=this.values,r=e.getValue().elements,s=e.offset;if(i[s+0]!==r[0]||i[s+1]!==r[1]||i[s+2]!==r[2]||i[s+4]!==r[3]||i[s+5]!==r[4]||i[s+6]!==r[5]||i[s+8]!==r[6]||i[s+9]!==r[7]||i[s+10]!==r[8]){const a=this.buffer;a[s+0]=i[s+0]=r[0],a[s+1]=i[s+1]=r[1],a[s+2]=i[s+2]=r[2],a[s+4]=i[s+4]=r[3],a[s+5]=i[s+5]=r[4],a[s+6]=i[s+6]=r[5],a[s+8]=i[s+8]=r[6],a[s+9]=i[s+9]=r[7],a[s+10]=i[s+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const i=this.values,r=e.getValue().elements,s=e.offset;return h8e(i,r,s)===!1&&(this.buffer.set(r,s),c8e(i,r,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function c8e(n,e,t){for(let i=0,r=e.length;i<r;i++)n[t+i]=e[i]}function h8e(n,e,t){for(let i=0,r=e.length;i<r;i++)if(n[t+i]!==e[i])return!1;return!0}let d8e=0;class hle extends u8e{constructor(e,t){super(e),this.id=d8e++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class dle extends ole{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let f8e=0;class p8e extends dle{constructor(e,t){super(e,t),this.id=f8e++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class pL extends p8e{constructor(e,t,i,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=i,this.access=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class fle extends pL{constructor(e,t,i,r=null){super(e,t,i,r),this.isSampledCubeTexture=!0}}class Tk extends pL{constructor(e,t,i,r=null){super(e,t,i,r),this.isSampledTexture3D=!0}}const uY={bitcast_int_uint:new Qo("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new Qo("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},m8e={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},g8e={low:"lowp",medium:"mediump",high:"highp"},cY={swizzleAssign:!0,storageBuffer:!1},hY={perspective:"smooth",linear:"noperspective"},dY={centroid:"centroid"},fY=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class y8e extends SH{constructor(e,t){super(e,t,new ile),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==xl}_include(e){const t=uY[e];return t.build(this),this.addInclude(t),t}getMethod(e){return uY[e]!==void 0&&this._include(e),m8e[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,i){return`${e} ? ${t} : ${i}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,i=this.flowShaderNode(e),r=[];for(const a of t.inputs)r.push(this.getType(a.type)+" "+a.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${i.vars}

${i.code}
	return ${i.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const i=t.array,r=t.count*t.itemSize,{itemSize:s}=t,a=t.array.constructor.name.toLowerCase().includes("int");let o=a?A0:rp;s===2?o=a?jv:_l:s===3?o=a?g9:Ab:s===4&&(o=a?Yv:Vr);const l={Float32Array:wr,Uint8Array:br,Uint16Array:zc,Uint32Array:qr,Int8Array:am,Int16Array:om,Int32Array:Ao,Uint8ClampedArray:br},u=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/s))));let c=Math.ceil(r/s/u);u*c*s<r&&c++;const d=u*c*s,f=new i.constructor(d);f.set(i,0),t.array=f;const m=new xu(t.array,u,c,o,l[t.array.constructor.name]||wr);m.needsUpdate=!0,m.isPBOTexture=!0;const y=new $f(m,null,null);y.setPrecision("high"),t.pboNode=y,t.pbo=y.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:i}=e,r=t.value;if(this.renderer.backend.has(r)){const c=this.renderer.backend.get(r);c.pbo=r.pbo}const s=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.nodeName),a=this.getPropertyName(s);this.increaseUsage(i);const o=i.build(this,"uint"),l=this.getDataFromNode(e);let u=l.propertyName;if(u===void 0){const c=this.getVarFromNode(e);u=this.getPropertyName(c);const d=this.getDataFromNode(t);let f=d.propertySizeName;f===void 0&&(f=u+"Size",this.getVarFromNode(t,f,"uint"),this.addLineFlowCode(`${f} = uint( textureSize( ${a}, 0 ).x )`,e),d.propertySizeName=f);const{itemSize:m}=r,y="."+qv.join("").slice(0,m),_=`ivec2(${o} % ${f}, ${o} / ${f})`,S=this.generateTextureLoad(null,a,_,"0",null,null);let b="vec4";r.pbo.type===qr?b="uvec4":r.pbo.type===Ao&&(b="ivec4"),this.addLineFlowCode(`${u} = ${b}(${S})${y}`,e),l.propertyName=u}return u}generateTextureLoad(e,t,i,r,s,a){r===null&&(r="0");let o;return s?a?o=`texelFetchOffset( ${t}, ivec3( ${i}, ${s} ), ${r}, ${a} )`:o=`texelFetch( ${t}, ivec3( ${i}, ${s} ), ${r} )`:a?o=`texelFetchOffset( ${t}, ${i}, ${r}, ${a} )`:o=`texelFetch( ${t}, ${i}, ${r} )`,e!==null&&e.isDepthTexture&&(o+=".x"),o}generateTexture(e,t,i,r,s){return r&&(i=`vec3( ${i}, ${r} )`),e.isDepthTexture?s?`textureOffset( ${t}, ${i}, ${s} ).x`:`texture( ${t}, ${i} ).x`:s?`textureOffset( ${t}, ${i}, ${s} )`:`texture( ${t}, ${i} )`}generateTextureLevel(e,t,i,r,s){return s?`textureLodOffset( ${t}, ${i}, ${r}, ${s} )`:`textureLod( ${t}, ${i}, ${r} )`}generateTextureBias(e,t,i,r,s){return s?`textureOffset( ${t}, ${i}, ${s}, ${r} )`:`texture( ${t}, ${i}, ${r} )`}generateTextureGrad(e,t,i,r,s){return s?`textureGradOffset( ${t}, ${i}, ${r[0]}, ${r[1]}, ${s} )`:`textureGrad( ${t}, ${i}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,i,r,s,a,o=this.shaderStage){if(o==="fragment")return e.isCubeTexture?`texture( ${t}, vec4( ${i}, ${r} ) )`:s?a?`textureOffset( ${t}, vec4( ${i}, ${s}, ${r} ), ${a} )`:`texture( ${t}, vec4( ${i}, ${s}, ${r} ) )`:a?`textureOffset( ${t}, vec3( ${i}, ${r} ), ${a} )`:`texture( ${t}, vec3( ${i}, ${r} ) )`;Tt(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],i=this.vars[e];if(i!==void 0)for(const r of i)t.push(`${this.getVar(r.type,r.name,r.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],i=[],r={};for(const a of t){let o=null,l=!1;if(a.type==="texture"||a.type==="texture3D"){const c=a.node.value;let d="";(c.isDataTexture===!0||c.isData3DTexture===!0)&&(c.type===qr?d="u":c.type===Ao&&(d="i")),a.type==="texture3D"&&c.isArrayTexture===!1?o=`${d}sampler3D ${a.name};`:c.compareFunction?c.isArrayTexture===!0?o=`sampler2DArrayShadow ${a.name};`:o=`sampler2DShadow ${a.name};`:c.isArrayTexture===!0||c.isDataArrayTexture===!0||c.isCompressedArrayTexture===!0?o=`${d}sampler2DArray ${a.name};`:o=`${d}sampler2D ${a.name};`}else if(a.type==="cubeTexture")o=`samplerCube ${a.name};`;else if(a.type==="cubeDepthTexture")o=`samplerCubeShadow ${a.name};`;else if(a.type==="buffer"){const c=a.node,d=this.getType(c.bufferType),f=c.bufferCount,m=f>0?f:"";o=`${c.name} {
	${d} ${a.name}[${m}];
};
`}else o=`${this.getVectorType(a.type)} ${this.getPropertyName(a,e)};`,l=!0;const u=a.node.precision;if(u!==null&&(o=g8e[u]+" "+o),l){o="	"+o;const c=a.groupNode.name;(r[c]||(r[c]=[])).push(o)}else o="uniform "+o,i.push(o)}let s="";for(const a in r){const o=r[a];s+=this._getGLSLUniformStruct(e+"_"+a,o.join(`
`))+`
`}return s+=i.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Ao){let i=e;e.isInterleavedBufferAttribute&&(i=e.data);const r=i.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const i=this.getAttributesArray();let r=0;for(const s of i)t+=`layout( location = ${r++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const i of e.members)t.push(`	${i.type} ${i.name};`);return t.join(`
`)}getStructs(e){const t=[],i=this.structs[e],r=[];for(const s of i)if(s.output)for(const a of s.members)r.push(`layout( location = ${a.index} ) out ${a.type} ${a.name};`);else{let a="struct "+s.name+` {
`;a+=this.getStructMembers(s),a+=`
};
`,t.push(a)}return r.length===0&&r.push("layout( location = 0 ) out vec4 fragColor;"),`
`+r.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const i=this.varyings;if(e==="vertex"||e==="compute")for(const r of i){e==="compute"&&(r.needsInterpolation=!0);const s=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){const a=hY[r.interpolationType]||r.interpolationType,o=dY[r.interpolationSampling]||"";t+=`${a} ${o} out ${s} ${r.name};
`}else{const a=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${a}out ${s} ${r.name};
`}else t+=`${s} ${r.name};
`}else if(e==="fragment"){for(const r of i)if(r.needsInterpolation){const s=this.getType(r.type);if(r.interpolationType){const a=hY[r.interpolationType]||r.interpolationType,o=dY[r.interpolationSampling]||"";t+=`${a} ${o} in ${s} ${r.name};
`}else{const a=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${a}in ${s} ${r.name};
`}}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((i,r)=>i*r,1)}u`}getSubgroupSize(){Tt("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){Tt("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){Tt("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,i=this.shaderStage){const r=this.extensions[i]||(this.extensions[i]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const i=this.extensions[e];if(i!==void 0)for(const{name:r,behavior:s}of i.values())t.push(`#extension ${r} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=cY[e];if(t===void 0){let i;switch(t=!1,e){case"float32Filterable":i="OES_texture_float_linear";break;case"clipDistance":i="WEBGL_clip_cull_distance";break}if(i!==void 0){const r=this.renderer.backend.extensions;r.has(i)&&(r.get(i),t=!0)}cY[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let i=0;i<e.length;i++){const r=e[i],s=this.getPropertyName(r.attributeNode);s&&(t+=`${r.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${fY}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${fY}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let i=`// code

`;i+=this.flowCode[t];const r=this.flowNodes[t],s=r[r.length-1];for(const o of r){const l=this.getFlowData(o),u=o.name;u&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${u}
	`),i+=`${l.code}
	`,o===s&&t!=="compute"&&(i+=`// result
	`,t==="vertex"?(i+="gl_Position = ",i+=`${l.result};`):t==="fragment"&&(o.outputNode.isOutputStructNode||(i+="fragColor = ",i+=`${l.result};`)))}const a=e[t];a.extensions=this.getExtensions(t),a.uniforms=this.getUniforms(t),a.attributes=this.getAttributes(t),a.varyings=this.getVaryings(t),a.vars=this.getVars(t),a.structs=this.getStructs(t),a.codes=this.getCodes(t),a.transforms=this.getTransforms(t),a.flow=i}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,i,r=null){const s=super.getUniformFromNode(e,t,i,r),a=this.getDataFromNode(e,i,this.globalCache);let o=a.uniformGPU;if(o===void 0){const l=e.groupNode,u=l.name,c=this.getBindGroupArray(u,i);if(t==="texture")o=new pL(s.name,s.node,l),c.push(o);else if(t==="cubeTexture"||t==="cubeDepthTexture")o=new fle(s.name,s.node,l),c.push(o);else if(t==="texture3D")o=new Tk(s.name,s.node,l),c.push(o);else if(t==="buffer"){s.name=`buffer${e.id}`;const d=this.getSharedDataFromNode(e);let f=d.buffer;f===void 0&&(e.name=`NodeBuffer_${e.id}`,f=new cle(e,l),f.name=e.name,d.buffer=f),c.push(f),o=f}else{const d=this.uniformGroups[i]||(this.uniformGroups[i]={});let f=d[u];f===void 0&&(f=new hle(i+"_"+u,l),d[u]=f,c.push(f)),o=this.getNodeUniform(s,t),f.addUniform(o)}a.uniformGPU=o}return s}}let jO=null,gS=null;class ple{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[Td.RENDER]:null,[Td.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),i=this.renderer.info.frame;let r;e.isComputeNode===!0?r="c:"+this.renderer.info.compute.frameCalls:r="r:"+this.renderer.info.render.frameCalls,t.timestampUID=r+":"+e.id+":f"+i}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?Td.COMPUTE:Td.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){hs("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const i=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=i,i}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return jO=jO||new rt,this.renderer.getDrawingBufferSize(jO)}setScissorTest(){}getClearColor(){const e=this.renderer;return gS=gS||new Q4,e.getClearColor(gS),gS.getRGB(gS),gS}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:K2(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Xd} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}deleteBindGroupData(){}dispose(){}}let v8e=0;class x8e{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class b8e{constructor(e){this.backend=e}createAttribute(e,t){const i=this.backend,{gl:r}=i,s=e.array,a=e.usage||r.STATIC_DRAW,o=e.isInterleavedBufferAttribute?e.data:e,l=i.get(o);let u=l.bufferGPU;u===void 0&&(u=this._createBuffer(r,t,s,a),l.bufferGPU=u,l.bufferType=t,l.version=o.version);let c;if(s instanceof Float32Array)c=r.FLOAT;else if(typeof Float16Array<"u"&&s instanceof Float16Array)c=r.HALF_FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?c=r.HALF_FLOAT:c=r.UNSIGNED_SHORT;else if(s instanceof Int16Array)c=r.SHORT;else if(s instanceof Uint32Array)c=r.UNSIGNED_INT;else if(s instanceof Int32Array)c=r.INT;else if(s instanceof Int8Array)c=r.BYTE;else if(s instanceof Uint8Array)c=r.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)c=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let d={bufferGPU:u,bufferType:t,type:c,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:c===r.INT||c===r.UNSIGNED_INT||e.gpuType===Ao,id:v8e++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const f=this._createBuffer(r,t,s,a);d=new x8e(d,f)}i.set(e,d)}updateAttribute(e){const t=this.backend,{gl:i}=t,r=e.array,s=e.isInterleavedBufferAttribute?e.data:e,a=t.get(s),o=a.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(i.bindBuffer(o,a.bufferGPU),l.length===0)i.bufferSubData(o,0,r);else{for(let u=0,c=l.length;u<c;u++){const d=l[u];i.bufferSubData(o,d.start*r.BYTES_PER_ELEMENT,r,d.start,d.count)}s.clearUpdateRanges()}i.bindBuffer(o,null),a.version=s.version}destroyAttribute(e){const t=this.backend,{gl:i}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);i.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:i}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(r),a=e.array,o=a.byteLength;i.bindBuffer(i.COPY_READ_BUFFER,s);const l=i.createBuffer();i.bindBuffer(i.COPY_WRITE_BUFFER,l),i.bufferData(i.COPY_WRITE_BUFFER,o,i.STREAM_READ),i.copyBufferSubData(i.COPY_READ_BUFFER,i.COPY_WRITE_BUFFER,0,0,o),await t.utils._clientWaitAsync();const u=new e.array.constructor(a.length);return i.bindBuffer(i.COPY_WRITE_BUFFER,l),i.getBufferSubData(i.COPY_WRITE_BUFFER,0,u),i.deleteBuffer(l),i.bindBuffer(i.COPY_READ_BUFFER,null),i.bindBuffer(i.COPY_WRITE_BUFFER,null),u.buffer}_createBuffer(e,t,i,r){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,i,r),e.bindBuffer(t,null),s}}let YO,yC;class _8e{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;YO={[vl]:e.FUNC_ADD,[kE]:e.FUNC_SUBTRACT,[zE]:e.FUNC_REVERSE_SUBTRACT},yC={[Bf]:e.ZERO,[VE]:e.ONE,[HE]:e.SRC_COLOR,[Yx]:e.SRC_ALPHA,[KE]:e.SRC_ALPHA_SATURATE,[jE]:e.DST_COLOR,[WE]:e.DST_ALPHA,[XE]:e.ONE_MINUS_SRC_COLOR,[Kx]:e.ONE_MINUS_SRC_ALPHA,[YE]:e.ONE_MINUS_DST_COLOR,[ZE]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),i=e.getParameter(e.VIEWPORT);this.currentScissor=new si().fromArray(t),this.currentViewport=new si().fromArray(i),this._tempVec4=new si}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==O2?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===Uw?t.cullFace(t.BACK):e===U2?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:i}=this;e!==t&&(i.lineWidth(e),this.currentLineWidth=e)}setMRTBlending(e){const t=this.gl,i=this.backend.drawBuffersIndexedExt;if(i)for(let r=1;r<e.length;r++)i.blendFuncSeparateiOES(r,t.ONE,t.ZERO,t.ONE,t.ZERO)}setBlending(e,t,i,r,s,a,o,l){const{gl:u}=this;if(e===Oa){this.currentBlendingEnabled===!0&&(this.disable(u.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(u.BLEND),this.currentBlendingEnabled=!0),e!==nv){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==vl||this.currentBlendEquationAlpha!==vl)&&(u.blendEquation(u.FUNC_ADD),this.currentBlendEquation=vl,this.currentBlendEquationAlpha=vl),l)switch(e){case Al:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case bm:u.blendFunc(u.ONE,u.ONE);break;case u0:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case c0:u.blendFuncSeparate(u.DST_COLOR,u.ONE_MINUS_SRC_ALPHA,u.ZERO,u.ONE);break;default:Tt("WebGLState: Invalid blending: ",e);break}else switch(e){case Al:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case bm:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE,u.ONE,u.ONE);break;case u0:Tt("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case c0:Tt("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Tt("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}s=s||t,a=a||i,o=o||r,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(u.blendEquationSeparate(YO[t],YO[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(i!==this.currentBlendSrc||r!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||o!==this.currentBlendDstAlpha)&&(u.blendFuncSeparate(yC[i],yC[r],yC[a],yC[o]),this.currentBlendSrc=i,this.currentBlendDst=r,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=o),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case $x:t.depthFunc(t.NEVER);break;case hv:t.depthFunc(t.ALWAYS);break;case Jx:t.depthFunc(t.LESS);break;case _m:t.depthFunc(t.LEQUAL);break;case qx:t.depthFunc(t.EQUAL);break;case Qx:t.depthFunc(t.GEQUAL);break;case eb:t.depthFunc(t.GREATER);break;case tb:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,i,r){const s=this._tempVec4.set(e,t,i,r);if(this.currentScissor.equals(s)===!1){const{gl:a}=this;a.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,i,r){const s=this._tempVec4.set(e,t,i,r);if(this.currentViewport.equals(s)===!1){const{gl:a}=this;a.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,i){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==i)&&(this.gl.stencilFunc(e,t,i),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=i)}setStencilOp(e,t,i){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==i)&&(this.gl.stencilOp(e,t,i),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=i)}setMaterial(e,t,i){const{gl:r}=this;e.side===fr?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===Er;t&&(s=!s),this.setFlipSided(s),e.blending===Al&&e.transparent===!1?this.setBlending(Oa):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),i>0&&this.currentClippingPlanes!==i)for(let l=0;l<8;l++)l<i?this.enable(12288+l):this.disable(12288+l)}setPolygonOffset(e,t,i){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==i)&&(r.polygonOffset(t,i),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=i)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const i=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(i.bindVertexArray(e),t!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:i,currentBoundFramebuffers:r}=this;return r[e]!==t?(i.bindFramebuffer(e,t),r[e]=t,e===i.DRAW_FRAMEBUFFER&&(r[i.FRAMEBUFFER]=t),e===i.FRAMEBUFFER&&(r[i.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:i}=this;let r=[],s=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const a=e.textures;if(r.length!==a.length||r[0]!==i.COLOR_ATTACHMENT0){for(let o=0,l=a.length;o<l;o++)r[o]=i.COLOR_ATTACHMENT0+o;r.length=a.length,s=!0}}else r[0]!==i.BACK&&(r[0]=i.BACK,s=!0);s&&i.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:i,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),i!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,i){const{gl:r,currentTextureSlot:s,currentBoundTextures:a,maxTextures:o}=this;i===void 0&&(s===null?i=r.TEXTURE0+o-1:i=s);let l=a[i];l===void 0&&(l={type:void 0,texture:void 0},a[i]=l),(l.type!==e||l.texture!==t)&&(s!==i&&(r.activeTexture(i),this.currentTextureSlot=i),r.bindTexture(e,t),l.type=e,l.texture=t)}bindBufferBase(e,t,i){const{gl:r}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==i?(r.bindBufferBase(e,t,i),this.currentBoundBufferBases[s]=i,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:i}=this,r=i[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class S8e{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=xl){const{gl:i,extensions:r}=this;let s;const a=di.getTransfer(t);if(e===br)return i.UNSIGNED_BYTE;if(e===VM)return i.UNSIGNED_SHORT_4_4_4_4;if(e===HM)return i.UNSIGNED_SHORT_5_5_5_1;if(e===XM)return i.UNSIGNED_INT_5_9_9_9_REV;if(e===WM)return i.UNSIGNED_INT_10F_11F_11F_REV;if(e===am)return i.BYTE;if(e===om)return i.SHORT;if(e===zc)return i.UNSIGNED_SHORT;if(e===Ao)return i.INT;if(e===qr)return i.UNSIGNED_INT;if(e===wr)return i.FLOAT;if(e===zi)return i.HALF_FLOAT;if(e===tR)return i.ALPHA;if(e===Ab)return i.RGB;if(e===Vr)return i.RGBA;if(e===Xo)return i.DEPTH_COMPONENT;if(e===bl)return i.DEPTH_STENCIL;if(e===rp)return i.RED;if(e===A0)return i.RED_INTEGER;if(e===_l)return i.RG;if(e===jv)return i.RG_INTEGER;if(e===Yv)return i.RGBA_INTEGER;if(e===lm||e===um||e===cm||e===hm)if(a===Hn)if(s=r.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===lm)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===um)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===cm)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===hm)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=r.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===lm)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===um)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===cm)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===hm)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===nb||e===ib||e===rb||e===sb)if(s=r.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===nb)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===ib)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===rb)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===sb)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===dv||e===fv||e===pv||e===mv||e===gv||e===d0||e===yv)if(s=r.get("WEBGL_compressed_texture_etc"),s!==null){if(e===dv||e===fv)return a===Hn?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===pv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(e===mv)return s.COMPRESSED_R11_EAC;if(e===gv)return s.COMPRESSED_SIGNED_R11_EAC;if(e===d0)return s.COMPRESSED_RG11_EAC;if(e===yv)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(e===vv||e===xv||e===bv||e===_v||e===Sv||e===Mv||e===Av||e===Tv||e===Cv||e===wv||e===Ev||e===Rv||e===Pv||e===Dv)if(s=r.get("WEBGL_compressed_texture_astc"),s!==null){if(e===vv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===xv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===bv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===_v)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Sv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Mv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Av)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Tv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Cv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===wv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Ev)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Rv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Pv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Dv)return a===Hn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===Nv)if(s=r.get("EXT_texture_compression_bptc"),s!==null){if(e===Nv)return a===Hn?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Bv||e===Fv||e===f0||e===Lv)if(s=r.get("EXT_texture_compression_rgtc"),s!==null){if(e===Bv)return s.COMPRESSED_RED_RGTC1_EXT;if(e===Fv)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===f0)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Lv)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===jl?i.UNSIGNED_INT_24_8:i[e]!==void 0?i[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((i,r)=>{function s(){const a=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED){e.deleteSync(t),r();return}if(a===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),i()}s()})}}let pY=!1,UD,KO,mY;class M8e{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,pY===!1&&(this._init(),pY=!0)}_init(){const e=this.gl;UD={[Xc]:e.REPEAT,[ps]:e.CLAMP_TO_EDGE,[jf]:e.MIRRORED_REPEAT},KO={[xr]:e.NEAREST,[Mb]:e.NEAREST_MIPMAP_NEAREST,[xh]:e.NEAREST_MIPMAP_LINEAR,[Jn]:e.LINEAR,[sm]:e.LINEAR_MIPMAP_NEAREST,[Vo]:e.LINEAR_MIPMAP_LINEAR},mY={[iR]:e.NEVER,[oR]:e.ALWAYS,[Tb]:e.LESS,[Cb]:e.LEQUAL,[rR]:e.EQUAL,[wb]:e.GEQUAL,[sR]:e.GREATER,[aR]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let i;return e.isCubeTexture===!0?i=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?i=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?i=t.TEXTURE_3D:i=t.TEXTURE_2D,i}getInternalFormat(e,t,i,r,s=!1){const{gl:a,extensions:o}=this;if(e!==null){if(a[e]!==void 0)return a[e];mt("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=t;if(t===a.RED&&(i===a.FLOAT&&(l=a.R32F),i===a.HALF_FLOAT&&(l=a.R16F),i===a.UNSIGNED_BYTE&&(l=a.R8),i===a.UNSIGNED_SHORT&&(l=a.R16),i===a.UNSIGNED_INT&&(l=a.R32UI),i===a.BYTE&&(l=a.R8I),i===a.SHORT&&(l=a.R16I),i===a.INT&&(l=a.R32I)),t===a.RED_INTEGER&&(i===a.UNSIGNED_BYTE&&(l=a.R8UI),i===a.UNSIGNED_SHORT&&(l=a.R16UI),i===a.UNSIGNED_INT&&(l=a.R32UI),i===a.BYTE&&(l=a.R8I),i===a.SHORT&&(l=a.R16I),i===a.INT&&(l=a.R32I)),t===a.RG&&(i===a.FLOAT&&(l=a.RG32F),i===a.HALF_FLOAT&&(l=a.RG16F),i===a.UNSIGNED_BYTE&&(l=a.RG8),i===a.UNSIGNED_SHORT&&(l=a.RG16),i===a.UNSIGNED_INT&&(l=a.RG32UI),i===a.BYTE&&(l=a.RG8I),i===a.SHORT&&(l=a.RG16I),i===a.INT&&(l=a.RG32I)),t===a.RG_INTEGER&&(i===a.UNSIGNED_BYTE&&(l=a.RG8UI),i===a.UNSIGNED_SHORT&&(l=a.RG16UI),i===a.UNSIGNED_INT&&(l=a.RG32UI),i===a.BYTE&&(l=a.RG8I),i===a.SHORT&&(l=a.RG16I),i===a.INT&&(l=a.RG32I)),t===a.RGB){const u=s?Iv:di.getTransfer(r);i===a.FLOAT&&(l=a.RGB32F),i===a.HALF_FLOAT&&(l=a.RGB16F),i===a.UNSIGNED_BYTE&&(l=a.RGB8),i===a.UNSIGNED_SHORT&&(l=a.RGB16),i===a.UNSIGNED_INT&&(l=a.RGB32UI),i===a.BYTE&&(l=a.RGB8I),i===a.SHORT&&(l=a.RGB16I),i===a.INT&&(l=a.RGB32I),i===a.UNSIGNED_BYTE&&(l=u===Hn?a.SRGB8:a.RGB8),i===a.UNSIGNED_SHORT_5_6_5&&(l=a.RGB565),i===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1),i===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGB4),i===a.UNSIGNED_INT_5_9_9_9_REV&&(l=a.RGB9_E5),i===a.UNSIGNED_INT_10F_11F_11F_REV&&(l=a.R11F_G11F_B10F)}if(t===a.RGB_INTEGER&&(i===a.UNSIGNED_BYTE&&(l=a.RGB8UI),i===a.UNSIGNED_SHORT&&(l=a.RGB16UI),i===a.UNSIGNED_INT&&(l=a.RGB32UI),i===a.BYTE&&(l=a.RGB8I),i===a.SHORT&&(l=a.RGB16I),i===a.INT&&(l=a.RGB32I)),t===a.RGBA){const u=s?Iv:di.getTransfer(r);i===a.FLOAT&&(l=a.RGBA32F),i===a.HALF_FLOAT&&(l=a.RGBA16F),i===a.UNSIGNED_BYTE&&(l=a.RGBA8),i===a.UNSIGNED_SHORT&&(l=a.RGBA16),i===a.UNSIGNED_INT&&(l=a.RGBA32UI),i===a.BYTE&&(l=a.RGBA8I),i===a.SHORT&&(l=a.RGBA16I),i===a.INT&&(l=a.RGBA32I),i===a.UNSIGNED_BYTE&&(l=u===Hn?a.SRGB8_ALPHA8:a.RGBA8),i===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGBA4),i===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1)}return t===a.RGBA_INTEGER&&(i===a.UNSIGNED_BYTE&&(l=a.RGBA8UI),i===a.UNSIGNED_SHORT&&(l=a.RGBA16UI),i===a.UNSIGNED_INT&&(l=a.RGBA32UI),i===a.BYTE&&(l=a.RGBA8I),i===a.SHORT&&(l=a.RGBA16I),i===a.INT&&(l=a.RGBA32I)),t===a.DEPTH_COMPONENT&&(i===a.UNSIGNED_SHORT&&(l=a.DEPTH_COMPONENT16),i===a.UNSIGNED_INT&&(l=a.DEPTH_COMPONENT24),i===a.FLOAT&&(l=a.DEPTH_COMPONENT32F)),t===a.DEPTH_STENCIL&&i===a.UNSIGNED_INT_24_8&&(l=a.DEPTH24_STENCIL8),(l===a.R16F||l===a.R32F||l===a.RG16F||l===a.RG32F||l===a.RGBA16F||l===a.RGBA32F)&&o.get("EXT_color_buffer_float"),l}setTextureParameters(e,t){const{gl:i,extensions:r,backend:s}=this,a=di.getPrimaries(di.workingColorSpace),o=t.colorSpace===xl?null:di.getPrimaries(t.colorSpace),l=t.colorSpace===xl||a===o?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,t.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,l),i.texParameteri(e,i.TEXTURE_WRAP_S,UD[t.wrapS]),i.texParameteri(e,i.TEXTURE_WRAP_T,UD[t.wrapT]),(e===i.TEXTURE_3D||e===i.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||i.texParameteri(e,i.TEXTURE_WRAP_R,UD[t.wrapR])),i.texParameteri(e,i.TEXTURE_MAG_FILTER,KO[t.magFilter]);const u=t.mipmaps!==void 0&&t.mipmaps.length>0,c=t.minFilter===Jn&&u?Vo:t.minFilter;if(i.texParameteri(e,i.TEXTURE_MIN_FILTER,KO[c]),t.compareFunction&&(i.texParameteri(e,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(e,i.TEXTURE_COMPARE_FUNC,mY[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===xr||t.minFilter!==xh&&t.minFilter!==Vo||t.type===wr&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const d=r.get("EXT_texture_filter_anisotropic");i.texParameterf(e,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:i,defaultTextures:r}=this,s=this.getGLTextureType(e);let a=r[s];a===void 0&&(a=t.createTexture(),i.state.bindTexture(s,a),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),r[s]=a),i.set(e,{textureGPU:a,glTextureType:s})}createTexture(e,t){const{gl:i,backend:r}=this,{levels:s,width:a,height:o,depth:l}=t,u=r.utils.convert(e.format,e.colorSpace),c=r.utils.convert(e.type),d=this.getInternalFormat(e.internalFormat,u,c,e.colorSpace,e.isVideoTexture),f=i.createTexture(),m=this.getGLTextureType(e);r.state.bindTexture(m,f),this.setTextureParameters(m,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?i.texStorage3D(i.TEXTURE_2D_ARRAY,s,d,a,o,l):e.isData3DTexture?i.texStorage3D(i.TEXTURE_3D,s,d,a,o,l):e.isVideoTexture||i.texStorage2D(m,s,d,a,o),r.set(e,{textureGPU:f,glTextureType:m,glFormat:u,glType:c,glInternalFormat:d})}copyBufferToTexture(e,t){const{gl:i,backend:r}=this,{textureGPU:s,glTextureType:a,glFormat:o,glType:l}=r.get(t),{width:u,height:c}=t.source.data;i.bindBuffer(i.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(a,s),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.texSubImage2D(a,0,0,0,u,c,o,l,0),i.bindBuffer(i.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:i}=this,{width:r,height:s}=t,{textureGPU:a,glTextureType:o,glFormat:l,glType:u,glInternalFormat:c}=this.backend.get(e);if(!(e.isRenderTargetTexture||a===void 0))if(this.backend.state.bindTexture(o,a),this.setTextureParameters(o,e),e.isCompressedTexture){const d=e.mipmaps,f=t.image;for(let m=0;m<d.length;m++){const y=d[m];e.isCompressedArrayTexture?e.format!==i.RGBA?l!==null?i.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,m,0,0,0,y.width,y.height,f.depth,l,y.data):mt("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texSubImage3D(i.TEXTURE_2D_ARRAY,m,0,0,0,y.width,y.height,f.depth,l,u,y.data):l!==null?i.compressedTexSubImage2D(i.TEXTURE_2D,m,0,0,y.width,y.height,l,y.data):mt("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const d=t.images,f=e.mipmaps;for(let m=0;m<6;m++){const y=kD(d[m]);i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,0,0,r,s,l,u,y);for(let _=0;_<f.length;_++){const S=f[_],b=kD(S.images[m]);i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+m,_+1,0,0,b.width,b.height,l,u,b)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const d=t.image;if(e.layerUpdates.size>0){const f=PB(d.width,d.height,e.format,e.type);for(const m of e.layerUpdates){const y=d.data.subarray(m*f/d.data.BYTES_PER_ELEMENT,(m+1)*f/d.data.BYTES_PER_ELEMENT);i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,m,d.width,d.height,1,l,u,y)}e.clearLayerUpdates()}else i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,l,u,d.data)}else if(e.isData3DTexture){const d=t.image;i.texSubImage3D(i.TEXTURE_3D,0,0,0,0,d.width,d.height,d.depth,l,u,d.data)}else if(e.isVideoTexture)e.update(),i.texImage2D(o,0,c,l,u,t.image);else{const d=e.mipmaps;if(d.length>0)for(let f=0,m=d.length;f<m;f++){const y=d[f],_=kD(y);i.texSubImage2D(o,f,0,0,y.width,y.height,l,u,_)}else{const f=kD(t.image);i.texSubImage2D(o,0,0,0,r,s,l,u,f)}}}generateMipmaps(e){const{gl:t,backend:i}=this,{textureGPU:r,glTextureType:s}=i.get(e);i.state.bindTexture(s,r),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:i}=this;if(e){const r=i.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const s in r.framebuffers)t.deleteFramebuffer(r.framebuffers[s]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let s=0;s<r.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(r.msaaRenderbuffers[s]);delete r.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:i,backend:r}=this,{textureGPU:s,renderTarget:a}=r.get(e);this.deallocateRenderBuffers(a),t===!1&&i.deleteTexture(s),r.delete(e)}copyTextureToTexture(e,t,i=null,r=null,s=0,a=0){const{gl:o,backend:l}=this,{state:u}=this.backend,{textureGPU:c,glTextureType:d,glType:f,glFormat:m}=l.get(t);u.bindTexture(d,c);let y,_,S,b,M,w,T,E,R;const P=e.isCompressedTexture?e.mipmaps[a]:e.image;if(i!==null)y=i.max.x-i.min.x,_=i.max.y-i.min.y,S=i.isBox3?i.max.z-i.min.z:1,b=i.min.x,M=i.min.y,w=i.isBox3?i.min.z:0;else{const q=Math.pow(2,-s);y=Math.floor(P.width*q),_=Math.floor(P.height*q),e.isDataArrayTexture||e.isArrayTexture?S=P.depth:e.isData3DTexture?S=Math.floor(P.depth*q):S=1,b=0,M=0,w=0}r!==null?(T=r.x,E=r.y,R=r.z):(T=0,E=0,R=0),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const I=o.getParameter(o.UNPACK_ROW_LENGTH),B=o.getParameter(o.UNPACK_IMAGE_HEIGHT),N=o.getParameter(o.UNPACK_SKIP_PIXELS),U=o.getParameter(o.UNPACK_SKIP_ROWS),V=o.getParameter(o.UNPACK_SKIP_IMAGES);o.pixelStorei(o.UNPACK_ROW_LENGTH,P.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,P.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,b),o.pixelStorei(o.UNPACK_SKIP_ROWS,M),o.pixelStorei(o.UNPACK_SKIP_IMAGES,w);const W=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,K=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const q=l.get(e),j=l.get(t),te=l.get(q.renderTarget),he=l.get(j.renderTarget),_e=te.framebuffers[q.cacheKey],Be=he.framebuffers[j.cacheKey];u.bindFramebuffer(o.READ_FRAMEBUFFER,_e),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,Be);for(let ue=0;ue<S;ue++)W&&(o.framebufferTextureLayer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,q.textureGPU,s,w+ue),o.framebufferTextureLayer(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,c,a,R+ue)),o.blitFramebuffer(b,M,y,_,T,E,y,_,o.DEPTH_BUFFER_BIT,o.NEAREST);u.bindFramebuffer(o.READ_FRAMEBUFFER,null),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else if(s!==0||e.isRenderTargetTexture||l.has(e)){const q=l.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=o.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=o.createFramebuffer()),u.bindFramebuffer(o.READ_FRAMEBUFFER,this._srcFramebuffer),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let j=0;j<S;j++)W?o.framebufferTextureLayer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,q.textureGPU,s,w+j):o.framebufferTexture2D(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,q.textureGPU,s),K?o.framebufferTextureLayer(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,c,a,R+j):o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,c,a),s!==0?o.blitFramebuffer(b,M,y,_,T,E,y,_,o.COLOR_BUFFER_BIT,o.NEAREST):K?o.copyTexSubImage3D(d,a,T,E,R+j,b,M,y,_):o.copyTexSubImage2D(d,a,T,E,b,M,y,_);u.bindFramebuffer(o.READ_FRAMEBUFFER,null),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else K?e.isDataTexture||e.isData3DTexture?o.texSubImage3D(d,a,T,E,R,y,_,S,m,f,P.data):t.isCompressedArrayTexture?o.compressedTexSubImage3D(d,a,T,E,R,y,_,S,m,P.data):o.texSubImage3D(d,a,T,E,R,y,_,S,m,f,P):e.isDataTexture?o.texSubImage2D(o.TEXTURE_2D,a,T,E,y,_,m,f,P.data):e.isCompressedTexture?o.compressedTexSubImage2D(o.TEXTURE_2D,a,T,E,P.width,P.height,m,P.data):o.texSubImage2D(o.TEXTURE_2D,a,T,E,y,_,m,f,P);o.pixelStorei(o.UNPACK_ROW_LENGTH,I),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,B),o.pixelStorei(o.UNPACK_SKIP_PIXELS,N),o.pixelStorei(o.UNPACK_SKIP_ROWS,U),o.pixelStorei(o.UNPACK_SKIP_IMAGES,V),a===0&&t.generateMipmaps&&o.generateMipmap(d),u.unbindTexture()}copyFramebufferToTexture(e,t,i){const{gl:r}=this,{state:s}=this.backend,{textureGPU:a}=this.backend.get(e),{x:o,y:l,z:u,w:c}=i,d=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,f=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(d){const m=o!==0||l!==0;let y,_;if(e.isDepthTexture===!0?(y=r.DEPTH_BUFFER_BIT,_=r.DEPTH_ATTACHMENT,t.stencil&&(y|=r.STENCIL_BUFFER_BIT)):(y=r.COLOR_BUFFER_BIT,_=r.COLOR_ATTACHMENT0),m){const S=this.backend.get(t.renderTarget),b=S.framebuffers[t.getCacheKey()],M=S.msaaFrameBuffer;s.bindFramebuffer(r.DRAW_FRAMEBUFFER,b),s.bindFramebuffer(r.READ_FRAMEBUFFER,M);const w=f-l-c;r.blitFramebuffer(o,w,o+u,w+c,o,w,o+u,w+c,y,r.NEAREST),s.bindFramebuffer(r.READ_FRAMEBUFFER,b),s.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,w,u,c),s.unbindTexture()}else{const S=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,S),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,_,r.TEXTURE_2D,a,0),r.blitFramebuffer(0,0,u,c,0,0,u,c,y,r.NEAREST),r.deleteFramebuffer(S)}}else s.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,f-c-l,u,c),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,i,r=!1){const{gl:s}=this,a=t.renderTarget,{depthTexture:o,depthBuffer:l,stencilBuffer:u,width:c,height:d}=a;if(s.bindRenderbuffer(s.RENDERBUFFER,e),l&&!u){let f=s.DEPTH_COMPONENT24;r===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,a.samples,f,c,d):i>0?(o&&o.isDepthTexture&&o.type===s.FLOAT&&(f=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,i,f,c,d)):s.renderbufferStorage(s.RENDERBUFFER,f,c,d),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else l&&u&&(i>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,i,s.DEPTH24_STENCIL8,c,d):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,c,d),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e));s.bindRenderbuffer(s.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,i,r,s,a){const{backend:o,gl:l}=this,{textureGPU:u,glFormat:c,glType:d}=this.backend.get(e),f=l.createFramebuffer();o.state.bindFramebuffer(l.READ_FRAMEBUFFER,f);const m=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+a:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,m,u,0);const y=this._getTypedArrayType(d),_=this._getBytesPerTexel(d,c),b=r*s*_,M=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,M),l.bufferData(l.PIXEL_PACK_BUFFER,b,l.STREAM_READ),l.readPixels(t,i,r,s,c,d,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const w=new y(b/y.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,M),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,w),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),o.state.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.deleteFramebuffer(f),w}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:i}=this;let r=0;if(e===i.UNSIGNED_BYTE&&(r=1),(e===i.UNSIGNED_SHORT_4_4_4_4||e===i.UNSIGNED_SHORT_5_5_5_1||e===i.UNSIGNED_SHORT_5_6_5||e===i.UNSIGNED_SHORT||e===i.HALF_FLOAT)&&(r=2),(e===i.UNSIGNED_INT||e===i.FLOAT)&&(r=4),t===i.RGBA)return r*4;if(t===i.RGB)return r*3;if(t===i.ALPHA)return r}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function kD(n){return n.isDataTexture?n.image.data:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?n:n.data}class A8e{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class T8e{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const i=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const gY={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class C8e{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:i,mode:r,object:s,type:a,info:o,index:l}=this;l!==0?i.drawElements(r,t,a,e):i.drawArrays(r,e,t),o.update(s,t,1)}renderInstances(e,t,i){const{gl:r,mode:s,type:a,index:o,object:l,info:u}=this;i!==0&&(o!==0?r.drawElementsInstanced(s,t,a,e,i):r.drawArraysInstanced(s,e,t,i),u.update(l,t,i))}renderMultiDraw(e,t,i){const{extensions:r,mode:s,object:a,info:o}=this;if(i===0)return;const l=r.get("WEBGL_multi_draw");if(l===null)for(let u=0;u<i;u++)this.render(e[u],t[u]);else{this.index!==0?l.multiDrawElementsWEBGL(s,t,0,this.type,e,0,i):l.multiDrawArraysWEBGL(s,e,0,t,0,i);let u=0;for(let c=0;c<i;c++)u+=t[c];o.update(a,u,1)}}renderMultiDrawInstances(e,t,i,r){const{extensions:s,mode:a,object:o,info:l}=this;if(i===0)return;const u=s.get("WEBGL_multi_draw");if(u===null)for(let c=0;c<i;c++)this.renderInstances(e[c],t[c],r[c]);else{this.index!==0?u.multiDrawElementsInstancedWEBGL(a,t,0,this.type,e,0,r,0,i):u.multiDrawArraysInstancedWEBGL(a,e,0,t,0,r,0,i);let c=0;for(let d=0;d<i;d++)c+=t[d]*r[d];l.update(o,c,1)}}}class mle{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(mt(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class w8e extends mle{constructor(e,t,i=2048){if(super(i),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){mt("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let r=0;r<this.maxQueries;r++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return hs(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const i=this.queries[t];if(i)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,i),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(r){Tt("Error in beginQuery:",r),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(i){Tt("Error in endQuery:",i),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[s,a]of this.queryOffsets)if(this.queryStates.get(a)==="ended"){const l=this.queries[a];e.set(s,this.resolveQuery(l))}if(e.size===0)return this.lastValue;const t={},i=[];for(const[s,a]of e){const o=s.match(/^(.*):f(\d+)$/),l=parseInt(o[2]);i.includes(l)===!1&&i.push(l),t[l]===void 0&&(t[l]=0);const u=await a;this.timestamps.set(s,u),t[l]+=u}const r=t[i[i.length-1]];return this.lastValue=r,this.frames=i,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,r}catch(e){return Tt("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let i,r=!1;const s=()=>{i&&(clearTimeout(i),i=null)},a=l=>{r||(r=!0,s(),t(l))},o=()=>{if(this.isDisposed){a(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){a(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){i=setTimeout(o,1);return}const c=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(c)/1e6)}catch(l){Tt("Error checking query:",l),t(this.lastValue)}};o()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class yY extends ple{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,i={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=t.context!==void 0?t.context:e.domElement.getContext("webgl2",i);function s(a){a.preventDefault();const o={api:"WebGL",message:a.statusMessage||"Unknown reason",reason:null,originalEvent:a};e.onDeviceLost(o)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=r,this.extensions=new A8e(this),this.capabilities=new T8e(this),this.attributeUtils=new b8e(this),this.textureUtils=new M8e(this),this.bufferRenderer=new C8e(this),this.state=new _8e(this),this.utils=new S8e(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed")}get coordinateSystem(){return Sl}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,i=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),i!==null){const s=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:i,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&mt("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new w8e(this.gl,e,2048));const i=this.timestampQueryPool[e];i.allocateQueriesForContext(t)!==null&&i.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,i=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:s,height:a}=this.getDrawingBufferSize();t.viewport(0,0,s,a)}if(e.scissor){const{x:s,y:a,width:o,height:l}=e.scissorValue;t.scissor(s,e.height-l-a,o,l)}this.initTimestampQuery(Td.RENDER,this.getTimestampUID(e)),i.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(i.currentOcclusionQueries=i.occlusionQueries,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,i.lastOcclusionObject=null,i.occlusionQueries=new Array(r),i.occlusionQueryObjects=new Array(r),i.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:i}=this,r=this.get(e),s=r.previousContext;i.resetVertexState();const a=e.occlusionQueryCount;a>0&&(a>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const o=e.textures;if(o!==null)for(let l=0;l<o.length;l++){const u=o[l];u.generateMipmaps&&this.generateMipmaps(u)}if(this._currentContext=s,this._resolveRenderTarget(e),s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:l,height:u}=this.getDrawingBufferSize();i.viewport(0,0,l,u)}this.prepareTimestampBuffer(Td.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:i,currentOcclusionQueryObjects:r}=t;if(i&&r){const s=new WeakSet,{gl:a}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const o=()=>{let l=0;for(let u=0;u<i.length;u++){const c=i[u];c!==null&&a.getQueryParameter(c,a.QUERY_RESULT_AVAILABLE)&&(a.getQueryParameter(c,a.QUERY_RESULT)===0&&s.add(r[u]),i[u]=null,a.deleteQuery(c),l++)}l<i.length?requestAnimationFrame(o):t.occluded=s};o()}}isOccluded(e,t){const i=this.get(e);return i.occluded&&i.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:i,y:r,width:s,height:a}=e.viewportValue;t.viewport(i,e.height-a-r,s,a)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,i,r=null,s=!0,a=!0){const{gl:o,renderer:l}=this;r===null&&(r={textures:null,clearColorValue:this.getClearColor()});let u=0;if(e&&(u|=o.COLOR_BUFFER_BIT),t&&(u|=o.DEPTH_BUFFER_BIT),i&&(u|=o.STENCIL_BUFFER_BIT),u!==0){let c;r.clearColorValue?c=r.clearColorValue:c=this.getClearColor();const d=l.getClearDepth(),f=l.getClearStencil();if(t&&this.state.setDepthMask(!0),r.textures===null)o.clearColor(c.r,c.g,c.b,c.a),o.clear(u);else{if(s&&this._setFramebuffer(r),e)for(let m=0;m<r.textures.length;m++)m===0?o.clearBufferfv(o.COLOR,m,[c.r,c.g,c.b,c.a]):o.clearBufferfv(o.COLOR,m,[0,0,0,1]);t&&i?o.clearBufferfi(o.DEPTH_STENCIL,0,d,f):t?o.clearBufferfv(o.DEPTH,0,[d]):i&&o.clearBufferiv(o.STENCIL,0,[f]),s&&a&&this._resolveRenderTarget(r)}}}beginCompute(e){const{state:t,gl:i}=this;t.bindFramebuffer(i.FRAMEBUFFER,null),this.initTimestampQuery(Td.COMPUTE,this.getTimestampUID(e))}compute(e,t,i,r,s=null){const{state:a,gl:o}=this;this.discard===!1&&(a.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:l,transformBuffers:u,attributes:c}=this.get(r),d=this._getVaoKey(c),f=this.vaoCache[d];f===void 0?this.vaoCache[d]=this._createVao(c):a.setVertexState(f),a.useProgram(l),this._bindUniforms(i);const m=this._getTransformFeedback(u);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,m),o.beginTransformFeedback(o.POINTS),s=s!==null?s:t.count,Array.isArray(s)?(hs("WebGLBackend.compute(): The count parameter must be a single number, not an array."),s=s[0]):s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute&&(hs("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),s=t.count),c[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,s):o.drawArrays(o.POINTS,0,s),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let y=0;y<u.length;y++){const _=u[y];_.pbo&&this.has(_.pbo)&&this.textureUtils.copyBufferToTexture(_.transformBuffer,_.pbo),_.switchBuffers()}}finishCompute(e){const{state:t,gl:i}=this;this.discard=!1,t.disable(i.RASTERIZER_DISCARD),this.prepareTimestampBuffer(Td.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:i,material:r,context:s,hardwareClippingPlanes:a}=e,{programGPU:o}=this.get(i),{gl:l,state:u}=this,c=this.get(s),d=e.getDrawParameters();if(d===null)return;this._bindUniforms(e.getBindings());const f=t.isMesh&&t.matrixWorld.determinant()<0;u.setMaterial(r,f,a),s.textures!==null&&s.textures.length>1&&u.setMRTBlending(s.textures),u.useProgram(o);const m=e.getAttributes(),y=this.get(m);let _=y.vaoGPU;if(_===void 0){const I=this._getVaoKey(m);_=this.vaoCache[I],_===void 0&&(_=this._createVao(m),this.vaoCache[I]=_,y.vaoGPU=_)}const S=e.getIndex(),b=S!==null?this.get(S).bufferGPU:null;u.setVertexState(_,b);const M=c.lastOcclusionObject;if(M!==t&&M!==void 0){if(M!==null&&M.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),c.occlusionQueryIndex++),t.occlusionTest===!0){const I=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,I),c.occlusionQueries[c.occlusionQueryIndex]=I,c.occlusionQueryObjects[c.occlusionQueryIndex]=t}c.lastOcclusionObject=t}const w=this.bufferRenderer;t.isPoints?w.mode=l.POINTS:t.isLineSegments?w.mode=l.LINES:t.isLine?w.mode=l.LINE_STRIP:t.isLineLoop?w.mode=l.LINE_LOOP:r.wireframe===!0?(u.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),w.mode=l.LINES):w.mode=l.TRIANGLES;const{vertexCount:T,instanceCount:E}=d;let{firstVertex:R}=d;if(w.object=t,S!==null){R*=S.array.BYTES_PER_ELEMENT;const I=this.get(S);w.index=S.count,w.type=I.type}else w.index=0;const P=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(hs("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),w.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?w.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):hs("WebGLBackend: WEBGL_multi_draw not supported."):E>1?w.renderInstances(R,T,E):w.render(R,T)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const I=this.get(e.camera),B=e.camera.cameras,N=e.getBindingGroup("cameraIndex").bindings[0];if(I.indexesGPU===void 0||I.indexesGPU.length!==B.length){const j=new Uint32Array([0,0,0,0]),te=[];for(let he=0,_e=B.length;he<_e;he++){const Be=l.createBuffer();j[0]=he,l.bindBuffer(l.UNIFORM_BUFFER,Be),l.bufferData(l.UNIFORM_BUFFER,j,l.STATIC_DRAW),te.push(Be)}I.indexesGPU=te}const U=this.get(N),V=this.renderer.getPixelRatio(),W=this._currentContext.renderTarget,K=this._isRenderCameraDepthArray(this._currentContext),q=this._currentContext.activeCubeFace;if(K){const j=this.get(W.depthTexture);if(j.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){j.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:te}=W;for(let he=0,_e=B.length;he<_e;he++)this.renderer._activeCubeFace=he,this._currentContext.activeCubeFace=he,this._setFramebuffer(this._currentContext),this.clear(!1,!0,te,this._currentContext,!1,!1);this.renderer._activeCubeFace=q,this._currentContext.activeCubeFace=q}}for(let j=0,te=B.length;j<te;j++){const he=B[j];if(t.layers.test(he.layers)){K&&(this.renderer._activeCubeFace=j,this._currentContext.activeCubeFace=j,this._setFramebuffer(this._currentContext));const _e=he.viewport;if(_e!==void 0){const Be=_e.x*V,ue=_e.y*V,ce=_e.width*V,Ce=_e.height*V;u.viewport(Math.floor(Be),Math.floor(e.context.height-Ce-ue),Math.floor(ce),Math.floor(Ce))}u.bindBufferBase(l.UNIFORM_BUFFER,U.index,I.indexesGPU[j]),P()}this._currentContext.activeCubeFace=q,this.renderer._activeCubeFace=q}}else P()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,i,r,s,a){return this.textureUtils.copyTextureToBuffer(e,t,i,r,s,a)}updateSampler(){return""}createNodeBuilder(e,t){return new y8e(e,t)}createProgram(e){const t=this.gl,{stage:i,code:r}=e,s=i==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,r),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const i=this.gl,r=e.pipeline,{fragmentProgram:s,vertexProgram:a}=r,o=i.createProgram(),l=this.get(s).shaderGPU,u=this.get(a).shaderGPU;if(i.attachShader(o,l),i.attachShader(o,u),i.linkProgram(o),this.set(r,{programGPU:o,fragmentShader:l,vertexShader:u}),t!==null&&this.parallel){const c=new Promise(d=>{const f=this.parallel,m=()=>{i.getProgramParameter(o,f.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),d()):requestAnimationFrame(m)};m()});t.push(c);return}this._completeCompile(e,r)}_handleSource(e,t){const i=e.split(`
`),r=[],s=Math.max(t-6,0),a=Math.min(t+6,i.length);for(let o=s;o<a;o++){const l=o+1;r.push(`${l===t?">":" "} ${l}: ${i[o]}`)}return r.join(`
`)}_getShaderErrors(e,t,i){const r=e.getShaderParameter(t,e.COMPILE_STATUS),a=(e.getShaderInfoLog(t)||"").trim();if(r&&a==="")return"";const o=/ERROR: 0:(\d+)/.exec(a);if(o){const l=parseInt(o[1]);return i.toUpperCase()+`

`+a+`

`+this._handleSource(e.getShaderSource(t),l)}else return a}_logProgramError(e,t,i){if(this.renderer.debug.checkShaderErrors){const r=this.gl,a=(r.getProgramInfoLog(e)||"").trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,i,t);else{const o=this._getShaderErrors(r,i,"vertex"),l=this._getShaderErrors(r,t,"fragment");Tt("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+a+`
`+o+`
`+l)}else a!==""&&mt("WebGLProgram: Program Info Log:",a)}}_completeCompile(e,t){const{state:i,gl:r}=this,s=this.get(t),{programGPU:a,fragmentShader:o,vertexShader:l}=s;r.getProgramParameter(a,r.LINK_STATUS)===!1&&this._logProgramError(a,o,l),i.useProgram(a);const u=e.getBindings();this._setupBindings(u,a),this.set(t,{programGPU:a})}createComputePipeline(e,t){const{state:i,gl:r}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:a}=e,o=r.createProgram(),l=this.get(s).shaderGPU,u=this.get(a).shaderGPU,c=a.transforms,d=[],f=[];for(let S=0;S<c.length;S++){const b=c[S];d.push(b.varyingName),f.push(b.attributeNode)}r.attachShader(o,l),r.attachShader(o,u),r.transformFeedbackVaryings(o,d,r.SEPARATE_ATTRIBS),r.linkProgram(o),r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,l,u),i.useProgram(o),this._setupBindings(t,o);const m=a.attributes,y=[],_=[];for(let S=0;S<m.length;S++){const b=m[S].node.attribute;y.push(b),this.has(b)||this.attributeUtils.createAttribute(b,r.ARRAY_BUFFER)}for(let S=0;S<f.length;S++){const b=f[S].attribute;this.has(b)||this.attributeUtils.createAttribute(b,r.ARRAY_BUFFER);const M=this.get(b);_.push(M)}this.set(e,{programGPU:o,transformBuffers:_,attributes:y})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let i=0,r=0;for(const s of t){this.set(s,{textures:r,uniformBuffers:i});for(const a of s.bindings)a.isUniformBuffer&&i++,a.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,i=this.get(e);let r=i.uniformBuffers,s=i.textures;for(const a of e.bindings){const o=this.get(a);if(a.isUniformsGroup||a.isUniformBuffer){const l=a.buffer;let{bufferGPU:u}=this.get(l);u===void 0?(u=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,u),t.bufferData(t.UNIFORM_BUFFER,l.byteLength,t.DYNAMIC_DRAW),this.set(l,{bufferGPU:u})):t.bindBuffer(t.UNIFORM_BUFFER,u);const c=a.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,u),c.length===0)t.bufferData(t.UNIFORM_BUFFER,l,t.DYNAMIC_DRAW);else{const d=gM(l),f=d?1:l.BYTES_PER_ELEMENT;for(let m=0,y=c.length;m<y;m++){const _=c[m],S=_.start*f,b=_.count*f,M=S*(d?l.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,M,l,S,b)}}o.index=r++,o.bufferGPU=u,this.set(a,o)}else if(a.isSampledTexture){const{textureGPU:l,glTextureType:u}=this.get(a.texture);o.index=s++,o.textureGPU=l,o.glTextureType=u,this.set(a,o)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,s=e.buffer,a=e.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,r),a.length===0)t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW);else{const o=gM(s),l=o?1:s.BYTES_PER_ELEMENT;for(let u=0,c=a.length;u<c;u++){const d=a[u],f=d.start*l,m=d.count*l,y=f*(o?s.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,y,s,f,m)}}}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(gY).filter(r=>gY[r]===e),i=this.extensions;for(let r=0;r<t.length;r++)if(i.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,i=null,r=null,s=0,a=0){this.textureUtils.copyTextureToTexture(e,t,i,r,s,a)}copyFramebufferToTexture(e,t,i){this.textureUtils.copyFramebufferToTexture(e,t,i)}_setFramebuffer(e){const{gl:t,state:i}=this;let r=null;if(e.textures!==null){const s=e.renderTarget,a=this.get(s),{samples:o,depthBuffer:l,stencilBuffer:u}=s,c=s.isWebGLCubeRenderTarget===!0,d=s.isRenderTarget3D===!0,f=s.depth>1,m=s.isXRRenderTarget===!0,y=m===!0&&s._hasExternalTextures===!0;let _=a.msaaFrameBuffer,S=a.depthRenderbuffer;const b=this.extensions.get("WEBGL_multisampled_render_to_texture"),M=this.extensions.get("OVR_multiview2"),w=this._useMultisampledExtension(s),T=Pae(e);let E;if(c?(a.cubeFramebuffers||(a.cubeFramebuffers={}),E=a.cubeFramebuffers[T]):m&&y===!1?E=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),E=a.framebuffers[T]),E===void 0){E=t.createFramebuffer(),i.bindFramebuffer(t.FRAMEBUFFER,E);const R=e.textures,P=[];if(c){a.cubeFramebuffers[T]=E;const{textureGPU:B}=this.get(R[0]),N=this.renderer._activeCubeFace,U=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+N,B,U)}else{a.framebuffers[T]=E;for(let B=0;B<R.length;B++){const N=R[B],U=this.get(N);U.renderTarget=e.renderTarget,U.cacheKey=T;const V=t.COLOR_ATTACHMENT0+B;if(s.multiview)M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,V,U.textureGPU,0,o,0,2);else if(d||f){const W=this.renderer._activeCubeFace,K=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,V,U.textureGPU,K,W)}else if(w)b.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,V,t.TEXTURE_2D,U.textureGPU,0,o);else{const W=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,V,t.TEXTURE_2D,U.textureGPU,W)}}}const I=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const B=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(B,e,0,w),a.xrDepthRenderbuffer=B,P.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,B),t.framebufferRenderbuffer(t.FRAMEBUFFER,I,t.RENDERBUFFER,B)}else if(e.depthTexture!==null){P.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const B=this.get(e.depthTexture);if(B.renderTarget=e.renderTarget,B.cacheKey=T,s.multiview)M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,I,B.textureGPU,0,o,0,2);else if(y&&w)b.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,I,t.TEXTURE_2D,B.textureGPU,0,o);else if(e.depthTexture.isArrayTexture){const N=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,I,B.textureGPU,0,N)}else if(e.depthTexture.isCubeTexture){const N=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,I,t.TEXTURE_CUBE_MAP_POSITIVE_X+N,B.textureGPU,0)}else t.framebufferTexture2D(t.FRAMEBUFFER,I,t.TEXTURE_2D,B.textureGPU,0)}a.depthInvalidationArray=P}else{if(this._isRenderCameraDepthArray(e)){i.bindFramebuffer(t.FRAMEBUFFER,E);const P=this.renderer._activeCubeFace,I=this.get(e.depthTexture),B=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,B,I.textureGPU,0,P)}if((m||w||s.multiview)&&s._isOpaqueFramebuffer!==!0){i.bindFramebuffer(t.FRAMEBUFFER,E);const P=this.get(e.textures[0]);s.multiview?M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,P.textureGPU,0,o,0,2):w?b.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,P.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,P.textureGPU,0);const I=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const B=a.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,B),t.framebufferRenderbuffer(t.FRAMEBUFFER,I,t.RENDERBUFFER,B)}else{const B=this.get(e.depthTexture);s.multiview?M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,I,B.textureGPU,0,o,0,2):w?b.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,I,t.TEXTURE_2D,B.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,I,t.TEXTURE_2D,B.textureGPU,0)}}}if(o>0&&w===!1&&!s.multiview){if(_===void 0){const R=[];_=t.createFramebuffer(),i.bindFramebuffer(t.FRAMEBUFFER,_);const P=[],I=e.textures;for(let B=0;B<I.length;B++){P[B]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,P[B]),R.push(t.COLOR_ATTACHMENT0+B);const N=e.textures[B],U=this.get(N);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,U.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+B,t.RENDERBUFFER,P[B])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),a.msaaFrameBuffer=_,a.msaaRenderbuffers=P,l&&S===void 0){S=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(S,e,o),a.depthRenderbuffer=S;const B=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;R.push(B)}a.invalidationArray=R}r=a.msaaFrameBuffer}else r=E;i.drawBuffers(e,E)}i.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let i=0;i<e.length;i++){const r=this.get(e[i]);t+=":"+r.id}return t}_createVao(e){const{gl:t}=this,i=t.createVertexArray();t.bindVertexArray(i);for(let r=0;r<e.length;r++){const s=e[r],a=this.get(s);t.bindBuffer(t.ARRAY_BUFFER,a.bufferGPU),t.enableVertexAttribArray(r);let o,l;s.isInterleavedBufferAttribute===!0?(o=s.data.stride*a.bytesPerElement,l=s.offset*a.bytesPerElement):(o=0,l=0),a.isInteger?t.vertexAttribIPointer(r,s.itemSize,a.type,o,l):t.vertexAttribPointer(r,s.itemSize,a.type,s.normalized,o,l),s.isInstancedBufferAttribute&&!s.isInterleavedBufferAttribute?t.vertexAttribDivisor(r,s.meshPerAttribute):s.isInterleavedBufferAttribute&&s.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(r,s.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),i}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let i=this.transformFeedbackCache[t];if(i!==void 0)return i;const{gl:r}=this;i=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,i);for(let s=0;s<e.length;s++){const a=e[s];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,s,a.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=i,i}_setupBindings(e,t){const i=this.gl;for(const r of e)for(const s of r.bindings){const o=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const l=i.getUniformBlockIndex(t,s.name);i.uniformBlockBinding(t,l,o)}else if(s.isSampledTexture){const l=i.getUniformLocation(t,s.name);i.uniform1i(l,o)}}}_bindUniforms(e){const{gl:t,state:i}=this;for(const r of e)for(const s of r.bindings){const a=this.get(s),o=a.index;s.isUniformsGroup||s.isUniformBuffer?i.bindBufferBase(t.UNIFORM_BUFFER,o,a.bufferGPU):s.isSampledTexture&&i.bindTexture(a.glTextureType,a.textureGPU,t.TEXTURE0+o)}}_resolveRenderTarget(e){const{gl:t,state:i}=this,r=e.renderTarget;if(e.textures!==null&&r){const s=this.get(r);if(r.samples>0&&this._useMultisampledExtension(r)===!1){const a=s.framebuffers[e.getCacheKey()];let o=t.COLOR_BUFFER_BIT;r.resolveDepthBuffer&&(r.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),r.stencilBuffer&&r.resolveStencilBuffer&&(o|=t.STENCIL_BUFFER_BIT));const l=s.msaaFrameBuffer,u=s.msaaRenderbuffers,c=e.textures,d=c.length>1;if(i.bindFramebuffer(t.READ_FRAMEBUFFER,l),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,a),d)for(let f=0;f<c.length;f++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+f,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+f,t.TEXTURE_2D,null,0);for(let f=0;f<c.length;f++){if(d){const{textureGPU:m}=this.get(c[f]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,u[f]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,m,0)}if(e.scissor){const{x:m,y,width:_,height:S}=e.scissorValue,b=e.height-S-y;t.blitFramebuffer(m,b,m+_,b+S,m,b,m+_,b+S,o,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o,t.NEAREST)}if(d)for(let f=0;f<c.length;f++){const{textureGPU:m}=this.get(c[f]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+f,t.RENDERBUFFER,u[f]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+f,t.TEXTURE_2D,m,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,s.invalidationArray)}else if(r.resolveDepthBuffer===!1&&s.framebuffers){const a=s.framebuffers[e.getCacheKey()];i.bindFramebuffer(t.DRAW_FRAMEBUFFER,a),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,s.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const HS={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},wx=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},zl={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},Vu={Store:"store"},vs={Load:"load",Clear:"clear"},vY={CCW:"ccw",CW:"cw"},xY={None:"none",Back:"back"},CM={Uint16:"uint16",Uint32:"uint32"},He={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},$O={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},gx={Linear:"linear",Nearest:"nearest"},Or={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},rx={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},bY={None:0,All:15},Sy={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},JO={Storage:"storage",ReadOnlyStorage:"read-only-storage"},qO={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},_Y={NonFiltering:"non-filtering",Comparison:"comparison"},sx={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},SY={TwoD:"2d",ThreeD:"3d"},zo={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},E8e={All:"all"},zD={Vertex:"vertex",Instance:"instance"},Ck={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},MY={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class R8e extends dle{constructor(e,t,i){super(e,t?t.value:null),this.textureNode=t,this.groupNode=i}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class P8e extends lle{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let D8e=0;class N8e extends P8e{constructor(e,t){super("StorageBuffer_"+D8e++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Ml.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class B8e extends n1{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:gx.Linear}),this.flipYSampler=e.createSampler({minFilter:gx.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:i}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:HS.TriangleStrip,stripIndexFormat:CM.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:HS.TriangleStrip,stripIndexFormat:CM.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,i=0){const r=t.format,{width:s,height:a}=t.size,o=this.getTransferPipeline(r),l=this.getFlipYPipeline(r),u=this.device.createTexture({size:{width:s,height:a,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),c=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:zo.TwoD,baseArrayLayer:i}),d=u.createView({baseMipLevel:0,mipLevelCount:1,dimension:zo.TwoD,baseArrayLayer:0}),f=this.device.createCommandEncoder({}),m=(y,_,S)=>{const b=y.getBindGroupLayout(0),M=this.device.createBindGroup({layout:b,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:_}]}),w=f.beginRenderPass({colorAttachments:[{view:S,loadOp:vs.Clear,storeOp:Vu.Store,clearValue:[0,0,0,0]}]});w.setPipeline(y),w.setBindGroup(0,M),w.draw(4,1,0,0),w.end()};m(o,c,d),m(l,d,c),this.device.queue.submit([f.finish()]),u.destroy()}generateMipmaps(e,t,i=0,r=null){const s=this.get(e);s.layers===void 0&&(s.layers=[]);const a=s.layers[i]||this._mipmapCreateBundles(e,t,i),o=r||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(o,a),r===null&&this.device.queue.submit([o.finish()]),s.layers[i]=a}_mipmapCreateBundles(e,t,i){const r=this.getTransferPipeline(t.format),s=r.getBindGroupLayout(0);let a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:zo.TwoD,baseArrayLayer:i});const o=[];for(let l=1;l<t.mipLevelCount;l++){const u=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),c=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:zo.TwoD,baseArrayLayer:i}),d={colorAttachments:[{view:c,loadOp:vs.Clear,storeOp:Vu.Store,clearValue:[0,0,0,0]}]},f=this.device.createRenderBundleEncoder({colorFormats:[t.format]});f.setPipeline(r),f.setBindGroup(0,u),f.draw(4,1,0,0),o.push({renderBundles:[f.finish()],passDescriptor:d}),a=c}return o}_mipmapRunBundles(e,t){const i=t.length;for(let r=0;r<i;r++){const s=t[r],a=e.beginRenderPass(s.passDescriptor);a.executeBundles(s.renderBundles),a.end()}}}const F8e={[iR]:"never",[Tb]:"less",[rR]:"equal",[Cb]:"less-equal",[sR]:"greater",[wb]:"greater-equal",[oR]:"always",[aR]:"not-equal"},L8e=[0,1,3,2,4,5];class I8e{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,i=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let r=this._samplerCache.get(i);if(r===void 0){const a={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};a.magFilter===gx.Linear&&a.minFilter===gx.Linear&&a.mipmapFilter===gx.Linear&&(a.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(a.compare=F8e[e.compareFunction]),r={sampler:t.device.createSampler(a),usedTimes:0},this._samplerCache.set(i,r)}const s=t.get(e);if(s.sampler!==r.sampler){if(s.sampler!==void 0){const a=this._samplerCache.get(s.samplerKey);a.usedTimes--,a.usedTimes===0&&this._samplerCache.delete(s.samplerKey)}s.samplerKey=i,s.sampler=r.sampler,r.usedTimes++}return i}createDefaultTexture(e){let t;const i=wk(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(i):t=this._getDefaultTextureGPU(i),this.backend.get(e).texture=t}createTexture(e,t={}){const i=this.backend,r=i.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){r.texture=e.sourceTexture,r.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:a,depth:o,levels:l}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const u=this._getDimension(e),c=e.internalFormat||t.format||wk(e,i.device);r.format=c;const{samples:d,primarySamples:f,isMSAA:m}=i.utils.getTextureSampleData(e);let y=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(y|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&c!==He.RGB9E5UFloat&&(y|=GPUTextureUsage.RENDER_ATTACHMENT);const _={label:e.name,size:{width:s,height:a,depthOrArrayLayers:o},mipLevelCount:l,sampleCount:f,dimension:u,format:c,usage:y};if(c===void 0){mt("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(_.textureBindingViewDimension=zo.Cube),r.texture=i.device.createTexture(_),m){const S=Object.assign({},_);S.label=S.label+"-msaa",S.sampleCount=d,S.mipLevelCount=1,r.msaaTexture=i.device.createTexture(S)}r.initialized=!0,r.textureDescriptorGPU=_}destroyTexture(e,t=!1){const i=this.backend,r=i.get(e);r.texture!==void 0&&t===!1&&r.texture.destroy(),r.msaaTexture!==void 0&&r.msaaTexture.destroy(),i.delete(e)}generateMipmaps(e,t=null){const i=this.backend.get(e);if(e.isCubeTexture)for(let r=0;r<6;r++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,r,t);else{const r=e.image.depth||1;for(let s=0;s<r;s++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,s,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:i,height:r}=e.getDrawingBufferSize(),s=e.renderer.currentSamples,a=t.colorTexture,o=e.get(a);if(a.width===i&&a.height===r&&a.samples===s)return o.texture;let l=o.texture;return l&&l.destroy(),l=e.device.createTexture({label:"colorBuffer",size:{width:i,height:r,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),a.source.width=i,a.source.height=r,a.samples=s,o.texture=l,l}getDepthBuffer(e=!0,t=!1){const i=this.backend,r=i.renderer.getCanvasTarget(),{width:s,height:a}=i.getDrawingBufferSize(),o=i.renderer.currentSamples,l=r.depthTexture;if(l.width===s&&l.height===a&&l.samples===o&&l.depth===e&&l.stencil===t)return i.get(l).texture;const u=i.get(l).texture;let c,d;if(t?(c=bl,d=jl):e&&(c=Xo,d=qr),u!==void 0){if(l.image.width===s&&l.image.height===a&&l.format===c&&l.type===d&&l.samples===o)return u;this.destroyTexture(l)}return l.name="depthBuffer",l.format=c,l.type=d,l.image.width=s,l.image.height=a,l.samples=o,this.createTexture(l,{width:s,height:a}),i.get(l).texture}updateTexture(e,t){const i=this.backend.get(e),r=e.mipmaps,{textureDescriptorGPU:s}=i;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)if(r.length>0)for(let a=0,o=r.length;a<o;a++){const l=r[a];this._copyBufferToTexture(l,i.texture,s,0,e.flipY,0,a)}else this._copyBufferToTexture(t.image,i.texture,s,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let a=0;a<t.image.depth;a++)this._copyBufferToTexture(t.image,i.texture,s,a,e.flipY,a);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,i.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,i.texture,s);else if(r.length>0)for(let a=0,o=r.length;a<o;a++){const l=r[a];this._copyImageToTexture(l,i.texture,s,0,e.flipY,e.premultiplyAlpha,a)}else this._copyImageToTexture(t.image,i.texture,s,0,e.flipY,e.premultiplyAlpha);i.version=e.version}}async copyTextureToBuffer(e,t,i,r,s,a){const o=this.backend.device,l=this.backend.get(e),u=l.texture,c=l.textureDescriptorGPU.format,d=this._getBytesPerTexel(c);let f=r*d;f=Math.ceil(f/256)*256;const m=o.createBuffer({size:(s-1)*f+r*d,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),y=o.createCommandEncoder();y.copyTextureToBuffer({texture:u,origin:{x:t,y:i,z:a}},{buffer:m,bytesPerRow:f},{width:r,height:s});const _=this._getTypedArrayType(c);o.queue.submit([y.finish()]),await m.mapAsync(GPUMapMode.READ);const S=m.getMappedRange();return new _(S)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const i=new pr;i.minFilter=xr,i.magFilter=xr,this.createTexture(i,{width:1,height:1,format:e}),this.defaultTexture[e]=t=i}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultCubeTexture[e];if(t===void 0){const i=new T0;i.minFilter=xr,i.magFilter=xr,this.createTexture(i,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=i}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,i){const r=e.images,s=e.mipmaps;for(let a=0;a<6;a++){const o=r[a],l=e.flipY===!0?L8e[a]:a;o.isDataTexture?this._copyBufferToTexture(o.image,t,i,l,e.flipY):this._copyImageToTexture(o,t,i,l,e.flipY,e.premultiplyAlpha);for(let u=0;u<s.length;u++){const d=s[u].images[a];d.isDataTexture?this._copyBufferToTexture(d.image,t,i,l,e.flipY,0,u+1):this._copyImageToTexture(d,t,i,l,e.flipY,e.premultiplyAlpha,u+1)}}}_copyImageToTexture(e,t,i,r,s,a,o=0){const l=this.backend.device,u=o>0?e.width:i.size.width,c=o>0?e.height:i.size.height;try{l.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:o,origin:{x:0,y:0,z:r},premultipliedAlpha:a},{width:u,height:c,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new B8e(this.backend.device)),e}_generateMipmaps(e,t,i=0,r=null){this._getPassUtils().generateMipmaps(e,t,i,r)}_flipY(e,t,i=0){this._getPassUtils().flipY(e,t,i)}_copyBufferToTexture(e,t,i,r,s,a=0,o=0){const l=this.backend.device,u=e.data,c=this._getBytesPerTexel(i.format),d=e.width*c;l.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:r}},u,{offset:e.width*e.height*c*a,bytesPerRow:d},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,i,r)}_copyCompressedBufferToTexture(e,t,i){const r=this.backend.device,s=this._getBlockData(i.format),a=i.size.depthOrArrayLayers>1;for(let o=0;o<e.length;o++){const l=e[o],u=l.width,c=l.height,d=a?i.size.depthOrArrayLayers:1,f=Math.ceil(u/s.width)*s.byteLength,m=f*Math.ceil(c/s.height);for(let y=0;y<d;y++)r.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:y}},l.data,{offset:y*m,bytesPerRow:f,rowsPerImage:Math.ceil(c/s.height)},{width:Math.ceil(u/s.width)*s.width,height:Math.ceil(c/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===He.BC1RGBAUnorm||e===He.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===He.BC2RGBAUnorm||e===He.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===He.BC3RGBAUnorm||e===He.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===He.BC4RUnorm||e===He.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===He.BC5RGUnorm||e===He.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===He.BC6HRGBUFloat||e===He.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===He.BC7RGBAUnorm||e===He.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===He.ETC2RGB8Unorm||e===He.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===He.ETC2RGB8A1Unorm||e===He.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===He.ETC2RGBA8Unorm||e===He.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===He.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===He.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===He.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===He.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===He.ASTC4x4Unorm||e===He.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===He.ASTC5x4Unorm||e===He.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===He.ASTC5x5Unorm||e===He.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===He.ASTC6x5Unorm||e===He.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===He.ASTC6x6Unorm||e===He.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===He.ASTC8x5Unorm||e===He.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===He.ASTC8x6Unorm||e===He.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===He.ASTC8x8Unorm||e===He.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===He.ASTC10x5Unorm||e===He.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===He.ASTC10x6Unorm||e===He.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===He.ASTC10x8Unorm||e===He.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===He.ASTC10x10Unorm||e===He.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===He.ASTC12x10Unorm||e===He.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===He.ASTC12x12Unorm||e===He.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=$O.ClampToEdge;return e===Xc?t=$O.Repeat:e===jf&&(t=$O.MirrorRepeat),t}_convertFilterMode(e){let t=gx.Linear;return(e===xr||e===Mb||e===xh)&&(t=gx.Nearest),t}_getBytesPerTexel(e){if(e===He.R8Unorm||e===He.R8Snorm||e===He.R8Uint||e===He.R8Sint)return 1;if(e===He.R16Uint||e===He.R16Sint||e===He.R16Float||e===He.RG8Unorm||e===He.RG8Snorm||e===He.RG8Uint||e===He.RG8Sint)return 2;if(e===He.R32Uint||e===He.R32Sint||e===He.R32Float||e===He.RG16Uint||e===He.RG16Sint||e===He.RG16Float||e===He.RGBA8Unorm||e===He.RGBA8UnormSRGB||e===He.RGBA8Snorm||e===He.RGBA8Uint||e===He.RGBA8Sint||e===He.BGRA8Unorm||e===He.BGRA8UnormSRGB||e===He.RGB9E5UFloat||e===He.RGB10A2Unorm||e===He.RG11B10UFloat||e===He.Depth32Float||e===He.Depth24Plus||e===He.Depth24PlusStencil8||e===He.Depth32FloatStencil8)return 4;if(e===He.RG32Uint||e===He.RG32Sint||e===He.RG32Float||e===He.RGBA16Uint||e===He.RGBA16Sint||e===He.RGBA16Float)return 8;if(e===He.RGBA32Uint||e===He.RGBA32Sint||e===He.RGBA32Float)return 16}_getTypedArrayType(e){if(e===He.R8Uint)return Uint8Array;if(e===He.R8Sint)return Int8Array;if(e===He.R8Unorm)return Uint8Array;if(e===He.R8Snorm)return Int8Array;if(e===He.RG8Uint)return Uint8Array;if(e===He.RG8Sint)return Int8Array;if(e===He.RG8Unorm)return Uint8Array;if(e===He.RG8Snorm)return Int8Array;if(e===He.RGBA8Uint)return Uint8Array;if(e===He.RGBA8Sint)return Int8Array;if(e===He.RGBA8Unorm||e===He.RGBA8UnormSRGB)return Uint8Array;if(e===He.RGBA8Snorm)return Int8Array;if(e===He.R16Uint)return Uint16Array;if(e===He.R16Sint)return Int16Array;if(e===He.RG16Uint)return Uint16Array;if(e===He.RG16Sint)return Int16Array;if(e===He.RGBA16Uint)return Uint16Array;if(e===He.RGBA16Sint)return Int16Array;if(e===He.R16Float||e===He.RG16Float||e===He.RGBA16Float)return Uint16Array;if(e===He.R32Uint)return Uint32Array;if(e===He.R32Sint)return Int32Array;if(e===He.R32Float)return Float32Array;if(e===He.RG32Uint)return Uint32Array;if(e===He.RG32Sint)return Int32Array;if(e===He.RG32Float)return Float32Array;if(e===He.RGBA32Uint)return Uint32Array;if(e===He.RGBA32Sint)return Int32Array;if(e===He.RGBA32Float)return Float32Array;if(e===He.BGRA8Unorm||e===He.BGRA8UnormSRGB)return Uint8Array;if(e===He.RGB10A2Unorm||e===He.RGB9E5UFloat||e===He.RG11B10UFloat)return Uint32Array;if(e===He.Depth32Float)return Float32Array;if(e===He.Depth24Plus||e===He.Depth24PlusStencil8)return Uint32Array;if(e===He.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=SY.ThreeD:t=SY.TwoD,t}}function wk(n,e=null){const t=n.format,i=n.type,r=n.colorSpace,s=di.getTransfer(r);let a;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case lm:case um:a=s===Hn?He.BC1RGBAUnormSRGB:He.BC1RGBAUnorm;break;case cm:a=s===Hn?He.BC2RGBAUnormSRGB:He.BC2RGBAUnorm;break;case hm:a=s===Hn?He.BC3RGBAUnormSRGB:He.BC3RGBAUnorm;break;case Bv:a=He.BC4RUnorm;break;case Fv:a=He.BC4RSnorm;break;case f0:a=He.BC5RGUnorm;break;case Lv:a=He.BC5RGSnorm;break;case Nv:a=s===Hn?He.BC7RGBAUnormSRGB:He.BC7RGBAUnorm;break;case fv:case dv:a=s===Hn?He.ETC2RGB8UnormSRGB:He.ETC2RGB8Unorm;break;case pv:a=s===Hn?He.ETC2RGBA8UnormSRGB:He.ETC2RGBA8Unorm;break;case mv:a=He.EACR11Unorm;break;case gv:a=He.EACR11Snorm;break;case d0:a=He.EACRG11Unorm;break;case yv:a=He.EACRG11Snorm;break;case vv:a=s===Hn?He.ASTC4x4UnormSRGB:He.ASTC4x4Unorm;break;case xv:a=s===Hn?He.ASTC5x4UnormSRGB:He.ASTC5x4Unorm;break;case bv:a=s===Hn?He.ASTC5x5UnormSRGB:He.ASTC5x5Unorm;break;case _v:a=s===Hn?He.ASTC6x5UnormSRGB:He.ASTC6x5Unorm;break;case Sv:a=s===Hn?He.ASTC6x6UnormSRGB:He.ASTC6x6Unorm;break;case Mv:a=s===Hn?He.ASTC8x5UnormSRGB:He.ASTC8x5Unorm;break;case Av:a=s===Hn?He.ASTC8x6UnormSRGB:He.ASTC8x6Unorm;break;case Tv:a=s===Hn?He.ASTC8x8UnormSRGB:He.ASTC8x8Unorm;break;case Cv:a=s===Hn?He.ASTC10x5UnormSRGB:He.ASTC10x5Unorm;break;case wv:a=s===Hn?He.ASTC10x6UnormSRGB:He.ASTC10x6Unorm;break;case Ev:a=s===Hn?He.ASTC10x8UnormSRGB:He.ASTC10x8Unorm;break;case Rv:a=s===Hn?He.ASTC10x10UnormSRGB:He.ASTC10x10Unorm;break;case Pv:a=s===Hn?He.ASTC12x10UnormSRGB:He.ASTC12x10Unorm;break;case Dv:a=s===Hn?He.ASTC12x12UnormSRGB:He.ASTC12x12Unorm;break;case Vr:a=s===Hn?He.RGBA8UnormSRGB:He.RGBA8Unorm;break;default:Tt("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Vr:switch(i){case am:a=He.RGBA8Snorm;break;case om:a=He.RGBA16Sint;break;case zc:a=He.RGBA16Uint;break;case qr:a=He.RGBA32Uint;break;case Ao:a=He.RGBA32Sint;break;case br:a=s===Hn?He.RGBA8UnormSRGB:He.RGBA8Unorm;break;case zi:a=He.RGBA16Float;break;case wr:a=He.RGBA32Float;break;default:Tt("WebGPURenderer: Unsupported texture type with RGBAFormat.",i)}break;case Ab:switch(i){case XM:a=He.RGB9E5UFloat;break;case WM:a=He.RG11B10UFloat;break;default:Tt("WebGPURenderer: Unsupported texture type with RGBFormat.",i)}break;case rp:switch(i){case am:a=He.R8Snorm;break;case om:a=He.R16Sint;break;case zc:a=He.R16Uint;break;case qr:a=He.R32Uint;break;case Ao:a=He.R32Sint;break;case br:a=He.R8Unorm;break;case zi:a=He.R16Float;break;case wr:a=He.R32Float;break;default:Tt("WebGPURenderer: Unsupported texture type with RedFormat.",i)}break;case _l:switch(i){case am:a=He.RG8Snorm;break;case om:a=He.RG16Sint;break;case zc:a=He.RG16Uint;break;case qr:a=He.RG32Uint;break;case Ao:a=He.RG32Sint;break;case br:a=He.RG8Unorm;break;case zi:a=He.RG16Float;break;case wr:a=He.RG32Float;break;default:Tt("WebGPURenderer: Unsupported texture type with RGFormat.",i)}break;case Xo:switch(i){case zc:a=He.Depth16Unorm;break;case qr:a=He.Depth24Plus;break;case wr:a=He.Depth32Float;break;default:Tt("WebGPURenderer: Unsupported texture type with DepthFormat.",i)}break;case bl:switch(i){case jl:a=He.Depth24PlusStencil8;break;case wr:e&&e.features.has(Ck.Depth32FloatStencil8)===!1&&Tt('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),a=He.Depth32FloatStencil8;break;default:Tt("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",i)}break;case A0:switch(i){case Ao:a=He.R32Sint;break;case qr:a=He.R32Uint;break;default:Tt("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",i)}break;case jv:switch(i){case Ao:a=He.RG32Sint;break;case qr:a=He.RG32Uint;break;default:Tt("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",i)}break;case Yv:switch(i){case Ao:a=He.RGBA32Sint;break;case qr:a=He.RGBA32Uint;break;default:Tt("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",i)}break;default:Tt("WebGPURenderer: Unsupported texture format.",t)}return a}const G8e=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,O8e=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,AY={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},U8e=n=>{n=n.trim();const e=n.match(G8e);if(e!==null&&e.length===4){const t=e[2],i=[];let r=null;for(;(r=O8e.exec(t))!==null;)i.push({name:r[1],type:r[2]});const s=[];for(let c=0;c<i.length;c++){const{name:d,type:f}=i[c];let m=f;m.startsWith("ptr")?m="pointer":(m.startsWith("texture")&&(m=f.split("<")[0]),m=AY[m]),s.push(new dL(m,d))}const a=n.substring(e[0].length),o=e[3]||"void",l=e[1]!==void 0?e[1]:"";return{type:AY[o]||o,inputs:s,name:l,inputsCode:t,blockCode:a,outputType:o}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class k8e extends MH{constructor(e){const{type:t,inputs:i,name:r,inputsCode:s,blockCode:a,outputType:o}=U8e(e);super(t,i,r),this.inputsCode=s,this.blockCode=a,this.outputType=o}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class z8e extends nle{parseFunction(e){return new k8e(e)}}const V8e={[Ml.READ_ONLY]:"read",[Ml.WRITE_ONLY]:"write",[Ml.READ_WRITE]:"read_write"},TY={[Xc]:"repeat",[ps]:"clamp",[jf]:"mirror"},VD={vertex:wx.VERTEX,fragment:wx.FRAGMENT,compute:wx.COMPUTE},CY={instance:!0,swizzleAssign:!1,storageBuffer:!0},H8e={"^^":"tsl_xor"},X8e={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},wY={},vC={tsl_xor:new Qo("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Qo("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Qo("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Qo("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Qo("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Qo("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Qo("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Qo("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Qo("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Qo("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Qo("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Qo("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Qo(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},W8e={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let gle="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(gle+=`diagnostic( off, derivative_uniformity );
`);class Z8e extends SH{constructor(e,t){super(e,t,new z8e),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,i,r,s,a=this.shaderStage){return a==="fragment"?r?s?`textureSample( ${t}, ${t}_sampler, ${i}, ${r}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${i}, ${r} )`:s?`textureSample( ${t}, ${t}_sampler, ${i}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${i} )`:this.generateTextureSampleLevel(e,t,i,"0",r)}generateTextureSampleLevel(e,t,i,r,s,a){return this.isUnfilterable(e)===!1?a?`textureSampleLevel( ${t}, ${t}_sampler, ${i}, ${r}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${i}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,i,a,r):this.generateTextureLod(e,t,i,s,a,r)}generateWrapFunction(e){const t=`tsl_coord_${TY[e.wrapS]}S_${TY[e.wrapT]}_${e.is3DTexture||e.isData3DTexture?"3d":"2d"}T`;let i=wY[t];if(i===void 0){const r=[],s=e.is3DTexture||e.isData3DTexture?"vec3f":"vec2f";let a=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const o=(l,u)=>{l===Xc?(r.push(vC.repeatWrapping_float),a+=`		tsl_repeatWrapping_float( coord.${u} )`):l===ps?(r.push(vC.clampWrapping_float),a+=`		tsl_clampWrapping_float( coord.${u} )`):l===jf?(r.push(vC.mirrorWrapping_float),a+=`		tsl_mirrorWrapping_float( coord.${u} )`):(a+=`		coord.${u}`,mt(`WebGPURenderer: Unsupported texture wrap type "${l}" for vertex shader.`))};o(e.wrapS,"x"),a+=`,
`,o(e.wrapT,"y"),(e.is3DTexture||e.isData3DTexture)&&(a+=`,
`,o(e.wrapR,"z")),a+=`
	);

}
`,wY[t]=i=new Qo(a,r)}return i.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,i){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let s=r.dimensionsSnippet[i];if(r.dimensionsSnippet[i]===void 0){let a,o;const{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e),u=l>1;e.is3DTexture||e.isData3DTexture?o="vec3<u32>":o="vec2<u32>",u||e.isStorageTexture?a=t:a=`${t}${i?`, u32( ${i} )`:""}`,s=new mw(new gw(`textureDimensions( ${a} )`,o)),r.dimensionsSnippet[i]=s,(e.isArrayTexture||e.isDataArrayTexture||e.is3DTexture||e.isData3DTexture)&&(r.arrayLayerCount=new mw(new gw(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new mw(new gw("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,i,r,s="0u"){this._include("biquadraticTexture");const a=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,s);return r&&(i=`${i} + vec2<f32>(${r}) / ${o}`),`tsl_biquadraticTexture( ${t}, ${a}( ${i} ), ${o}, u32( ${s} ) )`}generateTextureLod(e,t,i,r,s,a="0u"){const o=this.generateWrapFunction(e),l=this.generateTextureDimension(e,t,a),u=e.is3DTexture||e.isData3DTexture?"vec3":"vec2";s&&(i=`${i} + ${u}<f32>(${s}) / ${u}<f32>( ${l} )`);const c=`${u}<u32>( ${o}( ${i} ) * ${u}<f32>( ${l} ) )`;return this.generateTextureLoad(e,t,c,a,r,null)}generateTextureLoad(e,t,i,r,s,a){r===null&&(r="0u"),a&&(i=`${i} + ${a}`);let o;return s?o=`textureLoad( ${t}, ${i}, ${s}, u32( ${r} ) )`:(o=`textureLoad( ${t}, ${i}, u32( ${r} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(o+=".x")),o}generateTextureStore(e,t,i,r,s){let a;return r?a=`textureStore( ${t}, ${i}, ${r}, ${s} )`:a=`textureStore( ${t}, ${i}, ${s} )`,a}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===wr||this.isSampleCompare(e)===!1&&e.minFilter===xr&&e.magFilter===xr||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,i,r,s,a=this.shaderStage){let o=null;return this.isUnfilterable(e)?o=this.generateTextureLod(e,t,i,r,s,"0",a):o=this._generateTextureSample(e,t,i,r,s,a),o}generateTextureGrad(e,t,i,r,s,a,o=this.shaderStage){if(o==="fragment")return a?`textureSampleGrad( ${t}, ${t}_sampler, ${i},  ${r[0]}, ${r[1]}, ${a} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${i},  ${r[0]}, ${r[1]} )`;Tt(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,i,r,s,a,o=this.shaderStage){if(o==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?a?`textureSampleCompare( ${t}, ${t}_sampler, ${i}, ${s}, ${r}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${i}, ${s}, ${r} )`:a?`textureSampleCompare( ${t}, ${t}_sampler, ${i}, ${r}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${i}, ${r} )`;Tt(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,i,r,s,a){return this.isUnfilterable(e)===!1?a?`textureSampleLevel( ${t}, ${t}_sampler, ${i}, ${r}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${i}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,i,a,r):this.generateTextureLod(e,t,i,s,a,r)}generateTextureBias(e,t,i,r,s,a,o=this.shaderStage){if(o==="fragment")return a?`textureSampleBias( ${t}, ${t}_sampler, ${i}, ${r}, ${a} )`:`textureSampleBias( ${t}, ${t}_sampler, ${i}, ${r} )`;Tt(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const i=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="cubeDepthTexture"||r==="storageTexture"||r==="texture3D"?i:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?this.isCustomStruct(e)?i:i+".value":e.groupNode.name+"."+i}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=H8e[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(mt("WebGPURenderer: Atomic operations are only supported in compute shaders."),Ml.READ_WRITE):Ml.READ_ONLY:e.access}getStorageAccess(e,t){return V8e[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,i,r=null){const s=super.getUniformFromNode(e,t,i,r),a=this.getDataFromNode(e,i,this.globalCache);if(a.uniformGPU===void 0){let o;const l=e.groupNode,u=l.name,c=this.getBindGroupArray(u,i);if(t==="texture"||t==="cubeTexture"||t==="cubeDepthTexture"||t==="storageTexture"||t==="texture3D"){let d=null;const f=this.getNodeAccess(e,i);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?d=new Tk(s.name,s.node,l,f):d=new pL(s.name,s.node,l,f):t==="cubeTexture"||t==="cubeDepthTexture"?d=new fle(s.name,s.node,l,f):t==="texture3D"&&(d=new Tk(s.name,s.node,l,f)),d.store=e.isStorageTextureNode===!0,d.mipLevel=d.store?e.mipLevel:0,d.setVisibility(VD[i]),this.isUnfilterable(e.value)===!1&&d.store===!1){const m=new R8e(`${s.name}_sampler`,s.node,l);m.setVisibility(VD[i]),c.push(m,d),o=[m,d]}else c.push(d),o=[d]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const d=this.getSharedDataFromNode(e);let f=d.buffer;if(f===void 0){const m=t==="buffer"?cle:N8e;f=new m(e,l),d.buffer=f}f.setVisibility(f.getVisibility()|VD[i]),c.push(f),o=f,s.name=r||"NodeBuffer_"+s.id}else{const d=this.uniformGroups[i]||(this.uniformGroups[i]={});let f=d[u];f===void 0&&(f=new hle(u,l),f.setVisibility(VD[i]),d[u]=f,c.push(f)),o=this.getNodeUniform(s,t),f.addUniform(o)}a.uniformGPU=o}return s}getBuiltin(e,t,i,r=this.shaderStage){const s=this.builtins[r]||(this.builtins[r]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:i}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,i=this.flowShaderNode(e),r=[];for(const a of t.inputs)r.push(a.name+" : "+this.getType(a.type));let s=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${i.vars}
${i.code}
`;return i.result&&(s+=`	return ${i.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],i=this.directives[e];if(i!==void 0)for(const r of i)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],i=this.builtins[e];if(i!==void 0)for(const{name:r,property:s,type:a}of i.values())t.push(`@builtin( ${r} ) ${s} : ${a}`);return t.join(`,
	`)}getScopedArray(e,t,i,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:i,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:i,scope:r,bufferType:s,bufferCount:a}of this.scopedArrays.values()){const o=this.getType(s);t.push(`var<${r}> ${i}: array< ${o}, ${a} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const i=this.getBuiltins("attribute");i&&t.push(i);const r=this.getAttributesArray();for(let s=0,a=r.length;s<a;s++){const o=r[s],l=o.name,u=this.getType(o.type);t.push(`@location( ${s} ) ${l} : ${u}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const i of e.members){const r=e.output?"@location( "+i.index+" ) ":"";let s=this.getType(i.type);i.atomic&&(s="atomic< "+s+" >"),t.push(`	${r+i.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const i=this.structs[e];if(i.length>0){const r=[];for(const s of i){let a=`struct ${s.name} {
`;a+=this.getStructMembers(s),a+=`
};`,r.push(a)}t=`
`+r.join(`

`)+`
`}return t}getVar(e,t,i=null){let r=`var ${t} : `;return i!==null?r+=this.generateArrayDeclaration(e,i):r+=this.getType(e),r}getVars(e){const t=[],i=this.vars[e];if(i!==void 0)for(const r of i)t.push(`	${this.getVar(r.type,r.name,r.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,a=this.vars[e];for(let o=0;o<s.length;o++){const l=s[o];if(l.needsInterpolation){let u=`@location( ${o} )`;if(l.interpolationType){const c=l.interpolationSampling!==null?`, ${l.interpolationSampling} )`:" )";u+=` @interpolate( ${l.interpolationType}${c}`}else/^(int|uint|ivec|uvec)/.test(l.type)&&(u+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${u} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&a.includes(l)===!1&&a.push(l)}}const i=this.getBuiltins(e);i&&t.push(i);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}isCustomStruct(e){const t=e.value,i=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&i.structTypeNode!==null,s=i.value&&i.value.array&&typeof i.value.itemSize=="number"&&i.value.array.length>i.value.itemSize;return r&&!s}getUniforms(e){const t=this.uniforms[e],i=[],r=[],s=[],a={};for(const l of t){const u=l.groupNode.name,c=this.bindingsIndexes[u];if(l.type==="texture"||l.type==="cubeTexture"||l.type==="cubeDepthTexture"||l.type==="storageTexture"||l.type==="texture3D"){const d=l.node.value;this.isUnfilterable(d)===!1&&l.node.isStorageTextureNode!==!0&&(this.isSampleCompare(d)?i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name}_sampler : sampler_comparison;`):i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name}_sampler : sampler;`));let f,m="";const{primarySamples:y}=this.renderer.backend.utils.getTextureSampleData(d);if(y>1&&(m="_multisampled"),d.isCubeTexture===!0&&d.isDepthTexture===!0)f="texture_depth_cube";else if(d.isCubeTexture===!0)f="texture_cube<f32>";else if(d.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&d.compareFunction===null?f=`texture${m}_2d<f32>`:f=`texture_depth${m}_2d${d.isArrayTexture===!0?"_array":""}`;else if(l.node.isStorageTextureNode===!0){const _=wk(d),S=this.getStorageAccess(l.node,e),b=l.node.value.is3DTexture,M=l.node.value.isArrayTexture;f=`texture_storage_${b?"3d":`2d${M?"_array":""}`}<${_}, ${S}>`}else if(d.isArrayTexture===!0||d.isDataArrayTexture===!0||d.isCompressedArrayTexture===!0)f="texture_2d_array<f32>";else if(d.is3DTexture===!0||d.isData3DTexture===!0)f="texture_3d<f32>";else{const _=this.getComponentTypeFromTexture(d).charAt(0);f=`texture${m}_2d<${_}32>`}i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name} : ${f};`)}else if(l.type==="buffer"||l.type==="storageBuffer"||l.type==="indirectStorageBuffer"){const d=l.node,f=this.getType(d.getNodeType(this)),m=d.bufferCount,y=m>0&&l.type==="buffer"?", "+m:"",_=d.isStorageBufferNode?`storage, ${this.getStorageAccess(d,e)}`:"uniform";if(this.isCustomStruct(l))r.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var<${_}> ${l.name} : ${f};`);else{const b=`	value : array< ${d.isAtomic?`atomic<${f}>`:`${f}`}${y} >`;r.push(this._getWGSLStructBinding(l.name,b,_,c.binding++,c.group))}}else{const d=this.getType(this.getVectorType(l.type)),f=l.groupNode.name;(a[f]||(a[f]={index:c.binding++,id:c.group,snippets:[]})).snippets.push(`	${l.name} : ${d}`)}}for(const l in a){const u=a[l];s.push(this._getWGSLStructBinding(l,u.snippets.join(`,
`),"uniform",u.index,u.id))}return[...i,...r,...s].join(`
`)}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const i=e[t];i.uniforms=this.getUniforms(t),i.attributes=this.getAttributes(t),i.varyings=this.getVaryings(t),i.structs=this.getStructs(t),i.vars=this.getVars(t),i.codes=this.getCodes(t),i.directives=this.getDirectives(t),i.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const s=this.flowNodes[t],a=s[s.length-1],o=a.outputNode,l=o!==void 0&&o.isOutputStructNode===!0;for(const u of s){const c=this.getFlowData(u),d=u.name;if(d&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${d}
`),r+=`${c.code}
	`,u===a&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.Vertex = ${c.result};`;else if(t==="fragment")if(l)i.returnType=o.getNodeType(this),i.structs+="var<private> output : "+i.returnType+";",r+=`return ${c.result};`;else{let f="	@location(0) color: vec4<f32>";const m=this.getBuiltins("output");m&&(f+=`,
	`+m),i.returnType="OutputStruct",i.structs+=this._getWGSLStruct("OutputStruct",f),i.structs+=`
var<private> output : OutputStruct;`,r+=`output.color = ${c.result};

	return output;`}}}i.flow=r}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let i;return t!==null&&(i=this._getWGSLMethod(e+"_"+t)),i===void 0&&(i=this._getWGSLMethod(e)),i||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,i){return`select( ${i}, ${t}, ${e} )`}getType(e){return X8e[e]||e}isAvailable(e){let t=CY[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),CY[e]=t),t}_getWGSLMethod(e){return vC[e]!==void 0&&this._include(e),W8e[e]}_include(e){const t=vC[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${gle}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[i,r,s]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${i}, ${r}, ${s} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${i} * numWorkgroups.x )
		+ globalId.z * ( ${i} * numWorkgroups.x ) * ( ${r} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,i,r=0,s=0){const a=e+"Struct";return`${this._getWGSLStruct(a,t)}
@binding( ${r} ) @group( ${s} )
var<${i}> ${e} : ${a};`}}class j8e{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=He.Depth24PlusStencil8:e.depth&&(t=He.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,a=s.getRenderTarget();t=a?a.samples:s.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const i=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:i?1:t,isMSAA:i}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return HS.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return HS.LineList;if(e.isLine)return HS.LineStrip;if(e.isMesh)return HS.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const t=this.backend.parameters.outputType;if(t===void 0)return navigator.gpu.getPreferredCanvasFormat();if(t===br)return He.BGRA8Unorm;if(t===zi)return He.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const yle=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&yle.set(Float16Array,["float16"]);const Y8e=new Map([[$2,["float16"]]]),K8e=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class $8e{constructor(e){this.backend=e}createAttribute(e,t){const i=this._getBufferAttribute(e),r=this.backend,s=r.get(i);let a=s.buffer;if(a===void 0){const o=r.device;let l=i.array;if(e.normalized===!1){if(l.constructor===Int16Array||l.constructor===Int8Array)l=new Int32Array(l);else if((l.constructor===Uint16Array||l.constructor===Uint8Array)&&(l=new Uint32Array(l),t&GPUBufferUsage.INDEX))for(let d=0;d<l.length;d++)l[d]===65535&&(l[d]=4294967295)}if(i.array=l,(i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute)&&i.itemSize===3){l=new l.constructor(i.count*4);for(let d=0;d<i.count;d++)l.set(i.array.subarray(d*3,d*3+3),d*4);i.itemSize=4,i.array=l,s._force3to4BytesAlignment=!0}const u=l.byteLength,c=u+(4-u%4)%4;a=o.createBuffer({label:i.name,size:c,usage:t,mappedAtCreation:!0}),new l.constructor(a.getMappedRange()).set(l),a.unmap(),s.buffer=a}}updateAttribute(e){const t=this._getBufferAttribute(e),i=this.backend,r=i.device,s=i.get(t),a=i.get(t).buffer;let o=t.array;if(s._force3to4BytesAlignment===!0){o=new o.constructor(t.count*4);for(let u=0;u<t.count;u++)o.set(t.array.subarray(u*3,u*3+3),u*4);t.array=o}const l=t.updateRanges;if(l.length===0)r.queue.writeBuffer(a,0,o,0);else{const u=gM(o),c=u?1:o.BYTES_PER_ELEMENT;for(let d=0,f=l.length;d<f;d++){const m=l[d];let y,_;if(s._force3to4BytesAlignment===!0){const b=Math.floor(m.start/3),M=Math.ceil(m.count/3);y=b*4*c,_=M*4*c}else y=m.start*c,_=m.count*c;const S=y*(u?o.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(a,S,o,y,_)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),i=new Map;for(let r=0;r<t.length;r++){const s=t[r],a=s.array.BYTES_PER_ELEMENT,o=this._getBufferAttribute(s);let l=i.get(o);if(l===void 0){let d,f;s.isInterleavedBufferAttribute===!0?(d=s.data.stride*a,f=s.data.isInstancedInterleavedBuffer?zD.Instance:zD.Vertex):(d=s.itemSize*a,f=s.isInstancedBufferAttribute?zD.Instance:zD.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(d=4),l={arrayStride:d,attributes:[],stepMode:f},i.set(o,l)}const u=this._getVertexFormat(s),c=s.isInterleavedBufferAttribute===!0?s.offset*a:0;l.attributes.push({shaderLocation:r,offset:c,format:u})}return Array.from(i.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,i=t.device,s=t.get(this._getBufferAttribute(e)).buffer,a=s.size,o=i.createBuffer({label:`${e.name}_readback`,size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=i.createCommandEncoder({label:`readback_encoder_${e.name}`});l.copyBufferToBuffer(s,0,o,0,a);const u=l.finish();i.queue.submit([u]),await o.mapAsync(GPUMapMode.READ);const c=o.getMappedRange(),d=new e.array.constructor(c.slice(0));return o.unmap(),d.buffer}_getVertexFormat(e){const{itemSize:t,normalized:i}=e,r=e.array.constructor,s=e.constructor;let a;if(t===1)a=K8e.get(r);else{const l=(Y8e.get(s)||yle.get(r))[i?1:0];if(l){const u=r.BYTES_PER_ELEMENT*t,d=Math.floor((u+3)/4)*4/r.BYTES_PER_ELEMENT;if(d%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a=`${l}x${d}`}}return a||Tt("WebGPUAttributeUtils: Vertex format not supported yet."),a}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class J8e{constructor(e){this.layoutGPU=e,this.usedTimes=0}}class q8e{constructor(e){this.backend=e,this._bindGroupLayoutCache=new Map}createBindingsLayout(e){const t=this.backend,i=t.device,r=t.get(e);if(r.layout)return r.layout.layoutGPU;const s=this._createLayoutEntries(e),a=JSON.stringify(s);let o=this._bindGroupLayoutCache.get(a);return o===void 0&&(o=new J8e(i.createBindGroupLayout({entries:s})),this._bindGroupLayoutCache.set(a,o)),o.usedTimes++,r.layout=o,r.layoutKey=a,o.layoutGPU}createBindings(e,t,i,r=0){const{backend:s}=this,a=s.get(e),o=this.createBindingsLayout(e);let l;i>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[i]===r&&(l=a.groups[i])),l===void 0&&(l=this.createBindGroup(e,o),i>0&&(a.groups[i]=l,a.versions[i]=r)),a.group=l}updateBinding(e){const t=this.backend,i=t.device,r=e.buffer,s=t.get(e).buffer,a=e.updateRanges;if(a.length===0)i.queue.writeBuffer(s,0,r,0);else{const o=gM(r),l=o?1:r.BYTES_PER_ELEMENT;for(let u=0,c=a.length;u<c;u++){const d=a[u],f=d.start*l,m=d.count*l,y=f*(o?r.BYTES_PER_ELEMENT:1);i.queue.writeBuffer(s,y,r,f,m)}e.clearUpdateRanges()}}createBindGroupIndex(e,t){const r=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a=e[0],o=r.createBuffer({label:"bindingCameraIndex_"+a,size:16,usage:s});r.queue.writeBuffer(o,0,e,0);const l=[{binding:0,resource:{buffer:o}}];return r.createBindGroup({label:"bindGroupCameraIndex_"+a,layout:t,entries:l})}createBindGroup(e,t){const i=this.backend,r=i.device;let s=0;const a=[];for(const o of e.bindings){if(o.isUniformBuffer){const l=i.get(o);if(l.buffer===void 0){const u=o.byteLength,c=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,d=[];o.visibility&wx.VERTEX&&d.push("vertex"),o.visibility&wx.FRAGMENT&&d.push("fragment"),o.visibility&wx.COMPUTE&&d.push("compute");const f=`(${d.join(",")})`,m=r.createBuffer({label:`bindingBuffer${o.id}_${o.name}_${f}`,size:u,usage:c});l.buffer=m}a.push({binding:s,resource:{buffer:l.buffer}})}else if(o.isStorageBuffer){const l=i.get(o);if(l.buffer===void 0){const u=o.attribute;l.buffer=i.get(u).buffer}a.push({binding:s,resource:{buffer:l.buffer}})}else if(o.isSampledTexture){const l=i.get(o.texture);let u;if(l.externalTexture!==void 0)u=r.importExternalTexture({source:l.externalTexture});else{const c=o.store?1:l.texture.mipLevelCount,d=o.store?o.mipLevel:0;let f=`view-${l.texture.width}-${l.texture.height}`;if(l.texture.depthOrArrayLayers>1&&(f+=`-${l.texture.depthOrArrayLayers}`),f+=`-${c}-${d}`,u=l[f],u===void 0){const m=E8e.All;let y;o.isSampledCubeTexture?y=zo.Cube:o.isSampledTexture3D?y=zo.ThreeD:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?y=zo.TwoDArray:y=zo.TwoD,u=l[f]=l.texture.createView({aspect:m,dimension:y,mipLevelCount:c,baseMipLevel:d})}}a.push({binding:s,resource:u})}else if(o.isSampler){const l=i.get(o.texture);a.push({binding:s,resource:l.sampler})}s++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:a})}_createLayoutEntries(e){const t=[];let i=0;for(const r of e.bindings){const s=this.backend,a={binding:i,visibility:r.visibility};if(r.isUniformBuffer||r.isStorageBuffer){const o={};r.isStorageBuffer&&(r.visibility&wx.COMPUTE&&(r.access===Ml.READ_WRITE||r.access===Ml.WRITE_ONLY)?o.type=JO.Storage:o.type=JO.ReadOnlyStorage),a.buffer=o}else if(r.isSampledTexture&&r.store){const o={};o.format=this.backend.get(r.texture).texture.format;const l=r.access;l===Ml.READ_WRITE?o.access=qO.ReadWrite:l===Ml.WRITE_ONLY?o.access=qO.WriteOnly:o.access=qO.ReadOnly,r.texture.isArrayTexture?o.viewDimension=zo.TwoDArray:r.texture.is3DTexture&&(o.viewDimension=zo.ThreeD),a.storageTexture=o}else if(r.isSampledTexture){const o={},{primarySamples:l}=s.utils.getTextureSampleData(r.texture);if(l>1&&(o.multisampled=!0,r.texture.isDepthTexture||(o.sampleType=sx.UnfilterableFloat)),r.texture.isDepthTexture)s.compatibilityMode&&r.texture.compareFunction===null?o.sampleType=sx.UnfilterableFloat:o.sampleType=sx.Depth;else if(r.texture.isDataTexture||r.texture.isDataArrayTexture||r.texture.isData3DTexture){const u=r.texture.type;u===Ao?o.sampleType=sx.SInt:u===qr?o.sampleType=sx.UInt:u===wr&&(this.backend.hasFeature("float32-filterable")?o.sampleType=sx.Float:o.sampleType=sx.UnfilterableFloat)}r.isSampledCubeTexture?o.viewDimension=zo.Cube:r.texture.isArrayTexture||r.texture.isDataArrayTexture||r.texture.isCompressedArrayTexture?o.viewDimension=zo.TwoDArray:r.isSampledTexture3D&&(o.viewDimension=zo.ThreeD),a.texture=o}else if(r.isSampler){const o={};r.texture.isDepthTexture&&(r.texture.compareFunction!==null?o.type=_Y.Comparison:s.compatibilityMode&&(o.type=_Y.NonFiltering)),a.sampler=o}else Tt(`WebGPUBindingUtils: Unsupported binding "${r}".`);t.push(a),i++}return t}deleteBindGroupData(e){const{backend:t}=this,i=t.get(e);i.layout&&(i.layout.usedTimes--,i.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(i.layoutKey),i.layout=void 0,i.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class Q8e{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:i,material:r,geometry:s,pipeline:a}=e,{vertexProgram:o,fragmentProgram:l}=a,u=this.backend,c=u.device,d=u.utils,f=u.get(a),m=[];for(const W of e.getBindings()){const K=u.get(W),{layoutGPU:q}=K.layout;m.push(q)}const y=u.attributeUtils.createShaderVertexBuffers(e);let _;r.blending!==Oa&&(r.blending!==Al||r.transparent!==!1)&&(_=this._getBlending(r));let S={};r.stencilWrite===!0&&(S={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const b=this._getColorWriteMask(r),M=[];if(e.context.textures!==null){const W=e.context.textures;for(let K=0;K<W.length;K++){const q=d.getTextureFormatGPU(W[K]);K===0?M.push({format:q,blend:_,writeMask:b}):M.push({format:q,writeMask:b})}}else{const W=d.getCurrentColorFormat(e.context);M.push({format:W,blend:_,writeMask:b})}const w=u.get(o).module,T=u.get(l).module,E=this._getPrimitiveState(i,s,r),R=this._getDepthCompare(r),P=d.getCurrentDepthStencilFormat(e.context),I=this._getSampleCount(e.context),B={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},w,{buffers:y}),fragment:Object.assign({},T,{targets:M}),primitive:E,multisample:{count:I,alphaToCoverageEnabled:r.alphaToCoverage&&I>1},layout:c.createPipelineLayout({bindGroupLayouts:m})},N={},U=e.context.depth,V=e.context.stencil;if((U===!0||V===!0)&&(U===!0&&(N.format=P,N.depthWriteEnabled=r.depthWrite,N.depthCompare=R),V===!0&&(N.stencilFront=S,N.stencilBack={},N.stencilReadMask=r.stencilFuncMask,N.stencilWriteMask=r.stencilWriteMask),r.polygonOffset===!0&&(N.depthBias=r.polygonOffsetUnits,N.depthBiasSlopeScale=r.polygonOffsetFactor,N.depthBiasClamp=0),B.depthStencil=N),c.pushErrorScope("validation"),t===null)f.pipeline=c.createRenderPipeline(B),c.popErrorScope().then(W=>{W!==null&&(f.error=!0,Tt(W.message))});else{const W=new Promise(async K=>{try{f.pipeline=await c.createRenderPipelineAsync(B)}catch{}const q=await c.popErrorScope();q!==null&&(f.error=!0,Tt(q.message)),K()});t.push(W)}}createBundleEncoder(e,t="renderBundleEncoder"){const i=this.backend,{utils:r,device:s}=i,a=r.getCurrentDepthStencilFormat(e),o=r.getCurrentColorFormats(e),l=this._getSampleCount(e),u={label:t,colorFormats:o,depthStencilFormat:a,sampleCount:l};return s.createRenderBundleEncoder(u)}createComputePipeline(e,t){const i=this.backend,r=i.device,s=i.get(e.computeProgram).module,a=i.get(e),o=[];for(const l of t){const u=i.get(l),{layoutGPU:c}=u.layout;o.push(c)}a.pipeline=r.createComputePipeline({compute:s,layout:r.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(e){let t,i;const r=e.blending,s=e.blendSrc,a=e.blendDst,o=e.blendEquation;if(r===nv){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,u=e.blendDstAlpha!==null?e.blendDstAlpha:a,c=e.blendEquationAlpha!==null?e.blendEquationAlpha:o;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(o)},i={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(u),operation:this._getBlendOperation(c)}}else{const l=e.premultipliedAlpha,u=(c,d,f,m)=>{t={srcFactor:c,dstFactor:d,operation:rx.Add},i={srcFactor:f,dstFactor:m,operation:rx.Add}};if(l)switch(r){case Al:u(Or.One,Or.OneMinusSrcAlpha,Or.One,Or.OneMinusSrcAlpha);break;case bm:u(Or.One,Or.One,Or.One,Or.One);break;case u0:u(Or.Zero,Or.OneMinusSrc,Or.Zero,Or.One);break;case c0:u(Or.Dst,Or.OneMinusSrcAlpha,Or.Zero,Or.One);break}else switch(r){case Al:u(Or.SrcAlpha,Or.OneMinusSrcAlpha,Or.One,Or.OneMinusSrcAlpha);break;case bm:u(Or.SrcAlpha,Or.One,Or.One,Or.One);break;case u0:Tt("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case c0:Tt("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&i!==void 0)return{color:t,alpha:i};Tt("WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case Bf:t=Or.Zero;break;case VE:t=Or.One;break;case HE:t=Or.Src;break;case XE:t=Or.OneMinusSrc;break;case Yx:t=Or.SrcAlpha;break;case Kx:t=Or.OneMinusSrcAlpha;break;case jE:t=Or.Dst;break;case YE:t=Or.OneMinusDst;break;case WE:t=Or.DstAlpha;break;case ZE:t=Or.OneMinusDstAlpha;break;case KE:t=Or.SrcAlphaSaturated;break;case Rze:t=Or.Constant;break;case Pze:t=Or.OneMinusConstant;break;default:Tt("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const i=e.stencilFunc;switch(i){case R9:t=zl.Never;break;case Xw:t=zl.Always;break;case P9:t=zl.Less;break;case N9:t=zl.LessEqual;break;case D9:t=zl.Equal;break;case L9:t=zl.GreaterEqual;break;case B9:t=zl.Greater;break;case F9:t=zl.NotEqual;break;default:Tt("WebGPURenderer: Invalid stencil function.",i)}return t}_getStencilOperation(e){let t;switch(e){case Og:t=Sy.Keep;break;case S9:t=Sy.Zero;break;case M9:t=Sy.Replace;break;case E9:t=Sy.Invert;break;case A9:t=Sy.IncrementClamp;break;case T9:t=Sy.DecrementClamp;break;case C9:t=Sy.IncrementWrap;break;case w9:t=Sy.DecrementWrap;break;default:Tt("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case vl:t=rx.Add;break;case kE:t=rx.Subtract;break;case zE:t=rx.ReverseSubtract;break;case k2:t=rx.Min;break;case z2:t=rx.Max;break;default:Tt("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,i){const r={},s=this.backend.utils;r.topology=s.getPrimitiveTopology(e,i),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?CM.Uint16:CM.Uint32);let a=i.side===Er;return e.isMesh&&e.matrixWorld.determinant()<0&&(a=!a),r.frontFace=a===!0?vY.CW:vY.CCW,r.cullMode=i.side===fr?xY.None:xY.Back,r}_getColorWriteMask(e){return e.colorWrite===!0?bY.All:bY.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=zl.Always;else{const i=e.depthFunc;switch(i){case $x:t=zl.Never;break;case hv:t=zl.Always;break;case Jx:t=zl.Less;break;case _m:t=zl.LessEqual;break;case qx:t=zl.Equal;break;case Qx:t=zl.GreaterEqual;break;case eb:t=zl.Greater;break;case tb:t=zl.NotEqual;break;default:Tt("WebGPUPipelineUtils: Invalid depth function.",i)}}return t}}class eXe extends mle{constructor(e,t,i=2048){super(i),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return hs(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,i=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,i);const s=r.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,i),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,i)),o={},l=[];for(const[c,d]of e){const f=c.match(/^(.*):f(\d+)$/),m=parseInt(f[2]);l.includes(m)===!1&&l.push(m),o[m]===void 0&&(o[m]=0);const y=a[d],_=a[d+1],S=Number(_-y)/1e6;this.timestamps.set(c,S),o[m]+=S}const u=o[l[l.length-1]];return this.resultBuffer.unmap(),this.lastValue=u,this.frames=l,u}catch(e){return Tt("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){Tt("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){Tt("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class tXe extends ple{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new j8e(this),this.attributeUtils=new $8e(this),this.bindingUtils=new q8e(this),this.pipelineUtils=new Q8e(this),this.textureUtils=new I8e(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let i;if(t.device===void 0){const r={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},s=typeof navigator<"u"?await navigator.gpu.requestAdapter(r):null;if(s===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const a=Object.values(Ck),o=[];for(const u of a)s.features.has(u)&&o.push(u);const l={requiredFeatures:o,requiredLimits:t.requiredLimits};i=await s.requestDevice(l)}else i=t.device;i.lost.then(r=>{if(r.reason==="destroyed")return;const s={api:"WebGPU",message:r.message||"Unknown reason",reason:r.reason||null,originalEvent:r};e.onDeviceLost(s)}),this.device=i,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(Ck.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let i=t.context;if(i===void 0){const r=this.parameters;e.isDefaultCanvasTarget===!0&&r.context!==void 0?i=r.context:i=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${Xd} webgpu`);const s=r.alpha?"premultiplied":"opaque",a=r.outputType===zi?"extended":"standard";i.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s,toneMapping:{mode:a}}),t.context=i}return i}get coordinateSystem(){return ic}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),i=this.get(t),r=e.currentSamples;let s=i.descriptor;if(s===void 0||i.samples!==r){s={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(s.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const o=s.colorAttachments[0];r>0?o.view=this.textureUtils.getColorBuffer().createView():o.resolveTarget=void 0,i.descriptor=s,i.samples=r}const a=s.colorAttachments[0];return r>0?a.resolveTarget=this.context.getCurrentTexture().createView():a.view=this.context.getCurrentTexture().createView(),s}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const i=e.renderTarget,r=this.get(i);let s=r.descriptors;(s===void 0||r.width!==i.width||r.height!==i.height||r.samples!==i.samples)&&(s={},r.descriptors=s);const a=e.getCacheKey();let o=s[a];if(o===void 0){const u=e.textures,c=[];let d;const f=this._isRenderCameraDepthArray(e);for(let m=0;m<u.length;m++){const y=this.get(u[m]),_={label:`colorAttachment_${m}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:zo.TwoD};if(i.isRenderTarget3D)d=e.activeCubeFace,_.baseArrayLayer=0,_.dimension=zo.ThreeD,_.depthOrArrayLayers=u[m].image.depth;else if(i.isRenderTarget&&u[m].image.depth>1)if(f===!0){const S=e.camera.cameras;for(let b=0;b<S.length;b++){const M={..._,baseArrayLayer:b,arrayLayerCount:1,dimension:zo.TwoD},w=y.texture.createView(M);c.push({view:w,resolveTarget:void 0,depthSlice:void 0})}}else _.dimension=zo.TwoDArray,_.depthOrArrayLayers=u[m].image.depth;if(f!==!0){const S=y.texture.createView(_);let b,M;y.msaaTexture!==void 0?(b=y.msaaTexture.createView(),M=S):(b=S,M=void 0),c.push({view:b,resolveTarget:M,depthSlice:d})}}if(o={textureViews:c},e.depth){const m=this.get(e.depthTexture),y={};(e.depthTexture.isArrayTexture||e.depthTexture.isCubeTexture)&&(y.dimension=zo.TwoD,y.arrayLayerCount=1,y.baseArrayLayer=e.activeCubeFace),o.depthStencilView=m.texture.createView(y)}s[a]=o,r.width=i.width,r.height=i.height,r.samples=i.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace}const l={colorAttachments:[]};for(let u=0;u<o.textureViews.length;u++){const c=o.textureViews[u];let d={r:0,g:0,b:0,a:1};u===0&&t.clearValue&&(d=t.clearValue),l.colorAttachments.push({view:c.view,depthSlice:c.depthSlice,resolveTarget:c.resolveTarget,loadOp:t.loadOp||vs.Load,storeOp:t.storeOp||Vu.Store,clearValue:d})}return o.depthStencilView&&(l.depthStencilAttachment={view:o.depthStencilView}),l}beginRender(e){const t=this.get(e),i=this.device,r=e.occlusionQueryCount;let s;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=i.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let a;e.textures===null?a=this._getDefaultRenderPassDescriptor():a=this._getRenderPassDescriptor(e,{loadOp:vs.Load}),this.initTimestampQuery(Td.RENDER,this.getTimestampUID(e),a),a.occlusionQuerySet=s;const o=a.depthStencilAttachment;if(e.textures!==null){const u=a.colorAttachments;for(let c=0;c<u.length;c++){const d=u[c];e.clearColor?(d.clearValue=c===0?e.clearColorValue:{r:0,g:0,b:0,a:1},d.loadOp=vs.Clear):d.loadOp=vs.Load,d.storeOp=Vu.Store}}else{const u=a.colorAttachments[0];e.clearColor?(u.clearValue=e.clearColorValue,u.loadOp=vs.Clear):u.loadOp=vs.Load,u.storeOp=Vu.Store}e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=vs.Clear):o.depthLoadOp=vs.Load,o.depthStoreOp=Vu.Store),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=vs.Clear):o.stencilLoadOp=vs.Load,o.stencilStoreOp=Vu.Store);const l=i.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const u=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==u.length?this._createDepthLayerDescriptors(e,t,a,u):this._updateDepthLayerDescriptors(e,t,u),t.bundleEncoders=[],t.bundleSets=[];for(let c=0;c<u.length;c++){const d=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+c),f={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(d),t.bundleSets.push(f)}t.currentPass=null}else{const u=l.beginRenderPass(a);t.currentPass=u,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=a,t.encoder=l,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,i,r){const s=i.depthStencilAttachment;t.layerDescriptors=[];const a=this.get(e.depthTexture);a.viewCache||(a.viewCache=[]);for(let o=0;o<r.length;o++){const l={...i,colorAttachments:[{...i.colorAttachments[0],view:i.colorAttachments[o].view}]};if(i.depthStencilAttachment){const u=o;a.viewCache[u]||(a.viewCache[u]=a.texture.createView({dimension:zo.TwoD,baseArrayLayer:o,arrayLayerCount:1})),l.depthStencilAttachment={view:a.viewCache[u],depthLoadOp:s.depthLoadOp||vs.Clear,depthStoreOp:s.depthStoreOp||Vu.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(l.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,l.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,l.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else l.depthStencilAttachment={...s};t.layerDescriptors.push(l)}}_updateDepthLayerDescriptors(e,t,i){for(let r=0;r<i.length;r++){const s=t.layerDescriptors[r];if(s.depthStencilAttachment){const a=s.depthStencilAttachment;e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=vs.Clear):a.depthLoadOp=vs.Load),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=vs.Clear):a.stencilLoadOp=vs.Load)}}}finishRender(e){const t=this.get(e),i=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),i>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const r=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let a=0;a<t.bundleEncoders.length;a++){const o=t.bundleEncoders[a];s.push(o.finish())}for(let a=0;a<t.layerDescriptors.length;a++)if(a<s.length){const o=t.layerDescriptors[a],l=r.beginRenderPass(o);if(e.viewport){const{x:u,y:c,width:d,height:f,minDepth:m,maxDepth:y}=e.viewportValue;l.setViewport(u,c,d,f,m,y)}if(e.scissor){const{x:u,y:c,width:d,height:f}=e.scissorValue;l.setScissorRect(u,c,d,f)}l.executeBundles([s[a]]),l.end()}}else t.currentPass&&t.currentPass.end();if(i>0){const s=i*8;let a=this.occludedResolveCache.get(s);a===void 0&&(a=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,a));const o=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,i,a,0),t.encoder.copyBufferToBuffer(a,0,o,0,s),t.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let a=0;a<s.length;a++){const o=s[a];o.generateMipmaps===!0&&this.textureUtils.generateMipmaps(o)}}}isOccluded(e,t){const i=this.get(e);return i.occluded&&i.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:i,currentOcclusionQueryObjects:r}=t;if(i&&r){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await i.mapAsync(GPUMapMode.READ);const a=i.getMappedRange(),o=new BigUint64Array(a);for(let l=0;l<r.length;l++)o[l]===BigInt(0)&&s.add(r[l]);i.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:i,y:r,width:s,height:a,minDepth:o,maxDepth:l}=e.viewportValue;t.setViewport(i,r,s,a,o,l)}updateScissor(e){const{currentPass:t}=this.get(e),{x:i,y:r,width:s,height:a}=e.scissorValue;t.setScissorRect(i,r,s,a)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,i,r=null){const s=this.device,a=this.renderer;let o=[],l,u,c,d;if(e){const y=this.getClearColor();u={r:y.r,g:y.g,b:y.b,a:y.a}}if(r===null){c=a.depth,d=a.stencil;const y=this._getDefaultRenderPassDescriptor();if(e){o=y.colorAttachments;const _=o[0];_.clearValue=u,_.loadOp=vs.Clear,_.storeOp=Vu.Store}(c||d)&&(l=y.depthStencilAttachment)}else{c=r.depth,d=r.stencil;const y={loadOp:e?vs.Clear:vs.Load,clearValue:e?u:void 0};c&&(y.depthLoadOp=t?vs.Clear:vs.Load,y.depthClearValue=t?a.getClearDepth():void 0,y.depthStoreOp=Vu.Store),d&&(y.stencilLoadOp=i?vs.Clear:vs.Load,y.stencilClearValue=i?a.getClearStencil():void 0,y.stencilStoreOp=Vu.Store);const _=this._getRenderPassDescriptor(r,y);o=_.colorAttachments,l=_.depthStencilAttachment}c&&l&&(t?(l.depthLoadOp=vs.Clear,l.depthClearValue=a.getClearDepth(),l.depthStoreOp=Vu.Store):(l.depthLoadOp=vs.Load,l.depthStoreOp=Vu.Store)),d&&l&&(i?(l.stencilLoadOp=vs.Clear,l.stencilClearValue=a.getClearStencil(),l.stencilStoreOp=Vu.Store):(l.stencilLoadOp=vs.Load,l.stencilStoreOp=Vu.Store));const f=s.createCommandEncoder({label:"clear"});f.beginRenderPass({colorAttachments:o,depthStencilAttachment:l}).end(),s.queue.submit([f.finish()])}beginCompute(e){const t=this.get(e),i={label:"computeGroup_"+e.id};this.initTimestampQuery(Td.COMPUTE,this.getTimestampUID(e),i),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(i)}compute(e,t,i,r,s=null){const a=this.get(t),{passEncoderGPU:o}=this.get(e),l=this.get(r).pipeline;this.pipelineUtils.setPipeline(o,l);for(let u=0,c=i.length;u<c;u++){const d=i[u],f=this.get(d);o.setBindGroup(u,f.group)}if(s===null&&(s=t.count),s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute){const u=this.get(s).buffer;o.dispatchWorkgroupsIndirect(u,0);return}if(typeof s=="number"){const u=s;if(a.dispatchSize===void 0||a.count!==u){a.dispatchSize=[0,1,1],a.count=u;const c=t.workgroupSize;let d=c[0];for(let y=1;y<c.length;y++)d*=c[y];const f=Math.ceil(u/d),m=this.device.limits.maxComputeWorkgroupsPerDimension;s=[f,1,1],f>m&&(s[0]=Math.min(f,m),s[1]=Math.ceil(f/m)),a.dispatchSize=s}s=a.dispatchSize}o.dispatchWorkgroups(s[0],s[1]||1,s[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:i,material:r,context:s,pipeline:a}=e,o=e.getBindings(),l=this.get(s),u=this.get(a),c=u.pipeline;if(u.error===!0)return;const d=e.getIndex(),f=d!==null,m=e.getDrawParameters();if(m===null)return;const y=(S,b)=>{this.pipelineUtils.setPipeline(S,c),b.pipeline=c;const M=b.bindingGroups;for(let T=0,E=o.length;T<E;T++){const R=o[T],P=this.get(R);M[R.index]!==R.id&&(S.setBindGroup(R.index,P.group),M[R.index]=R.id)}if(f===!0&&b.index!==d){const T=this.get(d).buffer,E=d.array instanceof Uint16Array?CM.Uint16:CM.Uint32;S.setIndexBuffer(T,E),b.index=d}const w=e.getVertexBuffers();for(let T=0,E=w.length;T<E;T++){const R=w[T];if(b.attributes[T]!==R){const P=this.get(R).buffer;S.setVertexBuffer(T,P),b.attributes[T]=R}}s.stencil===!0&&r.stencilWrite===!0&&l.currentStencilRef!==r.stencilRef&&(S.setStencilReference(r.stencilRef),l.currentStencilRef=r.stencilRef)},_=(S,b)=>{if(y(S,b),i.isBatchedMesh===!0){const M=i._multiDrawStarts,w=i._multiDrawCounts,T=i._multiDrawCount,E=i._multiDrawInstances;E!==null&&hs("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let R=0;R<T;R++){const P=E?E[R]:1,I=P>1?0:R;f===!0?S.drawIndexed(w[R],P,M[R]/d.array.BYTES_PER_ELEMENT,0,I):S.draw(w[R],P,M[R],I),t.update(i,w[R],P)}}else if(f===!0){const{vertexCount:M,instanceCount:w,firstVertex:T}=m,E=e.getIndirect();if(E!==null){const R=this.get(E).buffer,P=e.getIndirectOffset(),I=Array.isArray(P)?P:[P];for(let B=0;B<I.length;B++)S.drawIndexedIndirect(R,I[B])}else S.drawIndexed(M,w,T,0,0);t.update(i,M,w)}else{const{vertexCount:M,instanceCount:w,firstVertex:T}=m,E=e.getIndirect();if(E!==null){const R=this.get(E).buffer,P=e.getIndirectOffset(),I=Array.isArray(P)?P:[P];for(let B=0;B<I.length;B++)S.drawIndirect(R,I[B])}else S.draw(M,w,T,0);t.update(i,M,w)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const S=this.get(e.camera),b=e.camera.cameras,M=e.getBindingGroup("cameraIndex");if(S.indexesGPU===void 0||S.indexesGPU.length!==b.length){const T=this.get(M),E=[],R=new Uint32Array([0,0,0,0]);for(let P=0,I=b.length;P<I;P++){R[0]=P;const{layoutGPU:B}=T.layout,N=this.bindingUtils.createBindGroupIndex(R,B);E.push(N)}S.indexesGPU=E}const w=this.renderer.getPixelRatio();for(let T=0,E=b.length;T<E;T++){const R=b[T];if(i.layers.test(R.layers)){const P=R.viewport;let I=l.currentPass,B=l.currentSets;if(l.bundleEncoders){const N=l.bundleEncoders[T],U=l.bundleSets[T];I=N,B=U}P&&I.setViewport(Math.floor(P.x*w),Math.floor(P.y*w),Math.floor(P.width*w),Math.floor(P.height*w),s.viewportValue.minDepth,s.viewportValue.maxDepth),M&&S.indexesGPU&&(I.setBindGroup(M.index,S.indexesGPU[T]),B.bindingGroups[M.index]=M.id),_(I,B)}}}else if(l.currentPass){if(l.occlusionQuerySet!==void 0){const S=l.lastOcclusionObject;S!==i&&(S!==null&&S.occlusionTest===!0&&(l.currentPass.endOcclusionQuery(),l.occlusionQueryIndex++),i.occlusionTest===!0&&(l.currentPass.beginOcclusionQuery(l.occlusionQueryIndex),l.occlusionQueryObjects[l.occlusionQueryIndex]=i),l.lastOcclusionObject=i)}_(l.currentPass,l.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:i,material:r}=e,s=this.utils,a=s.getSampleCountRenderContext(e.context),o=s.getCurrentColorSpace(e.context),l=s.getCurrentColorFormat(e.context),u=s.getCurrentDepthStencilFormat(e.context),c=s.getPrimitiveTopology(i,r);let d=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==a||t.colorSpace!==o||t.colorFormat!==l||t.depthStencilFormat!==u||t.primitiveTopology!==c||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=a,t.colorSpace=o,t.colorFormat=l,t.depthStencilFormat=u,t.primitiveTopology=c,t.clippingContextCacheKey=e.clippingContextCacheKey,d=!0),d}getRenderCacheKey(e){const{object:t,material:i}=e,r=this.utils,s=e.context,a=t.isMesh&&t.matrixWorld.determinant()<0;return[i.transparent,i.blending,i.premultipliedAlpha,i.blendSrc,i.blendDst,i.blendEquation,i.blendSrcAlpha,i.blendDstAlpha,i.blendEquationAlpha,i.colorWrite,i.depthWrite,i.depthTest,i.depthFunc,i.stencilWrite,i.stencilFunc,i.stencilFail,i.stencilZFail,i.stencilZPass,i.stencilFuncMask,i.stencilWriteMask,i.side,a,r.getSampleCountRenderContext(s),r.getCurrentColorSpace(s),r.getCurrentColorFormat(s),r.getCurrentDepthStencilFormat(s),r.getPrimitiveTopology(t,i),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,i,r,s,a){return this.textureUtils.copyTextureToBuffer(e,t,i,r,s,a)}initTimestampQuery(e,t,i){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new eXe(this.device,e,2048));const r=this.timestampQueryPool[e],s=r.allocateQueriesForContext(t);i.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new Z8e(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const i=this.get(e),s=i.currentPass.finish();this.get(t).bundleGPU=s,i.currentSets=i._currentSets,i.currentPass=i._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,i,r){this.bindingUtils.createBindings(e,t,i,r)}updateBindings(e,t,i,r){this.bindingUtils.createBindings(e,t,i,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}deleteBindGroupData(e){this.bindingUtils.deleteBindGroupData(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return MY[e]!==void 0&&(e=MY[e]),this.device.features.has(e)}copyTextureToTexture(e,t,i=null,r=null,s=0,a=0){let o=0,l=0,u=0,c=0,d=0,f=0,m=e.image.width,y=e.image.height,_=1;i!==null&&(i.isBox3===!0?(c=i.min.x,d=i.min.y,f=i.min.z,m=i.max.x-i.min.x,y=i.max.y-i.min.y,_=i.max.z-i.min.z):(c=i.min.x,d=i.min.y,m=i.max.x-i.min.x,y=i.max.y-i.min.y,_=1)),r!==null&&(o=r.x,l=r.y,u=r.z||0);const S=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),b=this.get(e).texture,M=this.get(t).texture;S.copyTextureToTexture({texture:b,mipLevel:s,origin:{x:c,y:d,z:f}},{texture:M,mipLevel:a,origin:{x:o,y:l,z:u}},[m,y,_]),this.device.queue.submit([S.finish()]),a===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,i){const r=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const a=this.get(e).texture;if(s.format!==a.format){Tt("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,a.format);return}let o;if(r.currentPass?(r.currentPass.end(),o=r.encoder):o=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),o.copyTextureToTexture({texture:s,origin:[i.x,i.y,0]},{texture:a},[i.z,i.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,o),r.currentPass){const{descriptor:l}=r;for(let u=0;u<l.colorAttachments.length;u++)l.colorAttachments[u].loadOp=vs.Load;t.depth&&(l.depthStencilAttachment.depthLoadOp=vs.Load),t.stencil&&(l.depthStencilAttachment.stencilLoadOp=vs.Load),r.currentPass=o.beginRenderPass(l),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([o.finish()])}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const e of this.occludedResolveCache.values())e.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const e of Object.values(this.timestampQueryPool))e!==null&&e.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class vle extends Bb{constructor(e,t,i,r,s,a){super(e,t,i,r,s,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class xle extends Bb{constructor(e,t,i,r,s,a){super(e,t,i,r,s,a),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class nXe extends rle{constructor(){super(),this.addMaterial(oae,"MeshPhongMaterial"),this.addMaterial($4,"MeshStandardMaterial"),this.addMaterial(J4,"MeshPhysicalMaterial"),this.addMaterial(Sae,"MeshToonMaterial"),this.addMaterial(sae,"MeshBasicMaterial"),this.addMaterial(aae,"MeshLambertMaterial"),this.addMaterial(eae,"MeshNormalMaterial"),this.addMaterial(Aae,"MeshMatcapMaterial"),this.addMaterial($se,"LineBasicMaterial"),this.addMaterial(Jse,"LineDashedMaterial"),this.addMaterial(Cae,"PointsMaterial"),this.addMaterial(q4,"SpriteMaterial"),this.addMaterial(wae,"ShadowMaterial"),this.addLight(Ioe,DR),this.addLight(Koe,NR),this.addLight($oe,SF),this.addLight(fL,Bb),this.addLight(Qoe,_F),this.addLight(ele,bF),this.addLight(tle,AF),this.addLight(Joe,vle),this.addLight(qoe,xle),this.addToneMapping(ioe,$E),this.addToneMapping(roe,JE),this.addToneMapping(soe,qE),this.addToneMapping(aoe,zM),this.addToneMapping(ooe,QE),this.addToneMapping(loe,eR)}}class ble extends a8e{constructor(e={}){let t;e.forceWebGL?t=yY:(t=tXe,e.getFallback=()=>(mt("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new yY(e)));const i=new t(e);super(i,e),this.library=new nXe,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}class iXe extends _h{constructor(){super(),this.isBundleGroup=!0,this.type="BundleGroup",this.static=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}}class rXe{constructor(e,t=Un(0,0,1,1)){this.renderer=e,this.outputNode=t,this.outputColorTransform=!0,this.needsUpdate=!0;const i=new Js;i.name="PostProcessing",this._quadMesh=new fA(i),this._quadMesh.name="Post-Processing",this._context=null}render(){const e=this.renderer;this._update(),this._context.onBeforePostProcessing!==null&&this._context.onBeforePostProcessing();const t=e.toneMapping,i=e.outputColorSpace;e.toneMapping=ho,e.outputColorSpace=di.workingColorSpace;const r=e.xr.enabled;e.xr.enabled=!1,this._quadMesh.render(e),e.xr.enabled=r,e.toneMapping=t,e.outputColorSpace=i,this._context.onAfterPostProcessing!==null&&this._context.onAfterPostProcessing()}get context(){return this._context}dispose(){this._quadMesh.material.dispose()}_update(){if(this.needsUpdate===!0){const e=this.renderer,t=e.toneMapping,i=e.outputColorSpace,r={postProcessing:this,onBeforePostProcessing:null,onAfterPostProcessing:null};let s=this.outputNode;this.outputColorTransform===!0?(s=s.context(r),s=v4(s,t,i)):(r.toneMapping=t,r.outputColorSpace=i,s=s.context(r)),this._context=r,this._quadMesh.material.fragmentNode=s,this._quadMesh.material.needsUpdate=!0,this.needsUpdate=!1}}async renderAsync(){hs('PostProcessing: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.renderer.init(),this.render()}}class sXe extends pr{constructor(e=1,t=1){super(),this.image={width:e,height:t},this.magFilter=Jn,this.minFilter=Jn,this.isStorageTexture=!0,this.mipmapsAutoUpdate=!0}setSize(e,t){(this.image.width!==e||this.image.height!==t)&&(this.image.width=e,this.image.height=t,this.dispose())}}class aXe extends pr{constructor(e=1,t=1,i=1){super(),this.isArrayTexture=!1,this.image={width:e,height:t,depth:i},this.magFilter=Jn,this.minFilter=Jn,this.wrapR=ps,this.isStorageTexture=!0,this.is3DTexture=!0}setSize(e,t,i){(this.image.width!==e||this.image.height!==t||this.image.depth!==i)&&(this.image.width=e,this.image.height=t,this.image.depth=i,this.dispose())}}class oXe extends pr{constructor(e=1,t=1,i=1){super(),this.isArrayTexture=!0,this.image={width:e,height:t,depth:i},this.magFilter=Jn,this.minFilter=Jn,this.isStorageTexture=!0}setSize(e,t,i){(this.image.width!==e||this.image.height!==t||this.image.depth!==i)&&(this.image.width=e,this.image.height=t,this.image.depth=i,this.dispose())}}class lXe extends sH{constructor(e,t){super(e,t,Uint32Array),this.isIndirectStorageBufferAttribute=!0}}class _le extends rl{constructor(e){super(e),this.textures={},this.nodes={}}load(e,t,i,r){const s=new el(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,a=>{try{t(this.parse(JSON.parse(a)))}catch(o){r?r(o):Tt(o),this.manager.itemError(e)}},i,r)}parseNodes(e){const t={};if(e!==void 0){for(const r of e){const{uuid:s,type:a}=r;t[s]=this.createNodeFromType(a),t[s].uuid=s}const i={nodes:t,textures:this.textures};for(const r of e)r.meta=i,t[r.uuid].deserialize(r),delete r.meta}return t}parse(e){const t=this.createNodeFromType(e.type);t.uuid=e.uuid;const r={nodes:this.parseNodes(e.nodes),textures:this.textures};return e.meta=r,t.deserialize(e),delete e.meta,t}setTextures(e){return this.textures=e,this}setNodes(e){return this.nodes=e,this}createNodeFromType(e){return this.nodes[e]===void 0?(Tt("NodeLoader: Node type not found:",e),ge()):new this.nodes[e]}}class Sle extends iA{constructor(e){super(e),this.nodes={},this.nodeMaterials={}}parse(e){const t=super.parse(e),i=this.nodes,r=e.inputNodes;for(const s in r){const a=r[s];t[s]=i[a]}return t}setNodes(e){return this.nodes=e,this}setNodeMaterials(e){return this.nodeMaterials=e,this}createMaterialFromType(e){const t=this.nodeMaterials[e];return t!==void 0?new t:super.createMaterialFromType(e)}}class uXe extends sV{constructor(e){super(e),this.nodes={},this.nodeMaterials={},this._nodesJSON=null}setNodes(e){return this.nodes=e,this}setNodeMaterials(e){return this.nodeMaterials=e,this}parse(e,t){this._nodesJSON=e.nodes;const i=super.parse(e,t);return this._nodesJSON=null,i}parseNodes(e,t){if(e!==void 0){const i=new _le;return i.setNodes(this.nodes),i.setTextures(t),i.parseNodes(e)}return{}}parseMaterials(e,t){const i={};if(e!==void 0){const r=this.parseNodes(this._nodesJSON,t),s=new Sle;s.setTextures(t),s.setNodes(r),s.setNodeMaterials(this.nodeMaterials);for(let a=0,o=e.length;a<o;a++){const l=e[a];i[l.uuid]=s.parse(l)}}return i}}class cXe extends _h{constructor(){super(),this.isClippingGroup=!0,this.clippingPlanes=[],this.enabled=!0,this.clipIntersection=!1,this.clipShadows=!1}}const hXe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:zM,AONode:Gse,AddEquation:vl,AddOperation:H2,AdditiveAnimationBlendMode:W2,AdditiveBlending:bm,AgXToneMapping:QE,AlphaFormat:tR,AlwaysCompare:oR,AlwaysDepth:hv,AlwaysStencilFunc:Xw,AmbientLight:_F,AmbientLightNode:Qoe,AnalyticLightNode:i1,AnimationAction:fV,AnimationClip:db,AnimationLoader:yte,AnimationMixer:Mte,AnimationObjectGroup:Ste,AnimationUtils:gte,ArcCurve:X9,ArrayCamera:CF,ArrayElementNode:Qv,ArrayNode:ak,ArrowHelper:Hte,AssignNode:Wne,AttachedBindMode:TB,AttributeNode:b4,Audio:lV,AudioAnalyser:_te,AudioContext:TF,AudioListener:oV,AudioLoader:xte,AxesHelper:Xte,BackSide:Er,BasicDepthPacking:sp,BasicEnvironmentNode:qF,BasicShadowMap:UE,BatchNode:Pse,BatchedMesh:z9,BitcastNode:hA,Bone:fR,BooleanKeyframeTrack:$v,Box2:Pte,Box3:Ns,Box3Helper:zte,BoxGeometry:Id,BoxHelper:kte,BufferAttribute:Gi,BufferAttributeNode:Bg,BufferGeometry:wi,BufferGeometryLoader:rV,BufferNode:ZF,BumpMapNode:$re,BundleGroup:iXe,BypassNode:ore,ByteType:am,Cache:Uf,Camera:Eb,CameraHelper:Ute,CanvasTarget:ale,CanvasTexture:V9,CapsuleGeometry:gR,CatmullRomCurve3:Z9,CineonToneMapping:qE,CircleGeometry:yR,ClampToEdgeWrapping:ps,ClippingGroup:cXe,Clock:BR,CodeNode:Qo,Color:en,ColorKeyframeTrack:vF,ColorManagement:di,ColorSpaceNode:HF,CompressedArrayTexture:ute,CompressedCubeTexture:cte,CompressedTexture:mR,CompressedTextureLoader:vte,ComputeNode:ire,ConeGeometry:qM,ConstNode:Bh,ConstantAlphaFactor:f9,ConstantColorFactor:h9,ContextNode:h4,Controls:Zte,ConvertNode:PV,CubeCamera:J2,CubeDepthTexture:iF,CubeReflectionMapping:_u,CubeRefractionMapping:wh,CubeTexture:T0,CubeTextureLoader:tV,CubeTextureNode:Lre,CubeUVReflectionMapping:Am,CubicBezierCurve:sF,CubicBezierCurve3:j9,CubicInterpolant:q9,CullFaceBack:Uw,CullFaceFront:U2,CullFaceFrontBack:Bee,CullFaceNone:O2,Curve:jd,CurvePath:K9,CustomBlending:nv,CustomToneMapping:X2,CylinderGeometry:Pb,Cylindrical:Rte,Data3DTexture:lR,DataArrayTexture:ZM,DataTexture:xu,DataTextureLoader:xF,DataUtils:Xy,DebugNode:fre,DecrementStencilOp:T9,DecrementWrapStencilOp:w9,DefaultLoadingManager:Sx,DepthFormat:Xo,DepthStencilFormat:bl,DepthTexture:po,DetachedBindMode:m9,DirectionalLight:NR,DirectionalLightHelper:Ote,DirectionalLightNode:Koe,DiscreteInterpolant:Q9,DodecahedronGeometry:vR,DoubleSide:fr,DstAlphaFactor:WE,DstColorFactor:jE,DynamicCopyUsage:Wee,DynamicDrawUsage:bh,DynamicReadUsage:Vee,EdgesGeometry:H9,EllipseCurve:xR,EnvironmentNode:_ae,EqualCompare:rR,EqualDepth:qx,EqualStencilFunc:D9,EquirectangularReflectionMapping:Mm,EquirectangularRefractionMapping:h0,Euler:Mu,EventDispatcher:wl,EventNode:Qu,ExpressionNode:gw,ExternalTexture:rF,ExtrudeGeometry:bR,FileLoader:el,Float16BufferAttribute:$2,Float32BufferAttribute:qn,FloatType:wr,Fog:YM,FogExp2:hR,FramebufferTexture:pR,FrontFacingNode:Are,FrontSide:wo,Frustum:Kv,FrustumArray:$M,FunctionCallNode:jne,FunctionNode:oH,FunctionOverloadingNode:Uae,GLBufferAttribute:wte,GLSL1:jee,GLSL3:CB,GLSLNodeParser:ile,GreaterCompare:sR,GreaterDepth:eb,GreaterEqualCompare:wb,GreaterEqualDepth:Qx,GreaterEqualStencilFunc:L9,GreaterStencilFunc:B9,GridHelper:Ite,Group:_h,HalfFloatType:zi,HemisphereLight:bF,HemisphereLightHelper:Lte,HemisphereLightNode:ele,IESSpotLight:vle,IESSpotLightNode:Joe,IcosahedronGeometry:QM,ImageBitmapLoader:aV,ImageLoader:bM,ImageUtils:O9,IncrementStencilOp:A9,IncrementWrapStencilOp:C9,IndexNode:aa,IndirectStorageBufferAttribute:lXe,InspectorBase:x4,InstanceNode:I4,InstancedBufferAttribute:Vc,InstancedBufferGeometry:iV,InstancedInterleavedBuffer:pV,InstancedMesh:Q2,InstancedMeshNode:Ese,Int16BufferAttribute:rte,Int32BufferAttribute:ste,Int8BufferAttribute:tte,IntType:Ao,InterleavedBuffer:Rb,InterleavedBufferAttribute:Tm,Interpolant:Nb,InterpolateDiscrete:ab,InterpolateLinear:ob,InterpolateSmooth:aw,InterpolationSamplingMode:Kee,InterpolationSamplingType:Yee,InvertStencilOp:E9,IrradianceNode:kse,IsolateNode:sre,JoinNode:Dne,KeepStencilOp:Og,KeyframeTrack:Nh,LOD:k9,LatheGeometry:_R,Layers:cb,LessCompare:Tb,LessDepth:Jx,LessEqualCompare:Cb,LessEqualDepth:_m,LessEqualStencilFunc:N9,LessStencilFunc:P9,Light:w0,LightProbe:AF,LightProbeNode:tle,Lighting:sle,LightingContextNode:Ose,LightingModel:cA,LightingNode:Gb,LightsNode:uL,Line:Cm,Line2NodeMaterial:dke,Line3:Hc,LineBasicMaterial:El,LineBasicNodeMaterial:$se,LineCurve:aF,LineCurve3:Y9,LineDashedMaterial:RR,LineDashedNodeMaterial:Jse,LineLoop:eF,LineSegments:Zd,LinearFilter:Jn,LinearInterpolant:yF,LinearMipMapLinearFilter:kw,LinearMipMapNearestFilter:Iee,LinearMipmapLinearFilter:Vo,LinearMipmapNearestFilter:sm,LinearSRGBColorSpace:Su,LinearToneMapping:$E,LinearTransfer:Iv,Loader:rl,LoaderUtils:Qg,LoadingManager:PR,LoopNode:Bse,LoopOnce:y9,LoopPingPong:x9,LoopRepeat:v9,MOUSE:Ly,MRTNode:Lae,Material:_a,MaterialLoader:iA,MaterialNode:Lt,MaterialReferenceNode:Ire,MathUtils:Wl,Matrix2:rA,Matrix3:Li,Matrix4:Mn,MaxEquation:z2,MaxMipLevelNode:yre,MemberNode:Bne,Mesh:Fr,MeshBasicMaterial:La,MeshBasicNodeMaterial:sae,MeshDepthMaterial:pF,MeshDistanceMaterial:mF,MeshLambertMaterial:tA,MeshLambertNodeMaterial:aae,MeshMatcapMaterial:gF,MeshMatcapNodeMaterial:Aae,MeshNormalMaterial:ER,MeshNormalNodeMaterial:eae,MeshPhongMaterial:dF,MeshPhongNodeMaterial:oae,MeshPhysicalMaterial:Kc,MeshPhysicalNodeMaterial:J4,MeshSSSNodeMaterial:hze,MeshStandardMaterial:mo,MeshStandardNodeMaterial:$4,MeshToonMaterial:fF,MeshToonNodeMaterial:Sae,MinEquation:k2,MirroredRepeatWrapping:jf,MixOperation:V2,ModelNode:Ph,MorphNode:Lse,MultiplyBlending:c0,MultiplyOperation:Sb,NearestFilter:xr,NearestMipMapLinearFilter:Lee,NearestMipMapNearestFilter:Fee,NearestMipmapLinearFilter:xh,NearestMipmapNearestFilter:Mb,NeutralToneMapping:eR,NeverCompare:iR,NeverDepth:$x,NeverStencilFunc:R9,NoBlending:Oa,NoColorSpace:xl,NoNormalPacking:ow,NoToneMapping:ho,Node:Wn,NodeAccess:Ml,NodeAttribute:Mk,NodeBuilder:SH,NodeCache:$N,NodeCode:Yoe,NodeFrame:Ak,NodeFunctionInput:dL,NodeLoader:_le,NodeMaterial:Js,NodeMaterialLoader:Sle,NodeMaterialObserver:wne,NodeObjectLoader:uXe,NodeShaderStage:zS,NodeType:Pne,NodeUniform:Zoe,NodeUpdateType:Ni,NodeUtils:fUe,NodeVar:_H,NodeVarying:joe,NormalAnimationBlendMode:nR,NormalBlending:Al,NormalGAPacking:_9,NormalMapNode:Kre,NormalRGPacking:Y2,NotEqualCompare:aR,NotEqualDepth:tb,NotEqualStencilFunc:F9,NumberKeyframeTrack:Ov,Object3D:Br,Object3DNode:Cr,ObjectLoader:sV,ObjectSpaceNormalMap:j2,OctahedronGeometry:eA,OneFactor:VE,OneMinusConstantAlphaFactor:p9,OneMinusConstantColorFactor:d9,OneMinusDstAlphaFactor:ZE,OneMinusDstColorFactor:YE,OneMinusSrcAlphaFactor:Kx,OneMinusSrcColorFactor:XE,OrthographicCamera:Tl,OutputStructNode:tH,PCFShadowMap:tv,PCFSoftShadowMap:YS,PMREMGenerator:xae,PMREMNode:bae,ParameterNode:eH,PassNode:qf,Path:Zw,PerspectiveCamera:ds,PhongLightingModel:W4,PhysicalLightingModel:eL,Plane:Xl,PlaneGeometry:ap,PlaneHelper:Vte,PointLight:DR,PointLightHelper:Fte,PointLightNode:Ioe,PointUVNode:Zae,Points:tF,PointsMaterial:JM,PointsNodeMaterial:Cae,PolarGridHelper:Gte,PolyhedronGeometry:C0,PositionalAudio:uV,PostProcessing:rXe,PosterizeNode:eoe,ProjectorLight:xle,ProjectorLightNode:qoe,PropertyBinding:Jr,PropertyMixer:cV,PropertyNode:ss,QuadMesh:fA,QuadraticBezierCurve:oF,QuadraticBezierCurve3:lF,Quaternion:ba,QuaternionKeyframeTrack:Uv,QuaternionLinearInterpolant:eV,R11_EAC_Format:mv,RED_GREEN_RGTC2_Format:f0,RED_RGTC1_Format:Bv,REVISION:Xd,RG11_EAC_Format:d0,RGBADepthPacking:Gee,RGBAFormat:Vr,RGBAIntegerFormat:Yv,RGBA_ASTC_10x10_Format:Rv,RGBA_ASTC_10x5_Format:Cv,RGBA_ASTC_10x6_Format:wv,RGBA_ASTC_10x8_Format:Ev,RGBA_ASTC_12x10_Format:Pv,RGBA_ASTC_12x12_Format:Dv,RGBA_ASTC_4x4_Format:vv,RGBA_ASTC_5x4_Format:xv,RGBA_ASTC_5x5_Format:bv,RGBA_ASTC_6x5_Format:_v,RGBA_ASTC_6x6_Format:Sv,RGBA_ASTC_8x5_Format:Mv,RGBA_ASTC_8x6_Format:Av,RGBA_ASTC_8x8_Format:Tv,RGBA_BPTC_Format:Nv,RGBA_ETC2_EAC_Format:pv,RGBA_PVRTC_2BPPV1_Format:sb,RGBA_PVRTC_4BPPV1_Format:rb,RGBA_S3TC_DXT1_Format:um,RGBA_S3TC_DXT3_Format:cm,RGBA_S3TC_DXT5_Format:hm,RGBDepthPacking:Oee,RGBFormat:Ab,RGBIntegerFormat:g9,RGB_BPTC_SIGNED_Format:zw,RGB_BPTC_UNSIGNED_Format:Vw,RGB_ETC1_Format:dv,RGB_ETC2_Format:fv,RGB_PVRTC_2BPPV1_Format:ib,RGB_PVRTC_4BPPV1_Format:nb,RGB_S3TC_DXT1_Format:lm,RGDepthPacking:Uee,RGFormat:_l,RGIntegerFormat:jv,RTTNode:Hae,RangeNode:poe,RawShaderMaterial:hF,Ray:Im,Raycaster:FR,RectAreaLight:SF,RectAreaLightNode:$oe,RedFormat:rp,RedIntegerFormat:A0,ReferenceNode:OR,ReflectorNode:iL,ReinhardToneMapping:JE,RemapNode:y4,RenderOutputNode:dre,RenderTarget:Wd,RenderTarget3D:Ate,RendererReferenceNode:qie,RendererUtils:M4e,RepeatWrapping:Xc,ReplaceStencilOp:M9,ReverseSubtractEquation:zE,RingGeometry:SR,RotateNode:Tae,SIGNED_R11_EAC_Format:gv,SIGNED_RED_GREEN_RGTC2_Format:Lv,SIGNED_RED_RGTC1_Format:Fv,SIGNED_RG11_EAC_Format:yv,SRGBColorSpace:Ps,SRGBTransfer:Hn,Scene:Wc,SceneNode:ec,ScreenNode:ks,ScriptableNode:doe,ScriptableValueNode:coe,SetNode:Nne,ShaderMaterial:Ds,ShadowBaseNode:yoe,ShadowMaterial:cF,ShadowNode:yH,ShadowNodeMaterial:wae,Shape:iv,ShapeGeometry:MR,ShapePath:Wte,ShapeUtils:Cd,ShortType:om,Skeleton:KM,SkeletonHelper:Nte,SkinnedMesh:q2,SkinningNode:G4,Source:Zg,Sphere:fo,SphereGeometry:Db,Spherical:$w,SphericalHarmonics3:MF,SplineCurve:uF,SplitNode:DV,SpotLight:Bb,SpotLightHelper:Dte,SpotLightNode:fL,Sprite:U9,SpriteMaterial:dR,SpriteNodeMaterial:q4,SpriteSheetUVNode:zae,SrcAlphaFactor:Yx,SrcAlphaSaturateFactor:KE,SrcColorFactor:HE,StackNode:Dae,StaticCopyUsage:Xee,StaticDrawUsage:p0,StaticReadUsage:zee,StereoCamera:bte,Storage3DTexture:aXe,StorageArrayElementNode:Ase,StorageArrayTexture:oXe,StorageBufferAttribute:sH,StorageBufferNode:Tse,StorageInstancedBufferAttribute:Wae,StorageTexture:sXe,StorageTextureNode:Kae,StreamCopyUsage:Zee,StreamDrawUsage:kee,StreamReadUsage:Hee,StringKeyframeTrack:Jv,StructNode:Bae,StructTypeNode:Nae,SubBuildNode:Wie,SubtractEquation:kE,SubtractiveBlending:u0,TOUCH:Iy,TSL:Z,TangentSpaceNormalMap:Fd,TempNode:Ca,TetrahedronGeometry:AR,Texture:pr,Texture3DNode:Jae,TextureLoader:nA,TextureNode:$f,TextureSizeNode:gre,TextureUtils:jte,Timer:Ete,TimestampQuery:Td,ToneMappingNode:ere,ToonOutlinePassNode:noe,TorusGeometry:TR,TorusKnotGeometry:CR,Triangle:Vs,TriangleFanDrawMode:Hw,TriangleStripDrawMode:Z2,TrianglesDrawMode:b9,TubeGeometry:wR,UVMapping:Sm,Uint16BufferAttribute:uR,Uint32BufferAttribute:cR,Uint8BufferAttribute:nte,Uint8ClampedBufferAttribute:ite,Uniform:mi,UniformArrayNode:vre,UniformGroupNode:ZV,UniformNode:lA,UniformsGroup:Cte,UnsignedByteType:br,UnsignedInt101111Type:WM,UnsignedInt248Type:jl,UnsignedInt5999Type:XM,UnsignedIntType:qr,UnsignedShort4444Type:VM,UnsignedShort5551Type:HM,UnsignedShortType:zc,UserDataNode:qae,VSMShadowMap:Ad,VarNode:mw,VaryingNode:Zie,Vector2:rt,Vector3:re,Vector4:si,VectorKeyframeTrack:kv,VertexColorNode:Hse,VideoFrameTexture:lte,VideoTexture:nF,ViewportDepthNode:qu,ViewportDepthTextureNode:zse,ViewportSharedTextureNode:qse,ViewportTextureNode:kR,VolumeNodeMaterial:Mze,WebGL3DRenderTarget:Qee,WebGLArrayRenderTarget:qee,WebGLCoordinateSystem:Sl,WebGLCubeRenderTarget:jM,WebGLRenderTarget:Nr,WebGPUCoordinateSystem:ic,WebGPURenderer:ble,WebXRController:$S,WireframeGeometry:$9,WrapAroundEnding:mM,ZeroCurvatureEnding:Vy,ZeroFactor:Bf,ZeroSlopeEnding:Hy,ZeroStencilOp:S9,createCanvasElement:K2,defaultBuildStages:IB,defaultShaderStages:RV,error:Tt,getConsoleFunction:Jee,log:lb,setConsoleFunction:$ee,shaderStages:GB,vectorComponents:qv,warn:mt,warnOnce:hs},Symbol.toStringTag,{value:"Module"}));function dXe({children:n}){return $.jsx(Cne,{gl:async e=>{const t=new ble({...e,antialias:!0,alpha:!1});return t.shadowMap.enabled=!0,t.shadowMap.type=UE,await t.init(),t},children:n})}var QO={exports:{}};var EY;function fXe(){return EY||(EY=1,(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var s="",a=0;a<arguments.length;a++){var o=arguments[a];o&&(s=r(s,i(o)))}return s}function i(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return t.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var a="";for(var o in s)e.call(s,o)&&s[o]&&(a=r(a,o));return a}function r(s,a){return a?s?s+" "+a:s+a:s}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(QO)),QO.exports}var pXe=fXe();const Mle=_0(pXe),mXe=["xxl","xl","lg","md","sm","xs"],gXe="xs",Ale=G.createContext({prefixes:{},breakpoints:mXe,minBreakpoint:gXe}),{Consumer:agt,Provider:ogt}=Ale;function yXe(n,e){const{prefixes:t}=G.useContext(Ale);return n||t[e]||e}function vXe(n,e){let t=0;return G.Children.map(n,i=>G.isValidElement(i)?e(i,t++):i)}const RY=1e3;function xXe(n,e,t){const i=(n-e)/(t-e)*100;return Math.round(i*RY)/RY}function PY({min:n,now:e,max:t,label:i,visuallyHidden:r,striped:s,animated:a,className:o,style:l,variant:u,bsPrefix:c,...d},f){return $.jsx("div",{ref:f,...d,role:"progressbar",className:Mle(o,`${c}-bar`,{[`bg-${u}`]:u,[`${c}-bar-animated`]:a,[`${c}-bar-striped`]:a||s}),style:{width:`${xXe(e,n,t)}%`,...l},"aria-valuenow":e,"aria-valuemin":n,"aria-valuemax":t,children:r?$.jsx("span",{className:"visually-hidden",children:i}):i})}const Tle=G.forwardRef(({isChild:n=!1,...e},t)=>{const i={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...e};if(i.bsPrefix=yXe(i.bsPrefix,"progress"),n)return PY(i,t);const{min:r,now:s,max:a,label:o,visuallyHidden:l,striped:u,animated:c,bsPrefix:d,variant:f,className:m,children:y,..._}=i;return $.jsx("div",{ref:t,..._,className:Mle(m,d),children:y?vXe(y,S=>G.cloneElement(S,{isChild:!0})):PY({min:r,now:s,max:a,label:o,visuallyHidden:l,striped:u,animated:c,bsPrefix:d,variant:f},t)})});Tle.displayName="ProgressBar";function Ta(){return Ta=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Ta.apply(null,arguments)}const WR=new re,AH=new re,bXe=new re,DY=new rt;function _Xe(n,e,t){const i=WR.setFromMatrixPosition(n.matrixWorld);i.project(e);const r=t.width/2,s=t.height/2;return[i.x*r+r,-(i.y*s)+s]}function SXe(n,e){const t=WR.setFromMatrixPosition(n.matrixWorld),i=AH.setFromMatrixPosition(e.matrixWorld),r=t.sub(i),s=e.getWorldDirection(bXe);return r.angleTo(s)>Math.PI/2}function MXe(n,e,t,i){const r=WR.setFromMatrixPosition(n.matrixWorld),s=r.clone();s.project(e),DY.set(s.x,s.y),t.setFromCamera(DY,e);const a=t.intersectObjects(i,!0);if(a.length){const o=a[0].distance;return r.distanceTo(t.ray.origin)<o}return!0}function AXe(n,e){if(e instanceof Tl)return e.zoom;if(e instanceof ds){const t=WR.setFromMatrixPosition(n.matrixWorld),i=AH.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=t.distanceTo(i);return 1/(2*Math.tan(r/2)*s)}else return 1}function TXe(n,e,t){if(e instanceof ds||e instanceof Tl){const i=WR.setFromMatrixPosition(n.matrixWorld),r=AH.setFromMatrixPosition(e.matrixWorld),s=i.distanceTo(r),a=(t[1]-t[0])/(e.far-e.near),o=t[1]-a*e.far;return Math.round(a*s+o)}}const Ek=n=>Math.abs(n)<1e-10?0:n;function Cle(n,e,t=""){let i="matrix3d(";for(let r=0;r!==16;r++)i+=Ek(e[r]*n.elements[r])+(r!==15?",":")");return t+i}const CXe=(n=>e=>Cle(e,n))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),wXe=(n=>(e,t)=>Cle(e,n(t),"translate(-50%,-50%)"))(n=>[1/n,1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1]);function EXe(n){return n&&typeof n=="object"&&"current"in n}const TH=G.forwardRef(({children:n,eps:e=.001,style:t,className:i,prepend:r,center:s,fullscreen:a,portal:o,distanceFactor:l,sprite:u=!1,transform:c=!1,occlude:d,onOcclude:f,castShadow:m,receiveShadow:y,material:_,geometry:S,zIndexRange:b=[16777271,0],calculatePosition:M=_Xe,as:w="div",wrapperClass:T,pointerEvents:E="auto",...R},P)=>{const{gl:I,camera:B,scene:N,size:U,raycaster:V,events:W,viewport:K}=ir(),[q]=G.useState(()=>document.createElement(w)),j=G.useRef(null),te=G.useRef(null),he=G.useRef(0),_e=G.useRef([0,0]),Be=G.useRef(null),ue=G.useRef(null),ce=o?.current||W.connected||I.domElement.parentNode,Ce=G.useRef(null),Oe=G.useRef(!1),nt=G.useMemo(()=>d&&d!=="blending"||Array.isArray(d)&&d.length&&EXe(d[0]),[d]);G.useLayoutEffect(()=>{const ot=I.domElement;d&&d==="blending"?(ot.style.zIndex=`${Math.floor(b[0]/2)}`,ot.style.position="absolute",ot.style.pointerEvents="none"):(ot.style.zIndex=null,ot.style.position=null,ot.style.pointerEvents=null)},[d]),G.useLayoutEffect(()=>{if(te.current){const ot=j.current=Uz.createRoot(q);if(N.updateMatrixWorld(),c)q.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const ut=M(te.current,B,U);q.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${ut[0]}px,${ut[1]}px,0);transform-origin:0 0;`}return ce&&(r?ce.prepend(q):ce.appendChild(q)),()=>{ce&&ce.removeChild(q),ot.unmount()}}},[ce,c]),G.useLayoutEffect(()=>{T&&(q.className=T)},[T]);const Ae=G.useMemo(()=>c?{position:"absolute",top:0,left:0,width:U.width,height:U.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...a&&{top:-U.height/2,left:-U.width/2,width:U.width,height:U.height},...t},[t,s,a,U,c]),Ye=G.useMemo(()=>({position:"absolute",pointerEvents:E}),[E]);G.useLayoutEffect(()=>{if(Oe.current=!1,c){var ot;(ot=j.current)==null||ot.render(G.createElement("div",{ref:Be,style:Ae},G.createElement("div",{ref:ue,style:Ye},G.createElement("div",{ref:P,className:i,style:t,children:n}))))}else{var ut;(ut=j.current)==null||ut.render(G.createElement("div",{ref:P,style:Ae,className:i,children:n}))}});const ft=G.useRef(!0);rs(ot=>{if(te.current){B.updateMatrixWorld(),te.current.updateWorldMatrix(!0,!1);const ut=c?_e.current:M(te.current,B,U);if(c||Math.abs(he.current-B.zoom)>e||Math.abs(_e.current[0]-ut[0])>e||Math.abs(_e.current[1]-ut[1])>e){const Wt=SXe(te.current,B);let It=!1;nt&&(Array.isArray(d)?It=d.map(yt=>yt.current):d!=="blending"&&(It=[N]));const ke=ft.current;if(It){const yt=MXe(te.current,B,V,It);ft.current=yt&&!Wt}else ft.current=!Wt;ke!==ft.current&&(f?f(!ft.current):q.style.display=ft.current?"block":"none");const je=Math.floor(b[0]/2),gt=d?nt?[b[0],je]:[je-1,0]:b;if(q.style.zIndex=`${TXe(te.current,B,gt)}`,c){const[yt,ve]=[U.width/2,U.height/2],An=B.projectionMatrix.elements[5]*ve,{isOrthographicCamera:cn,top:In,left:Zt,bottom:le,right:ee}=B,Re=CXe(B.matrixWorldInverse),tt=cn?`scale(${An})translate(${Ek(-(ee+Zt)/2)}px,${Ek((In+le)/2)}px)`:`translateZ(${An}px)`;let et=te.current.matrixWorld;u&&(et=B.matrixWorldInverse.clone().transpose().copyPosition(et).scale(te.current.scale),et.elements[3]=et.elements[7]=et.elements[11]=0,et.elements[15]=1),q.style.width=U.width+"px",q.style.height=U.height+"px",q.style.perspective=cn?"":`${An}px`,Be.current&&ue.current&&(Be.current.style.transform=`${tt}${Re}translate(${yt}px,${ve}px)`,ue.current.style.transform=wXe(et,1/((l||10)/400)))}else{const yt=l===void 0?1:AXe(te.current,B)*l;q.style.transform=`translate3d(${ut[0]}px,${ut[1]}px,0) scale(${yt})`}_e.current=ut,he.current=B.zoom}}if(!nt&&Ce.current&&!Oe.current)if(c){if(Be.current){const ut=Be.current.children[0];if(ut!=null&&ut.clientWidth&&ut!=null&&ut.clientHeight){const{isOrthographicCamera:Wt}=B;if(Wt||S)R.scale&&(Array.isArray(R.scale)?R.scale instanceof re?Ce.current.scale.copy(R.scale.clone().divideScalar(1)):Ce.current.scale.set(1/R.scale[0],1/R.scale[1],1/R.scale[2]):Ce.current.scale.setScalar(1/R.scale));else{const It=(l||10)/400,ke=ut.clientWidth*It,je=ut.clientHeight*It;Ce.current.scale.set(ke,je,1)}Oe.current=!0}}}else{const ut=q.children[0];if(ut!=null&&ut.clientWidth&&ut!=null&&ut.clientHeight){const Wt=1/K.factor,It=ut.clientWidth*Wt,ke=ut.clientHeight*Wt;Ce.current.scale.set(It,ke,1),Oe.current=!0}Ce.current.lookAt(ot.camera.position)}});const ze=G.useMemo(()=>({vertexShader:c?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[c]);return G.createElement("group",Ta({},R,{ref:te}),d&&!nt&&G.createElement("mesh",{castShadow:m,receiveShadow:y,ref:Ce},S||G.createElement("planeGeometry",null),_||G.createElement("shaderMaterial",{side:fr,vertexShader:ze.vertexShader,fragmentShader:ze.fragmentShader})))}),RXe=n=>n;function PXe(n,e=RXe){const t=Ie.useSyncExternalStore(n.subscribe,Ie.useCallback(()=>e(n.getState()),[n,e]),Ie.useCallback(()=>e(n.getInitialState()),[n,e]));return Ie.useDebugValue(t),t}const NY=n=>{const e=tne(n),t=i=>PXe(e,i);return Object.assign(t,e),t},DXe=(n=>n?NY(n):NY);let xC=0;const NXe=DXe(n=>(Sx.onStart=(e,t,i)=>{n({active:!0,item:e,loaded:t,total:i,progress:(t-xC)/(i-xC)*100})},Sx.onLoad=()=>{n({active:!1})},Sx.onError=e=>n(t=>({errors:[...t.errors,e]})),Sx.onProgress=(e,t,i)=>{t===i&&(xC=i),n({active:!0,item:e,loaded:t,total:i,progress:(t-xC)/(i-xC)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),CH=parseInt(Xd.replace(/\D+/g,""));function BY(n,e){if(e===b9)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Hw||e===Z2){let t=n.getIndex();if(t===null){const a=[],o=n.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);n.setIndex(a),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,r=[];if(t)if(e===Hw)for(let a=1;a<=i;a++)r.push(t.getX(0)),r.push(t.getX(a)),r.push(t.getX(a+1));else for(let a=0;a<i;a++)a%2===0?(r.push(t.getX(a)),r.push(t.getX(a+1)),r.push(t.getX(a+2))):(r.push(t.getX(a+2)),r.push(t.getX(a+1)),r.push(t.getX(a)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}var bd=Uint8Array,Yy=Uint16Array,Rk=Uint32Array,wle=new bd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ele=new bd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),BXe=new bd([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rle=function(n,e){for(var t=new Yy(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var r=new Rk(t[30]),i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)r[s]=s-t[i]<<5|i;return[t,r]},Ple=Rle(wle,2),Dle=Ple[0],FXe=Ple[1];Dle[28]=258,FXe[258]=28;var LXe=Rle(Ele,0),IXe=LXe[0],Pk=new Yy(32768);for(var xa=0;xa<32768;++xa){var My=(xa&43690)>>>1|(xa&21845)<<1;My=(My&52428)>>>2|(My&13107)<<2,My=(My&61680)>>>4|(My&3855)<<4,Pk[xa]=((My&65280)>>>8|(My&255)<<8)>>>1}var _w=(function(n,e,t){for(var i=n.length,r=0,s=new Yy(e);r<i;++r)++s[n[r]-1];var a=new Yy(e);for(r=0;r<e;++r)a[r]=a[r-1]+s[r-1]<<1;var o;if(t){o=new Yy(1<<e);var l=15-e;for(r=0;r<i;++r)if(n[r])for(var u=r<<4|n[r],c=e-n[r],d=a[n[r]-1]++<<c,f=d|(1<<c)-1;d<=f;++d)o[Pk[d]>>>l]=u}else for(o=new Yy(i),r=0;r<i;++r)n[r]&&(o[r]=Pk[a[n[r]-1]++]>>>15-n[r]);return o}),ZR=new bd(288);for(var xa=0;xa<144;++xa)ZR[xa]=8;for(var xa=144;xa<256;++xa)ZR[xa]=9;for(var xa=256;xa<280;++xa)ZR[xa]=7;for(var xa=280;xa<288;++xa)ZR[xa]=8;var Nle=new bd(32);for(var xa=0;xa<32;++xa)Nle[xa]=5;var GXe=_w(ZR,9,1),OXe=_w(Nle,5,1),eU=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},Cf=function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},tU=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},UXe=function(n){return(n/8|0)+(n&7&&1)},kXe=function(n,e,t){(t==null||t>n.length)&&(t=n.length);var i=new(n instanceof Yy?Yy:n instanceof Rk?Rk:bd)(t-e);return i.set(n.subarray(e,t)),i},zXe=function(n,e,t){var i=n.length;if(!i||t&&!t.l&&i<5)return e||new bd(0);var r=!e||t,s=!t||t.i;t||(t={}),e||(e=new bd(i*3));var a=function(Ae){var Ye=e.length;if(Ae>Ye){var ft=new bd(Math.max(Ye*2,Ae));ft.set(e),e=ft}},o=t.f||0,l=t.p||0,u=t.b||0,c=t.l,d=t.d,f=t.m,m=t.n,y=i*8;do{if(!c){t.f=o=Cf(n,l,1);var _=Cf(n,l+1,3);if(l+=3,_)if(_==1)c=GXe,d=OXe,f=9,m=5;else if(_==2){var w=Cf(n,l,31)+257,T=Cf(n,l+10,15)+4,E=w+Cf(n,l+5,31)+1;l+=14;for(var R=new bd(E),P=new bd(19),I=0;I<T;++I)P[BXe[I]]=Cf(n,l+I*3,7);l+=T*3;for(var B=eU(P),N=(1<<B)-1,U=_w(P,B,1),I=0;I<E;){var V=U[Cf(n,l,N)];l+=V&15;var S=V>>>4;if(S<16)R[I++]=S;else{var W=0,K=0;for(S==16?(K=3+Cf(n,l,3),l+=2,W=R[I-1]):S==17?(K=3+Cf(n,l,7),l+=3):S==18&&(K=11+Cf(n,l,127),l+=7);K--;)R[I++]=W}}var q=R.subarray(0,w),j=R.subarray(w);f=eU(q),m=eU(j),c=_w(q,f,1),d=_w(j,m,1)}else throw"invalid block type";else{var S=UXe(l)+4,b=n[S-4]|n[S-3]<<8,M=S+b;if(M>i){if(s)throw"unexpected EOF";break}r&&a(u+b),e.set(n.subarray(S,M),u),t.b=u+=b,t.p=l=M*8;continue}if(l>y){if(s)throw"unexpected EOF";break}}r&&a(u+131072);for(var te=(1<<f)-1,he=(1<<m)-1,_e=l;;_e=l){var W=c[tU(n,l)&te],Be=W>>>4;if(l+=W&15,l>y){if(s)throw"unexpected EOF";break}if(!W)throw"invalid length/literal";if(Be<256)e[u++]=Be;else if(Be==256){_e=l,c=null;break}else{var ue=Be-254;if(Be>264){var I=Be-257,ce=wle[I];ue=Cf(n,l,(1<<ce)-1)+Dle[I],l+=ce}var Ce=d[tU(n,l)&he],Oe=Ce>>>4;if(!Ce)throw"invalid distance";l+=Ce&15;var j=IXe[Oe];if(Oe>3){var ce=Ele[Oe];j+=tU(n,l)&(1<<ce)-1,l+=ce}if(l>y){if(s)throw"unexpected EOF";break}r&&a(u+131072);for(var nt=u+ue;u<nt;u+=4)e[u]=e[u-j],e[u+1]=e[u+1-j],e[u+2]=e[u+2-j],e[u+3]=e[u+3-j];u=nt}}t.l=c,t.p=_e,t.b=u,c&&(o=1,t.m=f,t.d=d,t.n=m)}while(!o);return u==e.length?e:kXe(e,0,u)},VXe=new bd(0),HXe=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function HD(n,e){return zXe((HXe(n),n.subarray(2,-4)),e)}var XXe=typeof TextDecoder<"u"&&new TextDecoder,WXe=0;try{XXe.decode(VXe,{stream:!0}),WXe=1}catch{}const ZXe=n=>n&&n.isCubeTexture;class jXe extends Fr{constructor(e,t){var i,r;const s=ZXe(e),o=((r=s?(i=e.image[0])==null?void 0:i.width:e.image.width)!=null?r:1024)/4,l=Math.floor(Math.log2(o)),u=Math.pow(2,l),c=3*Math.max(u,112),d=4*u,f=[s?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/c}`,`#define CUBEUV_TEXEL_HEIGHT ${1/d}`,`#define CUBEUV_MAX_MIP ${l}.0`],m=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,y=f.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${CH>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,_={map:{value:e},height:{value:t?.height||15},radius:{value:t?.radius||100}},S=new QM(1,16),b=new Ds({uniforms:_,fragmentShader:y,vertexShader:m,side:fr});super(S,b)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var YXe=Object.defineProperty,KXe=(n,e,t)=>e in n?YXe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$Xe=(n,e,t)=>(KXe(n,e+"",t),t);let JXe=class{constructor(){$Xe(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}};var qXe=Object.defineProperty,QXe=(n,e,t)=>e in n?qXe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ti=(n,e,t)=>(QXe(n,typeof e!="symbol"?e+"":e,t),t);const XD=new Im,FY=new Xl,e7e=Math.cos(70*(Math.PI/180)),LY=(n,e)=>(n%e+e)%e;let t7e=class extends JXe{constructor(e,t){super(),Ti(this,"object"),Ti(this,"domElement"),Ti(this,"enabled",!0),Ti(this,"target",new re),Ti(this,"minDistance",0),Ti(this,"maxDistance",1/0),Ti(this,"minZoom",0),Ti(this,"maxZoom",1/0),Ti(this,"minPolarAngle",0),Ti(this,"maxPolarAngle",Math.PI),Ti(this,"minAzimuthAngle",-1/0),Ti(this,"maxAzimuthAngle",1/0),Ti(this,"enableDamping",!1),Ti(this,"dampingFactor",.05),Ti(this,"enableZoom",!0),Ti(this,"zoomSpeed",1),Ti(this,"enableRotate",!0),Ti(this,"rotateSpeed",1),Ti(this,"enablePan",!0),Ti(this,"panSpeed",1),Ti(this,"screenSpacePanning",!0),Ti(this,"keyPanSpeed",7),Ti(this,"zoomToCursor",!1),Ti(this,"autoRotate",!1),Ti(this,"autoRotateSpeed",2),Ti(this,"reverseOrbit",!1),Ti(this,"reverseHorizontalOrbit",!1),Ti(this,"reverseVerticalOrbit",!1),Ti(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Ti(this,"mouseButtons",{LEFT:Ly.ROTATE,MIDDLE:Ly.DOLLY,RIGHT:Ly.PAN}),Ti(this,"touches",{ONE:Iy.ROTATE,TWO:Iy.DOLLY_PAN}),Ti(this,"target0"),Ti(this,"position0"),Ti(this,"zoom0"),Ti(this,"_domElementKeyEvents",null),Ti(this,"getPolarAngle"),Ti(this,"getAzimuthalAngle"),Ti(this,"setPolarAngle"),Ti(this,"setAzimuthalAngle"),Ti(this,"getDistance"),Ti(this,"getZoomScale"),Ti(this,"listenToKeyEvents"),Ti(this,"stopListenToKeyEvents"),Ti(this,"saveState"),Ti(this,"reset"),Ti(this,"update"),Ti(this,"connect"),Ti(this,"dispose"),Ti(this,"dollyIn"),Ti(this,"dollyOut"),Ti(this,"getScale"),Ti(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=Se=>{let Je=LY(Se,2*Math.PI),St=c.phi;St<0&&(St+=2*Math.PI),Je<0&&(Je+=2*Math.PI);let Ne=Math.abs(Je-St);2*Math.PI-Ne<Ne&&(Je<St?Je+=2*Math.PI:St+=2*Math.PI),d.phi=Je-St,i.update()},this.setAzimuthalAngle=Se=>{let Je=LY(Se,2*Math.PI),St=c.theta;St<0&&(St+=2*Math.PI),Je<0&&(Je+=2*Math.PI);let Ne=Math.abs(Je-St);2*Math.PI-Ne<Ne&&(Je<St?Je+=2*Math.PI:St+=2*Math.PI),d.theta=Je-St,i.update()},this.getDistance=()=>i.object.position.distanceTo(i.target),this.listenToKeyEvents=Se=>{Se.addEventListener("keydown",at),this._domElementKeyEvents=Se},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",at),this._domElementKeyEvents=null},this.saveState=()=>{i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=()=>{i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(r),i.update(),l=o.NONE},this.update=(()=>{const Se=new re,Je=new re(0,1,0),St=new ba().setFromUnitVectors(e.up,Je),Ne=St.clone().invert(),it=new re,kt=new ba,vn=2*Math.PI;return function(){const Ut=i.object.position;St.setFromUnitVectors(e.up,Je),Ne.copy(St).invert(),Se.copy(Ut).sub(i.target),Se.applyQuaternion(St),c.setFromVector3(Se),i.autoRotate&&l===o.NONE&&K(V()),i.enableDamping?(c.theta+=d.theta*i.dampingFactor,c.phi+=d.phi*i.dampingFactor):(c.theta+=d.theta,c.phi+=d.phi);let z=i.minAzimuthAngle,se=i.maxAzimuthAngle;isFinite(z)&&isFinite(se)&&(z<-Math.PI?z+=vn:z>Math.PI&&(z-=vn),se<-Math.PI?se+=vn:se>Math.PI&&(se-=vn),z<=se?c.theta=Math.max(z,Math.min(se,c.theta)):c.theta=c.theta>(z+se)/2?Math.max(z,c.theta):Math.min(se,c.theta)),c.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,c.phi)),c.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(m,i.dampingFactor):i.target.add(m),i.zoomToCursor&&B||i.object.isOrthographicCamera?c.radius=Ce(c.radius):c.radius=Ce(c.radius*f),Se.setFromSpherical(c),Se.applyQuaternion(Ne),Ut.copy(i.target).add(Se),i.object.matrixAutoUpdate||i.object.updateMatrix(),i.object.lookAt(i.target),i.enableDamping===!0?(d.theta*=1-i.dampingFactor,d.phi*=1-i.dampingFactor,m.multiplyScalar(1-i.dampingFactor)):(d.set(0,0,0),m.set(0,0,0));let ne=!1;if(i.zoomToCursor&&B){let ae=null;if(i.object instanceof ds&&i.object.isPerspectiveCamera){const be=Se.length();ae=Ce(be*f);const pt=be-ae;i.object.position.addScaledVector(P,pt),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){const be=new re(I.x,I.y,0);be.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/f)),i.object.updateProjectionMatrix(),ne=!0;const pt=new re(I.x,I.y,0);pt.unproject(i.object),i.object.position.sub(pt).add(be),i.object.updateMatrixWorld(),ae=Se.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;ae!==null&&(i.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(ae).add(i.object.position):(XD.origin.copy(i.object.position),XD.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(XD.direction))<e7e?e.lookAt(i.target):(FY.setFromNormalAndCoplanarPoint(i.object.up,i.target),XD.intersectPlane(FY,i.target))))}else i.object instanceof Tl&&i.object.isOrthographicCamera&&(ne=f!==1,ne&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/f)),i.object.updateProjectionMatrix()));return f=1,B=!1,ne||it.distanceToSquared(i.object.position)>u||8*(1-kt.dot(i.object.quaternion))>u?(i.dispatchEvent(r),it.copy(i.object.position),kt.copy(i.object.quaternion),ne=!1,!0):!1}})(),this.connect=Se=>{i.domElement=Se,i.domElement.style.touchAction="none",i.domElement.addEventListener("contextmenu",Nn),i.domElement.addEventListener("pointerdown",Zt),i.domElement.addEventListener("pointercancel",ee),i.domElement.addEventListener("wheel",et)},this.dispose=()=>{var Se,Je,St,Ne,it,kt;i.domElement&&(i.domElement.style.touchAction="auto"),(Se=i.domElement)==null||Se.removeEventListener("contextmenu",Nn),(Je=i.domElement)==null||Je.removeEventListener("pointerdown",Zt),(St=i.domElement)==null||St.removeEventListener("pointercancel",ee),(Ne=i.domElement)==null||Ne.removeEventListener("wheel",et),(it=i.domElement)==null||it.ownerDocument.removeEventListener("pointermove",le),(kt=i.domElement)==null||kt.ownerDocument.removeEventListener("pointerup",ee),i._domElementKeyEvents!==null&&i._domElementKeyEvents.removeEventListener("keydown",at)};const i=this,r={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const u=1e-6,c=new $w,d=new $w;let f=1;const m=new re,y=new rt,_=new rt,S=new rt,b=new rt,M=new rt,w=new rt,T=new rt,E=new rt,R=new rt,P=new re,I=new rt;let B=!1;const N=[],U={};function V(){return 2*Math.PI/60/60*i.autoRotateSpeed}function W(){return Math.pow(.95,i.zoomSpeed)}function K(Se){i.reverseOrbit||i.reverseHorizontalOrbit?d.theta+=Se:d.theta-=Se}function q(Se){i.reverseOrbit||i.reverseVerticalOrbit?d.phi+=Se:d.phi-=Se}const j=(()=>{const Se=new re;return function(St,Ne){Se.setFromMatrixColumn(Ne,0),Se.multiplyScalar(-St),m.add(Se)}})(),te=(()=>{const Se=new re;return function(St,Ne){i.screenSpacePanning===!0?Se.setFromMatrixColumn(Ne,1):(Se.setFromMatrixColumn(Ne,0),Se.crossVectors(i.object.up,Se)),Se.multiplyScalar(St),m.add(Se)}})(),he=(()=>{const Se=new re;return function(St,Ne){const it=i.domElement;if(it&&i.object instanceof ds&&i.object.isPerspectiveCamera){const kt=i.object.position;Se.copy(kt).sub(i.target);let vn=Se.length();vn*=Math.tan(i.object.fov/2*Math.PI/180),j(2*St*vn/it.clientHeight,i.object.matrix),te(2*Ne*vn/it.clientHeight,i.object.matrix)}else it&&i.object instanceof Tl&&i.object.isOrthographicCamera?(j(St*(i.object.right-i.object.left)/i.object.zoom/it.clientWidth,i.object.matrix),te(Ne*(i.object.top-i.object.bottom)/i.object.zoom/it.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}})();function _e(Se){i.object instanceof ds&&i.object.isPerspectiveCamera||i.object instanceof Tl&&i.object.isOrthographicCamera?f=Se:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Be(Se){_e(f/Se)}function ue(Se){_e(f*Se)}function ce(Se){if(!i.zoomToCursor||!i.domElement)return;B=!0;const Je=i.domElement.getBoundingClientRect(),St=Se.clientX-Je.left,Ne=Se.clientY-Je.top,it=Je.width,kt=Je.height;I.x=St/it*2-1,I.y=-(Ne/kt)*2+1,P.set(I.x,I.y,1).unproject(i.object).sub(i.object.position).normalize()}function Ce(Se){return Math.max(i.minDistance,Math.min(i.maxDistance,Se))}function Oe(Se){y.set(Se.clientX,Se.clientY)}function nt(Se){ce(Se),T.set(Se.clientX,Se.clientY)}function Ae(Se){b.set(Se.clientX,Se.clientY)}function Ye(Se){_.set(Se.clientX,Se.clientY),S.subVectors(_,y).multiplyScalar(i.rotateSpeed);const Je=i.domElement;Je&&(K(2*Math.PI*S.x/Je.clientHeight),q(2*Math.PI*S.y/Je.clientHeight)),y.copy(_),i.update()}function ft(Se){E.set(Se.clientX,Se.clientY),R.subVectors(E,T),R.y>0?Be(W()):R.y<0&&ue(W()),T.copy(E),i.update()}function ze(Se){M.set(Se.clientX,Se.clientY),w.subVectors(M,b).multiplyScalar(i.panSpeed),he(w.x,w.y),b.copy(M),i.update()}function ot(Se){ce(Se),Se.deltaY<0?ue(W()):Se.deltaY>0&&Be(W()),i.update()}function ut(Se){let Je=!1;switch(Se.code){case i.keys.UP:he(0,i.keyPanSpeed),Je=!0;break;case i.keys.BOTTOM:he(0,-i.keyPanSpeed),Je=!0;break;case i.keys.LEFT:he(i.keyPanSpeed,0),Je=!0;break;case i.keys.RIGHT:he(-i.keyPanSpeed,0),Je=!0;break}Je&&(Se.preventDefault(),i.update())}function Wt(){if(N.length==1)y.set(N[0].pageX,N[0].pageY);else{const Se=.5*(N[0].pageX+N[1].pageX),Je=.5*(N[0].pageY+N[1].pageY);y.set(Se,Je)}}function It(){if(N.length==1)b.set(N[0].pageX,N[0].pageY);else{const Se=.5*(N[0].pageX+N[1].pageX),Je=.5*(N[0].pageY+N[1].pageY);b.set(Se,Je)}}function ke(){const Se=N[0].pageX-N[1].pageX,Je=N[0].pageY-N[1].pageY,St=Math.sqrt(Se*Se+Je*Je);T.set(0,St)}function je(){i.enableZoom&&ke(),i.enablePan&&It()}function gt(){i.enableZoom&&ke(),i.enableRotate&&Wt()}function yt(Se){if(N.length==1)_.set(Se.pageX,Se.pageY);else{const St=Ft(Se),Ne=.5*(Se.pageX+St.x),it=.5*(Se.pageY+St.y);_.set(Ne,it)}S.subVectors(_,y).multiplyScalar(i.rotateSpeed);const Je=i.domElement;Je&&(K(2*Math.PI*S.x/Je.clientHeight),q(2*Math.PI*S.y/Je.clientHeight)),y.copy(_)}function ve(Se){if(N.length==1)M.set(Se.pageX,Se.pageY);else{const Je=Ft(Se),St=.5*(Se.pageX+Je.x),Ne=.5*(Se.pageY+Je.y);M.set(St,Ne)}w.subVectors(M,b).multiplyScalar(i.panSpeed),he(w.x,w.y),b.copy(M)}function An(Se){const Je=Ft(Se),St=Se.pageX-Je.x,Ne=Se.pageY-Je.y,it=Math.sqrt(St*St+Ne*Ne);E.set(0,it),R.set(0,Math.pow(E.y/T.y,i.zoomSpeed)),Be(R.y),T.copy(E)}function cn(Se){i.enableZoom&&An(Se),i.enablePan&&ve(Se)}function In(Se){i.enableZoom&&An(Se),i.enableRotate&&yt(Se)}function Zt(Se){var Je,St;i.enabled!==!1&&(N.length===0&&((Je=i.domElement)==null||Je.ownerDocument.addEventListener("pointermove",le),(St=i.domElement)==null||St.ownerDocument.addEventListener("pointerup",ee)),Fn(Se),Se.pointerType==="touch"?jt(Se):Re(Se))}function le(Se){i.enabled!==!1&&(Se.pointerType==="touch"?rn(Se):tt(Se))}function ee(Se){var Je,St,Ne;Gt(Se),N.length===0&&((Je=i.domElement)==null||Je.releasePointerCapture(Se.pointerId),(St=i.domElement)==null||St.ownerDocument.removeEventListener("pointermove",le),(Ne=i.domElement)==null||Ne.ownerDocument.removeEventListener("pointerup",ee)),i.dispatchEvent(a),l=o.NONE}function Re(Se){let Je;switch(Se.button){case 0:Je=i.mouseButtons.LEFT;break;case 1:Je=i.mouseButtons.MIDDLE;break;case 2:Je=i.mouseButtons.RIGHT;break;default:Je=-1}switch(Je){case Ly.DOLLY:if(i.enableZoom===!1)return;nt(Se),l=o.DOLLY;break;case Ly.ROTATE:if(Se.ctrlKey||Se.metaKey||Se.shiftKey){if(i.enablePan===!1)return;Ae(Se),l=o.PAN}else{if(i.enableRotate===!1)return;Oe(Se),l=o.ROTATE}break;case Ly.PAN:if(Se.ctrlKey||Se.metaKey||Se.shiftKey){if(i.enableRotate===!1)return;Oe(Se),l=o.ROTATE}else{if(i.enablePan===!1)return;Ae(Se),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&i.dispatchEvent(s)}function tt(Se){if(i.enabled!==!1)switch(l){case o.ROTATE:if(i.enableRotate===!1)return;Ye(Se);break;case o.DOLLY:if(i.enableZoom===!1)return;ft(Se);break;case o.PAN:if(i.enablePan===!1)return;ze(Se);break}}function et(Se){i.enabled===!1||i.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(Se.preventDefault(),i.dispatchEvent(s),ot(Se),i.dispatchEvent(a))}function at(Se){i.enabled===!1||i.enablePan===!1||ut(Se)}function jt(Se){switch(st(Se),N.length){case 1:switch(i.touches.ONE){case Iy.ROTATE:if(i.enableRotate===!1)return;Wt(),l=o.TOUCH_ROTATE;break;case Iy.PAN:if(i.enablePan===!1)return;It(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(i.touches.TWO){case Iy.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;je(),l=o.TOUCH_DOLLY_PAN;break;case Iy.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;gt(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&i.dispatchEvent(s)}function rn(Se){switch(st(Se),l){case o.TOUCH_ROTATE:if(i.enableRotate===!1)return;yt(Se),i.update();break;case o.TOUCH_PAN:if(i.enablePan===!1)return;ve(Se),i.update();break;case o.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;cn(Se),i.update();break;case o.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;In(Se),i.update();break;default:l=o.NONE}}function Nn(Se){i.enabled!==!1&&Se.preventDefault()}function Fn(Se){N.push(Se)}function Gt(Se){delete U[Se.pointerId];for(let Je=0;Je<N.length;Je++)if(N[Je].pointerId==Se.pointerId){N.splice(Je,1);return}}function st(Se){let Je=U[Se.pointerId];Je===void 0&&(Je=new rt,U[Se.pointerId]=Je),Je.set(Se.pageX,Se.pageY)}function Ft(Se){const Je=Se.pointerId===N[0].pointerId?N[1]:N[0];return U[Je.pointerId]}this.dollyIn=(Se=W())=>{ue(Se),i.update()},this.dollyOut=(Se=W())=>{Be(Se),i.update()},this.getScale=()=>f,this.setScale=Se=>{_e(Se),i.update()},this.getZoomScale=()=>W(),t!==void 0&&this.connect(t),this.update()}};var n7e=Object.defineProperty,i7e=(n,e,t)=>e in n?n7e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ex=(n,e,t)=>(i7e(n,typeof e!="symbol"?e+"":e,t),t);let jR=class{constructor(){Ex(this,"enabled",!0),Ex(this,"needsSwap",!0),Ex(this,"clear",!1),Ex(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,i,r,s){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}};class Ble{constructor(e){Ex(this,"camera",new Tl(-1,1,1,-1,0,1)),Ex(this,"geometry",new ap(2,2)),Ex(this,"mesh"),this.mesh=new Fr(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var r7e=Object.defineProperty,s7e=(n,e,t)=>e in n?r7e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,WD=(n,e,t)=>(s7e(n,typeof e!="symbol"?e+"":e,t),t);let Dk=class extends jR{constructor(e,t="tDiffuse"){super(),WD(this,"textureID"),WD(this,"uniforms"),WD(this,"material"),WD(this,"fsQuad"),this.textureID=t,e instanceof Ds?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=vM.clone(e.uniforms),this.material=new Ds({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Ble(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.fsQuad.dispose(),this.material.dispose()}};const Nk={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform float opacity;

    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 texel = texture2D( tDiffuse, vUv );
    	gl_FragColor = opacity * texel;

    }
  `},a7e={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new en(0)},defaultOpacity:{value:0}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;

    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec3 defaultColor;
    uniform float defaultOpacity;
    uniform float luminosityThreshold;
    uniform float smoothWidth;

    varying vec2 vUv;

    void main() {

    	vec4 texel = texture2D( tDiffuse, vUv );

    	vec3 luma = vec3( 0.299, 0.587, 0.114 );

    	float v = dot( texel.xyz, luma );

    	vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

    	float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

    	gl_FragColor = mix( outputColor, texel, alpha );

    }
  `};var o7e=Object.defineProperty,l7e=(n,e,t)=>e in n?o7e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,IY=(n,e,t)=>(l7e(n,typeof e!="symbol"?e+"":e,t),t);const u7e=(()=>{const n=class extends jR{constructor(t,i,r,s){super(),this.strength=i!==void 0?i:1,this.radius=r,this.threshold=s,this.resolution=t!==void 0?new rt(t.x,t.y):new rt(256,256),this.clearColor=new en(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new Nr(a,o,{type:zi}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let f=0;f<this.nMips;f++){const m=new Nr(a,o,{type:zi});m.texture.name="UnrealBloomPass.h"+f,m.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(m);const y=new Nr(a,o,{type:zi});y.texture.name="UnrealBloomPass.v"+f,y.texture.generateMipmaps=!1,this.renderTargetsVertical.push(y),a=Math.round(a/2),o=Math.round(o/2)}const l=a7e;this.highPassUniforms=vM.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Ds({uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const u=[3,5,7,9,11];a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);for(let f=0;f<this.nMips;f++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(u[f])),this.separableBlurMaterials[f].uniforms.texSize.value=new rt(a,o),a=Math.round(a/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=i,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const c=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=c,this.bloomTintColors=[new re(1,1,1),new re(1,1,1),new re(1,1,1),new re(1,1,1),new re(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const d=Nk;this.copyUniforms=vM.clone(d.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Ds({uniforms:this.copyUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:bm,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new en,this.oldClearAlpha=1,this.basic=new La,this.fsQuad=new Ble(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose();for(let t=0;t<this.separableBlurMaterials.length;t++)this.separableBlurMaterials[t].dispose();this.compositeMaterial.dispose(),this.materialCopy.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(t,i){let r=Math.round(t/2),s=Math.round(i/2);this.renderTargetBright.setSize(r,s);for(let a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(r,s),this.renderTargetsVertical[a].setSize(r,s),this.separableBlurMaterials[a].uniforms.texSize.value=new rt(r,s),r=Math.round(r/2),s=Math.round(s/2)}render(t,i,r,s,a){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const o=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),a&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let l=this.renderTargetBright;for(let u=0;u<this.nMips;u++)this.fsQuad.material=this.separableBlurMaterials[u],this.separableBlurMaterials[u].uniforms.colorTexture.value=l.texture,this.separableBlurMaterials[u].uniforms.direction.value=n.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[u]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[u].uniforms.colorTexture.value=this.renderTargetsHorizontal[u].texture,this.separableBlurMaterials[u].uniforms.direction.value=n.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[u]),t.clear(),this.fsQuad.render(t),l=this.renderTargetsVertical[u];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(r),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=o}getSeperableBlurMaterial(t){return new Ds({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new rt(.5,.5)},direction:{value:new rt(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(t){return new Ds({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let e=n;return IY(e,"BlurDirectionX",new rt(1,0)),IY(e,"BlurDirectionY",new rt(0,1)),e})();var c7e=Object.defineProperty,h7e=(n,e,t)=>e in n?c7e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,nU=(n,e,t)=>(h7e(n,typeof e!="symbol"?e+"":e,t),t);let GY=class extends jR{constructor(e,t){super(),nU(this,"scene"),nU(this,"camera"),nU(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let a,o;this.inverse?(a=0,o=1):(a=1,o=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,a,4294967295),s.buffers.stencil.setClear(o),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}},d7e=class extends jR{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}};var f7e=Object.defineProperty,p7e=(n,e,t)=>e in n?f7e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ld=(n,e,t)=>(p7e(n,typeof e!="symbol"?e+"":e,t),t);let m7e=class{constructor(e,t){if(ld(this,"renderer"),ld(this,"_pixelRatio"),ld(this,"_width"),ld(this,"_height"),ld(this,"renderTarget1"),ld(this,"renderTarget2"),ld(this,"writeBuffer"),ld(this,"readBuffer"),ld(this,"renderToScreen"),ld(this,"passes",[]),ld(this,"copyPass"),ld(this,"clock"),this.renderer=e,t===void 0){const i={minFilter:Jn,magFilter:Jn,format:Vr},r=e.getSize(new rt);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,t=new Nr(this._width*this._pixelRatio,this._height*this._pixelRatio,i),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,Nk===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),Dk===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Dk(Nk),this.copyPass.material.blending=Oa,this.clock=new BR}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;const r=this.passes.length;for(let s=0;s<r;s++){const a=this.passes[s];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),a.needsSwap){if(i){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}GY!==void 0&&(a instanceof GY?i=!0:a instanceof d7e&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new rt);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(i,r),this.renderTarget2.setSize(i,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}};var g7e=Object.defineProperty,y7e=(n,e,t)=>e in n?g7e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ax=(n,e,t)=>(y7e(n,typeof e!="symbol"?e+"":e,t),t);let v7e=class extends jR{constructor(e,t,i,r,s=0){super(),ax(this,"scene"),ax(this,"camera"),ax(this,"overrideMaterial"),ax(this,"clearColor"),ax(this,"clearAlpha"),ax(this,"clearDepth",!1),ax(this,"_oldClearColor",new en),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.needsSwap=!1}render(e,t,i){let r=e.autoClear;e.autoClear=!1;let s,a=null;this.overrideMaterial!==void 0&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,s),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=a),e.autoClear=r}};function e2(n){if(typeof TextDecoder<"u")return new TextDecoder().decode(n);let e="";for(let t=0,i=n.length;t<i;t++)e+=String.fromCharCode(n[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const Rx="srgb",i0="srgb-linear",OY=3001,x7e=3e3;class wH extends rl{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new A7e(t)}),this.register(function(t){return new T7e(t)}),this.register(function(t){return new F7e(t)}),this.register(function(t){return new L7e(t)}),this.register(function(t){return new I7e(t)}),this.register(function(t){return new w7e(t)}),this.register(function(t){return new E7e(t)}),this.register(function(t){return new R7e(t)}),this.register(function(t){return new P7e(t)}),this.register(function(t){return new M7e(t)}),this.register(function(t){return new D7e(t)}),this.register(function(t){return new C7e(t)}),this.register(function(t){return new B7e(t)}),this.register(function(t){return new N7e(t)}),this.register(function(t){return new _7e(t)}),this.register(function(t){return new G7e(t)}),this.register(function(t){return new O7e(t)})}load(e,t,i,r){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const u=Qg.extractUrlBase(e);a=Qg.resolveURL(u,this.path)}else a=Qg.extractUrlBase(e);this.manager.itemStart(e);const o=function(u){r?r(u):console.error(u),s.manager.itemError(e),s.manager.itemEnd(e)},l=new el(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{s.parse(u,a,function(c){t(c),s.manager.itemEnd(e)},o)}catch(c){o(c)}},i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let s;const a={},o={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(e2(new Uint8Array(e.slice(0,4)))===Fle){try{a[kr.KHR_BINARY_GLTF]=new U7e(e)}catch(c){r&&r(c);return}s=JSON.parse(a[kr.KHR_BINARY_GLTF].content)}else s=JSON.parse(e2(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new q7e(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const c=this.pluginCallbacks[u](l);c.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[c.name]=c,a[c.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const c=s.extensionsUsed[u],d=s.extensionsRequired||[];switch(c){case kr.KHR_MATERIALS_UNLIT:a[c]=new S7e;break;case kr.KHR_DRACO_MESH_COMPRESSION:a[c]=new k7e(s,this.dracoLoader);break;case kr.KHR_TEXTURE_TRANSFORM:a[c]=new z7e;break;case kr.KHR_MESH_QUANTIZATION:a[c]=new V7e;break;default:d.indexOf(c)>=0&&o[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(i,r)}parseAsync(e,t){const i=this;return new Promise(function(r,s){i.parse(e,t,r,s)})}}function b7e(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const kr={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class _7e{constructor(e){this.parser=e,this.name=kr.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let u;const c=new en(16777215);l.color!==void 0&&c.setRGB(l.color[0],l.color[1],l.color[2],i0);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":u=new NR(c),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new DR(c),u.distance=d;break;case"spot":u=new Bb(c),u.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,u.angle=l.spot.outerConeAngle,u.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return u.position.set(0,0,0),u.decay=2,Lg(u,l),l.intensity!==void 0&&(u.intensity=l.intensity),u.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(u),t.cache.add(i,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return i._getNodeRef(t.cache,o,l)})}}class S7e{constructor(){this.name=kr.KHR_MATERIALS_UNLIT}getMaterialType(){return La}extendParams(e,t,i){const r=[];e.color=new en(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],i0),e.opacity=a[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",s.baseColorTexture,Rx))}return Promise.all(r)}}class M7e{constructor(e){this.parser=e,this.name=kr.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class A7e{constructor(e){this.parser=e,this.name=kr.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new rt(o,o)}return Promise.all(s)}}class T7e{constructor(e){this.parser=e,this.name=kr.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class C7e{constructor(e){this.parser=e,this.name=kr.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class w7e{constructor(e){this.parser=e,this.name=kr.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new en(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=r.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],i0)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(i.assignTexture(t,"sheenColorMap",a.sheenColorTexture,Rx)),a.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class E7e{constructor(e){this.parser=e,this.name=kr.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class R7e{constructor(e){this.parser=e,this.name=kr.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return t.attenuationColor=new en().setRGB(o[0],o[1],o[2],i0),Promise.all(s)}}class P7e{constructor(e){this.parser=e,this.name=kr.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class D7e{constructor(e){this.parser=e,this.name=kr.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return t.specularColor=new en().setRGB(o[0],o[1],o[2],i0),a.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularColorMap",a.specularColorTexture,Rx)),Promise.all(s)}}class N7e{constructor(e){this.parser=e,this.name=kr.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(i.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(s)}}class B7e{constructor(e){this.parser=e,this.name=kr.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Kc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(i.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class F7e{constructor(e){this.parser=e,this.name=kr.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,a)}}class L7e{constructor(e){this.parser=e,this.name=kr.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=r.images[a.source];let l=i.textureLoader;if(o.uri){const u=i.options.manager.getHandler(o.uri);u!==null&&(l=u)}return this.detectSupport().then(function(u){if(u)return i.loadTextureImage(e,a.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class I7e{constructor(e){this.parser=e,this.name=kr.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=r.images[a.source];let l=i.textureLoader;if(o.uri){const u=i.options.manager.getHandler(o.uri);u!==null&&(l=u)}return this.detectSupport().then(function(u){if(u)return i.loadTextureImage(e,a.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class G7e{constructor(e){this.name=kr.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const l=r.byteOffset||0,u=r.byteLength||0,c=r.count,d=r.byteStride,f=new Uint8Array(o,l,u);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(c,d,f,r.mode,r.filter).then(function(m){return m.buffer}):a.ready.then(function(){const m=new ArrayBuffer(c*d);return a.decodeGltfBuffer(new Uint8Array(m),c,d,f,r.mode,r.filter),m})})}else return null}}class O7e{constructor(e){this.name=kr.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const r=t.meshes[i.mesh];for(const u of r.primitives)if(u.mode!==dd.TRIANGLES&&u.mode!==dd.TRIANGLE_STRIP&&u.mode!==dd.TRIANGLE_FAN&&u.mode!==void 0)return null;const a=i.extensions[this.name].attributes,o=[],l={};for(const u in a)o.push(this.parser.getDependency("accessor",a[u]).then(c=>(l[u]=c,l[u])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(u=>{const c=u.pop(),d=c.isGroup?c.children:[c],f=u[0].count,m=[];for(const y of d){const _=new Mn,S=new re,b=new ba,M=new re(1,1,1),w=new Q2(y.geometry,y.material,f);for(let T=0;T<f;T++)l.TRANSLATION&&S.fromBufferAttribute(l.TRANSLATION,T),l.ROTATION&&b.fromBufferAttribute(l.ROTATION,T),l.SCALE&&M.fromBufferAttribute(l.SCALE,T),w.setMatrixAt(T,_.compose(S,b,M));for(const T in l)if(T==="_COLOR_0"){const E=l[T];w.instanceColor=new Vc(E.array,E.itemSize,E.normalized)}else T!=="TRANSLATION"&&T!=="ROTATION"&&T!=="SCALE"&&y.geometry.setAttribute(T,l[T]);Br.prototype.copy.call(w,y),this.parser.assignFinalMaterial(w),m.push(w)}return c.isGroup?(c.clear(),c.add(...m),c):m[0]}))}}const Fle="glTF",bC=12,UY={JSON:1313821514,BIN:5130562};class U7e{constructor(e){this.name=kr.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,bC);if(this.header={magic:e2(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Fle)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-bC,r=new DataView(e,bC);let s=0;for(;s<i;){const a=r.getUint32(s,!0);s+=4;const o=r.getUint32(s,!0);if(s+=4,o===UY.JSON){const l=new Uint8Array(e,bC+s,a);this.content=e2(l)}else if(o===UY.BIN){const l=bC+s;this.body=e.slice(l,l+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class k7e{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=kr.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},l={},u={};for(const c in a){const d=Bk[c]||c.toLowerCase();o[d]=a[c]}for(const c in e.attributes){const d=Bk[c]||c.toLowerCase();if(a[c]!==void 0){const f=i.accessors[e.attributes[c]],m=rM[f.componentType];u[d]=m.name,l[d]=f.normalized===!0}}return t.getDependency("bufferView",s).then(function(c){return new Promise(function(d,f){r.decodeDracoFile(c,function(m){for(const y in m.attributes){const _=m.attributes[y],S=l[y];S!==void 0&&(_.normalized=S)}d(m)},o,u,i0,f)})})}}class z7e{constructor(){this.name=kr.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class V7e{constructor(){this.name=kr.KHR_MESH_QUANTIZATION}}class Lle extends Nb{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let a=0;a!==r;a++)t[a]=i[s+a];return t}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,u=o*3,c=r-t,d=(i-t)/c,f=d*d,m=f*d,y=e*u,_=y-u,S=-2*m+3*f,b=m-f,M=1-S,w=b-f+d;for(let T=0;T!==o;T++){const E=a[_+T+o],R=a[_+T+l]*c,P=a[y+T+o],I=a[y+T]*c;s[T]=M*E+w*R+S*P+b*I}return s}}const H7e=new ba;class X7e extends Lle{interpolate_(e,t,i,r){const s=super.interpolate_(e,t,i,r);return H7e.fromArray(s).normalize().toArray(s),s}}const dd={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},rM={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},kY={9728:xr,9729:Jn,9984:Mb,9985:sm,9986:xh,9987:Vo},zY={33071:ps,33648:jf,10497:Xc},iU={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Bk={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...CH>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ay={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},W7e={CUBICSPLINE:void 0,LINEAR:ob,STEP:ab},rU={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Z7e(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new mo({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:wo})),n.DefaultMaterial}function ox(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Lg(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function j7e(n,e,t){let i=!1,r=!1,s=!1;for(let u=0,c=e.length;u<c;u++){const d=e[u];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(r=!0),d.COLOR_0!==void 0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(n);const a=[],o=[],l=[];for(let u=0,c=e.length;u<c;u++){const d=e[u];if(i){const f=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):n.attributes.position;a.push(f)}if(r){const f=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):n.attributes.normal;o.push(f)}if(s){const f=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(f)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(u){const c=u[0],d=u[1],f=u[2];return i&&(n.morphAttributes.position=c),r&&(n.morphAttributes.normal=d),s&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n})}function Y7e(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function K7e(n){let e;const t=n.extensions&&n.extensions[kr.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+sU(t.attributes):e=n.indices+":"+sU(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,r=n.targets.length;i<r;i++)e+=":"+sU(n.targets[i]);return e}function sU(n){let e="";const t=Object.keys(n).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+n[t[i]]+";";return e}function Fk(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function $7e(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const J7e=new Mn;class q7e{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new b7e,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||r&&s<98?this.textureLoader=new nA(this.options.manager):this.textureLoader=new aV(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new el(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(a){const o={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:i,userData:{}};return ox(s,o,r),Lg(o,r),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const a=t[r].joints;for(let o=0,l=a.length;o<l;o++)e[a[o]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const a=e[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(i[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),s=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[u,c]of a.children.entries())s(c,o.children[u])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,a){return i.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[kr.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,a){i.load(Qg.resolveURL(t.uri,r.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const r=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const a=iU[r.type],o=rM[r.componentType],l=r.normalized===!0,u=new o(r.count*a);return Promise.resolve(new Gi(u,a,l))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(a){const o=a[0],l=iU[r.type],u=rM[r.componentType],c=u.BYTES_PER_ELEMENT,d=c*l,f=r.byteOffset||0,m=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,y=r.normalized===!0;let _,S;if(m&&m!==d){const b=Math.floor(f/m),M="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+b+":"+r.count;let w=t.cache.get(M);w||(_=new u(o,b*m,r.count*m/c),w=new Rb(_,m/c),t.cache.add(M,w)),S=new Tm(w,l,f%m/c,y)}else o===null?_=new u(r.count*l):_=new u(o,f,r.count*l),S=new Gi(_,l,y);if(r.sparse!==void 0){const b=iU.SCALAR,M=rM[r.sparse.indices.componentType],w=r.sparse.indices.byteOffset||0,T=r.sparse.values.byteOffset||0,E=new M(a[1],w,r.sparse.count*b),R=new u(a[2],T,r.sparse.count*l);o!==null&&(S=new Gi(S.array.slice(),S.itemSize,S.normalized));for(let P=0,I=E.length;P<I;P++){const B=E[P];if(S.setX(B,R[P*l]),l>=2&&S.setY(B,R[P*l+1]),l>=3&&S.setZ(B,R[P*l+2]),l>=4&&S.setW(B,R[P*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return S})}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,a=t.images[s];let o=this.textureLoader;if(a.uri){const l=i.manager.getHandler(a.uri);l!==null&&(o=l)}return this.loadTextureImage(e,s,o)}loadTextureImage(e,t,i){const r=this,s=this.json,a=s.textures[e],o=s.images[t],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const u=this.loadImageSource(t,i).then(function(c){c.flipY=!1,c.name=a.name||o.name||"",c.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(c.name=o.uri);const f=(s.samplers||{})[a.sampler]||{};return c.magFilter=kY[f.magFilter]||Jn,c.minFilter=kY[f.minFilter]||Vo,c.wrapS=zY[f.wrapS]||Xc,c.wrapT=zY[f.wrapT]||Xc,r.associations.set(c,{textures:e}),c}).catch(function(){return null});return this.textureCache[l]=u,u}loadImageSource(e,t){const i=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const a=r.images[e],o=self.URL||self.webkitURL;let l=a.uri||"",u=!1;if(a.bufferView!==void 0)l=i.getDependency("bufferView",a.bufferView).then(function(d){u=!0;const f=new Blob([d],{type:a.mimeType});return l=o.createObjectURL(f),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(l).then(function(d){return new Promise(function(f,m){let y=f;t.isImageBitmapLoader===!0&&(y=function(_){const S=new pr(_);S.needsUpdate=!0,f(S)}),t.load(Qg.resolveURL(d,s.path),y,void 0,m)})}).then(function(d){return u===!0&&o.revokeObjectURL(l),Lg(d,a),d.userData.mimeType=a.mimeType||$7e(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=c,c}assignTexture(e,t,i,r){const s=this;return this.getDependency("texture",i.index).then(function(a){if(!a)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(a=a.clone(),a.channel=i.texCoord),s.extensions[kr.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[kr.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=s.associations.get(a);a=s.extensions[kr.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),s.associations.set(a,l)}}return r!==void 0&&(typeof r=="number"&&(r=r===OY?Rx:i0),"colorSpace"in a?a.colorSpace=r:a.encoding=r===Rx?OY:x7e),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+i.uuid;let l=this.cache.get(o);l||(l=new JM,_a.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(o,l)),i=l}else if(e.isLine){const o="LineBasicMaterial:"+i.uuid;let l=this.cache.get(o);l||(l=new El,_a.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(o,l)),i=l}if(r||s||a){let o="ClonedMaterial:"+i.uuid+":";r&&(o+="derivative-tangents:"),s&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=i.clone(),s&&(l.vertexColors=!0),a&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return mo}loadMaterial(e){const t=this,i=this.json,r=this.extensions,s=i.materials[e];let a;const o={},l=s.extensions||{},u=[];if(l[kr.KHR_MATERIALS_UNLIT]){const d=r[kr.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),u.push(d.extendParams(o,s,t))}else{const d=s.pbrMetallicRoughness||{};if(o.color=new en(1,1,1),o.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;o.color.setRGB(f[0],f[1],f[2],i0),o.opacity=f[3]}d.baseColorTexture!==void 0&&u.push(t.assignTexture(o,"map",d.baseColorTexture,Rx)),o.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,o.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(o,"metalnessMap",d.metallicRoughnessTexture)),u.push(t.assignTexture(o,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,o)})))}s.doubleSided===!0&&(o.side=fr);const c=s.alphaMode||rU.OPAQUE;if(c===rU.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,c===rU.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==La&&(u.push(t.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new rt(1,1),s.normalTexture.scale!==void 0)){const d=s.normalTexture.scale;o.normalScale.set(d,d)}if(s.occlusionTexture!==void 0&&a!==La&&(u.push(t.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==La){const d=s.emissiveFactor;o.emissive=new en().setRGB(d[0],d[1],d[2],i0)}return s.emissiveTexture!==void 0&&a!==La&&u.push(t.assignTexture(o,"emissiveMap",s.emissiveTexture,Rx)),Promise.all(u).then(function(){const d=new a(o);return s.name&&(d.name=s.name),Lg(d,s),t.associations.set(d,{materials:e}),s.extensions&&ox(r,d,s),d})}createUniqueName(e){const t=Jr.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(o){return i[kr.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(l){return VY(l,o,t)})}const a=[];for(let o=0,l=e.length;o<l;o++){const u=e[o],c=K7e(u),d=r[c];if(d)a.push(d.promise);else{let f;u.extensions&&u.extensions[kr.KHR_DRACO_MESH_COMPRESSION]?f=s(u):f=VY(new wi,u,t),r[c]={primitive:u,promise:f},a.push(f)}}return Promise.all(a)}loadMesh(e){const t=this,i=this.json,r=this.extensions,s=i.meshes[e],a=s.primitives,o=[];for(let l=0,u=a.length;l<u;l++){const c=a[l].material===void 0?Z7e(this.cache):this.getDependency("material",a[l].material);o.push(c)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(l){const u=l.slice(0,l.length-1),c=l[l.length-1],d=[];for(let m=0,y=c.length;m<y;m++){const _=c[m],S=a[m];let b;const M=u[m];if(S.mode===dd.TRIANGLES||S.mode===dd.TRIANGLE_STRIP||S.mode===dd.TRIANGLE_FAN||S.mode===void 0)b=s.isSkinnedMesh===!0?new q2(_,M):new Fr(_,M),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),S.mode===dd.TRIANGLE_STRIP?b.geometry=BY(b.geometry,Z2):S.mode===dd.TRIANGLE_FAN&&(b.geometry=BY(b.geometry,Hw));else if(S.mode===dd.LINES)b=new Zd(_,M);else if(S.mode===dd.LINE_STRIP)b=new Cm(_,M);else if(S.mode===dd.LINE_LOOP)b=new eF(_,M);else if(S.mode===dd.POINTS)b=new tF(_,M);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+S.mode);Object.keys(b.geometry.morphAttributes).length>0&&Y7e(b,s),b.name=t.createUniqueName(s.name||"mesh_"+e),Lg(b,s),S.extensions&&ox(r,b,S),t.assignFinalMaterial(b),d.push(b)}for(let m=0,y=d.length;m<y;m++)t.associations.set(d[m],{meshes:e,primitives:m});if(d.length===1)return s.extensions&&ox(r,d[0],s),d[0];const f=new _h;s.extensions&&ox(r,f,s),t.associations.set(f,{meshes:e});for(let m=0,y=d.length;m<y;m++)f.add(d[m]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new ds(Wl.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(t=new Tl(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Lg(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let r=0,s=t.joints.length;r<s;r++)i.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){const s=r.pop(),a=r,o=[],l=[];for(let u=0,c=a.length;u<c;u++){const d=a[u];if(d){o.push(d);const f=new Mn;s!==null&&f.fromArray(s.array,u*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new KM(o,l)})}loadAnimation(e){const t=this.json,i=this,r=t.animations[e],s=r.name?r.name:"animation_"+e,a=[],o=[],l=[],u=[],c=[];for(let d=0,f=r.channels.length;d<f;d++){const m=r.channels[d],y=r.samplers[m.sampler],_=m.target,S=_.node,b=r.parameters!==void 0?r.parameters[y.input]:y.input,M=r.parameters!==void 0?r.parameters[y.output]:y.output;_.node!==void 0&&(a.push(this.getDependency("node",S)),o.push(this.getDependency("accessor",b)),l.push(this.getDependency("accessor",M)),u.push(y),c.push(_))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(u),Promise.all(c)]).then(function(d){const f=d[0],m=d[1],y=d[2],_=d[3],S=d[4],b=[];for(let M=0,w=f.length;M<w;M++){const T=f[M],E=m[M],R=y[M],P=_[M],I=S[M];if(T===void 0)continue;T.updateMatrix&&T.updateMatrix();const B=i._createAnimationTracks(T,E,R,P,I);if(B)for(let N=0;N<B.length;N++)b.push(B[N])}return new db(s,void 0,b)})}createNodeMesh(e){const t=this.json,i=this,r=t.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){const a=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,u=r.weights.length;l<u;l++)o.morphTargetInfluences[l]=r.weights[l]}),a})}loadNode(e){const t=this.json,i=this,r=t.nodes[e],s=i._loadNodeShallow(e),a=[],o=r.children||[];for(let u=0,c=o.length;u<c;u++)a.push(i.getDependency("node",o[u]));const l=r.skin===void 0?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([s,Promise.all(a),l]).then(function(u){const c=u[0],d=u[1],f=u[2];f!==null&&c.traverse(function(m){m.isSkinnedMesh&&m.bind(f,J7e)});for(let m=0,y=d.length;m<y;m++)c.add(d[m]);return c})}_loadNodeShallow(e){const t=this.json,i=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],a=s.name?r.createUniqueName(s.name):"",o=[],l=r._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return l&&o.push(l),s.camera!==void 0&&o.push(r.getDependency("camera",s.camera).then(function(u){return r._getNodeRef(r.cameraCache,s.camera,u)})),r._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){o.push(u)}),this.nodeCache[e]=Promise.all(o).then(function(u){let c;if(s.isBone===!0?c=new fR:u.length>1?c=new _h:u.length===1?c=u[0]:c=new Br,c!==u[0])for(let d=0,f=u.length;d<f;d++)c.add(u[d]);if(s.name&&(c.userData.name=s.name,c.name=a),Lg(c,s),s.extensions&&ox(i,c,s),s.matrix!==void 0){const d=new Mn;d.fromArray(s.matrix),c.applyMatrix4(d)}else s.translation!==void 0&&c.position.fromArray(s.translation),s.rotation!==void 0&&c.quaternion.fromArray(s.rotation),s.scale!==void 0&&c.scale.fromArray(s.scale);return r.associations.has(c)||r.associations.set(c,{}),r.associations.get(c).nodes=e,c}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],r=this,s=new _h;i.name&&(s.name=r.createUniqueName(i.name)),Lg(s,i),i.extensions&&ox(t,s,i);const a=i.nodes||[],o=[];for(let l=0,u=a.length;l<u;l++)o.push(r.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let c=0,d=l.length;c<d;c++)s.add(l[c]);const u=c=>{const d=new Map;for(const[f,m]of r.associations)(f instanceof _a||f instanceof pr)&&d.set(f,m);return c.traverse(f=>{const m=r.associations.get(f);m!=null&&d.set(f,m)}),d};return r.associations=u(s),s})}_createAnimationTracks(e,t,i,r,s){const a=[],o=e.name?e.name:e.uuid,l=[];Ay[s.path]===Ay.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(o);let u;switch(Ay[s.path]){case Ay.weights:u=Ov;break;case Ay.rotation:u=Uv;break;case Ay.position:case Ay.scale:u=kv;break;default:i.itemSize===1?u=Ov:u=kv;break}const c=r.interpolation!==void 0?W7e[r.interpolation]:ob,d=this._getArrayFromAccessor(i);for(let f=0,m=l.length;f<m;f++){const y=new u(l[f]+"."+Ay[s.path],t.array,d,c);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(y),a.push(y)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=Fk(t.constructor),r=new Float32Array(t.length);for(let s=0,a=t.length;s<a;s++)r[s]=t[s]*i;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const r=this instanceof Uv?X7e:Lle;return new r(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Q7e(n,e,t){const i=e.attributes,r=new Ns;if(i.POSITION!==void 0){const o=t.json.accessors[i.POSITION],l=o.min,u=o.max;if(l!==void 0&&u!==void 0){if(r.set(new re(l[0],l[1],l[2]),new re(u[0],u[1],u[2])),o.normalized){const c=Fk(rM[o.componentType]);r.min.multiplyScalar(c),r.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const o=new re,l=new re;for(let u=0,c=s.length;u<c;u++){const d=s[u];if(d.POSITION!==void 0){const f=t.json.accessors[d.POSITION],m=f.min,y=f.max;if(m!==void 0&&y!==void 0){if(l.setX(Math.max(Math.abs(m[0]),Math.abs(y[0]))),l.setY(Math.max(Math.abs(m[1]),Math.abs(y[1]))),l.setZ(Math.max(Math.abs(m[2]),Math.abs(y[2]))),f.normalized){const _=Fk(rM[f.componentType]);l.multiplyScalar(_)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(o)}n.boundingBox=r;const a=new fo;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=a}function VY(n,e,t){const i=e.attributes,r=[];function s(a,o){return t.getDependency("accessor",a).then(function(l){n.setAttribute(o,l)})}for(const a in i){const o=Bk[a]||a.toLowerCase();o in n.attributes||r.push(s(i[a],o))}if(e.indices!==void 0&&!n.index){const a=t.getDependency("accessor",e.indices).then(function(o){n.setIndex(o)});r.push(a)}return Lg(n,e),Q7e(n,e,t),Promise.all(r).then(function(){return e.targets!==void 0?j7e(n,e.targets,t):n})}const eWe={uniforms:{tDiffuse:{value:null}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 tex = texture2D( tDiffuse, vUv );

    	#ifdef LinearTosRGB
    		gl_FragColor = LinearTosRGB( tex );
    	#else
    		gl_FragColor = sRGBTransferOETF( tex );
    	#endif

    }
  `};class tWe{constructor(e,t=" .:-=+*#%@",i={}){const r=i.resolution||.15,s=i.scale||1,a=i.color||!1,o=i.alpha||!1,l=i.block||!1,u=i.invert||!1,c=i.strResolution||"low";let d,f;const m=document.createElement("div");m.style.cursor="default";const y=document.createElement("table");m.appendChild(y);let _,S,b;this.setSize=function(K,q){d=K,f=q,e.setSize(K,q),M()},this.render=function(K,q){e.render(K,q),W(y)},this.domElement=m;function M(){_=Math.floor(d*r),S=Math.floor(f*r),P.width=_,P.height=S,b=e.domElement,b.style.backgroundColor&&(y.rows[0].cells[0].style.backgroundColor=b.style.backgroundColor,y.rows[0].cells[0].style.color=b.style.color),y.cellSpacing=0,y.cellPadding=0;const K=y.style;K.whiteSpace="pre",K.margin="0px",K.padding="0px",K.letterSpacing=V+"px",K.fontFamily=E,K.fontSize=N+"px",K.lineHeight=U+"px",K.textAlign="left",K.textDecoration="none"}const w=" .,:;i1tfLCG08@".split(""),T=" CGO08@".split(""),E="courier new, monospace",R=e.domElement,P=document.createElement("canvas");if(!P.getContext)return;const I=P.getContext("2d");if(!I.getImageData)return;let B=a?T:w;t&&(B=t);const N=2/r*s,U=2/r*s;let V=0;if(c=="low")switch(s){case 1:V=-1;break;case 2:case 3:V=-2.1;break;case 4:V=-3.1;break;case 5:V=-4.15;break}if(c=="medium")switch(s){case 1:V=0;break;case 2:V=-1;break;case 3:V=-1.04;break;case 4:case 5:V=-2.1;break}if(c=="high")switch(s){case 1:case 2:V=0;break;case 3:case 4:case 5:V=-1;break}function W(K){I.clearRect(0,0,_,S),I.drawImage(R,0,0,_,S);const q=I.getImageData(0,0,_,S).data;let j="";for(let te=0;te<S;te+=2){for(let he=0;he<_;he++){const _e=(te*_+he)*4,Be=q[_e],ue=q[_e+1],ce=q[_e+2],Ce=q[_e+3];let Oe,nt;nt=(.3*Be+.59*ue+.11*ce)/255,Ce==0&&(nt=1),Oe=Math.floor((1-nt)*(B.length-1)),u&&(Oe=B.length-Oe-1);let Ae=B[Oe];(Ae===void 0||Ae==" ")&&(Ae="&nbsp;"),a?j+="<span style='color:rgb("+Be+","+ue+","+ce+");"+(l?"background-color:rgb("+Be+","+ue+","+ce+");":"")+(o?"opacity:"+Ce/255+";":"")+"'>"+Ae+"</span>":j+=Ae}j+="<br/>"}K.innerHTML=`<tr><td style="display:block;width:${d}px;height:${f}px;overflow:hidden">${j}</td></tr>`}}}class nWe extends xF{constructor(e){super(e),this.type=zi}parse(e){const a=function(I,B){switch(I){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(B||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(B||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(B||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(B||""))}},d=function(I,B,N){B=B||1024;let V=I.pos,W=-1,K=0,q="",j=String.fromCharCode.apply(null,new Uint16Array(I.subarray(V,V+128)));for(;0>(W=j.indexOf(`
`))&&K<B&&V<I.byteLength;)q+=j,K+=j.length,V+=128,j+=String.fromCharCode.apply(null,new Uint16Array(I.subarray(V,V+128)));return-1<W?(I.pos+=K+W+1,q+j.slice(0,W)):!1},f=function(I){const B=/^#\?(\S+)/,N=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,V=/^\s*FORMAT=(\S+)\s*$/,W=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,K={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let q,j;for((I.pos>=I.byteLength||!(q=d(I)))&&a(1,"no header found"),(j=q.match(B))||a(3,"bad initial token"),K.valid|=1,K.programtype=j[1],K.string+=q+`
`;q=d(I),q!==!1;){if(K.string+=q+`
`,q.charAt(0)==="#"){K.comments+=q+`
`;continue}if((j=q.match(N))&&(K.gamma=parseFloat(j[1])),(j=q.match(U))&&(K.exposure=parseFloat(j[1])),(j=q.match(V))&&(K.valid|=2,K.format=j[1]),(j=q.match(W))&&(K.valid|=4,K.height=parseInt(j[1],10),K.width=parseInt(j[2],10)),K.valid&2&&K.valid&4)break}return K.valid&2||a(3,"missing format specifier"),K.valid&4||a(3,"missing image size specifier"),K},m=function(I,B,N){const U=B;if(U<8||U>32767||I[0]!==2||I[1]!==2||I[2]&128)return new Uint8Array(I);U!==(I[2]<<8|I[3])&&a(3,"wrong scanline width");const V=new Uint8Array(4*B*N);V.length||a(4,"unable to allocate buffer space");let W=0,K=0;const q=4*U,j=new Uint8Array(4),te=new Uint8Array(q);let he=N;for(;he>0&&K<I.byteLength;){K+4>I.byteLength&&a(1),j[0]=I[K++],j[1]=I[K++],j[2]=I[K++],j[3]=I[K++],(j[0]!=2||j[1]!=2||(j[2]<<8|j[3])!=U)&&a(3,"bad rgbe scanline format");let _e=0,Be;for(;_e<q&&K<I.byteLength;){Be=I[K++];const ce=Be>128;if(ce&&(Be-=128),(Be===0||_e+Be>q)&&a(3,"bad scanline data"),ce){const Ce=I[K++];for(let Oe=0;Oe<Be;Oe++)te[_e++]=Ce}else te.set(I.subarray(K,K+Be),_e),_e+=Be,K+=Be}const ue=U;for(let ce=0;ce<ue;ce++){let Ce=0;V[W]=te[ce+Ce],Ce+=U,V[W+1]=te[ce+Ce],Ce+=U,V[W+2]=te[ce+Ce],Ce+=U,V[W+3]=te[ce+Ce],W+=4}he--}return V},y=function(I,B,N,U){const V=I[B+3],W=Math.pow(2,V-128)/255;N[U+0]=I[B+0]*W,N[U+1]=I[B+1]*W,N[U+2]=I[B+2]*W,N[U+3]=1},_=function(I,B,N,U){const V=I[B+3],W=Math.pow(2,V-128)/255;N[U+0]=Xy.toHalfFloat(Math.min(I[B+0]*W,65504)),N[U+1]=Xy.toHalfFloat(Math.min(I[B+1]*W,65504)),N[U+2]=Xy.toHalfFloat(Math.min(I[B+2]*W,65504)),N[U+3]=Xy.toHalfFloat(1)},S=new Uint8Array(e);S.pos=0;const b=f(S),M=b.width,w=b.height,T=m(S.subarray(S.pos),M,w);let E,R,P;switch(this.type){case wr:P=T.length/4;const I=new Float32Array(P*4);for(let N=0;N<P;N++)y(T,N*4,I,N*4);E=I,R=wr;break;case zi:P=T.length/4;const B=new Uint16Array(P*4);for(let N=0;N<P;N++)_(T,N*4,B,N*4);E=B,R=zi;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:M,height:w,data:E,header:b.string,gamma:b.gamma,exposure:b.exposure,type:R}}setDataType(e){return this.type=e,this}load(e,t,i,r){function s(a,o){switch(a.type){case wr:case zi:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=Jn,a.magFilter=Jn,a.generateMipmaps=!1,a.flipY=!0;break}t&&t(a,o)}return super.load(e,s,i,r)}}const _C=CH>=152;class iWe extends xF{constructor(e){super(e),this.type=zi}parse(e){const B=Math.pow(2.7182818,2.2);function N(ie,ye){for(var Ue=0,dt=0;dt<65536;++dt)(dt==0||ie[dt>>3]&1<<(dt&7))&&(ye[Ue++]=dt);for(var Ct=Ue-1;Ue<65536;)ye[Ue++]=0;return Ct}function U(ie){for(var ye=0;ye<16384;ye++)ie[ye]={},ie[ye].len=0,ie[ye].lit=0,ie[ye].p=null}const V={l:0,c:0,lc:0};function W(ie,ye,Ue,dt,Ct){for(;Ue<ie;)ye=ye<<8|Ft(dt,Ct),Ue+=8;Ue-=ie,V.l=ye>>Ue&(1<<ie)-1,V.c=ye,V.lc=Ue}const K=new Array(59);function q(ie){for(var ye=0;ye<=58;++ye)K[ye]=0;for(var ye=0;ye<65537;++ye)K[ie[ye]]+=1;for(var Ue=0,ye=58;ye>0;--ye){var dt=Ue+K[ye]>>1;K[ye]=Ue,Ue=dt}for(var ye=0;ye<65537;++ye){var Ct=ie[ye];Ct>0&&(ie[ye]=Ct|K[Ct]++<<6)}}function j(ie,ye,Ue,dt,Ct,wt,sn){for(var Qt=Ue,on=0,ln=0;Ct<=wt;Ct++){if(Qt.value-Ue.value>dt)return!1;W(6,on,ln,ie,Qt);var gn=V.l;if(on=V.c,ln=V.lc,sn[Ct]=gn,gn==63){if(Qt.value-Ue.value>dt)throw"Something wrong with hufUnpackEncTable";W(8,on,ln,ie,Qt);var fn=V.l+6;if(on=V.c,ln=V.lc,Ct+fn>wt+1)throw"Something wrong with hufUnpackEncTable";for(;fn--;)sn[Ct++]=0;Ct--}else if(gn>=59){var fn=gn-59+2;if(Ct+fn>wt+1)throw"Something wrong with hufUnpackEncTable";for(;fn--;)sn[Ct++]=0;Ct--}}q(sn)}function te(ie){return ie&63}function he(ie){return ie>>6}function _e(ie,ye,Ue,dt){for(;ye<=Ue;ye++){var Ct=he(ie[ye]),wt=te(ie[ye]);if(Ct>>wt)throw"Invalid table entry";if(wt>14){var sn=dt[Ct>>wt-14];if(sn.len)throw"Invalid table entry";if(sn.lit++,sn.p){var Qt=sn.p;sn.p=new Array(sn.lit);for(var on=0;on<sn.lit-1;++on)sn.p[on]=Qt[on]}else sn.p=new Array(1);sn.p[sn.lit-1]=ye}else if(wt)for(var ln=0,on=1<<14-wt;on>0;on--){var sn=dt[(Ct<<14-wt)+ln];if(sn.len||sn.p)throw"Invalid table entry";sn.len=wt,sn.lit=ye,ln++}}return!0}const Be={c:0,lc:0};function ue(ie,ye,Ue,dt){ie=ie<<8|Ft(Ue,dt),ye+=8,Be.c=ie,Be.lc=ye}const ce={c:0,lc:0};function Ce(ie,ye,Ue,dt,Ct,wt,sn,Qt,on,ln){if(ie==ye){dt<8&&(ue(Ue,dt,Ct,sn),Ue=Be.c,dt=Be.lc),dt-=8;var gn=Ue>>dt,gn=new Uint8Array([gn])[0];if(on.value+gn>ln)return!1;for(var fn=Qt[on.value-1];gn-- >0;)Qt[on.value++]=fn}else if(on.value<ln)Qt[on.value++]=ie;else return!1;ce.c=Ue,ce.lc=dt}function Oe(ie){return ie&65535}function nt(ie){var ye=Oe(ie);return ye>32767?ye-65536:ye}const Ae={a:0,b:0};function Ye(ie,ye){var Ue=nt(ie),dt=nt(ye),Ct=dt,wt=Ue+(Ct&1)+(Ct>>1),sn=wt,Qt=wt-Ct;Ae.a=sn,Ae.b=Qt}function ft(ie,ye){var Ue=Oe(ie),dt=Oe(ye),Ct=Ue-(dt>>1)&65535,wt=dt+Ct-32768&65535;Ae.a=wt,Ae.b=Ct}function ze(ie,ye,Ue,dt,Ct,wt,sn){for(var Qt=sn<16384,on=Ue>Ct?Ct:Ue,ln=1,gn;ln<=on;)ln<<=1;for(ln>>=1,gn=ln,ln>>=1;ln>=1;){for(var fn=0,de=fn+wt*(Ct-gn),Fe=wt*ln,$e=wt*gn,Ke=dt*ln,Ze=dt*gn,zt,Jt,Vt,Rn;fn<=de;fn+=$e){for(var yn=fn,jn=fn+dt*(Ue-gn);yn<=jn;yn+=Ze){var bn=yn+Ke,zn=yn+Fe,Bi=zn+Ke;Qt?(Ye(ie[yn+ye],ie[zn+ye]),zt=Ae.a,Vt=Ae.b,Ye(ie[bn+ye],ie[Bi+ye]),Jt=Ae.a,Rn=Ae.b,Ye(zt,Jt),ie[yn+ye]=Ae.a,ie[bn+ye]=Ae.b,Ye(Vt,Rn),ie[zn+ye]=Ae.a,ie[Bi+ye]=Ae.b):(ft(ie[yn+ye],ie[zn+ye]),zt=Ae.a,Vt=Ae.b,ft(ie[bn+ye],ie[Bi+ye]),Jt=Ae.a,Rn=Ae.b,ft(zt,Jt),ie[yn+ye]=Ae.a,ie[bn+ye]=Ae.b,ft(Vt,Rn),ie[zn+ye]=Ae.a,ie[Bi+ye]=Ae.b)}if(Ue&ln){var zn=yn+Fe;Qt?Ye(ie[yn+ye],ie[zn+ye]):ft(ie[yn+ye],ie[zn+ye]),zt=Ae.a,ie[zn+ye]=Ae.b,ie[yn+ye]=zt}}if(Ct&ln)for(var yn=fn,jn=fn+dt*(Ue-gn);yn<=jn;yn+=Ze){var bn=yn+Ke;Qt?Ye(ie[yn+ye],ie[bn+ye]):ft(ie[yn+ye],ie[bn+ye]),zt=Ae.a,ie[bn+ye]=Ae.b,ie[yn+ye]=zt}gn=ln,ln>>=1}return fn}function ot(ie,ye,Ue,dt,Ct,wt,sn,Qt,on,ln){for(var gn=0,fn=0,de=Qt,Fe=Math.trunc(Ct.value+(wt+7)/8);Ct.value<Fe;)for(ue(gn,fn,Ue,Ct),gn=Be.c,fn=Be.lc;fn>=14;){var $e=gn>>fn-14&16383,Ke=ye[$e];if(Ke.len)fn-=Ke.len,Ce(Ke.lit,sn,gn,fn,Ue,dt,Ct,on,ln,de),gn=ce.c,fn=ce.lc;else{if(!Ke.p)throw"hufDecode issues";var Ze;for(Ze=0;Ze<Ke.lit;Ze++){for(var zt=te(ie[Ke.p[Ze]]);fn<zt&&Ct.value<Fe;)ue(gn,fn,Ue,Ct),gn=Be.c,fn=Be.lc;if(fn>=zt&&he(ie[Ke.p[Ze]])==(gn>>fn-zt&(1<<zt)-1)){fn-=zt,Ce(Ke.p[Ze],sn,gn,fn,Ue,dt,Ct,on,ln,de),gn=ce.c,fn=ce.lc;break}}if(Ze==Ke.lit)throw"hufDecode issues"}}var Jt=8-wt&7;for(gn>>=Jt,fn-=Jt;fn>0;){var Ke=ye[gn<<14-fn&16383];if(Ke.len)fn-=Ke.len,Ce(Ke.lit,sn,gn,fn,Ue,dt,Ct,on,ln,de),gn=ce.c,fn=ce.lc;else throw"hufDecode issues"}return!0}function ut(ie,ye,Ue,dt,Ct,wt){var sn={value:0},Qt=Ue.value,on=st(ye,Ue),ln=st(ye,Ue);Ue.value+=4;var gn=st(ye,Ue);if(Ue.value+=4,on<0||on>=65537||ln<0||ln>=65537)throw"Something wrong with HUF_ENCSIZE";var fn=new Array(65537),de=new Array(16384);U(de);var Fe=dt-(Ue.value-Qt);if(j(ie,ye,Ue,Fe,on,ln,fn),gn>8*(dt-(Ue.value-Qt)))throw"Something wrong with hufUncompress";_e(fn,on,ln,de),ot(fn,de,ie,ye,Ue,gn,ln,wt,Ct,sn)}function Wt(ie,ye,Ue){for(var dt=0;dt<Ue;++dt)ye[dt]=ie[ye[dt]]}function It(ie){for(var ye=1;ye<ie.length;ye++){var Ue=ie[ye-1]+ie[ye]-128;ie[ye]=Ue}}function ke(ie,ye){for(var Ue=0,dt=Math.floor((ie.length+1)/2),Ct=0,wt=ie.length-1;!(Ct>wt||(ye[Ct++]=ie[Ue++],Ct>wt));)ye[Ct++]=ie[dt++]}function je(ie){for(var ye=ie.byteLength,Ue=new Array,dt=0,Ct=new DataView(ie);ye>0;){var wt=Ct.getInt8(dt++);if(wt<0){var sn=-wt;ye-=sn+1;for(var Qt=0;Qt<sn;Qt++)Ue.push(Ct.getUint8(dt++))}else{var sn=wt;ye-=2;for(var on=Ct.getUint8(dt++),Qt=0;Qt<sn+1;Qt++)Ue.push(on)}}return Ue}function gt(ie,ye,Ue,dt,Ct,wt){var bn=new DataView(wt.buffer),sn=Ue[ie.idx[0]].width,Qt=Ue[ie.idx[0]].height,on=3,ln=Math.floor(sn/8),gn=Math.ceil(sn/8),fn=Math.ceil(Qt/8),de=sn-(gn-1)*8,Fe=Qt-(fn-1)*8,$e={value:0},Ke=new Array(on),Ze=new Array(on),zt=new Array(on),Jt=new Array(on),Vt=new Array(on);for(let On=0;On<on;++On)Vt[On]=ye[ie.idx[On]],Ke[On]=On<1?0:Ke[On-1]+gn*fn,Ze[On]=new Float32Array(64),zt[On]=new Uint16Array(64),Jt[On]=new Uint16Array(gn*64);for(let On=0;On<fn;++On){var Rn=8;On==fn-1&&(Rn=Fe);var yn=8;for(let ei=0;ei<gn;++ei){ei==gn-1&&(yn=de);for(let Bn=0;Bn<on;++Bn)zt[Bn].fill(0),zt[Bn][0]=Ct[Ke[Bn]++],yt($e,dt,zt[Bn]),ve(zt[Bn],Ze[Bn]),An(Ze[Bn]);cn(Ze);for(let Bn=0;Bn<on;++Bn)In(Ze[Bn],Jt[Bn],ei*64)}let qt=0;for(let ei=0;ei<on;++ei){const Bn=Ue[ie.idx[ei]].type;for(let tr=8*On;tr<8*On+Rn;++tr){qt=Vt[ei][tr];for(let qs=0;qs<ln;++qs){const Wi=qs*64+(tr&7)*8;bn.setUint16(qt+0*Bn,Jt[ei][Wi+0],!0),bn.setUint16(qt+2*Bn,Jt[ei][Wi+1],!0),bn.setUint16(qt+4*Bn,Jt[ei][Wi+2],!0),bn.setUint16(qt+6*Bn,Jt[ei][Wi+3],!0),bn.setUint16(qt+8*Bn,Jt[ei][Wi+4],!0),bn.setUint16(qt+10*Bn,Jt[ei][Wi+5],!0),bn.setUint16(qt+12*Bn,Jt[ei][Wi+6],!0),bn.setUint16(qt+14*Bn,Jt[ei][Wi+7],!0),qt+=16*Bn}}if(ln!=gn)for(let tr=8*On;tr<8*On+Rn;++tr){const qs=Vt[ei][tr]+8*ln*2*Bn,Wi=ln*64+(tr&7)*8;for(let Ss=0;Ss<yn;++Ss)bn.setUint16(qs+Ss*2*Bn,Jt[ei][Wi+Ss],!0)}}}for(var jn=new Uint16Array(sn),bn=new DataView(wt.buffer),zn=0;zn<on;++zn){Ue[ie.idx[zn]].decoded=!0;var Bi=Ue[ie.idx[zn]].type;if(Ue[zn].type==2)for(var _r=0;_r<Qt;++_r){const On=Vt[zn][_r];for(var Oi=0;Oi<sn;++Oi)jn[Oi]=bn.getUint16(On+Oi*2*Bi,!0);for(var Oi=0;Oi<sn;++Oi)bn.setFloat32(On+Oi*2*Bi,it(jn[Oi]),!0)}}}function yt(ie,ye,Ue){for(var dt,Ct=1;Ct<64;)dt=ye[ie.value],dt==65280?Ct=64:dt>>8==255?Ct+=dt&255:(Ue[Ct]=dt,Ct++),ie.value++}function ve(ie,ye){ye[0]=it(ie[0]),ye[1]=it(ie[1]),ye[2]=it(ie[5]),ye[3]=it(ie[6]),ye[4]=it(ie[14]),ye[5]=it(ie[15]),ye[6]=it(ie[27]),ye[7]=it(ie[28]),ye[8]=it(ie[2]),ye[9]=it(ie[4]),ye[10]=it(ie[7]),ye[11]=it(ie[13]),ye[12]=it(ie[16]),ye[13]=it(ie[26]),ye[14]=it(ie[29]),ye[15]=it(ie[42]),ye[16]=it(ie[3]),ye[17]=it(ie[8]),ye[18]=it(ie[12]),ye[19]=it(ie[17]),ye[20]=it(ie[25]),ye[21]=it(ie[30]),ye[22]=it(ie[41]),ye[23]=it(ie[43]),ye[24]=it(ie[9]),ye[25]=it(ie[11]),ye[26]=it(ie[18]),ye[27]=it(ie[24]),ye[28]=it(ie[31]),ye[29]=it(ie[40]),ye[30]=it(ie[44]),ye[31]=it(ie[53]),ye[32]=it(ie[10]),ye[33]=it(ie[19]),ye[34]=it(ie[23]),ye[35]=it(ie[32]),ye[36]=it(ie[39]),ye[37]=it(ie[45]),ye[38]=it(ie[52]),ye[39]=it(ie[54]),ye[40]=it(ie[20]),ye[41]=it(ie[22]),ye[42]=it(ie[33]),ye[43]=it(ie[38]),ye[44]=it(ie[46]),ye[45]=it(ie[51]),ye[46]=it(ie[55]),ye[47]=it(ie[60]),ye[48]=it(ie[21]),ye[49]=it(ie[34]),ye[50]=it(ie[37]),ye[51]=it(ie[47]),ye[52]=it(ie[50]),ye[53]=it(ie[56]),ye[54]=it(ie[59]),ye[55]=it(ie[61]),ye[56]=it(ie[35]),ye[57]=it(ie[36]),ye[58]=it(ie[48]),ye[59]=it(ie[49]),ye[60]=it(ie[57]),ye[61]=it(ie[58]),ye[62]=it(ie[62]),ye[63]=it(ie[63])}function An(ie){const ye=.5*Math.cos(.7853975),Ue=.5*Math.cos(3.14159/16),dt=.5*Math.cos(3.14159/8),Ct=.5*Math.cos(3*3.14159/16),wt=.5*Math.cos(5*3.14159/16),sn=.5*Math.cos(3*3.14159/8),Qt=.5*Math.cos(7*3.14159/16);for(var on=new Array(4),ln=new Array(4),gn=new Array(4),fn=new Array(4),de=0;de<8;++de){var Fe=de*8;on[0]=dt*ie[Fe+2],on[1]=sn*ie[Fe+2],on[2]=dt*ie[Fe+6],on[3]=sn*ie[Fe+6],ln[0]=Ue*ie[Fe+1]+Ct*ie[Fe+3]+wt*ie[Fe+5]+Qt*ie[Fe+7],ln[1]=Ct*ie[Fe+1]-Qt*ie[Fe+3]-Ue*ie[Fe+5]-wt*ie[Fe+7],ln[2]=wt*ie[Fe+1]-Ue*ie[Fe+3]+Qt*ie[Fe+5]+Ct*ie[Fe+7],ln[3]=Qt*ie[Fe+1]-wt*ie[Fe+3]+Ct*ie[Fe+5]-Ue*ie[Fe+7],gn[0]=ye*(ie[Fe+0]+ie[Fe+4]),gn[3]=ye*(ie[Fe+0]-ie[Fe+4]),gn[1]=on[0]+on[3],gn[2]=on[1]-on[2],fn[0]=gn[0]+gn[1],fn[1]=gn[3]+gn[2],fn[2]=gn[3]-gn[2],fn[3]=gn[0]-gn[1],ie[Fe+0]=fn[0]+ln[0],ie[Fe+1]=fn[1]+ln[1],ie[Fe+2]=fn[2]+ln[2],ie[Fe+3]=fn[3]+ln[3],ie[Fe+4]=fn[3]-ln[3],ie[Fe+5]=fn[2]-ln[2],ie[Fe+6]=fn[1]-ln[1],ie[Fe+7]=fn[0]-ln[0]}for(var $e=0;$e<8;++$e)on[0]=dt*ie[16+$e],on[1]=sn*ie[16+$e],on[2]=dt*ie[48+$e],on[3]=sn*ie[48+$e],ln[0]=Ue*ie[8+$e]+Ct*ie[24+$e]+wt*ie[40+$e]+Qt*ie[56+$e],ln[1]=Ct*ie[8+$e]-Qt*ie[24+$e]-Ue*ie[40+$e]-wt*ie[56+$e],ln[2]=wt*ie[8+$e]-Ue*ie[24+$e]+Qt*ie[40+$e]+Ct*ie[56+$e],ln[3]=Qt*ie[8+$e]-wt*ie[24+$e]+Ct*ie[40+$e]-Ue*ie[56+$e],gn[0]=ye*(ie[$e]+ie[32+$e]),gn[3]=ye*(ie[$e]-ie[32+$e]),gn[1]=on[0]+on[3],gn[2]=on[1]-on[2],fn[0]=gn[0]+gn[1],fn[1]=gn[3]+gn[2],fn[2]=gn[3]-gn[2],fn[3]=gn[0]-gn[1],ie[0+$e]=fn[0]+ln[0],ie[8+$e]=fn[1]+ln[1],ie[16+$e]=fn[2]+ln[2],ie[24+$e]=fn[3]+ln[3],ie[32+$e]=fn[3]-ln[3],ie[40+$e]=fn[2]-ln[2],ie[48+$e]=fn[1]-ln[1],ie[56+$e]=fn[0]-ln[0]}function cn(ie){for(var ye=0;ye<64;++ye){var Ue=ie[0][ye],dt=ie[1][ye],Ct=ie[2][ye];ie[0][ye]=Ue+1.5747*Ct,ie[1][ye]=Ue-.1873*dt-.4682*Ct,ie[2][ye]=Ue+1.8556*dt}}function In(ie,ye,Ue){for(var dt=0;dt<64;++dt)ye[Ue+dt]=Xy.toHalfFloat(Zt(ie[dt]))}function Zt(ie){return ie<=1?Math.sign(ie)*Math.pow(Math.abs(ie),2.2):Math.sign(ie)*Math.pow(B,Math.abs(ie)-1)}function le(ie){return new DataView(ie.array.buffer,ie.offset.value,ie.size)}function ee(ie){var ye=ie.viewer.buffer.slice(ie.offset.value,ie.offset.value+ie.size),Ue=new Uint8Array(je(ye)),dt=new Uint8Array(Ue.length);return It(Ue),ke(Ue,dt),new DataView(dt.buffer)}function Re(ie){var ye=ie.array.slice(ie.offset.value,ie.offset.value+ie.size),Ue=HD(ye),dt=new Uint8Array(Ue.length);return It(Ue),ke(Ue,dt),new DataView(dt.buffer)}function tt(ie){for(var ye=ie.viewer,Ue={value:ie.offset.value},dt=new Uint16Array(ie.width*ie.scanlineBlockSize*(ie.channels*ie.type)),Ct=new Uint8Array(8192),wt=0,sn=new Array(ie.channels),Qt=0;Qt<ie.channels;Qt++)sn[Qt]={},sn[Qt].start=wt,sn[Qt].end=sn[Qt].start,sn[Qt].nx=ie.width,sn[Qt].ny=ie.lines,sn[Qt].size=ie.type,wt+=sn[Qt].nx*sn[Qt].ny*sn[Qt].size;var on=kt(ye,Ue),ln=kt(ye,Ue);if(ln>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(on<=ln)for(var Qt=0;Qt<ln-on+1;Qt++)Ct[Qt+on]=Se(ye,Ue);var gn=new Uint16Array(65536),fn=N(Ct,gn),de=st(ye,Ue);ut(ie.array,ye,Ue,de,dt,wt);for(var Qt=0;Qt<ie.channels;++Qt)for(var Fe=sn[Qt],$e=0;$e<sn[Qt].size;++$e)ze(dt,Fe.start+$e,Fe.nx,Fe.size,Fe.ny,Fe.nx*Fe.size,fn);Wt(gn,dt,wt);for(var Ke=0,Ze=new Uint8Array(dt.buffer.byteLength),zt=0;zt<ie.lines;zt++)for(var Jt=0;Jt<ie.channels;Jt++){var Fe=sn[Jt],Vt=Fe.nx*Fe.size,Rn=new Uint8Array(dt.buffer,Fe.end*2,Vt*2);Ze.set(Rn,Ke),Ke+=Vt*2,Fe.end+=Vt}return new DataView(Ze.buffer)}function et(ie){var ye=ie.array.slice(ie.offset.value,ie.offset.value+ie.size),Ue=HD(ye);const dt=ie.lines*ie.channels*ie.width,Ct=ie.type==1?new Uint16Array(dt):new Uint32Array(dt);let wt=0,sn=0;const Qt=new Array(4);for(let on=0;on<ie.lines;on++)for(let ln=0;ln<ie.channels;ln++){let gn=0;switch(ie.type){case 1:Qt[0]=wt,Qt[1]=Qt[0]+ie.width,wt=Qt[1]+ie.width;for(let fn=0;fn<ie.width;++fn){const de=Ue[Qt[0]++]<<8|Ue[Qt[1]++];gn+=de,Ct[sn]=gn,sn++}break;case 2:Qt[0]=wt,Qt[1]=Qt[0]+ie.width,Qt[2]=Qt[1]+ie.width,wt=Qt[2]+ie.width;for(let fn=0;fn<ie.width;++fn){const de=Ue[Qt[0]++]<<24|Ue[Qt[1]++]<<16|Ue[Qt[2]++]<<8;gn+=de,Ct[sn]=gn,sn++}break}}return new DataView(Ct.buffer)}function at(ie){var ye=ie.viewer,Ue={value:ie.offset.value},dt=new Uint8Array(ie.width*ie.lines*(ie.channels*ie.type*2)),Ct={version:Je(ye,Ue),unknownUncompressedSize:Je(ye,Ue),unknownCompressedSize:Je(ye,Ue),acCompressedSize:Je(ye,Ue),dcCompressedSize:Je(ye,Ue),rleCompressedSize:Je(ye,Ue),rleUncompressedSize:Je(ye,Ue),rleRawSize:Je(ye,Ue),totalAcUncompressedCount:Je(ye,Ue),totalDcUncompressedCount:Je(ye,Ue),acCompression:Je(ye,Ue)};if(Ct.version<2)throw"EXRLoader.parse: "+Vi.compression+" version "+Ct.version+" is unsupported";for(var wt=new Array,sn=kt(ye,Ue)-2;sn>0;){var Qt=jt(ye.buffer,Ue),on=Se(ye,Ue),ln=on>>2&3,gn=(on>>4)-1,fn=new Int8Array([gn])[0],de=Se(ye,Ue);wt.push({name:Qt,index:fn,type:de,compression:ln}),sn-=Qt.length+3}for(var Fe=Vi.channels,$e=new Array(ie.channels),Ke=0;Ke<ie.channels;++Ke){var Ze=$e[Ke]={},zt=Fe[Ke];Ze.name=zt.name,Ze.compression=0,Ze.decoded=!1,Ze.type=zt.pixelType,Ze.pLinear=zt.pLinear,Ze.width=ie.width,Ze.height=ie.lines}for(var Jt={idx:new Array(3)},Vt=0;Vt<ie.channels;++Vt)for(var Ze=$e[Vt],Ke=0;Ke<wt.length;++Ke){var Rn=wt[Ke];Ze.name==Rn.name&&(Ze.compression=Rn.compression,Rn.index>=0&&(Jt.idx[Rn.index]=Vt),Ze.offset=Vt)}if(Ct.acCompressedSize>0)switch(Ct.acCompression){case 0:var bn=new Uint16Array(Ct.totalAcUncompressedCount);ut(ie.array,ye,Ue,Ct.acCompressedSize,bn,Ct.totalAcUncompressedCount);break;case 1:var yn=ie.array.slice(Ue.value,Ue.value+Ct.totalAcUncompressedCount),jn=HD(yn),bn=new Uint16Array(jn.buffer);Ue.value+=Ct.totalAcUncompressedCount;break}if(Ct.dcCompressedSize>0){var zn={array:ie.array,offset:Ue,size:Ct.dcCompressedSize},Bi=new Uint16Array(Re(zn).buffer);Ue.value+=Ct.dcCompressedSize}if(Ct.rleRawSize>0){var yn=ie.array.slice(Ue.value,Ue.value+Ct.rleCompressedSize),jn=HD(yn),_r=je(jn.buffer);Ue.value+=Ct.rleCompressedSize}for(var Oi=0,On=new Array($e.length),Ke=0;Ke<On.length;++Ke)On[Ke]=new Array;for(var qt=0;qt<ie.lines;++qt)for(var ei=0;ei<$e.length;++ei)On[ei].push(Oi),Oi+=$e[ei].width*ie.type*2;gt(Jt,On,$e,bn,Bi,dt);for(var Ke=0;Ke<$e.length;++Ke){var Ze=$e[Ke];if(!Ze.decoded)switch(Ze.compression){case 2:for(var Bn=0,tr=0,qt=0;qt<ie.lines;++qt){for(var qs=On[Ke][Bn],Wi=0;Wi<Ze.width;++Wi){for(var Ss=0;Ss<2*Ze.type;++Ss)dt[qs++]=_r[tr+Ss*Ze.width*Ze.height];tr++}Bn++}break;default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(dt.buffer)}function jt(ie,ye){for(var Ue=new Uint8Array(ie),dt=0;Ue[ye.value+dt]!=0;)dt+=1;var Ct=new TextDecoder().decode(Ue.slice(ye.value,ye.value+dt));return ye.value=ye.value+dt+1,Ct}function rn(ie,ye,Ue){var dt=new TextDecoder().decode(new Uint8Array(ie).slice(ye.value,ye.value+Ue));return ye.value=ye.value+Ue,dt}function Nn(ie,ye){var Ue=Gt(ie,ye),dt=st(ie,ye);return[Ue,dt]}function Fn(ie,ye){var Ue=st(ie,ye),dt=st(ie,ye);return[Ue,dt]}function Gt(ie,ye){var Ue=ie.getInt32(ye.value,!0);return ye.value=ye.value+4,Ue}function st(ie,ye){var Ue=ie.getUint32(ye.value,!0);return ye.value=ye.value+4,Ue}function Ft(ie,ye){var Ue=ie[ye.value];return ye.value=ye.value+1,Ue}function Se(ie,ye){var Ue=ie.getUint8(ye.value);return ye.value=ye.value+1,Ue}const Je=function(ie,ye){let Ue;return"getBigInt64"in DataView.prototype?Ue=Number(ie.getBigInt64(ye.value,!0)):Ue=ie.getUint32(ye.value+4,!0)+Number(ie.getUint32(ye.value,!0)<<32),ye.value+=8,Ue};function St(ie,ye){var Ue=ie.getFloat32(ye.value,!0);return ye.value+=4,Ue}function Ne(ie,ye){return Xy.toHalfFloat(St(ie,ye))}function it(ie){var ye=(ie&31744)>>10,Ue=ie&1023;return(ie>>15?-1:1)*(ye?ye===31?Ue?NaN:1/0:Math.pow(2,ye-15)*(1+Ue/1024):6103515625e-14*(Ue/1024))}function kt(ie,ye){var Ue=ie.getUint16(ye.value,!0);return ye.value+=2,Ue}function vn(ie,ye){return it(kt(ie,ye))}function Kt(ie,ye,Ue,dt){for(var Ct=Ue.value,wt=[];Ue.value<Ct+dt-1;){var sn=jt(ye,Ue),Qt=Gt(ie,Ue),on=Se(ie,Ue);Ue.value+=3;var ln=Gt(ie,Ue),gn=Gt(ie,Ue);wt.push({name:sn,pixelType:Qt,pLinear:on,xSampling:ln,ySampling:gn})}return Ue.value+=1,wt}function Ut(ie,ye){var Ue=St(ie,ye),dt=St(ie,ye),Ct=St(ie,ye),wt=St(ie,ye),sn=St(ie,ye),Qt=St(ie,ye),on=St(ie,ye),ln=St(ie,ye);return{redX:Ue,redY:dt,greenX:Ct,greenY:wt,blueX:sn,blueY:Qt,whiteX:on,whiteY:ln}}function z(ie,ye){var Ue=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],dt=Se(ie,ye);return Ue[dt]}function se(ie,ye){var Ue=st(ie,ye),dt=st(ie,ye),Ct=st(ie,ye),wt=st(ie,ye);return{xMin:Ue,yMin:dt,xMax:Ct,yMax:wt}}function ne(ie,ye){var Ue=["INCREASING_Y"],dt=Se(ie,ye);return Ue[dt]}function ae(ie,ye){var Ue=St(ie,ye),dt=St(ie,ye);return[Ue,dt]}function be(ie,ye){var Ue=St(ie,ye),dt=St(ie,ye),Ct=St(ie,ye);return[Ue,dt,Ct]}function pt(ie,ye,Ue,dt,Ct){if(dt==="string"||dt==="stringvector"||dt==="iccProfile")return rn(ye,Ue,Ct);if(dt==="chlist")return Kt(ie,ye,Ue,Ct);if(dt==="chromaticities")return Ut(ie,Ue);if(dt==="compression")return z(ie,Ue);if(dt==="box2i")return se(ie,Ue);if(dt==="lineOrder")return ne(ie,Ue);if(dt==="float")return St(ie,Ue);if(dt==="v2f")return ae(ie,Ue);if(dt==="v3f")return be(ie,Ue);if(dt==="int")return Gt(ie,Ue);if(dt==="rational")return Nn(ie,Ue);if(dt==="timecode")return Fn(ie,Ue);if(dt==="preview")return Ue.value+=Ct,"skipped";Ue.value+=Ct}function Bt(ie,ye,Ue){const dt={};if(ie.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";dt.version=ie.getUint8(4);const Ct=ie.getUint8(5);dt.spec={singleTile:!!(Ct&2),longName:!!(Ct&4),deepFormat:!!(Ct&8),multiPart:!!(Ct&16)},Ue.value=8;for(var wt=!0;wt;){var sn=jt(ye,Ue);if(sn==0)wt=!1;else{var Qt=jt(ye,Ue),on=st(ie,Ue),ln=pt(ie,ye,Ue,Qt,on);ln===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Qt}'.`):dt[sn]=ln}}if((Ct&-5)!=0)throw console.error("EXRHeader:",dt),"THREE.EXRLoader: provided file is currently unsupported.";return dt}function tn(ie,ye,Ue,dt,Ct){const wt={size:0,viewer:ye,array:Ue,offset:dt,width:ie.dataWindow.xMax-ie.dataWindow.xMin+1,height:ie.dataWindow.yMax-ie.dataWindow.yMin+1,channels:ie.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:ie.channels[0].pixelType,uncompress:null,getter:null,format:null,[_C?"colorSpace":"encoding"]:null};switch(ie.compression){case"NO_COMPRESSION":wt.lines=1,wt.uncompress=le;break;case"RLE_COMPRESSION":wt.lines=1,wt.uncompress=ee;break;case"ZIPS_COMPRESSION":wt.lines=1,wt.uncompress=Re;break;case"ZIP_COMPRESSION":wt.lines=16,wt.uncompress=Re;break;case"PIZ_COMPRESSION":wt.lines=32,wt.uncompress=tt;break;case"PXR24_COMPRESSION":wt.lines=16,wt.uncompress=et;break;case"DWAA_COMPRESSION":wt.lines=32,wt.uncompress=at;break;case"DWAB_COMPRESSION":wt.lines=256,wt.uncompress=at;break;default:throw"EXRLoader.parse: "+ie.compression+" is unsupported"}if(wt.scanlineBlockSize=wt.lines,wt.type==1)switch(Ct){case wr:wt.getter=vn,wt.inputSize=2;break;case zi:wt.getter=kt,wt.inputSize=2;break}else if(wt.type==2)switch(Ct){case wr:wt.getter=St,wt.inputSize=4;break;case zi:wt.getter=Ne,wt.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+wt.type+" for "+ie.compression+".";wt.blockCount=(ie.dataWindow.yMax+1)/wt.scanlineBlockSize;for(var sn=0;sn<wt.blockCount;sn++)Je(ye,dt);wt.outputChannels=wt.channels==3?4:wt.channels;const Qt=wt.width*wt.height*wt.outputChannels;switch(Ct){case wr:wt.byteArray=new Float32Array(Qt),wt.channels<wt.outputChannels&&wt.byteArray.fill(1,0,Qt);break;case zi:wt.byteArray=new Uint16Array(Qt),wt.channels<wt.outputChannels&&wt.byteArray.fill(15360,0,Qt);break;default:console.error("THREE.EXRLoader: unsupported type: ",Ct);break}return wt.bytesPerLine=wt.width*wt.inputSize*wt.channels,wt.outputChannels==4?wt.format=Vr:wt.format=rp,_C?wt.colorSpace="srgb-linear":wt.encoding=3e3,wt}const Tn=new DataView(e),yi=new Uint8Array(e),er={value:0},Vi=Bt(Tn,e,er),Zn=tn(Vi,Tn,yi,er,this.type),Xs={value:0},es={R:0,G:1,B:2,A:3,Y:0};for(let ie=0;ie<Zn.height/Zn.scanlineBlockSize;ie++){const ye=st(Tn,er);Zn.size=st(Tn,er),Zn.lines=ye+Zn.scanlineBlockSize>Zn.height?Zn.height-ye:Zn.scanlineBlockSize;const dt=Zn.size<Zn.lines*Zn.bytesPerLine?Zn.uncompress(Zn):le(Zn);er.value+=Zn.size;for(let Ct=0;Ct<Zn.scanlineBlockSize;Ct++){const wt=Ct+ie*Zn.scanlineBlockSize;if(wt>=Zn.height)break;for(let sn=0;sn<Zn.channels;sn++){const Qt=es[Vi.channels[sn].name];for(let on=0;on<Zn.width;on++){Xs.value=(Ct*(Zn.channels*Zn.width)+sn*Zn.width+on)*Zn.inputSize;const ln=(Zn.height-1-wt)*(Zn.width*Zn.outputChannels)+on*Zn.outputChannels+Qt;Zn.byteArray[ln]=Zn.getter(dt,Xs)}}}}return{header:Vi,width:Zn.width,height:Zn.height,data:Zn.byteArray,format:Zn.format,[_C?"colorSpace":"encoding"]:Zn[_C?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,r){function s(a,o){_C?a.colorSpace=o.colorSpace:a.encoding=o.encoding,a.minFilter=Jn,a.magFilter=Jn,a.generateMipmaps=!1,a.flipY=!1,t&&t(a,o)}return super.load(e,s,i,r)}}const aU=new WeakMap;class rWe extends rl{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){const s=new el(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){const s={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const l in t.attributeTypes){const u=t.attributeTypes[l];u.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[l]=u.name)}const i=JSON.stringify(t);if(aU.has(e)){const l=aU.get(e);if(l.key===i)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(s,a).then(l=>(r=l,new Promise((u,c)=>{r._callbacks[s]={resolve:u,reject:c},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),aU.set(e,{key:i,promise:o}),o}_createGeometry(e){const t=new wi;e.index&&t.setIndex(new Gi(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const r=e.attributes[i],s=r.name,a=r.array,o=r.itemSize;t.setAttribute(s,new Gi(a,o))}return t}_loadLibrary(e,t){const i=new el(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,s)=>{i.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const s=sWe.toString(),a=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){const a=s.data;switch(a.type){case"decode":r._callbacks[a.id].resolve(a);break;case"error":r._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function sWe(){let n,e;onmessage=function(a){const o=a.data;switch(o.type){case"init":n=o.decoderConfig,e=new Promise(function(c){n.onModuleLoaded=function(d){c({draco:d})},DracoDecoderModule(n)});break;case"decode":const l=o.buffer,u=o.taskConfig;e.then(c=>{const d=c.draco,f=new d.Decoder,m=new d.DecoderBuffer;m.Init(new Int8Array(l),l.byteLength);try{const y=t(d,f,m,u),_=y.attributes.map(S=>S.array.buffer);y.index&&_.push(y.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:y},_)}catch(y){console.error(y),self.postMessage({type:"error",id:o.id,error:y.message})}finally{d.destroy(m),d.destroy(f)}});break}};function t(a,o,l,u){const c=u.attributeIDs,d=u.attributeTypes;let f,m;const y=o.GetEncodedGeometryType(l);if(y===a.TRIANGULAR_MESH)f=new a.Mesh,m=o.DecodeBufferToMesh(l,f);else if(y===a.POINT_CLOUD)f=new a.PointCloud,m=o.DecodeBufferToPointCloud(l,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!m.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+m.error_msg());const _={index:null,attributes:[]};for(const S in c){const b=self[d[S]];let M,w;if(u.useUniqueIDs)w=c[S],M=o.GetAttributeByUniqueId(f,w);else{if(w=o.GetAttributeId(f,a[c[S]]),w===-1)continue;M=o.GetAttribute(f,w)}_.attributes.push(r(a,o,f,S,b,M))}return y===a.TRIANGULAR_MESH&&(_.index=i(a,o,f)),a.destroy(f),_}function i(a,o,l){const c=l.num_faces()*3,d=c*4,f=a._malloc(d);o.GetTrianglesUInt32Array(l,d,f);const m=new Uint32Array(a.HEAPF32.buffer,f,c).slice();return a._free(f),{array:m,itemSize:1}}function r(a,o,l,u,c,d){const f=d.num_components(),y=l.num_points()*f,_=y*c.BYTES_PER_ELEMENT,S=s(a,c),b=a._malloc(_);o.GetAttributeDataArrayForAllPoints(l,d,S,_,b);const M=new c(a.HEAPF32.buffer,b,y).slice();return a._free(b),{name:u,array:M,itemSize:f}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let ZD;const oU=()=>{if(ZD)return ZD;const n="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let r=n;WebAssembly.validate(t)&&(r=e);let s;const a=WebAssembly.instantiate(o(r),{}).then(d=>{s=d.instance,s.exports.__wasm_call_ctors()});function o(d){const f=new Uint8Array(d.length);for(let y=0;y<d.length;++y){const _=d.charCodeAt(y);f[y]=_>96?_-71:_>64?_-65:_>47?_+4:_>46?63:62}let m=0;for(let y=0;y<d.length;++y)f[m++]=f[y]<60?i[f[y]]:(f[y]-60)*64+f[++y];return f.buffer.slice(0,m)}function l(d,f,m,y,_,S){const b=s.exports.sbrk,M=m+3&-4,w=b(M*y),T=b(_.length),E=new Uint8Array(s.exports.memory.buffer);E.set(_,T);const R=d(w,m,y,T,_.length);if(R===0&&S&&S(w,M,y),f.set(E.subarray(w,w+m*y)),b(w-b(0)),R!==0)throw new Error(`Malformed buffer data: ${R}`)}const u={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},c={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return ZD={ready:a,supported:!0,decodeVertexBuffer(d,f,m,y,_){l(s.exports.meshopt_decodeVertexBuffer,d,f,m,y,s.exports[u[_]])},decodeIndexBuffer(d,f,m,y){l(s.exports.meshopt_decodeIndexBuffer,d,f,m,y)},decodeIndexSequence(d,f,m,y){l(s.exports.meshopt_decodeIndexSequence,d,f,m,y)},decodeGltfBuffer(d,f,m,y,_,S){l(s.exports[c[_]],d,f,m,y,s.exports[u[S]])}},ZD},aWe=G.forwardRef(({children:n,multisamping:e=8,renderIndex:t=1,disableRender:i,disableGamma:r,disableRenderPass:s,depthBuffer:a=!0,stencilBuffer:o=!1,anisotropy:l=1,colorSpace:u,type:c,...d},f)=>{G.useMemo(()=>eo({EffectComposer:m7e,RenderPass:v7e,ShaderPass:Dk}),[]);const m=G.useRef(null);G.useImperativeHandle(f,()=>m.current,[]);const{scene:y,camera:_,gl:S,size:b,viewport:M}=ir(),[w]=G.useState(()=>{const E=new Nr(b.width,b.height,{type:c||zi,format:Vr,depthBuffer:a,stencilBuffer:o,anisotropy:l});return c===br&&u!=null&&(E.texture.colorSpace=u),E.samples=e,E});G.useEffect(()=>{var E,R;(E=m.current)==null||E.setSize(b.width,b.height),(R=m.current)==null||R.setPixelRatio(M.dpr)},[S,b,M.dpr]),rs(()=>{var E;i||(E=m.current)==null||E.render()},t);const T=[];return s||T.push(G.createElement("renderPass",{key:"renderpass",attach:`passes-${T.length}`,args:[y,_]})),r||T.push(G.createElement("shaderPass",{attach:`passes-${T.length}`,key:"gammapass",args:[eWe]})),G.Children.forEach(n,E=>{E&&T.push(G.cloneElement(E,{key:T.length,attach:`passes-${T.length}`}))}),G.createElement("effectComposer",Ta({ref:m,args:[S,w]},d),T)});function Yd(n,e,t,i){var r;return r=class extends Ds{constructor(s){super({vertexShader:e,fragmentShader:t,...s});for(const a in n)this.uniforms[a]=new mi(n[a]),Object.defineProperty(this,a,{get(){return this.uniforms[a].value},set(o){this.uniforms[a].value=o}});this.uniforms=vM.clone(this.uniforms)}},r.key=Wl.generateUUID(),r}const lU=n=>n===Object(n)&&!Array.isArray(n)&&typeof n!="function";function EH(n,e){const t=ir(s=>s.gl),i=Gd(nA,lU(n)?Object.values(n):n);return G.useLayoutEffect(()=>{e?.(i)},[e]),G.useEffect(()=>{if("initTexture"in t){let s=[];Array.isArray(i)?s=i:i instanceof pr?s=[i]:lU(i)&&(s=Object.values(i)),s.forEach(a=>{a instanceof pr&&t.initTexture(a)})}},[t,i]),G.useMemo(()=>{if(lU(n)){const s={};let a=0;for(const o in n)s[o]=i[a++];return s}else return i},[n,i])}EH.preload=n=>Gd.preload(nA,n);EH.clear=n=>Gd.clear(nA,n);const oWe=()=>parseInt(Xd.replace(/\D+/g,"")),YR=oWe();let jD=null,Ile="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Gle(n=!0,e=!0,t){return i=>{t&&t(i),n&&(jD||(jD=new rWe),jD.setDecoderPath(typeof n=="string"?n:Ile),i.setDRACOLoader(jD)),e&&i.setMeshoptDecoder(typeof oU=="function"?oU():oU)}}const Zo=(n,e,t,i)=>Gd(wH,n,Gle(e,t,i));Zo.preload=(n,e,t,i)=>Gd.preload(wH,n,Gle(e,t,i));Zo.clear=n=>Gd.clear(wH,n);Zo.setDecoderPath=n=>{Ile=n};function lWe({renderIndex:n=1,bgColor:e="black",fgColor:t="white",characters:i=" .:-+*=%@#",invert:r=!0,color:s=!1,resolution:a=.15}){const{size:o,gl:l,scene:u,camera:c}=ir(),d=G.useMemo(()=>{const f=new tWe(l,i,{invert:r,color:s,resolution:a});return f.domElement.style.position="absolute",f.domElement.style.top="0px",f.domElement.style.left="0px",f.domElement.style.pointerEvents="none",f},[i,r,s,a]);return G.useLayoutEffect(()=>{d.domElement.style.color=t,d.domElement.style.backgroundColor=e},[t,e]),G.useEffect(()=>(l.domElement.style.opacity="0",l.domElement.parentNode.appendChild(d.domElement),()=>{l.domElement.style.opacity="1",l.domElement.parentNode.removeChild(d.domElement)}),[d]),G.useEffect(()=>{d.setSize(o.width,o.height)},[d,o]),rs(f=>{d.render(u,c)},n),G.createElement(G.Fragment,null)}function Ole(n,e,t){const i=ir(m=>m.size),r=ir(m=>m.viewport),s=typeof n=="number"?n:i.width*r.dpr,a=typeof e=="number"?e:i.height*r.dpr,o=(typeof n=="number"?t:n)||{},{samples:l=0,depth:u,...c}=o,d=u??o.depthBuffer,f=G.useMemo(()=>{const m=new Nr(s,a,{minFilter:Jn,magFilter:Jn,type:zi,...c});return d&&(m.depthTexture=new po(s,a,wr)),m.samples=l,m},[]);return G.useLayoutEffect(()=>{f.setSize(s,a),l&&(f.samples=l)},[l,f,s,a]),G.useEffect(()=>()=>f.dispose(),[]),f}const uWe=n=>typeof n=="function",Ob=G.forwardRef(({envMap:n,resolution:e=256,frames:t=1/0,makeDefault:i,children:r,...s},a)=>{const o=ir(({set:S})=>S),l=ir(({camera:S})=>S),u=ir(({size:S})=>S),c=G.useRef(null);G.useImperativeHandle(a,()=>c.current,[]);const d=G.useRef(null),f=Ole(e);G.useLayoutEffect(()=>{s.manual||(c.current.aspect=u.width/u.height)},[u,s]),G.useLayoutEffect(()=>{c.current.updateProjectionMatrix()});let m=0,y=null;const _=uWe(r);return rs(S=>{_&&(t===1/0||m<t)&&(d.current.visible=!1,S.gl.setRenderTarget(f),y=S.scene.background,n&&(S.scene.background=n),S.gl.render(S.scene,c.current),S.scene.background=y,S.gl.setRenderTarget(null),d.current.visible=!0,m++)}),G.useLayoutEffect(()=>{if(i){const S=l;return o(()=>({camera:c.current})),()=>o(()=>({camera:S}))}},[c,i,o]),G.createElement(G.Fragment,null,G.createElement("perspectiveCamera",Ta({ref:c},s),!_&&r),G.createElement("group",{ref:d},_&&r(f.texture)))}),mA=G.forwardRef(({makeDefault:n,camera:e,regress:t,domElement:i,enableDamping:r=!0,keyEvents:s=!1,onChange:a,onStart:o,onEnd:l,...u},c)=>{const d=ir(R=>R.invalidate),f=ir(R=>R.camera),m=ir(R=>R.gl),y=ir(R=>R.events),_=ir(R=>R.setEvents),S=ir(R=>R.set),b=ir(R=>R.get),M=ir(R=>R.performance),w=e||f,T=i||y.connected||m.domElement,E=G.useMemo(()=>new t7e(w),[w]);return rs(()=>{E.enabled&&E.update()},-1),G.useEffect(()=>(s&&E.connect(s===!0?T:s),E.connect(T),()=>{E.dispose()}),[s,T,t,E,d]),G.useEffect(()=>{const R=B=>{d(),t&&M.regress(),a&&a(B)},P=B=>{o&&o(B)},I=B=>{l&&l(B)};return E.addEventListener("change",R),E.addEventListener("start",P),E.addEventListener("end",I),()=>{E.removeEventListener("start",P),E.removeEventListener("end",I),E.removeEventListener("change",R)}},[a,o,l,E,d,_]),G.useEffect(()=>{if(n){const R=b().controls;return S({controls:E}),()=>S({controls:R})}},[n,E]),G.createElement("primitive",Ta({ref:c,object:E,enableDamping:r},u))});const ja={LEFT:1,RIGHT:2,MIDDLE:4},At=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),yS={NONE:0,IN:1,OUT:-1};function lx(n){return n.isPerspectiveCamera}function Ny(n){return n.isOrthographicCamera}const Ty=Math.PI*2,HY=Math.PI/2,Ule=1e-5,SC=Math.PI/180;function Rf(n,e,t){return Math.max(e,Math.min(t,n))}function sa(n,e=Ule){return Math.abs(n)<e}function Ts(n,e,t=Ule){return sa(n-e,t)}function XY(n,e){return Math.round(n/e)*e}function MC(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function AC(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function YD(n,e,t,i,r=1/0,s){i=Math.max(1e-4,i);const a=2/i,o=a*s,l=1/(1+o+.48*o*o+.235*o*o*o);let u=n-e;const c=e,d=r*i;u=Rf(u,-d,d),e=n-u;const f=(t.value+a*u)*s;t.value=(t.value-a*f)*l;let m=e+(u+f)*l;return c-n>0==m>c&&(m=c,t.value=(m-c)/s),m}function WY(n,e,t,i,r=1/0,s,a){i=Math.max(1e-4,i);const o=2/i,l=o*s,u=1/(1+l+.48*l*l+.235*l*l*l);let c=e.x,d=e.y,f=e.z,m=n.x-c,y=n.y-d,_=n.z-f;const S=c,b=d,M=f,w=r*i,T=w*w,E=m*m+y*y+_*_;if(E>T){const q=Math.sqrt(E);m=m/q*w,y=y/q*w,_=_/q*w}c=n.x-m,d=n.y-y,f=n.z-_;const R=(t.x+o*m)*s,P=(t.y+o*y)*s,I=(t.z+o*_)*s;t.x=(t.x-o*R)*u,t.y=(t.y-o*P)*u,t.z=(t.z-o*I)*u,a.x=c+(m+R)*u,a.y=d+(y+P)*u,a.z=f+(_+I)*u;const B=S-n.x,N=b-n.y,U=M-n.z,V=a.x-S,W=a.y-b,K=a.z-M;return B*V+N*W+U*K>0&&(a.x=S,a.y=b,a.z=M,t.x=(a.x-S)/s,t.y=(a.y-b)/s,t.z=(a.z-M)/s),a}function uU(n,e){e.set(0,0),n.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=n.length,e.y/=n.length}function cU(n,e){return Ny(n)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class cWe{constructor(){this._listeners={}}addEventListener(e,t){const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e)}}}var hU;const hWe="3.1.0",KD=1/8,dWe=/Mac/.test((hU=globalThis?.navigator)===null||hU===void 0?void 0:hU.platform);let Xi,ZY,$D,dU,Bc,hr,us,vS,TC,Kp,$p,ux,jY,YY,ch,xS,bS,KY,fU,$Y,pU,mU,JD,fWe=class Lk extends cWe{static install(e){Xi=e.THREE,ZY=Object.freeze(new Xi.Vector3(0,0,0)),$D=Object.freeze(new Xi.Vector3(0,1,0)),dU=Object.freeze(new Xi.Vector3(0,0,1)),Bc=new Xi.Vector2,hr=new Xi.Vector3,us=new Xi.Vector3,vS=new Xi.Vector3,TC=new Xi.Vector3,Kp=new Xi.Vector3,$p=new Xi.Vector3,ux=new Xi.Vector3,jY=new Xi.Vector3,YY=new Xi.Vector3,ch=new Xi.Spherical,xS=new Xi.Spherical,bS=new Xi.Box3,KY=new Xi.Box3,fU=new Xi.Sphere,$Y=new Xi.Quaternion,pU=new Xi.Quaternion,mU=new Xi.Matrix4,JD=new Xi.Raycaster}static get ACTION(){return At}set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=At.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=yS.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Xi.Vector3,this._focalOffsetVelocity=new Xi.Vector3,this._zoomVelocity={value:0},this._truckInternal=(b,M,w,T)=>{let E,R;if(lx(this._camera)){const P=hr.copy(this._camera.position).sub(this._target),I=this._camera.getEffectiveFOV()*SC,B=P.length()*Math.tan(I*.5);E=this.truckSpeed*b*B/this._elementRect.height,R=this.truckSpeed*M*B/this._elementRect.height}else if(Ny(this._camera)){const P=this._camera;E=this.truckSpeed*b*(P.right-P.left)/P.zoom/this._elementRect.width,R=this.truckSpeed*M*(P.top-P.bottom)/P.zoom/this._elementRect.height}else return;T?(w?this.setFocalOffset(this._focalOffsetEnd.x+E,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(E,0,!0),this.forward(-R,!0)):w?this.setFocalOffset(this._focalOffsetEnd.x+E,this._focalOffsetEnd.y+R,this._focalOffsetEnd.z,!0):this.truck(E,R,!0)},this._rotateInternal=(b,M)=>{const w=Ty*this.azimuthRotateSpeed*b/this._elementRect.height,T=Ty*this.polarRotateSpeed*M/this._elementRect.height;this.rotate(w,T,!0)},this._dollyInternal=(b,M,w)=>{const T=Math.pow(.95,-b*this.dollySpeed),E=this._sphericalEnd.radius,R=this._sphericalEnd.radius*T,P=Rf(R,this.minDistance,this.maxDistance),I=P-R;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(R,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(I,!0),this._dollyToNoClamp(P,!0)):this._dollyToNoClamp(P,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?R:P)-E,this._dollyControlCoord.set(M,w)),this._lastDollyDirection=Math.sign(-b)},this._zoomInternal=(b,M,w)=>{const T=Math.pow(.95,b*this.dollySpeed),E=this._zoom,R=this._zoom*T;this.zoomTo(R,!0),this.dollyToCursor&&(this._changedZoom+=R-E,this._dollyControlCoord.set(M,w))},typeof Xi>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Xi.Quaternion().setFromUnitVectors(this._camera.up,$D),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=At.NONE,this._target=new Xi.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Xi.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Xi.Spherical().setFromVector3(hr.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Xi.Vector3,new Xi.Vector3,new Xi.Vector3,new Xi.Vector3],this._updateNearPlaneCorners(),this._boundary=new Xi.Box3(new Xi.Vector3(-1/0,-1/0,-1/0),new Xi.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Xi.Vector2,this.mouseButtons={left:At.ROTATE,middle:At.DOLLY,right:At.TRUCK,wheel:lx(this._camera)?At.DOLLY:Ny(this._camera)?At.ZOOM:At.NONE},this.touches={one:At.TOUCH_ROTATE,two:lx(this._camera)?At.TOUCH_DOLLY_TRUCK:Ny(this._camera)?At.TOUCH_ZOOM_TRUCK:At.NONE,three:At.TOUCH_TRUCK};const i=new Xi.Vector2,r=new Xi.Vector2,s=new Xi.Vector2,a=b=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const T=this._domElement.getBoundingClientRect(),E=b.clientX/T.width,R=b.clientY/T.height;if(E<this._interactiveArea.left||E>this._interactiveArea.right||R<this._interactiveArea.top||R>this._interactiveArea.bottom)return}const M=b.pointerType!=="mouse"?null:(b.buttons&ja.LEFT)===ja.LEFT?ja.LEFT:(b.buttons&ja.MIDDLE)===ja.MIDDLE?ja.MIDDLE:(b.buttons&ja.RIGHT)===ja.RIGHT?ja.RIGHT:null;if(M!==null){const T=this._findPointerByMouseButton(M);T&&this._disposePointer(T)}if((b.buttons&ja.LEFT)===ja.LEFT&&this._lockedPointer)return;const w={pointerId:b.pointerId,clientX:b.clientX,clientY:b.clientY,deltaX:0,deltaY:0,mouseButton:M};this._activePointers.push(w),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,f(b)},o=b=>{b.cancelable&&b.preventDefault();const M=b.pointerId,w=this._lockedPointer||this._findPointerById(M);if(w){if(w.clientX=b.clientX,w.clientY=b.clientY,w.deltaX=b.movementX,w.deltaY=b.movementY,this._state=0,b.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(b.buttons&ja.LEFT)===ja.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(b.buttons&ja.MIDDLE)===ja.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(b.buttons&ja.RIGHT)===ja.RIGHT&&(this._state=this._state|this.mouseButtons.right);m()}},l=b=>{const M=this._findPointerById(b.pointerId);if(!(M&&M===this._lockedPointer)){if(M&&this._disposePointer(M),b.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=At.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=At.NONE;y()}};let u=-1;const c=b=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===At.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const R=this._domElement.getBoundingClientRect(),P=b.clientX/R.width,I=b.clientY/R.height;if(P<this._interactiveArea.left||P>this._interactiveArea.right||I<this._interactiveArea.top||I>this._interactiveArea.bottom)return}if(b.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===At.ROTATE||this.mouseButtons.wheel===At.TRUCK){const R=performance.now();u-R<1e3&&this._getClientRect(this._elementRect),u=R}const M=dWe?-1:-3,w=b.deltaMode===1||b.ctrlKey?b.deltaY/M:b.deltaY/(M*10),T=this.dollyToCursor?(b.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,E=this.dollyToCursor?(b.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case At.ROTATE:{this._rotateInternal(b.deltaX,b.deltaY),this._isUserControllingRotate=!0;break}case At.TRUCK:{this._truckInternal(b.deltaX,b.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case At.SCREEN_PAN:{this._truckInternal(b.deltaX,b.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case At.OFFSET:{this._truckInternal(b.deltaX,b.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case At.DOLLY:{this._dollyInternal(-w,T,E),this._isUserControllingDolly=!0;break}case At.ZOOM:{this._zoomInternal(-w,T,E),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},d=b=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Lk.ACTION.NONE){const M=b instanceof PointerEvent?b.pointerId:0,w=this._findPointerById(M);w&&this._disposePointer(w),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}b.preventDefault()}},f=b=>{if(!this._enabled)return;if(uU(this._activePointers,Bc),this._getClientRect(this._elementRect),i.copy(Bc),r.copy(Bc),this._activePointers.length>=2){const w=Bc.x-this._activePointers[1].clientX,T=Bc.y-this._activePointers[1].clientY,E=Math.sqrt(w*w+T*T);s.set(0,E);const R=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,P=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(R,P)}if(this._state=0,!b)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in b&&b.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(b.buttons&ja.LEFT)===ja.LEFT&&(this._state=this._state|this.mouseButtons.left),(b.buttons&ja.MIDDLE)===ja.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(b.buttons&ja.RIGHT)===ja.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&At.ROTATE)===At.ROTATE||(this._state&At.TOUCH_ROTATE)===At.TOUCH_ROTATE||(this._state&At.TOUCH_DOLLY_ROTATE)===At.TOUCH_DOLLY_ROTATE||(this._state&At.TOUCH_ZOOM_ROTATE)===At.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&At.TRUCK)===At.TRUCK||(this._state&At.SCREEN_PAN)===At.SCREEN_PAN||(this._state&At.TOUCH_TRUCK)===At.TOUCH_TRUCK||(this._state&At.TOUCH_SCREEN_PAN)===At.TOUCH_SCREEN_PAN||(this._state&At.TOUCH_DOLLY_TRUCK)===At.TOUCH_DOLLY_TRUCK||(this._state&At.TOUCH_DOLLY_SCREEN_PAN)===At.TOUCH_DOLLY_SCREEN_PAN||(this._state&At.TOUCH_ZOOM_TRUCK)===At.TOUCH_ZOOM_TRUCK||(this._state&At.TOUCH_ZOOM_SCREEN_PAN)===At.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&At.DOLLY)===At.DOLLY||(this._state&At.TOUCH_DOLLY)===At.TOUCH_DOLLY||(this._state&At.TOUCH_DOLLY_TRUCK)===At.TOUCH_DOLLY_TRUCK||(this._state&At.TOUCH_DOLLY_SCREEN_PAN)===At.TOUCH_DOLLY_SCREEN_PAN||(this._state&At.TOUCH_DOLLY_OFFSET)===At.TOUCH_DOLLY_OFFSET||(this._state&At.TOUCH_DOLLY_ROTATE)===At.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&At.ZOOM)===At.ZOOM||(this._state&At.TOUCH_ZOOM)===At.TOUCH_ZOOM||(this._state&At.TOUCH_ZOOM_TRUCK)===At.TOUCH_ZOOM_TRUCK||(this._state&At.TOUCH_ZOOM_SCREEN_PAN)===At.TOUCH_ZOOM_SCREEN_PAN||(this._state&At.TOUCH_ZOOM_OFFSET)===At.TOUCH_ZOOM_OFFSET||(this._state&At.TOUCH_ZOOM_ROTATE)===At.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&At.OFFSET)===At.OFFSET||(this._state&At.TOUCH_OFFSET)===At.TOUCH_OFFSET||(this._state&At.TOUCH_DOLLY_OFFSET)===At.TOUCH_DOLLY_OFFSET||(this._state&At.TOUCH_ZOOM_OFFSET)===At.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},m=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,uU(this._activePointers,Bc);const M=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,w=M?-M.deltaX:r.x-Bc.x,T=M?-M.deltaY:r.y-Bc.y;if(r.copy(Bc),((this._state&At.ROTATE)===At.ROTATE||(this._state&At.TOUCH_ROTATE)===At.TOUCH_ROTATE||(this._state&At.TOUCH_DOLLY_ROTATE)===At.TOUCH_DOLLY_ROTATE||(this._state&At.TOUCH_ZOOM_ROTATE)===At.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(w,T),this._isUserControllingRotate=!0),(this._state&At.DOLLY)===At.DOLLY||(this._state&At.ZOOM)===At.ZOOM){const E=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,R=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,P=this.dollyDragInverted?-1:1;(this._state&At.DOLLY)===At.DOLLY?(this._dollyInternal(P*T*KD,E,R),this._isUserControllingDolly=!0):(this._zoomInternal(P*T*KD,E,R),this._isUserControllingZoom=!0)}if((this._state&At.TOUCH_DOLLY)===At.TOUCH_DOLLY||(this._state&At.TOUCH_ZOOM)===At.TOUCH_ZOOM||(this._state&At.TOUCH_DOLLY_TRUCK)===At.TOUCH_DOLLY_TRUCK||(this._state&At.TOUCH_ZOOM_TRUCK)===At.TOUCH_ZOOM_TRUCK||(this._state&At.TOUCH_DOLLY_SCREEN_PAN)===At.TOUCH_DOLLY_SCREEN_PAN||(this._state&At.TOUCH_ZOOM_SCREEN_PAN)===At.TOUCH_ZOOM_SCREEN_PAN||(this._state&At.TOUCH_DOLLY_OFFSET)===At.TOUCH_DOLLY_OFFSET||(this._state&At.TOUCH_ZOOM_OFFSET)===At.TOUCH_ZOOM_OFFSET||(this._state&At.TOUCH_DOLLY_ROTATE)===At.TOUCH_DOLLY_ROTATE||(this._state&At.TOUCH_ZOOM_ROTATE)===At.TOUCH_ZOOM_ROTATE){const E=Bc.x-this._activePointers[1].clientX,R=Bc.y-this._activePointers[1].clientY,P=Math.sqrt(E*E+R*R),I=s.y-P;s.set(0,P);const B=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,N=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&At.TOUCH_DOLLY)===At.TOUCH_DOLLY||(this._state&At.TOUCH_DOLLY_ROTATE)===At.TOUCH_DOLLY_ROTATE||(this._state&At.TOUCH_DOLLY_TRUCK)===At.TOUCH_DOLLY_TRUCK||(this._state&At.TOUCH_DOLLY_SCREEN_PAN)===At.TOUCH_DOLLY_SCREEN_PAN||(this._state&At.TOUCH_DOLLY_OFFSET)===At.TOUCH_DOLLY_OFFSET?(this._dollyInternal(I*KD,B,N),this._isUserControllingDolly=!0):(this._zoomInternal(I*KD,B,N),this._isUserControllingZoom=!0)}((this._state&At.TRUCK)===At.TRUCK||(this._state&At.TOUCH_TRUCK)===At.TOUCH_TRUCK||(this._state&At.TOUCH_DOLLY_TRUCK)===At.TOUCH_DOLLY_TRUCK||(this._state&At.TOUCH_ZOOM_TRUCK)===At.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(w,T,!1,!1),this._isUserControllingTruck=!0),((this._state&At.SCREEN_PAN)===At.SCREEN_PAN||(this._state&At.TOUCH_SCREEN_PAN)===At.TOUCH_SCREEN_PAN||(this._state&At.TOUCH_DOLLY_SCREEN_PAN)===At.TOUCH_DOLLY_SCREEN_PAN||(this._state&At.TOUCH_ZOOM_SCREEN_PAN)===At.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(w,T,!1,!0),this._isUserControllingTruck=!0),((this._state&At.OFFSET)===At.OFFSET||(this._state&At.TOUCH_OFFSET)===At.TOUCH_OFFSET||(this._state&At.TOUCH_DOLLY_OFFSET)===At.TOUCH_DOLLY_OFFSET||(this._state&At.TOUCH_ZOOM_OFFSET)===At.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(w,T,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},y=()=>{uU(this._activePointers,Bc),r.copy(Bc),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",_),this._domElement.ownerDocument.addEventListener("pointerlockerror",S),this._domElement.ownerDocument.addEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),f())},this.unlockPointer=()=>{var b,M,w;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(b=this._domElement)===null||b===void 0||b.ownerDocument.exitPointerLock(),(M=this._domElement)===null||M===void 0||M.ownerDocument.removeEventListener("pointerlockchange",_),(w=this._domElement)===null||w===void 0||w.ownerDocument.removeEventListener("pointerlockerror",S),this.cancel()};const _=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},S=()=>{this.unlockPointer()};this._addAllEventListeners=b=>{this._domElement=b,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",c,{passive:!1}),this._domElement.addEventListener("contextmenu",d)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",c,{passive:!1}),this._domElement.removeEventListener("contextmenu",d),this._domElement.ownerDocument.removeEventListener("pointermove",o,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",_),this._domElement.ownerDocument.removeEventListener("pointerlockerror",S))},this.cancel=()=>{this._state!==At.NONE&&(this._state=At.NONE,this._activePointers.length=0,y())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Rf(e.width,0,1),this._interactiveArea.height=Rf(e.height,0,1),this._interactiveArea.x=Rf(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Rf(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,i=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,i)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,i=!1){this._isUserControllingRotate=!1;const r=Rf(e,this.minAzimuthAngle,this.maxAzimuthAngle),s=Rf(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const a=!i||Ts(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Ts(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=yS.NONE,this._changedDolly=0,this._dollyToNoClamp(Rf(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const a=this._collisionTest(),o=Ts(a,this._spherical.radius);if(!(i>e)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,a)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const s=!t||Ts(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(TC).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const i=!t||Ts(this._target.x,this._targetEnd.x,this.restThreshold)&&Ts(this._target.y,this._targetEnd.y,this.restThreshold)&&Ts(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Rf(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const i=!t||Ts(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(e,t,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,i)}truck(e,t,i=!1){this._camera.updateMatrix(),Kp.setFromMatrixColumn(this._camera.matrix,0),$p.setFromMatrixColumn(this._camera.matrix,1),Kp.multiplyScalar(e),$p.multiplyScalar(-t);const r=hr.copy(Kp).add($p),s=us.copy(this._targetEnd).add(r);return this.moveTo(s.x,s.y,s.z,i)}forward(e,t=!1){hr.setFromMatrixColumn(this._camera.matrix,0),hr.crossVectors(this._camera.up,hr),hr.multiplyScalar(e);const i=us.copy(this._targetEnd).add(hr);return this.moveTo(i.x,i.y,i.z,t)}elevate(e,t=!1){return hr.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+hr.x,this._targetEnd.y+hr.y,this._targetEnd.z+hr.z,t)}moveTo(e,t,i,r=!1){this._isUserControllingTruck=!1;const s=hr.set(e,t,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const a=!r||Ts(this._target.x,this._targetEnd.x,this.restThreshold)&&Ts(this._target.y,this._targetEnd.y,this.restThreshold)&&Ts(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(e,t,i,r=!1){const o=hr.set(e,t,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(o.x,o.y,o.z,r)}fitToBox(e,t,{cover:i=!1,paddingLeft:r=0,paddingRight:s=0,paddingBottom:a=0,paddingTop:o=0}={}){const l=[],u=e.isBox3?bS.copy(e):bS.setFromObject(e);u.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const c=XY(this._sphericalEnd.theta,HY),d=XY(this._sphericalEnd.phi,HY);l.push(this.rotateTo(c,d,t));const f=hr.setFromSpherical(this._sphericalEnd).normalize(),m=$Y.setFromUnitVectors(f,dU),y=Ts(Math.abs(f.y),1);y&&m.multiply(pU.setFromAxisAngle($D,c)),m.multiply(this._yAxisUpSpaceInverse);const _=KY.makeEmpty();us.copy(u.min).applyQuaternion(m),_.expandByPoint(us),us.copy(u.min).setX(u.max.x).applyQuaternion(m),_.expandByPoint(us),us.copy(u.min).setY(u.max.y).applyQuaternion(m),_.expandByPoint(us),us.copy(u.max).setZ(u.min.z).applyQuaternion(m),_.expandByPoint(us),us.copy(u.min).setZ(u.max.z).applyQuaternion(m),_.expandByPoint(us),us.copy(u.max).setY(u.min.y).applyQuaternion(m),_.expandByPoint(us),us.copy(u.max).setX(u.min.x).applyQuaternion(m),_.expandByPoint(us),us.copy(u.max).applyQuaternion(m),_.expandByPoint(us),_.min.x-=r,_.min.y-=a,_.max.x+=s,_.max.y+=o,m.setFromUnitVectors(dU,f),y&&m.premultiply(pU.invert()),m.premultiply(this._yAxisUpSpace);const S=_.getSize(hr),b=_.getCenter(us).applyQuaternion(m);if(lx(this._camera)){const M=this.getDistanceToFitBox(S.x,S.y,S.z,i);l.push(this.moveTo(b.x,b.y,b.z,t)),l.push(this.dollyTo(M,t)),l.push(this.setFocalOffset(0,0,0,t))}else if(Ny(this._camera)){const M=this._camera,w=M.right-M.left,T=M.top-M.bottom,E=i?Math.max(w/S.x,T/S.y):Math.min(w/S.x,T/S.y);l.push(this.moveTo(b.x,b.y,b.z,t)),l.push(this.zoomTo(E,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){const i=[],s="isObject3D"in e?Lk.createBoundingSphere(e,fU):fU.copy(e);if(i.push(this.moveTo(s.center.x,s.center.y,s.center.z,t)),lx(this._camera)){const a=this.getDistanceToFitSphere(s.radius);i.push(this.dollyTo(a,t))}else if(Ny(this._camera)){const a=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,l=2*s.radius,u=Math.min(a/l,o/l);i.push(this.zoomTo(u,t))}return i.push(this.setFocalOffset(0,0,0,t)),Promise.all(i)}setLookAt(e,t,i,r,s,a,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=yS.NONE,this._changedDolly=0;const l=us.set(r,s,a),u=hr.set(e,t,i);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(u.sub(l).applyQuaternion(this._yAxisUpSpace)),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!o||Ts(this._target.x,this._targetEnd.x,this.restThreshold)&&Ts(this._target.y,this._targetEnd.y,this.restThreshold)&&Ts(this._target.z,this._targetEnd.z,this.restThreshold)&&Ts(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Ts(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Ts(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerp(e,t,i,r=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=yS.NONE,this._changedDolly=0;const s=hr.set(...e.target);if("spherical"in e)ch.set(...e.spherical);else{const d=us.set(...e.position);ch.setFromVector3(d.sub(s).applyQuaternion(this._yAxisUpSpace))}const a=vS.set(...t.target);if("spherical"in t)xS.set(...t.spherical);else{const d=us.set(...t.position);xS.setFromVector3(d.sub(a).applyQuaternion(this._yAxisUpSpace))}this._targetEnd.copy(s.lerp(a,i));const o=xS.theta-ch.theta,l=xS.phi-ch.phi,u=xS.radius-ch.radius;this._sphericalEnd.set(ch.radius+u*i,ch.phi+l*i,ch.theta+o*i),this._needsUpdate=!0,r||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!r||Ts(this._target.x,this._targetEnd.x,this.restThreshold)&&Ts(this._target.y,this._targetEnd.y,this.restThreshold)&&Ts(this._target.z,this._targetEnd.z,this.restThreshold)&&Ts(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Ts(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Ts(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(e,t,i,r,s,a,o,l,u,c,d,f,m,y=!1){return this.lerp({position:[e,t,i],target:[r,s,a]},{position:[o,l,u],target:[c,d,f]},m,y)}setPosition(e,t,i,r=!1){return this.setLookAt(e,t,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,i,r=!1){const s=this.getPosition(hr),a=this.setLookAt(s.x,s.y,s.z,e,t,i,r);return this._sphericalEnd.phi=Rf(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(e,t,i,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,i),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const s=!r||Ts(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Ts(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Ts(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(e,t,i){this._camera.updateMatrixWorld(),Kp.setFromMatrixColumn(this._camera.matrixWorldInverse,0),$p.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ux.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=hr.set(e,t,i),s=r.distanceTo(this._camera.position),a=r.sub(this._camera.position);Kp.multiplyScalar(a.x),$p.multiplyScalar(a.y),ux.multiplyScalar(a.z),hr.copy(Kp).add($p).add(ux),hr.z=hr.z+s,this.dollyTo(s,!1),this.setFocalOffset(-hr.x,hr.y,-hr.z,!1),this.moveTo(e,t,i,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,i,r){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Xi.Vector4,typeof e=="number"?this._viewport.set(e,t,i,r):this._viewport.copy(e)}getDistanceToFitBox(e,t,i,r=!1){if(cU(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const s=e/t,a=this._camera.getEffectiveFOV()*SC,o=this._camera.aspect;return((r?s>o:s<o)?t:e/o)*.5/Math.tan(a*.5)+i*.5}getDistanceToFitSphere(e){if(cU(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*SC,i=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,r=1<this._camera.aspect?t:i;return e/Math.sin(r*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Xi.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Xi.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new Xi.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Xi.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){return this._sphericalEnd.theta=(this._sphericalEnd.theta%Ty+Ty)%Ty,this._sphericalEnd.theta>Math.PI&&(this._sphericalEnd.theta-=Ty),this._spherical.theta+=Ty*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Ty),this}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!Ts(this._camera.up.x,this._cameraUp0.x)||!Ts(this._camera.up.y,this._cameraUp0.y)||!Ts(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const i=this.getPosition(hr);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,$D),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=hr.subVectors(this._target,this._camera.position).normalize(),t=us.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const i=this.getPosition(hr);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,s=jY.subVectors(this._targetEnd,this._target),a=YY.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(sa(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=YD(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,d,1/0,e),this._needsUpdate=!0}if(sa(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=YD(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,d,1/0,e),this._needsUpdate=!0}if(sa(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const d=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=YD(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,d,this.maxSpeed,e),this._needsUpdate=!0}if(sa(s.x)&&sa(s.y)&&sa(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const d=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;WY(this._target,this._targetEnd,this._targetVelocity,d,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(sa(a.x)&&sa(a.y)&&sa(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const d=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;WY(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,d,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(sa(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const d=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=YD(this._zoom,this._zoomEnd,this._zoomVelocity,d,1/0,e)}if(this.dollyToCursor){if(lx(this._camera)&&this._changedDolly!==0){const d=this._spherical.radius-this._lastDistance,f=this._camera,m=this._getCameraDirection(TC),y=hr.copy(m).cross(f.up).normalize();y.lengthSq()===0&&(y.x=1);const _=us.crossVectors(y,m),S=this._sphericalEnd.radius*Math.tan(f.getEffectiveFOV()*SC*.5),M=(this._sphericalEnd.radius-d-this._sphericalEnd.radius)/this._sphericalEnd.radius,w=vS.copy(this._targetEnd).add(y.multiplyScalar(this._dollyControlCoord.x*S*f.aspect)).add(_.multiplyScalar(this._dollyControlCoord.y*S)),T=hr.copy(this._targetEnd).lerp(w,M),E=this._lastDollyDirection===yS.IN&&this._spherical.radius<=this.minDistance,R=this._lastDollyDirection===yS.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(E||R)){this._sphericalEnd.radius-=d,this._spherical.radius-=d;const I=us.copy(m).multiplyScalar(-d);T.add(I)}this._boundary.clampPoint(T,T);const P=us.subVectors(T,this._targetEnd);this._targetEnd.copy(T),this._target.add(P),this._changedDolly-=d,sa(this._changedDolly)&&(this._changedDolly=0)}else if(Ny(this._camera)&&this._changedZoom!==0){const d=this._zoom-this._lastZoom,f=this._camera,m=hr.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(f.near+f.far)/(f.near-f.far)).unproject(f),y=us.set(0,0,-1).applyQuaternion(f.quaternion),_=vS.copy(m).add(y.multiplyScalar(-m.dot(f.up))),b=-(this._zoom-d-this._zoom)/this._zoom,M=this._getCameraDirection(TC),w=this._targetEnd.dot(M),T=hr.copy(this._targetEnd).lerp(_,b),E=T.dot(M),R=M.multiplyScalar(E-w);T.sub(R),this._boundary.clampPoint(T,T);const P=us.subVectors(T,this._targetEnd);this._targetEnd.copy(T),this._target.add(P),this._changedZoom-=d,sa(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!sa(this._focalOffset.x)||!sa(this._focalOffset.y)||!sa(this._focalOffset.z))&&(Kp.setFromMatrixColumn(this._camera.matrix,0),$p.setFromMatrixColumn(this._camera.matrix,1),ux.setFromMatrixColumn(this._camera.matrix,2),Kp.multiplyScalar(this._focalOffset.x),$p.multiplyScalar(-this._focalOffset.y),ux.multiplyScalar(this._focalOffset.z),hr.copy(Kp).add($p).add(ux),this._camera.position.add(hr),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),hr.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),sa(t,this.restThreshold)&&sa(i,this.restThreshold)&&sa(r,this.restThreshold)&&sa(s.x,this.restThreshold)&&sa(s.y,this.restThreshold)&&sa(s.z,this.restThreshold)&&sa(a.x,this.restThreshold)&&sa(a.y,this.restThreshold)&&sa(a.z,this.restThreshold)&&sa(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:MC(this.maxDistance),minZoom:this.minZoom,maxZoom:MC(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:MC(this.maxPolarAngle),minAzimuthAngle:MC(this.minAzimuthAngle),maxAzimuthAngle:MC(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:hr.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const i=JSON.parse(e);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=AC(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=AC(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=AC(i.maxPolarAngle),this.minAzimuthAngle=AC(i.minAzimuthAngle),this.maxAzimuthAngle=AC(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],t),ch.setFromVector3(hr.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(ch.theta,ch.phi,t),this.dollyTo(ch.radius,t),this.zoomTo(i.zoom,t),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",hWe),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,i){const r=t.lengthSq();if(r===0)return e;const s=us.copy(t).add(e),o=this._boundary.clampPoint(s,vS).sub(s),l=o.lengthSq();if(l===0)return e.add(t);if(l===r)return e;if(i===0)return e.add(t).add(o);{const u=1+i*l/t.dot(o);return e.add(us.copy(t).multiplyScalar(u)).add(o.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(lx(this._camera)){const e=this._camera,t=e.near,i=e.getEffectiveFOV()*SC,r=Math.tan(i*.5)*t,s=r*e.aspect;this._nearPlaneCorners[0].set(-s,-r,0),this._nearPlaneCorners[1].set(s,-r,0),this._nearPlaneCorners[2].set(s,r,0),this._nearPlaneCorners[3].set(-s,r,0)}else if(Ny(this._camera)){const e=this._camera,t=1/e.zoom,i=e.left*t,r=e.right*t,s=e.top*t,a=e.bottom*t;this._nearPlaneCorners[0].set(i,s,0),this._nearPlaneCorners[1].set(r,s,0),this._nearPlaneCorners[2].set(r,a,0),this._nearPlaneCorners[3].set(i,a,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||cU(this._camera,"_collisionTest"))return e;const i=this._getTargetDirection(TC);mU.lookAt(ZY,i,this._camera.up);for(let r=0;r<4;r++){const s=us.copy(this._nearPlaneCorners[r]);s.applyMatrix4(mU);const a=vS.addVectors(this._target,s);JD.set(a,i),JD.far=this._spherical.radius+1;const o=JD.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<e&&(e=o[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const i=()=>{this.removeEventListener("rest",i),t()};this.addEventListener("rest",i)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Xi.Sphere){const i=t,r=i.center;bS.makeEmpty(),e.traverseVisible(a=>{a.isMesh&&bS.expandByObject(a)}),bS.getCenter(r);let s=0;return e.traverseVisible(a=>{if(!a.isMesh)return;const o=a;if(!o.geometry)return;const l=o.geometry.clone();l.applyMatrix4(o.matrixWorld);const c=l.attributes.position;for(let d=0,f=c.count;d<f;d++)hr.fromBufferAttribute(c,d),s=Math.max(s,r.distanceToSquared(hr))}),i.radius=Math.sqrt(s),i}};const pWe=G.forwardRef((n,e)=>{const{impl:t,camera:i,domElement:r,makeDefault:s,onControlStart:a,onControl:o,onControlEnd:l,onTransitionStart:u,onUpdate:c,onWake:d,onRest:f,onSleep:m,onStart:y,onEnd:_,onChange:S,regress:b,...M}=n,w=t??fWe;G.useMemo(()=>{const q={Box3:Ns,MathUtils:{clamp:Wl.clamp},Matrix4:Mn,Quaternion:ba,Raycaster:FR,Sphere:fo,Spherical:$w,Vector2:rt,Vector3:re,Vector4:si};w.install({THREE:q}),eo({CameraControlsImpl:w})},[w]);const T=ir(q=>q.camera),E=ir(q=>q.gl),R=ir(q=>q.invalidate),P=ir(q=>q.events),I=ir(q=>q.setEvents),B=ir(q=>q.set),N=ir(q=>q.get),U=ir(q=>q.performance),V=i||T,W=r||P.connected||E.domElement,K=G.useMemo(()=>new w(V),[w,V]);return rs((q,j)=>{K.update(j)},-1),G.useEffect(()=>(K.connect(W),()=>{K.disconnect()}),[W,K]),G.useEffect(()=>{function q(){R(),b&&U.regress()}const j=Oe=>{q(),a?.(Oe),y?.(Oe)},te=Oe=>{q(),o?.(Oe),S?.(Oe)},he=Oe=>{l?.(Oe),_?.(Oe)},_e=Oe=>{q(),u?.(Oe),S?.(Oe)},Be=Oe=>{q(),c?.(Oe),S?.(Oe)},ue=Oe=>{q(),d?.(Oe),S?.(Oe)},ce=Oe=>{f?.(Oe)},Ce=Oe=>{m?.(Oe)};return K.addEventListener("controlstart",j),K.addEventListener("control",te),K.addEventListener("controlend",he),K.addEventListener("transitionstart",_e),K.addEventListener("update",Be),K.addEventListener("wake",ue),K.addEventListener("rest",ce),K.addEventListener("sleep",Ce),()=>{K.removeEventListener("controlstart",j),K.removeEventListener("control",te),K.removeEventListener("controlend",he),K.removeEventListener("transitionstart",_e),K.removeEventListener("update",Be),K.removeEventListener("wake",ue),K.removeEventListener("rest",ce),K.removeEventListener("sleep",Ce)}},[K,R,I,b,U,a,o,l,u,c,d,f,m,S,y,_]),G.useEffect(()=>{if(s){const q=N().controls;return B({controls:K}),()=>B({controls:q})}},[s,K]),G.createElement("primitive",Ta({ref:e,object:K},M))}),mWe=Yd({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new en,sectionColor:new en,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new re,worldPlanePosition:new re},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${YR>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),kle=G.forwardRef(({args:n,cellColor:e="#000000",sectionColor:t="#2080ff",cellSize:i=.5,sectionSize:r=1,followCamera:s=!1,infiniteGrid:a=!1,fadeDistance:o=100,fadeStrength:l=1,fadeFrom:u=1,cellThickness:c=.5,sectionThickness:d=1,side:f=Er,...m},y)=>{eo({GridMaterial:mWe});const _=G.useRef(null);G.useImperativeHandle(y,()=>_.current,[]);const S=new Xl,b=new re(0,1,0),M=new re(0,0,0);rs(E=>{S.setFromNormalAndCoplanarPoint(b,M).applyMatrix4(_.current.matrixWorld);const R=_.current.material,P=R.uniforms.worldCamProjPosition,I=R.uniforms.worldPlanePosition;S.projectPoint(E.camera.position,P.value),I.value.set(0,0,0).applyMatrix4(_.current.matrixWorld)});const w={cellSize:i,sectionSize:r,cellColor:e,sectionColor:t,cellThickness:c,sectionThickness:d},T={fadeDistance:o,fadeStrength:l,fadeFrom:u,infiniteGrid:a,followCamera:s};return G.createElement("mesh",Ta({ref:_,frustumCulled:!1},m),G.createElement("gridMaterial",Ta({transparent:!0,"extensions-derivatives":!0,side:f},w,T)),G.createElement("planeGeometry",{args:n}))});var JN={exports:{}},gWe=JN.exports,JY;function yWe(){return JY||(JY=1,(function(n,e){(function(t,i){n.exports=i()})(gWe,function(){var t=function(){function i(m){return a.appendChild(m.dom),m}function r(m){for(var y=0;y<a.children.length;y++)a.children[y].style.display=y===m?"block":"none";s=m}var s=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(m){m.preventDefault(),r(++s%a.children.length)},!1);var o=(performance||Date).now(),l=o,u=0,c=i(new t.Panel("FPS","#0ff","#002")),d=i(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=i(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:a,addPanel:i,showPanel:r,begin:function(){o=(performance||Date).now()},end:function(){u++;var m=(performance||Date).now();if(d.update(m-o,200),m>l+1e3&&(c.update(1e3*u/(m-l),100),l=m,u=0,f)){var y=performance.memory;f.update(y.usedJSHeapSize/1048576,y.jsHeapSizeLimit/1048576)}return m},update:function(){o=this.end()},domElement:a,setMode:r}};return t.Panel=function(i,r,s){var a=1/0,o=0,l=Math.round,u=l(window.devicePixelRatio||1),c=80*u,d=48*u,f=3*u,m=2*u,y=3*u,_=15*u,S=74*u,b=30*u,M=document.createElement("canvas");M.width=c,M.height=d,M.style.cssText="width:80px;height:48px";var w=M.getContext("2d");return w.font="bold "+9*u+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=s,w.fillRect(0,0,c,d),w.fillStyle=r,w.fillText(i,f,m),w.fillRect(y,_,S,b),w.fillStyle=s,w.globalAlpha=.9,w.fillRect(y,_,S,b),{dom:M,update:function(T,E){a=Math.min(a,T),o=Math.max(o,T),w.fillStyle=s,w.globalAlpha=1,w.fillRect(0,0,c,_),w.fillStyle=r,w.fillText(l(T)+" "+i+" ("+l(a)+"-"+l(o)+")",f,m),w.drawImage(M,y+u,_,S-u,b,y,_,S-u,b),w.fillRect(y+S-u,_,u,b),w.fillStyle=s,w.globalAlpha=.9,w.fillRect(y+S-u,_,u,l((1-T/E)*b))}}},t})})(JN)),JN.exports}var vWe=yWe();const xWe=_0(vWe);function bWe(n,e=[],t){const[i,r]=G.useState();return G.useLayoutEffect(()=>{const s=n();return r(s),()=>void 0},e),i}function _We({showPanel:n=0,className:e,parent:t}){const i=bWe(()=>new xWe,[]);return G.useEffect(()=>{if(i){const r=t&&t.current||document.body;i.showPanel(n),r?.appendChild(i.dom);const s=(e??"").split(" ").filter(l=>l);s.length&&i.dom.classList.add(...s);const a=Mne(()=>i.begin()),o=nUe(()=>i.end());return()=>{s.length&&i.dom.classList.remove(...s),r?.removeChild(i.dom),a(),o()}}},[t,i,e,n]),null}const Sw=(n,e)=>{n.updateRanges[0]=e};function SWe(n){return typeof n=="function"}const qY=new Mn,QY=new Mn,qD=[],CC=new Fr;class MWe extends _h{constructor(){super(),this.color=new en("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,t){const i=this.instance.current;if(!i||!i.geometry||!i.material)return;CC.geometry=i.geometry;const r=i.matrixWorld,s=i.userData.instances.indexOf(this.instanceKey);if(!(s===-1||s>i.count)){i.getMatrixAt(s,qY),QY.multiplyMatrices(r,qY),CC.matrixWorld=QY,i.material instanceof _a?CC.material.side=i.material.side:CC.material.side=i.material[0].side,CC.raycast(e,qD);for(let a=0,o=qD.length;a<o;a++){const l=qD[a];l.instanceId=s,l.object=this,t.push(l)}qD.length=0}}}const zle=G.createContext(null),eK=new Mn,tK=new Mn,AWe=new Mn,nK=new re,iK=new ba,rK=new re,TWe=n=>n.isInstancedBufferAttribute,CWe=G.forwardRef(({context:n,children:e,...t},i)=>{G.useMemo(()=>eo({PositionMesh:MWe}),[]);const r=G.useRef(null);G.useImperativeHandle(i,()=>r.current,[]);const{subscribe:s,getParent:a}=G.useContext(n||zle);return G.useLayoutEffect(()=>s(r),[]),G.createElement("positionMesh",Ta({instance:a(),instanceKey:r,ref:r},t),e)}),wWe=G.forwardRef(({context:n,children:e,range:t,limit:i=1e3,frames:r=1/0,...s},a)=>{const[{localContext:o,instance:l}]=G.useState(()=>{const M=G.createContext(null);return{localContext:M,instance:G.forwardRef((w,T)=>G.createElement(CWe,Ta({context:M},w,{ref:T})))}}),u=G.useRef(null);G.useImperativeHandle(a,()=>u.current,[]);const[c,d]=G.useState([]),[[f,m]]=G.useState(()=>{const M=new Float32Array(i*16);for(let w=0;w<i;w++)AWe.identity().toArray(M,w*16);return[M,new Float32Array([...new Array(i*3)].map(()=>1))]});G.useEffect(()=>{u.current.instanceMatrix.needsUpdate=!0});let y=0,_=0;const S=G.useRef([]);G.useLayoutEffect(()=>{S.current=Object.entries(u.current.geometry.attributes).filter(([M,w])=>TWe(w))}),rs(()=>{if(r===1/0||y<r){u.current.updateMatrix(),u.current.updateMatrixWorld(),eK.copy(u.current.matrixWorld).invert(),_=Math.min(i,t!==void 0?t:i,c.length),u.current.count=_,Sw(u.current.instanceMatrix,{start:0,count:_*16}),Sw(u.current.instanceColor,{start:0,count:_*3});for(let M=0;M<c.length;M++){const w=c[M].current;w.matrixWorld.decompose(nK,iK,rK),tK.compose(nK,iK,rK).premultiply(eK),tK.toArray(f,M*16),u.current.instanceMatrix.needsUpdate=!0,w.color.toArray(m,M*3),u.current.instanceColor.needsUpdate=!0}y++}});const b=G.useMemo(()=>({getParent:()=>u,subscribe:M=>(d(w=>[...w,M]),()=>d(w=>w.filter(T=>T.current!==M.current)))}),[]);return G.createElement("instancedMesh",Ta({userData:{instances:c,limit:i,frames:r},matrixAutoUpdate:!1,ref:u,args:[null,null,0],raycast:()=>null},s),G.createElement("instancedBufferAttribute",{attach:"instanceMatrix",args:[f,16],usage:bh}),G.createElement("instancedBufferAttribute",{attach:"instanceColor",args:[m,3],usage:bh}),SWe(e)?G.createElement(o.Provider,{value:b},e(l)):n?G.createElement(n.Provider,{value:b},e):G.createElement(zle.Provider,{value:b},e))}),EWe=G.forwardRef(function({meshes:e,children:t,...i},r){const s=Array.isArray(e);if(!s)for(const l of Object.keys(e))e[l].isMesh||delete e[l];const a=l=>s?t(...l):t(Object.keys(e).filter(u=>e[u].isMesh).reduce((u,c,d)=>({...u,[c]:l[d]}),{})),o=(s?e:Object.values(e)).map(({geometry:l,material:u})=>G.createElement(wWe,Ta({key:l.uuid,geometry:l,material:u},i)));return G.createElement("group",{ref:r},Vle(a,o))});function Vle(n,e,t=[]){if(!e[0])return n(t);function i(r){return Vle(n,e.slice(1),t.concat([r]))}return typeof e[0]=="function"?e[0]({results:t,render:i}):G.cloneElement(e[0],{children:i})}class RWe extends Ds{constructor(e=new rt){super({uniforms:{inputBuffer:new mi(null),depthBuffer:new mi(null),resolution:new mi(new rt),texelSize:new mi(new rt),halfTexelSize:new mi(new rt),kernel:new mi(0),scale:new mi(1),cameraNear:new mi(0),cameraFar:new mi(1),minDepthThreshold:new mi(0),maxDepthThreshold:new mi(1),depthScale:new mi(0),depthToBlurRatioBias:new mi(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${YR>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:Oa,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class PWe{constructor({gl:e,resolution:t,width:i=500,height:r=500,minDepthThreshold:s=0,maxDepthThreshold:a=1,depthScale:o=0,depthToBlurRatioBias:l=.25}){this.renderToScreen=!1,this.renderTargetA=new Nr(t,t,{minFilter:Jn,magFilter:Jn,stencilBuffer:!1,depthBuffer:!1,type:zi}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new RWe,this.convolutionMaterial.setTexelSize(1/i,1/r),this.convolutionMaterial.setResolution(new rt(i,r)),this.scene=new Wc,this.camera=new Eb,this.convolutionMaterial.uniforms.minDepthThreshold.value=s,this.convolutionMaterial.uniforms.maxDepthThreshold.value=a,this.convolutionMaterial.uniforms.depthScale.value=o,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=l,this.convolutionMaterial.defines.USE_DEPTH=o>0;const u=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),c=new Float32Array([0,0,2,0,0,2]),d=new wi;d.setAttribute("position",new Gi(u,3)),d.setAttribute("uv",new Gi(c,2)),this.screen=new Fr(d,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,i){const r=this.scene,s=this.camera,a=this.renderTargetA,o=this.renderTargetB;let l=this.convolutionMaterial,u=l.uniforms;u.depthBuffer.value=t.depthTexture;const c=l.kernel;let d=t,f,m,y;for(m=0,y=c.length-1;m<y;++m)f=(m&1)===0?a:o,u.kernel.value=c[m],u.inputBuffer.value=d.texture,e.setRenderTarget(f),e.render(r,s),d=f;u.kernel.value=c[m],u.inputBuffer.value=d.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(r,s)}}let DWe=class extends mo{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;(t=e.defines)!=null&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),e.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}};const NWe=G.forwardRef(({mixBlur:n=0,mixStrength:e=1,resolution:t=256,blur:i=[0,0],minDepthThreshold:r=.9,maxDepthThreshold:s=1,depthScale:a=0,depthToBlurRatioBias:o=.25,mirror:l=0,distortion:u=1,mixContrast:c=1,distortionMap:d,reflectorOffset:f=0,...m},y)=>{eo({MeshReflectorMaterialImpl:DWe});const _=ir(({gl:Ce})=>Ce),S=ir(({camera:Ce})=>Ce),b=ir(({scene:Ce})=>Ce);i=Array.isArray(i)?i:[i,i];const M=i[0]+i[1]>0,w=i[0],T=i[1],E=G.useRef(null);G.useImperativeHandle(y,()=>E.current,[]);const[R]=G.useState(()=>new Xl),[P]=G.useState(()=>new re),[I]=G.useState(()=>new re),[B]=G.useState(()=>new re),[N]=G.useState(()=>new Mn),[U]=G.useState(()=>new re(0,0,-1)),[V]=G.useState(()=>new si),[W]=G.useState(()=>new re),[K]=G.useState(()=>new re),[q]=G.useState(()=>new si),[j]=G.useState(()=>new Mn),[te]=G.useState(()=>new ds),he=G.useCallback(()=>{var Ce;const Oe=E.current.parent||((Ce=E.current)==null||(Ce=Ce.__r3f.parent)==null?void 0:Ce.object);if(!Oe||(I.setFromMatrixPosition(Oe.matrixWorld),B.setFromMatrixPosition(S.matrixWorld),N.extractRotation(Oe.matrixWorld),P.set(0,0,1),P.applyMatrix4(N),I.addScaledVector(P,f),W.subVectors(I,B),W.dot(P)>0))return;W.reflect(P).negate(),W.add(I),N.extractRotation(S.matrixWorld),U.set(0,0,-1),U.applyMatrix4(N),U.add(B),K.subVectors(I,U),K.reflect(P).negate(),K.add(I),te.position.copy(W),te.up.set(0,1,0),te.up.applyMatrix4(N),te.up.reflect(P),te.lookAt(K),te.far=S.far,te.updateMatrixWorld(),te.projectionMatrix.copy(S.projectionMatrix),j.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),j.multiply(te.projectionMatrix),j.multiply(te.matrixWorldInverse),j.multiply(Oe.matrixWorld),R.setFromNormalAndCoplanarPoint(P,I),R.applyMatrix4(te.matrixWorldInverse),V.set(R.normal.x,R.normal.y,R.normal.z,R.constant);const nt=te.projectionMatrix;q.x=(Math.sign(V.x)+nt.elements[8])/nt.elements[0],q.y=(Math.sign(V.y)+nt.elements[9])/nt.elements[5],q.z=-1,q.w=(1+nt.elements[10])/nt.elements[14],V.multiplyScalar(2/V.dot(q)),nt.elements[2]=V.x,nt.elements[6]=V.y,nt.elements[10]=V.z+1,nt.elements[14]=V.w},[S,f]),[_e,Be,ue,ce]=G.useMemo(()=>{const Ce={minFilter:Jn,magFilter:Jn,type:zi},Oe=new Nr(t,t,Ce);Oe.depthBuffer=!0,Oe.depthTexture=new po(t,t),Oe.depthTexture.format=Xo,Oe.depthTexture.type=zc;const nt=new Nr(t,t,Ce),Ae=new PWe({gl:_,resolution:t,width:w,height:T,minDepthThreshold:r,maxDepthThreshold:s,depthScale:a,depthToBlurRatioBias:o}),Ye={mirror:l,textureMatrix:j,mixBlur:n,tDiffuse:Oe.texture,tDepth:Oe.depthTexture,tDiffuseBlur:nt.texture,hasBlur:M,mixStrength:e,minDepthThreshold:r,maxDepthThreshold:s,depthScale:a,depthToBlurRatioBias:o,distortion:u,distortionMap:d,mixContrast:c,"defines-USE_BLUR":M?"":void 0,"defines-USE_DEPTH":a>0?"":void 0,"defines-USE_DISTORTION":d?"":void 0};return[Oe,nt,Ae,Ye]},[_,w,T,j,t,l,M,n,e,r,s,a,o,u,d,c]);return rs(()=>{var Ce;const Oe=E.current.parent||((Ce=E.current)==null||(Ce=Ce.__r3f.parent)==null?void 0:Ce.object);if(!Oe)return;Oe.visible=!1;const nt=_.xr.enabled,Ae=_.shadowMap.autoUpdate;he(),_.xr.enabled=!1,_.shadowMap.autoUpdate=!1,_.setRenderTarget(_e),_.state.buffers.depth.setMask(!0),_.autoClear||_.clear(),_.render(b,te),M&&ue.render(_,_e,Be),_.xr.enabled=nt,_.shadowMap.autoUpdate=Ae,Oe.visible=!0,_.setRenderTarget(null)}),G.createElement("meshReflectorMaterialImpl",Ta({attach:"material",key:"key"+ce["defines-USE_BLUR"]+ce["defines-USE_DEPTH"]+ce["defines-USE_DISTORTION"],ref:E},ce,m))}),BWe=Yd({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");function Hle(n,e){const t=n+"Geometry";return G.forwardRef(({args:i,children:r,...s},a)=>{const o=G.useRef(null);return G.useImperativeHandle(a,()=>o.current),G.useLayoutEffect(()=>{e?.(o.current)}),G.createElement("mesh",Ta({ref:o},s),G.createElement(t,{attach:"geometry",args:i}),r)})}const FWe=Hle("sphere"),LWe=Hle("plane"),IWe=G.forwardRef(({children:n,enabled:e=!0,speed:t=1,rotationIntensity:i=1,floatIntensity:r=1,floatingRange:s=[-.1,.1],autoInvalidate:a=!1,...o},l)=>{const u=G.useRef(null);G.useImperativeHandle(l,()=>u.current,[]);const c=G.useRef(Math.random()*1e4);return rs(d=>{var f,m;if(!e||t===0)return;a&&d.invalidate();const y=c.current+d.clock.elapsedTime;u.current.rotation.x=Math.cos(y/4*t)/8*i,u.current.rotation.y=Math.sin(y/4*t)/8*i,u.current.rotation.z=Math.sin(y/4*t)/20*i;let _=Math.sin(y/4*t)/10;_=Wl.mapLinear(_,-.1,.1,(f=s?.[0])!==null&&f!==void 0?f:-.1,(m=s?.[1])!==null&&m!==void 0?m:.1),u.current.position.y=_*r,u.current.updateMatrix()}),G.createElement("group",o,G.createElement("group",{ref:u,matrixAutoUpdate:!1},n))}),Xle=(n,e,t)=>{let i;switch(n){case br:i=new Uint8ClampedArray(e*t*4);break;case zi:i=new Uint16Array(e*t*4);break;case qr:i=new Uint32Array(e*t*4);break;case am:i=new Int8Array(e*t*4);break;case om:i=new Int16Array(e*t*4);break;case Ao:i=new Int32Array(e*t*4);break;case wr:i=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return i};let QD;const GWe=(n,e,t,i)=>{if(QD!==void 0)return QD;const r=new Nr(1,1,i);e.setRenderTarget(r);const s=new Fr(new ap,new La({color:16777215}));e.render(s,t),e.setRenderTarget(null);const a=Xle(n,r.width,r.height);return e.readRenderTargetPixels(r,0,0,r.width,r.height,a),r.dispose(),s.geometry.dispose(),s.material.dispose(),QD=a[0]!==0,QD};class RH{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(e){this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const t={format:Vr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:e.renderTargetOptions?.anisotropy!==void 0?e.renderTargetOptions?.anisotropy:1,generateMipmaps:e.renderTargetOptions?.generateMipmaps!==void 0?e.renderTargetOptions?.generateMipmaps:!1,magFilter:e.renderTargetOptions?.magFilter!==void 0?e.renderTargetOptions?.magFilter:Jn,minFilter:e.renderTargetOptions?.minFilter!==void 0?e.renderTargetOptions?.minFilter:Jn,samples:e.renderTargetOptions?.samples!==void 0?e.renderTargetOptions?.samples:void 0,wrapS:e.renderTargetOptions?.wrapS!==void 0?e.renderTargetOptions?.wrapS:ps,wrapT:e.renderTargetOptions?.wrapT!==void 0?e.renderTargetOptions?.wrapT:ps};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=RH.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Wc,this._camera=new Tl,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!GWe(this._type,this._renderer,this._camera,t)){let i;this._type===zi&&(i=this._renderer.extensions.has("EXT_color_buffer_float")?wr:void 0),i!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${wr}`),this._type=i):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Fr(new ap,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Nr(this.width,this.height,t),this._renderTarget.texture.mapping=e.renderTargetOptions?.mapping!==void 0?e.renderTargetOptions?.mapping:Sm}static instantiateRenderer(){const e=new mV;return e.setSize(128,128),e}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Xle(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new xu(this.toArray(),this.width,this.height,Vr,this._type,e?.mapping||Sm,e?.wrapS||ps,e?.wrapT||ps,e?.magFilter||Jn,e?.minFilter||Jn,e?.anisotropy||1,Su);return t.generateMipmaps=e?.generateMipmaps!==void 0?e?.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Ds&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof pr&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof pr&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class Wle extends Error{}class Zle extends Error{}const wC=(n,e,t)=>{const i=new RegExp(`${e}="([^"]*)"`,"i").exec(n);if(i)return i[1];const r=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(n);if(r){const s=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return s&&s.length===3?s.map(a=>a.replace(/<\/?rdf:li>/g,"")):r[1].trim()}if(t!==void 0)return t;throw new Error(`Can't find ${e} in gainmap metadata`)},OWe=n=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(n):e=n.toString();let t=e.indexOf("<x:xmpmeta");for(;t!==-1;){const i=e.indexOf("x:xmpmeta>",t),r=e.slice(t,i+10);try{const s=wC(r,"hdrgm:GainMapMin","0"),a=wC(r,"hdrgm:GainMapMax"),o=wC(r,"hdrgm:Gamma","1"),l=wC(r,"hdrgm:OffsetSDR","0.015625"),u=wC(r,"hdrgm:OffsetHDR","0.015625"),c=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(r),d=c?c[1]:"0",f=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(r);if(!f)throw new Error("Incomplete gainmap metadata");const m=f[1];return{gainMapMin:Array.isArray(s)?s.map(y=>parseFloat(y)):[parseFloat(s),parseFloat(s),parseFloat(s)],gainMapMax:Array.isArray(a)?a.map(y=>parseFloat(y)):[parseFloat(a),parseFloat(a),parseFloat(a)],gamma:Array.isArray(o)?o.map(y=>parseFloat(y)):[parseFloat(o),parseFloat(o),parseFloat(o)],offsetSdr:Array.isArray(l)?l.map(y=>parseFloat(y)):[parseFloat(l),parseFloat(l),parseFloat(l)],offsetHdr:Array.isArray(u)?u.map(y=>parseFloat(y)):[parseFloat(u),parseFloat(u),parseFloat(u)],hdrCapacityMin:parseFloat(d),hdrCapacityMax:parseFloat(m)}}catch{}t=e.indexOf("<x:xmpmeta",i)}};class UWe{options;constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,i)=>{const r=this.options.debug,s=new DataView(e.buffer);if(s.getUint16(0)!==65496){i(new Error("Not a valid jpeg"));return}const a=s.byteLength;let o=2,l=0,u;for(;o<a;){if(++l>250){i(new Error(`Found no marker after ${l} loops `));return}if(s.getUint8(o)!==255){i(new Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${s.getUint8(o).toString(16)}`));return}if(u=s.getUint8(o+1),r&&console.log(`Marker: ${u.toString(16)}`),u===226){r&&console.log("Found APP2 marker (0xffe2)");const c=o+4;if(s.getUint32(c)===1297106432){const d=c+4;let f;if(s.getUint16(d)===18761)f=!1;else if(s.getUint16(d)===19789)f=!0;else{i(new Error("No valid endianness marker found in TIFF header"));return}if(s.getUint16(d+2,!f)!==42){i(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const m=s.getUint32(d+4,!f);if(m<8){i(new Error("Not valid TIFF data! (First offset less than 8)"));return}const y=d+m,_=s.getUint16(y,!f),S=y+2;let b=0;for(let E=S;E<S+12*_;E+=12)s.getUint16(E,!f)===45057&&(b=s.getUint32(E+8,!f));const w=y+2+_*12+4,T=[];for(let E=w;E<w+b*16;E+=16){const R={MPType:s.getUint32(E,!f),size:s.getUint32(E+4,!f),dataOffset:s.getUint32(E+8,!f),dependantImages:s.getUint32(E+12,!f),start:-1,end:-1,isFII:!1};R.dataOffset?(R.start=d+R.dataOffset,R.isFII=!1):(R.start=0,R.isFII=!0),R.end=R.start+R.size,T.push(R)}if(this.options.extractNonFII&&T.length){const E=new Blob([s]),R=[];for(const P of T){if(P.isFII&&!this.options.extractFII)continue;const I=E.slice(P.start,P.end+1,"image/jpeg");R.push(I)}t(R)}}}o+=2+s.getUint16(o+2)}})}}const kWe=async n=>{const e=OWe(n);if(!e)throw new Zle("Gain map XMP metadata not found");const i=await new UWe({extractFII:!0,extractNonFII:!0}).extract(n);if(i.length!==2)throw new Wle("Gain map recovery image not found");return{sdr:new Uint8Array(await i[0].arrayBuffer()),gainMap:new Uint8Array(await i[1].arrayBuffer()),metadata:e}},sK=n=>new Promise((e,t)=>{const i=document.createElement("img");i.onload=()=>{e(i)},i.onerror=r=>{t(r)},i.src=URL.createObjectURL(n)});class zWe extends rl{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(e,t){super(t),this._config=e,e.renderer&&(this._renderer=e.renderer),this._internalLoadingManager=new PR}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new pr,sdr:new pr});return this._config.createQuadRenderer({width:16,height:16,type:zi,colorSpace:Su,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(e,t,i){const r=t?new Blob([t],{type:"image/jpeg"}):void 0,s=new Blob([e],{type:"image/jpeg"});let a,o,l=!1;if(typeof createImageBitmap>"u"){const u=await Promise.all([r?sK(r):Promise.resolve(void 0),sK(s)]);o=u[0],a=u[1],l=i==="flipY"}else{const u=await Promise.all([r?createImageBitmap(r,{imageOrientation:i||"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:i||"flipY"})]);o=u[0],a=u[1]}return{sdrImage:a,gainMapImage:o,needsFlip:l}}createTextures(e,t,i){const r=new pr(t||new ImageData(2,2),Sm,ps,ps,Jn,kw,Vr,br,1,Su);r.flipY=i,r.needsUpdate=!0;const s=new pr(e,Sm,ps,ps,Jn,kw,Vr,br,1,Ps);return s.flipY=i,s.needsUpdate=!0,{gainMap:r,sdr:s}}updateQuadRenderer(e,t,i,r,s){e.width=t.width,e.height=t.height,e.material.gainMap=i,e.material.sdr=r,e.material.gainMapMin=s.gainMapMin,e.material.gainMapMax=s.gainMapMax,e.material.offsetHdr=s.offsetHdr,e.material.offsetSdr=s.offsetSdr,e.material.gamma=s.gamma,e.material.hdrCapacityMin=s.hdrCapacityMin,e.material.hdrCapacityMax=s.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,s.hdrCapacityMax),e.material.needsUpdate=!0}}const VWe=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,HWe=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class XWe extends Ds{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:e,offsetHdr:t,offsetSdr:i,gainMapMin:r,gainMapMax:s,maxDisplayBoost:a,hdrCapacityMin:o,hdrCapacityMax:l,sdr:u,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:VWe,fragmentShader:HWe,uniforms:{sdr:{value:u},gainMap:{value:c},gamma:{value:new re(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new re().fromArray(t)},offsetSdr:{value:new re().fromArray(i)},gainMapMin:{value:new re().fromArray(r)},gainMapMax:{value:new re().fromArray(s)},weightFactor:{value:(Math.log2(a)-o)/(l-o)}},blending:Oa,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=o,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class jle extends zWe{constructor(e,t){super({renderer:e,createMaterial:i=>new XWe(i),createQuadRenderer:i=>new RH(i)},t)}async render(e,t,i,r){const{sdrImage:s,gainMapImage:a,needsFlip:o}=await this.processImages(i,r,"flipY"),{gainMap:l,sdr:u}=this.createTextures(s,a,o);this.updateQuadRenderer(e,s,l,u,t),e.render()}}class WWe extends jle{load([e,t,i],r,s,a){const o=this.prepareQuadRenderer();let l,u,c;const d=async()=>{if(l&&u&&c){try{await this.render(o,c,l,u)}catch(B){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(i),typeof a=="function"&&a(B),o.disposeOnDemandRenderer();return}typeof r=="function"&&r(o),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(i),o.disposeOnDemandRenderer()}};let f=!0,m=0,y=0,_=!0,S=0,b=0,M=!0,w=0,T=0;const E=()=>{if(typeof s=="function"){const B=m+S+w,N=y+b+T,U=f&&_&&M;s(new ProgressEvent("progress",{lengthComputable:U,loaded:N,total:B}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(i);const R=new el(this._internalLoadingManager);R.setResponseType("arraybuffer"),R.setRequestHeader(this.requestHeader),R.setPath(this.path),R.setWithCredentials(this.withCredentials),R.load(e,async B=>{if(typeof B=="string")throw new Error("Invalid sdr buffer");l=B,await d()},B=>{f=B.lengthComputable,y=B.loaded,m=B.total,E()},B=>{this.manager.itemError(e),typeof a=="function"&&a(B)});const P=new el(this._internalLoadingManager);P.setResponseType("arraybuffer"),P.setRequestHeader(this.requestHeader),P.setPath(this.path),P.setWithCredentials(this.withCredentials),P.load(t,async B=>{if(typeof B=="string")throw new Error("Invalid gainmap buffer");u=B,await d()},B=>{_=B.lengthComputable,b=B.loaded,S=B.total,E()},B=>{this.manager.itemError(t),typeof a=="function"&&a(B)});const I=new el(this._internalLoadingManager);return I.setRequestHeader(this.requestHeader),I.setPath(this.path),I.setWithCredentials(this.withCredentials),I.load(i,async B=>{if(typeof B!="string")throw new Error("Invalid metadata string");c=JSON.parse(B),await d()},B=>{M=B.lengthComputable,T=B.loaded,w=B.total,E()},B=>{this.manager.itemError(i),typeof a=="function"&&a(B)}),o}}class ZWe extends jle{load(e,t,i,r){const s=this.prepareQuadRenderer(),a=new el(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async o=>{if(typeof o=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const l=new Uint8Array(o);let u,c,d;try{const f=await kWe(l);u=f.sdr,c=f.gainMap,d=f.metadata}catch(f){if(f instanceof Zle||f instanceof Wle)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),d={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},u=l;else throw f}try{await this.render(s,d,u.buffer,c?.buffer)}catch(f){this.manager.itemError(e),typeof r=="function"&&r(f),s.disposeOnDemandRenderer();return}typeof t=="function"&&t(s),this.manager.itemEnd(e),s.disposeOnDemandRenderer()},i,o=>{this.manager.itemError(e),typeof r=="function"&&r(o)}),s}}const aE={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Yle="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",sM=n=>Array.isArray(n),PH=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function mL({files:n=PH,path:e="",preset:t=void 0,colorSpace:i=void 0,extensions:r}={}){t&&(DH(t),n=aE[t],e=Yle);const s=sM(n),{extension:a,isCubemap:o}=NH(n),l=BH(a);if(!l)throw new Error("useEnvironment: Unrecognized file extension: "+n);const u=ir(m=>m.gl);G.useLayoutEffect(()=>{if(a!=="webp"&&a!=="jpg"&&a!=="jpeg")return;function m(){Gd.clear(l,s?[n]:n)}u.domElement.addEventListener("webglcontextlost",m,{once:!0})},[n,u.domElement]);const c=Gd(l,s?[n]:n,m=>{(a==="webp"||a==="jpg"||a==="jpeg")&&m.setRenderer(u),m.setPath==null||m.setPath(e),r&&r(m)});let d=s?c[0]:c;if(a==="jpg"||a==="jpeg"||a==="webp"){var f;d=(f=d.renderTarget)==null?void 0:f.texture}return d.mapping=o?_u:Mm,d.colorSpace=i??(o?"srgb":"srgb-linear"),d}const jWe={files:PH,path:"",preset:void 0,extensions:void 0};mL.preload=n=>{const e={...jWe,...n};let{files:t,path:i=""}=e;const{preset:r,extensions:s}=e;r&&(DH(r),t=aE[r],i=Yle);const{extension:a}=NH(t);if(a==="webp"||a==="jpg"||a==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const o=BH(a);if(!o)throw new Error("useEnvironment: Unrecognized file extension: "+t);Gd.preload(o,sM(t)?[t]:t,l=>{l.setPath==null||l.setPath(i),s&&s(l)})};const YWe={files:PH,preset:void 0};mL.clear=n=>{const e={...YWe,...n};let{files:t}=e;const{preset:i}=e;i&&(DH(i),t=aE[i]);const{extension:r}=NH(t),s=BH(r);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+t);Gd.clear(s,sM(t)?[t]:t)};function DH(n){if(!(n in aE))throw new Error("Preset must be one of: "+Object.keys(aE).join(", "))}function NH(n){var e;const t=sM(n)&&n.length===6,i=sM(n)&&n.length===3&&n.some(a=>a.endsWith("json")),r=sM(n)?n[0]:n;return{extension:t?"cube":i?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":(e=r.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:t,isGainmap:i}}function BH(n){return n==="cube"?tV:n==="hdr"?nWe:n==="exr"?iWe:n==="jpg"||n==="jpeg"?ZWe:n==="webp"?WWe:null}const KWe=n=>n.current&&n.current.isScene,$We=n=>KWe(n)?n.current:n;function FH(n,e,t,i,r={}){var s,a,o,l;r={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const u=$We(e||t),c=u.background,d=u.environment,f={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:(s=(a=u.backgroundRotation)==null||a.clone==null?void 0:a.clone())!==null&&s!==void 0?s:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:(o=(l=u.environmentRotation)==null||l.clone==null?void 0:l.clone())!==null&&o!==void 0?o:[0,0,0]};return n!=="only"&&(u.environment=i),n&&(u.background=i),xd(u,r),()=>{n!=="only"&&(u.environment=d),n&&(u.background=c),xd(u,f)}}function LH({scene:n,background:e=!1,map:t,...i}){const r=ir(s=>s.scene);return G.useLayoutEffect(()=>{if(t)return FH(e,n,r,t,i)}),null}function Kle({background:n=!1,scene:e,blur:t,backgroundBlurriness:i,backgroundIntensity:r,backgroundRotation:s,environmentIntensity:a,environmentRotation:o,...l}){const u=mL(l),c=ir(d=>d.scene);return G.useLayoutEffect(()=>FH(n,e,c,u,{backgroundBlurriness:t??i,backgroundIntensity:r,backgroundRotation:s,environmentIntensity:a,environmentRotation:o})),G.useEffect(()=>()=>{u.dispose()},[u]),null}function JWe({children:n,near:e=.1,far:t=1e3,resolution:i=256,frames:r=1,map:s,background:a=!1,blur:o,backgroundBlurriness:l,backgroundIntensity:u,backgroundRotation:c,environmentIntensity:d,environmentRotation:f,scene:m,files:y,path:_,preset:S=void 0,extensions:b}){const M=ir(I=>I.gl),w=ir(I=>I.scene),T=G.useRef(null),[E]=G.useState(()=>new Wc),R=G.useMemo(()=>{const I=new jM(i);return I.texture.type=zi,I},[i]);G.useEffect(()=>()=>{R.dispose()},[R]),G.useLayoutEffect(()=>{if(r===1){const I=M.autoClear;M.autoClear=!0,T.current.update(M,E),M.autoClear=I}return FH(a,m,w,R.texture,{backgroundBlurriness:o??l,backgroundIntensity:u,backgroundRotation:c,environmentIntensity:d,environmentRotation:f})},[n,E,R.texture,m,w,a,r,M]);let P=1;return rs(()=>{if(r===1/0||P<r){const I=M.autoClear;M.autoClear=!0,T.current.update(M,E),M.autoClear=I,P++}}),G.createElement(G.Fragment,null,SV(G.createElement(G.Fragment,null,n,G.createElement("cubeCamera",{ref:T,args:[e,t,R]}),y||S?G.createElement(Kle,{background:!0,files:y,preset:S,path:_,extensions:b}):s?G.createElement(LH,{background:!0,map:s,extensions:b}):null),E))}function qWe(n){var e,t,i,r;const s=mL(n),a=n.map||s;G.useMemo(()=>eo({GroundProjectedEnvImpl:jXe}),[]),G.useEffect(()=>()=>{s.dispose()},[s]);const o=G.useMemo(()=>[a],[a]),l=(e=n.ground)==null?void 0:e.height,u=(t=n.ground)==null?void 0:t.radius,c=(i=(r=n.ground)==null?void 0:r.scale)!==null&&i!==void 0?i:1e3;return G.createElement(G.Fragment,null,G.createElement(LH,Ta({},n,{map:a})),G.createElement("groundProjectedEnvImpl",{args:o,scale:c,height:l,radius:u}))}function gL(n){return n.ground?G.createElement(qWe,n):n.map?G.createElement(LH,n):n.children?G.createElement(JWe,n):G.createElement(Kle,n)}function QWe(n){return n.isLight}function eZe(n){return!!n.geometry}const $le=G.createContext(null),tZe=Yd({color:new en,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${YR>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),Jle=G.forwardRef(({children:n,temporal:e,frames:t=40,limit:i=1/0,blend:r=20,scale:s=10,opacity:a=1,alphaTest:o=.75,color:l="black",colorBlend:u=2,resolution:c=1024,toneMapped:d=!0,...f},m)=>{eo({SoftShadowMaterial:tZe});const y=ir(R=>R.gl),_=ir(R=>R.scene),S=ir(R=>R.camera),b=ir(R=>R.invalidate),M=G.useRef(null),w=G.useRef(null),[T]=G.useState(()=>new nZe(y,_,c));G.useLayoutEffect(()=>{T.configure(M.current)},[]);const E=G.useMemo(()=>({lights:new Map,temporal:!!e,frames:Math.max(2,t),blend:Math.max(2,t===1/0?r:t),count:0,getMesh:()=>M.current,reset:()=>{T.clear();const R=M.current.material;R.opacity=0,R.alphaTest=0,E.count=0},update:(R=1)=>{const P=M.current.material;E.temporal?(P.opacity=Math.min(a,P.opacity+a/E.blend),P.alphaTest=Math.min(o,P.alphaTest+o/E.blend)):(P.opacity=a,P.alphaTest=o),w.current.visible=!0,T.prepare();for(let I=0;I<R;I++)E.lights.forEach(B=>B.update()),T.update(S,E.blend);w.current.visible=!1,T.finish()}}),[T,S,_,e,t,r,a,o]);return G.useLayoutEffect(()=>{E.reset(),!E.temporal&&E.frames!==1/0&&E.update(E.blend)}),G.useImperativeHandle(m,()=>E,[E]),rs(()=>{(E.temporal||E.frames===1/0)&&E.count<E.frames&&E.count<i&&(b(),E.update(),E.count++)}),G.createElement("group",f,G.createElement("group",{traverse:()=>null,ref:w},G.createElement($le.Provider,{value:E},n)),G.createElement("mesh",{receiveShadow:!0,ref:M,scale:s,rotation:[-Math.PI/2,0,0]},G.createElement("planeGeometry",null),G.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:d,color:l,blend:u,map:T.progressiveLightMap2.texture})))}),qle=G.forwardRef(({castShadow:n=!0,bias:e=.001,mapSize:t=512,size:i=5,near:r=.5,far:s=500,frames:a=1,position:o=[0,0,0],radius:l=1,amount:u=8,intensity:c=YR>=155?Math.PI:1,ambient:d=.5,...f},m)=>{const y=G.useRef(null),_=new re(...o).length(),S=G.useContext($le),b=G.useCallback(()=>{let w;if(y.current)for(let T=0;T<y.current.children.length;T++)if(w=y.current.children[T],Math.random()>d)w.position.set(o[0]+Wl.randFloatSpread(l),o[1]+Wl.randFloatSpread(l),o[2]+Wl.randFloatSpread(l));else{let E=Math.acos(2*Math.random()-1)-Math.PI/2,R=2*Math.PI*Math.random();w.position.set(Math.cos(E)*Math.cos(R)*_,Math.abs(Math.cos(E)*Math.sin(R)*_),Math.sin(E)*_)}},[l,d,_,...o]),M=G.useMemo(()=>({update:b}),[b]);return G.useImperativeHandle(m,()=>M,[M]),G.useLayoutEffect(()=>{var w;const T=y.current;return S&&((w=S.lights)==null||w.set(T.uuid,M)),()=>{var E;S==null||(E=S.lights)==null?void 0:E.delete(T.uuid)}},[S,M]),G.createElement("group",Ta({ref:y},f),Array.from({length:u},(w,T)=>G.createElement("directionalLight",{key:T,castShadow:n,"shadow-bias":e,"shadow-mapSize":[t,t],intensity:c/u},G.createElement("orthographicCamera",{attach:"shadow-camera",args:[-i,i,i,-i,r,s]}))))});class nZe{constructor(e,t,i=1024){this.renderer=e,this.res=i,this.scene=t,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new en,this.clearAlpha=0;const r={type:zi,magFilter:xr,minFilter:xr};this.progressiveLightMap1=new Nr(this.res,this.res,r),this.progressiveLightMap2=new Nr(this.res,this.res,r),this.discardMat=new BWe,this.targetMat=new tA({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=s=>{s.vertexShader=`varying vec2 vUv;
`+s.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const a=s.fragmentShader.indexOf("void main() {");s.fragmentShader=`varying vec2 vUv;
`+s.fragmentShader.slice(0,a)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+s.fragmentShader.slice(a-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,s.uniforms.previousShadowMap=this.previousShadowMap,s.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{eZe(e)?this.meshes.push({object:e,material:e.material}):QWe(e)&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;const i=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,r=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,s=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(i),this.previousShadowMap.value=r.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=s}}const iZe="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",aK=new Mn,eN=new re,tN=new ba,oK=new re,lK=new ba,EC=new re,IH=G.createContext(null),GH=G.forwardRef(({children:n,material:e=tA,texture:t=iZe,range:i,limit:r=200,frustumCulled:s,...a},o)=>{var l,u;const c=G.useMemo(()=>class extends e{constructor(){super();const I=parseInt(Xd.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=B=>{B.vertexShader=`attribute float cloudOpacity;
               varying float vOpacity;
              `+B.vertexShader.replace("#include <fog_vertex>",`#include <fog_vertex>
                 vOpacity = cloudOpacity;
                `),B.fragmentShader=`varying float vOpacity;
              `+B.fragmentShader.replace(`#include <${I}>`,`#include <${I}>
                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);
                `)}}},[e]);eo({CloudMaterial:c});const d=G.useRef(null),f=G.useRef([]),m=G.useMemo(()=>new Float32Array(Array.from({length:r},()=>1)),[r]),y=G.useMemo(()=>new Float32Array(Array.from({length:r},()=>[1,1,1]).flat()),[r]),_=EH(t);let S=0,b=0,M;const w=new ba,T=new re(0,0,1),E=new re;rs((I,B)=>{for(S=I.clock.elapsedTime,aK.copy(d.current.matrixWorld).invert(),I.camera.matrixWorld.decompose(oK,lK,EC),b=0;b<f.current.length;b++)M=f.current[b],M.ref.current.matrixWorld.decompose(eN,tN,EC),eN.add(E.copy(M.position).applyQuaternion(tN).multiply(EC)),tN.copy(lK).multiply(w.setFromAxisAngle(T,M.rotation+=B*M.rotationFactor)),EC.multiplyScalar(M.volume+(1+Math.sin(S*M.density*M.speed))/2*M.growth),M.matrix.compose(eN,tN,EC).premultiply(aK),M.dist=eN.distanceTo(oK);for(f.current.sort((N,U)=>U.dist-N.dist),b=0;b<f.current.length;b++)M=f.current[b],m[b]=M.opacity*(M.dist<M.fade-1?M.dist/M.fade:1),d.current.setMatrixAt(b,M.matrix),d.current.setColorAt(b,M.color);d.current.geometry.attributes.cloudOpacity.needsUpdate=!0,d.current.instanceMatrix.needsUpdate=!0,d.current.instanceColor&&(d.current.instanceColor.needsUpdate=!0)}),G.useLayoutEffect(()=>{const I=Math.min(r,i!==void 0?i:r,f.current.length);d.current.count=I,Sw(d.current.instanceMatrix,{start:0,count:I*16}),d.current.instanceColor&&Sw(d.current.instanceColor,{start:0,count:I*3}),Sw(d.current.geometry.attributes.cloudOpacity,{start:0,count:I})});let R=[(l=_.image.width)!==null&&l!==void 0?l:1,(u=_.image.height)!==null&&u!==void 0?u:1];const P=Math.max(R[0],R[1]);return R=[R[0]/P,R[1]/P],G.createElement("group",Ta({ref:o},a),G.createElement(IH.Provider,{value:f},n,G.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:d,args:[null,null,r],frustumCulled:s},G.createElement("instancedBufferAttribute",{usage:bh,attach:"instanceColor",args:[y,3]}),G.createElement("planeGeometry",{args:[...R]},G.createElement("instancedBufferAttribute",{usage:bh,attach:"attributes-cloudOpacity",args:[m,1]})),G.createElement("cloudMaterial",{key:e.name,map:_,transparent:!0,depthWrite:!1}))))}),uK=G.forwardRef(({opacity:n=1,speed:e=0,bounds:t=[5,1,1],segments:i=20,color:r="#ffffff",fade:s=10,volume:a=6,smallestVolume:o=.25,distribute:l=null,growth:u=4,concentrate:c="inside",seed:d=Math.random(),...f},m)=>{function y(){const w=Math.sin(d++)*1e4;return w-Math.floor(w)}const _=G.useContext(IH),S=G.useRef(null),b=G.useId(),M=G.useMemo(()=>[...new Array(i)].map((w,T)=>({segments:i,bounds:new re(1,1,1),position:new re,uuid:b,index:T,ref:S,dist:0,matrix:new Mn,color:new en,rotation:T*(Math.PI/i)})),[i,b]);return G.useLayoutEffect(()=>{M.forEach((w,T)=>{xd(w,{volume:a,color:r,speed:e,growth:u,opacity:n,fade:s,bounds:t,density:Math.max(.5,y()),rotationFactor:Math.max(.2,.5*y())*e});const E=l?.(w,T);if(E||i>1){var R;w.position.copy(w.bounds).multiply((R=E?.point)!==null&&R!==void 0?R:{x:y()*2-1,y:y()*2-1,z:y()*2-1})}const P=Math.abs(w.position.x),I=Math.abs(w.position.y),B=Math.abs(w.position.z),N=Math.max(P,I,B);w.length=1,P===N&&(w.length-=P/w.bounds.x),I===N&&(w.length-=I/w.bounds.y),B===N&&(w.length-=B/w.bounds.z),w.volume=(E?.volume!==void 0?E.volume:Math.max(Math.max(0,o),c==="random"?y():c==="inside"?w.length:1-w.length))*a})},[c,t,s,r,n,u,a,d,i,e]),G.useLayoutEffect(()=>{const w=M;return _.current=[..._.current,...w],()=>{_.current=_.current.filter(T=>T.uuid!==b)}},[M]),G.useImperativeHandle(m,()=>S.current,[]),G.createElement("group",Ta({ref:S},f))}),Qle=G.forwardRef((n,e)=>G.useContext(IH)?G.createElement(uK,Ta({ref:e},n)):G.createElement(GH,null,G.createElement(uK,Ta({ref:e},n))));class rZe extends Ds{constructor(){super({uniforms:{time:{value:0},pixelRatio:{value:1}},vertexShader:`
        uniform float pixelRatio;
        uniform float time;
        attribute float size;  
        attribute float speed;  
        attribute float opacity;
        attribute vec3 noise;
        attribute vec3 color;
        varying vec3 vColor;
        varying float vOpacity;

        void main() {
          vec4 modelPosition = modelMatrix * vec4(position, 1.0);
          modelPosition.y += sin(time * speed + modelPosition.x * noise.x * 100.0) * 0.2;
          modelPosition.z += cos(time * speed + modelPosition.x * noise.y * 100.0) * 0.2;
          modelPosition.x += cos(time * speed + modelPosition.x * noise.z * 100.0) * 0.2;
          vec4 viewPosition = viewMatrix * modelPosition;
          vec4 projectionPostion = projectionMatrix * viewPosition;
          gl_Position = projectionPostion;
          gl_PointSize = size * 25. * pixelRatio;
          gl_PointSize *= (1.0 / - viewPosition.z);
          vColor = color;
          vOpacity = opacity;
        }
      `,fragmentShader:`
        varying vec3 vColor;
        varying float vOpacity;
        void main() {
          float distanceToCenter = distance(gl_PointCoord, vec2(0.5));
          float strength = 0.05 / distanceToCenter - 0.1;
          gl_FragColor = vec4(vColor, strength * vOpacity);
          #include <tonemapping_fragment>
          #include <${YR>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}get pixelRatio(){return this.uniforms.pixelRatio.value}set pixelRatio(e){this.uniforms.pixelRatio.value=e}}const eue=n=>n&&n.constructor===Float32Array,sZe=n=>[n.r,n.g,n.b],tue=n=>n instanceof rt||n instanceof re||n instanceof si,nue=n=>Array.isArray(n)?n:tue(n)?n.toArray():[n,n,n];function RC(n,e,t){return G.useMemo(()=>{if(e!==void 0){if(eue(e))return e;if(e instanceof en){const i=Array.from({length:n*3},()=>sZe(e)).flat();return Float32Array.from(i)}else if(tue(e)||Array.isArray(e)){const i=Array.from({length:n*3},()=>nue(e)).flat();return Float32Array.from(i)}return Float32Array.from({length:n},()=>e)}return Float32Array.from({length:n},t)},[e])}const aZe=G.forwardRef(({noise:n=1,count:e=100,speed:t=1,opacity:i=1,scale:r=1,size:s,color:a,children:o,...l},u)=>{G.useMemo(()=>eo({SparklesImplMaterial:rZe}),[]);const c=G.useRef(null),d=ir(w=>w.viewport.dpr),f=nue(r),m=G.useMemo(()=>Float32Array.from(Array.from({length:e},()=>f.map(Wl.randFloatSpread)).flat()),[e,...f]),y=RC(e,s,Math.random),_=RC(e,i),S=RC(e,t),b=RC(e*3,n),M=RC(a===void 0?e*3:e,eue(a)?a:new en(a),()=>1);return rs(w=>{c.current&&c.current.material&&(c.current.material.time=w.clock.elapsedTime)}),G.useImperativeHandle(u,()=>c.current,[]),G.createElement("points",Ta({key:`particle-${e}-${JSON.stringify(r)}`},l,{ref:c}),G.createElement("bufferGeometry",null,G.createElement("bufferAttribute",{attach:"attributes-position",args:[m,3]}),G.createElement("bufferAttribute",{attach:"attributes-size",args:[y,1]}),G.createElement("bufferAttribute",{attach:"attributes-opacity",args:[_,1]}),G.createElement("bufferAttribute",{attach:"attributes-speed",args:[S,1]}),G.createElement("bufferAttribute",{attach:"attributes-color",args:[M,3]}),G.createElement("bufferAttribute",{attach:"attributes-noise",args:[b,3]})),o||G.createElement("sparklesImplMaterial",{transparent:!0,pixelRatio:d,depthWrite:!1}))});function oZe(){const n=ir(e=>e.gl);return G.useEffect(()=>(n.shadowMap.autoUpdate=!1,n.shadowMap.needsUpdate=!0,()=>{n.shadowMap.autoUpdate=n.shadowMap.needsUpdate=!0}),[n.shadowMap]),null}const lZe=G.forwardRef(({children:n,compute:e,width:t,height:i,samples:r=8,renderPriority:s=0,eventPriority:a=0,frames:o=1/0,stencilBuffer:l=!1,depthBuffer:u=!0,generateMipmaps:c=!1,...d},f)=>{const{size:m,viewport:y}=ir(),_=Ole((t||m.width)*y.dpr,(i||m.height)*y.dpr,{samples:r,stencilBuffer:l,depthBuffer:u,generateMipmaps:c}),[S]=G.useState(()=>new Wc),b=G.useCallback((M,w,T)=>{var E,R;let P=(E=_.texture)==null||(E=E.__r3f.parent)==null?void 0:E.object;for(;P&&!(P instanceof Br);){var I;P=(I=P.__r3f.parent)==null?void 0:I.object}if(!P)return!1;T.raycaster.camera||T.events.compute(M,T,(R=T.previousRoot)==null?void 0:R.getState());const[B]=T.raycaster.intersectObject(P);if(!B)return!1;const N=B.uv;if(!N)return!1;w.raycaster.setFromCamera(w.pointer.set(N.x*2-1,N.y*2-1),w.camera)},[]);return G.useImperativeHandle(f,()=>_.texture,[_]),G.createElement(G.Fragment,null,SV(G.createElement(uZe,{renderPriority:s,frames:o,fbo:_},n,G.createElement("group",{onPointerOver:()=>null})),S,{events:{compute:e||b,priority:a}}),G.createElement("primitive",Ta({object:_.texture},d)))});function uZe({frames:n,renderPriority:e,children:t,fbo:i}){let r=0,s,a,o,l;return rs(u=>{(n===1/0||r<n)&&(s=u.gl.autoClear,a=u.gl.xr.enabled,o=u.gl.getRenderTarget(),l=u.gl.xr.isPresenting,u.gl.autoClear=!0,u.gl.xr.enabled=!1,u.gl.xr.isPresenting=!1,u.gl.setRenderTarget(i),u.gl.render(u.scene,u.camera),u.gl.setRenderTarget(o),u.gl.autoClear=s,u.gl.xr.enabled=a,u.gl.xr.isPresenting=l,r++)},e),G.createElement(G.Fragment,null,t)}function iue(){const{progress:n}=NXe(),e=Math.floor(n);return $.jsx(TH,{center:!0,children:$.jsxs("div",{className:"Loader",children:[$.jsx("div",{className:"Text-container",children:"Loading"}),$.jsx(Tle,{now:e}),$.jsxs("div",{className:"Text-container",children:[e," %"]})]})})}var gU=1/1e3,cZe=1e3,hZe=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*gU}get fixedDelta(){return this._fixedDelta*gU}set fixedDelta(n){this._fixedDelta=n*cZe}get elapsed(){return this._elapsed*gU}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},dZe=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new wi;return t.setAttribute("position",new Gi(n,3)),t.setAttribute("uv",new Gi(e,2)),t})(),Kd=class Ik{static get fullscreenGeometry(){return dZe}constructor(e="Pass",t=new Wc,i=new Tl){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new Fr(Ik.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Wc),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=sp){}render(e,t,i,r,s){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Nr||t instanceof _a||t instanceof pr||t instanceof Ik)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},fZe=class extends Kd{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,i,r){const s=n.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},pZe=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,mZe="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",gZe=class extends Ds{constructor(){super({name:"CopyMaterial",defines:{COLOR_SPACE_CONVERSION:"1",DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new mi(null),depthBuffer:new mi(null),channelWeights:new mi(null),opacity:new mi(1)},blending:Oa,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:pZe,vertexShader:mZe}),this.depthFunc=hv}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(n){const e=n!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){const e=n!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}get colorSpaceConversion(){return this.defines.COLOR_SPACE_CONVERSION!==void 0}set colorSpaceConversion(n){this.colorSpaceConversion!==n&&(n?this.defines.COLOR_SPACE_CONVERSION=!0:delete this.defines.COLOR_SPACE_CONVERSION,this.needsUpdate=!0)}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(n){n!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=n):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},yZe=class extends Kd{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new gZe,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Nr(1,1,{minFilter:Jn,magFilter:Jn,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,i,r){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==br?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===Ps&&(this.renderTarget.texture.colorSpace=Ps))}},cK=new en,rue=class extends Kd{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,i,r){const s=this.overrideClearColor,a=this.overrideClearAlpha,o=n.getClearAlpha(),l=s!==null,u=a>=0;l?(n.getClearColor(cK),n.setClearColor(s,u?a:o)):u&&n.setClearAlpha(a),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),l?n.setClearColor(cK,o):u&&n.setClearAlpha(o)}},vZe=class extends Kd{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new rue(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,i,r){const s=n.getContext(),a=n.state.buffers,o=this.scene,l=this.camera,u=this.clearPass,c=this.inverted?0:1,d=1-c;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,c,4294967295),a.stencil.setClear(d),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?u.render(n,null):(u.render(n,e),u.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(o,l)):(n.setRenderTarget(e),n.render(o,l),n.setRenderTarget(t),n.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},xZe=class{constructor(n=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:i=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,r,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new yZe,this.depthTexture=null,this.passes=[],this.timer=new hZe,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const e=this.inputBuffer,t=this.multisampling;t>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const e=n.getSize(new rt),t=n.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===br&&n.outputColorSpace===Ps&&(this.inputBuffer.texture.colorSpace=Ps,this.outputBuffer.texture.colorSpace=Ps,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(e.width,e.height);for(const r of this.passes)r.initialize(n,t,i)}}replaceRenderer(n,e=!0){const t=this.renderer,i=t.domElement.parentNode;return this.setRenderer(n),e&&i!==null&&(i.removeChild(t.domElement),i.appendChild(n.domElement)),t}createDepthTexture(){const n=this.depthTexture=new po;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=bl,n.type=jl):n.type=qr,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,e,t,i){const r=this.renderer,s=r===null?new rt:r.getDrawingBufferSize(new rt),a={minFilter:Jn,magFilter:Jn,stencilBuffer:e,depthBuffer:n,type:t},o=new Nr(s.width,s.height,a);return i>0&&(o.samples=i),t===br&&r!==null&&r.outputColorSpace===Ps&&(o.texture.colorSpace=Ps),o.texture.name="EffectComposer.Buffer",o.texture.generateMipmaps=!1,o}setMainScene(n){for(const e of this.passes)e.mainScene=n}setMainCamera(n){for(const e of this.passes)e.mainCamera=n}addPass(n,e){const t=this.passes,i=this.renderer,r=i.getDrawingBufferSize(new rt),s=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(n.setRenderer(i),n.setSize(r.width,r.height),n.initialize(i,s,a),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,n):t.push(n),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const o=this.createDepthTexture();for(n of t)n.setDepthTexture(o)}else n.setDepthTexture(this.depthTexture)}removePass(n){const e=this.passes,t=e.indexOf(n);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const s=(o,l)=>o||l.needsDepthTexture;e.reduce(s,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(n.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const e=this.renderer,t=this.copyPass;let i=this.inputBuffer,r=this.outputBuffer,s=!1,a,o,l;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const u of this.passes)u.enabled&&(u.render(e,i,r,n,s),u.needsSwap&&(s&&(t.renderToScreen=u.renderToScreen,a=e.getContext(),o=e.state.buffers.stencil,o.setFunc(a.NOTEQUAL,1,4294967295),t.render(e,i,r,n,s),o.setFunc(a.EQUAL,1,4294967295)),l=i,i=r,r=l),u instanceof vZe?s=!0:u instanceof fZe&&(s=!1))}setSize(n,e,t){const i=this.renderer,r=i.getSize(new rt);(n===void 0||e===void 0)&&(n=r.width,e=r.height),(r.width!==n||r.height!==e)&&i.setSize(n,e,t);const s=i.getDrawingBufferSize(new rt);this.inputBuffer.setSize(s.width,s.height),this.outputBuffer.setSize(s.width,s.height);for(const a of this.passes)a.setSize(s.width,s.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Kd.fullscreenGeometry.dispose()}},sv={NONE:0,DEPTH:1,CONVOLUTION:2},cs={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},bZe=class{constructor(){this.shaderParts=new Map([[cs.FRAGMENT_HEAD,null],[cs.FRAGMENT_MAIN_UV,null],[cs.FRAGMENT_MAIN_IMAGE,null],[cs.VERTEX_HEAD,null],[cs.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=sv.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Su}},yU=!1,hK=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case fr:t=this.materialsFlatShadedDoubleSide;break;case Er:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case fr:t=this.materialsDoubleSide;break;case Er:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof Ds))return n.clone();const e=n.uniforms,t=new Map;for(const r in e){const s=e[r].value;s.isRenderTargetTexture&&(e[r].value=null,t.set(r,s))}const i=n.clone();for(const r of t)e[r[0]].value=r[1],i.uniforms[r[0]].value=r[1];return i}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=wo;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.side=Er,i}),this.materialsDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.side=fr,i}),this.materialsFlatShaded=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=Er,i}),this.materialsFlatShadedDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=fr,i})}}render(n,e,t){const i=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,yU){const r=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const s of r)s[0].material=s[1];this.meshCount!==r.size&&r.clear()}else{const r=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=r}n.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return yU}static set workaroundEnabled(n){yU=n}},Cy=-1,r0=class extends wl{constructor(n,e=Cy,t=Cy,i=1){super(),this.resizable=n,this.baseSize=new rt(1,1),this.preferredSize=new rt(e,t),this.target=this.preferredSize,this.s=i,this.effectiveSize=new rt,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,i=this.scale;e.width!==Cy?t.width=e.width:e.height!==Cy?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*i),e.height!==Cy?t.height=e.height:e.width!==Cy?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*i)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Cy),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Cy}},Wr={ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},_Ze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",SZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return mix(dst,src,src.a*opacity);}",MZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=(dst.rgb+src.rgb)*0.5;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",AZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(b.xy,a.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",TZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=dst.rgb,b=src.rgb;vec3 c=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/max(b,1e-9))),vec3(1.0),step(1.0,a));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",CZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=dst.rgb,b=src.rgb;vec3 c=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",wZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=min(dst.rgb,src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",EZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=abs(dst.rgb-src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",RZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb/max(src.rgb,1e-9);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",PZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb-2.0*dst.rgb*src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",DZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=min(dst.rgb,1.0);vec3 b=min(src.rgb,1.0);vec3 c=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",NZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=step(1.0,dst.rgb+src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",BZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(b.x,a.yz));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",FZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(1.0-src.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",LZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=src.rgb*max(1.0-dst.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",IZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(dst.rgb,src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",GZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=clamp(src.rgb+dst.rgb-1.0,0.0,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",OZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=min(dst.rgb+src.rgb,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",UZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=clamp(2.0*src.rgb+dst.rgb-1.0,0.0,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",kZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(a.xy,b.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",zZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb*src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",VZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(1.0-abs(1.0-dst.rgb-src.rgb),0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",HZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return mix(dst,src,opacity);}",XZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=2.0*src.rgb*dst.rgb;vec3 b=1.0-2.0*(1.0-src.rgb)*(1.0-dst.rgb);vec3 c=mix(a,b,step(0.5,dst.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",WZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 src2=2.0*src.rgb;vec3 c=mix(mix(src2,dst.rgb,step(0.5*dst.rgb,src.rgb)),max(src2-1.0,vec3(0.0)),step(dst.rgb,src2-1.0));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",ZZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=min(dst.rgb*dst.rgb/max(1.0-src.rgb,1e-9),1.0);vec3 c=mix(a,src.rgb,step(1.0,src.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",jZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(a.x,b.y,a.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",YZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb-min(dst.rgb*src.rgb,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",KZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 src2=2.0*src.rgb;vec3 d=dst.rgb+(src2-1.0);vec3 w=step(0.5,src.rgb);vec3 a=dst.rgb-(1.0-src2)*dst.rgb*(1.0-dst.rgb);vec3 b=mix(d*(sqrt(dst.rgb)-dst.rgb),d*dst.rgb*((16.0*dst.rgb-12.0)*dst.rgb+3.0),w*(1.0-step(0.25,dst.rgb)));vec3 c=mix(a,b,w);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",$Ze="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return src;}",JZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(dst.rgb-src.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",qZe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=mix(max(1.0-min((1.0-dst.rgb)/(2.0*src.rgb),1.0),0.0),min(dst.rgb/(2.0*(1.0-src.rgb)),1.0),step(0.5,src.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",QZe=new Map([[Wr.ADD,_Ze],[Wr.ALPHA,SZe],[Wr.AVERAGE,MZe],[Wr.COLOR,AZe],[Wr.COLOR_BURN,TZe],[Wr.COLOR_DODGE,CZe],[Wr.DARKEN,wZe],[Wr.DIFFERENCE,EZe],[Wr.DIVIDE,RZe],[Wr.DST,null],[Wr.EXCLUSION,PZe],[Wr.HARD_LIGHT,DZe],[Wr.HARD_MIX,NZe],[Wr.HUE,BZe],[Wr.INVERT,FZe],[Wr.INVERT_RGB,LZe],[Wr.LIGHTEN,IZe],[Wr.LINEAR_BURN,GZe],[Wr.LINEAR_DODGE,OZe],[Wr.LINEAR_LIGHT,UZe],[Wr.LUMINOSITY,kZe],[Wr.MULTIPLY,zZe],[Wr.NEGATION,VZe],[Wr.NORMAL,HZe],[Wr.OVERLAY,XZe],[Wr.PIN_LIGHT,WZe],[Wr.REFLECT,ZZe],[Wr.SATURATION,jZe],[Wr.SCREEN,YZe],[Wr.SOFT_LIGHT,KZe],[Wr.SRC,$Ze],[Wr.SUBTRACT,JZe],[Wr.VIVID_LIGHT,qZe]]),eje=class extends wl{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new mi(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return QZe.get(this.blendFunction)}},oE=class extends wl{constructor(n,e,{attributes:t=sv.NONE,blendFunction:i=Wr.NORMAL,defines:r=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=n,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=o,this.defines=r,this.uniforms=s,this.extensions=a,this.blendMode=new eje(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=Su,this._outputColorSpace=xl}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=sp){}update(n,e,t){}setSize(n,e){}initialize(n,e,t){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof Nr||e instanceof _a||e instanceof pr||e instanceof Kd)&&this[n].dispose()}}},tje=class extends Kd{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,t,i,r){const s=this.fullscreenMaterial.uniforms;e!==null&&s!==void 0&&s[this.input]!==void 0&&(s[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}initialize(n,e,t){t!==void 0&&t!==br&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}};function nje(n,e,t){const i=new Map([[rp,1],[_l,2],[Vr,4]]);let r;if(i.has(e)||console.error("Invalid noise texture format"),t===br){r=new Uint8Array(n*i.get(e));for(let s=0,a=r.length;s<a;++s)r[s]=Math.random()*255+.5}else{r=new Float32Array(n*i.get(e));for(let s=0,a=r.length;s<a;++s)r[s]=Math.random()}return r}var ije=class extends xu{constructor(n,e,t=rp,i=br){super(nje(n*e,t,i),n,e,t,i),this.needsUpdate=!0}},sue=class extends Kd{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new rue,this.overrideMaterialManager=t===null?null:new hK(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new hK(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,i,r){const s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,u=s.background,c=n.shadowMap.autoUpdate,d=this.renderToScreen?null:e;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(d),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,s,a):n.render(s,a),a.layers.mask=l,s.background=u,n.shadowMap.autoUpdate=c}},rje="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",sje=class extends oE{constructor(n=30){super("PixelationEffect",rje,{uniforms:new Map([["active",new mi(!1)],["d",new mi(new si)]])}),this.resolution=new rt,this._granularity=0,this.granularity=n}get granularity(){return this._granularity}set granularity(n){let e=Math.floor(n);e%2>0&&(e+=1),this._granularity=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(n){this.granularity=n}setSize(n,e){const t=this.resolution;t.set(n,e);const i=this.granularity,r=i/t.x,s=i/t.y;this.uniforms.get("d").value.set(r,s,1/r,1/s)}};function nN(n,e,t){return n*(e-t)-e}function iN(n,e,t){return Math.min(Math.max((n+e)/(e-t),0),1)}var aje=`#include <common>
#include <packing>
uniform vec2 cameraNearFar;
#define cameraNear cameraNearFar.x
#define cameraFar cameraNearFar.y
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){float depth=texture2D(normalDepthBuffer,uv).a;
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,normalDepth.a*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);normalDepth.a=a+b/d;
#endif
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,oje="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",lje=class extends Ds{constructor(n){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new mi(null),normalBuffer:new mi(null),normalDepthBuffer:new mi(null),noiseTexture:new mi(null),inverseProjectionMatrix:new mi(new Mn),projectionMatrix:new mi(new Mn),texelSize:new mi(new rt),cameraNearFar:new mi(new rt),distanceCutoff:new mi(new rt),proximityCutoff:new mi(new rt),noiseScale:new mi(new rt),minRadiusScale:new mi(.33),intensity:new mi(1),fade:new mi(.01),bias:new mi(0)},blending:Oa,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:aje,vertexShader:oje}),this.copyCameraSettings(n),this.resolution=new rt,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(n){this.uniforms.normalDepthBuffer.value=n,n!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(n){this.normalDepthBuffer=n}set normalBuffer(n){this.uniforms.normalBuffer.value=n}setNormalBuffer(n){this.uniforms.normalBuffer.value=n}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=sp){this.depthBuffer=n,this.depthPacking=e}set noiseTexture(n){this.uniforms.noiseTexture.value=n}setNoiseTexture(n){this.uniforms.noiseTexture.value=n}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(n){this.defines.SAMPLES_INT=n.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/n).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(n){this.samples=n}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(n){this.defines.SPIRAL_TURNS=n.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(n){this.rings=n}get intensity(){return this.uniforms.intensity.value}set intensity(n){this.uniforms.intensity.value=n,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(n){this.uniforms.intensity.value=n}get fade(){return this.uniforms.fade.value}set fade(n){this.uniforms.fade.value=n}getFade(){return this.uniforms.fade.value}setFade(n){this.uniforms.fade.value=n}get bias(){return this.uniforms.bias.value}set bias(n){this.uniforms.bias.value=n}getBias(){return this.uniforms.bias.value}setBias(n){this.uniforms.bias.value=n}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(n){this.uniforms.minRadiusScale.value=n}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(n){this.uniforms.minRadiusScale.value=n}updateRadius(){const n=this.r*this.resolution.height;this.defines.RADIUS=n.toFixed(11),this.defines.RADIUS_SQ=(n*n).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(n){this.r=Math.min(Math.max(n,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(n){this.radius=n}get distanceScaling(){return!0}set distanceScaling(n){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(n){this.distanceScaling=n}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(n){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-nN(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(n){this.distanceThreshold=iN(-n,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(n){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+n,0),1)}get worldDistanceFalloff(){return-nN(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(n){this.distanceFalloff=iN(-n,this.near,this.far)}setDistanceCutoff(n,e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(n){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-nN(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(n){this.proximityThreshold=iN(-n,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(n){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+n,0),1)}get worldProximityFalloff(){return-nN(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(n){this.proximityFalloff=iN(-n,this.near,this.far)}setProximityCutoff(n,e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),this.uniforms.projectionMatrix.value.copy(n.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(n.projectionMatrix).invert(),n instanceof ds?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms,i=t.noiseTexture.value;i!==null&&t.noiseScale.value.set(n/i.image.width,e/i.image.height),t.texelSize.value.set(1/n,1/e),this.resolution.set(n,e),this.updateRadius()}},uje=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,cje="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",hje=class extends Ds{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new mi(null),normalBuffer:new mi(null),texelSize:new mi(new rt)},blending:Oa,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:uje,vertexShader:cje})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=sp){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},aue=class extends Kd{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:t=r0.AUTO_SIZE,height:i=r0.AUTO_SIZE,resolutionX:r=t,resolutionY:s=i}={}){super("DepthDownsamplingPass");const a=new hje;a.normalBuffer=n,this.fullscreenMaterial=a,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Nr(1,1,{minFilter:xr,magFilter:xr,depthBuffer:!1,type:wr}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const o=this.resolution=new r0(this,r,s,e);o.addEventListener("change",l=>this.setSize(o.baseWidth,o.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=sp){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,t,i,r){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){const i=n.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},dje=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,dK=64,fje=class extends oE{constructor(n,e,{blendFunction:t=Wr.MULTIPLY,samples:i=9,rings:r=7,normalDepthBuffer:s=null,depthAwareUpsampling:a=!0,worldDistanceThreshold:o,worldDistanceFalloff:l,worldProximityThreshold:u,worldProximityFalloff:c,distanceThreshold:d=.97,distanceFalloff:f=.03,rangeThreshold:m=5e-4,rangeFalloff:y=.001,minRadiusScale:_=.1,luminanceInfluence:S=.7,radius:b=.1825,intensity:M=1,bias:w=.025,fade:T=.01,color:E=null,resolutionScale:R=1,width:P=r0.AUTO_SIZE,height:I=r0.AUTO_SIZE,resolutionX:B=P,resolutionY:N=I}={}){super("SSAOEffect",dje,{blendFunction:t,attributes:sv.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new mi(null)],["normalDepthBuffer",new mi(s)],["luminanceInfluence",new mi(S)],["color",new mi(null)],["intensity",new mi(M)],["scale",new mi(0)]])}),this.renderTarget=new Nr(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const U=this.resolution=new r0(this,B,N,R);U.addEventListener("change",K=>this.setSize(U.baseWidth,U.baseHeight)),this.camera=n,this.depthDownsamplingPass=new aue({normalBuffer:e,resolutionScale:R}),this.depthDownsamplingPass.enabled=s===null,this.ssaoPass=new tje(new lje(n));const V=new ije(dK,dK,Vr);V.wrapS=V.wrapT=Xc;const W=this.ssaoMaterial;W.normalBuffer=e,W.noiseTexture=V,W.minRadiusScale=_,W.samples=i,W.radius=b,W.rings=r,W.fade=T,W.bias=w,W.distanceThreshold=d,W.distanceFalloff=f,W.proximityThreshold=m,W.proximityFalloff=y,o!==void 0&&(W.worldDistanceThreshold=o),l!==void 0&&(W.worldDistanceFalloff=l),u!==void 0&&(W.worldProximityThreshold=u),c!==void 0&&(W.worldProximityFalloff=c),s!==null&&(this.ssaoMaterial.normalDepthBuffer=s,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=a,this.color=E}set mainCamera(n){this.camera=n,this.ssaoMaterial.copyCameraSettings(n)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(n){this.ssaoMaterial.normalBuffer=n,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=n}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(n){this.ssaoMaterial.samples=n}get rings(){return this.ssaoMaterial.rings}set rings(n){this.ssaoMaterial.rings=n}get radius(){return this.ssaoMaterial.radius}set radius(n){this.ssaoMaterial.radius=n}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(n){this.depthAwareUpsampling!==n&&(n?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(n){this.depthAwareUpsampling=n}get distanceScaling(){return!0}set distanceScaling(n){}get color(){return this.uniforms.get("color").value}set color(n){const e=this.uniforms,t=this.defines;n!==null?t.has("COLORIZE")?e.get("color").value.set(n):(t.set("COLORIZE","1"),e.get("color").value=new en(n),this.setChanged()):t.has("COLORIZE")&&(t.delete("COLORIZE"),e.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(n){this.uniforms.get("luminanceInfluence").value=n}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getColor(){return this.color}setColor(n){this.color=n}setDistanceCutoff(n,e){this.ssaoMaterial.distanceThreshold=n,this.ssaoMaterial.distanceFalloff=e}setProximityCutoff(n,e){this.ssaoMaterial.proximityThreshold=n,this.ssaoMaterial.proximityFalloff=e}setDepthTexture(n,e=sp){this.depthDownsamplingPass.setDepthTexture(n,e),this.ssaoMaterial.depthBuffer=n,this.ssaoMaterial.depthPacking=e}update(n,e,t){const i=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(n),this.ssaoPass.render(n,null,i)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,r=t.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(i,r),this.renderTarget.setSize(i,r),this.depthDownsamplingPass.resolution.scale=t.scale,this.depthDownsamplingPass.setSize(n,e)}initialize(n,e,t){try{let i=this.uniforms.get("normalDepthBuffer").value;i===null&&(this.depthDownsamplingPass.initialize(n,e,t),i=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=i,this.ssaoMaterial.normalDepthBuffer=i,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},pje=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,mje="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",gje=class extends Ds{constructor(n,e,t,i,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Xd.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new mi(null),depthBuffer:new mi(null),resolution:new mi(new rt),texelSize:new mi(new rt),cameraNear:new mi(.3),cameraFar:new mi(1e3),aspect:new mi(1),time:new mi(0)},blending:Oa,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(i)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=sp){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=pje.replace(cs.FRAGMENT_HEAD,n.get(cs.FRAGMENT_HEAD)||"").replace(cs.FRAGMENT_MAIN_UV,n.get(cs.FRAGMENT_MAIN_UV)||"").replace(cs.FRAGMENT_MAIN_IMAGE,n.get(cs.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=mje.replace(cs.VERTEX_HEAD,n.get(cs.VERTEX_HEAD)||"").replace(cs.VERTEX_MAIN_SUPPORT,n.get(cs.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof ds?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return cs}};function fK(n,e,t){for(const i of e){const r="$1"+n+i.charAt(0).toUpperCase()+i.slice(1),s=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const a of t.entries())a[1]!==null&&t.set(a[0],a[1].replace(s,r))}}function yje(n,e,t){let i=e.getFragmentShader(),r=e.getVertexShader();const s=i!==void 0&&/mainImage/.test(i),a=i!==void 0&&/mainUv/.test(i);if(t.attributes|=e.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(a&&(t.attributes&sv.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!a)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const o=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=t.shaderParts;let u=l.get(cs.FRAGMENT_HEAD)||"",c=l.get(cs.FRAGMENT_MAIN_UV)||"",d=l.get(cs.FRAGMENT_MAIN_IMAGE)||"",f=l.get(cs.VERTEX_HEAD)||"",m=l.get(cs.VERTEX_MAIN_SUPPORT)||"";const y=new Set,_=new Set;if(a&&(c+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),r!==null&&/mainSupport/.test(r)){const M=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);m+=`	${n}MainSupport(`,m+=M?`vUv);
`:`);
`;for(const w of r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const T of w[1].split(/\s*,\s*/))t.varyings.add(T),y.add(T),_.add(T);for(const w of r.matchAll(o))_.add(w[1])}for(const M of i.matchAll(o))_.add(M[1]);for(const M of e.defines.keys())_.add(M.replace(/\([\w\s,]*\)/g,""));for(const M of e.uniforms.keys())_.add(M);_.delete("while"),_.delete("for"),_.delete("if"),e.uniforms.forEach((M,w)=>t.uniforms.set(n+w.charAt(0).toUpperCase()+w.slice(1),M)),e.defines.forEach((M,w)=>t.defines.set(n+w.charAt(0).toUpperCase()+w.slice(1),M));const S=new Map([["fragment",i],["vertex",r]]);fK(n,_,t.defines),fK(n,_,S),i=S.get("fragment"),r=S.get("vertex");const b=e.blendMode;if(t.blendModes.set(b.blendFunction,b),s){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(d+=e.inputColorSpace===Ps?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==xl?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const M=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${n}MainImage(color0, UV, `,(t.attributes&sv.DEPTH)!==0&&M.test(i)&&(d+="depth, ",t.readDepth=!0),d+=`color1);
	`;const w=n+"BlendOpacity";t.uniforms.set(w,b.opacity),d+=`color0 = blend${b.blendFunction}(color0, color1, ${w});

	`,u+=`uniform float ${w};

`}if(u+=i+`
`,r!==null&&(f+=r+`
`),l.set(cs.FRAGMENT_HEAD,u),l.set(cs.FRAGMENT_MAIN_UV,c),l.set(cs.FRAGMENT_MAIN_IMAGE,d),l.set(cs.VERTEX_HEAD,f),l.set(cs.VERTEX_MAIN_SUPPORT,m),e.extensions!==null)for(const M of e.extensions)t.extensions.add(M)}}var vje=class extends Kd{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new gje(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new bZe;let e=0;for(const a of this.effects)if(a.blendMode.blendFunction===Wr.DST)n.attributes|=a.getAttributes()&sv.DEPTH;else{if((n.attributes&a.getAttributes()&sv.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${a.name})`);yje("e"+e++,a,n)}let t=n.shaderParts.get(cs.FRAGMENT_HEAD),i=n.shaderParts.get(cs.FRAGMENT_MAIN_IMAGE),r=n.shaderParts.get(cs.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const a of n.blendModes.values())t+=a.getShaderCode().replace(s,`blend${a.blendFunction}`)+`
`;(n.attributes&sv.DEPTH)!==0?(n.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Ps&&(i+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(r=`vec2 transformedUv = vUv;
`+r,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(cs.FRAGMENT_HEAD,t),n.shaderParts.set(cs.FRAGMENT_MAIN_IMAGE,i),n.shaderParts.set(cs.FRAGMENT_MAIN_UV,r);for(const[a,o]of n.shaderParts)o!==null&&n.shaderParts.set(a,o.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=sp){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,i,r){for(const s of this.effects)s.update(n,e,i);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=i*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const i of this.effects)i.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==br&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){n.type==="change"&&this.recompile()}},xje=class extends Kd{constructor(n,e,{renderTarget:t,resolutionScale:i=1,width:r=r0.AUTO_SIZE,height:s=r0.AUTO_SIZE,resolutionX:a=r,resolutionY:o=s}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new sue(n,e,new ER);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const u=l.getClearPass();u.overrideClearColor=new en(7829503),u.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Nr(1,1,{minFilter:xr,magFilter:xr}),this.renderTarget.texture.name="NormalPass.Target");const c=this.resolution=new r0(this,a,o,i);c.addEventListener("change",d=>this.setSize(c.baseWidth,c.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,i,r){const s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,s,s)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}};function Mw(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}new rt;new rt;function oue(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var ud=function n(e,t,i){var r=this;oue(this,n),Mw(this,"dot2",function(s,a){return r.x*s+r.y*a}),Mw(this,"dot3",function(s,a,o){return r.x*s+r.y*a+r.z*o}),this.x=e,this.y=t,this.z=i},bje=[new ud(1,1,0),new ud(-1,1,0),new ud(1,-1,0),new ud(-1,-1,0),new ud(1,0,1),new ud(-1,0,1),new ud(1,0,-1),new ud(-1,0,-1),new ud(0,1,1),new ud(0,-1,1),new ud(0,1,-1),new ud(0,-1,-1)],pK=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],mK=new Array(512),gK=new Array(512),_je=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var t=0;t<256;t++){var i;t&1?i=pK[t]^e&255:i=pK[t]^e>>8&255,mK[t]=mK[t+256]=i,gK[t]=gK[t+256]=bje[i%12]}};_je(0);function Sje(n){if(typeof n=="number")n=Math.abs(n);else if(typeof n=="string"){var e=n;n=0;for(var t=0;t<e.length;t++)n=(n+(t+1)*(e.charCodeAt(t)%96))%2147483647}return n===0&&(n=311),n}function yK(n){var e=Sje(n);return function(){var t=e*48271%2147483647;return e=t,t/2147483647}}var Mje=function n(e){var t=this;oue(this,n),Mw(this,"seed",0),Mw(this,"init",function(i){t.seed=i,t.value=yK(i)}),Mw(this,"value",yK(this.seed)),this.init(e)};new Mje(Math.random());const lue=G.createContext(null),vK=n=>(n.getAttributes()&2)===2,uue=G.memo(G.forwardRef(({children:n,camera:e,scene:t,resolutionScale:i,enabled:r=!0,renderPriority:s=1,autoClear:a=!0,depthBuffer:o,enableNormalPass:l,stencilBuffer:u,multisampling:c=8,frameBufferType:d=zi},f)=>{const{gl:m,scene:y,camera:_,size:S}=ir(),b=t||y,M=e||_,[w,T,E]=G.useMemo(()=>{const I=new xZe(m,{depthBuffer:o,stencilBuffer:u,multisampling:c,frameBufferType:d});I.addPass(new sue(b,M));let B=null,N=null;return l&&(N=new xje(b,M),N.enabled=!1,I.addPass(N),i!==void 0&&(B=new aue({normalBuffer:N.texture,resolutionScale:i}),B.enabled=!1,I.addPass(B))),[I,N,B]},[M,m,o,u,c,d,b,l,i]);G.useEffect(()=>w?.setSize(S.width,S.height),[w,S]),rs((I,B)=>{if(r){const N=m.autoClear;m.autoClear=a,u&&!a&&m.clearStencil(),w.render(B),m.autoClear=N}},r?s:0);const R=G.useRef(null);G.useLayoutEffect(()=>{const I=[],B=R.current.__r3f;if(B&&w){const N=B.children;for(let U=0;U<N.length;U++){const V=N[U].object;if(V instanceof oE){const W=[V];if(!vK(V)){let q=null;for(;(q=N[U+1]?.object)instanceof oE&&!vK(q);)W.push(q),U++}const K=new vje(M,...W);I.push(K)}else V instanceof Kd&&I.push(V)}for(const U of I)w?.addPass(U);T&&(T.enabled=!0),E&&(E.enabled=!0)}return()=>{for(const N of I)w?.removePass(N);T&&(T.enabled=!1),E&&(E.enabled=!1)}},[w,n,M,T,E]),G.useEffect(()=>{const I=m.toneMapping;return m.toneMapping=ho,()=>{m.toneMapping=I}},[m]);const P=G.useMemo(()=>({composer:w,normalPass:T,downSamplingPass:E,resolutionScale:i,camera:M,scene:b}),[w,T,E,i,M,b]);return G.useImperativeHandle(f,()=>w,[w]),$.jsx(lue.Provider,{value:P,children:$.jsx("group",{ref:R,children:n})})})),cue=G.forwardRef(function({granularity:n=5},e){const t=G.useMemo(()=>new sje(n),[n]);return $.jsx("primitive",{ref:e,object:t,dispose:null})}),Aje=G.forwardRef(function(n,e){const{camera:t,normalPass:i,downSamplingPass:r,resolutionScale:s}=G.useContext(lue),a=G.useMemo(()=>i===null&&r===null?(console.error("Please enable the NormalPass in the EffectComposer in order to use SSAO."),{}):new fje(t,i&&!r?i.texture:null,{blendFunction:21,samples:30,rings:4,distanceThreshold:1,distanceFalloff:0,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.9,radius:20,bias:.5,intensity:1,color:void 0,normalDepthBuffer:r?r.texture:null,resolutionScale:s??1,depthAwareUpsampling:!0,...n}),[t,r,i,s]);return $.jsx("primitive",{ref:e,object:a,dispose:null})});var OH=$R(),qi=n=>KR(n,OH),UH=$R();qi.write=n=>KR(n,UH);var yL=$R();qi.onStart=n=>KR(n,yL);var kH=$R();qi.onFrame=n=>KR(n,kH);var zH=$R();qi.onFinish=n=>KR(n,zH);var aM=[];qi.setTimeout=(n,e)=>{const t=qi.now()+e,i=()=>{const s=aM.findIndex(a=>a.cancel==i);~s&&aM.splice(s,1),$y-=~s?1:0},r={time:t,handler:n,cancel:i};return aM.splice(hue(t),0,r),$y+=1,due(),r};var hue=n=>~(~aM.findIndex(e=>e.time>n)||~aM.length);qi.cancel=n=>{yL.delete(n),kH.delete(n),zH.delete(n),OH.delete(n),UH.delete(n)};qi.sync=n=>{Gk=!0,qi.batchedUpdates(n),Gk=!1};qi.throttle=n=>{let e;function t(){try{n(...e)}finally{e=null}}function i(...r){e=r,qi.onStart(t)}return i.handler=n,i.cancel=()=>{yL.delete(t),e=null},i};var VH=typeof window<"u"?window.requestAnimationFrame:(()=>{});qi.use=n=>VH=n;qi.now=typeof performance<"u"?()=>performance.now():Date.now;qi.batchedUpdates=n=>n();qi.catch=console.error;qi.frameLoop="always";qi.advance=()=>{qi.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):pue()};var Ky=-1,$y=0,Gk=!1;function KR(n,e){Gk?(e.delete(n),n(0)):(e.add(n),due())}function due(){Ky<0&&(Ky=0,qi.frameLoop!=="demand"&&VH(fue))}function Tje(){Ky=-1}function fue(){~Ky&&(VH(fue),qi.batchedUpdates(pue))}function pue(){const n=Ky;Ky=qi.now();const e=hue(Ky);if(e&&(mue(aM.splice(0,e),t=>t.handler()),$y-=e),!$y){Tje();return}yL.flush(),OH.flush(n?Math.min(64,Ky-n):16.667),kH.flush(),UH.flush(),zH.flush()}function $R(){let n=new Set,e=n;return{add(t){$y+=e==n&&!n.has(t)?1:0,n.add(t)},delete(t){return $y-=e==n&&n.has(t)?1:0,n.delete(t)},flush(t){e.size&&(n=new Set,$y-=e.size,mue(e,i=>i(t)&&n.add(i)),$y+=n.size,e=n)}}}function mue(n,e){n.forEach(t=>{try{e(t)}catch(i){qi.catch(i)}})}var Cje=Object.defineProperty,wje=(n,e)=>{for(var t in e)Cje(n,t,{get:e[t],enumerable:!0})},kd={};wje(kd,{assign:()=>Rje,colors:()=>av,createStringInterpolator:()=>XH,skipAnimation:()=>yue,to:()=>gue,willAdvance:()=>WH});function Ok(){}var Eje=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0}),_n={arr:Array.isArray,obj:n=>!!n&&n.constructor.name==="Object",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",und:n=>n===void 0};function Ig(n,e){if(_n.arr(n)){if(!_n.arr(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}return n===e}var Yi=(n,e)=>n.forEach(e);function Em(n,e,t){if(_n.arr(n)){for(let i=0;i<n.length;i++)e.call(t,n[i],`${i}`);return}for(const i in n)n.hasOwnProperty(i)&&e.call(t,n[i],i)}var tc=n=>_n.und(n)?[]:_n.arr(n)?n:[n];function Aw(n,e){if(n.size){const t=Array.from(n);n.clear(),Yi(t,e)}}var tw=(n,...e)=>Aw(n,t=>t(...e)),HH=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),XH,gue,av=null,yue=!1,WH=Ok,Rje=n=>{n.to&&(gue=n.to),n.now&&(qi.now=n.now),n.colors!==void 0&&(av=n.colors),n.skipAnimation!=null&&(yue=n.skipAnimation),n.createStringInterpolator&&(XH=n.createStringInterpolator),n.requestAnimationFrame&&qi.use(n.requestAnimationFrame),n.batchedUpdates&&(qi.batchedUpdates=n.batchedUpdates),n.willAdvance&&(WH=n.willAdvance),n.frameLoop&&(qi.frameLoop=n.frameLoop)},Tw=new Set,_d=[],vU=[],t2=0,vL={get idle(){return!Tw.size&&!_d.length},start(n){t2>n.priority?(Tw.add(n),qi.onStart(Pje)):(vue(n),qi(Uk))},advance:Uk,sort(n){if(t2)qi.onFrame(()=>vL.sort(n));else{const e=_d.indexOf(n);~e&&(_d.splice(e,1),xue(n))}},clear(){_d=[],Tw.clear()}};function Pje(){Tw.forEach(vue),Tw.clear(),qi(Uk)}function vue(n){_d.includes(n)||xue(n)}function xue(n){_d.splice(Dje(_d,e=>e.priority>n.priority),0,n)}function Uk(n){const e=vU;for(let t=0;t<_d.length;t++){const i=_d[t];t2=i.priority,i.idle||(WH(i),i.advance(n),i.idle||e.push(i))}return t2=0,vU=_d,vU.length=0,_d=e,_d.length>0}function Dje(n,e){const t=n.findIndex(e);return t<0?n.length:t}var bue={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},kf="[-+]?\\d*\\.?\\d+",n2=kf+"%";function xL(...n){return"\\(\\s*("+n.join(")\\s*,\\s*(")+")\\s*\\)"}var Nje=new RegExp("rgb"+xL(kf,kf,kf)),Bje=new RegExp("rgba"+xL(kf,kf,kf,kf)),Fje=new RegExp("hsl"+xL(kf,n2,n2)),Lje=new RegExp("hsla"+xL(kf,n2,n2,kf)),Ije=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Gje=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Oje=/^#([0-9a-fA-F]{6})$/,Uje=/^#([0-9a-fA-F]{8})$/;function kje(n){let e;return typeof n=="number"?n>>>0===n&&n>=0&&n<=4294967295?n:null:(e=Oje.exec(n))?parseInt(e[1]+"ff",16)>>>0:av&&av[n]!==void 0?av[n]:(e=Nje.exec(n))?(_S(e[1])<<24|_S(e[2])<<16|_S(e[3])<<8|255)>>>0:(e=Bje.exec(n))?(_S(e[1])<<24|_S(e[2])<<16|_S(e[3])<<8|_K(e[4]))>>>0:(e=Ije.exec(n))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=Uje.exec(n))?parseInt(e[1],16)>>>0:(e=Gje.exec(n))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=Fje.exec(n))?(xK(bK(e[1]),rN(e[2]),rN(e[3]))|255)>>>0:(e=Lje.exec(n))?(xK(bK(e[1]),rN(e[2]),rN(e[3]))|_K(e[4]))>>>0:null}function xU(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function xK(n,e,t){const i=t<.5?t*(1+e):t+e-t*e,r=2*t-i,s=xU(r,i,n+1/3),a=xU(r,i,n),o=xU(r,i,n-1/3);return Math.round(s*255)<<24|Math.round(a*255)<<16|Math.round(o*255)<<8}function _S(n){const e=parseInt(n,10);return e<0?0:e>255?255:e}function bK(n){return(parseFloat(n)%360+360)%360/360}function _K(n){const e=parseFloat(n);return e<0?0:e>1?255:Math.round(e*255)}function rN(n){const e=parseFloat(n);return e<0?0:e>100?1:e/100}function SK(n){let e=kje(n);if(e===null)return n;e=e||0;const t=(e&4278190080)>>>24,i=(e&16711680)>>>16,r=(e&65280)>>>8,s=(e&255)/255;return`rgba(${t}, ${i}, ${r}, ${s})`}var lE=(n,e,t)=>{if(_n.fun(n))return n;if(_n.arr(n))return lE({range:n,output:e,extrapolate:t});if(_n.str(n.output[0]))return XH(n);const i=n,r=i.output,s=i.range||[0,1],a=i.extrapolateLeft||i.extrapolate||"extend",o=i.extrapolateRight||i.extrapolate||"extend",l=i.easing||(u=>u);return u=>{const c=Vje(u,s);return zje(u,s[c],s[c+1],r[c],r[c+1],l,a,o,i.map)}};function zje(n,e,t,i,r,s,a,o,l){let u=l?l(n):n;if(u<e){if(a==="identity")return u;a==="clamp"&&(u=e)}if(u>t){if(o==="identity")return u;o==="clamp"&&(u=t)}return i===r?i:e===t?n<=e?i:r:(e===-1/0?u=-u:t===1/0?u=u-e:u=(u-e)/(t-e),u=s(u),i===-1/0?u=-u:r===1/0?u=u+i:u=u*(r-i)+i,u)}function Vje(n,e){for(var t=1;t<e.length-1&&!(e[t]>=n);++t);return t-1}var Hje={linear:n=>n},uE=Symbol.for("FluidValue.get"),wM=Symbol.for("FluidValue.observers"),yd=n=>!!(n&&n[uE]),Gc=n=>n&&n[uE]?n[uE]():n,MK=n=>n[wM]||null;function Xje(n,e){n.eventObserved?n.eventObserved(e):n(e)}function cE(n,e){const t=n[wM];t&&t.forEach(i=>{Xje(i,e)})}var _ue=class{constructor(n){if(!n&&!(n=this.get))throw Error("Unknown getter");Wje(this,n)}},Wje=(n,e)=>Sue(n,uE,e);function gA(n,e){if(n[uE]){let t=n[wM];t||Sue(n,wM,t=new Set),t.has(e)||(t.add(e),n.observerAdded&&n.observerAdded(t.size,e))}return e}function hE(n,e){const t=n[wM];if(t&&t.has(e)){const i=t.size-1;i?t.delete(e):n[wM]=null,n.observerRemoved&&n.observerRemoved(i,e)}}var Sue=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0}),qN=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Zje=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,AK=new RegExp(`(${qN.source})(%|[a-z]+)`,"i"),jje=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,bL=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,Mue=n=>{const[e,t]=Yje(n);if(!e||HH())return n;const i=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(i)return i.trim();if(t&&t.startsWith("--")){const r=window.getComputedStyle(document.documentElement).getPropertyValue(t);return r||n}else{if(t&&bL.test(t))return Mue(t);if(t)return t}return n},Yje=n=>{const e=bL.exec(n);if(!e)return[,];const[,t,i]=e;return[t,i]},bU,Kje=(n,e,t,i,r)=>`rgba(${Math.round(e)}, ${Math.round(t)}, ${Math.round(i)}, ${r})`,ZH=n=>{bU||(bU=av?new RegExp(`(${Object.keys(av).join("|")})(?!\\w)`,"g"):/^\b$/);const e=n.output.map(s=>Gc(s).replace(bL,Mue).replace(Zje,SK).replace(bU,SK)),t=e.map(s=>s.match(qN).map(Number)),r=t[0].map((s,a)=>t.map(o=>{if(!(a in o))throw Error('The arity of each "output" value must be equal');return o[a]})).map(s=>lE({...n,output:s}));return s=>{const a=!AK.test(e[0])&&e.find(l=>AK.test(l))?.replace(qN,"");let o=0;return e[0].replace(qN,()=>`${r[o++](s)}${a||""}`).replace(jje,Kje)}},jH="react-spring: ",Aue=n=>{const e=n;let t=!1;if(typeof e!="function")throw new TypeError(`${jH}once requires a function parameter`);return(...i)=>{t||(e(...i),t=!0)}},$je=Aue(console.warn);function Jje(){$je(`${jH}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var qje=Aue(console.warn);function Qje(){qje(`${jH}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function _L(n){return _n.str(n)&&(n[0]=="#"||/\d/.test(n)||!HH()&&bL.test(n)||n in(av||{}))}var Px=HH()?G.useEffect:G.useLayoutEffect,eYe=()=>{const n=G.useRef(!1);return Px(()=>(n.current=!0,()=>{n.current=!1}),[]),n};function YH(){const n=G.useState()[1],e=eYe();return()=>{e.current&&n(Math.random())}}var KH=n=>G.useEffect(n,tYe),tYe=[];function kk(n){const e=G.useRef(void 0);return G.useEffect(()=>{e.current=n}),e.current}var dE=Symbol.for("Animated:node"),nYe=n=>!!n&&n[dE]===n,qp=n=>n&&n[dE],$H=(n,e)=>Eje(n,dE,e),SL=n=>n&&n[dE]&&n[dE].getPayload(),Tue=class{constructor(){$H(this,this)}getPayload(){return this.payload||[]}},ML=class Cue extends Tue{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,_n.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new Cue(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return _n.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value===e?!1:(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,_n.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},i2=class wue extends ML{constructor(e){super(0),this._string=null,this._toString=lE({output:[e,e]})}static create(e){return new wue(e)}getValue(){const e=this._string;return e??(this._string=this._toString(this._value))}setValue(e){if(_n.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else if(super.setValue(e))this._string=null;else return!1;return!0}reset(e){e&&(this._toString=lE({output:[this.getValue(),e]})),this._value=0,super.reset()}},r2={dependencies:null},AL=class extends Tue{constructor(n){super(),this.source=n,this.setValue(n)}getValue(n){const e={};return Em(this.source,(t,i)=>{nYe(t)?e[i]=t.getValue(n):yd(t)?e[i]=Gc(t):n||(e[i]=t)}),e}setValue(n){this.source=n,this.payload=this._makePayload(n)}reset(){this.payload&&Yi(this.payload,n=>n.reset())}_makePayload(n){if(n){const e=new Set;return Em(n,this._addToPayload,e),Array.from(e)}}_addToPayload(n){r2.dependencies&&yd(n)&&r2.dependencies.add(n);const e=SL(n);e&&Yi(e,t=>this.add(t))}},iYe=class Eue extends AL{constructor(e){super(e)}static create(e){return new Eue(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const t=this.getPayload();return e.length==t.length?t.map((i,r)=>i.setValue(e[r])).some(Boolean):(super.setValue(e.map(rYe)),!0)}};function rYe(n){return(_L(n)?i2:ML).create(n)}function zk(n){const e=qp(n);return e?e.constructor:_n.arr(n)?iYe:_L(n)?i2:ML}var TK=(n,e)=>{const t=!_n.fun(n)||n.prototype&&n.prototype.isReactComponent;return G.forwardRef((i,r)=>{const s=G.useRef(null),a=t&&G.useCallback(y=>{s.current=oYe(r,y)},[r]),[o,l]=aYe(i,e),u=YH(),c=()=>{const y=s.current;if(t&&!y)return;(y?e.applyAnimatedValues(y,o.getValue(!0)):!1)===!1&&u()},d=new sYe(c,l),f=G.useRef(void 0);Px(()=>(f.current=d,Yi(l,y=>gA(y,d)),()=>{f.current&&(Yi(f.current.deps,y=>hE(y,f.current)),qi.cancel(f.current.update))})),G.useEffect(c,[]),KH(()=>()=>{const y=f.current;Yi(y.deps,_=>hE(_,y))});const m=e.getComponentProps(o.getValue());return G.createElement(n,{...m,ref:a})})},sYe=class{constructor(n,e){this.update=n,this.deps=e}eventObserved(n){n.type=="change"&&qi.write(this.update)}};function aYe(n,e){const t=new Set;return r2.dependencies=t,n.style&&(n={...n,style:e.createAnimatedStyle(n.style)}),n=new AL(n),r2.dependencies=null,[n,t]}function oYe(n,e){return n&&(_n.fun(n)?n(e):n.current=e),e}var CK=Symbol.for("AnimatedComponent"),Rue=(n,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:t=r=>new AL(r),getComponentProps:i=r=>r}={})=>{const r={applyAnimatedValues:e,createAnimatedStyle:t,getComponentProps:i},s=a=>{const o=wK(a)||"Anonymous";return _n.str(a)?a=s[a]||(s[a]=TK(a,r)):a=a[CK]||(a[CK]=TK(a,r)),a.displayName=`Animated(${o})`,a};return Em(n,(a,o)=>{_n.arr(n)&&(o=wK(a)),s[o]=s(a)}),{animated:s}},wK=n=>_n.str(n)?n:n&&_n.str(n.displayName)?n.displayName:_n.fun(n)&&n.name||null;function Oc(n,...e){return _n.fun(n)?n(...e):n}var Cw=(n,e)=>n===!0||!!(e&&n&&(_n.fun(n)?n(e):tc(n).includes(e))),Pue=(n,e)=>_n.obj(n)?e&&n[e]:n,Due=(n,e)=>n.default===!0?n[e]:n.default?n.default[e]:void 0,lYe=n=>n,TL=(n,e=lYe)=>{let t=uYe;n.default&&n.default!==!0&&(n=n.default,t=Object.keys(n));const i={};for(const r of t){const s=e(n[r],r);_n.und(s)||(i[r]=s)}return i},uYe=["config","onProps","onStart","onChange","onPause","onResume","onRest"],cYe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function hYe(n){const e={};let t=0;if(Em(n,(i,r)=>{cYe[r]||(e[r]=i,t++)}),t)return e}function JH(n){const e=hYe(n);if(e){const t={to:e};return Em(n,(i,r)=>r in e||(t[r]=i)),t}return{...n}}function fE(n){return n=Gc(n),_n.arr(n)?n.map(fE):_L(n)?kd.createStringInterpolator({range:[0,1],output:[n,n]})(1):n}function Nue(n){for(const e in n)return!0;return!1}function Vk(n){return _n.fun(n)||_n.arr(n)&&_n.obj(n[0])}function Hk(n,e){n.ref?.delete(n),e?.delete(n)}function Bue(n,e){e&&n.ref!==e&&(n.ref?.delete(n),e.add(n),n.ref=e)}var dYe={default:{tension:170,friction:26}},Xk={...dYe.default,mass:1,damping:1,easing:Hje.linear,clamp:!1},fYe=class{constructor(){this.velocity=0,Object.assign(this,Xk)}};function pYe(n,e,t){t&&(t={...t},EK(t,e),e={...t,...e}),EK(n,e),Object.assign(n,e);for(const a in Xk)n[a]==null&&(n[a]=Xk[a]);let{frequency:i,damping:r}=n;const{mass:s}=n;return _n.und(i)||(i<.01&&(i=.01),r<0&&(r=0),n.tension=Math.pow(2*Math.PI/i,2)*s,n.friction=4*Math.PI*r*s/i),n}function EK(n,e){if(!_n.und(e.decay))n.duration=void 0;else{const t=!_n.und(e.tension)||!_n.und(e.friction);(t||!_n.und(e.frequency)||!_n.und(e.damping)||!_n.und(e.mass))&&(n.duration=void 0,n.decay=void 0),t&&(n.frequency=void 0)}}var RK=[],mYe=class{constructor(){this.changed=!1,this.values=RK,this.toValues=null,this.fromValues=RK,this.config=new fYe,this.immediate=!1}};function Fue(n,{key:e,props:t,defaultProps:i,state:r,actions:s}){return new Promise((a,o)=>{let l,u,c=Cw(t.cancel??i?.cancel,e);if(c)m();else{_n.und(t.pause)||(r.paused=Cw(t.pause,e));let y=i?.pause;y!==!0&&(y=r.paused||Cw(y,e)),l=Oc(t.delay||0,e),y?(r.resumeQueue.add(f),s.pause()):(s.resume(),f())}function d(){r.resumeQueue.add(f),r.timeouts.delete(u),u.cancel(),l=u.time-qi.now()}function f(){l>0&&!kd.skipAnimation?(r.delayed=!0,u=qi.setTimeout(m,l),r.pauseQueue.add(d),r.timeouts.add(u)):m()}function m(){r.delayed&&(r.delayed=!1),r.pauseQueue.delete(d),r.timeouts.delete(u),n<=(r.cancelId||0)&&(c=!0);try{s.start({...t,callId:n,cancel:c},a)}catch(y){o(y)}}})}var qH=(n,e)=>e.length==1?e[0]:e.some(t=>t.cancelled)?oM(n.get()):e.every(t=>t.noop)?Lue(n.get()):If(n.get(),e.every(t=>t.finished)),Lue=n=>({value:n,noop:!0,finished:!0,cancelled:!1}),If=(n,e,t=!1)=>({value:n,finished:e,cancelled:t}),oM=n=>({value:n,cancelled:!0,finished:!1});function Iue(n,e,t,i){const{callId:r,parentId:s,onRest:a}=e,{asyncTo:o,promise:l}=t;return!s&&n===o&&!e.reset?l:t.promise=(async()=>{t.asyncId=r,t.asyncTo=n;const u=TL(e,(S,b)=>b==="onRest"?void 0:S);let c,d;const f=new Promise((S,b)=>(c=S,d=b)),m=S=>{const b=r<=(t.cancelId||0)&&oM(i)||r!==t.asyncId&&If(i,!1);if(b)throw S.result=b,d(S),S},y=(S,b)=>{const M=new PK,w=new DK;return(async()=>{if(kd.skipAnimation)throw pE(t),w.result=If(i,!1),d(w),w;m(M);const T=_n.obj(S)?{...S}:{...b,to:S};T.parentId=r,Em(u,(R,P)=>{_n.und(T[P])&&(T[P]=R)});const E=await i.start(T);return m(M),t.paused&&await new Promise(R=>{t.resumeQueue.add(R)}),E})()};let _;if(kd.skipAnimation)return pE(t),If(i,!1);try{let S;_n.arr(n)?S=(async b=>{for(const M of b)await y(M)})(n):S=Promise.resolve(n(y,i.stop.bind(i))),await Promise.all([S.then(c),f]),_=If(i.get(),!0,!1)}catch(S){if(S instanceof PK)_=S.result;else if(S instanceof DK)_=S.result;else throw S}finally{r==t.asyncId&&(t.asyncId=s,t.asyncTo=s?o:void 0,t.promise=s?l:void 0)}return _n.fun(a)&&qi.batchedUpdates(()=>{a(_,i,i.item)}),_})()}function pE(n,e){Aw(n.timeouts,t=>t.cancel()),n.pauseQueue.clear(),n.resumeQueue.clear(),n.asyncId=n.asyncTo=n.promise=void 0,e&&(n.cancelId=e)}var PK=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},DK=class extends Error{constructor(){super("SkipAnimationSignal")}},Wk=n=>n instanceof QH,gYe=1,QH=class extends _ue{constructor(){super(...arguments),this.id=gYe++,this._priority=0}get priority(){return this._priority}set priority(n){this._priority!=n&&(this._priority=n,this._onPriorityChange(n))}get(){const n=qp(this);return n&&n.getValue()}to(...n){return kd.to(this,n)}interpolate(...n){return Jje(),kd.to(this,n)}toJSON(){return this.get()}observerAdded(n){n==1&&this._attach()}observerRemoved(n){n==0&&this._detach()}_attach(){}_detach(){}_onChange(n,e=!1){cE(this,{type:"change",parent:this,value:n,idle:e})}_onPriorityChange(n){this.idle||vL.sort(this),cE(this,{type:"priority",parent:this,priority:n})}},gb=Symbol.for("SpringPhase"),Gue=1,Zk=2,jk=4,_U=n=>(n[gb]&Gue)>0,wy=n=>(n[gb]&Zk)>0,PC=n=>(n[gb]&jk)>0,NK=(n,e)=>e?n[gb]|=Zk|Gue:n[gb]&=~Zk,BK=(n,e)=>e?n[gb]|=jk:n[gb]&=~jk,yYe=class extends QH{constructor(n,e){if(super(),this.animation=new mYe,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!_n.und(n)||!_n.und(e)){const t=_n.obj(n)?{...n}:{...e,from:n};_n.und(t.default)&&(t.default=!0),this.start(t)}}get idle(){return!(wy(this)||this._state.asyncTo)||PC(this)}get goal(){return Gc(this.animation.to)}get velocity(){const n=qp(this);return n instanceof ML?n.lastVelocity||0:n.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return _U(this)}get isAnimating(){return wy(this)}get isPaused(){return PC(this)}get isDelayed(){return this._state.delayed}advance(n){let e=!0,t=!1;const i=this.animation;let{toValues:r}=i;const{config:s}=i,a=SL(i.to);!a&&yd(i.to)&&(r=tc(Gc(i.to))),i.values.forEach((u,c)=>{if(u.done)return;const d=u.constructor==i2?1:a?a[c].lastPosition:r[c];let f=i.immediate,m=d;if(!f){if(m=u.lastPosition,s.tension<=0){u.done=!0;return}let y=u.elapsedTime+=n;const _=i.fromValues[c],S=u.v0!=null?u.v0:u.v0=_n.arr(s.velocity)?s.velocity[c]:s.velocity;let b;const M=s.precision||(_==d?.005:Math.min(1,Math.abs(d-_)*.001));if(_n.und(s.duration))if(s.decay){const w=s.decay===!0?.998:s.decay,T=Math.exp(-(1-w)*y);m=_+S/(1-w)*(1-T),f=Math.abs(u.lastPosition-m)<=M,b=S*T}else{b=u.lastVelocity==null?S:u.lastVelocity;const w=s.restVelocity||M/10,T=s.clamp?0:s.bounce,E=!_n.und(T),R=_==d?u.v0>0:_<d;let P,I=!1;const B=1,N=Math.ceil(n/B);for(let U=0;U<N&&(P=Math.abs(b)>w,!(!P&&(f=Math.abs(d-m)<=M,f)));++U){E&&(I=m==d||m>d==R,I&&(b=-b*T,m=d));const V=-s.tension*1e-6*(m-d),W=-s.friction*.001*b,K=(V+W)/s.mass;b=b+K*B,m=m+b*B}}else{let w=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,u.durationProgress>0&&(u.elapsedTime=s.duration*u.durationProgress,y=u.elapsedTime+=n)),w=(s.progress||0)+y/this._memoizedDuration,w=w>1?1:w<0?0:w,u.durationProgress=w),m=_+s.easing(w)*(d-_),b=(m-u.lastPosition)/n,f=w==1}u.lastVelocity=b,Number.isNaN(m)&&(console.warn("Got NaN while animating:",this),f=!0)}a&&!a[c].done&&(f=!1),f?u.done=!0:e=!1,u.setValue(m,s.round)&&(t=!0)});const o=qp(this),l=o.getValue();if(e){const u=Gc(i.to);(l!==u||t)&&!s.decay?(o.setValue(u),this._onChange(u)):t&&s.decay&&this._onChange(l),this._stop()}else t&&this._onChange(l)}set(n){return qi.batchedUpdates(()=>{this._stop(),this._focus(n),this._set(n)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(wy(this)){const{to:n,config:e}=this.animation;qi.batchedUpdates(()=>{this._onStart(),e.decay||this._set(n,!1),this._stop()})}return this}update(n){return(this.queue||(this.queue=[])).push(n),this}start(n,e){let t;return _n.und(n)?(t=this.queue||[],this.queue=[]):t=[_n.obj(n)?n:{...e,to:n}],Promise.all(t.map(i=>this._update(i))).then(i=>qH(this,i))}stop(n){const{to:e}=this.animation;return this._focus(this.get()),pE(this._state,n&&this._lastCallId),qi.batchedUpdates(()=>this._stop(e,n)),this}reset(){this._update({reset:!0})}eventObserved(n){n.type=="change"?this._start():n.type=="priority"&&(this.priority=n.priority+1)}_prepareNode(n){const e=this.key||"";let{to:t,from:i}=n;t=_n.obj(t)?t[e]:t,(t==null||Vk(t))&&(t=void 0),i=_n.obj(i)?i[e]:i,i==null&&(i=void 0);const r={to:t,from:i};return _U(this)||(n.reverse&&([t,i]=[i,t]),i=Gc(i),_n.und(i)?qp(this)||this._set(t):this._set(i)),r}_update({...n},e){const{key:t,defaultProps:i}=this;n.default&&Object.assign(i,TL(n,(a,o)=>/^on/.test(o)?Pue(a,t):a)),LK(this,n,"onProps"),NC(this,"onProps",n,this);const r=this._prepareNode(n);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return Fue(++this._lastCallId,{key:t,props:n,defaultProps:i,state:s,actions:{pause:()=>{PC(this)||(BK(this,!0),tw(s.pauseQueue),NC(this,"onPause",If(this,DC(this,this.animation.to)),this))},resume:()=>{PC(this)&&(BK(this,!1),wy(this)&&this._resume(),tw(s.resumeQueue),NC(this,"onResume",If(this,DC(this,this.animation.to)),this))},start:this._merge.bind(this,r)}}).then(a=>{if(n.loop&&a.finished&&!(e&&a.noop)){const o=Oue(n);if(o)return this._update(o,!0)}return a})}_merge(n,e,t){if(e.cancel)return this.stop(!0),t(oM(this));const i=!_n.und(n.to),r=!_n.und(n.from);if(i||r)if(e.callId>this._lastToId)this._lastToId=e.callId;else return t(oM(this));const{key:s,defaultProps:a,animation:o}=this,{to:l,from:u}=o;let{to:c=l,from:d=u}=n;r&&!i&&(!e.default||_n.und(c))&&(c=d),e.reverse&&([c,d]=[d,c]);const f=!Ig(d,u);f&&(o.from=d),d=Gc(d);const m=!Ig(c,l);m&&this._focus(c);const y=Vk(e.to),{config:_}=o,{decay:S,velocity:b}=_;(i||r)&&(_.velocity=0),e.config&&!y&&pYe(_,Oc(e.config,s),e.config!==a.config?Oc(a.config,s):void 0);let M=qp(this);if(!M||_n.und(c))return t(If(this,!0));const w=_n.und(e.reset)?r&&!e.default:!_n.und(d)&&Cw(e.reset,s),T=w?d:this.get(),E=fE(c),R=_n.num(E)||_n.arr(E)||_L(E),P=!y&&(!R||Cw(a.immediate||e.immediate,s));if(m){const U=zk(c);if(U!==M.constructor)if(P)M=this._set(E);else throw Error(`Cannot animate between ${M.constructor.name} and ${U.name}, as the "to" prop suggests`)}const I=M.constructor;let B=yd(c),N=!1;if(!B){const U=w||!_U(this)&&f;(m||U)&&(N=Ig(fE(T),E),B=!N),(!Ig(o.immediate,P)&&!P||!Ig(_.decay,S)||!Ig(_.velocity,b))&&(B=!0)}if(N&&wy(this)&&(o.changed&&!w?B=!0:B||this._stop(l)),!y&&((B||yd(l))&&(o.values=M.getPayload(),o.toValues=yd(c)?null:I==i2?[1]:tc(E)),o.immediate!=P&&(o.immediate=P,!P&&!w&&this._set(l)),B)){const{onRest:U}=o;Yi(xYe,W=>LK(this,e,W));const V=If(this,DC(this,l));tw(this._pendingCalls,V),this._pendingCalls.add(t),o.changed&&qi.batchedUpdates(()=>{o.changed=!w,U?.(V,this),w?Oc(a.onRest,V):o.onStart?.(V,this)})}w&&this._set(T),y?t(Iue(e.to,e,this._state,this)):B?this._start():wy(this)&&!m?this._pendingCalls.add(t):t(Lue(T))}_focus(n){const e=this.animation;n!==e.to&&(MK(this)&&this._detach(),e.to=n,MK(this)&&this._attach())}_attach(){let n=0;const{to:e}=this.animation;yd(e)&&(gA(e,this),Wk(e)&&(n=e.priority+1)),this.priority=n}_detach(){const{to:n}=this.animation;yd(n)&&hE(n,this)}_set(n,e=!0){const t=Gc(n);if(!_n.und(t)){const i=qp(this);if(!i||!Ig(t,i.getValue())){const r=zk(t);!i||i.constructor!=r?$H(this,r.create(t)):i.setValue(t),i&&qi.batchedUpdates(()=>{this._onChange(t,e)})}}return qp(this)}_onStart(){const n=this.animation;n.changed||(n.changed=!0,NC(this,"onStart",If(this,DC(this,n.to)),this))}_onChange(n,e){e||(this._onStart(),Oc(this.animation.onChange,n,this)),Oc(this.defaultProps.onChange,n,this),super._onChange(n,e)}_start(){const n=this.animation;qp(this).reset(Gc(n.to)),n.immediate||(n.fromValues=n.values.map(e=>e.lastPosition)),wy(this)||(NK(this,!0),PC(this)||this._resume())}_resume(){kd.skipAnimation?this.finish():vL.start(this)}_stop(n,e){if(wy(this)){NK(this,!1);const t=this.animation;Yi(t.values,r=>{r.done=!0}),t.toValues&&(t.onChange=t.onPause=t.onResume=void 0),cE(this,{type:"idle",parent:this});const i=e?oM(this.get()):If(this.get(),DC(this,n??t.to));tw(this._pendingCalls,i),t.changed&&(t.changed=!1,NC(this,"onRest",i,this))}}};function DC(n,e){const t=fE(e),i=fE(n.get());return Ig(i,t)}function Oue(n,e=n.loop,t=n.to){const i=Oc(e);if(i){const r=i!==!0&&JH(i),s=(r||n).reverse,a=!r||r.reset;return mE({...n,loop:e,default:!1,pause:void 0,to:!s||Vk(t)?t:void 0,from:a?n.from:void 0,reset:a,...r})}}function mE(n){const{to:e,from:t}=n=JH(n),i=new Set;return _n.obj(e)&&FK(e,i),_n.obj(t)&&FK(t,i),n.keys=i.size?Array.from(i):null,n}function vYe(n){const e=mE(n);return _n.und(e.default)&&(e.default=TL(e)),e}function FK(n,e){Em(n,(t,i)=>t!=null&&e.add(i))}var xYe=["onStart","onRest","onChange","onPause","onResume"];function LK(n,e,t){n.animation[t]=e[t]!==Due(e,t)?Pue(e[t],n.key):void 0}function NC(n,e,...t){n.animation[e]?.(...t),n.defaultProps[e]?.(...t)}var bYe=["onStart","onChange","onRest"],_Ye=1,Uue=class{constructor(n,e){this.id=_Ye++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),e&&(this._flush=e),n&&this.start({default:!0,...n})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(n=>n.idle&&!n.isDelayed&&!n.isPaused)}get item(){return this._item}set item(n){this._item=n}get(){const n={};return this.each((e,t)=>n[t]=e.get()),n}set(n){for(const e in n){const t=n[e];_n.und(t)||this.springs[e].set(t)}}update(n){return n&&this.queue.push(mE(n)),this}start(n){let{queue:e}=this;return n?e=tc(n).map(mE):this.queue=[],this._flush?this._flush(this,e):(Xue(this,e),Yk(this,e))}stop(n,e){if(n!==!!n&&(e=n),e){const t=this.springs;Yi(tc(e),i=>t[i].stop(!!n))}else pE(this._state,this._lastAsyncId),this.each(t=>t.stop(!!n));return this}pause(n){if(_n.und(n))this.start({pause:!0});else{const e=this.springs;Yi(tc(n),t=>e[t].pause())}return this}resume(n){if(_n.und(n))this.start({pause:!1});else{const e=this.springs;Yi(tc(n),t=>e[t].resume())}return this}each(n){Em(this.springs,n)}_onFrame(){const{onStart:n,onChange:e,onRest:t}=this._events,i=this._active.size>0,r=this._changed.size>0;(i&&!this._started||r&&!this._started)&&(this._started=!0,Aw(n,([o,l])=>{l.value=this.get(),o(l,this,this._item)}));const s=!i&&this._started,a=r||s&&t.size?this.get():null;r&&e.size&&Aw(e,([o,l])=>{l.value=a,o(l,this,this._item)}),s&&(this._started=!1,Aw(t,([o,l])=>{l.value=a,o(l,this,this._item)}))}eventObserved(n){if(n.type=="change")this._changed.add(n.parent),n.idle||this._active.add(n.parent);else if(n.type=="idle")this._active.delete(n.parent);else return;qi.onFrame(this._onFrame)}};function Yk(n,e){return Promise.all(e.map(t=>kue(n,t))).then(t=>qH(n,t))}async function kue(n,e,t){const{keys:i,to:r,from:s,loop:a,onRest:o,onResolve:l}=e,u=_n.obj(e.default)&&e.default;a&&(e.loop=!1),r===!1&&(e.to=null),s===!1&&(e.from=null);const c=_n.arr(r)||_n.fun(r)?r:void 0;c?(e.to=void 0,e.onRest=void 0,u&&(u.onRest=void 0)):Yi(bYe,_=>{const S=e[_];if(_n.fun(S)){const b=n._events[_];e[_]=({finished:M,cancelled:w})=>{const T=b.get(S);T?(M||(T.finished=!1),w&&(T.cancelled=!0)):b.set(S,{value:null,finished:M||!1,cancelled:w||!1})},u&&(u[_]=e[_])}});const d=n._state;e.pause===!d.paused?(d.paused=e.pause,tw(e.pause?d.pauseQueue:d.resumeQueue)):d.paused&&(e.pause=!0);const f=(i||Object.keys(n.springs)).map(_=>n.springs[_].start(e)),m=e.cancel===!0||Due(e,"cancel")===!0;(c||m&&d.asyncId)&&f.push(Fue(++n._lastAsyncId,{props:e,state:d,actions:{pause:Ok,resume:Ok,start(_,S){m?(pE(d,n._lastAsyncId),S(oM(n))):(_.onRest=o,S(Iue(c,_,d,n)))}}})),d.paused&&await new Promise(_=>{d.resumeQueue.add(_)});const y=qH(n,await Promise.all(f));if(a&&y.finished&&!(t&&y.noop)){const _=Oue(e,a,r);if(_)return Xue(n,[_]),kue(n,_,!0)}return l&&qi.batchedUpdates(()=>l(y,n,n.item)),y}function Kk(n,e){const t={...n.springs};return e&&Yi(tc(e),i=>{_n.und(i.keys)&&(i=mE(i)),_n.obj(i.to)||(i={...i,to:void 0}),Hue(t,i,r=>Vue(r))}),zue(n,t),t}function zue(n,e){Em(e,(t,i)=>{n.springs[i]||(n.springs[i]=t,gA(t,n))})}function Vue(n,e){const t=new yYe;return t.key=n,e&&gA(t,e),t}function Hue(n,e,t){e.keys&&Yi(e.keys,i=>{(n[i]||(n[i]=t(i)))._prepareNode(e)})}function Xue(n,e){Yi(e,t=>{Hue(n.springs,t,i=>Vue(i,n))})}var Wue=G.createContext({pause:!1,immediate:!1}),Zue=()=>{const n=[],e=function(i){Qje();const r=[];return Yi(n,(s,a)=>{if(_n.und(i))r.push(s.start());else{const o=t(i,s,a);o&&r.push(s.start(o))}}),r};e.current=n,e.add=function(i){n.includes(i)||n.push(i)},e.delete=function(i){const r=n.indexOf(i);~r&&n.splice(r,1)},e.pause=function(){return Yi(n,i=>i.pause(...arguments)),this},e.resume=function(){return Yi(n,i=>i.resume(...arguments)),this},e.set=function(i){Yi(n,(r,s)=>{const a=_n.fun(i)?i(s,r):i;a&&r.set(a)})},e.start=function(i){const r=[];return Yi(n,(s,a)=>{if(_n.und(i))r.push(s.start());else{const o=this._getProps(i,s,a);o&&r.push(s.start(o))}}),r},e.stop=function(){return Yi(n,i=>i.stop(...arguments)),this},e.update=function(i){return Yi(n,(r,s)=>r.update(this._getProps(i,r,s))),this};const t=function(i,r,s){return _n.fun(i)?i(s,r):i};return e._getProps=t,e};function SYe(n,e,t){const i=_n.fun(e)&&e;i&&!t&&(t=[]);const r=G.useMemo(()=>i||arguments.length==3?Zue():void 0,[]),s=G.useRef(0),a=YH(),o=G.useMemo(()=>({ctrls:[],queue:[],flush(b,M){const w=Kk(b,M);return s.current>0&&!o.queue.length&&!Object.keys(w).some(E=>!b.springs[E])?Yk(b,M):new Promise(E=>{zue(b,w),o.queue.push(()=>{E(Yk(b,M))}),a()})}}),[]),l=G.useRef([...o.ctrls]),u=G.useRef([]),c=kk(n)||0;G.useMemo(()=>{Yi(l.current.slice(n,c),b=>{Hk(b,r),b.stop(!0)}),l.current.length=n,d(c,n)},[n]),G.useMemo(()=>{d(0,Math.min(c,n))},t);function d(b,M){for(let w=b;w<M;w++){const T=l.current[w]||(l.current[w]=new Uue(null,o.flush)),E=i?i(w,T):e[w];E&&(u.current[w]=vYe(E))}}const f=l.current.map((b,M)=>Kk(b,u.current[M])),m=G.useContext(Wue),y=kk(m),_=m!==y&&Nue(m);Px(()=>{s.current++,o.ctrls=l.current;const{queue:b}=o;b.length&&(o.queue=[],Yi(b,M=>M())),Yi(l.current,(M,w)=>{r?.add(M),_&&M.start({default:m});const T=u.current[w];T&&(Bue(M,T.ref),M.ref?M.queue.push(T):M.start(T))})}),KH(()=>()=>{Yi(o.ctrls,b=>b.stop(!0))});const S=f.map(b=>({...b}));return r?[S,r]:S}function kg(n,e){const t=_n.fun(n),[[i],r]=SYe(1,t?n:[n],t?[]:e);return t||arguments.length==2?[i,r]:i}function jue(n,e,t){const i=_n.fun(e)&&e,{reset:r,sort:s,trail:a=0,expires:o=!0,exitBeforeEnter:l=!1,onDestroyed:u,ref:c,config:d}=i?i():e,f=G.useMemo(()=>i||arguments.length==3?Zue():void 0,[]),m=tc(n),y=[],_=G.useRef(null),S=r?null:_.current;Px(()=>{_.current=y}),KH(()=>(Yi(y,K=>{f?.add(K.ctrl),K.ctrl.ref=f}),()=>{Yi(_.current,K=>{K.expired&&clearTimeout(K.expirationId),Hk(K.ctrl,f),K.ctrl.stop(!0)})}));const b=AYe(m,i?i():e,S),M=r&&_.current||[];Px(()=>Yi(M,({ctrl:K,item:q,key:j})=>{Hk(K,f),Oc(u,q,j)}));const w=[];if(S&&Yi(S,(K,q)=>{K.expired?(clearTimeout(K.expirationId),M.push(K)):(q=w[q]=b.indexOf(K.key),~q&&(y[q]=K))}),Yi(m,(K,q)=>{y[q]||(y[q]={key:b[q],item:K,phase:"mount",ctrl:new Uue},y[q].ctrl.item=K)}),w.length){let K=-1;const{leave:q}=i?i():e;Yi(w,(j,te)=>{const he=S[te];~j?(K=y.indexOf(he),y[K]={...he,item:m[j]}):q&&y.splice(++K,0,he)})}_n.fun(s)&&y.sort((K,q)=>s(K.item,q.item));let T=-a;const E=YH(),R=TL(e),P=new Map,I=G.useRef(new Map),B=G.useRef(!1);Yi(y,(K,q)=>{const j=K.key,te=K.phase,he=i?i():e;let _e,Be;const ue=Oc(he.delay||0,j);if(te=="mount")_e=he.enter,Be="enter";else{const nt=b.indexOf(j)<0;if(te!="leave")if(nt)_e=he.leave,Be="leave";else if(_e=he.update)Be="update";else return;else if(!nt)_e=he.enter,Be="enter";else return}if(_e=Oc(_e,K.item,q),_e=_n.obj(_e)?JH(_e):{to:_e},!_e.config){const nt=d||R.config;_e.config=Oc(nt,K.item,q,Be)}T+=a;const ce={...R,delay:ue+T,ref:c,immediate:he.immediate,reset:!1,..._e};if(Be=="enter"&&_n.und(ce.from)){const nt=i?i():e,Ae=_n.und(nt.initial)||S?nt.from:nt.initial;ce.from=Oc(Ae,K.item,q)}const{onResolve:Ce}=ce;ce.onResolve=nt=>{Oc(Ce,nt);const Ae=_.current,Ye=Ae.find(ft=>ft.key===j);if(Ye&&!(nt.cancelled&&Ye.phase!="update")&&Ye.ctrl.idle){const ft=Ae.every(ze=>ze.ctrl.idle);if(Ye.phase=="leave"){const ze=Oc(o,Ye.item);if(ze!==!1){const ot=ze===!0?0:ze;if(Ye.expired=!0,!ft&&ot>0){ot<=2147483647&&(Ye.expirationId=setTimeout(E,ot));return}}}ft&&Ae.some(ze=>ze.expired)&&(I.current.delete(Ye),l&&(B.current=!0),E())}};const Oe=Kk(K.ctrl,ce);Be==="leave"&&l?I.current.set(K,{phase:Be,springs:Oe,payload:ce}):P.set(K,{phase:Be,springs:Oe,payload:ce})});const N=G.useContext(Wue),U=kk(N),V=N!==U&&Nue(N);Px(()=>{V&&Yi(y,K=>{K.ctrl.start({default:N})})},[N]),Yi(P,(K,q)=>{if(I.current.size){const j=y.findIndex(te=>te.key===q.key);y.splice(j,1)}}),Px(()=>{Yi(I.current.size?I.current:P,({phase:K,payload:q},j)=>{const{ctrl:te}=j;j.phase=K,f?.add(te),V&&K=="enter"&&te.start({default:N}),q&&(Bue(te,q.ref),(te.ref||f)&&!B.current?te.update(q):(te.start(q),B.current&&(B.current=!1)))})},r?void 0:t);const W=K=>G.createElement(G.Fragment,null,y.map((q,j)=>{const{springs:te}=P.get(q)||q.ctrl,he=K({...te},q.item,q,j),_e=_n.str(q.key)||_n.num(q.key)?q.key:q.ctrl.id,Be=G.version<"19.0.0",ue=he?.props??{},ce=Be?he?.ref:ue?.ref;return he&&he.type?G.createElement(he.type,{...ue,key:_e,ref:ce}):he}));return f?[W,f]:W}var MYe=1;function AYe(n,{key:e,keys:t=e},i){if(t===null){const r=new Set;return n.map(s=>{const a=i&&i.find(o=>o.item===s&&o.phase!=="leave"&&!r.has(o));return a?(r.add(a),a.key):MYe++})}return _n.und(t)?n:_n.fun(t)?n.map(t):tc(t)}var TYe=class extends QH{constructor(n,e){super(),this.source=n,this.idle=!0,this._active=new Set,this.calc=lE(...e);const t=this._get(),i=zk(t);$H(this,i.create(t))}advance(n){const e=this._get(),t=this.get();Ig(e,t)||(qp(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&IK(this._active)&&SU(this)}_get(){const n=_n.arr(this.source)?this.source.map(Gc):tc(Gc(this.source));return this.calc(...n)}_start(){this.idle&&!IK(this._active)&&(this.idle=!1,Yi(SL(this),n=>{n.done=!1}),kd.skipAnimation?(qi.batchedUpdates(()=>this.advance()),SU(this)):vL.start(this))}_attach(){let n=1;Yi(tc(this.source),e=>{yd(e)&&gA(e,this),Wk(e)&&(e.idle||this._active.add(e),n=Math.max(n,e.priority+1))}),this.priority=n,this._start()}_detach(){Yi(tc(this.source),n=>{yd(n)&&hE(n,this)}),this._active.clear(),SU(this)}eventObserved(n){n.type=="change"?n.idle?this.advance():(this._active.add(n.parent),this._start()):n.type=="idle"?this._active.delete(n.parent):n.type=="priority"&&(this.priority=tc(this.source).reduce((e,t)=>Math.max(e,(Wk(t)?t.priority:0)+1),0))}};function CYe(n){return n.idle!==!1}function IK(n){return!n.size||Array.from(n).every(CYe)}function SU(n){n.idle||(n.idle=!0,Yi(SL(n),e=>{e.done=!0}),cE(n,{type:"idle",parent:n}))}kd.assign({createStringInterpolator:ZH,to:(n,e)=>new TYe(n,e)});var wYe=["primitive"].concat(Object.keys(ene).filter(n=>/^[A-Z]/.test(n)).map(n=>n[0].toLowerCase()+n.slice(1)));kd.assign({createStringInterpolator:ZH,colors:bue,frameLoop:"demand"});Mne(()=>{qi.advance()});var EYe=Rue(wYe,{applyAnimatedValues:xd}),CL=EYe.animated;function Yue({innerMaterial:n=null,outerMaterial:e=null,innerProps:t={},outerProps:i={},...r}){const{nodes:s}=Zo($l("Reversal.glb")),a=o=>Ie.isValidElement(o);return $.jsx("group",{...r,dispose:null,children:$.jsxs("group",{rotation:[Math.PI/2,0,0],children:[n&&$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s["reversal-in"].geometry,scale:[10,1.018,10],...t,children:a(n)?n:$.jsx("primitive",{attach:"material",object:n})}),e&&$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s["reversal-out"].geometry,scale:[10,1.018,10],...i,children:a(e)?e:$.jsx("primitive",{attach:"material",object:e})})]})})}function s2({innerColor:n="#FF0000",innerColorEmissive:e=!1,innerColorEmissiveIntensity:t=0,outerColor:i="#000000",outerColorEmissive:r=!1,outerColorEmissiveIntensity:s=0,...a}){const o=G.useMemo(()=>n?new mo({color:e?null:n,emissive:e?n:null,emissiveIntensity:t,side:fr}):null,[n,e,t]),l=G.useMemo(()=>i?new mo({color:r?null:i,emissive:r?i:null,emissiveIntensity:s,side:fr}):null,[i,r,s]);return $.jsx(Yue,{...a,innerMaterial:o,outerMaterial:l})}function Kue({pressDepth:n=.015,glowIntensity:e=2.5,onClick:t,...i}){const[r,s]=G.useState(!1),[a,o]=G.useState(!1),l=G.useMemo(()=>new mo({color:"#000000",side:fr}),[]),{pressY:u,emissive:c}=kg({pressY:a?-n:0,emissive:r?e:0,config:f=>f==="pressY"?{mass:.6,tension:300,friction:14}:{mass:1,tension:120,friction:20}}),d={onPointerDown:f=>{f.stopPropagation(),t?.(),o(!0)},onPointerUp:f=>{f.stopPropagation(),o(!1),s(m=>!m)},onPointerLeave:()=>o(!1)};return $.jsx(Yue,{...i,outerMaterial:l,outerProps:d,innerMaterial:$.jsx(CL.meshStandardMaterial,{attach:"material",color:"#ff0000",emissive:"#ff0000",emissiveIntensity:c,side:fr}),innerProps:{positionY:u,...d}})}Zo.preload($l("Reversal.glb"));const e6="strudel.log";let RYe=1e3,GK,OK;function JR(n,e="cyclist"){Cl(`[${e}] error: ${n.message}`)}function Cl(n,e,t={}){let i=performance.now();GK===n&&i-OK<RYe||(GK=n,OK=i,console.log(`%c${n}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(e6,{detail:{message:n,type:e,data:t}})))}Cl.key=e6;typeof BigInt>"u"&&(BigInt=function(n){if(isNaN(n))throw new Error("");return n});const xi=BigInt(0),or=BigInt(1),gE=BigInt(2),$k=BigInt(5),Uc=BigInt(10),PYe=2e3,kn={s:or,n:xi,d:or};function Eg(n,e){try{n=BigInt(n)}catch{throw By()}return n*e}function wf(n){return typeof n=="bigint"?n:Math.floor(n)}function Na(n,e){if(e===xi)throw t6();const t=Object.create(oa.prototype);t.s=n<xi?-or:or,n=n<xi?-n:n;const i=yx(n,e);return t.n=n/i,t.d=e/i,t}function SS(n){const e={};let t=n,i=gE,r=$k-or;for(;r<=t;){for(;t%i===xi;)t/=i,e[i]=(e[i]||xi)+or;r+=or+gE*i++}return t!==n?t>1&&(e[t]=(e[t]||xi)+or):e[n]=(e[n]||xi)+or,e}const pl=function(n,e){let t=xi,i=or,r=or;if(n!=null)if(e!==void 0){if(typeof n=="bigint")t=n;else{if(isNaN(n))throw By();if(n%1!==0)throw UK();t=BigInt(n)}if(typeof e=="bigint")i=e;else{if(isNaN(e))throw By();if(e%1!==0)throw UK();i=BigInt(e)}r=t*i}else if(typeof n=="object"){if("d"in n&&"n"in n)t=BigInt(n.n),i=BigInt(n.d),"s"in n&&(t*=BigInt(n.s));else if(0 in n)t=BigInt(n[0]),1 in n&&(i=BigInt(n[1]));else if(typeof n=="bigint")t=n;else throw By();r=t*i}else if(typeof n=="number"){if(isNaN(n))throw By();if(n<0&&(r=-or,n=-n),n%1===0)t=BigInt(n);else if(n>0){let s=1,a=0,o=1,l=1,u=1,c=1e7;for(n>=1&&(s=10**Math.floor(1+Math.log10(n)),n/=s);o<=c&&u<=c;){let d=(a+l)/(o+u);if(n===d){o+u<=c?(t=a+l,i=o+u):u>o?(t=l,i=u):(t=a,i=o);break}else n>d?(a+=l,o+=u):(l+=a,u+=o),o>c?(t=l,i=u):(t=a,i=o)}t=BigInt(t)*BigInt(s),i=BigInt(i)}}else if(typeof n=="string"){let s=0,a=xi,o=xi,l=xi,u=or,c=or,d=n.replace(/_/g,"").match(/\d+|./g);if(d===null)throw By();if(d[s]==="-"?(r=-or,s++):d[s]==="+"&&s++,d.length===s+1?o=Eg(d[s++],r):d[s+1]==="."||d[s]==="."?(d[s]!=="."&&(a=Eg(d[s++],r)),s++,(s+1===d.length||d[s+1]==="("&&d[s+3]===")"||d[s+1]==="'"&&d[s+3]==="'")&&(o=Eg(d[s],r),u=Uc**BigInt(d[s].length),s++),(d[s]==="("&&d[s+2]===")"||d[s]==="'"&&d[s+2]==="'")&&(l=Eg(d[s+1],r),c=Uc**BigInt(d[s+1].length)-or,s+=3)):d[s+1]==="/"||d[s+1]===":"?(o=Eg(d[s],r),u=Eg(d[s+2],or),s+=3):d[s+3]==="/"&&d[s+1]===" "&&(a=Eg(d[s],r),o=Eg(d[s+2],r),u=Eg(d[s+4],or),s+=5),d.length<=s)i=u*c,r=t=l+i*a+c*o;else throw By()}else if(typeof n=="bigint")t=n,r=n,i=or;else throw By();if(i===xi)throw t6();kn.s=r<xi?-or:or,kn.n=t<xi?-t:t,kn.d=i<xi?-i:i};function DYe(n,e,t){let i=or;for(;e>xi;n=n*n%t,e>>=or)e&or&&(i=i*n%t);return i}function NYe(n,e){for(;e%gE===xi;e/=gE);for(;e%$k===xi;e/=$k);if(e===or)return xi;let t=Uc%e,i=1;for(;t!==or;i++)if(t=t*Uc%e,i>PYe)return xi;return BigInt(i)}function BYe(n,e,t){let i=or,r=DYe(Uc,t,e);for(let s=0;s<300;s++){if(i===r)return BigInt(s);i=i*Uc%e,r=r*Uc%e}return 0}function yx(n,e){if(!n)return e;if(!e)return n;for(;;){if(n%=e,!n)return e;if(e%=n,!e)return n}}function oa(n,e){if(pl(n,e),this instanceof oa)n=yx(kn.d,kn.n),this.s=kn.s,this.n=kn.n/n,this.d=kn.d/n;else return Na(kn.s*kn.n,kn.d)}var t6=function(){return new Error("Division by Zero")},By=function(){return new Error("Invalid argument")},UK=function(){return new Error("Parameters must be integer")};oa.prototype={s:or,n:xi,d:or,abs:function(){return Na(this.n,this.d)},neg:function(){return Na(-this.s*this.n,this.d)},add:function(n,e){return pl(n,e),Na(this.s*this.n*kn.d+kn.s*this.d*kn.n,this.d*kn.d)},sub:function(n,e){return pl(n,e),Na(this.s*this.n*kn.d-kn.s*this.d*kn.n,this.d*kn.d)},mul:function(n,e){return pl(n,e),Na(this.s*kn.s*this.n*kn.n,this.d*kn.d)},div:function(n,e){return pl(n,e),Na(this.s*kn.s*this.n*kn.d,this.d*kn.n)},clone:function(){return Na(this.s*this.n,this.d)},mod:function(n,e){if(n===void 0)return Na(this.s*this.n%this.d,or);if(pl(n,e),xi===kn.n*this.d)throw t6();return Na(this.s*(kn.d*this.n)%(kn.n*this.d),kn.d*this.d)},gcd:function(n,e){return pl(n,e),Na(yx(kn.n,this.n)*yx(kn.d,this.d),kn.d*this.d)},lcm:function(n,e){return pl(n,e),kn.n===xi&&this.n===xi?Na(xi,or):Na(kn.n*this.n,yx(kn.n,this.n)*yx(kn.d,this.d))},inverse:function(){return Na(this.s*this.d,this.n)},pow:function(n,e){if(pl(n,e),kn.d===or)return kn.s<xi?Na((this.s*this.d)**kn.n,this.n**kn.n):Na((this.s*this.n)**kn.n,this.d**kn.n);if(this.s<xi)return null;let t=SS(this.n),i=SS(this.d),r=or,s=or;for(let a in t)if(a!=="1"){if(a==="0"){r=xi;break}if(t[a]*=kn.n,t[a]%kn.d===xi)t[a]/=kn.d;else return null;r*=BigInt(a)**t[a]}for(let a in i)if(a!=="1"){if(i[a]*=kn.n,i[a]%kn.d===xi)i[a]/=kn.d;else return null;s*=BigInt(a)**i[a]}return kn.s<xi?Na(s,r):Na(r,s)},log:function(n,e){if(pl(n,e),this.s<=xi||kn.s<=xi)return null;const t={},i=SS(kn.n),r=SS(kn.d),s=SS(this.n),a=SS(this.d);for(const u in r)i[u]=(i[u]||xi)-r[u];for(const u in a)s[u]=(s[u]||xi)-a[u];for(const u in i)u!=="1"&&(t[u]=!0);for(const u in s)u!=="1"&&(t[u]=!0);let o=null,l=null;for(const u in t){const c=i[u]||xi,d=s[u]||xi;if(c===xi){if(d!==xi)return null;continue}let f=d,m=c;const y=yx(f,m);if(f/=y,m/=y,o===null&&l===null)o=f,l=m;else if(f*l!==o*m)return null}return o!==null&&l!==null?Na(o,l):null},equals:function(n,e){return pl(n,e),this.s*this.n*kn.d===kn.s*kn.n*this.d},lt:function(n,e){return pl(n,e),this.s*this.n*kn.d<kn.s*kn.n*this.d},lte:function(n,e){return pl(n,e),this.s*this.n*kn.d<=kn.s*kn.n*this.d},gt:function(n,e){return pl(n,e),this.s*this.n*kn.d>kn.s*kn.n*this.d},gte:function(n,e){return pl(n,e),this.s*this.n*kn.d>=kn.s*kn.n*this.d},compare:function(n,e){pl(n,e);let t=this.s*this.n*kn.d-kn.s*kn.n*this.d;return(xi<t)-(t<xi)},ceil:function(n){return n=Uc**BigInt(n||0),Na(wf(this.s*n*this.n/this.d)+(n*this.n%this.d>xi&&this.s>=xi?or:xi),n)},floor:function(n){return n=Uc**BigInt(n||0),Na(wf(this.s*n*this.n/this.d)-(n*this.n%this.d>xi&&this.s<xi?or:xi),n)},round:function(n){return n=Uc**BigInt(n||0),Na(wf(this.s*n*this.n/this.d)+this.s*((this.s>=xi?or:xi)+gE*(n*this.n%this.d)>this.d?or:xi),n)},roundTo:function(n,e){pl(n,e);const t=this.n*kn.d,i=this.d*kn.n,r=t%i;let s=wf(t/i);return r+r>=i&&s++,Na(this.s*s*kn.n,kn.d)},divisible:function(n,e){return pl(n,e),!(!(kn.n*this.d)||this.n*kn.d%(kn.n*this.d))},valueOf:function(){return Number(this.s*this.n)/Number(this.d)},toString:function(n){let e=this.n,t=this.d;n=n||15;let i=NYe(e,t),r=BYe(e,t,i),s=this.s<xi?"-":"";if(s+=wf(e/t),e%=t,e*=Uc,e&&(s+="."),i){for(let a=r;a--;)s+=wf(e/t),e%=t,e*=Uc;s+="(";for(let a=i;a--;)s+=wf(e/t),e%=t,e*=Uc;s+=")"}else for(let a=n;e&&a--;)s+=wf(e/t),e%=t,e*=Uc;return s},toFraction:function(n){let e=this.n,t=this.d,i=this.s<xi?"-":"";if(t===or)i+=e;else{let r=wf(e/t);n&&r>xi&&(i+=r,i+=" ",e%=t),i+=e,i+="/",i+=t}return i},toLatex:function(n){let e=this.n,t=this.d,i=this.s<xi?"-":"";if(t===or)i+=e;else{let r=wf(e/t);n&&r>xi&&(i+=r,e%=t),i+="\\frac{",i+=e,i+="}{",i+=t,i+="}"}return i},toContinued:function(){let n=this.n,e=this.d,t=[];do{t.push(wf(n/e));let i=n%e;n=e,e=i}while(n!==or);return t},simplify:function(n){const e=BigInt(1/(n||.001)|0),t=this.abs(),i=t.toContinued();for(let r=1;r<i.length;r++){let s=Na(i[r-1],or);for(let o=r-2;o>=0;o--)s=s.inverse().add(i[o]);let a=s.sub(t);if(a.n*e<a.d)return s.mul(this.s)}return this}};const FYe=n=>/^[a-gA-G][#bsf]*[0-9]*$/.test(n),Ub=n=>/^[a-gA-G][#bsf]*-?[0-9]*$/.test(n),$ue=n=>{if(typeof n!="string")return[];const[e,t="",i]=n.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/)?.slice(1)||[];return e?[e,t,i?Number(i):void 0]:[]},LYe={c:0,d:2,e:4,f:5,g:7,a:9,b:11},IYe={"#":1,b:-1,s:1,f:-1},n6=n=>n?.split("").reduce((e,t)=>e+IYe[t],0)||0,Rm=(n,e=3)=>{const[t,i,r=e]=$ue(n);if(!t)throw new Error('not a note: "'+n+'"');const s=LYe[t.toLowerCase()],a=n6(i);return(Number(r)+1)*12+s+a},EM=n=>Math.pow(2,(n-69)/12)*440,i6=n=>12*Math.log(n/440)/Math.LN2+69,GYe=(n,e)=>{if(typeof n!="object")throw new Error("valueToMidi: expected object value");let{freq:t,note:i}=n;if(typeof t=="number")return i6(t);if(typeof i=="string")return Rm(i);if(typeof i=="number")return i;if(!e)throw new Error("valueToMidi: expected freq or note to be set");return e},OYe=(n,e)=>(n-e)*1e3,Jue=n=>EM(typeof n=="number"?n:Rm(n)),UYe=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],kYe=n=>{const e=Math.floor(n/12)-1;return UYe[n%12]+e},zd=(n,e)=>(n%e+e)%e,que=n=>n.reduce((e,t)=>e+t)/n.length;function Que(n,e=0){return isNaN(Number(n))?(Cl(`"${n}" is not a number, falling back to ${e}`,"warning"),e):n}const zYe=(n,e)=>zd(Math.round(Que(n??0,0)),e),VYe=n=>{let{value:e,context:t}=n,i=e;if(typeof i=="object"&&!Array.isArray(i)&&(i=i.note||i.n||i.value,i===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(e)}`);if(typeof i=="number"&&t.type!=="frequency")i=EM(n.value);else if(typeof i=="number"&&t.type==="frequency")i=n.value;else if(typeof i!="string"||!Ub(i))throw new Error("not a note: "+JSON.stringify(i));return i},ece=n=>{let{value:e,context:t}=n;if(typeof e=="object")return e.freq?e.freq:Jue(e.note||e.n||e.value);if(typeof e=="number"&&t.type!=="frequency")e=EM(n.value);else if(typeof e=="string"&&Ub(e))e=EM(Rm(n.value));else if(typeof e!="number")throw new Error("not a note or frequency: "+e);return e},tce=(n,e)=>n.slice(e).concat(n.slice(0,e)),nce=(...n)=>n.reduce((e,t)=>(...i)=>e(t(...i)),e=>e),HYe=(...n)=>nce(...n.reverse()),kb=n=>n.filter(e=>e!=null),Kg=n=>[].concat(...n),XS=n=>n,XYe=(n,e)=>n,qR=(n,e)=>Array.from({length:e-n+1},(t,i)=>i+n);function ur(n,e,t=n.length){const i=function r(...s){if(s.length>=t)return n.apply(this,s);{const a=function(...o){return r.apply(this,s.concat(o))};return e&&e(a,s),a}};return e&&e(i,[]),i}function r6(n){const e=Number(n);if(!isNaN(e))return e;if(Ub(n))return Rm(n);throw new Error(`cannot parse as numeral: "${n}"`)}function s6(n,e){return(...t)=>n(...t.map(e))}function hh(n){return s6(n,r6)}function ice(n){const e=Number(n);if(!isNaN(e))return e;const t={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[n];if(typeof t<"u")return t;throw new Error(`cannot parse as fractional: "${n}"`)}const WYe=n=>s6(n,ice),a6=function(n,e){return[e.slice(0,n),e.slice(n)]},wL=(n,e,t)=>e.map((i,r)=>n(i,t[r])),rce=function(n){const e=[];for(let t=0;t<n.length-1;++t)e.push([n[t],n[t+1]]);return e},EL=(n,e,t)=>Math.min(Math.max(n,e),t),ZYe=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],jYe=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],YYe=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],KYe=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],$Ye=["I","Ro","Ha","Ni","Ho","He","To"],JYe=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],qYe=(n,e="letters")=>{const t=(e==="solfeggio"?ZYe:e==="indian"?jYe:e==="german"?YYe:e==="byzantine"?KYe:e==="japanese"?$Ye:JYe)[n%12],i=Math.floor(n/12)-1;return t+i};function QYe(n){var e={};return n.filter(function(t){return e.hasOwn(t)?!1:e[t]=!0})}function eKe(n){return n.sort().filter(function(e,t,i){return!t||e!=i[t-1]})}function sce(n){return n.sort((e,t)=>e.compare(t)).filter(function(e,t,i){return!t||e.ne(i[t-1])})}function ace(n){const e=new TextEncoder().encode(n);return btoa(String.fromCharCode(...e))}function oce(n){const e=new Uint8Array(atob(n).split("").map(t=>t.charCodeAt(0)));return new TextDecoder().decode(e)}function tKe(n){return encodeURIComponent(ace(n))}function nKe(n){return oce(decodeURIComponent(n))}function lce(n,e){return Array.isArray(n)?n.map(e):Object.fromEntries(Object.entries(n).map(([t,i],r)=>[t,e(i,t,r)]))}function Jk(n,e){return n/e}class uce{constructor({getTargetClockTime:e=rKe,weight:t=16,offsetDelta:i=.005,checkAfterTime:r=2,resetAfterTime:s=8}){this.offsetTime,this.timeAtPrevOffsetSample,this.prevOffsetTimes=[],this.getTargetClockTime=e,this.weight=t,this.offsetDelta=i,this.checkAfterTime=r,this.resetAfterTime=s,this.reset=()=>{this.prevOffsetTimes=[],this.offsetTime=null,this.timeAtPrevOffsetSample=null}}calculateOffset(e){const t=this.getTargetClockTime(),i=t-this.timeAtPrevOffsetSample,r=t-e;if(i>this.resetAfterTime&&this.reset(),this.offsetTime==null&&(this.offsetTime=r),this.prevOffsetTimes.push(r),this.prevOffsetTimes.length>this.weight&&this.prevOffsetTimes.shift(),this.timeAtPrevOffsetSample==null||i>this.checkAfterTime){this.timeAtPrevOffsetSample=t;const s=que(this.prevOffsetTimes);Math.abs(s-this.offsetTime)>this.offsetDelta&&(this.offsetTime=s)}return this.offsetTime}calculateTimestamp(e,t){return this.calculateOffset(e)+t}}function iKe(){return performance.now()*.001}function rKe(){return Date.now()*.001}const cce=new Map([["control","Control"],["ctrl","Control"],["alt","Alt"],["shift","Shift"],["down","ArrowDown"],["up","ArrowUp"],["left","ArrowLeft"],["right","ArrowRight"]]);let BC;function hce(){if(BC==null){if(typeof window>"u")return;BC={},window.addEventListener("keydown",n=>{BC[n.key]=!0}),window.addEventListener("keyup",n=>{BC[n.key]=!1})}return{...BC}}function o6(n,e=!1){return typeof n=="object"?e?JSON.stringify(n).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(n):n}oa.prototype.sam=function(){return this.floor()};oa.prototype.nextSam=function(){return this.sam().add(1)};oa.prototype.wholeCycle=function(){return new uo(this.sam(),this.nextSam())};oa.prototype.cyclePos=function(){return this.sub(this.sam())};oa.prototype.lt=function(n){return this.compare(n)<0};oa.prototype.gt=function(n){return this.compare(n)>0};oa.prototype.lte=function(n){return this.compare(n)<=0};oa.prototype.gte=function(n){return this.compare(n)>=0};oa.prototype.eq=function(n){return this.compare(n)==0};oa.prototype.ne=function(n){return this.compare(n)!=0};oa.prototype.max=function(n){return this.gt(n)?this:n};oa.prototype.maximum=function(...n){return n=n.map(e=>new oa(e)),n.reduce((e,t)=>t.max(e),this)};oa.prototype.min=function(n){return this.lt(n)?this:n};oa.prototype.mulmaybe=function(n){return n!==void 0?this.mul(n):void 0};oa.prototype.divmaybe=function(n){return n!==void 0?this.div(n):void 0};oa.prototype.addmaybe=function(n){return n!==void 0?this.add(n):void 0};oa.prototype.submaybe=function(n){return n!==void 0?this.sub(n):void 0};oa.prototype.show=function(){return this.s*this.n+"/"+this.d};oa.prototype.or=function(n){return this.eq(0)?n:this};const Sn=n=>oa(n),sKe=(...n)=>{if(n=kb(n),n.length!==0)return n.reduce((e,t)=>e.gcd(t),Sn(1))},zf=(...n)=>{if(n=kb(n),n.length===0)return;const e=n.pop();return n.reduce((t,i)=>t===void 0||i===void 0?void 0:t.lcm(i),e)},aKe=n=>n instanceof oa;Sn._original=oa;class uo{constructor(e,t){this.begin=Sn(e),this.end=Sn(t)}get spanCycles(){const e=[];var t=this.begin;const i=this.end,r=i.sam();if(t.equals(i))return[new uo(t,i)];for(;i.gt(t);){if(t.sam().equals(r)){e.push(new uo(t,this.end));break}const s=t.nextSam();e.push(new uo(t,s)),t=s}return e}get duration(){return this.end.sub(this.begin)}cycleArc(){const e=this.begin.cyclePos(),t=e.add(this.duration);return new uo(e,t)}withTime(e){return new uo(e(this.begin),e(this.end))}withEnd(e){return new uo(this.begin,e(this.end))}withCycle(e){const t=this.begin.sam(),i=t.add(e(this.begin.sub(t))),r=t.add(e(this.end.sub(t)));return new uo(i,r)}intersection(e){const t=this.begin.max(e.begin),i=this.end.min(e.end);if(!t.gt(i)&&!(t.equals(i)&&(t.equals(this.end)&&this.begin.lt(this.end)||t.equals(e.end)&&e.begin.lt(e.end))))return new uo(t,i)}intersection_e(e){const t=this.intersection(e);if(t==null)throw"TimeSpans do not intersect";return t}midpoint(){return this.begin.add(this.duration.div(Sn(2)))}equals(e){return this.begin.equals(e.begin)&&this.end.equals(e.end)}show(){return this.begin.show()+"  "+this.end.show()}}class va{constructor(e,t,i,r={},s=!1){this.whole=e,this.part=t,this.value=i,this.context=r,this.stateful=s,s&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){let e;return typeof this.value?.duration=="number"?e=Sn(this.value.duration):e=this.whole.end.sub(this.whole.begin),typeof this.value?.clip=="number"?e.mul(this.value.clip):e}get endClipped(){return this.whole.begin.add(this.duration)}isActive(e){return this.whole.begin<=e&&this.endClipped>=e}isInPast(e){return e>this.endClipped}isInNearPast(e,t){return t-e<=this.endClipped}isInFuture(e){return e<this.whole.begin}isInNearFuture(e,t){return t<this.whole.begin&&t>this.whole.begin-e}isWithinTime(e,t){return this.whole.begin<=t&&this.endClipped>=e}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(e){const t=this.whole?e(this.whole):void 0;return new va(t,e(this.part),this.value,this.context)}withValue(e){return new va(this.whole,this.part,e(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}hasTag(e){return this.context.tags?.includes(e)}resolveState(e){if(this.stateful&&this.hasOnset()){console.log("stateful");const t=this.value,[i,r]=t(e);return[i,new va(this.whole,this.part,r,this.context,!1)]}return[e,this]}spanEquals(e){return this.whole==null&&e.whole==null||this.whole.equals(e.whole)}equals(e){return this.spanEquals(e)&&this.part.equals(e.part)&&this.value===e.value}show(e=!1){const t=typeof this.value=="object"?e?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var i="";if(this.whole==null)i="~"+this.part.show;else{var r=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(i=this.whole.begin.show()+"  "),r||(i+="("),i+=this.part.show(),r||(i+=")"),this.whole.end.equals(this.part.end)||(i+="  "+this.whole.end.show())}return"[ "+i+" | "+t+" ]"}showWhole(e=!1){return`${this.whole==null?"~":this.whole.show()}: ${o6(this.value,e)}`}combineContext(e){const t=this;return{...t.context,...e.context,locations:(t.context.locations||[]).concat(e.context.locations||[])}}setContext(e){return new va(this.whole,this.part,this.value,e)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class RM{constructor(e,t={}){this.span=e,this.controls=t}setSpan(e){return new RM(e,this.controls)}withSpan(e){return this.setSpan(e(this.span))}setControls(e){return new RM(this.span,{...this.controls,...e})}}function oKe(n,e,t){if(e?.value!==void 0&&Object.keys(e).length===1)return Cl("[warn]: Can't do arithmetic on control pattern."),n;const i=Object.keys(n).filter(r=>Object.keys(e).includes(r));return Object.assign({},n,e,Object.fromEntries(i.map(r=>[r,t(n[r],e[r])])))}ur((n,e)=>n*e);ur((n,e)=>e.map(n));function dce(n,e=60){let t=0,i=Sn(0),r=[""],s="";for(;r[0].length<e;){const a=n.queryArc(t,t+1),o=a.filter(c=>c.hasOnset()).map(c=>c.duration),l=sKe(...o),u=l.inverse();r=r.map(c=>c+"|"),s+="|";for(let c=0;c<u;c++){const[d,f]=[i,i.add(l)],m=a.filter(_=>_.whole.begin.lte(d)&&_.whole.end.gte(f)),y=m.length-r.length;y>0&&(r=r.concat(Array(y).fill(s))),r=r.map((_,S)=>{const b=m[S];if(b){const M=b.whole.begin.eq(d)?""+b.value:"-";return _+M}return _+"."}),s+=".",i=i.add(l)}t++}return r.join(`
`)}const l6={},a2=async(...n)=>{const e=await Promise.allSettled(n),t=e.filter(i=>i.status==="fulfilled").map(i=>i.value);return e.forEach((i,r)=>{i.status==="rejected"&&console.warn(`evalScope: module with index ${r} could not be loaded:`,i.reason)}),t.forEach(i=>{Object.entries(i).forEach(([r,s])=>{globalThis[r]=s,l6[r]=s})}),t};function lKe(n,e={}){const{wrapExpression:t=!0,wrapAsync:i=!0}=e;t&&(n=`{${n}}`),i&&(n=`(async ()=>${n})()`);const r=`"use strict";return (${n})`;return Function(r)()}const fce=async(n,e,t)=>{let i={};if(e){const r=e(n,t);n=r.output,i=r}return{mode:"javascript",pattern:await lKe(n,{wrapExpression:!!e}),meta:i}};let qk,Dh=!0;const uKe=function(n){Dh=!!n},pce=n=>qk=n;let pn=class ml{constructor(e,t=void 0){this.query=e,this._Pattern=!0,this._steps=t}get _steps(){return this.__steps}set _steps(e){this.__steps=e===void 0?void 0:Sn(e)}setSteps(e){return this._steps=e,this}withSteps(e){return Dh?new ml(this.query,this._steps===void 0?void 0:e(this._steps)):this}get hasSteps(){return this._steps!==void 0}withValue(e){const t=new ml(i=>this.query(i).map(r=>r.withValue(e)));return t._steps=this._steps,t}withState(e){return new ml(t=>this.query(e(t)))}fmap(e){return this.withValue(e)}appWhole(e,t){const i=this,r=function(s){const a=i.query(s),o=t.query(s),l=function(u,c){const d=u.part.intersection(c.part);if(d!=null)return new va(e(u.whole,c.whole),d,u.value(c.value),c.combineContext(u))};return Kg(a.map(u=>kb(o.map(c=>l(u,c)))))};return new ml(r)}appBoth(e){const t=this,i=function(s,a){if(!(s==null||a==null))return s.intersection_e(a)},r=t.appWhole(i,e);return Dh&&(r._steps=zf(e._steps,t._steps)),r}appLeft(e){const t=this,i=function(s){const a=[];for(const o of t.query(s)){const l=e.query(s.setSpan(o.wholeOrPart()));for(const u of l){const c=o.whole,d=o.part.intersection(u.part);if(d){const f=o.value(u.value),m=u.combineContext(o),y=new va(c,d,f,m);a.push(y)}}}return a},r=new ml(i);return r._steps=this._steps,r}appRight(e){const t=this,i=function(s){const a=[];for(const o of e.query(s)){const l=t.query(s.setSpan(o.wholeOrPart()));for(const u of l){const c=o.whole,d=u.part.intersection(o.part);if(d){const f=u.value(o.value),m=o.combineContext(u),y=new va(c,d,f,m);a.push(y)}}}return a},r=new ml(i);return r._steps=e._steps,r}bindWhole(e,t){const i=this,r=function(s){const a=function(l,u){return new va(e(l.whole,u.whole),u.part,u.value,Object.assign({},l.context,u.context,{locations:(l.context.locations||[]).concat(u.context.locations||[])}))},o=function(l){return t(l.value).query(s.setSpan(l.part)).map(u=>a(l,u))};return Kg(i.query(s).map(l=>o(l)))};return new ml(r)}bind(e){const t=function(i,r){if(!(i==null||r==null))return i.intersection_e(r)};return this.bindWhole(t,e)}join(){return this.bind(XS)}outerBind(e){return this.bindWhole(t=>t,e).setSteps(this._steps)}outerJoin(){return this.outerBind(XS)}innerBind(e){return this.bindWhole((t,i)=>i,e)}innerJoin(){return this.innerBind(XS)}resetJoin(e=!1){const t=this;return new ml(i=>t.discreteOnly().query(i).map(r=>r.value.late(e?r.whole.begin:r.whole.begin.cyclePos()).query(i).map(s=>new va(s.whole?s.whole.intersection(r.whole):void 0,s.part.intersection(r.part),s.value).setContext(r.combineContext(s))).filter(s=>s.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const e=this;function t(i){const r=e.discreteOnly().query(i);function s(a){const o=a.value._focusSpan(a.wholeOrPart()).query(i.setSpan(a.part));function l(u,c){let d;if(c.whole&&u.whole&&(d=c.whole.intersection(u.whole),!d))return;const f=c.part.intersection(u.part);if(!f)return;const m=c.combineContext(u);return new va(d,f,c.value,m)}return o.map(u=>l(a,u))}return Kg(r.map(s)).filter(a=>a)}return new ml(t)}squeezeBind(e){return this.fmap(e).squeezeJoin()}polyJoin=function(){const e=this;return e.fmap(t=>t.extend(e._steps.div(t._steps))).outerJoin()};polyBind(e){return this.fmap(e).polyJoin()}queryArc(e,t,i={}){try{return this.query(new RM(new uo(e,t),i))}catch(r){return JR(r,"query"),[]}}splitQueries(){const e=this,t=i=>Kg(i.span.spanCycles.map(r=>e.query(i.setSpan(r))));return new ml(t)}withQuerySpan(e){return new ml(t=>this.query(t.withSpan(e)))}withQuerySpanMaybe(e){const t=this;return new ml(i=>{const r=i.withSpan(e);return r.span?t.query(r):[]})}withQueryTime(e){return new ml(t=>this.query(t.withSpan(i=>i.withTime(e))))}withHapSpan(e){return new ml(t=>this.query(t).map(i=>i.withSpan(e)))}withHapTime(e){return this.withHapSpan(t=>t.withTime(e))}withHaps(e){const t=new ml(i=>e(this.query(i),i));return t._steps=this._steps,t}withHap(e){return this.withHaps(t=>t.map(e))}setContext(e){return this.withHap(t=>t.setContext(e))}withContext(e){const t=this.withHap(i=>i.setContext(e(i.context)));return this.__pure!==void 0&&(t.__pure=this.__pure,t.__pure_loc=this.__pure_loc),t}stripContext(){return this.withHap(e=>e.setContext({}))}withLoc(e,t){const i={start:e,end:t},r=this.withContext(s=>{const a=(s.locations||[]).concat([i]);return{...s,locations:a}});return this.__pure&&(r.__pure=this.__pure,r.__pure_loc=i),r}filterHaps(e){return new ml(t=>this.query(t).filter(e))}filterValues(e){return new ml(t=>this.query(t).filter(i=>e(i.value))).setSteps(this._steps)}removeUndefineds(){return this.filterValues(e=>e!=null)}onsetsOnly(){return this.filterHaps(e=>e.hasOnset())}discreteOnly(){return this.filterHaps(e=>e.whole)}defragmentHaps(){return this.discreteOnly().withHaps(e=>{const t=[];for(var i=0;i<e.length;++i){for(var r=!0,s=e[i];r;){const l=JSON.stringify(e[i].value);for(var a=!1,o=i+1;o<e.length;o++){const u=e[o];if(s.whole.equals(u.whole)){if(s.part.begin.eq(u.part.end)){if(l===JSON.stringify(u.value)){s=new va(s.whole,new uo(u.part.begin,s.part.end),s.value),e.splice(o,1),a=!0;break}}else if(u.part.begin.eq(s.part.end)&&l==JSON.stringify(u.value)){s=new va(s.whole,new uo(s.part.begin,u.part.end),s.value),e.splice(o,1),a=!0;break}}}r=a}t.push(s)}return t})}firstCycle(e=!1){var t=this;return e||(t=t.stripContext()),t.query(new RM(new uo(Sn(0),Sn(1))))}get firstCycleValues(){return this.firstCycle().map(e=>e.value)}get showFirstCycle(){return this.firstCycle().map(e=>`${e.value}: ${e.whole.begin.toFraction()} - ${e.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(e=>e.sort((t,i)=>t.part.begin.sub(i.part.begin).or(t.part.end.sub(i.part.end)).or(t.whole.begin.sub(i.whole.begin).or(t.whole.end.sub(i.whole.end)))))}asNumber(){return this.fmap(r6)}_opIn(e,t){return this.fmap(t).appLeft(xn(e))}_opOut(e,t){return this.fmap(t).appRight(xn(e))}_opMix(e,t){return this.fmap(t).appBoth(xn(e))}_opSqueeze(e,t){const i=xn(e);return this.fmap(r=>i.fmap(s=>t(r)(s))).squeezeJoin()}_opSqueezeOut(e,t){const i=this;return xn(e).fmap(r=>i.fmap(s=>t(s)(r))).squeezeJoin()}_opReset(e,t){return xn(e).fmap(i=>this.fmap(r=>t(r)(i))).resetJoin()}_opRestart(e,t){return xn(e).fmap(i=>this.fmap(r=>t(r)(i))).restartJoin()}_opPoly(e,t){const i=xn(e);return this.fmap(r=>i.fmap(s=>t(s)(r))).polyJoin()}layer(...e){return Ma(...e.map(t=>t(this)))}superimpose(...e){return this.stack(...e.map(t=>t(this)))}stack(...e){return Ma(this,...e)}sequence(...e){return ep(this,...e)}seq(...e){return ep(this,...e)}cat(...e){return yE(this,...e)}fastcat(...e){return wu(this,...e)}slowcat(...e){return s1(this,...e)}onTrigger(e,t=!0){return this.withHap(i=>i.setContext({...i.context,onTrigger:(...r)=>{i.context.onTrigger?.(...r),e(...r)},dominantTrigger:i.context.dominantTrigger||t}))}log(e=i=>`[hap] ${i.showWhole(!0)}`,t=i=>({hap:i})){return this.onTrigger((...i)=>{Cl(e(...i),void 0,t(...i))},!1)}logValues(e=t=>`[hap] ${o6(t,!0)}`){return this.log(t=>e(t.value))}drawLine(){return console.log(dce(this)),this}unjoin(e,t=XS){return e.withHap(i=>i.withValue(r=>r?t(this.ribbon(i.whole.begin,i.whole.duration)):this))}into(e,t){return this.unjoin(e,t).innerJoin()}};function cKe(n,e){let t=[];return e.forEach(i=>{const r=t.findIndex(([s])=>n(i,s));r===-1?t.push([i]):t[r].push(i)}),t}const hKe=(n,e)=>n.spanEquals(e);pn.prototype.collect=function(){return this.withHaps(n=>cKe(hKe,n).map(e=>new va(e[0].whole,e[0].part,e,{})))};const dKe=Nt("arpWith",(n,e)=>e.collect().fmap(t=>xn(n(t))).innerJoin().withHap(t=>new va(t.whole,t.part,t.value.value,t.combineContext(t.value)))),fKe=Nt("arp",(n,e)=>e.arpWith(t=>xn(n).fmap(i=>t[i%t.length])),!1);function sN(n){return!Array.isArray(n)&&typeof n=="object"&&!aKe(n)}function pKe(n,e,t){return sN(n)||sN(e)?(sN(n)||(n={value:n}),sN(e)||(e={value:e}),oKe(n,e,t)):t(n,e)}(function(){const n={set:[(t,i)=>i],keep:[t=>t],keepif:[(t,i)=>i?t:void 0],add:[hh((t,i)=>t+i)],sub:[hh((t,i)=>t-i)],mul:[hh((t,i)=>t*i)],div:[hh((t,i)=>t/i)],mod:[hh(zd)],pow:[hh(Math.pow)],log2:[hh(Math.log2)],band:[hh((t,i)=>t&i)],bor:[hh((t,i)=>t|i)],bxor:[hh((t,i)=>t^i)],blshift:[hh((t,i)=>t<<i)],brshift:[hh((t,i)=>t>>i)],lt:[(t,i)=>t<i],gt:[(t,i)=>t>i],lte:[(t,i)=>t<=i],gte:[(t,i)=>t>=i],eq:[(t,i)=>t==i],eqt:[(t,i)=>t===i],ne:[(t,i)=>t!=i],net:[(t,i)=>t!==i],and:[(t,i)=>t&&i],or:[(t,i)=>t||i],func:[(t,i)=>i(t)]},e=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart","Poly"];for(const[t,[i,r]]of Object.entries(n)){pn.prototype["_"+t]=function(s){return this.fmap(a=>i(a,s))},Object.defineProperty(pn.prototype,t,{get:function(){const s=this,a=(...o)=>s[t].in(...o);for(const o of e)a[o.toLowerCase()]=function(...l){var u=s;l=ep(l),r&&(u=r(u),l=r(l));var c;return t==="keepif"?(c=u["_op"+o](l,d=>f=>i(d,f)),c=c.removeUndefineds()):c=u["_op"+o](l,d=>f=>pKe(d,f,i)),c};return a.squeezein=a.squeeze,a}});for(const s of e)pn.prototype[s.toLowerCase()]=function(...a){return this.set[s.toLowerCase()](a)}}pn.prototype.struct=function(...t){return this.keepif.out(...t)},pn.prototype.structAll=function(...t){return this.keep.out(...t)},pn.prototype.mask=function(...t){return this.keepif.in(...t)},pn.prototype.maskAll=function(...t){return this.keep.in(...t)},pn.prototype.reset=function(...t){return this.keepif.reset(...t)},pn.prototype.resetAll=function(...t){return this.keep.reset(...t)},pn.prototype.restart=function(...t){return this.keepif.restart(...t)},pn.prototype.restartAll=function(...t){return this.keep.restart(...t)}})();const mKe=Ma,gKe=Ma,yKe=RL,yA=n=>new pn(()=>[],n),ws=yA(1),Qf=yA(0);function $s(n){function e(i){return i.span.spanCycles.map(r=>new va(Sn(r.begin).wholeCycle(),r,n))}const t=new pn(e,1);return t.__pure=n,t}function u6(n){return n instanceof pn||n?._Pattern}function xn(n){return u6(n)?n:qk&&typeof n=="string"?qk(n):$s(n)}function mce(n){let e=$s([]);for(const t of n)e=e.bind(i=>t.fmap(r=>i.concat([r])));return e}function Ma(...n){n=n.map(i=>Array.isArray(i)?ep(...i):xn(i));const e=i=>Kg(n.map(r=>r.query(i))),t=new pn(e);return Dh&&(t._steps=zf(...n.map(i=>i._steps))),t}function c6(n,e){if(e=e.map(s=>Array.isArray(s)?ep(...s):xn(s)),e.length===0)return ws;if(e.length===1)return e[0];const[t,...i]=e.map(s=>s._steps),r=Dh?t.maximum(...i):void 0;return Ma(...n(r,e))}function gce(...n){return c6((e,t)=>t.map(i=>i._steps.eq(e)?i:Yc(i,yA(e.sub(i._steps)))),n)}function yce(...n){return c6((e,t)=>t.map(i=>i._steps.eq(e)?i:Yc(yA(e.sub(i._steps)),i)),n)}function vce(...n){return c6((e,t)=>t.map(i=>{if(i._steps.eq(e))return i;const r=yA(e.sub(i._steps).div(2));return Yc(r,i,r)}),n)}function vKe(n,...e){const[t,...i]=e.map(a=>a._steps),r=t.maximum(...i),s={centre:vce,left:gce,right:yce,expand:Ma,repeat:(...a)=>RL(...a).steps(r)};return n.inhabit(s).fmap(a=>a(...e)).innerJoin().setSteps(r)}function s1(...n){if(n=n.map(i=>Array.isArray(i)?wu(...i):xn(i)),n.length==1)return n[0];const e=function(i){const r=i.span,s=zd(r.begin.sam(),n.length),a=n[s];if(!a)return[];const o=r.begin.floor().sub(r.begin.div(n.length).floor());return a.withHapTime(l=>l.add(o)).query(i.setSpan(r.withTime(l=>l.sub(o))))},t=Dh?zf(...n.map(i=>i._steps)):void 0;return new pn(e).splitQueries().setSteps(t)}function h6(...n){n=n.map(xn);const e=function(t){const i=Math.floor(t.span.begin)%n.length;return n[i]?.query(t)||[]};return new pn(e).splitQueries()}function yE(...n){return s1(...n)}function xKe(...n){const e=n.reduce((t,[i])=>t+i,0);return n=n.map(([t,i])=>[t,i.fast(t)]),Yc(...n).slow(e)}function bKe(...n){let e=Sn(0);for(let t of n)t.length==2&&t.unshift(e),e=t[1];return Ma(...n.map(([t,i,r])=>$s(xn(r)).compress(Sn(t).div(e),Sn(i).div(e)))).slow(e).innerJoin()}function wu(...n){let e=s1(...n);return n.length>1&&(e=e._fast(n.length),e._steps=n.length),n.length==1&&n[0].__steps_source&&(n._steps=n[0]._steps),e}function ep(...n){return wu(...n)}function xce(...n){return wu(...n)}function Qk(n){return Array.isArray(n)?n.length==0?[ws,0]:n.length==1?Qk(n[0]):[wu(...n.map(e=>Qk(e)[0])),n.length]:[xn(n),1]}const _Ke=ur((n,e)=>xn(e).mask(n)),SKe=ur((n,e)=>xn(e).struct(n)),MKe=ur((n,e)=>xn(e).superimpose(...n)),AKe=ur((n,e)=>xn(e).withValue(n)),TKe=ur((n,e)=>xn(e).bind(n)),CKe=ur((n,e)=>xn(e).innerBind(n)),wKe=ur((n,e)=>xn(e).outerBind(n)),EKe=ur((n,e)=>xn(e).squeezeBind(n)),RKe=ur((n,e)=>xn(e).stepBind(n)),PKe=ur((n,e)=>xn(e).polyBind(n)),DKe=ur((n,e)=>xn(e).set(n)),NKe=ur((n,e)=>xn(e).keep(n)),BKe=ur((n,e)=>xn(e).keepif(n)),FKe=ur((n,e)=>xn(e).add(n)),LKe=ur((n,e)=>xn(e).sub(n)),IKe=ur((n,e)=>xn(e).mul(n)),GKe=ur((n,e)=>xn(e).div(n)),OKe=ur((n,e)=>xn(e).mod(n)),UKe=ur((n,e)=>xn(e).pow(n)),kKe=ur((n,e)=>xn(e).band(n)),zKe=ur((n,e)=>xn(e).bor(n)),VKe=ur((n,e)=>xn(e).bxor(n)),HKe=ur((n,e)=>xn(e).blshift(n)),XKe=ur((n,e)=>xn(e).brshift(n)),WKe=ur((n,e)=>xn(e).lt(n)),ZKe=ur((n,e)=>xn(e).gt(n)),jKe=ur((n,e)=>xn(e).lte(n)),YKe=ur((n,e)=>xn(e).gte(n)),KKe=ur((n,e)=>xn(e).eq(n)),$Ke=ur((n,e)=>xn(e).eqt(n)),JKe=ur((n,e)=>xn(e).ne(n)),qKe=ur((n,e)=>xn(e).net(n)),QKe=ur((n,e)=>xn(e).and(n)),e$e=ur((n,e)=>xn(e).or(n)),t$e=ur((n,e)=>xn(e).func(n));function Nt(n,e,t=!0,i=!1,r=s=>s.innerJoin()){if(Array.isArray(n)){const l={};for(const u of n)l[u]=Nt(u,e,t,i,r);return l}const s=e.length;var a;t?a=function(...l){l=l.map(xn);const u=l[l.length-1];let c;if(s===1)c=e(u);else{const d=l.slice(0,-1);if(d.every(f=>f.__pure!=null)){const f=d.map(y=>y.__pure),m=d.filter(y=>y.__pure_loc).map(y=>y.__pure_loc);c=e(...f,u),c=c.withContext(y=>{const _=(y.locations||[]).concat(m);return{...y,locations:_}})}else{const[f,...m]=d;let y=(..._)=>e(..._,u);y=ur(y,null,s-1),c=r(m.reduce((_,S)=>_.appLeft(S),f.fmap(y)))}}return i&&(c._steps=u._steps),c}:a=function(...l){l=l.map(xn);const u=e(...l);return i&&(u._steps=l[l.length-1]._steps),u},pn.prototype[n]=function(...l){if(s===2&&l.length!==1)l=[ep(...l)];else if(s!==l.length+1)throw new Error(`.${n}() expects ${s-1} inputs but got ${l.length}.`);return l=l.map(xn),a(...l,this)},s>1&&(pn.prototype["_"+n]=function(...l){const u=e(...l,this);return i&&u.setSteps(this._steps),u});const o=ur(a,null,s);return l6[n]=o,o}function vA(n,e,t=!0,i=!1,r=s=>s.stepJoin()){return Nt(n,e,t,i,r)}const n$e=Nt("round",function(n){return n.asNumber().fmap(e=>Math.round(e))}),i$e=Nt("floor",function(n){return n.asNumber().fmap(e=>Math.floor(e))}),r$e=Nt("ceil",function(n){return n.asNumber().fmap(e=>Math.ceil(e))}),s$e=Nt("toBipolar",function(n){return n.fmap(e=>e*2-1)}),a$e=Nt("fromBipolar",function(n){return n.fmap(e=>(e+1)/2)}),o$e=Nt("range",function(n,e,t){return t.mul(e-n).add(n)}),l$e=Nt("rangex",function(n,e,t){return t._range(Math.log(n),Math.log(e)).fmap(Math.exp)}),u$e=Nt("range2",function(n,e,t){return t.fromBipolar()._range(n,e)}),c$e=Nt("ratio",n=>n.fmap(e=>Array.isArray(e)?e.slice(1).reduce((t,i)=>t/i,e[0]):e)),h$e=Nt("compress",function(n,e,t){return n=Sn(n),e=Sn(e),n.gt(e)||n.gt(1)||e.gt(1)||n.lt(0)||e.lt(0)?ws:t._fastGap(Sn(1).div(e.sub(n)))._late(n)}),{compressSpan:d$e,compressspan:f$e}=Nt(["compressSpan","compressspan"],function(n,e){return e._compress(n.begin,n.end)}),{fastGap:p$e,fastgap:m$e}=Nt(["fastGap","fastgap"],function(n,e){const t=function(r){const s=r.begin.sam(),a=r.begin.sub(s).mul(n).min(1),o=r.end.sub(s).mul(n).min(1);if(!(a>=1))return new uo(s.add(a),s.add(o))},i=function(r){const s=r.part.begin,a=r.part.end,o=s.sam(),l=s.sub(o).div(n).min(1),u=a.sub(o).div(n).min(1),c=new uo(o.add(l),o.add(u)),d=r.whole?new uo(c.begin.sub(s.sub(r.whole.begin).div(n)),c.end.add(r.whole.end.sub(a).div(n))):void 0;return new va(d,c,r.value,r.context)};return e.withQuerySpanMaybe(t).withHap(i).splitQueries()}),g$e=Nt("focus",function(n,e,t){return n=Sn(n),e=Sn(e),t._early(n.sam())._fast(Sn(1).div(e.sub(n)))._late(n)}),{focusSpan:y$e,focusspan:v$e}=Nt(["focusSpan","focusspan"],function(n,e){return e._focus(n.begin,n.end)}),x$e=Nt("ply",function(n,e){const t=e.fmap(i=>$s(i)._fast(n)).squeezeJoin();return Dh&&(t._steps=Sn(n).mulmaybe(e._steps)),t}),{fast:b$e,density:ygt}=Nt(["fast","density"],function(n,e){return n===0?ws:(n=Sn(n),e.withQueryTime(t=>t.mul(n)).withHapTime(t=>t.div(n)).setSteps(e._steps))},!0,!0),_$e=Nt("hurry",function(n,e){return e._fast(n).mul($s({speed:n}))}),{slow:S$e,sparsity:M$e}=Nt(["slow","sparsity"],function(n,e){return n===0?ws:e._fast(Sn(1).div(n))}),A$e=Nt("inside",function(n,e,t){return e(t._slow(n))._fast(n)}),T$e=Nt("outside",function(n,e,t){return e(t._fast(n))._slow(n)}),C$e=Nt("lastOf",function(n,e,t){const i=Array(n-1).fill(t);return i.push(e(t)),h6(...i)}),{firstOf:w$e,every:E$e}=Nt(["firstOf","every"],function(n,e,t){const i=Array(n-1).fill(t);return i.unshift(e(t)),h6(...i)}),R$e=Nt("apply",function(n,e){return n(e)}),P$e=Nt("cpm",function(n,e){return e._fast(n/60/1)}),D$e=Nt("early",function(n,e){return n=Sn(n),e.withQueryTime(t=>t.add(n)).withHapTime(t=>t.sub(n))},!0,!0),bce=Nt("late",function(n,e){return n=Sn(n),e._early(Sn(0).sub(n))},!0,!0),N$e=Nt("zoom",function(n,e,t){if(e=Sn(e),n=Sn(n),n.gte(e))return Qf;const i=e.sub(n),r=Dh?t._steps?.mulmaybe(i):void 0;return t.withQuerySpan(s=>s.withCycle(a=>a.mul(i).add(n))).withHapSpan(s=>s.withCycle(a=>a.sub(n).div(i))).splitQueries().setSteps(r)}),{zoomArc:B$e,zoomarc:F$e}=Nt(["zoomArc","zoomarc"],function(n,e){return e.zoom(n.begin,n.end)}),L$e=Nt("bite",(n,e,t)=>e.fmap(i=>r=>{const s=Sn(i).div(r).mod(1),a=s.add(Sn(1).div(r));return t.zoom(s,a)}).appLeft(n).squeezeJoin(),!1),I$e=Nt("linger",function(n,e){return n==0?ws:n<0?e._zoom(n.add(1),1)._slow(n):e._zoom(0,n)._slow(n)},!0,!0),{segment:G$e,seg:O$e}=Nt(["segment","seg"],function(n,e){return e.struct($s(!0)._fast(n)).setSteps(n)}),U$e=Nt("swingBy",(n,e,t)=>t.inside(e,bce(xce(0,n/2)))),k$e=Nt("swing",(n,e)=>e.swingBy(1/3,n)),{invert:z$e,inv:V$e}=Nt(["invert","inv"],function(n){return n.fmap(e=>!e)},!0,!0),H$e=Nt("when",function(n,e,t){return n?e(t):t}),X$e=Nt("off",function(n,e,t){return Ma(t,e(t.late(n)))}),W$e=Nt("brak",function(n){return n.when(s1(!1,!0),e=>wu(e,ws)._late(.25))}),_ce=Nt("rev",function(n){const e=function(t){const i=t.span,r=i.begin.sam(),s=i.begin.nextSam(),a=function(o){const l=o.withTime(c=>r.add(s.sub(c))),u=l.begin;return l.begin=l.end,l.end=u,l};return n.query(t.setSpan(a(i))).map(o=>o.withSpan(a))};return new pn(e).splitQueries()},!1,!0),Z$e=Nt("revv",function(n){const e=t=>new uo(Sn(0).sub(t.end),Sn(0).sub(t.begin));return n.withQuerySpan(e).withHapSpan(e)}),j$e=Nt("pressBy",function(n,e){return e.fmap(t=>$s(t).compress(n,1)).squeezeJoin()}),Y$e=Nt("press",function(n){return n._pressBy(.5)});pn.prototype.hush=function(){return ws};const K$e=Nt("palindrome",function(n){return n.lastOf(2,_ce)},!0,!0),{juxBy:$$e,juxby:J$e}=Nt(["juxBy","juxby"],function(n,e,t){n/=2;const i=function(a,o,l){return o in a?a[o]:l},r=t.withValue(a=>Object.assign({},a,{pan:i(a,"pan",.5)-n})),s=e(t.withValue(a=>Object.assign({},a,{pan:i(a,"pan",.5)+n})));return Ma(r,s).setSteps(Dh?zf(r._steps,s._steps):void 0)}),q$e=Nt("jux",function(n,e){return e._juxBy(1,n,e)}),{echoWith:Q$e,echowith:eJe,stutWith:tJe,stutwith:nJe}=Nt(["echoWith","echowith","stutWith","stutwith"],function(n,e,t,i){return Ma(...qR(0,n-1).map(r=>t(i.late(Sn(e).mul(r)),r)))}),iJe=Nt("echo",function(n,e,t,i){return i._echoWith(n,e,(r,s)=>r.gain(Math.pow(t,s)))}),rJe=Nt("stut",function(n,e,t,i){return i._echoWith(n,t,(r,s)=>r.gain(Math.pow(e,s)))}),Sce=Nt("applyN",function(n,e,t){let i=t;for(let r=0;r<n;r++)i=e(i);return i}),sJe=Nt(["plyWith","plywith"],function(n,e,t){const i=t.fmap(r=>yE(...qR(0,n-1).map(s=>Sce(s,e,r)))._fast(n)).squeezeJoin();return Dh&&(i._steps=Sn(n).mulmaybe(t._steps)),i}),aJe=Nt(["plyForEach","plyforeach"],function(n,e,t){const i=t.fmap(r=>yE(yE($s(r),...qR(1,n-1).map(s=>e($s(r),s))))._fast(n)).squeezeJoin();return Dh&&(i._steps=Sn(n).mulmaybe(t._steps)),i}),d6=function(n,e,t=!1){return n=Sn(n),s1(...qR(0,n.sub(1)).map(i=>t?e.late(Sn(i).div(n)):e.early(Sn(i).div(n))))},oJe=Nt("iter",function(n,e){return d6(n,e,!1)},!0,!0),{iterBack:lJe,iterback:uJe}=Nt(["iterBack","iterback"],function(n,e){return d6(n,e,!0)},!0,!0),{repeatCycles:cJe}=Nt("repeatCycles",function(n,e){return new pn(function(t){const i=t.span.begin.sam(),r=i.div(n).sam(),s=i.sub(r);return t=t.withSpan(a=>a.withTime(o=>o.sub(s))),e.query(t).map(a=>a.withSpan(o=>o.withTime(l=>l.add(s))))}).splitQueries()},!0,!0),f6=function(n,e,t,i=!1,r=!1){const s=Array(n-1).fill(!1);s.unshift(!0);const a=d6(n,ep(...s),!i);return r||(t=t.repeatCycles(n)),t.when(a,e)},{chunk:hJe,slowchunk:dJe,slowChunk:fJe}=Nt(["chunk","slowchunk","slowChunk"],function(n,e,t){return f6(n,e,t,!1,!1)},!0,!0),{chunkBack:pJe,chunkback:mJe}=Nt(["chunkBack","chunkback"],function(n,e,t){return f6(n,e,t,!0)},!0,!0),{fastchunk:gJe,fastChunk:yJe}=Nt(["fastchunk","fastChunk"],function(n,e,t){return f6(n,e,t,!1,!0)},!0,!0),{chunkinto:vJe,chunkInto:xJe}=Nt(["chunkinto","chunkInto"],function(n,e,t){return t.into(wu(!0,...Array(n-1).fill(!1))._iterback(n),e)}),{chunkbackinto:bJe,chunkBackInto:_Je}=Nt(["chunkbackinto","chunkBackInto"],function(n,e,t){return t.into(wu(!0,...Array(n-1).fill(!1))._iter(n)._early(1),e)}),SJe=Nt("bypass",function(n,e){return n=!!parseInt(n),n?ws:e},!0,!0),{ribbon:MJe,rib:AJe}=Nt(["ribbon","rib"],(n,e,t)=>t.early(n).restart($s(1).slow(e))),TJe=Nt("hsla",(n,e,t,i,r)=>r.color(`hsla(${n}turn,${e*100}%,${t*100}%,${i})`)),CJe=Nt("hsl",(n,e,t,i)=>i.color(`hsl(${n}turn,${e*100}%,${t*100}%)`));pn.prototype.tag=function(n){return this.withContext(e=>({...e,tags:(e.tags||[]).concat([n])}))};const wJe=Nt("filter",(n,e)=>e.withHaps(t=>t.filter(n))),EJe=Nt("filterWhen",(n,e)=>e.filter(t=>n(t.whole.begin))),RJe=Nt("within",(n,e,t,i)=>Ma(t(i.filterWhen(r=>r.cyclePos()>=n&&r.cyclePos()<=e)),i.filterWhen(r=>r.cyclePos()<n||r.cyclePos()>e)));pn.prototype.stepJoin=function(){const n=this,e=Yc(...ez(tz(n.queryArc(0,1))))._steps,t=function(i){const r=n.early(i.span.begin.sam()).query(i.setSpan(new uo(Sn(0),Sn(1))));return Yc(...ez(tz(r))).query(i)};return new pn(t,e)};pn.prototype.stepBind=function(n){return this.fmap(n).stepJoin()};function ez(n){const e=n.filter((s,a)=>a.hasSteps).reduce((s,a)=>s.add(a),Sn(0)),t=kb(n.map((s,a)=>a._steps)).reduce((s,a)=>s.add(a),Sn(0)),i=e.eq(0)?void 0:t.div(e);function r(s,a){return a._steps===void 0?[s.mulmaybe(i),a]:[a._steps,a]}return n.map(s=>r(...s))}function tz(n){const e=Kg(n.map(i=>[i.part.begin,i.part.end])),t=sce([Sn(0),Sn(1),...e]);return rce(t).map(i=>[i[1].sub(i[0]),Ma(...Mce(new uo(...i),n).map(r=>r.value.withHap(s=>s.setContext(s.combineContext(r)))))])}function Mce(n,e){return kb(e.map(t=>Ace(n,t)))}function Ace(n,e){const t=n.intersection(e.part);if(t!=null)return new va(e.whole,t,e.value,e.context)}const Tce=Nt("pace",function(n,e){return e._steps===void 0?e:e._steps.eq(Sn(0))?Qf:e._fast(Sn(n).div(e._steps)).setSteps(n)});function Cce(n,...e){const t=e.map(r=>Qk(r));if(t.length==0)return ws;n==0&&(n=t[0][1]);const i=[];for(const r of t)r[1]!=0&&(n==r[1]?i.push(r[0]):i.push(r[0]._fast(Sn(n).div(Sn(r[1])))));return Ma(...i)}function RL(...n){if(Array.isArray(n[0]))return Cce(0,...n);if(n=n.filter(i=>i.hasSteps),n.length==0)return ws;const e=zf(...n.map(i=>i._steps));if(e.eq(Sn(0)))return Qf;const t=Ma(...n.map(i=>i.pace(e)));return t._steps=e,t}function Yc(...n){if(n.length===0)return Qf;const e=a=>Array.isArray(a)?a:[a._steps??1,a];if(n=n.map(e),n.find(a=>a[0]===void 0)){const a=n.map(l=>l[0]).filter(l=>l!==void 0);if(a.length===0)return wu(...n.map(l=>l[1]));if(a.length===n.length)return Qf;const o=a.reduce((l,u)=>l.add(u),Sn(0)).div(a.length);for(let l of n)l[0]===void 0&&(l[0]=o)}if(n.length==1)return xn(n[0][1]).withSteps(a=>n[0][0]);const t=n.map(a=>a[0]).reduce((a,o)=>a.add(o),Sn(0));let i=Sn(0);const r=[];for(const[a,o]of n){if(Sn(a).eq(0))continue;const l=i.add(a);r.push(xn(o)._compress(i.div(t),l.div(t))),i=l}const s=Ma(...r);return s._steps=t,s}function wce(...n){n=n.map(r=>Array.isArray(r)?r.map(xn):[xn(r)]);const e=zf(...n.map(r=>Sn(r.length)));let t=[];for(let r=0;r<e;++r)t.push(...n.map(s=>s.length==0?ws:s[r%s.length]));t=t.filter(r=>r.hasSteps&&r._steps>0);const i=t.reduce((r,s)=>r.add(s._steps),Sn(0));return t=Yc(...t),t._steps=i,t}const Ece=vA("take",function(n,e){if(!e.hasSteps||e._steps.lte(0)||(n=Sn(n),n.eq(0)))return Qf;const t=n<0;t&&(n=n.abs());const i=n.div(e._steps);return i.lte(0)?Qf:i.gte(1)?e:t?e.zoom(Sn(1).sub(i),1):e.zoom(0,i)}),Rce=vA("drop",function(n,e){return e.hasSteps?(n=Sn(n),n.lt(0)?e.take(e._steps.add(n)):e.take(Sn(0).sub(e._steps.sub(n)))):Qf}),Pce=vA("extend",function(n,e){return e.fast(n).expand(n)}),PJe=vA("replicate",function(n,e){return e.repeatCycles(n).fast(n).expand(n)}),Dce=vA("expand",function(n,e){return e.withSteps(t=>t.mul(Sn(n)))}),Nce=vA("contract",function(n,e){return e.withSteps(t=>t.div(Sn(n)))});pn.prototype.shrinklist=function(n){const e=this;if(!e.hasSteps)return[e];let[t,i]=Array.isArray(n)?n:[n,e._steps];if(t=Sn(t),i===0||t===0)return[e];const r=t>0,s=[];if(r){const a=Sn(1).div(e._steps).mul(t);for(let o=0;o<i;++o){const l=a.mul(o);if(l.gt(1))break;s.push([l,1])}}else{t=Sn(0).sub(t);const a=Sn(1).div(e._steps).mul(t);for(let o=0;o<i;++o){const l=Sn(1).sub(a.mul(o));if(l.lt(0))break;s.push([Sn(0),l])}}return s.map(a=>e.zoom(...a))};const Bce=(n,e)=>e.shrinklist(n),Fce=Nt("shrink",function(n,e){if(!e.hasSteps)return Qf;const t=e.shrinklist(n),i=Yc(...t);return i._steps=t.reduce((r,s)=>r.add(s._steps),Sn(0)),i},!0,!1,n=>n.stepJoin()),DJe=Nt("grow",function(n,e){if(!e.hasSteps)return Qf;const t=e.shrinklist(Sn(0).sub(n));t.reverse();const i=Yc(...t);return i._steps=t.reduce((r,s)=>r.add(s._steps),Sn(0)),i},!0,!1,n=>n.stepJoin()),Lce=function(n,...e){return n.tour(...e)};pn.prototype.tour=function(...n){return Yc(...[].concat(...n.map((e,t)=>[...n.slice(0,n.length-t),this,...n.slice(n.length-t)]),this,...n))};const Ice=function(...n){n=n.filter(i=>i.hasSteps);const e=s1(...n.map(i=>i._slow(i._steps))),t=zf(...n.map(i=>i._steps));return e._fast(t).setSteps(t)},NJe=Yc,p6=Yc,BJe=Yc,FJe=wce,LJe=RL;pn.prototype.s_polymeter=pn.prototype.polymeter;const IJe=Fce;pn.prototype.s_taper=pn.prototype.shrink;const GJe=Bce;pn.prototype.s_taperlist=pn.prototype.shrinklist;const OJe=Ece;pn.prototype.s_add=pn.prototype.take;const UJe=Rce;pn.prototype.s_sub=pn.prototype.drop;const kJe=Dce;pn.prototype.s_expand=pn.prototype.expand;const zJe=Pce;pn.prototype.s_extend=pn.prototype.extend;const VJe=Nce;pn.prototype.s_contract=pn.prototype.contract;const HJe=Lce;pn.prototype.s_tour=pn.prototype.tour;const XJe=Ice;pn.prototype.s_zip=pn.prototype.zip;const WJe=Tce;pn.prototype.steps=pn.prototype.pace;const ZJe=Nt("chop",function(n,e){const t=Array.from({length:n},(s,a)=>a).map(s=>({begin:s/n,end:(s+1)/n})),i=function(s,a){if("begin"in s&&"end"in s&&s.begin!==void 0&&s.end!==void 0){const o=s.end-s.begin;a={begin:s.begin+a.begin*o,end:s.begin+a.end*o}}return Object.assign({},s,a)},r=function(s){return ep(t.map(a=>i(s,a)))};return e.squeezeBind(r).setSteps(Dh?Sn(n).mulmaybe(e._steps):void 0)}),jJe=Nt("striate",function(n,e){const t=Array.from({length:n},(r,s)=>s).map(r=>({begin:r/n,end:(r+1)/n})),i=s1(...t);return e.set(i)._fast(n).setSteps(Dh?Sn(n).mulmaybe(e._steps):void 0)}),Gce=function(n,e,t=.5){return e.speed(1/n*t).unit("c").slow(n)},Oce=Nt("slice",function(n,e,t){return n.innerBind(i=>e.outerBind(r=>t.outerBind(s=>{s=s instanceof Object?s:{s};const a=Array.isArray(i)?i[r]:r/i,o=Array.isArray(i)?i[r+1]:(r+1)/i;return $s({begin:a,end:o,_slices:i,...s})}))).setSteps(e._steps)},!1);pn.prototype.onTriggerTime=function(n){return this.onTrigger((e,t,i,r)=>{const s=r-t;window.setTimeout(()=>{n(e)},s*1e3)},!1)};const YJe=Nt("splice",function(n,e,t){const i=Oce(n,e,t);return new pn(r=>{const s=r.controls._cps||1;return i.query(r).map(a=>a.withValue(o=>({speed:s/o._slices/a.whole.duration*(o.speed||1),unit:"c",...o})))}).setSteps(e._steps)},!1),{loopAt:KJe,loopat:$Je}=Nt(["loopAt","loopat"],function(n,e){const t=e._steps?e._steps.div(n):void 0;return new pn(i=>Gce(n,e,i.controls._cps).query(i),t)}),JJe=Nt("fit",n=>n.withHaps((e,t)=>e.map(i=>i.withValue(r=>{const s=("end"in r?r.end:1)-("begin"in r?r.begin:0);return{...r,speed:(t.controls._cps||1)/i.whole.duration*s,unit:"c"}})))),{loopAtCps:qJe,loopatcps:QJe}=Nt(["loopAtCps","loopatcps"],function(n,e,t){return Gce(n,t,e)}),eqe=n=>$s(1).withValue(()=>xn(n())).innerJoin();let kK=n=>n<.5?1:1-(n-.5)/.5,Uce=(n,e,t)=>{e=xn(e),n=xn(n),t=xn(t);let i=e.fmap(s=>({gain:kK(s)})),r=e.fmap(s=>({gain:kK(1-s)}));return Ma(n.mul(i),t.mul(r))};pn.prototype.xfade=function(n,e){return Uce(this,n,e)};const tqe=n=>(e,t,i)=>{e=Sn(e).mod(t),t=Sn(t);const r=e.div(t),s=e.add(1).div(t);return n(i.fmap(a=>$s(a)._compress(r,s)))},{beat:nqe}=Nt(["beat"],tqe(n=>n.innerJoin())),m6=(n,e,t)=>{t=Sn(t);const i=Sn(1).div(n.length),r=o=>{const l=[];for(const[u,c]of o.entries())c&&l.push([Sn(u).div(o.length),c]);return l},s=wL(([o,l],[u,c])=>{const d=t.mul(u-o).add(o),f=d.add(i);return new uo(d,f)},r(n),r(e));function a(o){const l=o.span.begin.sam(),u=o.span.cycleArc(),c=[];for(const d of s){const f=d.intersection(u);f!==void 0&&c.push(new va(d.withTime(m=>m.add(l)),f.withTime(m=>m.add(l)),!0))}return c}return new pn(a).splitQueries()},iqe=(n,e,t)=>(n=xn(n),e=xn(e),t=xn(t),n.innerBind(i=>e.innerBind(r=>t.innerBind(s=>m6(i,r,s))))),a1=function(n){const e=function(t,i){const r=xn(t).fmap(s=>Array.isArray(s)?[...s,n]:[s,1,n]);return i?i.distort(r):$s({}).distort(r)};return pn.prototype[n]=function(t){return e(t,this)},e},rqe=a1("soft"),sqe=a1("hard"),aqe=a1("cubic"),oqe=a1("diode"),lqe=a1("asym"),uqe=a1("fold"),cqe=a1("sinefold"),hqe=a1("chebyshev"),g6=n=>{let e=$s(ur((...t)=>t,null,n.length));for(const t of n)e=e.appBoth(xn(t));return e},PL=n=>Array.isArray(n)?g6(n):xn(n);pn.prototype.partials=function(n){return this.withValue(e=>t=>({...e,partials:t})).appLeft(PL(n))};const dqe=n=>PL(n).as("partials");pn.prototype.phases=function(n){return this.withValue(e=>t=>({...e,phases:t})).appLeft(PL(n))};const fqe=n=>PL(n).as("phases");pn.prototype.FX=function(...n){return n=n.map(xn),this.withValue(e=>t=>{const i=e.FX??[];return{...e,FX:i.concat(t)}}).appLeft(g6(n))};const pqe=n=>{let e=$s(ur((...t)=>t,null,n.length));for(const t of n)e=e.appLeft(t);return e};pn.prototype.worklet=function(n,...e){return e=e.map(xn),this.outerBind(t=>pqe(e).withValue(i=>{const r=t.workletInputs??[];return{...t,workletSrc:n,workletInputs:r.concat(i)}}))};const mqe=(...n)=>$s({}).worklet(...n);function DL(n){let e=Array.isArray(n);n=e?n:[n];const t=n[0],i=s=>{let a;if(typeof s=="object"&&s.value!==void 0&&(a={...s},s=s.value,delete a.value),e&&Array.isArray(s)){const o=a||{};return s.forEach((l,u)=>{u<n.length&&(o[n[u]]=l)}),o}else return a?(a[t]=s,a):{[t]:s}},r=function(s,a){return a?typeof s>"u"?a.fmap(i):a.set(xn(s).withValue(i)):xn(s).withValue(i)};return pn.prototype[t]=function(s){return r(s,this)},r}const vE=new Map;function kce(n){return vE.has(n)}function we(n,...e){const t=Array.isArray(n)?n[0]:n;let i={};return i[t]=DL(n),vE.set(t,t),e.forEach(r=>{i[r]=i[t],vE.set(r,t),pn.prototype[r]=pn.prototype[t]}),i}function Um(n,e,...t){n=Array.isArray(n)?n:[n];let i={};for(let r=1;r<=e;r++){let s=[...t],a=[...n];if(r===1){const l=s.map(c=>`${c}1`),u=a.map(c=>`${c}1`);s=s.concat(l).concat(u)}else s=s.map(l=>`${l}${r}`),a=a.map(l=>`${l}${r}`);const o=we(a,...s);i={...i,...o}}return i}const{s:zce,sound:Vce}=we(["s","n","gain"],"sound"),{wt:Hce,wavetablePosition:Xce}=we("wt","wavetablePosition"),{wtenv:Wce}=we("wtenv"),{wtattack:Zce,wtatt:jce}=we("wtattack","wtatt"),{wtdecay:Yce,wtdec:Kce}=we("wtdecay","wtdec"),{wtsustain:$ce,wtsus:Jce}=we("wtsustain","wtsus"),{wtrelease:qce,wtrel:Qce}=we("wtrelease","wtrel"),{wtrate:ehe}=we("wtrate"),{wtsync:the}=we("wtsync"),{wtdepth:nhe}=we("wtdepth"),{wtshape:ihe}=we("wtshape"),{wtdc:rhe}=we("wtdc"),{wtskew:she}=we("wtskew"),{warp:ahe,wavetableWarp:ohe}=we("warp","wavetableWarp"),{warpattack:lhe,warpatt:uhe}=we("warpattack","warpatt"),{warpdecay:che,warpdec:hhe}=we("warpdecay","warpdec"),{warpsustain:dhe,warpsus:fhe}=we("warpsustain","warpsus"),{warprelease:phe,warprel:mhe}=we("warprelease","warprel"),{warprate:ghe}=we("warprate"),{warpdepth:yhe}=we("warpdepth"),{warpshape:vhe}=we("warpshape"),{warpdc:xhe}=we("warpdc"),{warpskew:bhe}=we("warpskew"),{warpmode:_he,wavetableWarpMode:She}=we("warpmode","wavetableWarpMode"),{wtphaserand:Mhe,wavetablePhaseRand:Ahe}=we("wtphaserand","wavetablePhaseRand"),{warpenv:The}=we("warpenv"),{warpsync:Che}=we("warpsync"),{source:whe,src:Ehe}=we("source","src"),{n:Rhe}=we("n"),{note:Phe}=we(["note","n"]),{accelerate:Dhe}=we("accelerate"),{velocity:Nhe,vel:Bhe}=we("velocity","vel"),{gain:Fhe}=we("gain"),{postgain:Lhe}=we("postgain"),{amp:Ihe}=we("amp"),{attack:Ghe,att:Ohe}=we("attack","att"),{fmh:Uhe,fmh1:khe,fmh2:zhe,fmh3:Vhe,fmh4:Hhe,fmh5:Xhe,fmh6:Whe,fmh7:Zhe,fmh8:jhe}=Um(["fmh","fmi"],8,"fmh"),{fmi:Yhe,fmi1:Khe,fmi2:$he,fmi3:Jhe,fmi4:qhe,fmi5:Qhe,fmi6:ede,fmi7:tde,fmi8:nde,fm:ide,fm1:rde,fm2:sde,fm3:ade,fm4:ode,fm5:lde,fm6:ude,fm7:cde,fm8:hde}=Um(["fmi","fmh"],8,"fm"),{fmenv:dde,fmenv1:fde,fmenv2:pde,fmenv3:mde,fmenv4:gde,fmenv5:yde,fmenv6:vde,fmenv7:xde,fmenv8:bde}=Um("fmenv",8),{fmattack:_de,fmattack1:Sde,fmattack2:Mde,fmattack3:Ade,fmattack4:Tde,fmattack5:Cde,fmattack6:wde,fmattack7:Ede,fmattack8:Rde,fmatt:Pde,fmatt1:Dde,fmatt2:Nde,fmatt3:Bde,fmatt4:Fde,fmatt5:Lde,fmatt6:Ide,fmatt7:Gde,fmatt8:Ode}=Um("fmattack",8,"fmatt"),{fmwave:Ude,fmwave1:kde,fmwave2:zde,fmwave3:Vde,fmwave4:Hde,fmwave5:Xde,fmwave6:Wde,fmwave7:Zde,fmwave8:jde}=Um("fmwave",8),{fmdecay:Yde,fmdecay1:Kde,fmdecay2:$de,fmdecay3:Jde,fmdecay4:qde,fmdecay5:Qde,fmdecay6:efe,fmdecay7:tfe,fmdecay8:nfe,fmdec:ife,fmdec1:rfe,fmdec2:sfe,fmdec3:afe,fmdec4:ofe,fmdec5:lfe,fmdec6:ufe,fmdec7:cfe,fmdec8:hfe}=Um("fmdecay",8,"fmdec"),{fmsustain:dfe,fmsustain1:ffe,fmsustain2:pfe,fmsustain3:mfe,fmsustain4:gfe,fmsustain5:yfe,fmsustain6:vfe,fmsustain7:xfe,fmsustain8:bfe,fmsus:_fe,fmsus1:Sfe,fmsus2:Mfe,fmsus3:Afe,fmsus4:Tfe,fmsus5:Cfe,fmsus6:wfe,fmsus7:Efe,fmsus8:Rfe}=Um("fmsustain",8,"fmsus"),{fmrelease:Pfe,fmrelease1:Dfe,fmrelease2:Nfe,fmrelease3:Bfe,fmrelease4:Ffe,fmrelease5:Lfe,fmrelease6:Ife,fmrelease7:Gfe,fmrelease8:Ofe,fmrel:Ufe,fmrel1:kfe,fmrel2:zfe,fmrel3:Vfe,fmrel4:Hfe,fmrel5:Xfe,fmrel6:Wfe,fmrel7:Zfe,fmrel8:jfe}=Um("fmrelease",8,"fmrel");for(let n=0;n<=8;n++)for(let e=0;e<=8;e++)we(`fmi${n}${e}`,`fm${n}${e}`);const{bank:Yfe}=we("bank"),{chorus:Kfe}=we("chorus"),{analyze:$fe}=we("analyze"),{fft:Jfe}=we("fft"),{decay:qfe,dec:Qfe}=we("decay","dec"),{sustain:epe,sus:tpe}=we("sustain","sus"),{release:npe,rel:ipe}=we("release","rel"),{hold:rpe}=we("hold"),{bandf:spe,bpf:ape,bp:ope}=we(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:lpe,bpq:upe}=we("bandq","bpq"),{begin:cpe}=we("begin"),{end:hpe}=we("end"),{loop:dpe}=we("loop"),{loopBegin:fpe,loopb:ppe}=we("loopBegin","loopb"),{loopEnd:mpe,loope:gpe}=we("loopEnd","loope"),{crush:ype}=we("crush"),{coarse:vpe}=we("coarse"),{tremolo:xpe,trem:bpe}=we(["tremolo","tremolodepth","tremoloskew","tremolophase"],"trem"),{tremolosync:_pe}=we(["tremolosync","tremolodepth","tremoloskew","tremolophase"],"tremsync"),{tremolodepth:Spe}=we("tremolodepth","tremdepth"),{tremoloskew:Mpe}=we("tremoloskew","tremskew"),{tremolophase:Ape}=we("tremolophase","tremphase"),{tremoloshape:Tpe}=we("tremoloshape","tremshape"),{drive:Cpe}=we("drive"),{duck:wpe}=we("duckorbit","duck"),{duckdepth:Epe}=we("duckdepth"),{duckonset:Rpe}=we("duckonset","duckons"),{duckattack:Ppe}=we("duckattack","duckatt"),{byteBeatExpression:Dpe,bbexpr:Npe}=we("byteBeatExpression","bbexpr"),{byteBeatStartTime:Bpe,bbst:Fpe}=we("byteBeatStartTime","bbst"),{channels:Lpe,ch:Ipe}=we("channels","ch"),{pw:Gpe}=we(["pw","pwrate","pwsweep"]),{pwrate:Ope}=we("pwrate"),{pwsweep:Upe}=we("pwsweep"),{phaserrate:kpe,ph:zpe,phaser:Vpe}=we(["phaserrate","phaserdepth","phasercenter","phasersweep"],"ph","phaser"),{phasersweep:Hpe,phs:Xpe}=we("phasersweep","phs"),{phasercenter:Wpe,phc:Zpe}=we("phasercenter","phc"),{phaserdepth:jpe,phd:Ype,phasdp:Kpe}=we("phaserdepth","phd","phasdp"),{channel:$pe}=we("channel"),{cut:Jpe}=we("cut"),{cutoff:qpe,ctf:Qpe,lpf:eme,lp:tme}=we(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:nme,lpe:ime}=we("lpenv","lpe"),{hpenv:rme,hpe:sme}=we("hpenv","hpe"),{bpenv:ame,bpe:ome}=we("bpenv","bpe"),{lpattack:lme,lpa:ume}=we("lpattack","lpa"),{hpattack:cme,hpa:hme}=we("hpattack","hpa"),{bpattack:dme,bpa:fme}=we("bpattack","bpa"),{lpdecay:pme,lpd:mme}=we("lpdecay","lpd"),{hpdecay:gme,hpd:yme}=we("hpdecay","hpd"),{bpdecay:vme,bpd:xme}=we("bpdecay","bpd"),{lpsustain:bme,lps:_me}=we("lpsustain","lps"),{hpsustain:Sme,hps:Mme}=we("hpsustain","hps"),{bpsustain:Ame,bps:Tme}=we("bpsustain","bps"),{lprelease:Cme,lpr:wme}=we("lprelease","lpr"),{hprelease:Eme,hpr:Rme}=we("hprelease","hpr"),{bprelease:Pme,bpr:Dme}=we("bprelease","bpr"),{ftype:Nme}=we("ftype"),{fanchor:Bme}=we("fanchor"),{lprate:Fme}=we("lprate"),{lpsync:Lme}=we("lpsync"),{lpdepth:Ime}=we("lpdepth"),{lpdepthfrequency:Gme,lpdepthfreq:Ome}=we("lpdepthfrequency","lpdepthfreq"),{lpshape:Ume}=we("lpshape"),{lpdc:kme}=we("lpdc"),{lpskew:zme}=we("lpskew"),{bprate:Vme}=we("bprate"),{bpsync:Hme}=we("bpsync"),{bpdepth:Xme}=we("bpdepth"),{bpdepthfrequency:Wme,bpdepthfreq:Zme}=we("bpdepthfrequency","bpdepthfreq"),{bpshape:jme}=we("bpshape"),{bpdc:Yme}=we("bpdc"),{bpskew:Kme}=we("bpskew"),{hprate:$me}=we("hprate"),{hpsync:Jme}=we("hpsync"),{hpdepth:qme}=we("hpdepth"),{hpdepthfrequency:Qme,hpdepthfreq:ege}=we("hpdepthfrequency","hpdepthfreq"),{hpshape:tge}=we("hpshape"),{hpdc:nge}=we("hpdc"),{hpskew:ige}=we("hpskew"),{vib:rge,vibrato:sge,v:age}=we(["vib","vibmod"],"vibrato","v"),{noise:oge}=we("noise"),{vibmod:lge,vmod:uge}=we(["vibmod","vib"],"vmod"),{hcutoff:cge,hpf:hge,hp:dge}=we(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:fge,hpq:pge}=we("hresonance","hpq"),{resonance:mge,lpq:gge}=we("resonance","lpq"),{djf:yge}=we("djf"),{delay:vge}=we(["delay","delaytime","delayfeedback"]),{delayfeedback:xge,delayfb:bge,dfb:_ge}=we("delayfeedback","delayfb","dfb"),{delayspeed:Sge}=we("delayspeed"),{delaytime:Mge,delayt:Age,dt:Tge}=we("delaytime","delayt","dt"),{delaysync:Cge}=we("delaysync"),{lock:wge}=we("lock"),{detune:Ege,det:Rge}=we("detune","det"),{unison:Pge}=we("unison"),{spread:Dge}=we("spread"),{dry:Nge}=we("dry"),{fadeTime:Bge,fadeOutTime:Fge}=we("fadeTime","fadeOutTime"),{fadeInTime:Lge}=we("fadeInTime"),{freq:Ige}=we("freq"),{pattack:Gge,patt:Oge}=we("pattack","patt"),{pdecay:Uge,pdec:kge}=we("pdecay","pdec"),{psustain:zge,psus:Vge}=we("psustain","psus"),{prelease:Hge,prel:Xge}=we("prelease","prel"),{penv:Wge}=we("penv"),{pcurve:Zge}=we("pcurve"),{panchor:jge}=we("panchor"),{gate:Yge,gat:Kge}=we("gate","gat"),{leslie:$ge}=we("leslie"),{lrate:Jge}=we("lrate"),{lsize:qge}=we("lsize"),{activeLabel:Qge}=we("activeLabel"),{label:e0e}=we(["label","activeLabel"]),{degree:t0e}=we("degree"),{mtranspose:n0e}=we("mtranspose"),{ctranspose:i0e}=we("ctranspose"),{harmonic:r0e}=we("harmonic"),{stepsPerOctave:s0e}=we("stepsPerOctave"),{octaveR:a0e}=we("octaveR"),{nudge:o0e}=we("nudge"),{octave:l0e,oct:u0e}=we("octave","oct"),{orbit:c0e}=we("orbit","o"),{bus:h0e}=we("bus"),{busgain:d0e,bgain:f0e}=we("busgain","bgain"),{overgain:p0e}=we("overgain"),{overshape:m0e}=we("overshape"),{pan:g0e}=we("pan"),{panspan:y0e}=we("panspan"),{pansplay:v0e}=we("pansplay"),{panwidth:x0e}=we("panwidth"),{panorient:b0e}=we("panorient"),{slide:_0e}=we("slide"),{semitone:S0e}=we("semitone"),{voice:M0e}=we("voice"),{chord:A0e}=we("chord"),{dictionary:T0e,dict:C0e}=we("dictionary","dict"),{anchor:w0e}=we("anchor"),{offset:E0e}=we("offset"),{octaves:R0e}=we("octaves"),{mode:P0e}=we(["mode","anchor"]),{room:D0e}=we(["room","size"]),{roomlp:N0e,rlp:B0e}=we("roomlp","rlp"),{roomdim:F0e,rdim:L0e}=we("roomdim","rdim"),{roomfade:I0e,rfade:G0e}=we("roomfade","rfade"),{ir:O0e,iresponse:U0e}=we(["ir","i"],"iresponse"),{irspeed:k0e}=we("irspeed"),{irbegin:z0e}=we("irbegin"),{roomsize:V0e,size:H0e,sz:X0e,rsize:W0e}=we("roomsize","size","sz","rsize"),{shape:Z0e}=we(["shape","shapevol"]),{distort:j0e,dist:Y0e}=we(["distort","distortvol","distorttype"],"dist"),{distortvol:K0e}=we("distortvol","distvol"),{distorttype:$0e}=we("distorttype","disttype"),{compressor:J0e}=we(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:q0e}=we("compressorKnee"),{compressorRatio:Q0e}=we("compressorRatio"),{compressorAttack:eye}=we("compressorAttack"),{compressorRelease:tye}=we("compressorRelease"),{speed:y6}=we("speed"),{stretch:nye}=we("stretch"),{unit:iye}=we("unit"),{squiz:rye}=we("squiz"),{vowel:sye}=we("vowel"),{waveloss:aye}=we("waveloss"),{density:gqe}=we("density"),{expression:oye}=we("expression"),{sustainpedal:lye}=we("sustainpedal"),{fshift:uye}=we("fshift"),{fshiftnote:cye}=we("fshiftnote"),{fshiftphase:hye}=we("fshiftphase"),{triode:dye}=we("triode"),{krush:fye}=we("krush"),{kcutoff:pye}=we("kcutoff"),{octer:mye}=we("octer"),{octersub:gye}=we("octersub"),{octersubsub:yye}=we("octersubsub"),{ring:vye}=we("ring"),{ringf:xye}=we("ringf"),{ringdf:bye}=we("ringdf"),{freeze:_ye}=we("freeze"),{xsdelay:Sye}=we("xsdelay"),{tsdelay:Mye}=we("tsdelay"),{real:Aye}=we("real"),{imag:Tye}=we("imag"),{enhance:Cye}=we("enhance"),{comb:wye}=we("comb"),{smear:Eye}=we("smear"),{scram:Rye}=we("scram"),{binshift:Pye}=we("binshift"),{hbrick:Dye}=we("hbrick"),{lbrick:Nye}=we("lbrick"),{frameRate:Bye}=we("frameRate"),{frames:Fye}=we("frames"),{hours:Lye}=we("hours"),{minutes:Iye}=we("minutes"),{seconds:Gye}=we("seconds"),{songPtr:Oye}=we("songPtr"),{uid:Uye}=we("uid"),{val:kye}=we("val"),{cps:zye}=we("cps"),{clip:Vye,legato:Hye}=we("clip","legato"),{duration:Xye,dur:Wye}=we("duration","dur"),{zrand:Zye}=we("zrand"),{curve:jye}=we("curve"),{deltaSlide:Yye}=we("deltaSlide"),{pitchJump:Kye}=we("pitchJump"),{pitchJumpTime:$ye}=we("pitchJumpTime"),{znoise:Jye}=we("znoise"),{zmod:qye}=we("zmod"),{zcrush:Qye}=we("zcrush"),{zdelay:eve}=we("zdelay"),{zzfx:tve}=we("zzfx"),{color:nve,colour:ive}=we(["color","colour"]);let v6=(...n)=>n.reduce((e,t)=>Object.assign(e,{[t]:DL(t)}),{});const rve=Nt("adsr",(n,e)=>{n=Array.isArray(n)?n:[n];const[t,i,r,s]=n;return e.set({attack:t,decay:i,sustain:r,release:s})}),sve=Nt("ad",(n,e)=>{n=Array.isArray(n)?n:[n];const[t,i=t]=n;return e.attack(t).decay(i)}),ave=Nt("ds",(n,e)=>{n=Array.isArray(n)?n:[n];const[t,i=0]=n;return e.set({decay:t,sustain:i})}),ove=Nt("ar",(n,e)=>{n=Array.isArray(n)?n:[n];const[t,i=t]=n;return e.set({attack:t,release:i})}),{midichan:lve}=we("midichan"),{midimap:uve}=we("midimap"),{midiport:cve}=we("midiport"),{midicmd:hve}=we("midicmd"),dve=Nt("control",(n,e)=>{if(!Array.isArray(n))throw new Error("control expects an array of [ccn, ccv]");const[t,i]=n;return e.ccn(t).ccv(i)}),{ccn:fve}=we("ccn"),{ccv:pve}=we("ccv"),{ctlNum:mve}=we("ctlNum"),{nrpnn:gve}=we("nrpnn"),{nrpv:yve}=we("nrpv"),{progNum:vve}=we("progNum"),xve=Nt("sysex",(n,e)=>{if(!Array.isArray(n))throw new Error("sysex expects an array of [id, data]");const[t,i]=n;return e.sysexid(t).sysexdata(i)}),{sysexid:bve}=we("sysexid"),{sysexdata:_ve}=we("sysexdata"),{midibend:Sve}=we("midibend"),{miditouch:Mve}=we("miditouch"),{polyTouch:Ave}=we("polyTouch"),{oschost:Tve}=we("oschost"),{oscport:Cve}=we("oscport"),xE=n=>vE.has(n)?vE.get(n):n,wve=Nt("as",(n,e)=>(n=Array.isArray(n)?n:[n],e.fmap(t=>{t=Array.isArray(t)?t:[t];const i=[];for(let r=0;r<n.length;++r)t[r]!==void 0&&i.push([xE(n[r]),t[r]]);return Object.fromEntries(i)}))),Eve=Nt("scrub",(n,e)=>n.outerBind(t=>{Array.isArray(t)||(t=[t]);const[i,r=1]=t;return e.begin(i).mul(y6(r)).clip(1)}),!1),nz=new Map,yqe=(n,e,...t)=>{const i=nz.get(n)??new Map,r=new Set([e,...t]);for(const s of r)i.set(String(s).toLowerCase(),e);nz.set(n,i)},x6=(n,e=[])=>{for(const[t,...i]of e)yqe(n,t,...i)},vqe=(n,e)=>{const t=nz.get(n);return t?t.get(String(e).toLowerCase())??e:e};x6("lfo",[["control","c"],["subControl","sc"],["rate","r"],["depth","dep","dr"],["depthabs","da"],["dcoffset","dc"],["shape","sh"],["skew","sk"],["curve","cu"],["sync","s"],["fxi"]]);x6("env",[["control","c"],["subControl","sc"],["attack","att","a"],["decay","dec","d"],["sustain","sus","s"],["release","rel","r"],["depth","dep","dr"],["depthabs","da"],["acurve","ac"],["dcurve","dc"],["rcurve","rc"],["fxi"]]);x6("bmod",[["bus","b"],["control","c"],["subControl","sc"],["depth","dep","dr"],["depthabs","da"],["dc"],["fxi"]]);pn.prototype.modulate=function(n,e,t){e={control:void 0,...e};const i=["lfo","env","bmod"];if(!i.includes(n))return Cl(`[core] Modulation type ${n} not found. Please use one of 'lfo', 'env', 'bmod'`),this;let r=this,s;r=r.fmap(a=>o=>({v:a,id:o})).appLeft(xn(t));for(const[a,o]of Object.entries(e)){const l=vqe(n,a),u=xn(o);r=r.fmap(({v:c,id:d})=>f=>{if(s===void 0){let y=xE(Object.keys(c).at(-1));i.includes(y)&&(y=`${y}_${[...c[y].__ids].at(-1)}`),s=y}c[n]??={__ids:new Set};const m=c[n];return d??=m.__ids.size,m[d]??={control:s},m.__ids.add(d),f===void 0?{v:c,id:d}:(l==="control"||l==="subControl"?m[d][l]=xE(f):m[d][l]=f,{v:c,id:d})}).appLeft(u)}return r.fmap(({v:a})=>a)};pn.prototype.lfo=function(n,e){return this.modulate("lfo",n,e)};const Rve=n=>$s({}).lfo(n);pn.prototype.env=function(n,e){return this.modulate("env",n,e)};const Pve=n=>$s({}).env(n);pn.prototype.bmod=function(n,e){return this.modulate("bmod",n,e)};const Dve=n=>$s({}).bmod(n),{transient:Nve}=we(["transient","transsustain"]),{FXrelease:Bve,FXrel:Fve,FXr:Lve,fxr:Ive}=we("FXrelease","FXrel","FXr","fxr"),xqe=Object.freeze(Object.defineProperty({__proto__:null,FXr:Lve,FXrel:Fve,FXrelease:Bve,accelerate:Dhe,activeLabel:Qge,ad:sve,adsr:rve,amp:Ihe,analyze:$fe,anchor:w0e,ar:ove,as:wve,att:Ohe,attack:Ghe,bandf:spe,bandq:lpe,bank:Yfe,bbexpr:Npe,bbst:Fpe,begin:cpe,bgain:f0e,binshift:Pye,bmod:Dve,bp:ope,bpa:fme,bpattack:dme,bpd:xme,bpdc:Yme,bpdecay:vme,bpdepth:Xme,bpdepthfreq:Zme,bpdepthfrequency:Wme,bpe:ome,bpenv:ame,bpf:ape,bpq:upe,bpr:Dme,bprate:Vme,bprelease:Pme,bps:Tme,bpshape:jme,bpskew:Kme,bpsustain:Ame,bpsync:Hme,bus:h0e,busgain:d0e,byteBeatExpression:Dpe,byteBeatStartTime:Bpe,ccn:fve,ccv:pve,ch:Ipe,channel:$pe,channels:Lpe,chord:A0e,chorus:Kfe,clip:Vye,coarse:vpe,color:nve,colour:ive,comb:wye,compressor:J0e,compressorAttack:eye,compressorKnee:q0e,compressorRatio:Q0e,compressorRelease:tye,control:dve,cps:zye,createParam:DL,createParams:v6,crush:ype,ctf:Qpe,ctlNum:mve,ctranspose:i0e,curve:jye,cut:Jpe,cutoff:qpe,dec:Qfe,decay:qfe,degree:t0e,delay:vge,delayfb:bge,delayfeedback:xge,delayspeed:Sge,delaysync:Cge,delayt:Age,delaytime:Mge,deltaSlide:Yye,density:gqe,det:Rge,detune:Ege,dfb:_ge,dict:C0e,dictionary:T0e,dist:Y0e,distort:j0e,distorttype:$0e,distortvol:K0e,djf:yge,drive:Cpe,dry:Nge,ds:ave,dt:Tge,duck:wpe,duckattack:Ppe,duckdepth:Epe,duckonset:Rpe,dur:Wye,duration:Xye,end:hpe,enhance:Cye,env:Pve,expression:oye,fadeInTime:Lge,fadeOutTime:Fge,fadeTime:Bge,fanchor:Bme,fft:Jfe,fm:ide,fm1:rde,fm2:sde,fm3:ade,fm4:ode,fm5:lde,fm6:ude,fm7:cde,fm8:hde,fmatt:Pde,fmatt1:Dde,fmatt2:Nde,fmatt3:Bde,fmatt4:Fde,fmatt5:Lde,fmatt6:Ide,fmatt7:Gde,fmatt8:Ode,fmattack:_de,fmattack1:Sde,fmattack2:Mde,fmattack3:Ade,fmattack4:Tde,fmattack5:Cde,fmattack6:wde,fmattack7:Ede,fmattack8:Rde,fmdec:ife,fmdec1:rfe,fmdec2:sfe,fmdec3:afe,fmdec4:ofe,fmdec5:lfe,fmdec6:ufe,fmdec7:cfe,fmdec8:hfe,fmdecay:Yde,fmdecay1:Kde,fmdecay2:$de,fmdecay3:Jde,fmdecay4:qde,fmdecay5:Qde,fmdecay6:efe,fmdecay7:tfe,fmdecay8:nfe,fmenv:dde,fmenv1:fde,fmenv2:pde,fmenv3:mde,fmenv4:gde,fmenv5:yde,fmenv6:vde,fmenv7:xde,fmenv8:bde,fmh:Uhe,fmh1:khe,fmh2:zhe,fmh3:Vhe,fmh4:Hhe,fmh5:Xhe,fmh6:Whe,fmh7:Zhe,fmh8:jhe,fmi:Yhe,fmi1:Khe,fmi2:$he,fmi3:Jhe,fmi4:qhe,fmi5:Qhe,fmi6:ede,fmi7:tde,fmi8:nde,fmrel:Ufe,fmrel1:kfe,fmrel2:zfe,fmrel3:Vfe,fmrel4:Hfe,fmrel5:Xfe,fmrel6:Wfe,fmrel7:Zfe,fmrel8:jfe,fmrelease:Pfe,fmrelease1:Dfe,fmrelease2:Nfe,fmrelease3:Bfe,fmrelease4:Ffe,fmrelease5:Lfe,fmrelease6:Ife,fmrelease7:Gfe,fmrelease8:Ofe,fmsus:_fe,fmsus1:Sfe,fmsus2:Mfe,fmsus3:Afe,fmsus4:Tfe,fmsus5:Cfe,fmsus6:wfe,fmsus7:Efe,fmsus8:Rfe,fmsustain:dfe,fmsustain1:ffe,fmsustain2:pfe,fmsustain3:mfe,fmsustain4:gfe,fmsustain5:yfe,fmsustain6:vfe,fmsustain7:xfe,fmsustain8:bfe,fmwave:Ude,fmwave1:kde,fmwave2:zde,fmwave3:Vde,fmwave4:Hde,fmwave5:Xde,fmwave6:Wde,fmwave7:Zde,fmwave8:jde,frameRate:Bye,frames:Fye,freeze:_ye,freq:Ige,fshift:uye,fshiftnote:cye,fshiftphase:hye,ftype:Nme,fxr:Ive,gain:Fhe,gat:Kge,gate:Yge,getControlName:xE,harmonic:r0e,hbrick:Dye,hcutoff:cge,hold:rpe,hours:Lye,hp:dge,hpa:hme,hpattack:cme,hpd:yme,hpdc:nge,hpdecay:gme,hpdepth:qme,hpdepthfreq:ege,hpdepthfrequency:Qme,hpe:sme,hpenv:rme,hpf:hge,hpq:pge,hpr:Rme,hprate:$me,hprelease:Eme,hps:Mme,hpshape:tge,hpskew:ige,hpsustain:Sme,hpsync:Jme,hresonance:fge,imag:Tye,ir:O0e,irbegin:z0e,iresponse:U0e,irspeed:k0e,isControlName:kce,kcutoff:pye,krush:fye,label:e0e,lbrick:Nye,legato:Hye,leslie:$ge,lfo:Rve,lock:wge,loop:dpe,loopBegin:fpe,loopEnd:mpe,loopb:ppe,loope:gpe,lp:tme,lpa:ume,lpattack:lme,lpd:mme,lpdc:kme,lpdecay:pme,lpdepth:Ime,lpdepthfreq:Ome,lpdepthfrequency:Gme,lpe:ime,lpenv:nme,lpf:eme,lpq:gge,lpr:wme,lprate:Fme,lprelease:Cme,lps:_me,lpshape:Ume,lpskew:zme,lpsustain:bme,lpsync:Lme,lrate:Jge,lsize:qge,midibend:Sve,midichan:lve,midicmd:hve,midimap:uve,midiport:cve,miditouch:Mve,minutes:Iye,mode:P0e,mtranspose:n0e,n:Rhe,noise:oge,note:Phe,nrpnn:gve,nrpv:yve,nudge:o0e,oct:u0e,octave:l0e,octaveR:a0e,octaves:R0e,octer:mye,octersub:gye,octersubsub:yye,offset:E0e,orbit:c0e,oschost:Tve,oscport:Cve,overgain:p0e,overshape:m0e,pan:g0e,panchor:jge,panorient:b0e,panspan:y0e,pansplay:v0e,panwidth:x0e,patt:Oge,pattack:Gge,pcurve:Zge,pdec:kge,pdecay:Uge,penv:Wge,ph:zpe,phasdp:Kpe,phaser:Vpe,phasercenter:Wpe,phaserdepth:jpe,phaserrate:kpe,phasersweep:Hpe,phc:Zpe,phd:Ype,phs:Xpe,pitchJump:Kye,pitchJumpTime:$ye,polyTouch:Ave,postgain:Lhe,prel:Xge,prelease:Hge,progNum:vve,psus:Vge,psustain:zge,pw:Gpe,pwrate:Ope,pwsweep:Upe,rdim:L0e,real:Aye,registerControl:we,registerMultiControl:Um,rel:ipe,release:npe,resonance:mge,rfade:G0e,ring:vye,ringdf:bye,ringf:xye,rlp:B0e,room:D0e,roomdim:F0e,roomfade:I0e,roomlp:N0e,roomsize:V0e,rsize:W0e,s:zce,scram:Rye,scrub:Eve,seconds:Gye,semitone:S0e,shape:Z0e,size:H0e,slide:_0e,smear:Eye,songPtr:Oye,sound:Vce,source:whe,speed:y6,spread:Dge,squiz:rye,src:Ehe,stepsPerOctave:s0e,stretch:nye,sus:tpe,sustain:epe,sustainpedal:lye,sysex:xve,sysexdata:_ve,sysexid:bve,sz:X0e,transient:Nve,trem:bpe,tremolo:xpe,tremolodepth:Spe,tremolophase:Ape,tremoloshape:Tpe,tremoloskew:Mpe,tremolosync:_pe,triode:dye,tsdelay:Mye,uid:Uye,unison:Pge,unit:iye,v:age,val:kye,vel:Bhe,velocity:Nhe,vib:rge,vibmod:lge,vibrato:sge,vmod:uge,voice:M0e,vowel:sye,warp:ahe,warpatt:uhe,warpattack:lhe,warpdc:xhe,warpdec:hhe,warpdecay:che,warpdepth:yhe,warpenv:The,warpmode:_he,warprate:ghe,warprel:mhe,warprelease:phe,warpshape:vhe,warpskew:bhe,warpsus:fhe,warpsustain:dhe,warpsync:Che,waveloss:aye,wavetablePhaseRand:Ahe,wavetablePosition:Xce,wavetableWarp:ohe,wavetableWarpMode:She,wt:Hce,wtatt:jce,wtattack:Zce,wtdc:rhe,wtdec:Kce,wtdecay:Yce,wtdepth:nhe,wtenv:Wce,wtphaserand:Mhe,wtrate:ehe,wtrel:Qce,wtrelease:qce,wtshape:ihe,wtskew:she,wtsus:Jce,wtsustain:$ce,wtsync:the,xsdelay:Sye,zcrush:Qye,zdelay:eve,zmod:qye,znoise:Jye,zrand:Zye,zzfx:tve},Symbol.toStringTag,{value:"Module"})),bqe=function(n,e){const[t,i]=n,[r,s]=e,[a,o]=a6(i,r);return[[i,t-i],[wL((l,u)=>l.concat(u),a,s),o]]},_qe=function(n,e){const[t,i]=n,[r,s]=e,[a,o]=a6(t,s);return[[t,i-t],[wL((l,u)=>l.concat(u),r,a),o]]},Gve=function(n,e){const[t,i]=n;return Math.min(t,i)<=1?[n,e]:Gve(...t>i?bqe(n,e):_qe(n,e))},b6=function(n,e){const t=n<0,i=Math.abs(n),r=e-i,s=Array(i).fill([1]),a=Array(r).fill([0]),o=Gve([i,r],[s,a]),l=Kg(o[1][0]).concat(Kg(o[1][1]));return t?l.map(u=>1-u):l},NL=function(n,e,t){const i=b6(n,e);return t?tce(i,-t):i},Sqe=Nt("euclid",function(n,e,t){return t.struct(NL(n,e,0))}),Mqe=Nt("bjork",function(n,e){Array.isArray(n)||(n=[n]);const[t,i=t,r=0]=n;return e.struct(NL(t,i,r))}),{euclidrot:Aqe,euclidRot:Tqe}=Nt(["euclidrot","euclidRot"],function(n,e,t,i){return i.struct(NL(n,e,t))}),Ove=function(n,e,t,i){if(n<1)return ws;const r=NL(n,e,0).join("").split("1").slice(1).map(s=>[s.length+1,!0]);return i.struct(p6(...r)).late(Sn(t).div(e))},Cqe=Nt(["euclidLegato"],function(n,e,t){return Ove(n,e,0,t)}),wqe=Nt(["euclidLegatoRot"],function(n,e,t,i){return Ove(n,e,t,i)}),{euclidish:Eqe,eish:Rqe}=Nt(["euclidish","eish"],function(n,e,t,i){const r=m6(b6(n,e),new Array(n).fill(1),t);return i.struct(r).setSteps(e)});function Uve(n,e,t=.05,i=.1,r=.1,s=globalThis.setInterval,a=globalThis.clearInterval,o=!0){let l=0,u=0,c=10**4,d=.01;const f=b=>t=b(t);r=r||i/2;const m=()=>{const b=n(),M=b+i+r;for(u===0&&(u=b+d);u<M;)u=o?Math.round(u*c)/c:u,e(u,t,l,b),u+=t,l++};let y;const _=()=>{S(),m(),y=s(m,i*1e3)},S=()=>{y!==void 0&&a(y),y=void 0};return{setDuration:f,start:_,stop:()=>{l=0,u=0,S()},pause:()=>S(),duration:t,interval:i,getPhase:()=>u,minLatency:d}}class kve{constructor({interval:e,onTrigger:t,onToggle:i,onError:r,getTime:s,latency:a=.1,setInterval:o,clearInterval:l,beforeStart:u}){this.started=!1,this.beforeStart=u,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=s,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=i,this.latency=a,this.clock=Uve(s,(c,d,f,m)=>{this.num_ticks_since_cps_change===0&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=c),this.num_ticks_since_cps_change++;const y=this.num_ticks_since_cps_change*d*this.cps;try{const _=this.lastEnd;this.lastBegin=_;const S=this.num_cycles_at_cps_change+y;if(this.lastEnd=S,this.lastTick=c,c<m){console.log("skip query: too late");return}this.pattern.queryArc(_,S,{_cps:this.cps,cyclist:"cyclist"}).forEach(b=>{if(b.hasOnset()){const M=(b.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+a,w=b.duration/this.cps,T=M-c;t?.(b,T,w,this.cps,M),b.value.cps!==void 0&&this.cps!=b.value.cps&&(this.cps=b.value.cps,this.num_ticks_since_cps_change=0)}})}catch(_){JR(_),r?.(_)}},e,.1,.1,o,l)}now(){if(!this.started)return 0;const e=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+e*this.cps}setStarted(e){this.started=e,this.onToggle?.(e)}async start(){if(await this.beforeStart?.(),this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");Cl("[cyclist] start"),this.clock.start(),this.setStarted(!0)}pause(){Cl("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){Cl("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}async setPattern(e,t=!1){this.pattern=e,t&&!this.started&&await this.start()}setCps(e=.5){this.cps!==e&&(this.cps=e,this.num_ticks_since_cps_change=0)}log(e,t,i){const r=i.filter(s=>s.hasOnset());console.log(`${e.toFixed(4)} - ${t.toFixed(4)} ${Array(r.length).fill("I").join("")}`)}}let nw={};const zve=function(){Vve()},Vve=function(){nw={}},Pqe=Nt("timeline",function(n,e){n=xn(n);const t=function(i){const r=!!i.controls.cyclist,s=n.query(i),a=[];for(const o of s){const l=o.value;let u;if(l===0)u=0;else if(l in nw)u=nw[l];else{const d=o.wholeOrPart();!r||i.span.begin.lt(d.midpoint())?u=d.begin:u=d.end}r&&(nw[l]=u,l!==0&&delete nw[-l]);const c=e.late(u).query(i.setSpan(o.part)).map(d=>d.setContext(d.combineContext(o)));a.push(...c)}return a};return new pn(t,e._steps)},!1),km=function(n,e,t=!0){const i=Array.isArray(n),r=Object.keys(n).length;return n=lce(n,xn),r===0?ws:e.fmap(s=>{let a=s;return i&&(a=t?Math.round(a)%r:EL(Math.round(a),0,n.length-1)),n[a]})},Hve=function(n,e){return Array.isArray(e)&&([e,n]=[n,e]),Dqe(n,e)},Dqe=Nt("pick",function(n,e){return km(n,e,!1).innerJoin()}),Xve=Nt("pickmod",function(n,e){return km(n,e,!0).innerJoin()}),Nqe=Nt("pickF",function(n,e,t){return t.apply(Hve(n,e))}),Bqe=Nt("pickmodF",function(n,e,t){return t.apply(Xve(n,e))}),Fqe=Nt("pickOut",function(n,e){return km(n,e,!1).outerJoin()}),Lqe=Nt("pickmodOut",function(n,e){return km(n,e,!0).outerJoin()}),Iqe=Nt("pickRestart",function(n,e){return km(n,e,!1).restartJoin()}),Gqe=Nt("pickmodRestart",function(n,e){return km(n,e,!0).restartJoin()}),Oqe=Nt("pickReset",function(n,e){return km(n,e,!1).resetJoin()}),Uqe=Nt("pickmodReset",function(n,e){return km(n,e,!0).resetJoin()}),{inhabit:kqe,pickSqueeze:zqe}=Nt(["inhabit","pickSqueeze"],function(n,e){return km(n,e,!1).squeezeJoin()}),{inhabitmod:Vqe,pickmodSqueeze:Hqe}=Nt(["inhabitmod","pickmodSqueeze"],function(n,e){return km(n,e,!0).squeezeJoin()}),Xqe=(n,e)=>(e=e.map(xn),e.length==0?ws:n.fmap(t=>{const i=zd(Math.round(t),e.length);return e[i]}).squeezeJoin());class Wqe{constructor({onTrigger:e,onToggle:t,getTime:i}){this.started=!1,this.cps=.5,this.getTime=i,this.time_at_last_tick_message=0,this.collator=new uce({getTargetClockTime:i}),this.onToggle=t,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker=new SharedWorker(new URL(""+new URL("data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIEwoKXtyZXR1cm4gcGVyZm9ybWFuY2Uubm93KCkqLjAwMX1sZXQgXz0wLHI9MCxvPS41O2NvbnN0IGg9bmV3IE1hcCxtPS4xLE09bmV3IEJyb2FkY2FzdENoYW5uZWwoInN0cnVkZWx0aWNrIiksYj0ocyxlKT0+e00ucG9zdE1lc3NhZ2Uoe3R5cGU6cyxwYXlsb2FkOmV9KX0sQz1FKEwsKHMsZSx0LG4pPT57Y29uc3QgaT1yKmUsZD1zLW4sYz1uK2QsdT1pKm8sbD1fK3UsZz1uLWMtZSxmPWUqbyxwPWwrZix5PWwrZypvO2IoInRpY2siLHtiZWdpbjpsLGVuZDpwLGNwczpvLHRpbWU6bixjeWNsZTp5fSkscisrfSxtKTtsZXQgaz0hMTtjb25zdCBJPXM9PntoLnNldChzLHtzdGFydGVkOiEwfSksIWsmJihDLnN0YXJ0KCksaz0hMCl9LEE9YXN5bmMgcz0+e2guc2V0KHMse3N0YXJ0ZWQ6ITF9KTtjb25zdCBlPUFycmF5LmZyb20oaC52YWx1ZXMoKSkuc29tZSh0PT50LnN0YXJ0ZWQpOyFrfHxlfHwoQy5zdG9wKCksdygwKSxrPSExKX0sdz1zPT57cj0wLF89c30sRD1zPT57Y29uc3R7dHlwZTplLHBheWxvYWQ6dH09cztzd2l0Y2goZSl7Y2FzZSJjcHNjaGFuZ2UiOntpZih0LmNwcyE9PW8pe2NvbnN0IG49ciptO189XytuKm8sbz10LmNwcyxyPTB9YnJlYWt9Y2FzZSJzZXRjeWNsZSI6e3codC5jeWNsZSk7YnJlYWt9Y2FzZSJ0b2dnbGUiOnt0LnN0YXJ0ZWQ/SShzLmlkKTpBKHMuaWQpO2JyZWFrfX19O3NlbGYub25jb25uZWN0PWZ1bmN0aW9uKHMpe2NvbnN0IGU9cy5wb3J0c1swXTtlLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLGZ1bmN0aW9uKHQpe0QodC5kYXRhKX0pLGUuc3RhcnQoKX07ZnVuY3Rpb24gRShzLGUsdD0uMDUsbj0uMSxpPS4xKXtsZXQgZD0wLGM9MCx1PTEwKio0LGw9LjAxO2NvbnN0IGc9YT0+dD1hKHQpO2k9aXx8bi8yO2NvbnN0IGY9KCk9Pntjb25zdCBhPXMoKSxPPWErbitpO2ZvcihjPT09MCYmKGM9YStsKTtjPE87KWM9TWF0aC5yb3VuZChjKnUpL3UsYz49YSYmZShjLHQsZCxhKSxjPGEmJmNvbnNvbGUubG9nKCJUT08gTEFURSIsYyksYys9dCxkKyt9O2xldCBwO2NvbnN0IHk9KCk9PntUKCksZigpLHA9c2V0SW50ZXJ2YWwoZixuKjFlMyl9LFQ9KCk9PnAhPT12b2lkIDAmJmNsZWFySW50ZXJ2YWwocCk7cmV0dXJue3NldER1cmF0aW9uOmcsc3RhcnQ6eSxzdG9wOigpPT57ZD0wLGM9MCxUKCl9LHBhdXNlOigpPT5UKCksZHVyYXRpb246dCxpbnRlcnZhbDpuLGdldFBoYXNlOigpPT5jLG1pbkxhdGVuY3k6bH19fSkoKTsK",import.meta.url).href,import.meta.url)),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");const r=a=>{const{cps:o,begin:l,end:u,cycle:c,time:d}=a;this.cps=o,this.cycle=c;const f=this.collator.calculateOffset(d)+d;s(l,u,f),this.time_at_last_tick_message=f},s=(a,o,l)=>{this.started!==!1&&this.pattern.queryArc(a,o,{_cps:this.cps,cyclist:"neocyclist"}).forEach(u=>{if(u.hasOnset()){const c=Jk(u.whole.begin-this.cycle,this.cps)+l+this.latency,d=Jk(u.duration,this.cps);e?.(u,0,d,this.cps,c)}})};this.channel.onmessage=a=>{if(!this.started)return;const{payload:o,type:l}=a.data;l==="tick"&&r(o)}}sendMessage(e,t){this.worker.port.postMessage({type:e,payload:t,id:this.id})}now(){const e=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+e}setCps(e=1){this.sendMessage("cpschange",{cps:e})}setCycle(e){this.sendMessage("setcycle",{cycle:e})}setStarted(e){this.sendMessage("toggle",{started:e}),this.started=e,this.onToggle?.(e)}start(){Cl("[cyclist] start"),this.setStarted(!0)}stop(){Cl("[cyclist] stop"),this.collator.reset(),this.setStarted(!1)}setPattern(e,t=!1){this.pattern=e,t&&!this.started&&this.start()}log(e,t,i){const r=i.filter(s=>s.hasOnset());console.log(`${e.toFixed(4)} - ${t.toFixed(4)} ${Array(r.length).fill("I").join("")}`)}}let iz,Wve,Zve,jve,Yve;function rz(){if(!iz)throw new Error("no time set! use setTime to define a time source");return iz()}function o2(n){iz=n}function Kve(n){Wve=n}function Zqe(){return Wve?.()}function $ve(n){Zve=n}function jqe(){return Zve}function Jve(n){jve=n}function Yqe(){return jve}function qve(n){Yve=!!n}function Kqe(){return Yve}function sz(n,e){if(e||(e="assertion failed"),!n)throw new Error(e)}let zr=class{constructor(n,e){this.type=n,e!==void 0&&(this.value=e),this.ins=[]}static parseInput(n,e){if(typeof n=="function"){if(!e)throw new Error("tried to parse function input without without passing node..");return n(e)}return typeof n=="object"?n:typeof n=="number"&&!isNaN(n)||typeof n=="string"?$d(n):(console.log(`invalid input type "${typeof n}" for node of type "${e.type}", falling back to 0. The input was:`,n),0)}};const PM=(n,e)=>new zr(n,e);let Au=new Map;const Fy="poly",az="exit";zr.prototype.inherit=function(n){return n.inputOf&&(this.inputOf=n.inputOf),n.outputOf&&(this.outputOf=n.outputOf),this};zr.prototype.toObject=function(){return JSON.parse(JSON.stringify(this))};zr.prototype.stringify=function(){return JSON.stringify(this,null,2).replaceAll('"',"'")};function Qve(n,...e){let t=1;if(e=e.map(r=>{if(Array.isArray(r)){if(r.length===1)return r[0];r=new zr(Fy).withIns(...r)}if(typeof r=="function"){const s=r(new zr("peek"));s.type===Fy&&(t=Math.max(s.ins.length,t))}return r.type===Fy&&(t=Math.max(r.ins.length,t)),r}),t===1){const r=PM(n);return r.withIns(...e.map(s=>zr.parseInput(s,r)))}if(n===az){const r=e.map(s=>s.type===Fy?s.ins.map(a=>zr.parseInput(a).inherit(a)):s).flat();return PM(az).withIns(...r)}const i=Array.from({length:t},(r,s)=>{const a=new zr(n),o=e.map(l=>l.type===Fy?zr.parseInput(l.ins[s%l.ins.length],a).inherit(l):(l=zr.parseInput(l,a),l.type===Fy&&(l=l.ins[s]),l));return a.withIns(...o)});return new zr(Fy).withIns(...i)}function $qe(n,e){const t=Au.get(n);return t?.ins?.[e]?t.ins[e].name:""}let Xn=(n,e)=>Rl(n,(...t)=>Qve(n,...t),e);Au.set("register",{tags:["meta"],graph:!1,description:"Registers a new Node function. Sets it on the prototype + returns the function itself. Like `module` but doesn't hide complexity in graph viz.",examples:[`let kick = register('kick', gate => gate.adsr(0,.11,0,.11)
.apply(env => env.mul(env)
  .mul(158)
  .sine(env)
  .distort(.85)
))
impulse(2).kick().out()`]});let Rl=(n,e,t)=>(t&&Au.set(n,t),zr.prototype[n]=function(...i){return e(this,...i)},zr.prototype["_"+n]=function(){return this},e);Au.set("module",{tags:["meta"],graph:!0,description:"Creates a module. Like `register`, but the graph viz will hide the internal complexity of the module.",examples:[`let kick = module('kick', gate => gate.adsr(0,.11,0,.11)
.apply(env => env.mul(env)
  .mul(158)
  .sine(env)
  .distort(.85)
))
impulse(2).kick().out()`]});let Jqe=0;function Lh(n,e,t){return Rl(n,(...i)=>{const r=Jqe++;return i=i.map((s,a)=>zr.parseInput(s).asModuleInput?.(n,r,a)),e(...i).asModuleOutput?.(n,r)},t)}Au.set("n",{tags:["math"],description:"Constant value node. Turns a number into a Node.",ins:[{name:"value",default:0}]});function $d(n){return Array.isArray(n)?poly(...n.map(e=>$d(e))):typeof n=="object"?n:PM("n",n)}Au.set("out",{tags:["meta"],description:"Sends the node to the audio output"});Au.set("withIns",{internal:!0,tags:["innards"],description:"Sets the inputs of a node. Returns the node itself",ins:[{name:"in",dynamic:!0}]});zr.prototype.withIns=function(...n){return this.ins=n,this};Au.set("flatten",{internal:!0,tags:["innards"],description:"Flattens the node to a list of all nodes in the graph, where each Node's ins are now indices"});zr.prototype.flatten=function(){return Qqe(this)};Au.set("apply",{graph:!0,tags:["meta"],description:"Applies the given function to the Node. Useful when a node has to be used multiple times.",examples:[`impulse(4)
.apply(imp=>imp
  .seq(110,220,330,440)
  .sine()
  .mul( imp.ad(.1,.1) )
).out()`]});zr.prototype.apply=function(n){return n(this)};Au.set("clone",{internal:!0,tags:["innards"],description:"Clones the node"});zr.prototype.clone=function(){return new zr(this.type,this.value).withIns(...this.ins)};Au.set("map",{tags:["meta"],description:"Applies the given function to all ins if it's poly node. Otherwise it applies the function to itself.",examples:[`n([110,220,330])
.map( freq=>freq.mul([1,1.007]).saw().mix() )
.mix(2).mul(.5).out()`]});zr.prototype.map=function(n){return this.type!=="poly"?n(this):poly(...this.ins.map(n))};zr.prototype.channel=function(n){return this.type!=="poly"?this:this.ins[n%this.ins.length]};Au.set("select",{tags:["meta"],graph:!0,description:"Find the first occurence of the given type up in the graph and returns the match. Useful to exit a feedback loop at another point.",examples:[`sine(220).mul(impulse(1).ad(.001,.2))
.add( x=>x.delay(.2).mul(.8) )
.select('delay').out()
`]});zr.prototype.select=function(n){for(let e of this.ins){if(e.type===n)return e;const t=e.select(n);if(t)return t}};Au.set("debug",{tags:["meta"],description:"Logs the node to the console"});zr.prototype.debug=function(n=e=>e){return console.log(n(this)),this};function qqe(n){const e=modules.get(n),t=Array.from({length:e.length},(r,s)=>PM(`$INPUT${s}`)),i=e(...t);return JSON.stringify(i,null,2)}function Qqe(n){const e=[];return _6(n,t=>(e.push(t),t)),e.map(t=>{let i={...t,type:t.type,ins:t.ins.map(r=>e.indexOf(r)+"")};return t.value!==void 0&&(i.value=t.value),t.to!==void 0&&(i.to=e.indexOf(t.to)),i})}let e1e=Xn("exit",{internal:!0});function t1e(n,e){let t=[];const i=Rl("out",function(r,s=[0,1]){return t.push(r.output(s)),r});return e?(e.out=i,Function(...Object.keys(e),n)(...Object.values(e))):(globalThis.out=i,Function(n)()),e1e(...t)}zr.prototype.over=function(n){return this.apply(e=>add(e,n(e)))};zr.prototype.dfs=function(n,e){return this.apply(t=>_6(t,n,e))};zr.prototype.apply2=function(n){return n(this,this)};let _6=(n,e,t=[])=>(n=e(n,t),t.push(n),n.ins=n.ins.map(i=>t.includes(i)?i:_6(i,e,t)),n);zr.prototype.asModuleInput=function(n,e,t){return this.inputOf=this.inputOf||[],this.inputOf.push([n,e,t]),this};zr.prototype.asModuleOutput=function(n,e){return this.outputOf=[n,e],this};function S6(n,e={}){const{log:t=!1,lang:i="js",fallbackType:r="thru",constType:s="n",getRegister:a=y=>`r[${y}]`,getOutput:o=y=>`o[${y}]`,getSource:l=y=>`s[${y}]`}=e;t&&console.log("compile",n);const u=eQe(n);let c=[],d=y=>u[y].type!==s?a(y):typeof u[y].value=="string"?`"${u[y].value}"`:u[y].value;const f=[];for(let y in u){const _=u[y],S=u[y].ins.map(T=>d(u.indexOf(T))),b=f.length;let M=Au.get(_.type);M||(console.warn(`unhandled node type "${u[y].type}". falling back to "${r}"`),M=Au.get(r));const w={vars:S,node:_,nodes:u,id:y,ugenIndex:b,ugen:M.ugen,name:d(y),lang:i,getRegister:a,getOutput:o,getSource:l};M.compile&&c.push(M.compile(w)),M.ugen&&f.push({type:M.ugen,inputs:S})}const m=c.join(`
`);return t&&(console.log("compiled code:"),console.log(m)),{src:m,ugens:f,registers:u.length}}zr.prototype.compile=function(n){return S6(this,n)};function eQe(n){const e=[],t=new Set;function i(r){if(!(typeof r!="object"||t.has(r))){t.add(r);for(let s in r.ins)i(r.ins[s]);e.push(r)}}return i(n),e}const zK=Object.freeze(Object.defineProperty({__proto__:null,compile:S6},Symbol.toStringTag,{value:"Module"}));class n1e{constructor(){this._events={}}on(e,t){this._events[e]||(this._events[e]=[]);let i=this._events[e];sz(i.indexOf(t)==-1),i.push(t)}removeListener(e,t){let i=this._events[e],r=i.indexOf(t);r!=-1&&i.splice(r,1)}trigger(e,...t){let i=this._events[e]||[];for(let r=0;r<i.length;r++)i[r].apply(null,t)}}class tQe extends n1e{constructor(e=navigator){super(),this.midiAccess=null,this.getMIDIAccess(e)}async getMIDIAccess(e){if("requestMIDIAccess"in e){this.midiAccess=await e.requestMIDIAccess({sysex:!1}),console.log("got MIDI access");for(let t of this.midiAccess.inputs.values())t.state=="connected"&&(t.onmidimessage=i=>this.trigger("midimessage",t.id,i.data));this.midiAccess.onstatechange=t=>{t.port.type=="input"&&t.port.state=="connected"&&(console.log("MIDI device connected:",t.port.name,"PORT:",t.port.id),t.port.onmidimessage=i=>this.trigger("midimessage",t.port.id,i.data))}}}broadcast(e,t){if(midi)for(let i of this.midiAccess.outputs.values())i.send(e,t)}}function nQe(n){let e=n[0]&240,t=(n[0]&15)+1;if(e==176&&n.length==3){let i=n[1],r=n[2]/127*2-1;return{type:"CC",channel:t,cc:i,value:r}}if(e==224&&n.length==3){let i=n[1],r=(n[2]<<7|i)/16383*2-1;return{type:"PITCHBEND",channel:t,value:r}}if(e==144&&n.length==3){let i=n[1],r=n[2]/127;return{type:"NOTE_ON",channel:t,note:i,velocity:r}}if(e==128&&n.length==3){let i=n[1];return{type:"NOTE_ON",channel:t,note:i,velocity:0}}}class iQe extends n1e{constructor(){super(),this.attach()}attach(){typeof window<"u"&&(this.handleMouseMove=e=>{const t=e.clientX/document.body.clientWidth*2-1,i=e.clientY/document.body.clientHeight*2-1;this.trigger("move",t,i)},document.addEventListener("mousemove",this.handleMouseMove))}detach(){typeof window<"u"&&document.removeEventListener("mousemove",this.handleMouseMove)}}const rQe="data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGcoaCx0KXtpZih0fHwodD0iYXNzZXJ0aW9uIGZhaWxlZCIpLCFoKXRocm93IG5ldyBFcnJvcih0KX1mdW5jdGlvbiBTKGgsdCxzKXtyZXR1cm4gaDw9MD90Omg+PTE/czp0K2gqKHMtdCl9ZnVuY3Rpb24gUChoLHQscyl7cmV0dXJuIGg8PXQ/MDpoPj1zPzE6cz09PXQ/MDooaC10KS8ocy10KX1mdW5jdGlvbiBFKGgsdCl7cmV0dXJuIGg8dD8oaC89dCxoK2gtaCpoLTEpOmg+MS10PyhoPShoLTEpL3QsaCpoK2graCsxKTowfWZ1bmN0aW9uIFUoaCl7cmV0dXJuIE1hdGguZmxvb3IoaCk9PT1ofWZ1bmN0aW9uIF8oaCl7cmV0dXJuIFUoaCkmJmg+MH1mdW5jdGlvbiBrKGgsdCl7dD1NYXRoLm1pbihNYXRoLm1heCh0LDApLDEpLHQtPS4wMTt2YXIgcz0yKnQvKDEtdCksZT0oMStzKSpoLygxK3MqTWF0aC5hYnMoaCkpO3JldHVybiBlfWZ1bmN0aW9uIHcoaCx0LHMpe3JldHVybiBoPj0xP3M6dCtoKihzLXQpfWZ1bmN0aW9uIFQoKXt0aGlzLnN0YXRlPSJvZmYiLHRoaXMuc3RhcnRUaW1lPTAsdGhpcy5zdGFydFZhbD0wfVQucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oaCx0LHMsZSxpLG4pe3N3aXRjaCh0aGlzLnN0YXRlKXtjYXNlIm9mZiI6cmV0dXJuIHQ+MCYmKHRoaXMuc3RhdGU9ImF0dGFjayIsdGhpcy5zdGFydFRpbWU9aCx0aGlzLnN0YXJ0VmFsPTApLDA7Y2FzZSJhdHRhY2siOntsZXQgcj1oLXRoaXMuc3RhcnRUaW1lO3JldHVybiByPnM/KHRoaXMuc3RhdGU9ImRlY2F5Iix0aGlzLnN0YXJ0VGltZT1oLDEpOncoci9zLHRoaXMuc3RhcnRWYWwsMSl9Y2FzZSJkZWNheSI6e2xldCByPWgtdGhpcy5zdGFydFRpbWUsbD13KHIvZSwxLGkpO3JldHVybiB0PD0wPyh0aGlzLnN0YXRlPSJyZWxlYXNlIix0aGlzLnN0YXJ0VGltZT1oLHRoaXMuc3RhcnRWYWw9bCxsKTpyPmU/KHRoaXMuc3RhdGU9InN1c3RhaW4iLHRoaXMuc3RhcnRUaW1lPWgsaSk6bH1jYXNlInN1c3RhaW4iOnJldHVybiB0PD0wJiYodGhpcy5zdGF0ZT0icmVsZWFzZSIsdGhpcy5zdGFydFRpbWU9aCx0aGlzLnN0YXJ0VmFsPWkpLGk7Y2FzZSJyZWxlYXNlIjp7bGV0IHI9aC10aGlzLnN0YXJ0VGltZTtpZihyPm4pcmV0dXJuIHRoaXMuc3RhdGU9Im9mZiIsMDtsZXQgbD13KHIvbix0aGlzLnN0YXJ0VmFsLDApO3JldHVybiB0PjAmJih0aGlzLnN0YXRlPSJhdHRhY2siLHRoaXMuc3RhcnRUaW1lPWgsdGhpcy5zdGFydFZhbD1sKSxsfX10aHJvdyJpbnZhbGlkIGVudmVsb3BlIHN0YXRlIn07ZnVuY3Rpb24gdigpe3RoaXMuczA9MCx0aGlzLnMxPTB9di5wcm90b3R5cGUuYXBwbHk9ZnVuY3Rpb24oaCx0LHMpe2coIWlzTmFOKGgpLCJOYU4gdmFsdWUgZmVkIGluIFR3b1BvbGVGaWx0ZXIiKSx0PU1hdGgubWluKHQsMSkscz1NYXRoLm1heChzLDApO3ZhciBlPU1hdGgucG93KC41LCgxLXQpLy4xMjUpLGk9TWF0aC5wb3coLjUsKHMrLjEyNSkvLjEyNSksbj0xLWkqZSxyPXRoaXMuczAsbD10aGlzLnMxO3JldHVybiByPW4qci1lKmwrZSpoLGw9bipsK2UqcixoPWwsdGhpcy5zMD1yLHRoaXMuczE9bCxofTtsZXQgQT1jbGFzcyBDe2NvbnN0cnVjdG9yKHQscyl7dGhpcy5zYW1wbGVSYXRlPXQscz90aGlzLmJ1ZmZlcj1zLnNsaWNlKDApOih0aGlzLmJ1ZmZlcj1uZXcgRmxvYXQzMkFycmF5KDEwKnQpLHRoaXMuYnVmZmVyLmZpbGwoMCkpLHRoaXMud3JpdGVJZHg9MCx0aGlzLnJlYWRJZHg9MH1yZXNldCgpe3RoaXMuYnVmZmVyLmZpbGwoMCksdGhpcy53cml0ZUlkeD0wLHRoaXMucmVhZElkeD0wfWNsb25lKCl7Y29uc3QgdD1uZXcgQyh0aGlzLnNhbXBsZVJhdGUsdGhpcy5idWZmZXIpO3JldHVybiB0LndyaXRlSWR4PXRoaXMud3JpdGVJZHgsdC5yZWFkSWR4PXRoaXMucmVhZElkeCx0fXdyaXRlKHQscyl7dGhpcy53cml0ZUlkeD0odGhpcy53cml0ZUlkeCsxKSV0aGlzLmJ1ZmZlci5sZW5ndGgsdGhpcy5idWZmZXJbdGhpcy53cml0ZUlkeF09dDtsZXQgZT1NYXRoLm1pbihNYXRoLmZsb29yKHRoaXMuc2FtcGxlUmF0ZSpzKSx0aGlzLmJ1ZmZlci5sZW5ndGgtMSk7dGhpcy5yZWFkSWR4PXRoaXMud3JpdGVJZHgtZSx0aGlzLnJlYWRJZHg8MCYmKHRoaXMucmVhZElkeCs9dGhpcy5idWZmZXIubGVuZ3RoKX1yZWFkKCl7cmV0dXJuIHRoaXMuYnVmZmVyW3RoaXMucmVhZElkeF19fTtjb25zdCB5PTEvNDhlMyxNPTI0LE49TS80O2NsYXNzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7dGhpcy5ub2RlSWQ9dCx0aGlzLnN0YXRlPXMsdGhpcy5zYW1wbGVSYXRlPWUsdGhpcy5zYW1wbGVUaW1lPTEvZSx0aGlzLnNlbmQ9aX19Y2xhc3MgcSBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5lbnY9bmV3IFR9dXBkYXRlKHQscyxlLGksbixyKXtyZXR1cm4gdGhpcy5lbnYuZXZhbCh0LHMsZSxpLG4scil9fWNsYXNzIEYgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMucGhhc2U9MH11cGRhdGUodCl7bGV0IHM9TSp0LzYwLGU9LjU7cmV0dXJuIHRoaXMucGhhc2UrPXRoaXMuc2FtcGxlVGltZSpzLHRoaXMucGhhc2UlMTxlPzE6LTF9fWNsYXNzIEQgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMuaW5TZ249ITAsdGhpcy5vdXRTZ249ITAsdGhpcy5jbG9ja0NudD0wfXVwZGF0ZSh0LHMpe2xldCBlPXQ+MDtyZXR1cm4gdGhpcy5pblNnbiE9ZSYmKHRoaXMuY2xvY2tDbnQrKyx0aGlzLmNsb2NrQ250Pj1zJiYodGhpcy5jbG9ja0NudD0wLHRoaXMub3V0U2duPSF0aGlzLm91dFNnbikpLHRoaXMuaW5TZ249ZSx0aGlzLm91dFNnbj8xOi0xfX1jbGFzcyBMIGV4dGVuZHMgb3tjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLmluU2duPSExfXVwZGF0ZSh0LHMpe2xldCBlPXM+MDtyZXR1cm4gZSYmdGhpcy5pblNnbiE9ZSYmdGhpcy5zZW5kKHt0eXBlOiJDTE9DS19QVUxTRSIsbm9kZUlkOnRoaXMubm9kZUlkLHRpbWU6dH0pLHRoaXMuaW5TZ249ZSwwfX1jb25zdCBPPW5ldyBNYXA7Y2xhc3MgViBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSk7Y29uc3Qgbj1zLmlucHV0c1syXTtuJiZPLmhhcyhuKT90aGlzLmRlbGF5PU8uZ2V0KG4pLmNsb25lKCk6dGhpcy5kZWxheT1uZXcgQShlKSxuJiZPLnNldChuLHRoaXMuZGVsYXkpfXVwZGF0ZSh0LHMpe3JldHVybiB0aGlzLmRlbGF5LndyaXRlKHQscyksdGhpcy5kZWxheS5yZWFkKCl9fWNsYXNzIEcgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpfXVwZGF0ZSh0LHMpe3JldHVybiBrKHQscyl9fWNsYXNzIFIgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMudmFsdWU9MCx0aGlzLnRyaWdTZ249ITF9d3JpdGUodCxzKXshdGhpcy50cmlnU2duJiZzPjAmJih0aGlzLnZhbHVlPXQpLHRoaXMudHJpZ1Nnbj1zPjB9cmVhZCgpe3JldHVybiB0aGlzLnZhbHVlfXVwZGF0ZSh0LHMpe3JldHVybiB0aGlzLndyaXRlKHQscyksdGhpcy5yZWFkKCl9fWNsYXNzIEJ7Y29uc3RydWN0b3IoKXt0aGlzLnZhbHVlPTB9dXBkYXRlKHQpe3JldHVybiB0aGlzLnZhbHVlPXQsdGhpcy52YWx1ZX19Y29uc3QgJD0zNDA7bGV0IEk9MDtjbGFzcyBIe2NvbnN0cnVjdG9yKCl7dGhpcy5jaD1JLHRoaXMuc3RhcnRfc2VlZD0kKih0aGlzLmNoKzEpPj4+MCx0aGlzLnN0YXRlPXRoaXMuc3RhcnRfc2VlZCx0aGlzLnZhbHVlPTAsdGhpcy5hPTE2NjQ1MjUsdGhpcy5jPTEwMTM5MDQyMjMsdGhpcy5tYXNrPTE2Nzc3MjE1LHRoaXMuc2NhbGU9MS8oMTw8MjQpLEkrK311cGRhdGUodCxzKXtpZighdClyZXR1cm4gdGhpcy52YWx1ZTtzJiYodGhpcy5zdGF0ZT10aGlzLnN0YXJ0X3NlZWQpLHRoaXMuc3RhdGU9dGhpcy5zdGF0ZSp0aGlzLmErdGhpcy5jPj4+MDtjb25zdCBlPSh0aGlzLnN0YXRlJnRoaXMubWFzaykqdGhpcy5zY2FsZTtyZXR1cm4gdGhpcy52YWx1ZT1lKjItMSx0aGlzLnZhbHVlfX1jbGFzcyBqe2NvbnN0cnVjdG9yKCl7dGhpcy52YWx1ZT1NYXRoLnJhbmRvbSgpKjItMX11cGRhdGUodCl7cmV0dXJuIHQ/KHRoaXMudmFsdWU9TWF0aC5yYW5kb20oKSoyLTEsdGhpcy52YWx1ZSk6dGhpcy52YWx1ZX19Y2xhc3MgS3t1cGRhdGUodCl7cmV0dXJuIE1hdGgucmFuZG9tKCk8dCp5P01hdGgucmFuZG9tKCk6MH19Y2xhc3MgV3tjb25zdHJ1Y3Rvcigpe3RoaXMub3V0PTB9dXBkYXRlKCl7bGV0IHQ9TWF0aC5yYW5kb20oKSoyLTE7cmV0dXJuIHRoaXMub3V0PSh0aGlzLm91dCsuMDIqdCkvMS4wMix0aGlzLm91dH19Y2xhc3MgWHtjb25zdHJ1Y3Rvcigpe3RoaXMuYjA9MCx0aGlzLmIxPTAsdGhpcy5iMj0wLHRoaXMuYjM9MCx0aGlzLmI0PTAsdGhpcy5iNT0wLHRoaXMuYjY9MH11cGRhdGUoKXtjb25zdCB0PU1hdGgucmFuZG9tKCkqMi0xO3RoaXMuYjA9Ljk5ODg2KnRoaXMuYjArdCouMDU1NTE3OSx0aGlzLmIxPS45OTMzMip0aGlzLmIxK3QqLjA3NTA3NTksdGhpcy5iMj0uOTY5KnRoaXMuYjIrdCouMTUzODUyLHRoaXMuYjM9Ljg2NjUqdGhpcy5iMyt0Ki4zMTA0ODU2LHRoaXMuYjQ9LjU1KnRoaXMuYjQrdCouNTMyOTUyMix0aGlzLmI1PS0uNzYxNip0aGlzLmI1LXQqLjAxNjg5ODtjb25zdCBzPXRoaXMuYjArdGhpcy5iMSt0aGlzLmIyK3RoaXMuYjMrdGhpcy5iNCt0aGlzLmI1K3RoaXMuYjYrdCouNTM2MjtyZXR1cm4gdGhpcy5iNj10Ki4xMTU5MjYscyouMTF9fWNsYXNzIFkgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMucGhhc2U9MX11cGRhdGUodCl7dGhpcy5waGFzZSs9dGhpcy5zYW1wbGVUaW1lKnQ7bGV0IHM9dGhpcy5waGFzZT49MT8xOjA7cmV0dXJuIHRoaXMucGhhc2U9dGhpcy5waGFzZSUxLHN9fWNsYXNzIHogZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMucGhhc2U9MH11cGRhdGUodCxzKXtyZXR1cm4gdGhpcy5waGFzZSs9dGhpcy5zYW1wbGVUaW1lKnQsdGhpcy5waGFzZSUxPHM/MTotMX19Y2xhc3MgWiBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5waGFzZT0wfXVwZGF0ZSh0KXtyZXR1cm4gdGhpcy5waGFzZSs9dGhpcy5zYW1wbGVUaW1lKnQsdGhpcy5waGFzZSUxKjItMX19Y2xhc3MgSntjb25zdHJ1Y3Rvcigpe3RoaXMucGhhc2U9TWF0aC5yYW5kb20oKX11cGRhdGUodCl7Y29uc3Qgcz10L3NhbXBsZVJhdGU7bGV0IGU9RSh0aGlzLnBoYXNlLHMpLGk9Mip0aGlzLnBoYXNlLTEtZTtyZXR1cm4gdGhpcy5waGFzZSs9cyx0aGlzLnBoYXNlPjEmJih0aGlzLnBoYXNlLT0xKSxpfX1jbGFzcyBRIGV4dGVuZHMgb3tjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLnBoYXNlPTAsdGhpcy5zeW5jU2duPSExfXVwZGF0ZSh0LHMsZSl7IXRoaXMuc3luY1NnbiYmcz4wJiYodGhpcy5waGFzZT0wKSx0aGlzLnN5bmNTZ249cz4wO2xldCBpPSh0aGlzLnBoYXNlK2UpJTE7cmV0dXJuIHRoaXMucGhhc2UrPXRoaXMuc2FtcGxlVGltZSp0LE1hdGguc2luKGkqMipNYXRoLlBJKX19Y2xhc3MgdHR7ZEJUb0xpbmVhcih0KXtyZXR1cm4gTWF0aC5wb3coMTAsdC8yMCl9bGluZWFyVG9EQih0KXtyZXR1cm4gMjAqTWF0aC5sb2cxMCh0KX11cGRhdGUodCxzLGUpe2xldCBpPXRoaXMubGluZWFyVG9EQihNYXRoLmFicyh0KSksbj0wO3JldHVybiBpPnMmJihuPShpLXMpKigxLTEvZSkpLHRoaXMuZEJUb0xpbmVhcigtbil9fWNsYXNzIHN0IGV4dGVuZHMgb3tjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLnBoYXNlPTB9dXBkYXRlKHQpe3RoaXMucGhhc2UrPXRoaXMuc2FtcGxlVGltZSp0O2xldCBzPXRoaXMucGhhc2UlMTtyZXR1cm4oczwuNT8yKnM6MS0yKihzLS41KSkqMi0xfX1jbGFzcyBldCBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSk7Y29uc3Qgbj1lLzMwO2coXyhuKSksdGhpcy5idWZmZXI9bmV3IEZsb2F0MzJBcnJheShuKSx0aGlzLndyaXRlUG9zPTB9dXBkYXRlKHQscyxlLGkpe3JldHVybiB0aGlzLmJ1ZmZlclt0aGlzLndyaXRlUG9zXT10LHRoaXMud3JpdGVQb3MrKyx0aGlzLndyaXRlUG9zJXRoaXMuYnVmZmVyLmxlbmd0aD09MCYmKHRoaXMud3JpdGVQb3M9MCx0aGlzLnNlbmQoe3R5cGU6IlNFTkRfU0FNUExFUyIsaWQ6cyxzYW1wbGVzOnRoaXMuYnVmZmVyLGNoYW5uZWxzOmUsY2hhbm5lbDppfSkpLHR9fWNsYXNzIGl0e2NvbnN0cnVjdG9yKCl7dGhpcy5sYWdVbml0PTQ0MTAsdGhpcy5zPTB9dXBkYXRlKHQscyl7cmV0dXJuIHM9cyp0aGlzLmxhZ1VuaXQsczwxJiYocz0xKSx0aGlzLnMrPTEvcyoodC10aGlzLnMpLHRoaXMuc319Y2xhc3MgaHR7Y29uc3RydWN0b3IoKXt0aGlzLmxhc3Q9MH11cGRhdGUodCxzLGUpe2NvbnN0IGk9cyp5LG49ZSp5O2xldCByPXQtdGhpcy5sYXN0O3JldHVybiByPmk/cj1pOnI8LW4mJihyPS1uKSx0aGlzLmxhc3QrPXIsdGhpcy5sYXN0fX1jbGFzcyBhdCBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5zPTB9dXBkYXRlKHQscyl7cmV0dXJuIHM9cyoxZTMsczwxJiYocz0xKSx0aGlzLnMrPTEvcyoodC10aGlzLnMpLHRoaXMuc319Y2xhc3MgbnQgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMuZmlsdGVyPW5ldyB2fXVwZGF0ZSh0LHMsZSl7cmV0dXJuIHRoaXMuZmlsdGVyLmFwcGx5KHQscyxlKSx0aGlzLmZpbHRlci5zMX19Y2xhc3MgcnQgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMuZmlsdGVyPW5ldyB2fXVwZGF0ZSh0LHMsZSl7cmV0dXJuIHRoaXMuZmlsdGVyLmFwcGx5KHQscyxlKSx0aGlzLmZpbHRlci5zMH19Y2xhc3MgdXQgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpfXVwZGF0ZSh0LHMpe3JldHVybiBzPDAmJihzPTApLHM9cysxLHQ9dCpzLDQqKE1hdGguYWJzKC4yNSp0Ky4yNS1NYXRoLnJvdW5kKC4yNSp0Ky4yNSkpLS4yNSl9fWNsYXNzIGx0IGV4dGVuZHMgb3t1cGRhdGUodCl7cmV0dXJuIHR9fWNsYXNzIG0gZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMubm90ZT0wLHRoaXMuZnJlcT0wLHRoaXMudmVsb2NpdHk9MCx0aGlzLmdhdGVTdGF0ZT0ib2ZmIix0aGlzLnR5cGU9Im1pZGlpbiIsdGhpcy5jaGFubmVsPS0xfWlzRnJlZSgpe3JldHVybiB0aGlzLmdhdGVTdGF0ZT09PSJvZmYifW5vdGVPbih0LHMpe3M+MD8odGhpcy5ub3RlPXQsdGhpcy52ZWxvY2l0eT1zLHRoaXMuZnJlcT0yKiooKHQtNjkpLzEyKSo0NDAsdGhpcy5nYXRlU3RhdGU9InByZXRyaWciKTp0aGlzLm5vdGVPZmYoKX1ub3RlT2ZmKCl7dGhpcy5ub3RlPTAsdGhpcy5nYXRlU3RhdGU9Im9mZiJ9Z2V0R2F0ZSgpe3N3aXRjaCh0aGlzLmdhdGVTdGF0ZSl7Y2FzZSJwcmV0cmlnIjpyZXR1cm4gdGhpcy5nYXRlU3RhdGU9Im9uIiwwO2Nhc2Uib24iOnJldHVybiAxO2Nhc2Uib2ZmIjpyZXR1cm4gMDtkZWZhdWx0OmcoITEpfX1nZXRGcmVxKCl7c3dpdGNoKHRoaXMuZ2F0ZVN0YXRlKXtjYXNlInByZXRyaWciOnJldHVybiB0aGlzLmdhdGVTdGF0ZT0ib24iLDA7Y2FzZSJvbiI6cmV0dXJuIHRoaXMuZnJlcTtjYXNlIm9mZiI6cmV0dXJuIHRoaXMuZnJlcTtkZWZhdWx0OmcoITEpfX1nZXRWZWxvY2l0eSgpe3N3aXRjaCh0aGlzLmdhdGVTdGF0ZSl7Y2FzZSJwcmV0cmlnIjpyZXR1cm4gdGhpcy5nYXRlU3RhdGU9Im9uIiwwO2Nhc2Uib24iOnJldHVybiB0aGlzLnZlbG9jaXR5O2Nhc2Uib2ZmIjpyZXR1cm4gdGhpcy52ZWxvY2l0eTtkZWZhdWx0OmcoITEpfX19Y2xhc3Mgb3QgZXh0ZW5kcyBte2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMudHlwZT0ibWlkaWdhdGUifXVwZGF0ZSh0KXtyZXR1cm4gdGhpcy5jaGFubmVsPXQsdGhpcy5nZXRHYXRlKCl9fWNsYXNzIGN0IGV4dGVuZHMgbXtjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLnR5cGU9Im1pZGlmcmVxIn11cGRhdGUodCl7cmV0dXJuIHRoaXMuY2hhbm5lbD10LHRoaXMuZ2V0RnJlcSgpfX1jbGFzcyBkdCBleHRlbmRzIG17Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy50eXBlPSJtaWRpdmVsIn11cGRhdGUodCl7cmV0dXJuIHRoaXMuY2hhbm5lbD10LHRoaXMuZ2V0VmVsb2NpdHkoKX19Y2xhc3MgZnR7Y29uc3RydWN0b3IodCxzLGUsaSl7dGhpcy51cD0hMSx0aGlzLnNlbmQ9aSx0aGlzLnZhbHVlPTAsdGhpcy50eXBlPSJjYyJ9c2V0VmFsdWUodCl7dGhpcy52YWx1ZT10fXVwZGF0ZSh0LHMsZSl7cmV0dXJuIHRoaXMuaWQ9cywhdGhpcy51cCYmdD4wPyh0aGlzLnVwPSEwLHRoaXMuc2VuZCh7dHlwZToiU0lHTkFMX1RSSUdHRVIiLGlkOnMsdGltZTplfSksdGhpcy52YWx1ZSk6KHRoaXMudXA9dD4wLHRoaXMudmFsdWUpfX1jbGFzcyBwdCBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy50eXBlPSJjYyIsdGhpcy52YWx1ZT1zLmlucHV0c1sxXT8/MH1zZXRWYWx1ZSh0KXt0aGlzLnZhbHVlPXR9dXBkYXRlKHQpe3JldHVybiB0aGlzLmlkPXQsdGhpcy52YWx1ZX19Y2xhc3MgYnQgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMudHlwZT0ibWlkaWNjIix0aGlzLnZhbHVlPXMuaW5wdXRzWzJdPz8tMSx0aGlzLmNoYW5uZWw9LTEsdGhpcy5jY251bWJlcj0tMX1zZXRWYWx1ZSh0KXt0aGlzLnZhbHVlPXR9dXBkYXRlKHQscyl7cmV0dXJuIHRoaXMuY2NudW1iZXI9dCx0aGlzLmNoYW5uZWw9cyx0aGlzLnZhbHVlfX1jbGFzcyBndCBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5jbG9ja1Nnbj0hMCx0aGlzLnN0ZXA9MCx0aGlzLmZpcnN0PSEwfXVwZGF0ZSh0LC4uLnMpe3JldHVybiF0aGlzLmNsb2NrU2duJiZ0PjA/KHRoaXMuc3RlcD0odGhpcy5zdGVwKzEpJXMubGVuZ3RoLHRoaXMuY2xvY2tTZ249dD4wLDApOih0aGlzLmNsb2NrU2duPXQ+MCxzW3RoaXMuc3RlcF0pfX1jbGFzcyBtdCBleHRlbmRzIG97dXBkYXRlKHQsLi4ucyl7Y29uc3QgZT10JXMubGVuZ3RoK3MubGVuZ3RoO3JldHVybiBzW01hdGguZmxvb3IoZSklcy5sZW5ndGhdfX1jbGFzcyBTdHt1cGRhdGUodCxzLGUsaSxuKXtsZXQgcj1QKHQscyxlKTtyZXR1cm4gUyhyLGksbil9fWNsYXNzIHd0e3VwZGF0ZSh0LHMsZSl7cmV0dXJuIE1hdGgubWluKE1hdGgubWF4KHQscyksZSl9fWNsYXNzIHZ0e2NvbnN0cnVjdG9yKCl7dGhpcy5oaT0hMX11cGRhdGUodCl7cmV0dXJuIXRoaXMuaGkmJnQ+MD8odGhpcy5oaT0hMCwxKToodGhpcy5oaSYmdDw9MCYmKHRoaXMuaGk9ITEpLDApfX1jbGFzcyB5dHtjb25zdHJ1Y3Rvcigpe3RoaXMueDE9MCx0aGlzLngyPTAsdGhpcy55MT0wLHRoaXMueTI9MCx0aGlzLmEwPTEsdGhpcy5hMT0wLHRoaXMuYTI9MCx0aGlzLmIwPTEsdGhpcy5iMT0wLHRoaXMuYjI9MH11cGRhdGUodD0wLHM9MCxlPTUwMCxpPTEsbj0xKXtjb25zdCByPTIqTWF0aC5QSSplL3NhbXBsZVJhdGUsbD1NYXRoLnNpbihyKTtpPU1hdGgucG93KDEwLGkvMjApO2NvbnN0IHU9bC8oMippKSxjPU1hdGguY29zKHIpO2lmKHM9PT0wKXRoaXMuYjE9MS1jLHRoaXMuYjA9dGhpcy5iMS8yLHRoaXMuYjI9dGhpcy5iMCx0aGlzLmEwPTErdSx0aGlzLmExPS0yKmMsdGhpcy5hMj0xLXU7ZWxzZSBpZihzPT09MSl0aGlzLmIwPSgxK2MpLzIsdGhpcy5iMT0tKDErYyksdGhpcy5iMj10aGlzLmIwLHRoaXMuYTA9MSt1LHRoaXMuYTE9LTIqYyx0aGlzLmEyPTEtdTtlbHNlIGlmKHM9PT0yKXRoaXMuYjA9bC8yLHRoaXMuYjE9MCx0aGlzLmIyPS10aGlzLmIwLHRoaXMuYTA9MSt1LHRoaXMuYTE9LTIqYyx0aGlzLmEyPTEtdTtlbHNlIGlmKHM9PT0zKXRoaXMuYjA9MSx0aGlzLmIxPS0yKmMsdGhpcy5iMj0xLHRoaXMuYTA9MSt1LHRoaXMuYTE9LTIqYyx0aGlzLmEyPTEtdTtlbHNlIGlmKHM9PT00KXRoaXMuYjA9MS11LHRoaXMuYjE9LTIqYyx0aGlzLmIyPTErdSx0aGlzLmEwPTErdSx0aGlzLmExPS0yKmMsdGhpcy5hMj0xLXU7ZWxzZSBpZihzPT09NSl7Y29uc3QgYT1NYXRoLnBvdygxMCxuLzQwKTt0aGlzLmIwPTErdSphLHRoaXMuYjE9LTIqYyx0aGlzLmIyPTEtdSphLHRoaXMuYTA9MSt1L2EsdGhpcy5hMT0tMipjLHRoaXMuYTI9MS11L2F9ZWxzZSBpZihzPT09Nil7Y29uc3QgYT1NYXRoLnBvdygxMCxuLzQwKSxkPTIqTWF0aC5zcXJ0KGEpKnUsZj0oYS0xKSpjLHA9KGErMSkqYzt0aGlzLmIwPWEqKGErMS1mK2QpLHRoaXMuYjE9MiphKihhLTEtcCksdGhpcy5iMj1hKihhKzEtZi1kKSx0aGlzLmEwPWErMStmK2QsdGhpcy5hMT0tMiooYS0xK3ApLHRoaXMuYTI9YSsxK2YtZH1lbHNlIGlmKHM9PT03KXtjb25zdCBhPU1hdGgucG93KDEwLG4vNDApLGQ9MipNYXRoLnNxcnQoYSkqdSxmPShhLTEpKmMscD0oYSsxKSpjO3RoaXMuYjA9YSooYSsxK2YrZCksdGhpcy5iMT0tMiphKihhLTErcCksdGhpcy5iMj1hKihhKzErZi1kKSx0aGlzLmEwPWErMS1mK2QsdGhpcy5hMT0yKihhLTEtcCksdGhpcy5hMj1hKzEtZi1kfXRoaXMuYjAvPXRoaXMuYTAsdGhpcy5iMS89dGhpcy5hMCx0aGlzLmIyLz10aGlzLmEwLHRoaXMuYTEvPXRoaXMuYTAsdGhpcy5hMi89dGhpcy5hMCx0aGlzLmEwPTE7Y29uc3QgYj10aGlzLmIwKnQrdGhpcy5iMSp0aGlzLngxK3RoaXMuYjIqdGhpcy54Mi10aGlzLmExKnRoaXMueTEtdGhpcy5hMip0aGlzLnkyO3JldHVybiB0aGlzLngyPXRoaXMueDEsdGhpcy54MT10LHRoaXMueTI9dGhpcy55MSx0aGlzLnkxPWIsYn19Y29uc3QgTXQ9T2JqZWN0LmZyZWV6ZShPYmplY3QuZGVmaW5lUHJvcGVydHkoe19fcHJvdG9fXzpudWxsLEFEU1JOb2RlOnEsQXVkaW9JbjpsdCxBdWRpb05vZGU6byxCUEY6cnQsQmlxdWFkRmlsdGVyOnl0LEJyb3duTm9pc2VPc2M6VyxDQzpwdCxDTE9DS19QUFE6TSxDTE9DS19QUFM6TixDbGlwOnd0LENsb2NrOkYsQ2xvY2tEaXY6RCxDbG9ja091dDpMLERlbGF5OlYsRGlzdG9ydDpHLER1c3RPc2M6SyxGaWx0ZXI6bnQsRm9sZDp1dCxIb2xkOlIsSW1wdWxzZU9zYzpZLExhZzppdCxMY2dOb2lzZTpILE1pZGlDQzpidCxNaWRpRnJlcTpjdCxNaWRpR2F0ZTpvdCxNaWRpSW46bSxNaWRpVmVsOmR0LE5vaXNlT3NjOmosT3V0cHV0OkIsUGljazptdCxQaW5rTm9pc2U6WCxQdWxzZU9zYzp6LFJlbWFwOlN0LFNhd09zYzpKLFNjb3BlOmV0LFNlcXVlbmNlOmd0LFNpZGVjaGFpbkNvbXByZXNzb3I6dHQsU2lnbmFsOmZ0LFNpbmVPc2M6USxTbGV3Omh0LFNsaWRlOmF0LFRyaU9zYzpzdCxUcmlnOnZ0LFphd09zYzpafSxTeW1ib2wudG9TdHJpbmdUYWcse3ZhbHVlOiJNb2R1bGUifSkpLHg9bmV3IE1hcChPYmplY3QuZW50cmllcyhNdCkpO2NsYXNzIE90e2NvbnN0cnVjdG9yKHQscyl7Zyh0PT00OGUzKSx0aGlzLnNhbXBsZVJhdGU9dCx0aGlzLnBsYXlQb3M9MCx0aGlzLnNlbmQ9cyx0aGlzLnVuaXRzPVtdLHRoaXMudW5pdElEPTAsdGhpcy5mYWRlVGltZT0uMDEsdGhpcy5tYXhVbml0cz0xLHRoaXMucT1bXX1mYWRlT3V0VW5pdCh0KXt0LmZhZGVPdXQodGhpcy5wbGF5UG9zLHRoaXMuZmFkZVRpbWUpLHRoaXMuZnJlZVVuaXQodC5pZCx0aGlzLmZhZGVUaW1lKX1mYWRlT3V0VW5pdEJ5SWQodCl7Y29uc3Qgcz10aGlzLnVuaXRzLmZpbmQoZT0+ZS5pZD09PXQpO3MmJnRoaXMuZmFkZU91dFVuaXQocyl9ZmFkZU91dEFsbFVuaXRzKCl7dGhpcy51bml0cy5mb3JFYWNoKHQ9PnRoaXMuZmFkZU91dFVuaXQodCkpfWZhZGVPdXRPbGRVbml0cygpe2NvbnN0IHQ9dGhpcy51bml0cy5maWx0ZXIoZT0+ZS5hY3RpdmUpLHM9dC5sZW5ndGgtdGhpcy5tYXhVbml0cztzPD0wfHx0LnNsaWNlKDAscykuZm9yRWFjaChlPT50aGlzLmZhZGVPdXRVbml0KGUpKX1zdG9wKCl7dGhpcy5mYWRlT3V0QWxsVW5pdHMoKSx0aGlzLnNlbmQoe3R5cGU6IlNUT1AiLGZhZGVUaW1lOnRoaXMuZmFkZVRpbWV9KX1zcGF3blVuaXQodCxzKXtjb25zdCBlPW5ldyB4dCh0aGlzLnVuaXRJRCsrLHQsdGhpcy5zYW1wbGVSYXRlLHRoaXMuc2VuZCk7dGhpcy51bml0cy5wdXNoKGUpLGUuZmFkZUluKHRoaXMucGxheVBvcyx0aGlzLmZhZGVUaW1lKSx0aGlzLmZhZGVPdXRPbGRVbml0cygpLGNvbnNvbGUubG9nKGBzcGF3biB1bml0ICR7ZS5pZH0sIHVuaXRzIGFsaXZlOiAke3RoaXMudW5pdHMubGVuZ3RofWApLHMmJnRoaXMuc2NoZWR1bGVNZXNzYWdlKHttc2c6e3R5cGU6IkZBREVfT1VUX1VOSVQiLGlkOmUuaWR9LHRpbWU6c30pfWZyZWVVbml0KHQscyl7aWYocyl7dGhpcy5zY2hlZHVsZU1lc3NhZ2Uoe21zZzp7dHlwZToiRlJFRV9VTklUIixpZDp0fSx0aW1lOnN9KTtyZXR1cm59Y29uc3QgZT10aGlzLnVuaXRzLmxlbmd0aDt0aGlzLnVuaXRzPXRoaXMudW5pdHMuZmlsdGVyKGk9PmkuaWQhPT10KSxlPnRoaXMudW5pdHMubGVuZ3RoJiZjb25zb2xlLmxvZyhgZnJlZSB1bml0ICR7dH0sIHVuaXRzIGFsaXZlOiAke3RoaXMudW5pdHMubGVuZ3RofWApfXBhcnNlTXNnKHQpe3N3aXRjaCh0LnR5cGUpe2Nhc2UiU1BBV05fVU5JVCI6dGhpcy5zcGF3blVuaXQodC51bml0LHQuZHVyYXRpb24pO2JyZWFrO2Nhc2UiRlJFRV9VTklUIjp0aGlzLmZyZWVVbml0KHQuaWQpO2JyZWFrO2Nhc2UiRkFERV9PVVRfVU5JVCI6dGhpcy5mYWRlT3V0VW5pdEJ5SWQodC5pZCk7YnJlYWs7Y2FzZSJOT1RFX09OIjp0aGlzLm5vdGVPbih0KTticmVhaztjYXNlIkNDIjp0aGlzLm1pZGlDQyh0KTticmVhaztjYXNlIlNFVF9DT05UUk9MIjp0aGlzLnNldENvbnRyb2wodCk7YnJlYWs7Y2FzZSJGQURFX1RJTUUiOnRoaXMuZmFkZVRpbWU9TnVtYmVyKHQuZmFkZVRpbWUpO2JyZWFrO2Nhc2UiTUFYX1VOSVRTIjp0aGlzLm1heFVuaXRzPU51bWJlcih0Lm1heFVuaXRzKTticmVhaztjYXNlIlNUT1AiOnRoaXMuc3RvcCgpO2JyZWFrO2Nhc2UiU0VUX1VHRU4iOnRoaXMuYWRkVWdlbih0LmNsYXNzTmFtZSx0LnVnZW4pO2JyZWFrO2Nhc2UiU0NIRURVTEVfTVNHIjp0aGlzLnNjaGVkdWxlTWVzc2FnZSh0KTticmVhaztjYXNlIkJBVENIX01TRyI6dC5tZXNzYWdlcy5mb3JFYWNoKHM9PnRoaXMucGFyc2VNc2cocykpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcihgdW5rbm93biBtZXNzYWdlIHR5cGUgJHt0LnR5cGV9YCl9fW5vdGVPbih0KXt0aGlzLnVuaXRzLmZvckVhY2gocz0+cy5ub3RlT24odCkpfW1pZGlDQyh0KXt0aGlzLnVuaXRzLmZvckVhY2gocz0+cy5taWRpQ0ModCkpfXNldENvbnRyb2wodCl7dGhpcy51bml0cy5mb3JFYWNoKHM9PnMuc2V0Q29udHJvbCh0KSl9c2NoZWR1bGVNZXNzYWdlKHQpe2lmKHQudGltZT10aGlzLnBsYXlQb3MrdC50aW1lLCF0aGlzLnEubGVuZ3RoKXt0aGlzLnEucHVzaCh0KTtyZXR1cm59bGV0IHM9MDtmb3IoO3M8dGhpcy5xLmxlbmd0aCYmdGhpcy5xW3NdLnRpbWU8dC50aW1lOylzKys7dGhpcy5xLnNwbGljZShzLDAsdCl9Z2VuU2FtcGxlKHQpe2Zvcig7dGhpcy5xLmxlbmd0aD4wJiZ0aGlzLnFbMF0udGltZTw9dGhpcy5wbGF5UG9zOyl0aGlzLnBhcnNlTXNnKHRoaXMucVswXS5tc2cpLHRoaXMucS5zaGlmdCgpO2lmKCF0aGlzLnVuaXRzLmxlbmd0aClyZXR1cm5bMCwwXTtjb25zdCBzPVswLDBdO2ZvcihsZXQgZT0wO2U8dGhpcy51bml0cy5sZW5ndGg7ZSsrKXtjb25zdCBpPXRoaXMudW5pdHNbZV0sbj1pLmdldExldmVsKHRoaXMucGxheVBvcyk7aS5nZW5TYW1wbGUodGhpcy5wbGF5UG9zLGkubm9kZXMsdCxpLnJlZ2lzdGVycyxpLm91dHB1dHMsaS5zb3VyY2VzKSxzWzBdKz1pLm91dHB1dHNbMF0qbixzWzFdKz1pLm91dHB1dHNbMV0qbn1yZXR1cm4gdGhpcy5wbGF5UG9zKz0xLzQ4ZTMsc31hZGRVZ2VuKHQscyl7Y29uc3QgZT1uZXcgRnVuY3Rpb24oYCR7c307cmV0dXJuICR7dH1gKSgpO3guc2V0KHQsZSl9fWNsYXNzIHh0e2NvbnN0cnVjdG9yKHQscyxlLGkpe3RoaXMuaWQ9dCx0aGlzLnNhbXBsZVJhdGU9ZSx0aGlzLnNlbmQ9aSx0aGlzLm5vZGVzPVtdLHRoaXMuYWN0aXZlPSEwO2ZvcihsZXQgciBpbiBzLnVnZW5zKXtjb25zdCBsPXMudWdlbnNbcl07aWYoeC5oYXMobC50eXBlKSl7Y29uc3QgdT14LmdldChsLnR5cGUpLGM9TnVtYmVyKHIpO3RoaXMubm9kZXNbY109bmV3IHUoYyxsLHRoaXMuc2FtcGxlUmF0ZSx0aGlzLnNlbmQpfWVsc2UgY29uc29sZS53YXJuKGB1bmtub3duIHVnZW4gIiR7bC50eXBlfSJgKX10aGlzLnJlZ2lzdGVycz1uZXcgQXJyYXkocy5yZWdpc3RlcnMpLmZpbGwoMCk7bGV0IG49MTY7dGhpcy5vdXRwdXRzPW5ldyBBcnJheShuKS5maWxsKDApLHRoaXMuc291cmNlcz1uZXcgQXJyYXkobikuZmlsbCgwKSxzLnNyYz1gby5maWxsKDApOyAvLyByZXNldCBvdXRwdXRzCmArcy5zcmMsdGhpcy5nZW5TYW1wbGU9bmV3IEZ1bmN0aW9uKCJ0aW1lIiwibm9kZXMiLCJpbnB1dCIsInIiLCJvIiwicyIscy5zcmMpfW5vdGVPbih0KXt2YXIgdSxjLGI7Y29uc3R7Y2hhbm5lbDpzLG5vdGU6ZSx2ZWxvY2l0eTppfT10LG49dGhpcy5ub2Rlcy5maWx0ZXIoYT0+YS50eXBlPT09Im1pZGlmcmVxIiYmKGEuY2hhbm5lbD09PS0xfHxhLmNoYW5uZWw9PT1zKSkscj10aGlzLm5vZGVzLmZpbHRlcihhPT5hLnR5cGU9PT0ibWlkaWdhdGUiJiYoYS5jaGFubmVsPT09LTF8fGEuY2hhbm5lbD09PXMpKSxsPXRoaXMubm9kZXMuZmlsdGVyKGE9PmEudHlwZT09PSJtaWRpdmVsIiYmKGEuY2hhbm5lbD09PS0xfHxhLmNoYW5uZWw9PT1zKSk7aWYoaT4wKXtsZXQgYT1uLmZpbmQocD0+cC5pc0ZyZWUoKSl8fG5bMF0sZD1yLmZpbmQocD0+cC5pc0ZyZWUoKSl8fHJbMF0sZj1sLmZpbmQocD0+cC5pc0ZyZWUoKSl8fGxbMF07YT09bnVsbHx8YS5ub3RlT24oZSxpKSxkPT1udWxsfHxkLm5vdGVPbihlLGkpLGY9PW51bGx8fGYubm90ZU9uKGUsaSl9ZWxzZSh1PW4uZmluZChhPT5hLm5vdGU9PT1lKSk9PW51bGx8fHUubm90ZU9mZigpLChjPXIuZmluZChhPT5hLm5vdGU9PT1lKSk9PW51bGx8fGMubm90ZU9mZigpLChiPWwuZmluZChhPT5hLm5vdGU9PT1lKSk9PW51bGx8fGIubm90ZU9mZigpfW1pZGlDQyh0KXtjb25zdHtjaGFubmVsOnMsY2M6ZSx2YWx1ZTppfT10O3RoaXMubm9kZXMuZm9yRWFjaChuPT57bi50eXBlPT09Im1pZGljYyImJihuLmNoYW5uZWw9PT0tMXx8bi5jaGFubmVsPT09cykmJm4uY2NudW1iZXI9PT1lJiZuLnNldFZhbHVlKGkpfSl9c2V0Q29udHJvbCh0KXtjb25zdHt2YWx1ZTpzLGlkOmV9PXQsaT10aGlzLm5vZGVzLmZpbmQobj0+bi50eXBlPT09ImNjIiYmbi5pZD09PWUpO2kmJmkuc2V0VmFsdWUocyl9Z2V0TGV2ZWwodCl7cmV0dXJuIHRoaXMuZmFkZVN0YXJ0PT09dm9pZCAwPzA6dGhpcy5hY3RpdmU/UygodC10aGlzLmZhZGVTdGFydCkvdGhpcy5mYWRlVGltZSwwLC4zKTpTKCh0LXRoaXMuZmFkZVN0YXJ0KS90aGlzLmZhZGVUaW1lLHRoaXMuZmFkZUZyb20sMCl9ZmFkZUluKHQscyl7dGhpcy5mYWRlU3RhcnQ9dCx0aGlzLmZhZGVUaW1lPXN9ZmFkZU91dCh0LHMpe3RoaXMuZmFkZVRpbWU9cyx0aGlzLmZhZGVGcm9tPXRoaXMuZ2V0TGV2ZWwodCksdGhpcy5hY3RpdmU9ITEsdGhpcy5mYWRlU3RhcnQ9dH1pc0RvbmUodCl7cmV0dXJuIXRoaXMuYWN0aXZlJiZ0aGlzLmdldExldmVsKHQpPT09MH19Y2xhc3MgVHQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucG9ydC5vbm1lc3NhZ2U9dGhpcy5vbm1lc3NhZ2UuYmluZCh0aGlzKSx0aGlzLmF1ZGlvR3JhcGg9bmV3IE90KDQ4ZTMsdGhpcy5wb3J0LnBvc3RNZXNzYWdlLmJpbmQodGhpcy5wb3J0KSl9b25tZXNzYWdlKHQpe2xldCBzPXQuZGF0YTt0aGlzLmF1ZGlvR3JhcGgucGFyc2VNc2cocyl9cHJvY2Vzcyh0LHMsZSl7Y29uc3QgaT1zWzBdLG49dFswXVswXSxyPWlbMF0sbD1pWzFdO2ZvcihsZXQgdT0wO3U8ci5sZW5ndGg7dSsrKXtsZXRbYyxiXT10aGlzLmF1ZGlvR3JhcGguZ2VuU2FtcGxlKG4/blt1XTowKTtyW3VdPWMsbFt1XT1ifXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3Nvcigic2FtcGxlLWdlbmVyYXRvciIsVHQpfSkoKTsK",sQe="data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIG4gZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiaXNSZWNvcmRpbmciLGRlZmF1bHRWYWx1ZTowfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuX2J1ZmZlclNpemU9MjA0OCx0aGlzLl9idWZmZXI9bmV3IEZsb2F0MzJBcnJheSh0aGlzLl9idWZmZXJTaXplKSx0aGlzLl9pbml0QnVmZmVyKCl9X2luaXRCdWZmZXIoKXt0aGlzLl9ieXRlc1dyaXR0ZW49MH1faXNCdWZmZXJFbXB0eSgpe3JldHVybiB0aGlzLl9ieXRlc1dyaXR0ZW49PT0wfV9pc0J1ZmZlckZ1bGwoKXtyZXR1cm4gdGhpcy5fYnl0ZXNXcml0dGVuPT09dGhpcy5fYnVmZmVyU2l6ZX1fYXBwZW5kVG9CdWZmZXIoZSl7dGhpcy5faXNCdWZmZXJGdWxsKCkmJnRoaXMuX2ZsdXNoKCksdGhpcy5fYnVmZmVyW3RoaXMuX2J5dGVzV3JpdHRlbl09ZSx0aGlzLl9ieXRlc1dyaXR0ZW4rPTF9X2ZsdXNoKCl7bGV0IGU9dGhpcy5fYnVmZmVyO3RoaXMuX2J5dGVzV3JpdHRlbjx0aGlzLl9idWZmZXJTaXplJiYoZT1lLnNsaWNlKDAsdGhpcy5fYnl0ZXNXcml0dGVuKSksdGhpcy5wb3J0LnBvc3RNZXNzYWdlKHtldmVudFR5cGU6ImRhdGEiLGF1ZGlvQnVmZmVyOmV9KSx0aGlzLl9pbml0QnVmZmVyKCl9X3JlY29yZGluZ1N0b3BwZWQoKXt0aGlzLnBvcnQucG9zdE1lc3NhZ2Uoe2V2ZW50VHlwZToic3RvcCJ9KX1wcm9jZXNzKGUsbyxoKXtjb25zdCBpPWguaXNSZWNvcmRpbmcsZj1vWzBdLHM9ZVswXSx1PWZbMF0sXz1mWzFdO2xldCByPSExO2ZvcihsZXQgdD0wO3Q8dS5sZW5ndGg7dCsrKXQ8aS5sZW5ndGgmJihyPWlbdF09PT0xKSwhciYmIXRoaXMuX2lzQnVmZmVyRW1wdHkoKSYmKHRoaXMuX2ZsdXNoKCksdGhpcy5fcmVjb3JkaW5nU3RvcHBlZCgpKSxyJiYodGhpcy5fYXBwZW5kVG9CdWZmZXIoc1swXVt0XSksdGhpcy5fYXBwZW5kVG9CdWZmZXIoc1sxXVt0XSkpLHVbdF09c1swXVt0XSxfW3RdPXNbMV1bdF07cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJyZWNvcmRlciIsbil9KSgpOwo=";function aQe(n,e,t){if(n.length<1)return;n[0];const i=3,r=32,s=n.map(f=>f.length).reduce((f,m)=>f+m,0),a=r/8,o=t*a,l=44,u=new ArrayBuffer(l+s*a),c=new DataView(u);aN(c,0,"RIFF"),c.setUint32(4,36+s*a,!0),aN(c,8,"WAVE"),aN(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,i,!0),c.setUint16(22,t,!0),c.setUint32(24,e,!0),c.setUint32(28,e*o,!0),c.setUint16(32,o,!0),c.setUint16(34,r,!0),aN(c,36,"data"),c.setUint32(40,s*a,!0);let d=44;for(const f of n)oQe(c,d,f),d+=f.length*a;return u}function aN(n,e,t){for(let i=0;i<t.length;i++)n.setUint8(e+i,t.charCodeAt(i))}function oQe(n,e,t){for(var i=0;i<t.length;i++,e+=4)n.setFloat32(e,t[i],!0)}const VK=Object.freeze(Object.defineProperty({__proto__:null,Node:zr,compile:S6,evaluate:t1e,exit:e1e,exportModule:qqe,getInletName:$qe,getNode:Qve,module:Lh,n:$d,node:PM,nodeRegistry:Au,outputType:az,polyType:Fy,register:Rl,registerNode:Xn},Symbol.toStringTag,{value:"Module"}));let lQe=n=>`Math.sin(${n})`,uQe=n=>`Math.cos(${n})`,cQe=n=>`Math.tan(${n})`,hQe=n=>`Math.asin(${n})`,dQe=n=>`Math.acos(${n})`,fQe=n=>`Math.atan(${n})`,i1e=(n,e,t)=>`${n} = ${e};${t?` /* ${t} */`:""}`,M6=(n,...e)=>i1e(n.name,`nodes[${n.ugenIndex}].update(${e.join(",")})`,n.node.type),pQe=n=>`(2 ** ((${n} - 69) / 12) * 440)`,mQe=(n,e)=>`${n} ** ${e}`,gQe=n=>`Math.exp(${n})`,yQe=n=>`Math.log(${n})`,vQe=(n,e)=>`${n}%${e}`,xQe=n=>`Math.abs(${n})`,bQe=n=>`Math.round(${n})`,_Qe=n=>`Math.floor(${n})`,SQe=n=>`Math.sign(${n})`,MQe=n=>`Math.ceil(${n})`,AQe=(n,e)=>`Math.min(${n}, ${e})`,TQe=(n,e)=>`Math.max(${n}, ${e})`,CQe=(n,e)=>`[${n}, ${e}]`,bE=n=>`${n}[0]`,wQe=n=>`${n}[1]`,EQe=(n,e)=>`(${bE(n)} < ${bE(e)} ? ${n} : ${e})`,RQe=(n,e)=>`(${bE(n)} > ${bE(e)} ? ${n} : ${e})`;const PQe=Object.freeze(Object.defineProperty({__proto__:null,abs:xQe,ceil:MQe,def:i1e,defAcos:dQe,defAsin:hQe,defAtan:fQe,defCos:uQe,defSin:lQe,defTan:cQe,defUgen:M6,exp:gQe,floor:_Qe,log:yQe,max:TQe,midinote:pQe,min:AQe,mod:vQe,pair_a:bE,pair_a_max:RQe,pair_a_min:EQe,pair_b:wQe,pair_make:CQe,pow:mQe,round:bQe,sign:SQe},Symbol.toStringTag,{value:"Module"}));class DQe{constructor(e=null){this.ugens=new Map,this.outputNode=e}async spawn(e,t){this.graph=e;const{src:i,ugens:r,registers:s}=e.compile({log:!1});!this.mouse&&i.includes("mouse")&&this.initMouse(),!this.midiInited&&r.some(a=>a.type.startsWith("Midi"))&&this.initMidi(),!this.audioIn&&r.some(a=>a.type==="AudioIn")&&await this.initAudioIn(),this.sendCustomUgens(),this.send({type:"SPAWN_UNIT",unit:{src:i,ugens:r,registers:s},duration:t})}registerUgen(e){this.ugens.set(e.name,e)}sendCustomUgens(){if(!this.ugens.size)return;let e=[];for(let[t,i]of this.ugens)e.push({type:"SET_UGEN",className:t,ugen:i+""});this.send({type:"BATCH_MSG",messages:e})}scheduleMessage(e,t){this.send({type:"SCHEDULE_MSG",msg:e,time:t})}setControl(e,t,i){const r={type:"SET_CONTROL",id:e,value:t};i?this.send({type:"SCHEDULE_MSG",time:i,msg:r}):this.send(r)}setControls(e){const t={type:"BATCH_MSG",messages:e.map(i=>{const r={type:"SET_CONTROL",id:i.id,value:i.value};return i.time===void 0?r:{type:"SCHEDULE_MSG",time:i.time,msg:r}})};this.send(t)}async initAudioIn(){console.log("init audio input...");const e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}});this.audioCtx.createMediaStreamSource(e).connect(this.audioWorklet)}initMidi(){console.log("init midi input..."),this.midiInited=!0,new tQe().on("midimessage",(e,t)=>{const i=nQe(t);i&&this.send(i)})}initMouse(){console.log("init mouse"),this.mouse=new iQe,this.mouse.on("move",(e,t)=>{this.setControl("mouseX",e),this.setControl("mouseY",t)})}send(e){sz(e instanceof Object),this.audioWorklet&&this.audioWorklet.port.postMessage(e)}async init(){if(!this.audioCtx){if(sz(!this.audioCtx),this.audioCtx=this.outputNode?.context||new AudioContext({latencyHint:"interactive",sampleRate:48e3}),await this.audioCtx.resume(),!this.audioCtx.audioWorklet)throw new Error("Audio cannot be loaded: non-secure origin? (AudioContext.audioWorklet is undefined)");await this.audioCtx.audioWorklet.addModule(rQe),await this.audioCtx.audioWorklet.addModule(sQe),this.audioWorklet=new AudioWorkletNode(this.audioCtx,"sample-generator",{outputChannelCount:[2]}),this.audioWorklet.port.onmessage=e=>{const{id:t,time:i,type:r}=e.data;r==="SIGNAL_TRIGGER"?this.graph.dfs(s=>{if(s.type==="signal"&&s.id===t){const a=s.callback(i,t);isNaN(a)?a!==void 0&&console.warn(`expected number from "on" callback with id "${t}", got "${a}" instead.`):window.postMessage({type:"KABELSALAT_SET_CONTROL",value:a,id:t})}return s}):r==="STOP"?setTimeout(()=>this.destroy(),e.data.fadeTime*1e3+200):r==="SEND_SAMPLES"&&this.graph.dfs(s=>(s.type!=="scope"||s.ins.length<2||s.ins[1].value!==t||window.postMessage({type:"KABELSALAT_UPDATE_SCOPE",samples:e.data.samples,channels:e.data.channels,channel:e.data.channel,id:t}),s))},this.recorder=new window.AudioWorkletNode(this.audioCtx,"recorder"),this.audioWorklet.connect(this.recorder),this.sendCustomUgens(),this.recorder.connect(this.outputNode||this.audioCtx.destination),this.recorder.port.onmessage=e=>{if(e.data.eventType==="data"&&this.recordedBuffers.push(e.data.audioBuffer),e.data.eventType==="stop"){console.log("recording stopped");const t=aQe(this.recordedBuffers,this.audioCtx.sampleRate,2);NQe(t,"kabelsalat.wav","audio/wav"),this.recordedBuffers=[]}},this.recordOnPlay&&this.record()}}destroy(){this.audioWorklet?.disconnect(),this.audioWorklet=null,this.recorder?.disconnect(),this.recorder=null,!this.outputNode&&this.audioCtx?.close(),this.audioCtx=null}stop(){this.audioCtx&&this.send({type:"STOP"}),this.mouse?.detach()}record(){if(!this.audioCtx){this.recordOnPlay=!0;return}this.recordedBuffers=[],this.recorder.parameters.get("isRecording").setValueAtTime(1,0),console.log("recording started")}stopRecording(){this.recordOnPlay=!1,this.audioCtx&&this.recorder.parameters.get("isRecording").setValueAtTime(0,0)}set fadeTime(e){this.send({type:"FADE_TIME",fadeTime:e})}set maxUnits(e){this.send({type:"MAX_UNITS",maxUnits:e})}}function NQe(n,e,t){const i=new Blob([n],{type:t}),r=document.createElement("a");r.href=window.URL.createObjectURL(i),r.download=e,r.click()}let BQe=0;Rl("signal",(n,e)=>{const t=BQe++,i=getNode("signal",n,t);return i.callback=e,i.id=t,i},{ugen:"Signal",compile:({vars:[n,e],...t})=>M6(t,n,e,"time")});let FQe=n=>`sin(${n})`,LQe=n=>`cos(${n})`,IQe=n=>`tan(${n})`,GQe=n=>`asin(${n})`,OQe=n=>`acos(${n})`,UQe=n=>`atan(${n})`,oz=(n,e,t)=>`${n} = ${e};${t?` /* ${t} */`:""}`,kQe=(n,...e)=>{if(e.unshift(`nodes[${n.ugenIndex}]`),n.ugen==="Sequence"||n.ugen==="Pick"){const t=e.length-2,i=`(float[${t}]){${e.slice(2).join(",")}}`;return oz(n.name,`${n.ugen}_update(${e[0]}, ${e[1]}, ${t}, ${i})`,n.ugen)}return oz(n.name,`${n.ugen}_update(${e.join(",")})`,n.ugen)},zQe=n=>`pow(2.0, ((${n} - 69.0) / 12.0)) * 440.0`,VQe=(n,e)=>`pow(${n}, ${e})`,HQe=n=>`exp(${n})`,XQe=n=>`log(${n})`,WQe=(n,e)=>`${n}>=${e}?${n}-${e}:${n}`,ZQe=n=>`fabs(${n})`,jQe=(n,e)=>`fmin(${n}, ${e})`,YQe=(n,e)=>`fmax(${n}, ${e})`,KQe=n=>`fround(${n})`,$Qe=n=>`floor(${n})`,JQe=n=>`ceil(${n})`,qQe=(n,e)=>`((pair) {${n}, ${e}})`,_E=n=>`${n}.a`,QQe=n=>`${n}.b`,eet=(n,e)=>`(${_E(n)} < ${_E(e)} ? ${n} : ${e})`,tet=(n,e)=>`(${_E(n)} > ${_E(e)} ? ${n} : ${e})`;const net=Object.freeze(Object.defineProperty({__proto__:null,abs:ZQe,ceil:JQe,def:oz,defAcos:OQe,defAsin:GQe,defAtan:UQe,defCos:LQe,defSin:FQe,defTan:IQe,defUgen:kQe,exp:HQe,floor:$Qe,log:XQe,max:YQe,midinote:zQe,min:jQe,mod:WQe,pair_a:_E,pair_a_max:tet,pair_a_min:eet,pair_b:QQe,pair_make:qQe,pow:VQe,round:KQe},Symbol.toStringTag,{value:"Module"})),hn={js:PQe,c:net},r1e=(n,e)=>Xn(n,{ugen:e,compile:({vars:t,...i})=>hn[i.lang].defUgen(i,...t)});let iet=Rl("time",n=>new zr("time",n),{tags:["meta"],description:"Returns elapsed time in seconds",compile:({name:n,lang:e})=>hn[e].def(n,"time")}),ret=Rl("raw",(n,e)=>new zr("raw",e).withIns($d(n)),{ins:[{name:"in"},{name:"code",description:"expression with variable `t` being the elapsed time and `$input` the input."}],tags:["meta"],description:"Raw code node, expects floats between -1 and 1",compile:({vars:n,node:e,name:t})=>`let $input = ${n[0]}; 
const ${t} = (${e.value}); // raw`,examples:[`sine(4).range(.5,1)
.raw("(time*110%1*2-1)*$input")
.out()`]}),set=Rl("bytebeat",(n,e)=>new zr("bytebeat",e).withIns($d(n)),{ins:[{name:"t",description:"time in samples"},{name:"code",description:"bytebeat code with variable `t`"}],tags:["meta"],description:"Bytebeat node, expects numbers from 0 to 255",examples:[`time().mul(8000).bytebeat\`
// Fractalized Past
// by: lhphr
// from: https://dollchan.net/btb/res/3.html#69

(t>>10^t>>11)%5*((t>>14&3^t>>15&1)+1)*t%99+((3+(t>>14&3)-(t>>16&1))/3*t%99&64)
\`.out()`],compile:({vars:n,node:e,name:t})=>`let t = ${n[0]}; 
const ${t} = ((${e.value}) & 255) / 127.5 - 1; // bytebeat`}),aet=Rl("floatbeat",(n,e)=>new zr("bytebeat",e).withIns($d(n)),{ins:[{name:"t",description:"time in samples"},{name:"code",description:"floatbeat code with variable `t`"}],tags:["meta"],description:"Raw code node, expects numbers from -1 to 1",compile:({vars:n,node:e,name:t})=>`let t = ${n[0]}; const ${t} = (${e.value}); // floatbeat`}),oet=Xn("adsr",{ugen:"ADSRNode",tags:["envelope"],description:"ADSR envelope",examples:[`impulse(1).perc(.5)
.adsr(.01, .1, .5, .1)
.mul(sine(220)).out()`],ins:[{name:"gate",default:0,description:"gate input"},{name:"att",default:.02,description:"attack time"},{name:"dec",default:.1,description:"decay time"},{name:"sus",default:.2,description:"sustain level"},{name:"rel",default:.1,description:"release time"}],compile:({vars:[n=0,e=.02,t=.1,i=.2,r=.1],...s})=>hn[s.lang].defUgen(s,"time",n,e,t,i,r)}),uet=Lh("ar",(n=0,e=.02,t=.1)=>n.adsr(e,0,1,t),{tags:["envelope"],description:"AR envelope",examples:["impulse(1).ad(.01, .1).mul(sine(220)).out()"],ins:[{name:"trig",default:0,description:"gate input"},{name:"att",default:.02,description:"attack time"},{name:"rel",default:.1,description:"release time"}]}),cet=Lh("ad",(n=0,e=.02,t=.1)=>n.adsr(e,t,0,t),{tags:["envelope"],description:"AD envelope",examples:["impulse(1).ad(.01, .1).mul(sine(220)).out()"],ins:[{name:"trig",default:0,description:"gate input"},{name:"att",default:.02,description:"attack time"},{name:"dec",default:.1,description:"decay time"}]}),het=Xn("clock",{ugen:"Clock",internal:!0,tags:["regular","clock"],description:"Clock source, with tempo in BPM",examples:["clock(120).clockdiv(16).mul(sine(220)).out()"],ins:[{name:"bpm",default:120,description:"clock tempo in bpm (beats per minute)"}],compile:({vars:[n=120],...e})=>hn[e.lang].defUgen(e,n)}),det=Xn("clockdiv",{ugen:"ClockDiv",tags:["clock","trigger"],description:"Clock signal divider",examples:["impulse(8).clockdiv(2).ad(.1,.1).mul(sine(220)).out()"],ins:[{name:"clock",default:0,description:"clock input"},{name:"divisor",default:2,description:"tempo divisor"}],compile:({vars:[n=0,e=2],...t})=>hn[t.lang].defUgen(t,n,e)}),fet=Xn("distort",{ugen:"Distort",tags:["fx","distortion"],description:"Overdrive-style distortion",examples:[`sine(220)
.distort( saw(.5).range(0,1) )
.out()`],ins:[{name:"in",default:0},{name:"amt",default:0,description:"distortion amount"}],compile:({vars:[n=0,e=0],...t})=>hn[t.lang].defUgen(t,n,e)}),s1e=Xn("noise",{ugen:"NoiseOsc",tags:["source","noise"],description:"White noise source",examples:["noise().mul(.25).out()"],ins:[{name:"next",default:1,description:"if 0, the noise will hold the previous value. defaults to 1."}],compile:({lang:n,vars:[e=1],...t})=>hn[n].defUgen(t,e)}),pet=Xn("lcgnoise",{ugen:"LcgNoise",tags:["source","noise"],description:"Lcg white noise source.",examples:["lcgnoise().mul(.25).out()"],ins:[{name:"next",default:1,description:"if 0, the noise will hold the previous value. defaults to 1."},{name:"reset",default:0,description:"if 1, the random number generator sequence will reset."}],compile:({lang:n,vars:[e=1,t=0],...i})=>hn[n].defUgen(i,e,t)}),met=Xn("pink",{ugen:"PinkNoise",tags:["source","noise"],description:"Pink noise source",examples:["pink().mul(.5).out()"],ins:[],compile:({lang:n,...e})=>hn[n].defUgen(e)}),get=Xn("brown",{ugen:"BrownNoiseOsc",tags:["source","noise"],description:"Brown noise source",examples:["brown().out()"],ins:[],compile:({lang:n,...e})=>hn[n].defUgen(e)}),yet=Xn("dust",{ugen:"DustOsc",tags:["trigger","noise","source"],description:"Generates random impulses from 0 to +1.",examples:["dust(200).out()"],ins:[{name:"density",default:0,description:"average impulses per second"}],compile:({vars:[n=0],...e})=>hn[e.lang].defUgen(e,n)}),a1e=Xn("impulse",{ugen:"ImpulseOsc",tags:["regular","trigger"],description:"Regular single sample impulses (0 - 1)",examples:["impulse(10).out()"],ins:[{name:"freq",default:0},{name:"phase",default:0}],compile:({vars:[n=0,e=0],...t})=>hn[t.lang].defUgen(t,n,e)}),vet=Xn("saw",{ugen:"SawOsc",tags:["regular","waveform","source"],description:"Sawtooth wave oscillator with anti aliasing",examples:["saw(110).mul(.5).out()"],ins:[{name:"freq",default:0}],compile:({vars:[n=0],...e})=>hn[e.lang].defUgen(e,n)}),xet=Xn("zaw",{ugen:"ZawOsc",tags:["regular","waveform","source"],description:"Sawtooth wave oscillator with sharp edges. Use saw for anti aliased variant.",examples:["zaw(110).mul(.5).out()"],ins:[{name:"freq",default:0}],compile:({vars:[n=0],...e})=>hn[e.lang].defUgen(e,n)}),bet=Xn("sine",{tags:["regular","waveform","source"],ugen:"SineOsc",description:"Sine wave oscillator",examples:["sine(220).out()"],ins:[{name:"freq",default:0},{name:"sync",default:0,description:"sync input"},{name:"phase",default:0,description:"phase offset"}],compile:({vars:[n=0,e=0,t=0],...i})=>hn[i.lang].defUgen(i,n,e,t)}),_et=Xn("tri",{ugen:"TriOsc",tags:["regular","waveform","source"],description:"Triangle wave oscillator",examples:["tri(220).out()"],ins:[{name:"freq",default:0}],compile:({vars:[n=0],...e})=>hn[e.lang].defUgen(e,n)}),Met=Xn("pulse",{ugen:"PulseOsc",tags:["regular","waveform","source"],description:"Pulse wave oscillator",examples:["pulse(220, sine(.1).range(.1,.5)).mul(.5).out()"],ins:[{name:"freq",default:0},{name:"pw",default:.5,description:"pulse width 0 - 1"}],compile:({vars:[n=0,e=.5],...t})=>hn[t.lang].defUgen(t,n,e)}),Aet=Xn("slide",{ugen:"Slide",tags:["fx"],internal:!0,description:"Slide/portamento node",examples:[`impulse(2).seq(55,110,220,330)
.slide(4).sine().out()`],ins:[{name:"in",default:0},{name:"rate",default:1}],compile:({vars:[n=0,e=1],...t})=>hn[t.lang].defUgen(t,n,e)}),Tet=Xn("lag",{ugen:"Lag",tags:["fx"],description:"Smoothes a signal. Good for slide / portamento effects.",examples:[`impulse(2).seq(220,330,440,550)
.lag(.4).sine().out()`],ins:[{name:"in",default:0},{name:"rate",default:1,description:"60 dB lag time in seconds"}],compile:({vars:[n=0,e=1],...t})=>hn[t.lang].defUgen(t,n,e)}),Cet=Xn("slew",{ugen:"Slew",tags:["fx"],description:"Limits the slope of an input signal. The slope is expressed in units per second.",examples:["pulse(800).slew(4000, 4000).out()"],ins:[{name:"in",default:0},{name:"up",default:1,description:"Maximum upward slope in units per second"},{name:"dn",default:1,description:"Maximum downward slope in units per second"}],compile:({vars:[n=0,e=1,t=1],...i})=>hn[i.lang].defUgen(i,n,e,t)}),o1e=Xn("filter",{ugen:"Filter",tags:["fx","filter"],internal:!0,description:"Two-pole low-pass filter",examples:["saw(55).lpf( sine(1).range(.4,.8) ).out()"],ins:[{name:"in",default:0},{name:"cutoff",default:1},{name:"reso",default:0}],compile:({vars:[n=0,e=1,t=0],...i})=>hn[i.lang].defUgen(i,n,e,t)}),wet=Xn("fold",{ugen:"Fold",tags:["fx","distortion","limiter"],description:'Distort incoming audio signal by "folding"',examples:[`sine(55)
.fold( sine(.5).range(0.2,4) )
.out()`],ins:[{name:"in",default:0},{name:"rate",default:0}],compile:({vars:[n=0,e=0],...t})=>hn[t.lang].defUgen(t,n,e)}),Eet=Xn("seq",{ugen:"Sequence",tags:["sequencer"],description:"Trigger controlled sequencer",examples:[`impulse(2).seq(220,330,440,550)
.sine().out()`],ins:[{name:"trig",default:0},{name:"step",default:0,dynamic:!0,description:"step inputs"}],compile:({vars:n,...e})=>hn[e.lang].defUgen(e,...n)}),Ret=Xn("delay",{ugen:"Delay",tags:["fx"],description:"Delay line node",examples:[`impulse(1).ad(.01,.2).mul(sine(220))
.add(x=>x.delay(.1).mul(.8)).out()`],ins:[{name:"in",default:0},{name:"time",default:0}],compile:({vars:[n=0,e=0],...t})=>hn[t.lang].defUgen(t,n,e)}),Pet=Xn("hold",{ugen:"Hold",tags:["fx"],description:"Sample and hold",examples:[`noise().hold(impulse(2))
.range(220,880).sine().out()`],ins:[{name:"in",default:0},{name:"trig",default:0}],compile:({vars:[n=0,e=0],...t})=>hn[t.lang].defUgen(t,n,e)}),Det=Xn("midifreq",{ugen:"MidiFreq",tags:["external","midi"],description:"Outputs frequency of midi note in. Multiple instances will do voice allocation",examples:["midifreq().sine().out()"],ins:[{name:"channel",default:-1,description:"Channel filter. Defaults to all channels"}],compile:({vars:[n=-1],...e})=>hn[e.lang].defUgen(e,n)}),Net=Xn("midigate",{ugen:"MidiGate",tags:["external","midi"],description:"outputs gate of midi note in. Multiple instances will do voice allocation",examples:["midigate().lag(1).mul(sine(220)).out()"],ins:[{name:"channel",default:-1}],compile:({vars:[n=-1],...e})=>hn[e.lang].defUgen(e,n)}),Bet=Xn("midivel",{ugen:"MidiVel",tags:["external","midi"],description:"outputs velocity of midi note in. Multiple instances will do voice allocation",examples:["midigate().ar(0.01,0.2).mul(saw(midifreq())).mul(midivel()).mul(.8).out()"],ins:[{name:"channel",default:-1}],compile:({vars:[n=-1],...e})=>hn[e.lang].defUgen(e,n)}),Fet=Xn("midicc",{ugen:"MidiCC",tags:["external","midi"],description:"Outputs bipolar value of given midi cc number. initValue can be set to be the output before getting first cc message.",examples:["midicc(74).range(100,200).sine().out()"],ins:[{name:"ccnumber",default:-1},{name:"channel",default:-1},{name:"initValue",default:-1}],compile:({vars:[n=-1,e=-1],...t})=>hn[t.lang].defUgen(t,n,e)}),A6=Xn("cc",{ugen:"CC",tags:["external"],description:"CC control",ins:[{name:"id",default:0},{name:"value",default:0}],compile:({vars:[n],...e})=>hn[e.lang].defUgen(e,n)}),Let=Xn("audioin",{ugen:"AudioIn",tags:["source","external"],description:"External Audio Input, depends on your system input",examples:["audioin().add(x=>x.delay(.1).mul(.8)).out()"],ins:[],compile:n=>hn[n.lang].defUgen(n,"input")}),lz=Xn("log",{tags:["math"],description:"calculates the logarithm (base 10) of the input signal",ins:[{name:"in"}],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].log(n))}),l1e=Xn("exp",{tags:["math"],description:"raises e to the power of the input signal",ins:[{name:"in"}],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].exp(n))}),Iet=Xn("pow",{tags:["math"],description:"raises the input to the given power",ins:[{name:"in"},{name:"power"}],compile:({vars:[n=0,e=1],name:t,lang:i})=>hn[i].def(t,hn[i].pow(n,e))}),u1e=Xn("sin",{tags:["math"],description:"calculates the sine of the input signal",ins:[{name:"in"}],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].defSin(n))}),c1e=Xn("cos",{tags:["math"],description:"calculates the cosine of the input signal",ins:[{name:"in"}],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].defCos(n))}),Get=Xn("tan",{tags:["math"],description:"calculates the tan of the input signal",ins:[{name:"in"}],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].defTan(n))}),Oet=Xn("acos",{tags:["math"],description:"calculates the acos of the input signal",ins:[{name:"in"}],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].defAcos(n))}),Uet=Xn("asin",{tags:["math"],description:"calculates the asin of the input signal",ins:[{name:"in"}],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].defAsin(n))}),ket=Xn("atan",{tags:["math"],description:"calculates the atan of the input signal",ins:[{name:"in"}],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].defAtan(n))}),zet=Xn("mul",{tags:["math"],description:"Multiplies the given signals.",examples:["sine(220).mul( sine(4).range(.25,1) ).out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:n,name:e,lang:t})=>hn[t].def(e,n.join(" * ")||0)}),T6=Xn("add",{tags:["math"],description:"sums the given signals",examples:["n([0,3,7,10]).add(60).midinote().sine().mix(2).out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:n,name:e,lang:t})=>hn[t].def(e,n.join(" + ")||0)}),Vet=Xn("div",{tags:["math"],description:"adds the given signals",ins:[{name:"in",dynamic:!0}],compile:({vars:n,name:e,lang:t})=>hn[t].def(e,n.join(" / ")||0)}),Het=Xn("sub",{tags:["math"],description:"subtracts the given signals",ins:[{name:"in",dynamic:!0}],compile:({vars:n,name:e,lang:t})=>hn[t].def(e,n.join(" - ")||0)}),Xet=Xn("mod",{tags:["math"],description:"calculates the modulo",examples:["add(x=>x.add(.003).mod(1)).out()"],ins:[{name:"in"},{name:"modulo"}],compile:({vars:n,name:e,lang:t})=>hn[t].def(e,hn[t].mod(...n)||0)}),Wet=Xn("abs",{tags:["math"],description:"returns the absolute value of the signal",ins:[{name:"in"}],examples:["sine(440).abs().out()"],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].abs(n))}),Zet=Xn("round",{tags:["math"],description:"Rounds the signal to the nearest integer",ins:[{name:"in"}],examples:["sine(440.5).round().out()"],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].round(n))}),jet=Xn("clamp",{tags:["math"],description:"Clamps the signal to stay within the given range",ins:[{name:"in"},{name:"min"},{name:"max"}],examples:["sine(440.5).clamp(-.6,.6).out()"],compile:({vars:[n=0,e=-1,t=1],name:i,lang:r})=>{const s=hn[r].min(e,t),a=hn[r].max(e,t),o=hn[r].min(hn[r].max(n,s),a);return hn[r].def(i,o)}}),Yet=Xn("floor",{tags:["math"],description:"Rounds the signal down",ins:[{name:"in"}],examples:["sine(440.5).floor().out()"],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].floor(n))}),Ket=Xn("ceil",{tags:["math"],description:"Rounds the signal up",ins:[{name:"in"}],examples:["sine(440.5).ceil().out()"],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].ceil(n))}),$et=Xn("sign",{tags:["math"],description:"Returns 1 if positive and -1 if negative. uses Math.sign",ins:[{name:"in"}],examples:["sine(440.5).ceil().out()"],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,hn[t].sign(n))}),Jet=Xn("min",{tags:["math"],description:"returns the minimum of the given signals",examples:["impulse(4).apply(x => min(x.seq(0,3,2), x.seq(0,7,0,5,0)).add(48).midinote().sine()).out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:n,name:e,lang:t})=>hn[t].def(e,n.reduce(hn[t].min)||0)}),qet=Xn("max",{tags:["math"],description:"returns the maximum of the given signals",examples:["impulse(4).apply(x => max(x.seq(0,3,2), x.seq(0,7,0,5,0)).add(48).midinote().sine()).out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:n,name:e,lang:t})=>hn[t].def(e,n.reduce(hn[t].max)||0)}),Qet=Xn("argmin",{tags:["math"],description:"returns the index of the minimum of the given signals",examples:["argmin(saw(1), saw(3), saw(5)).mul(12).add(48).midinote().sine().out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:n,name:e,lang:t})=>hn[t].def(e,hn[t].pair_b(n.map(hn[t].pair_make).reduce(hn[t].pair_a_min))||0)}),ett=Xn("argmax",{tags:["math"],description:"returns the index of the maximum of the given signals",examples:["argmax(saw(1), saw(3), saw(5)).mul(12).add(48).midinote().sine().out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:n,name:e,lang:t})=>hn[t].def(e,hn[t].pair_b(n.map(hn[t].pair_make).reduce(hn[t].pair_a_max))||0)}),h1e=Xn("greater",{tags:["logic"],description:"returns 1 if input is greater then threshold",ins:[{name:"in"},{name:"threshold"}],examples:[`greater(sine(1),0)
.bipolar().range(100,200)
.sine().out()`],compile:({vars:[n=0,e=0],name:t,lang:i})=>hn[i].def(t,`${n} > ${e}`)}),d1e=Xn("lower",{tags:["logic"],description:"returns 1 if input is lower then threshold",ins:[{name:"in"},{name:"threshold"}],examples:[`lower(sine(1),0)
.bipolar().range(100,200)
.sine().out()`],compile:({vars:[n=0,e=0],name:t,lang:i})=>hn[i].def(t,`${n} < ${e}`)}),ttt=h1e,ntt=d1e,itt=Xn("xor",{tags:["logic"],description:"returns 1 if exactly one of the inputs is 1",ins:[{name:"a"},{name:"b"}],compile:({vars:[n=0,e=0],name:t,lang:i})=>hn[i].def(t,`${n} != ${e} ? 1 : 0`)}),rtt=Xn("and",{tags:["logic"],description:"returns 1 if both inputs are 1",ins:[{name:"a"},{name:"b"}],compile:({vars:[n=0,e=0],name:t,lang:i})=>hn[i].def(t,`${n} && ${e} ? 1 : 0`)}),stt=Xn("or",{tags:["logic"],description:"returns 1 if one or both inputs are 1",ins:[{name:"a"},{name:"b"}],compile:({vars:[n=0,e=0],name:t,lang:i})=>hn[i].def(t,`${n} || ${e} ? 1 : 0`)}),att=Xn("not",{tags:["logic"],description:"returns 1 if input is 0, otherwise 0",ins:[{name:"in"}],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,`(${n} === 0 ? 1 : 0)`)}),ott=Xn("bool",{tags:["logic"],description:"returns 1 signal is non zero. inspired by genish",ins:[{name:"a"}],compile:({vars:[n=0],name:e,lang:t})=>hn[t].def(e,`(${n} === 0 ? 0 : 1)`)}),ltt=Xn("ifelse",{tags:["logic"],description:"if control is 1, a is returned, otherwise b",ins:[{name:"control"},{name:"a"},{name:"b"}],compile:({vars:[n=0,e=0,t=0],name:i,lang:r})=>hn[r].def(i,`(${n} === 1 ? ${e} : ${t})`),examples:["ifelse(pulse(1), sine(220), sine(330)).out()"]}),utt=Xn("range",{tags:["math"],description:"Scales the incoming bipolar value to the given range.",examples:["sine(.5).range(.25,1).mul(sine(440)).out()"],ins:[{name:"in"},{name:"min"},{name:"max"}],compile:({vars:n,name:e,lang:t})=>{const[i,r,s,a=1]=n,o=`((${i} + 1) * 0.5)`,l=a===1?o:hn[t].pow(o,a);return hn[t].def(e,`${l} * (${s} - ${r}) + ${r}`)}}),ctt=Xn("remap",{ugen:"Remap",tags:["math"],description:"Remaps input from one value range to another",ins:[{name:"in"},{name:"inmin"},{name:"inmax"},{name:"outmin"},{name:"outmax"}],compile:({vars:[n=0,e=-1,t=1,i=-1,r=1],...s})=>hn[s.lang].defUgen(s,n,e,t,i,r)}),htt=Xn("thru",{compile:({name:n,vars:e,lang:t})=>hn[t].def(n,e[0],"thru")}),dtt=Lh("rangex",(n,e,t)=>{let i=lz(e),r=lz(t).sub(i),s=n.unipolar().mul(r).add(i);return l1e(s)},{tags:["math"],description:"exponential range",ins:[{name:"in"},{name:"min"},{name:"max"}],examples:["sine([1,3]).rangex(100, 2e3).sine().out()"]}),ftt=Xn("midinote",{compile:({vars:[n],name:e,lang:t})=>hn[t].def(e,hn[t].midinote(n)),tags:["math"],description:"convert midi number to frequency",ins:[{name:"midi"}],examples:[`impulse(4).seq(0,3,7,12).add(60)
.midinote().sine().out()`]}),ptt=Xn("src",{internal:!0,compile:({vars:[n=0],name:e,lang:t,...i})=>hn[t].def(e,i.getSource(n),`read source ${n}`)}),mtt=Xn("output",{internal:!0,ugen:"Output",compile:({vars:[n,e=0],name:t,lang:i,...r})=>{const s=r.getOutput(e),a=r.getSource(e);return[hn[i].def(s,[s,n].join(" + "),`+ output ${e}`),hn[i].def(a,s,`write source ${e}`)].join(`
`)}}),f1e=Xn("poly"),p1e=$d(Math.PI),gtt=Rl("fork",(n,e=1)=>f1e(...Array.from({length:e},()=>n.clone())),{ins:[{name:"in"},{name:"times"}],tags:["multi-channel"],description:"split the signal into n channels",examples:["dust(4).fork(2).adsr(.1).mul(sine(220)).out()"]}),ytt=Lh("perc",(n,e)=>n.adsr(0,0,1,e),{tags:["envelope"],description:"percussive envelope. usable with triggers or gates",ins:[{name:"gate"},{name:"release"}],examples:["impulse(4).perc(.1).mul( pink() ).out()"]}),vtt=Lh("hpf",(n,e,t=0)=>n.sub(n.lpf(e,t)),{ins:[{name:"in"},{name:"cutoff"},{name:"reso"}],description:"high pass filter",tags:["fx","filter"],examples:["tri([220,331,442]).mix().hpf(sine(.5).range(0,.9)).out()"]}),xtt=Lh("lpf",o1e,{ins:[{name:"in"},{name:"cutoff"},{name:"reso"}],description:"low pass filter",tags:["fx","filter"],examples:["saw(55).lpf( sine(1).range(.4,.8) ).out()"]}),btt=Xn("bpf",{ugen:"BPF",ins:[{name:"in"},{name:"cutoff"},{name:"reso"}],description:"high pass filter",tags:["fx","filter"],compile:({vars:[n=0,e=1,t=0],...i})=>hn[i.lang].defUgen(i,n,e,t)}),_tt=Lh("lfnoise",n=>s1e().hold(a1e(n)),{ins:[{name:"freq"}],description:"low frequency stepped noise.",tags:["regular","noise"],examples:["lfnoise(4).range(200,800).sine().out()"]}),Stt=Lh("bipolar",n=>$d(n).mul(2).sub(1),{ins:[{name:"in"}],description:"convert unipolar [0,1] signal to bipolar [-1,1]",tags:["math"]}),Mtt=Lh("unipolar",n=>$d(n).add(1).div(2),{ins:[{name:"in"}],description:"convert bipolar [-1,1] signal to unipolar [0,1]",tags:["math"]}),Att=Lh("pan",(n,e)=>(e=$d(e).add(1).mul(p1e,.25),n.mul([c1e(e),u1e(e)])),{ins:[{name:"in"},{name:"pos",description:"bipolar position: -1 = left, 0 = center, 1 = right"}],description:"pans signal to stereo position. splits signal path in 2",tags:["multi-channel"],examples:["sine(220).pan(sine(.25)).out()"]}),Ttt=Xn("pick",{tags:["multi-channel"],ugen:"Pick",description:"Pick",ins:[{name:"index"},{name:"inputs",dynamic:!0}],description:"picks input of given index",examples:[`sine(.25).range(0,2).round()
.pick(...sine([220,330,440]).ins)
.out()`],compile:({vars:n,...e})=>hn[e.lang].defUgen(e,...n)}),Ctt=Xn("clip",{tags:["fx"],ugen:"Clip",description:"Hard limits the signal between lo and hi.",ins:[{name:"input"},{name:"lo"},{name:"hi"}],compile:({vars:[n=0,e=-1,t=1],...i})=>hn[i.lang].defUgen(i,n,e,t)}),wtt=Xn("trig",{tags:["trigger"],ugen:"Trig",description:"Emits a trigger impulse whenever the signal becomes positive. Useful to turn gates into triggers.",ins:[{name:"input",default:0},{name:"lo",default:-1},{name:"hi",default:1}],compile:({vars:[n=0,e=-1,t=1],...i})=>hn[i.lang].defUgen(i,n,e,t),examples:[`pulse(2)
.trig() // comment out to hear difference
.ar(.01,.2)
.mul(sine(200)).out()`]}),Ett=Xn("qf",{tags:["fx","filter"],ugen:"BiquadFilter",description:"biQuad Filter.",ins:[{name:"input",default:0},{name:"type",default:0,description:"filter type: 0 = lowpass, 1 = highpass, 2 = band pass, 3 = notch, 4 = allpass, 5 = peaking, 6 = lowshelf, 7 = highshelf"},{name:"freq",default:500,description:"filter cutoff in Hz"},{name:"q",default:1,description:"q factor"},{name:"gain",default:1}],compile:({vars:n,...e})=>hn[e.lang].defUgen(e,...n),examples:[`pink()
.qf(
 impulse(.5).seq(0,1,2,3,4,5,6,7), // type
  tri(0.5).rangex(100, 8000),  // freq
 10, // Q
 1, // gain (only relevant for types 5-7)
).div(4).out();`]}),Rtt=Rl("qlpf",(n,e,t=10)=>n.qf(0,e,t),{description:"biQuad Low Pass Filter",ins:[{name:"input"},{name:"freq"},{name:"q",description:"resonance"}],tags:["fx","filter"],examples:[`pink().qlpf(
  tri(0.5).rangex(100, 8000), // cutoff freq
  10 // Q
).out()`]}),Ptt=Rl("qhpf",(n,e,t=10)=>n.qf(1,e,t),{description:"biQuad High pass filter",ins:[{name:"input"},{name:"freq"},{name:"q",description:"resonance"}],tags:["fx","filter"],examples:[`pink().qhpf(
  tri(0.5).rangex(100, 8000), // cutoff freq
  10 // Q
).out()`]}),Dtt=Rl("qbpf",(n,e,t=10)=>n.qf(2,e,t),{description:"biQuad Band Pass Filter",ins:[{name:"input"},{name:"freq"},{name:"q",description:"resonance"}],tags:["fx","filter"],examples:[`pink().qbpf(
  tri(0.5).rangex(100, 8000), // cutoff freq
  10 // Q
).out()`]}),Ntt=Rl("qnf",(n,e,t=10)=>n.qf(3,e,t),{description:"biQuad Notch Filter",ins:[{name:"input"},{name:"freq"},{name:"q",description:"resonance"}],tags:["fx","filter"],examples:[`pink().qnf(
  tri(0.5).rangex(100, 8000), // cutoff freq
  10 // Q
).out()`]}),Btt=Rl("qapf",(n,e,t=10)=>n.qf(3,e,t),{description:"biQuad All Pass Filter",ins:[{name:"input"},{name:"freq"},{name:"q",description:"resonance"}],tags:["fx","filter"],examples:[`impulse(1).qapf(
  tri(0.5).rangex(100, 8000), // cutoff freq
  10 // Q
).out()`]}),Ftt=Rl("split",(n,e)=>n.type!=="poly"?e([n]):e(n.ins),{ins:[{name:"input"},{name:"fn"}],tags:["multi-channel"],description:"apply fn to an array of signals, one for each channel in input",examples:["sine([220,330,550]).split(chs => add(...chs)).out()"]}),Ltt=Rl("mix",(n,e=1)=>{if([1,2].includes(e)||(e=2,console.warn("mix only supports 1 or 2 channels atm.. falling back to 2")),n.type!=="poly")return n;if(e===2){const t=n.ins.map((i,r,s)=>{const a=(r/(s.length-1)*2-1+1)*Math.PI/4;return i.mul([Math.cos(a),Math.sin(a)]).inherit(n)});return T6(...t)}return n.ins=n.ins.map(t=>t.inherit(n)),PM("mix").withIns(...n.ins)},{compile:({vars:n,name:e,lang:t})=>hn[t].def(e,`(${n.join(" + ")})`),description:`mixes down multiple channels. Useful to make sure you get a mono or stereo signal out at the end. 
When mixing down to 2 channels, the input channels are equally distributed over the stereo image, e.g. 3 channels are panned [-1,0,1]`,ins:[{name:"in"},{name:"channels",default:1,description:"how many channels to mix down to. Only supports 1 and 2"}],tags:["multi-channel"],examples:["sine([220,330,440]).mix(2).out()"]});zr.prototype.feedback=function(n){return this.add(n)};let Itt=n=>T6(n),Gtt=$d,Ott=$d,Utt=Lh("mouseX",()=>A6("mouseX"),{ins:[],description:"X position of mouse, bipolar range",tags:["external"],examples:["mouseX.range(100,800).sine().out()"]}),ktt=Utt(),ztt=Lh("mouseY",()=>A6("mouseY"),{ins:[],description:"Y position of mouse, bipolar range",tags:["external"],examples:["mouseY.range(800,100).sine().out()"]}),Vtt=ztt(),Htt=Rl("scope",(n,e)=>{let t=1;n.type==="poly"&&(t=n.ins.length);const i=getNode("scope",n,e,t);return i.type!=="poly"?(i.ins.push({type:"n",value:0,ins:[]}),i):(i.ins.forEach((r,s)=>r.ins.push({type:"n",value:s,ins:[]})),i)},{ugen:"Scope",description:"renders an an oscilloscope of the current point in the graph. expects values between -1 and 1. warning: this feature is still experimental! when using it, make sure to not switch tabs, as it might fry your browser.",compile:({vars:[n,e,t,i],...r})=>M6(r,n,e,t,i)});const HK=Object.freeze(Object.defineProperty({__proto__:null,B:Gtt,PI:p1e,_:Ott,abs:Wet,acos:Oet,ad:cet,add:T6,adsr:oet,and:rtt,ar:uet,argmax:ett,argmin:Qet,asin:Uet,atan:ket,audioin:Let,bipolar:Stt,bool:ott,bpf:btt,brown:get,bytebeat:set,cc:A6,ceil:Ket,clamp:jet,clip:Ctt,clock:het,clockdiv:det,cos:c1e,delay:Ret,distort:fet,div:Vet,dust:yet,exp:l1e,feedback:Itt,filter:o1e,floatbeat:aet,floor:Yet,fold:wet,fork:gtt,greater:h1e,gt:ttt,hold:Pet,hpf:vtt,ifelse:ltt,impulse:a1e,lag:Tet,lfnoise:_tt,log:lz,lower:d1e,lpf:xtt,lt:ntt,max:qet,midicc:Fet,midifreq:Det,midigate:Net,midinote:ftt,midivel:Bet,min:Jet,mix:Ltt,mod:Xet,mouseX:ktt,mouseY:Vtt,mul:zet,noise:s1e,not:att,or:stt,output:mtt,pan:Att,perc:ytt,pick:Ttt,pink:met,poly:f1e,pow:Iet,pulse:Met,qapf:Btt,qbpf:Dtt,qf:Ett,qhpf:Ptt,qlpf:Rtt,qnf:Ntt,range:utt,rangex:dtt,raw:ret,registerUgen:r1e,remap:ctt,rng:pet,round:Zet,saw:vet,scope:Htt,seq:Eet,sign:$et,sin:u1e,sine:bet,slew:Cet,slide:Aet,split:Ftt,src:ptt,sub:Het,tan:Get,thru:htt,time:iet,tri:_et,trig:wtt,unipolar:Mtt,xor:itt,zaw:xet},Symbol.toStringTag,{value:"Module"}));class Xtt{constructor({onToggle:e,onToggleRecording:t,beforeEval:i,transpiler:r,localScope:s=!1,outputNode:a=null}={}){this.outputNode=a,this.audio=new DQe(this.outputNode),this.onToggle=e,this.transpiler=r,this.onToggleRecording=t,this.beforeEval=i,this.localScope=s,typeof window<"u"&&(s||(Object.assign(globalThis,VK),Object.assign(globalThis,HK),Object.assign(globalThis,zK),Object.assign(globalThis,{repl:this})),window.addEventListener("message",l=>{l.data.type==="KABELSALAT_SET_CONTROL"&&this.audio.setControl(l.data.id,l.data.value)}));const o=this;zr.prototype.spawn=function(l=[0,1],u){o.audio.spawn(this.output(l).exit(),u)}}registerUgen(e,t){return this.audio.registerUgen(t),r1e(e,t.name)}evaluate(e){this.localScope||(Object.assign(globalThis,{audio:this.audio}),Object.assign(globalThis,{addUgen:this.registerUgen.bind(this)}));let t;this.transpiler?t=this.transpiler(e):t={output:e},this.beforeEval?.(t);let i;return this.localScope&&(i={...VK,...HK,...zK,audio:this.audio,addUgen:this.registerUgen.bind(this),repl:this}),t1e(t.output,i)}async play(e){await this.audio.init(),e.ins.length&&this.audio.spawn(e),this.onToggle?.(!0)}run(e){const t=this.evaluate(e);this.play(t)}stop(){this.stopRecording(),this.audio.stop(),this.onToggle?.(!1)}record(){this.audio.record(),this.onToggleRecording?.(!0)}stopRecording(){this.audio.stopRecording(),this.onToggleRecording?.(!1)}}function Wtt({defaultOutput:n,onEvalError:e,beforeEval:t,beforeStart:i,afterEval:r,getTime:s,transpiler:a,onToggle:o,editPattern:l,onUpdateState:u,sync:c=!1,setInterval:d,clearInterval:f,id:m,mondo:y=!1}){const _=new Xtt({localScope:!0}),S={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},b={id:m},M=ce=>{Object.assign(S,ce),S.isDirty=S.code!==S.activeCode,S.error=S.evalError||S.schedulerError,u?.(S)},w={onTrigger:m1e({defaultOutput:n,getTime:s}),getTime:s,onToggle:ce=>{M({started:ce}),qve(ce),o?.(ce),ce||zve()},setInterval:d,clearInterval:f,beforeStart:i},T=c&&typeof SharedWorker<"u"?new Wqe(w):new kve(w);Jve(w.onTrigger),Kve(()=>T.cps);let E={},R=0,P;const I=function(){return E={},R=0,P=void 0,ws},B=ce=>_.evaluate(ce).compile({log:!1});function N(ce){return ce._Pattern?ce.__pure:ce}const U=async(ce,Ce=!0)=>(ce=l?.(ce)||ce,await T.setPattern(ce,Ce),$ve(ce),ce);o2(()=>T.now());const V=()=>T.stop(),W=()=>T.start(),K=()=>T.pause(),q=()=>T.toggle(),j=ce=>(T.setCps(N(ce)),ws),te=ce=>(T.setCps(N(ce)/60),ws);let he=[];const _e=function(ce){return he.push(ce),ws},Be=function(ce){return P=ce,ws},ue=()=>{pn.prototype.p=function(Ce){return typeof Ce=="string"&&(Ce.startsWith("_")||Ce.endsWith("_"))?ws:(Ce.includes("$")&&(Ce=`${Ce}${R}`,R++),E[Ce]=this,this)},pn.prototype.q=function(Ce){return ws};try{for(let Ce=1;Ce<10;++Ce)Object.defineProperty(pn.prototype,`d${Ce}`,{get(){return this.p(Ce)},configurable:!0}),Object.defineProperty(pn.prototype,`p${Ce}`,{get(){return this.p(Ce)},configurable:!0}),pn.prototype[`q${Ce}`]=ws}catch(Ce){console.warn("injectPatternMethods: error:",Ce)}const ce=Nt("cpm",function(Ce,Oe){return Oe._fast(Ce/60/T.cps)});return a2({all:_e,each:Be,hush:I,cpm:ce,setCps:j,setcps:j,setCpm:te,setcpm:te,compileKabel:B})};return{scheduler:T,evaluate:async(ce,Ce=!0,Oe=!0)=>{if(!ce)throw new Error("no code to evaluate");try{M({code:ce,pending:!0}),await ue(),o2(()=>T.now()),await t?.({code:ce}),he=[],Oe&&I(),y&&(ce=`mondolang\`${ce}\``);let{pattern:nt,meta:Ae}=await fce(ce,a,b);if(Object.keys(E).length){let Ye=[],ft=!1;for(const[ze,ot]of Object.entries(E)){const ut=ze.length>1&&ze.startsWith("S");if(ut&&ft===!1&&(Ye=[],ft=!0),!ft||ft&&ut){const Wt=ot.withState(It=>It.setControls({id:ze}));Ye.push(Wt)}}P&&(Ye=Ye.map(ze=>P(ze))),nt=Ma(...Ye)}else P&&(nt=P(nt));if(he.length)for(const Ye of he)nt=Ye(nt);return u6(nt)||(nt=ws),Cl("[eval] code updated"),nt=await U(nt,Ce),M({miniLocations:Ae?.miniLocations||[],widgets:Ae?.widgets||[],activeCode:ce,pattern:nt,evalError:void 0,schedulerError:void 0,pending:!1}),r?.({code:ce,pattern:nt,meta:Ae}),nt}catch(nt){Cl(`[eval] error: ${nt.message}`,"error"),console.error(nt),M({evalError:nt,pending:!1}),e?.(nt)}},start:W,stop:V,pause:K,setCps:j,setPattern:U,setCode:ce=>M({code:ce}),toggle:q,state:S}}const m1e=({getTime:n,defaultOutput:e})=>async(t,i,r,s,a)=>{try{(!t.context.onTrigger||!t.context.dominantTrigger)&&await e(t,i,r,s,a),t.context.onTrigger&&await t.context.onTrigger(t,n(),s,a)}catch(o){JR(o,"getTrigger")}};function Ztt(n){return new pn(e=>[new va(void 0,e.span,n)])}const sc=n=>{const e=t=>[new va(void 0,t.span,n(t.span.begin,t.controls))];return new pn(e)},QR=sc(n=>n%1),C6=QR.toBipolar(),BL=sc(n=>1-n%1),w6=BL.toBipolar(),E6=sc(n=>Math.sin(Math.PI*2*n)),g1e=E6.fromBipolar(),jtt=g1e._early(Sn(1).div(4)),Ytt=E6._early(Sn(1).div(4)),y1e=sc(n=>Math.floor(n*2%2)),Ktt=y1e.toBipolar(),$tt=wu(QR,BL),Jtt=wu(C6,w6),qtt=wu(BL,QR),Qtt=wu(w6,C6),ent=sc(XS);let R6=0,P6=0;typeof window<"u"&&document.addEventListener("mousemove",n=>{R6=n.clientY/document.body.clientHeight,P6=n.clientX/document.body.clientWidth});const tnt=sc(()=>R6),nnt=sc(()=>R6),int=sc(()=>P6),rnt=sc(()=>P6),snt=n=>(n|=0,n^=n>>>16,n=Math.imul(n,2246822507),n^=n>>>13,n=Math.imul(n,3266489909),n^=n>>>16,n>>>0),ant=n=>Math.floor(n*536870912),ont=(n,e=0,t=0)=>{const i=n>>>0>>>0,r=Math.floor(n/4294967296)>>>0;let s=i^Math.imul(r^2246822507,3266489909);return s^=Math.imul(e^2135587861,2654435769),s^=Math.imul(t^374761393,668265261),s>>>0},XK=(n,e=0,t=0)=>snt(ont(n,e,t))/4294967296,lnt=(n,e,t=0)=>{const i=ant(n);if(e===1)return XK(i,0,t);const r=new Array(e);for(let s=0;s<e;s++)r[s]=XK(i,s,t);return r},v1e=n=>{const e=n<<13^n,t=e>>17^e;return t<<5^t},unt=n=>n-Math.trunc(n),cnt=n=>v1e(Math.trunc(unt(n/300)*536870912)),WK=n=>n%536870912/536870912,hnt=(n,e)=>{if(e===1)return Math.abs(WK(n));const t=[];for(let i=0;i<e;i++)t.push(WK(n)),n=v1e(n);return t},dnt=(n,e)=>hnt(cnt(n),e);let x1e="legacy";const Hv=(n,e=1,t=0)=>x1e==="legacy"?dnt(n+t,e):lnt(n,e,t),fnt=(n="legacy")=>x1e=n,b1e=n=>QR.range(0,n).round().segment(n),pnt=n=>{const e=xn(n).log2(0).floor().add(1);return _1e(n,e)},_1e=(n,e=16)=>{e=xn(e);const t=b1e(e).mul(-1).add(e.sub(1));return xn(n).segment(e).brshift(t).band($s(1))},mnt=n=>{const e=xn(n).log2(0).floor().add(1);return S1e(n,e)},S1e=(n,e=16)=>xn(n).withValue(t=>i=>{const r=[];for(let s=i-1;s>=0;s--)r.push(t>>s&1);return r}).appLeft(xn(e)),gnt=n=>sc(e=>t=>Hv(e,t).map(Math.abs)).appLeft(xn(n)),M1e=n=>sc((e,t)=>{const i=Hv(e.floor().add(.5),n,t.randSeed).map((s,a)=>[s,a]).sort((s,a)=>(s[0]>a[0])-(s[0]<a[0])).map(s=>s[1]),r=e.cyclePos().mul(n).floor()%n;return i[r]})._segment(n),A1e=(n,e,t)=>{const i=[...Array(e).keys()].map(r=>t.zoom(Sn(r).div(e),Sn(r+1).div(e)));return n.fmap(r=>i[r].repeatCycles(e)._fast(e)).innerJoin()},ynt=Nt("shuffle",(n,e)=>A1e(M1e(n),n,e)),vnt=Nt("scramble",(n,e)=>A1e(N6(n)._segment(n),n,e)),T1e=(n,e)=>new pn(t=>{let{randSeed:i,...r}=t.controls;return i=n(i),e.query(t.setControls({...r,randSeed:i}))},e._steps),xnt=Nt("seed",(n,e)=>T1e(()=>n,e)),rc=sc((n,e)=>Hv(n,1,e.randSeed)),bnt=rc.toBipolar(),D6=n=>rc.fmap(e=>e<n),_nt=n=>xn(n).fmap(D6).innerJoin(),Snt=D6(.5),N6=n=>rc.fmap(e=>Math.trunc(e*n)),Mnt=n=>xn(n).fmap(N6).innerJoin(),B6=(n,e)=>(e=e.map(xn),e.length==0?ws:n.range(0,e.length).fmap(t=>{const i=Math.min(Math.max(Math.floor(t),0),e.length-1);return e[i]})),FL=(n,e)=>B6(n,e).outerJoin(),LL=(n,e)=>B6(n,e).innerJoin(),C1e=(...n)=>FL(rc,n),Ant=(...n)=>LL(rc,n),Tnt=C1e;pn.prototype.choose=function(...n){return FL(this,n)};pn.prototype.choose2=function(...n){return FL(this.fromBipolar(),n)};const w1e=(...n)=>LL(rc.segment(1),n),Cnt=w1e,E1e=function(n,...e){const t=e.map(o=>xn(o[0])),i=[];let r=$s(0);for(const o of e)r=r.add(o[1]),i.push(r);const s=mce(i),a=function(o){const l=r.mul(o);return s.fmap(u=>c=>t[u.findIndex(d=>d>c,u)]).appLeft(l)};return n.bind(a)},wnt=(...n)=>E1e(...n).outerJoin(),Ent=(...n)=>wnt(rc,...n),R1e=(...n)=>E1e(rc.segment(1),...n).innerJoin(),Rnt=R1e;function Pnt(n,e=0){let t=Math.floor(n),i=t+1;const r=l=>6*l**5-15*l**4+10*l**3,s=l=>u=>c=>u+r(l)*(c-u),a=Hv(t,1,e),o=Hv(i,1,e);return s(n-t)(a)(o)}function Dnt(n,e=0){const t=Math.floor(n),i=t+1,r=Hv(t,1,e),s=Hv(i,1,e),a=r+s,o=(n-t)/(i-t);return((l,u,c)=>l+c*(u-l))(r,a,o)/2}const Nnt=sc((n,e)=>Pnt(n,e.randSeed)),Bnt=sc((n,e)=>Dnt(n,e.randSeed)),Fnt=Nt("degradeByWith",(n,e,t)=>t.fmap(i=>r=>i).appLeft(n.filterValues(i=>i>e)),!0,!0),Lnt=Nt("degradeBy",function(n,e){return e._degradeByWith(rc,n)},!0,!0),Int=Nt("degrade",n=>n._degradeBy(.5),!0,!0),Gnt=Nt("undegradeBy",function(n,e){return e._degradeByWith(rc.fmap(t=>1-t),n)},!0,!0),Ont=Nt("undegrade",n=>n._undegradeBy(.5),!0,!0),Unt=Nt("sometimesBy",function(n,e,t){return xn(n).fmap(i=>Ma(t._degradeBy(i),e(t._undegradeBy(1-i)))).innerJoin()}),knt=Nt("sometimes",function(n,e){return e._sometimesBy(.5,n)}),znt=Nt("someCyclesBy",function(n,e,t){return xn(n).fmap(i=>Ma(t._degradeByWith(rc._segment(1),i),e(t._degradeByWith(rc.fmap(r=>1-r)._segment(1),1-i)))).innerJoin()}),Vnt=Nt("someCycles",function(n,e){return e._someCyclesBy(.5,n)}),Hnt=Nt("often",function(n,e){return e.sometimesBy(.75,n)}),Xnt=Nt("rarely",function(n,e){return e.sometimesBy(.25,n)}),Wnt=Nt("almostNever",function(n,e){return e.sometimesBy(.1,n)}),Znt=Nt("almostAlways",function(n,e){return e.sometimesBy(.9,n)}),jnt=Nt("never",function(n,e){return e}),Ynt=Nt("always",function(n,e){return n(e)});function F6(n){Array.isArray(n)===!1&&(n=[n]);const e=hce();return n.every(t=>{const i=cce.get(t)??t;return e[i]})}const Knt=Nt("whenKey",function(n,e,t){return t.when(F6(n),e)}),$nt=Nt("keyDown",function(n){return n.fmap(F6)}),Jnt=new pn(function(n){return[new va(void 0,n.span,n.span.duration)]}),P1e=new pn(function(n){return[new va(void 0,n.span,Sn(1).div(n.span.duration))]}),qnt=P1e,Qnt=new pn(function(n){const e=Sn(1).div(n.span.duration);return[new va(void 0,n.span,Math.log(e)/Math.log(2)+1)]});let l2;try{l2=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let ZK=l2?.getVoices();function eit(n,e,t){l2.cancel();const i=new SpeechSynthesisUtterance(n);i.lang=e,ZK=l2.getVoices();const r=ZK.filter(s=>s.lang.includes(e));typeof t=="number"?i.voice=r[t%r.length]:typeof t=="string"&&(i.voice=r.find(s=>s.name===s)),speechSynthesis.speak(i)}const tit=Nt("speak",function(n,e,t){return t.onTrigger(i=>{eit(i.value,n,e)})}),nit=function(n,e={}){const t=document.getElementById("code"),i="background-image:url("+n+");background-size:contain;";t.style=i;const{className:r}=t,s=(o,l)=>{({style:()=>t.style=i+";"+l,className:()=>t.className=l+" "+r})[o]()},a=Object.entries(e).filter(([o,l])=>typeof l=="function");Object.entries(e).filter(([o,l])=>typeof l=="string").forEach(([o,l])=>s(o,l)),a.length},iit=()=>{const n=document.getElementById("code");n&&(n.style="")};Cl(" @strudel/core loaded ");globalThis._strudelLoaded&&console.warn(`@strudel/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel/core".`);globalThis._strudelLoaded=!0;const D1e=Object.freeze(Object.defineProperty({__proto__:null,ClockCollator:uce,Cyclist:kve,FXr:Lve,FXrel:Fve,FXrelease:Bve,Fraction:Sn,Hap:va,Pattern:pn,State:RM,TimeSpan:uo,__chooseWith:B6,_brandBy:D6,_fitslice:Mce,_irand:N6,_keyDown:F6,_match:Ace,_mod:zd,_morph:m6,_polymeterListSteps:Cce,_retime:ez,_slices:tz,accelerate:Dhe,activeLabel:Qge,ad:sve,add:FKe,adsr:rve,almostAlways:Znt,almostNever:Wnt,always:Ynt,amp:Ihe,analyze:$fe,anchor:w0e,and:QKe,apply:R$e,applyN:Sce,ar:ove,arp:fKe,arpWith:dKe,arrange:xKe,as:wve,asym:lqe,att:Ohe,attack:Ghe,averageArray:que,backgroundImage:nit,band:kKe,bandf:spe,bandq:lpe,bank:Yfe,base64ToUnicode:oce,bbexpr:Npe,bbst:Fpe,beat:nqe,begin:cpe,berlin:Bnt,bgain:f0e,binary:pnt,binaryL:mnt,binaryN:_1e,binaryNL:S1e,bind:TKe,binshift:Pye,bite:L$e,bjork:Mqe,bjorklund:b6,blshift:HKe,bmod:Dve,bor:zKe,bp:ope,bpa:fme,bpattack:dme,bpd:xme,bpdc:Yme,bpdecay:vme,bpdepth:Xme,bpdepthfreq:Zme,bpdepthfrequency:Wme,bpe:ome,bpenv:ame,bpf:ape,bpq:upe,bpr:Dme,bprate:Vme,bprelease:Pme,bps:Tme,bpshape:jme,bpskew:Kme,bpsustain:Ame,bpsync:Hme,brak:W$e,brand:Snt,brandBy:_nt,brshift:XKe,bus:h0e,busgain:d0e,bxor:VKe,bypass:SJe,byteBeatExpression:Dpe,byteBeatStartTime:Bpe,calculateSteps:uKe,cat:yE,ccn:fve,ccv:pve,ceil:r$e,ch:Ipe,channel:$pe,channels:Lpe,chebyshev:hqe,choose:C1e,chooseCycles:w1e,chooseIn:Ant,chooseInWith:LL,chooseOut:Tnt,chooseWith:FL,chop:ZJe,chord:A0e,chorus:Kfe,chunk:hJe,chunkBack:pJe,chunkBackInto:_Je,chunkInto:xJe,chunkback:mJe,chunkbackinto:bJe,chunkinto:vJe,clamp:EL,cleanupUi:iit,clip:Vye,coarse:vpe,code2hash:tKe,color:nve,colour:ive,comb:wye,compose:HYe,compress:h$e,compressSpan:d$e,compressor:J0e,compressorAttack:eye,compressorKnee:q0e,compressorRatio:Q0e,compressorRelease:tye,compressspan:f$e,constant:XYe,contract:Nce,control:dve,controls:xqe,cosine:jtt,cosine2:Ytt,cpm:P$e,cps:zye,createClock:Uve,createParam:DL,createParams:v6,crush:ype,ctf:Qpe,ctlNum:mve,ctranspose:i0e,cubic:aqe,curry:ur,curve:jye,cut:Jpe,cutoff:qpe,cycleToSeconds:Jk,cyclesPer:Jnt,dec:Qfe,decay:qfe,degrade:Int,degradeBy:Lnt,degradeByWith:Fnt,degree:t0e,delay:vge,delayfb:bge,delayfeedback:xge,delayspeed:Sge,delaysync:Cge,delayt:Age,delaytime:Mge,deltaSlide:Yye,det:Rge,detune:Ege,dfb:_ge,dict:C0e,dictionary:T0e,diode:oqe,dist:Y0e,distort:j0e,distorttype:$0e,distortvol:K0e,div:GKe,djf:yge,drawLine:dce,drive:Cpe,drop:Rce,dry:Nge,ds:ave,dt:Tge,duck:wpe,duckattack:Ppe,duckdepth:Epe,duckonset:Rpe,dur:Wye,duration:Xye,early:D$e,echo:iJe,echoWith:Q$e,echowith:eJe,eish:Rqe,end:hpe,enhance:Cye,env:Pve,eq:KKe,eqt:$Ke,errorLogger:JR,euclid:Sqe,euclidLegato:Cqe,euclidLegatoRot:wqe,euclidRot:Tqe,euclidish:Eqe,euclidrot:Aqe,evalScope:a2,evaluate:fce,every:E$e,expand:Dce,expression:oye,extend:Pce,fadeInTime:Lge,fadeOutTime:Fge,fadeTime:Bge,fanchor:Bme,fast:b$e,fastChunk:yJe,fastGap:p$e,fastcat:wu,fastchunk:gJe,fastgap:m$e,fft:Jfe,filter:wJe,filterWhen:EJe,firstOf:w$e,fit:JJe,flatten:Kg,floor:i$e,fm:ide,fm1:rde,fm2:sde,fm3:ade,fm4:ode,fm5:lde,fm6:ude,fm7:cde,fm8:hde,fmatt:Pde,fmatt1:Dde,fmatt2:Nde,fmatt3:Bde,fmatt4:Fde,fmatt5:Lde,fmatt6:Ide,fmatt7:Gde,fmatt8:Ode,fmattack:_de,fmattack1:Sde,fmattack2:Mde,fmattack3:Ade,fmattack4:Tde,fmattack5:Cde,fmattack6:wde,fmattack7:Ede,fmattack8:Rde,fmdec:ife,fmdec1:rfe,fmdec2:sfe,fmdec3:afe,fmdec4:ofe,fmdec5:lfe,fmdec6:ufe,fmdec7:cfe,fmdec8:hfe,fmdecay:Yde,fmdecay1:Kde,fmdecay2:$de,fmdecay3:Jde,fmdecay4:qde,fmdecay5:Qde,fmdecay6:efe,fmdecay7:tfe,fmdecay8:nfe,fmenv:dde,fmenv1:fde,fmenv2:pde,fmenv3:mde,fmenv4:gde,fmenv5:yde,fmenv6:vde,fmenv7:xde,fmenv8:bde,fmh:Uhe,fmh1:khe,fmh2:zhe,fmh3:Vhe,fmh4:Hhe,fmh5:Xhe,fmh6:Whe,fmh7:Zhe,fmh8:jhe,fmi:Yhe,fmi1:Khe,fmi2:$he,fmi3:Jhe,fmi4:qhe,fmi5:Qhe,fmi6:ede,fmi7:tde,fmi8:nde,fmrel:Ufe,fmrel1:kfe,fmrel2:zfe,fmrel3:Vfe,fmrel4:Hfe,fmrel5:Xfe,fmrel6:Wfe,fmrel7:Zfe,fmrel8:jfe,fmrelease:Pfe,fmrelease1:Dfe,fmrelease2:Nfe,fmrelease3:Bfe,fmrelease4:Ffe,fmrelease5:Lfe,fmrelease6:Ife,fmrelease7:Gfe,fmrelease8:Ofe,fmsus:_fe,fmsus1:Sfe,fmsus2:Mfe,fmsus3:Afe,fmsus4:Tfe,fmsus5:Cfe,fmsus6:wfe,fmsus7:Efe,fmsus8:Rfe,fmsustain:dfe,fmsustain1:ffe,fmsustain2:pfe,fmsustain3:mfe,fmsustain4:gfe,fmsustain5:yfe,fmsustain6:vfe,fmsustain7:xfe,fmsustain8:bfe,fmwave:Ude,fmwave1:kde,fmwave2:zde,fmwave3:Vde,fmwave4:Hde,fmwave5:Xde,fmwave6:Wde,fmwave7:Zde,fmwave8:jde,focus:g$e,focusSpan:y$e,focusspan:v$e,fold:uqe,fractionalArgs:WYe,frameRate:Bye,frames:Fye,freeze:_ye,freq:Ige,freqToMidi:i6,fromBipolar:a$e,fshift:uye,fshiftnote:cye,fshiftphase:hye,ftype:Nme,func:t$e,fxr:Ive,gain:Fhe,gap:yA,gat:Kge,gate:Yge,getAccidentalsOffset:n6,getControlName:xE,getCps:Zqe,getCurrentKeyboardState:hce,getEventOffsetMs:OYe,getFreq:Jue,getFrequency:ece,getIsStarted:Kqe,getPattern:jqe,getPerformanceTimeSeconds:iKe,getPlayableNoteValue:VYe,getRandsAtTime:Hv,getSoundIndex:zYe,getTime:rz,getTrigger:m1e,getTriggerFunc:Yqe,grow:DJe,gt:ZKe,gte:YKe,hard:sqe,harmonic:r0e,hash2code:nKe,hbrick:Dye,hcutoff:cge,hold:rpe,hours:Lye,hp:dge,hpa:hme,hpattack:cme,hpd:yme,hpdc:nge,hpdecay:gme,hpdepth:qme,hpdepthfreq:ege,hpdepthfrequency:Qme,hpe:sme,hpenv:rme,hpf:hge,hpq:pge,hpr:Rme,hprate:$me,hprelease:Eme,hps:Mme,hpshape:tge,hpskew:ige,hpsustain:Sme,hpsync:Jme,hresonance:fge,hsl:CJe,hsla:TJe,hurry:_$e,id:XS,imag:Tye,inhabit:kqe,inhabitmod:Vqe,innerBind:CKe,inside:A$e,inv:V$e,invert:z$e,ir:O0e,irand:Mnt,irbegin:z0e,iresponse:U0e,irspeed:k0e,isControlName:kce,isNote:Ub,isNoteWithOctave:FYe,isPattern:u6,isaw:BL,isaw2:w6,iter:oJe,iterBack:lJe,iterback:uJe,itri:qtt,itri2:Qtt,jux:q$e,juxBy:$$e,juxby:J$e,kcutoff:pye,keep:NKe,keepif:BKe,keyAlias:cce,keyDown:$nt,krush:fye,label:e0e,lastOf:C$e,late:bce,lbrick:Nye,legato:Hye,leslie:$ge,lfo:Rve,linger:I$e,listRange:qR,lock:wge,logKey:e6,logger:Cl,loop:dpe,loopAt:KJe,loopAtCps:qJe,loopBegin:fpe,loopEnd:mpe,loopat:$Je,loopatcps:QJe,loopb:ppe,loope:gpe,lp:tme,lpa:ume,lpattack:lme,lpd:mme,lpdc:kme,lpdecay:pme,lpdepth:Ime,lpdepthfreq:Ome,lpdepthfrequency:Gme,lpe:ime,lpenv:nme,lpf:eme,lpq:gge,lpr:wme,lprate:Fme,lprelease:Cme,lps:_me,lpshape:Ume,lpskew:zme,lpsustain:bme,lpsync:Lme,lrate:Jge,lsize:qge,lt:WKe,lte:jKe,mapArgs:s6,mask:_Ke,midi2note:kYe,midiToFreq:EM,midibend:Sve,midichan:lve,midicmd:hve,midimap:uve,midiport:cve,miditouch:Mve,minutes:Iye,mod:OKe,mode:P0e,morph:iqe,mouseX:rnt,mouseY:nnt,mousex:int,mousey:tnt,mtranspose:n0e,mul:IKe,n:Rhe,nanFallback:Que,ne:JKe,net:qKe,never:jnt,noise:oge,note:Phe,noteToMidi:Rm,nothing:Qf,nrpnn:gve,nrpv:yve,nudge:o0e,numeralArgs:hh,objectMap:lce,oct:u0e,octave:l0e,octaveR:a0e,octaves:R0e,octer:mye,octersub:gye,octersubsub:yye,off:X$e,offset:E0e,often:Hnt,or:e$e,orbit:c0e,oschost:Tve,oscport:Cve,outerBind:wKe,outside:T$e,overgain:p0e,overshape:m0e,pace:Tce,pairs:rce,palindrome:K$e,pan:g0e,panchor:jge,panorient:b0e,panspan:y0e,pansplay:v0e,panwidth:x0e,parray:g6,parseFractional:ice,parseNumeral:r6,partials:dqe,patt:Oge,pattack:Gge,pcurve:Zge,pdec:kge,pdecay:Uge,penv:Wge,per:P1e,perCycle:qnt,perlin:Nnt,perx:Qnt,ph:zpe,phasdp:Kpe,phaser:Vpe,phasercenter:Wpe,phaserdepth:jpe,phaserrate:kpe,phasersweep:Hpe,phases:fqe,phc:Zpe,phd:Ype,phs:Xpe,pick:Hve,pickF:Nqe,pickOut:Fqe,pickReset:Oqe,pickRestart:Iqe,pickSqueeze:zqe,pickmod:Xve,pickmodF:Bqe,pickmodOut:Lqe,pickmodReset:Uqe,pickmodRestart:Gqe,pickmodSqueeze:Hqe,pipe:nce,pitchJump:Kye,pitchJumpTime:$ye,ply:x$e,plyForEach:aJe,plyWith:sJe,pm:yKe,polyBind:PKe,polyTouch:Ave,polymeter:RL,polyrhythm:mKe,postgain:Lhe,pow:UKe,pr:gKe,prel:Xge,prelease:Hge,press:Y$e,pressBy:j$e,progNum:vve,psus:Vge,psustain:zge,pure:$s,pw:Gpe,pwrate:Ope,pwsweep:Upe,rand:rc,rand2:bnt,randL:gnt,randcat:Cnt,randrun:M1e,range:o$e,range2:u$e,rangex:l$e,rarely:Xnt,ratio:c$e,rdim:L0e,real:Aye,ref:eqe,register:Nt,registerControl:we,registerMultiControl:Um,reify:xn,rel:ipe,release:npe,removeUndefineds:kb,repeatCycles:cJe,repl:Wtt,replicate:PJe,reset_state:zve,reset_timelines:Vve,resonance:mge,rev:_ce,revv:Z$e,rfade:G0e,rib:AJe,ribbon:MJe,ring:vye,ringdf:bye,ringf:xye,rlp:B0e,room:D0e,roomdim:F0e,roomfade:I0e,roomlp:N0e,roomsize:V0e,rotate:tce,round:n$e,rsize:W0e,run:b1e,s:zce,s_add:OJe,s_alt:FJe,s_cat:BJe,s_contract:VJe,s_expand:kJe,s_extend:zJe,s_polymeter:LJe,s_sub:UJe,s_taper:IJe,s_taperlist:GJe,s_tour:HJe,s_zip:XJe,saw:QR,saw2:C6,scram:Rye,scramble:vnt,scrub:Eve,seconds:Gye,seed:xnt,seg:O$e,segment:G$e,semitone:S0e,seq:xce,seqPLoop:bKe,sequence:ep,sequenceP:mce,set:DKe,setCpsFunc:Kve,setIsStarted:qve,setPattern:$ve,setStringParser:pce,setTime:o2,setTriggerFunc:Jve,shape:Z0e,shrink:Fce,shrinklist:Bce,shuffle:ynt,signal:sc,silence:ws,sine:g1e,sine2:E6,sinefold:cqe,size:H0e,slice:Oce,slide:_0e,slow:S$e,slowChunk:fJe,slowcat:s1,slowcatPrime:h6,slowchunk:dJe,smear:Eye,soft:rqe,sol2note:qYe,someCycles:Vnt,someCyclesBy:znt,sometimes:knt,sometimesBy:Unt,songPtr:Oye,sound:Vce,source:whe,sparsity:M$e,speak:tit,speed:y6,splice:YJe,splitAt:a6,spread:Dge,square:y1e,square2:Ktt,squeeze:Xqe,squeezeBind:EKe,squiz:rye,src:Ehe,stack:Ma,stackBy:vKe,stackCentre:vce,stackLeft:gce,stackRight:yce,steady:Ztt,stepBind:RKe,stepalt:wce,stepcat:Yc,steps:WJe,stepsPerOctave:s0e,stretch:nye,striate:jJe,stringifyValues:o6,struct:SKe,strudelScope:l6,stut:rJe,stutWith:tJe,stutwith:nJe,sub:LKe,superimpose:MKe,sus:tpe,sustain:epe,sustainpedal:lye,swing:k$e,swingBy:U$e,sysex:xve,sysexdata:_ve,sysexid:bve,sz:X0e,take:Ece,time:ent,timeCat:p6,timecat:NJe,timeline:Pqe,toBipolar:s$e,tokenizeNote:$ue,tour:Lce,transient:Nve,trem:bpe,tremolo:xpe,tremolodepth:Spe,tremolophase:Ape,tremoloshape:Tpe,tremoloskew:Mpe,tremolosync:_pe,tri:$tt,tri2:Jtt,triode:dye,tsdelay:Mye,uid:Uye,undegrade:Ont,undegradeBy:Gnt,unicodeToBase64:ace,uniq:QYe,uniqsort:eKe,uniqsortr:sce,unison:Pge,unit:iye,useRNG:fnt,v:age,val:kye,valueToMidi:GYe,vel:Bhe,velocity:Nhe,vib:rge,vibmod:lge,vibrato:sge,vmod:uge,voice:M0e,vowel:sye,warp:ahe,warpatt:uhe,warpattack:lhe,warpdc:xhe,warpdec:hhe,warpdecay:che,warpdepth:yhe,warpenv:The,warpmode:_he,warprate:ghe,warprel:mhe,warprelease:phe,warpshape:vhe,warpskew:bhe,warpsus:fhe,warpsustain:dhe,warpsync:Che,waveloss:aye,wavetablePhaseRand:Ahe,wavetablePosition:Xce,wavetableWarp:ohe,wavetableWarpMode:She,wchoose:Ent,wchooseCycles:R1e,when:H$e,whenKey:Knt,withSeed:T1e,withValue:AKe,within:RJe,worklet:mqe,wrandcat:Rnt,wt:Hce,wtatt:jce,wtattack:Zce,wtdc:rhe,wtdec:Kce,wtdecay:Yce,wtdepth:nhe,wtenv:Wce,wtphaserand:Mhe,wtrate:ehe,wtrel:Qce,wtrelease:qce,wtshape:ihe,wtskew:she,wtsus:Jce,wtsustain:$ce,wtsync:the,xfade:Uce,xsdelay:Sye,zcrush:Qye,zdelay:eve,zip:Ice,zipWith:wL,zmod:qye,znoise:Jye,zoom:N$e,zoomArc:B$e,zoomarc:F$e,zrand:Zye,zzfx:tve},Symbol.toStringTag,{value:"Module"}));if(typeof DelayNode<"u"){class n extends DelayNode{constructor(t,i,r,s){return super(t),i=Math.abs(i),this.delayTime.value=r,this.feedbackGain=t.createGain(),this.feedbackGain.gain.value=Math.min(Math.abs(s),.995),this.feedback=this.feedbackGain.gain,this.delayGain=t.createGain(),this.delayGain.gain.value=i,this.connect(this.feedbackGain),this.connect(this.delayGain),this.feedbackGain.connect(this),this.connect=a=>this.delayGain.connect(a),this}start(t){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,t+this.delayTime.value)}}BaseAudioContext.prototype.createFeedbackDelay=function(e,t,i){return new n(this,e,t,i)}}let SE;const N1e=()=>(SE=new AudioContext,SE),u2=n=>(SE=n,SE),Qi=()=>SE||N1e();function rit(){return Qi().currentTime}let B1e=n=>console.log(n);function ME(n,e="superdough"){To(`[${e}] error: ${n.message}`)}const To=(...n)=>B1e(...n),F1e=n=>{B1e=n};let MU={};function L1e(n,e){const t=Qi();if(MU[n])return MU[n];const i=2*t.sampleRate,r=t.createBuffer(1,i,t.sampleRate),s=r.getChannelData(0);let a=0,o,l,u,c,d,f,m;o=l=u=c=d=f=m=0;for(let y=0;y<i;y++)if(n==="white")s[y]=Math.random()*2-1;else if(n==="brown"){let _=Math.random()*2-1;s[y]=(a+.02*_)/1.02,a=s[y]}else if(n==="pink"){let _=Math.random()*2-1;o=.99886*o+_*.0555179,l=.99332*l+_*.0750759,u=.969*u+_*.153852,c=.8665*c+_*.3104856,d=.55*d+_*.5329522,f=-.7616*f-_*.016898,s[y]=o+l+u+c+d+f+m+_*.5362,s[y]*=.11,m=_*.115926}else if(n==="crackle"){const _=e*.01;Math.random()<_?s[y]=Math.random()*2-1:s[y]=0}return n!=="crackle"&&(MU[n]=r),r}function uz(n="white",e,t=.02){const i=Qi().createBufferSource();return i.buffer=L1e(n,t),i.loop=!0,i.start(e),{node:i,stop:r=>i.stop(r)}}function sit(n,e,t){const i=uz("pink",t),r=X1e(n,i.node,e);return Dm(i.node,()=>{Zr(i.node)}),{node:r.node,stop:s=>i?.stop(s),teardown:r.teardown}}const cz=new Map,L6=Symbol("nodePoolKey"),ait=n=>!!n[L6],I1e=n=>n.context?.currentTime??0,oit=n=>{const e=new Set;n.parameters?.forEach(r=>e.add(r));const t=new Set;let i=n;for(;i!==Object.prototype;){for(const r of Object.getOwnPropertyNames(i)){if(t.has(r))continue;t.add(r);const s=n[r];s instanceof AudioParam&&e.add(s)}i=Object.getPrototypeOf(i)}return e},I6=n=>{if(n.disconnect(),n instanceof AudioScheduledSourceNode)return;const e=n[L6];if(e==null)return;const t=I1e(n);oit(n).forEach(r=>r.cancelScheduledValues(t));const i=cz.get(e)??[];i.push(new WeakRef(n)),cz.set(e,i)},lit=n=>{if(!(n instanceof AudioWorkletNode))return!0;const e=I1e(n),t=n?.parameters?.get("end").value??0;return e<t+.45},e3=(n,e)=>{const t=cz.get(n)??[];let i,r=!1;for(;t.length;)if(i=t.pop()?.deref(),i!=null&&lit(i)){r=!0;break}return r||(i=e()),i[L6]=n,i},uit=n=>{if(typeof n!="string")return[];const[e,t="",i]=n.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/)?.slice(1)||[];return e?[e,t,i?Number(i):void 0]:[]},cit={c:0,d:2,e:4,f:5,g:7,a:9,b:11},hit={"#":1,b:-1,s:1,f:-1},dit=n=>n?.split("").reduce((e,t)=>e+hit[t],0)||0,IL=(n,e=3)=>{const[t,i,r=e]=uit(n);if(!t)throw new Error('not a note: "'+n+'"');const s=cit[t.toLowerCase()],a=dit(i);return(Number(r)+1)*12+s+a},G1e=n=>Math.pow(2,(n-69)/12)*440,Pm=(n,e,t)=>Math.min(Math.max(n,e),t),fit=n=>12*Math.log(n/440)/Math.LN2+69,pit=(n,e)=>{if(typeof n!="object")throw new Error("valueToMidi: expected object value");let{freq:t,note:i}=n;return typeof t=="number"?fit(t):typeof i=="string"?IL(i):typeof i=="number"?i:e};function $g(n,e=0,t){return isNaN(Number(n))?(!t&&To(`"${n}" is not a number, falling back to ${e}`,"warning"),e):n}const O1e=(n,e)=>(n%e+e)%e,jK=(n,e)=>O1e(Math.round($g(n,0)),e);function YK(n,e){return n/e}function U1e(n,e){const{s:t,n:i=0}=n;let r=pit(n,36),s=r-36,a,o=0;if(Array.isArray(e))o=jK(i,e.length),a=e[o];else{const u=d=>IL(d)-r,c=Object.keys(e).filter(d=>!d.startsWith("_")).reduce((d,f,m)=>!d||Math.abs(u(f))<Math.abs(u(d))?f:d,null);s=-u(c),o=jK(i,e[c].length),a=e[c][o]}const l=`${t}:${o}`;return{transpose:s,url:a,index:o,midi:r,label:l}}const AU=(n,e)=>Object.fromEntries(Object.entries(e).map(([t,i])=>[t,n[i]])),k1e=n=>{try{return new URL(".",new URL(n)).href.replace(/\/$/,"")}catch{return n.split("/").slice(0,-1).join("/")}},G6=["pink","white","brown","crackle"];function Ys(n){const e=Qi().createGain();return e.gain.value=n,e}function AE(n,e,t){const i=Ys(t);return n.connect(i),i.connect(e),i}const KK=(n,e,t,i)=>i-t===0?0:(e-n)/(i-t);function Yu(n,e,t,i){const r=new AudioWorkletNode(n,e,i);return Object.entries(t).forEach(([s,a])=>{a!==void 0&&(r.parameters.get(s).value=a)}),r}const gh=(n,e,t,i,r,s,a,o,l,u="exponential")=>{e=$g(e),t=$g(t),i=$g(i),r=$g(r);const c=u==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";u==="exponential"&&(s=s===0?.001:s,a=a===0?.001:a);const d=a-s,f=s+i*d,m=l-o,y=_=>{let S;return e>_?S=_*KK(s,a,0,e)+s:S=(_-e)*KK(a,f,0,t)+a,u==="exponential"&&(S=S||.001),S};n.setValueAtTime(s,o),e>m?n[c](y(m),l):e+t>m?(n[c](y(e),o+e),n[c](y(m),l)):(n[c](y(e),o+e),n[c](y(e+t),o+e+t),n.setValueAtTime(f,l)),n[c](s,l+r)};function mit(n){return typeof n=="number"?n%5:{tri:0,triangle:0,sine:1,ramp:2,saw:3,square:4}[n]??0}function z1e(n,e={}){return Yu(n,"envelope-processor",e)}function xA(n,e={}){const{shape:t=0,begin:i=0,end:r=0,time:s,depth:a=1,dcoffset:o=-.5,frequency:l=1,skew:u=.5,phaseoffset:c=0,curve:d=1,min:f,max:m,...y}=e,_={begin:i,end:r,time:s??i,depth:a,dcoffset:o,frequency:l,skew:u,phaseoffset:c,curve:d,shape:mit(t),min:f??o*a,max:m??o*a+a,...y};return Yu(n,"lfo-processor",_)}function V1e(n,e,t,i,r,s){const a=e3("compressor",()=>new DynamicsCompressorNode(n,{}));return Object.entries({threshold:e??-3,ratio:t??10,knee:i??10,attack:r??.005,release:s??.05}).forEach(([o,l])=>{a[o].value=l}),a}const yh=(n,e="linear",t)=>{const[i,r,s,a]=n;if(i==null&&r==null&&s==null&&a==null)return t??[.001,.001,1,.01];const o=s??(i!=null&&r==null||i==null&&r==null?1:.001);return[Math.max(i??0,.001),Math.max(r??0,.001),Math.min(o,1),Math.max(a??0,.01)]};function O6(n,e,t,i,r){let{defaultDepth:s=1,depth:a,dcoffset:o,...l}=r;a==null&&(a=Object.values(l).some(c=>c!=null)?s:0);let u;return a&&(u=xA(n,{begin:t,end:i,depth:a,dcoffset:o,...l}),u.connect(e)),u}function hz(n,e,t,i,r,s){let{amount:a,offset:o,defaultAmount:l=1,curve:u="linear",values:c,holdEnd:d,defaultValues:f}=r;a==null&&(a=c.some(_=>_!=null)?l:0);const m=o??0,y=a+m;if(Math.abs(y-m)){const[_,S,b,M]=yh(c,u,f);gh(e,_,S,b,M,m,y,t,d,u)}return O6(n,e,t,i,s)}function H1e(n,e,t,i,r,s){let{frequency:a,anchor:o,env:l,type:u,model:c,q:d=1,drive:f=.69,depth:m,depthfrequency:y,dcoffset:_=-.5,skew:S,shape:b,rate:M,sync:w}=i,T,E;c==="ladder"?(E=Yu(n,"ladder-processor",{frequency:a,q:d,drive:f}),T=E.parameters.get("frequency")):(E=e3("filter",()=>n.createBiquadFilter()),E.type=u,Object.entries({Q:d,frequency:a}).forEach(([W,K])=>{E[W].value=K}),T=E.frequency);const R=[i.attack,i.decay,i.sustain,i.release],[P,I,B,N]=yh(R,"exponential",[.005,.14,0,.1]);if([...R,l].some(W=>W!==void 0)){l=$g(l,1,!0),o=$g(o,0,!0);const W=Math.abs(l),K=W*o;let q=Pm(2**-K*a,0,2e4),j=Pm(2**(W-K)*a,0,2e4);l<0&&([q,j]=[j,q]),gh(T,P,I,B,N,q,j,e,t,"exponential")}w!=null&&(M=r*w);const U=[m,y,S,b,M].some(W=>W!==void 0);let V;if(U){m=m??1;const W=s/r,K={depth:y??(m??1)*a,dcoffset:_,skew:S,shape:b,frequency:M??r,min:-a+30,max:2e4-a,time:W,curve:1};V=O6(n,T,e,t,K)}return{filter:E,lfo:V}}let $K=n=>n<.5?1:1-(n-.5)/.5;function X1e(n,e,t=0){const i=Qi();if(!t)return n;let r=i.createGain(),s=i.createGain();n.connect(r),e.connect(s),r.gain.value=$K(t),s.gain.value=$K(1-t);let a=i.createGain();return r.connect(a),s.connect(a),{node:a,teardown:()=>{Zr(r),Zr(s),n.disconnect(r),e.disconnect(s)}}}let git=["linear","exponential"];function DM(n,e,t,i){if((e.pattack??e.pdecay??e.psustain??e.prelease??e.penv)===void 0)return;const r=$g(e.penv,1,!0),s=git[e.pcurve??0];let[a,o,l,u]=yh([e.pattack,e.pdecay,e.psustain,e.prelease],s,[.2,.001,1,.001]),c=e.panchor??l;const d=r*100,f=0-d*c,m=d-d*c;gh(n,a,o,l,u,f,m,t,i,s)}function NM(n,e,t){const{vibmod:i=.5,vib:r}=e;let s;if(r>0){s=Qi().createOscillator(),s.frequency.value=r;const a=Qi().createGain();return a.gain.value=i*100,s.connect(a),a.connect(n),Dm(s,()=>{Zr(a),Zr(s)}),s.start(t),{stop:o=>s.stop(o),nodes:{vib:[s],vib_gain:[a]}}}}function yit(n,e,t=Qi()){const i=t.currentTime;tm(t,n,i,e)}function tm(n,e,t,i){const r=new ConstantSourceNode(n),s=Ys(0);return s.connect(n.destination),r.connect(s),Dm(r,()=>{Zr(s),Zr(r),e()}),r.start(t),r.stop(i),r}const vit=(n,e="sine")=>{const t=Qi();let i;return G6.includes(e)?(i=t.createBufferSource(),i.buffer=L1e(e,2),i.loop=!0):(i=t.createOscillator(),i.type=e,i.frequency.value=n),i.start(),i},xit=(n,e,t="sine")=>{const i=n.value*e;return{osc:vit(i,t),freq:i}};function TE(n,e,t){const i=Qi(),r=[],s={},a={};for(let o=1;o<=8;o++)for(let l=0;l<=8;l++){let u;o===l+1?u=`fmi${o===1?"":o}`:u=`fmi${o}${l}`;const c=e[u];if(!c)continue;let d=[];for(let[f,m]of[[!0,o],[!1,l]]){if(m===0){d.push(n);continue}if(!s[m]){const E=m===1?"":m,{osc:R,freq:P}=xit(n,e[`fmh${E}`]??1,e[`fmwave${E}`]??"sine");r.push(R);const I=[R],B=["attack","decay","sustain","release"].map(U=>e[`fm${U}${E}`]);let N=R;if(B.some(U=>U!==void 0)){const U=i.createGain(),[V,W,K,q]=yh(B),j=t+e.duration,te=e[`fmenv${E}`]??"exp";gh(U.gain,V,W,K,q,0,1,t,j,te==="exp"?"exponential":"linear"),I.push(U),N=R.connect(U)}s[m]={input:R.frequency,output:N,freq:P,osc:R,toCleanup:I},a[`fm_${m}`]=[R]}const{input:y,output:_,freq:S,osc:b,toCleanup:M}=s[m],w=Ys(c),T=Ys(S);d.push(f?_.connect(w).connect(T):y),K1e(b,[...M,w,T]),a[`fm_${m}_gain`]=[w]}if(!d[1]){To(`[superdough] control ${u} failed to connect FM ${o} to target ${l} due to missing frequency parameter (likely because fm${l} is noise)`,"warning");continue}d[0].connect(d[1])}return{nodes:a,stop:o=>r.forEach(l=>l?.stop(o))}}const W1e=n=>n/(1+n),bit=(n,e)=>(n%e+e)%e,_it=(n,e)=>(1+e)*n/(1+e*Math.abs(n)),lM=(n,e)=>Math.tanh(n*(1+e)),Sit=(n,e)=>Pm((1+e)*n,-1,1),Z1e=(n,e)=>{let t=(1+.5*e)*n;const i=bit(t+1,4);return 1-Math.abs(i-2)},Mit=(n,e)=>Math.sin(Math.PI/2*Z1e(n,e)),Ait=(n,e)=>{const t=W1e(Math.log1p(e)),i=(n-t/3*n*n*n)/(1-t/3);return lM(i,e)},j1e=(n,e,t=!1)=>{const i=1+2*e,r=.07*W1e(Math.log1p(e)),s=lM(n+r,2*e),a=lM(t?r:-n+r,2*e),o=s-a,l=1/Math.cosh(i*r),u=l*l,c=Math.max(1e-8,(t?1:2)*i*u);return lM(o/c,e)},Tit=(n,e)=>j1e(n,e,!0),Cit=(n,e)=>{const t=10*Math.log1p(e);let i=1,r=n,s,a=0;for(let o=1;o<64;o++){if(o<2){a+=o==0?i:r;continue}s=2*n*i-r,r=i,i=s,o%2===0&&(a+=Math.min(1.3*t/o,2)*s)}return lM(a,t/20)},U6={scurve:_it,soft:lM,hard:Sit,cubic:Ait,diode:j1e,asym:Tit,fold:Z1e,sinefold:Mit,chebyshev:Cit},FC=Object.freeze(Object.keys(U6)),wit=n=>{let e=n;typeof n=="string"&&(e=FC.indexOf(n),e===-1&&(To(`[superdough] Could not find waveshaping algorithm ${n}.
        Available options are ${FC.join(", ")}.
        Defaulting to ${FC[0]}.`),e=0));const t=FC[e%FC.length];return U6[t]},Y1e=(n,e,t)=>Yu(Qi(),"distort-processor",{distort:n,postgain:e},{processorOptions:{algorithm:t}}),Jy=(n,e=36)=>{let{note:t,freq:i,octave:r=0}=n;return t=t||e,typeof t=="string"&&(t=IL(t)),!i&&typeof t=="number"&&(i=G1e(t)),i*=Math.pow(2,r),Number(i)},Dm=(n,e)=>{const t=e;n.onended=function(){t&&t(),this.onended=null}},Zr=n=>{if(n!=null){if(!(n instanceof AudioNode))throw new Error("releaseAudioNode can only release an AudioNode");if(n.disconnect(),n instanceof AudioScheduledSourceNode)try{n.stop()}catch{n.start(n.context.currentTime+5),n.stop()}n instanceof AudioWorkletNode&&n.parameters.get("end")?.setValueAtTime(0,0)}},K1e=(n,e)=>{Dm(n,()=>e.forEach(t=>Zr(t)))};var k6={};k6.generateReverb=function(n,e){for(var t=n.audioContext||new AudioContext,i=t.sampleRate,r=n.numChannels||2,s=n.decayTime*1.5,a=Math.round(n.decayTime*i),o=Math.round(s*i),l=Math.round((n.fadeInTime||0)*i),u=Math.pow(1/1e3,1/a),c=t.createBuffer(r,o,i),d=0;d<r;d++){for(var f=c.getChannelData(d),m=0;m<o;m++)f[m]=Pit()*Math.pow(u,m);for(var m=0;m<l;m++)f[m]*=m/l}Eit(c,n.lpFreqStart||0,n.lpFreqEnd||0,n.decayTime,e)};k6.generateGraph=function(n,e,t,i,r){var s=document.createElement("canvas");s.width=e,s.height=t;var a=s.getContext("2d");a.fillStyle="#000",a.fillRect(0,0,s.width,s.height),a.fillStyle="#fff";for(var o=e/n.length,l=t/(r-i),u=0;u<n.length;u++)a.fillRect(u*o,t-(n[u]-i)*l,1,1);return s};var Eit=function(n,e,t,i,r){if(e==0){r(n);return}var s=Rit(n),a=new OfflineAudioContext(n.numberOfChannels,s[0].length,n.sampleRate),o=a.createBufferSource();o.buffer=n;var l=a.createBiquadFilter();e=Math.min(e,n.sampleRate/2),t=Math.min(t,n.sampleRate/2),l.type="lowpass",l.Q.value=1e-4,l.frequency.setValueAtTime(e,0),l.frequency.linearRampToValueAtTime(t,i),o.connect(l),l.connect(a.destination),o.start(),a.oncomplete=function(u){r(u.renderedBuffer),Zr(l),Zr(o)},a.startRendering(),window.filterNode=l},Rit=function(n){for(var e=[],t=0;t<n.numberOfChannels;t++)e[t]=n.getChannelData(t);return e},Pit=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(BaseAudioContext.prototype.adjustLength=function(n,e,t=1,i=0){const r=Math.floor(Pm(i,0,1)*e.length),s=e.sampleRate*n,a=this.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let o=0;o<e.numberOfChannels;o++){let l=e.getChannelData(o),u=a.getChannelData(o);for(let c=0;c<s;c++){let d=(r+c*Math.abs(t))%l.length;t<1&&(d=d*-1),u[c]=l.at(d)||0}}return a},BaseAudioContext.prototype.createReverb=function(n,e,t,i,r,s,a){const o=this.createConvolver();return o.generate=(l=2,u=.1,c=15e3,d=1e3,f,m,y)=>{o.duration=l,o.fade=u,o.lp=c,o.dim=d,o.ir=f,o.irspeed=m,o.irbegin=y,f?o.buffer=this.adjustLength(l,f,m,y):k6.generateReverb({audioContext:this,numChannels:2,decayTime:l,fadeInTime:u,lpFreqStart:c,lpFreqEnd:d},_=>{o.buffer=_})},o.generate(n,e,t,i,r,s,a),o});var JK={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get (){return this.ae},get (){return this.oe},get (){return this.aa},get (){return this.aa},get (){return this.oe},get (){return this.ue},get (){return this.y}};if(typeof GainNode<"u"){class n extends GainNode{constructor(t,i){if(super(t),!JK[i])throw new Error("vowel: unknown vowel "+i);const{gains:r,qs:s,freqs:a}=JK[i];this.makeupGain=t.createGain(),this.filters=[],this.gains=[];for(let o=0;o<5;o++){const l=t.createGain();l.gain.value=r[o];const u=t.createBiquadFilter();u.type="bandpass",u.Q.value=s[o],u.frequency.value=a[o],super.connect(u),u.connect(l),this.filters.push(u),l.connect(this.makeupGain),this.gains.push(l)}return this.makeupGain.gain.value=8,this}connect(t){this.makeupGain.connect(t)}disconnect(){Zr(this.makeupGain),this.filters.forEach(Zr),this.gains.forEach(Zr),super.disconnect(),this.makeupGain=null,this.filters=null,this.gains=null}}BaseAudioContext.prototype.createVowelFilter=function(e){return new n(this,e)}}const Dit="data:text/javascript;base64,dmFyIF89ZnVuY3Rpb24oUil7InVzZSBzdHJpY3QiO3ZhciBXZT1PYmplY3QuZGVmaW5lUHJvcGVydHk7dmFyIFllPShSLFcsWCk9PlcgaW4gUj9XZShSLFcse2VudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwLHZhbHVlOlh9KTpSW1ddPVg7dmFyIER0PShSLFcsWCk9PlllKFIsdHlwZW9mIFchPSJzeW1ib2wiP1crIiI6VyxYKTtjbGFzcyBYIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye2NvbnN0cnVjdG9yKHQpe3N1cGVyKHQpLHRoaXMuc3RhcnRlZD0hMSx0aGlzLm5iSW5wdXRzPXQubnVtYmVyT2ZJbnB1dHMsdGhpcy5uYk91dHB1dHM9dC5udW1iZXJPZk91dHB1dHMsdGhpcy5ibG9ja1NpemU9dC5wcm9jZXNzb3JPcHRpb25zLmJsb2NrU2l6ZSx0aGlzLmhvcFNpemU9MTI4LHRoaXMubmJPdmVybGFwcz10aGlzLmJsb2NrU2l6ZS90aGlzLmhvcFNpemUsdGhpcy5pbnB1dEJ1ZmZlcnM9bmV3IEFycmF5KHRoaXMubmJJbnB1dHMpLHRoaXMuaW5wdXRCdWZmZXJzSGVhZD1uZXcgQXJyYXkodGhpcy5uYklucHV0cyksdGhpcy5pbnB1dEJ1ZmZlcnNUb1NlbmQ9bmV3IEFycmF5KHRoaXMubmJJbnB1dHMpO2ZvcihsZXQgcz0wO3M8dGhpcy5uYklucHV0cztzKyspdGhpcy5hbGxvY2F0ZUlucHV0Q2hhbm5lbHMocywxKTt0aGlzLm91dHB1dEJ1ZmZlcnM9bmV3IEFycmF5KHRoaXMubmJPdXRwdXRzKSx0aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlPW5ldyBBcnJheSh0aGlzLm5iT3V0cHV0cyk7Zm9yKGxldCBzPTA7czx0aGlzLm5iT3V0cHV0cztzKyspdGhpcy5hbGxvY2F0ZU91dHB1dENoYW5uZWxzKHMsMSl9cmVhbGxvY2F0ZUNoYW5uZWxzSWZOZWVkZWQodCxzKXtmb3IobGV0IGU9MDtlPHRoaXMubmJJbnB1dHM7ZSsrKXtsZXQgaT10W2VdLmxlbmd0aDtpIT10aGlzLmlucHV0QnVmZmVyc1tlXS5sZW5ndGgmJnRoaXMuYWxsb2NhdGVJbnB1dENoYW5uZWxzKGUsaSl9Zm9yKGxldCBlPTA7ZTx0aGlzLm5iT3V0cHV0cztlKyspe2xldCBpPXNbZV0ubGVuZ3RoO2khPXRoaXMub3V0cHV0QnVmZmVyc1tlXS5sZW5ndGgmJnRoaXMuYWxsb2NhdGVPdXRwdXRDaGFubmVscyhlLGkpfX1hbGxvY2F0ZUlucHV0Q2hhbm5lbHModCxzKXt0aGlzLmlucHV0QnVmZmVyc1t0XT1uZXcgQXJyYXkocyk7Zm9yKGxldCBlPTA7ZTxzO2UrKyl0aGlzLmlucHV0QnVmZmVyc1t0XVtlXT1uZXcgRmxvYXQzMkFycmF5KHRoaXMuYmxvY2tTaXplKzEyOCksdGhpcy5pbnB1dEJ1ZmZlcnNbdF1bZV0uZmlsbCgwKTt0aGlzLmlucHV0QnVmZmVyc0hlYWRbdF09bmV3IEFycmF5KHMpLHRoaXMuaW5wdXRCdWZmZXJzVG9TZW5kW3RdPW5ldyBBcnJheShzKTtmb3IobGV0IGU9MDtlPHM7ZSsrKXRoaXMuaW5wdXRCdWZmZXJzSGVhZFt0XVtlXT10aGlzLmlucHV0QnVmZmVyc1t0XVtlXS5zdWJhcnJheSgwLHRoaXMuYmxvY2tTaXplKSx0aGlzLmlucHV0QnVmZmVyc1RvU2VuZFt0XVtlXT1uZXcgRmxvYXQzMkFycmF5KHRoaXMuYmxvY2tTaXplKX1hbGxvY2F0ZU91dHB1dENoYW5uZWxzKHQscyl7dGhpcy5vdXRwdXRCdWZmZXJzW3RdPW5ldyBBcnJheShzKTtmb3IobGV0IGU9MDtlPHM7ZSsrKXRoaXMub3V0cHV0QnVmZmVyc1t0XVtlXT1uZXcgRmxvYXQzMkFycmF5KHRoaXMuYmxvY2tTaXplKSx0aGlzLm91dHB1dEJ1ZmZlcnNbdF1bZV0uZmlsbCgwKTt0aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlW3RdPW5ldyBBcnJheShzKTtmb3IobGV0IGU9MDtlPHM7ZSsrKXRoaXMub3V0cHV0QnVmZmVyc1RvUmV0cmlldmVbdF1bZV09bmV3IEZsb2F0MzJBcnJheSh0aGlzLmJsb2NrU2l6ZSksdGhpcy5vdXRwdXRCdWZmZXJzVG9SZXRyaWV2ZVt0XVtlXS5maWxsKDApfXJlYWRJbnB1dHModCl7aWYodFswXS5sZW5ndGgmJnRbMF1bMF0ubGVuZ3RoPT0wKXtmb3IobGV0IHM9MDtzPHRoaXMubmJJbnB1dHM7cysrKWZvcihsZXQgZT0wO2U8dGhpcy5pbnB1dEJ1ZmZlcnNbc10ubGVuZ3RoO2UrKyl0aGlzLmlucHV0QnVmZmVyc1tzXVtlXS5maWxsKDAsdGhpcy5ibG9ja1NpemUpO3JldHVybn1mb3IobGV0IHM9MDtzPHRoaXMubmJJbnB1dHM7cysrKWZvcihsZXQgZT0wO2U8dGhpcy5pbnB1dEJ1ZmZlcnNbc10ubGVuZ3RoO2UrKyl7bGV0IGk9dFtzXVtlXTt0aGlzLmlucHV0QnVmZmVyc1tzXVtlXS5zZXQoaSx0aGlzLmJsb2NrU2l6ZSl9fXdyaXRlT3V0cHV0cyh0KXtmb3IobGV0IHM9MDtzPHRoaXMubmJJbnB1dHM7cysrKWZvcihsZXQgZT0wO2U8dGhpcy5pbnB1dEJ1ZmZlcnNbc10ubGVuZ3RoO2UrKyl7bGV0IGk9dGhpcy5vdXRwdXRCdWZmZXJzW3NdW2VdLnN1YmFycmF5KDAsMTI4KTt0W3NdW2VdLnNldChpKX19c2hpZnRJbnB1dEJ1ZmZlcnMoKXtmb3IobGV0IHQ9MDt0PHRoaXMubmJJbnB1dHM7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5pbnB1dEJ1ZmZlcnNbdF0ubGVuZ3RoO3MrKyl0aGlzLmlucHV0QnVmZmVyc1t0XVtzXS5jb3B5V2l0aGluKDAsMTI4KX1zaGlmdE91dHB1dEJ1ZmZlcnMoKXtmb3IobGV0IHQ9MDt0PHRoaXMubmJPdXRwdXRzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMub3V0cHV0QnVmZmVyc1t0XS5sZW5ndGg7cysrKXRoaXMub3V0cHV0QnVmZmVyc1t0XVtzXS5jb3B5V2l0aGluKDAsMTI4KSx0aGlzLm91dHB1dEJ1ZmZlcnNbdF1bc10uc3ViYXJyYXkodGhpcy5ibG9ja1NpemUtMTI4KS5maWxsKDApfXByZXBhcmVJbnB1dEJ1ZmZlcnNUb1NlbmQoKXtmb3IobGV0IHQ9MDt0PHRoaXMubmJJbnB1dHM7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5pbnB1dEJ1ZmZlcnNbdF0ubGVuZ3RoO3MrKyl0aGlzLmlucHV0QnVmZmVyc1RvU2VuZFt0XVtzXS5zZXQodGhpcy5pbnB1dEJ1ZmZlcnNIZWFkW3RdW3NdKX1oYW5kbGVPdXRwdXRCdWZmZXJzVG9SZXRyaWV2ZSgpe2ZvcihsZXQgdD0wO3Q8dGhpcy5uYk91dHB1dHM7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5vdXRwdXRCdWZmZXJzW3RdLmxlbmd0aDtzKyspZm9yKGxldCBlPTA7ZTx0aGlzLmJsb2NrU2l6ZTtlKyspdGhpcy5vdXRwdXRCdWZmZXJzW3RdW3NdW2VdKz10aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlW3RdW3NdW2VdL3RoaXMubmJPdmVybGFwc31wcm9jZXNzKHQscyxlKXtjb25zdCBuPXRbMF1bMF0hPT12b2lkIDA7cmV0dXJuIHRoaXMuc3RhcnRlZCYmIW4/ITE6KHRoaXMuc3RhcnRlZD1uLHRoaXMucmVhbGxvY2F0ZUNoYW5uZWxzSWZOZWVkZWQodCxzKSx0aGlzLnJlYWRJbnB1dHModCksdGhpcy5zaGlmdElucHV0QnVmZmVycygpLHRoaXMucHJlcGFyZUlucHV0QnVmZmVyc1RvU2VuZCgpLHRoaXMucHJvY2Vzc09MQSh0aGlzLmlucHV0QnVmZmVyc1RvU2VuZCx0aGlzLm91dHB1dEJ1ZmZlcnNUb1JldHJpZXZlLGUpLHRoaXMuaGFuZGxlT3V0cHV0QnVmZmVyc1RvUmV0cmlldmUoKSx0aGlzLndyaXRlT3V0cHV0cyhzKSx0aGlzLnNoaWZ0T3V0cHV0QnVmZmVycygpLCEwKX1wcm9jZXNzT0xBKHQscyxlKXtjb25zb2xlLmFzc2VydCghMSwiTm90IG92ZXJyaWRlbiIpfX1jbGFzcyBRdHtjb25zdHJ1Y3Rvcih0KXtpZih0aGlzLnNpemU9dHwwLHRoaXMuc2l6ZTw9MXx8dGhpcy5zaXplJnRoaXMuc2l6ZS0xKXRocm93IG5ldyBFcnJvcigiRkZUIHNpemUgbXVzdCBiZSBhIHBvd2VyIG9mIHR3byBhbmQgYmlnZ2VyIHRoYW4gMSIpO3RoaXMuX2NzaXplPXQ8PDE7Zm9yKHZhciBzPW5ldyBBcnJheSh0aGlzLnNpemUqMiksZT0wO2U8cy5sZW5ndGg7ZSs9Mil7Y29uc3QgaD1NYXRoLlBJKmUvdGhpcy5zaXplO3NbZV09TWF0aC5jb3MoaCksc1tlKzFdPS1NYXRoLnNpbihoKX10aGlzLnRhYmxlPXM7Zm9yKHZhciBpPTAsbj0xO3RoaXMuc2l6ZT5uO248PD0xKWkrKzt0aGlzLl93aWR0aD1pJTI9PT0wP2ktMTppLHRoaXMuX2JpdHJldj1uZXcgQXJyYXkoMTw8dGhpcy5fd2lkdGgpO2Zvcih2YXIgYT0wO2E8dGhpcy5fYml0cmV2Lmxlbmd0aDthKyspe3RoaXMuX2JpdHJldlthXT0wO2Zvcih2YXIgbz0wO288dGhpcy5fd2lkdGg7bys9Mil7dmFyIGM9dGhpcy5fd2lkdGgtby0yO3RoaXMuX2JpdHJldlthXXw9KGE+Pj5vJjMpPDxjfX10aGlzLl9vdXQ9bnVsbCx0aGlzLl9kYXRhPW51bGwsdGhpcy5faW52PTB9ZnJvbUNvbXBsZXhBcnJheSh0LHMpe2Zvcih2YXIgZT1zfHxuZXcgQXJyYXkodC5sZW5ndGg+Pj4xKSxpPTA7aTx0Lmxlbmd0aDtpKz0yKWVbaT4+PjFdPXRbaV07cmV0dXJuIGV9Y3JlYXRlQ29tcGxleEFycmF5KCl7Y29uc3QgdD1uZXcgQXJyYXkodGhpcy5fY3NpemUpO2Zvcih2YXIgcz0wO3M8dC5sZW5ndGg7cysrKXRbc109MDtyZXR1cm4gdH10b0NvbXBsZXhBcnJheSh0LHMpe2Zvcih2YXIgZT1zfHx0aGlzLmNyZWF0ZUNvbXBsZXhBcnJheSgpLGk9MDtpPGUubGVuZ3RoO2krPTIpZVtpXT10W2k+Pj4xXSxlW2krMV09MDtyZXR1cm4gZX1jb21wbGV0ZVNwZWN0cnVtKHQpe2Zvcih2YXIgcz10aGlzLl9jc2l6ZSxlPXM+Pj4xLGk9MjtpPGU7aSs9Mil0W3MtaV09dFtpXSx0W3MtaSsxXT0tdFtpKzFdfXRyYW5zZm9ybSh0LHMpe2lmKHQ9PT1zKXRocm93IG5ldyBFcnJvcigiSW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIG11c3QgYmUgZGlmZmVyZW50Iik7dGhpcy5fb3V0PXQsdGhpcy5fZGF0YT1zLHRoaXMuX2ludj0wLHRoaXMuX3RyYW5zZm9ybTQoKSx0aGlzLl9vdXQ9bnVsbCx0aGlzLl9kYXRhPW51bGx9cmVhbFRyYW5zZm9ybSh0LHMpe2lmKHQ9PT1zKXRocm93IG5ldyBFcnJvcigiSW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIG11c3QgYmUgZGlmZmVyZW50Iik7dGhpcy5fb3V0PXQsdGhpcy5fZGF0YT1zLHRoaXMuX2ludj0wLHRoaXMuX3JlYWxUcmFuc2Zvcm00KCksdGhpcy5fb3V0PW51bGwsdGhpcy5fZGF0YT1udWxsfWludmVyc2VUcmFuc2Zvcm0odCxzKXtpZih0PT09cyl0aHJvdyBuZXcgRXJyb3IoIklucHV0IGFuZCBvdXRwdXQgYnVmZmVycyBtdXN0IGJlIGRpZmZlcmVudCIpO3RoaXMuX291dD10LHRoaXMuX2RhdGE9cyx0aGlzLl9pbnY9MSx0aGlzLl90cmFuc2Zvcm00KCk7Zm9yKHZhciBlPTA7ZTx0Lmxlbmd0aDtlKyspdFtlXS89dGhpcy5zaXplO3RoaXMuX291dD1udWxsLHRoaXMuX2RhdGE9bnVsbH1fdHJhbnNmb3JtNCgpe3ZhciB0PXRoaXMuX291dCxzPXRoaXMuX2NzaXplLGU9dGhpcy5fd2lkdGgsaT0xPDxlLG49cy9pPDwxLGEsbyxjPXRoaXMuX2JpdHJldjtpZihuPT09NClmb3IoYT0wLG89MDthPHM7YSs9bixvKyspe2NvbnN0IG09Y1tvXTt0aGlzLl9zaW5nbGVUcmFuc2Zvcm0yKGEsbSxpKX1lbHNlIGZvcihhPTAsbz0wO2E8czthKz1uLG8rKyl7Y29uc3QgbT1jW29dO3RoaXMuX3NpbmdsZVRyYW5zZm9ybTQoYSxtLGkpfXZhciBoPXRoaXMuX2ludj8tMToxLGY9dGhpcy50YWJsZTtmb3IoaT4+PTI7aT49MjtpPj49Mil7bj1zL2k8PDE7dmFyIHU9bj4+PjI7Zm9yKGE9MDthPHM7YSs9bilmb3IodmFyIGQ9YSt1LGw9YSxwPTA7bDxkO2wrPTIscCs9aSl7Y29uc3QgbT1sLEk9bSt1LHc9SSt1LHY9dyt1LE09dFttXSxQPXRbbSsxXSxnPXRbSV0sVD10W0krMV0sQT10W3ddLFY9dFt3KzFdLE89dFt2XSxOPXRbdisxXSxDPU0sRj1QLHE9ZltwXSxCPWgqZltwKzFdLEw9ZypxLVQqQixFPWcqQitUKnEsSD1mWzIqcF0saXQ9aCpmWzIqcCsxXSwkPUEqSC1WKml0LFU9QSppdCtWKkgsSz1mWzMqcF0sWj1oKmZbMypwKzFdLGs9TypLLU4qWixmdD1PKlorTipLLGR0PUMrJCxydD1GK1UsbnQ9Qy0kLHB0PUYtVSxtdD1MK2ssYXQ9RStmdCxvdD1oKihMLWspLGd0PWgqKEUtZnQpLHZ0PWR0K210LEF0PXJ0K2F0LE90PWR0LW10LE50PXJ0LWF0LEN0PW50K2d0LEZ0PXB0LW90LEV0PW50LWd0LGt0PXB0K290O3RbbV09dnQsdFttKzFdPUF0LHRbSV09Q3QsdFtJKzFdPUZ0LHRbd109T3QsdFt3KzFdPU50LHRbdl09RXQsdFt2KzFdPWt0fX19X3NpbmdsZVRyYW5zZm9ybTIodCxzLGUpe2NvbnN0IGk9dGhpcy5fb3V0LG49dGhpcy5fZGF0YSxhPW5bc10sbz1uW3MrMV0sYz1uW3MrZV0saD1uW3MrZSsxXSxmPWErYyx1PW8raCxkPWEtYyxsPW8taDtpW3RdPWYsaVt0KzFdPXUsaVt0KzJdPWQsaVt0KzNdPWx9X3NpbmdsZVRyYW5zZm9ybTQodCxzLGUpe2NvbnN0IGk9dGhpcy5fb3V0LG49dGhpcy5fZGF0YSxhPXRoaXMuX2ludj8tMToxLG89ZSoyLGM9ZSozLGg9bltzXSxmPW5bcysxXSx1PW5bcytlXSxkPW5bcytlKzFdLGw9bltzK29dLHA9bltzK28rMV0sbT1uW3MrY10sST1uW3MrYysxXSx3PWgrbCx2PWYrcCxNPWgtbCxQPWYtcCxnPXUrbSxUPWQrSSxBPWEqKHUtbSksVj1hKihkLUkpLE89dytnLE49ditULEM9TStWLEY9UC1BLHE9dy1nLEI9di1ULEw9TS1WLEU9UCtBO2lbdF09TyxpW3QrMV09TixpW3QrMl09QyxpW3QrM109RixpW3QrNF09cSxpW3QrNV09QixpW3QrNl09TCxpW3QrN109RX1fcmVhbFRyYW5zZm9ybTQoKXt2YXIgdD10aGlzLl9vdXQscz10aGlzLl9jc2l6ZSxlPXRoaXMuX3dpZHRoLGk9MTw8ZSxuPXMvaTw8MSxhLG8sYz10aGlzLl9iaXRyZXY7aWYobj09PTQpZm9yKGE9MCxvPTA7YTxzO2ErPW4sbysrKXtjb25zdCBSdD1jW29dO3RoaXMuX3NpbmdsZVJlYWxUcmFuc2Zvcm0yKGEsUnQ+Pj4xLGk+Pj4xKX1lbHNlIGZvcihhPTAsbz0wO2E8czthKz1uLG8rKyl7Y29uc3QgUnQ9Y1tvXTt0aGlzLl9zaW5nbGVSZWFsVHJhbnNmb3JtNChhLFJ0Pj4+MSxpPj4+MSl9dmFyIGg9dGhpcy5faW52Py0xOjEsZj10aGlzLnRhYmxlO2ZvcihpPj49MjtpPj0yO2k+Pj0yKXtuPXMvaTw8MTt2YXIgdT1uPj4+MSxkPXU+Pj4xLGw9ZD4+PjE7Zm9yKGE9MDthPHM7YSs9bilmb3IodmFyIHA9MCxtPTA7cDw9bDtwKz0yLG0rPWkpe3ZhciBJPWErcCx3PUkrZCx2PXcrZCxNPXYrZCxQPXRbSV0sZz10W0krMV0sVD10W3ddLEE9dFt3KzFdLFY9dFt2XSxPPXRbdisxXSxOPXRbTV0sQz10W00rMV0sRj1QLHE9ZyxCPWZbbV0sTD1oKmZbbSsxXSxFPVQqQi1BKkwsSD1UKkwrQSpCLGl0PWZbMiptXSwkPWgqZlsyKm0rMV0sVT1WKml0LU8qJCxLPVYqJCtPKml0LFo9ZlszKm1dLGs9aCpmWzMqbSsxXSxmdD1OKlotQyprLGR0PU4qaytDKloscnQ9RitVLG50PXErSyxwdD1GLVUsbXQ9cS1LLGF0PUUrZnQsb3Q9SCtkdCxndD1oKihFLWZ0KSx2dD1oKihILWR0KSxBdD1ydCthdCxPdD1udCtvdCxOdD1wdCt2dCxDdD1tdC1ndDtpZih0W0ldPUF0LHRbSSsxXT1PdCx0W3ddPU50LHRbdysxXT1DdCxwPT09MCl7dmFyIEZ0PXJ0LWF0LEV0PW50LW90O3Rbdl09RnQsdFt2KzFdPUV0O2NvbnRpbnVlfWlmKHAhPT1sKXt2YXIga3Q9cHQsT2U9LW10LE5lPXJ0LENlPS1udCxGZT0taCp2dCxFZT0taCpndCxrZT0taCpvdCxSZT0taCphdCxEZT1rdCtGZSx6ZT1PZStFZSxxZT1OZStSZSxMZT1DZS1rZSxadD1hK2QtcCxYdD1hK3UtcDt0W1p0XT1EZSx0W1p0KzFdPXplLHRbWHRdPXFlLHRbWHQrMV09TGV9fX19X3NpbmdsZVJlYWxUcmFuc2Zvcm0yKHQscyxlKXtjb25zdCBpPXRoaXMuX291dCxuPXRoaXMuX2RhdGEsYT1uW3NdLG89bltzK2VdLGM9YStvLGg9YS1vO2lbdF09YyxpW3QrMV09MCxpW3QrMl09aCxpW3QrM109MH1fc2luZ2xlUmVhbFRyYW5zZm9ybTQodCxzLGUpe2NvbnN0IGk9dGhpcy5fb3V0LG49dGhpcy5fZGF0YSxhPXRoaXMuX2ludj8tMToxLG89ZSoyLGM9ZSozLGg9bltzXSxmPW5bcytlXSx1PW5bcytvXSxkPW5bcytjXSxsPWgrdSxwPWgtdSxtPWYrZCxJPWEqKGYtZCksdz1sK20sdj1wLE09LUksUD1sLW0sZz1wLFQ9STtpW3RdPXcsaVt0KzFdPTAsaVt0KzJdPXYsaVt0KzNdPU0saVt0KzRdPVAsaVt0KzVdPTAsaVt0KzZdPWcsaVt0KzddPVR9fWxldCB0cz1yPT5jb25zb2xlLmxvZyhyKTtjb25zdCBzcz0oLi4ucik9PnRzKC4uLnIpLGVzPShyLHQscyk9Pk1hdGgubWluKE1hdGgubWF4KHIsdCkscyksenQ9cj0+ci8oMStyKSxpcz0ocix0KT0+KHIldCt0KSV0LHJzPShyLHQpPT4oMSt0KSpyLygxK3QqTWF0aC5hYnMocikpLEo9KHIsdCk9Pk1hdGgudGFuaChyKigxK3QpKSxucz0ocix0KT0+ZXMoKDErdCkqciwtMSwxKSxxdD0ocix0KT0+e2xldCBzPSgxKy41KnQpKnI7Y29uc3QgZT1pcyhzKzEsNCk7cmV0dXJuIDEtTWF0aC5hYnMoZS0yKX0sYXM9KHIsdCk9Pk1hdGguc2luKE1hdGguUEkvMipxdChyLHQpKSxvcz0ocix0KT0+e2NvbnN0IHM9enQoTWF0aC5sb2cxcCh0KSksZT0oci1zLzMqcipyKnIpLygxLXMvMyk7cmV0dXJuIEooZSx0KX0sTHQ9KHIsdCxzPSExKT0+e2NvbnN0IGU9MSsyKnQsbj0uMDcqenQoTWF0aC5sb2cxcCh0KSksYT1KKHIrbiwyKnQpLG89SihzP246LXIrbiwyKnQpLGM9YS1vLGg9MS9NYXRoLmNvc2goZSpuKSxmPWgqaCx1PU1hdGgubWF4KDFlLTgsKHM/MToyKSplKmYpO3JldHVybiBKKGMvdSx0KX0sV3Q9e3NjdXJ2ZTpycyxzb2Z0OkosaGFyZDpucyxjdWJpYzpvcyxkaW9kZTpMdCxhc3ltOihyLHQpPT5MdChyLHQsITApLGZvbGQ6cXQsc2luZWZvbGQ6YXMsY2hlYnlzaGV2OihyLHQpPT57Y29uc3Qgcz0xMCpNYXRoLmxvZzFwKHQpO2xldCBlPTEsaT1yLG4sYT0wO2ZvcihsZXQgbz0xO288NjQ7bysrKXtpZihvPDIpe2ErPW89PTA/ZTppO2NvbnRpbnVlfW49MipyKmUtaSxpPWUsZT1uLG8lMj09PTAmJihhKz1NYXRoLm1pbigxLjMqcy9vLDIpKm4pfXJldHVybiBKKGEscy8yMCl9fSxodD1PYmplY3QuZnJlZXplKE9iamVjdC5rZXlzKFd0KSksaHM9cj0+e2xldCB0PXI7dHlwZW9mIHI9PSJzdHJpbmciJiYodD1odC5pbmRleE9mKHIpLHQ9PT0tMSYmKHNzKGBbc3VwZXJkb3VnaF0gQ291bGQgbm90IGZpbmQgd2F2ZXNoYXBpbmcgYWxnb3JpdGhtICR7cn0uCiAgICAgICAgQXZhaWxhYmxlIG9wdGlvbnMgYXJlICR7aHQuam9pbigiLCAiKX0uCiAgICAgICAgRGVmYXVsdGluZyB0byAke2h0WzBdfS5gKSx0PTApKTtjb25zdCBzPWh0W3QlaHQubGVuZ3RoXTtyZXR1cm4gV3Rbc119O2Z1bmN0aW9uIGN0KHIsdCl7aWYodHx8KHQ9ImFzc2VydGlvbiBmYWlsZWQiKSwhcil0aHJvdyBuZXcgRXJyb3IodCl9ZnVuY3Rpb24gY3Mocix0LHMpe3JldHVybiByPD0wP3Q6cj49MT9zOnQrcioocy10KX1mdW5jdGlvbiB1cyhyLHQscyl7cmV0dXJuIHI8PXQ/MDpyPj1zPzE6cz09PXQ/MDooci10KS8ocy10KX1mdW5jdGlvbiBscyhyLHQpe3JldHVybiByPHQ/KHIvPXQscityLXIqci0xKTpyPjEtdD8ocj0oci0xKS90LHIqcityK3IrMSk6MH1mdW5jdGlvbiBmcyhyKXtyZXR1cm4gTWF0aC5mbG9vcihyKT09PXJ9ZnVuY3Rpb24gZHMocil7cmV0dXJuIGZzKHIpJiZyPjB9ZnVuY3Rpb24gcHMocix0KXt0PU1hdGgubWluKE1hdGgubWF4KHQsMCksMSksdC09LjAxO3ZhciBzPTIqdC8oMS10KSxlPSgxK3MpKnIvKDErcypNYXRoLmFicyhyKSk7cmV0dXJuIGV9ZnVuY3Rpb24gSXQocix0LHMpe3JldHVybiByPj0xP3M6dCtyKihzLXQpfWZ1bmN0aW9uIFl0KCl7dGhpcy5zdGF0ZT0ib2ZmIix0aGlzLnN0YXJ0VGltZT0wLHRoaXMuc3RhcnRWYWw9MH1ZdC5wcm90b3R5cGUuZXZhbD1mdW5jdGlvbihyLHQscyxlLGksbil7c3dpdGNoKHRoaXMuc3RhdGUpe2Nhc2Uib2ZmIjpyZXR1cm4gdD4wJiYodGhpcy5zdGF0ZT0iYXR0YWNrIix0aGlzLnN0YXJ0VGltZT1yLHRoaXMuc3RhcnRWYWw9MCksMDtjYXNlImF0dGFjayI6e2xldCBhPXItdGhpcy5zdGFydFRpbWU7cmV0dXJuIGE+cz8odGhpcy5zdGF0ZT0iZGVjYXkiLHRoaXMuc3RhcnRUaW1lPXIsMSk6SXQoYS9zLHRoaXMuc3RhcnRWYWwsMSl9Y2FzZSJkZWNheSI6e2xldCBhPXItdGhpcy5zdGFydFRpbWUsbz1JdChhL2UsMSxpKTtyZXR1cm4gdDw9MD8odGhpcy5zdGF0ZT0icmVsZWFzZSIsdGhpcy5zdGFydFRpbWU9cix0aGlzLnN0YXJ0VmFsPW8sbyk6YT5lPyh0aGlzLnN0YXRlPSJzdXN0YWluIix0aGlzLnN0YXJ0VGltZT1yLGkpOm99Y2FzZSJzdXN0YWluIjpyZXR1cm4gdDw9MCYmKHRoaXMuc3RhdGU9InJlbGVhc2UiLHRoaXMuc3RhcnRUaW1lPXIsdGhpcy5zdGFydFZhbD1pKSxpO2Nhc2UicmVsZWFzZSI6e2xldCBhPXItdGhpcy5zdGFydFRpbWU7aWYoYT5uKXJldHVybiB0aGlzLnN0YXRlPSJvZmYiLDA7bGV0IG89SXQoYS9uLHRoaXMuc3RhcnRWYWwsMCk7cmV0dXJuIHQ+MCYmKHRoaXMuc3RhdGU9ImF0dGFjayIsdGhpcy5zdGFydFRpbWU9cix0aGlzLnN0YXJ0VmFsPW8pLG99fXRocm93ImludmFsaWQgZW52ZWxvcGUgc3RhdGUifTtmdW5jdGlvbiB3dCgpe3RoaXMuczA9MCx0aGlzLnMxPTB9d3QucHJvdG90eXBlLmFwcGx5PWZ1bmN0aW9uKHIsdCxzKXtjdCghaXNOYU4ociksIk5hTiB2YWx1ZSBmZWQgaW4gVHdvUG9sZUZpbHRlciIpLHQ9TWF0aC5taW4odCwxKSxzPU1hdGgubWF4KHMsMCk7dmFyIGU9TWF0aC5wb3coLjUsKDEtdCkvLjEyNSksaT1NYXRoLnBvdyguNSwocysuMTI1KS8uMTI1KSxuPTEtaSplLGE9dGhpcy5zMCxvPXRoaXMuczE7cmV0dXJuIGE9biphLWUqbytlKnIsbz1uKm8rZSphLHI9byx0aGlzLnMwPWEsdGhpcy5zMT1vLHJ9O2xldCBtcz1jbGFzcyBKdHtjb25zdHJ1Y3Rvcih0LHMpe3RoaXMuc2FtcGxlUmF0ZT10LHM/dGhpcy5idWZmZXI9cy5zbGljZSgwKToodGhpcy5idWZmZXI9bmV3IEZsb2F0MzJBcnJheSgxMCp0KSx0aGlzLmJ1ZmZlci5maWxsKDApKSx0aGlzLndyaXRlSWR4PTAsdGhpcy5yZWFkSWR4PTB9cmVzZXQoKXt0aGlzLmJ1ZmZlci5maWxsKDApLHRoaXMud3JpdGVJZHg9MCx0aGlzLnJlYWRJZHg9MH1jbG9uZSgpe2NvbnN0IHQ9bmV3IEp0KHRoaXMuc2FtcGxlUmF0ZSx0aGlzLmJ1ZmZlcik7cmV0dXJuIHQud3JpdGVJZHg9dGhpcy53cml0ZUlkeCx0LnJlYWRJZHg9dGhpcy5yZWFkSWR4LHR9d3JpdGUodCxzKXt0aGlzLndyaXRlSWR4PSh0aGlzLndyaXRlSWR4KzEpJXRoaXMuYnVmZmVyLmxlbmd0aCx0aGlzLmJ1ZmZlclt0aGlzLndyaXRlSWR4XT10O2xldCBlPU1hdGgubWluKE1hdGguZmxvb3IodGhpcy5zYW1wbGVSYXRlKnMpLHRoaXMuYnVmZmVyLmxlbmd0aC0xKTt0aGlzLnJlYWRJZHg9dGhpcy53cml0ZUlkeC1lLHRoaXMucmVhZElkeDwwJiYodGhpcy5yZWFkSWR4Kz10aGlzLmJ1ZmZlci5sZW5ndGgpfXJlYWQoKXtyZXR1cm4gdGhpcy5idWZmZXJbdGhpcy5yZWFkSWR4XX19O2NvbnN0IFN0PTEvNDhlMyxfdD0yNCxncz1fdC80O2NsYXNzIHl7Y29uc3RydWN0b3IodCxzLGUsaSl7dGhpcy5ub2RlSWQ9dCx0aGlzLnN0YXRlPXMsdGhpcy5zYW1wbGVSYXRlPWUsdGhpcy5zYW1wbGVUaW1lPTEvZSx0aGlzLnNlbmQ9aX19Y2xhc3MgYnMgZXh0ZW5kcyB5e2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMuZW52PW5ldyBZdH11cGRhdGUodCxzLGUsaSxuLGEpe3JldHVybiB0aGlzLmVudi5ldmFsKHQscyxlLGksbixhKX19Y2xhc3MgdnMgZXh0ZW5kcyB5e2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMucGhhc2U9MH11cGRhdGUodCl7bGV0IHM9X3QqdC82MCxlPS41O3JldHVybiB0aGlzLnBoYXNlKz10aGlzLnNhbXBsZVRpbWUqcyx0aGlzLnBoYXNlJTE8ZT8xOi0xfX1jbGFzcyBJcyBleHRlbmRzIHl7Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5pblNnbj0hMCx0aGlzLm91dFNnbj0hMCx0aGlzLmNsb2NrQ250PTB9dXBkYXRlKHQscyl7bGV0IGU9dD4wO3JldHVybiB0aGlzLmluU2duIT1lJiYodGhpcy5jbG9ja0NudCsrLHRoaXMuY2xvY2tDbnQ+PXMmJih0aGlzLmNsb2NrQ250PTAsdGhpcy5vdXRTZ249IXRoaXMub3V0U2duKSksdGhpcy5pblNnbj1lLHRoaXMub3V0U2duPzE6LTF9fWNsYXNzIHdzIGV4dGVuZHMgeXtjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLmluU2duPSExfXVwZGF0ZSh0LHMpe2xldCBlPXM+MDtyZXR1cm4gZSYmdGhpcy5pblNnbiE9ZSYmdGhpcy5zZW5kKHt0eXBlOiJDTE9DS19QVUxTRSIsbm9kZUlkOnRoaXMubm9kZUlkLHRpbWU6dH0pLHRoaXMuaW5TZ249ZSwwfX1jb25zdCBNdD1uZXcgTWFwO2NsYXNzIFNzIGV4dGVuZHMgeXtjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKTtjb25zdCBuPXMuaW5wdXRzWzJdO24mJk10LmhhcyhuKT90aGlzLmRlbGF5PU10LmdldChuKS5jbG9uZSgpOnRoaXMuZGVsYXk9bmV3IG1zKGUpLG4mJk10LnNldChuLHRoaXMuZGVsYXkpfXVwZGF0ZSh0LHMpe3JldHVybiB0aGlzLmRlbGF5LndyaXRlKHQscyksdGhpcy5kZWxheS5yZWFkKCl9fWNsYXNzIF9zIGV4dGVuZHMgeXtjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKX11cGRhdGUodCxzKXtyZXR1cm4gcHModCxzKX19Y2xhc3MgTXMgZXh0ZW5kcyB5e2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMudmFsdWU9MCx0aGlzLnRyaWdTZ249ITF9d3JpdGUodCxzKXshdGhpcy50cmlnU2duJiZzPjAmJih0aGlzLnZhbHVlPXQpLHRoaXMudHJpZ1Nnbj1zPjB9cmVhZCgpe3JldHVybiB0aGlzLnZhbHVlfXVwZGF0ZSh0LHMpe3JldHVybiB0aGlzLndyaXRlKHQscyksdGhpcy5yZWFkKCl9fWNsYXNzIHhze2NvbnN0cnVjdG9yKCl7dGhpcy52YWx1ZT0wfXVwZGF0ZSh0KXtyZXR1cm4gdGhpcy52YWx1ZT10LHRoaXMudmFsdWV9fWNvbnN0IHlzPTM0MDtsZXQgR3Q9MDtjbGFzcyBQc3tjb25zdHJ1Y3Rvcigpe3RoaXMuY2g9R3QsdGhpcy5zdGFydF9zZWVkPXlzKih0aGlzLmNoKzEpPj4+MCx0aGlzLnN0YXRlPXRoaXMuc3RhcnRfc2VlZCx0aGlzLnZhbHVlPTAsdGhpcy5hPTE2NjQ1MjUsdGhpcy5jPTEwMTM5MDQyMjMsdGhpcy5tYXNrPTE2Nzc3MjE1LHRoaXMuc2NhbGU9NTk2MDQ2NDQ3NzUzOTA2M2UtMjMsR3QrK311cGRhdGUodCxzKXtpZighdClyZXR1cm4gdGhpcy52YWx1ZTtzJiYodGhpcy5zdGF0ZT10aGlzLnN0YXJ0X3NlZWQpLHRoaXMuc3RhdGU9dGhpcy5zdGF0ZSp0aGlzLmErdGhpcy5jPj4+MDtjb25zdCBlPSh0aGlzLnN0YXRlJnRoaXMubWFzaykqdGhpcy5zY2FsZTtyZXR1cm4gdGhpcy52YWx1ZT1lKjItMSx0aGlzLnZhbHVlfX1jbGFzcyBUc3tjb25zdHJ1Y3Rvcigpe3RoaXMudmFsdWU9TWF0aC5yYW5kb20oKSoyLTF9dXBkYXRlKHQpe3JldHVybiB0Pyh0aGlzLnZhbHVlPU1hdGgucmFuZG9tKCkqMi0xLHRoaXMudmFsdWUpOnRoaXMudmFsdWV9fWNsYXNzIEJze3VwZGF0ZSh0KXtyZXR1cm4gTWF0aC5yYW5kb20oKTx0KlN0P01hdGgucmFuZG9tKCk6MH19Y2xhc3MgVnN7Y29uc3RydWN0b3IoKXt0aGlzLm91dD0wfXVwZGF0ZSgpe2xldCB0PU1hdGgucmFuZG9tKCkqMi0xO3JldHVybiB0aGlzLm91dD0odGhpcy5vdXQrLjAyKnQpLzEuMDIsdGhpcy5vdXR9fWNsYXNzIEFze2NvbnN0cnVjdG9yKCl7dGhpcy5iMD0wLHRoaXMuYjE9MCx0aGlzLmIyPTAsdGhpcy5iMz0wLHRoaXMuYjQ9MCx0aGlzLmI1PTAsdGhpcy5iNj0wfXVwZGF0ZSgpe2NvbnN0IHQ9TWF0aC5yYW5kb20oKSoyLTE7dGhpcy5iMD0uOTk4ODYqdGhpcy5iMCt0Ki4wNTU1MTc5LHRoaXMuYjE9Ljk5MzMyKnRoaXMuYjErdCouMDc1MDc1OSx0aGlzLmIyPS45NjkqdGhpcy5iMit0Ki4xNTM4NTIsdGhpcy5iMz0uODY2NSp0aGlzLmIzK3QqLjMxMDQ4NTYsdGhpcy5iND0uNTUqdGhpcy5iNCt0Ki41MzI5NTIyLHRoaXMuYjU9LS43NjE2KnRoaXMuYjUtdCouMDE2ODk4O2NvbnN0IHM9dGhpcy5iMCt0aGlzLmIxK3RoaXMuYjIrdGhpcy5iMyt0aGlzLmI0K3RoaXMuYjUrdGhpcy5iNit0Ki41MzYyO3JldHVybiB0aGlzLmI2PXQqLjExNTkyNixzKi4xMX19Y2xhc3MgT3MgZXh0ZW5kcyB5e2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMucGhhc2U9MX11cGRhdGUodCl7dGhpcy5waGFzZSs9dGhpcy5zYW1wbGVUaW1lKnQ7bGV0IHM9dGhpcy5waGFzZT49MT8xOjA7cmV0dXJuIHRoaXMucGhhc2U9dGhpcy5waGFzZSUxLHN9fWNsYXNzIE5zIGV4dGVuZHMgeXtjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLnBoYXNlPTB9dXBkYXRlKHQscyl7cmV0dXJuIHRoaXMucGhhc2UrPXRoaXMuc2FtcGxlVGltZSp0LHRoaXMucGhhc2UlMTxzPzE6LTF9fWNsYXNzIENzIGV4dGVuZHMgeXtjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLnBoYXNlPTB9dXBkYXRlKHQpe3JldHVybiB0aGlzLnBoYXNlKz10aGlzLnNhbXBsZVRpbWUqdCx0aGlzLnBoYXNlJTEqMi0xfX1jbGFzcyBGc3tjb25zdHJ1Y3Rvcigpe3RoaXMucGhhc2U9TWF0aC5yYW5kb20oKX11cGRhdGUodCl7Y29uc3Qgcz10L3NhbXBsZVJhdGU7bGV0IGU9bHModGhpcy5waGFzZSxzKSxpPTIqdGhpcy5waGFzZS0xLWU7cmV0dXJuIHRoaXMucGhhc2UrPXMsdGhpcy5waGFzZT4xJiYodGhpcy5waGFzZS09MSksaX19Y2xhc3MgRXMgZXh0ZW5kcyB5e2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMucGhhc2U9MCx0aGlzLnN5bmNTZ249ITF9dXBkYXRlKHQscyxlKXshdGhpcy5zeW5jU2duJiZzPjAmJih0aGlzLnBoYXNlPTApLHRoaXMuc3luY1Nnbj1zPjA7bGV0IGk9KHRoaXMucGhhc2UrZSklMTtyZXR1cm4gdGhpcy5waGFzZSs9dGhpcy5zYW1wbGVUaW1lKnQsTWF0aC5zaW4oaSoyKk1hdGguUEkpfX1jbGFzcyBrc3tkQlRvTGluZWFyKHQpe3JldHVybiBNYXRoLnBvdygxMCx0LzIwKX1saW5lYXJUb0RCKHQpe3JldHVybiAyMCpNYXRoLmxvZzEwKHQpfXVwZGF0ZSh0LHMsZSl7bGV0IGk9dGhpcy5saW5lYXJUb0RCKE1hdGguYWJzKHQpKSxuPTA7cmV0dXJuIGk+cyYmKG49KGktcykqKDEtMS9lKSksdGhpcy5kQlRvTGluZWFyKC1uKX19Y2xhc3MgUnMgZXh0ZW5kcyB5e2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMucGhhc2U9MH11cGRhdGUodCl7dGhpcy5waGFzZSs9dGhpcy5zYW1wbGVUaW1lKnQ7bGV0IHM9dGhpcy5waGFzZSUxO3JldHVybihzPC41PzIqczoxLTIqKHMtLjUpKSoyLTF9fWNsYXNzIERzIGV4dGVuZHMgeXtjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKTtjb25zdCBuPWUvMzA7Y3QoZHMobikpLHRoaXMuYnVmZmVyPW5ldyBGbG9hdDMyQXJyYXkobiksdGhpcy53cml0ZVBvcz0wfXVwZGF0ZSh0LHMsZSxpKXtyZXR1cm4gdGhpcy5idWZmZXJbdGhpcy53cml0ZVBvc109dCx0aGlzLndyaXRlUG9zKyssdGhpcy53cml0ZVBvcyV0aGlzLmJ1ZmZlci5sZW5ndGg9PTAmJih0aGlzLndyaXRlUG9zPTAsdGhpcy5zZW5kKHt0eXBlOiJTRU5EX1NBTVBMRVMiLGlkOnMsc2FtcGxlczp0aGlzLmJ1ZmZlcixjaGFubmVsczplLGNoYW5uZWw6aX0pKSx0fX1jbGFzcyB6c3tjb25zdHJ1Y3Rvcigpe3RoaXMubGFnVW5pdD00NDEwLHRoaXMucz0wfXVwZGF0ZSh0LHMpe3JldHVybiBzPXMqdGhpcy5sYWdVbml0LHM8MSYmKHM9MSksdGhpcy5zKz0xL3MqKHQtdGhpcy5zKSx0aGlzLnN9fWNsYXNzIHFze2NvbnN0cnVjdG9yKCl7dGhpcy5sYXN0PTB9dXBkYXRlKHQscyxlKXtjb25zdCBpPXMqU3Qsbj1lKlN0O2xldCBhPXQtdGhpcy5sYXN0O3JldHVybiBhPmk/YT1pOmE8LW4mJihhPS1uKSx0aGlzLmxhc3QrPWEsdGhpcy5sYXN0fX1jbGFzcyBMcyBleHRlbmRzIHl7Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5zPTB9dXBkYXRlKHQscyl7cmV0dXJuIHM9cyoxZTMsczwxJiYocz0xKSx0aGlzLnMrPTEvcyoodC10aGlzLnMpLHRoaXMuc319Y2xhc3MgV3MgZXh0ZW5kcyB5e2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMuZmlsdGVyPW5ldyB3dH11cGRhdGUodCxzLGUpe3JldHVybiB0aGlzLmZpbHRlci5hcHBseSh0LHMsZSksdGhpcy5maWx0ZXIuczF9fWNsYXNzIFlzIGV4dGVuZHMgeXtjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLmZpbHRlcj1uZXcgd3R9dXBkYXRlKHQscyxlKXtyZXR1cm4gdGhpcy5maWx0ZXIuYXBwbHkodCxzLGUpLHRoaXMuZmlsdGVyLnMwfX1jbGFzcyBHcyBleHRlbmRzIHl7Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSl9dXBkYXRlKHQscyl7cmV0dXJuIHM8MCYmKHM9MCkscz1zKzEsdD10KnMsNCooTWF0aC5hYnMoLjI1KnQrLjI1LU1hdGgucm91bmQoLjI1KnQrLjI1KSktLjI1KX19Y2xhc3MganMgZXh0ZW5kcyB5e3VwZGF0ZSh0KXtyZXR1cm4gdH19Y2xhc3MgYnQgZXh0ZW5kcyB5e2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMubm90ZT0wLHRoaXMuZnJlcT0wLHRoaXMudmVsb2NpdHk9MCx0aGlzLmdhdGVTdGF0ZT0ib2ZmIix0aGlzLnR5cGU9Im1pZGlpbiIsdGhpcy5jaGFubmVsPS0xfWlzRnJlZSgpe3JldHVybiB0aGlzLmdhdGVTdGF0ZT09PSJvZmYifW5vdGVPbih0LHMpe3M+MD8odGhpcy5ub3RlPXQsdGhpcy52ZWxvY2l0eT1zLHRoaXMuZnJlcT0yKiooKHQtNjkpLzEyKSo0NDAsdGhpcy5nYXRlU3RhdGU9InByZXRyaWciKTp0aGlzLm5vdGVPZmYoKX1ub3RlT2ZmKCl7dGhpcy5ub3RlPTAsdGhpcy5nYXRlU3RhdGU9Im9mZiJ9Z2V0R2F0ZSgpe3N3aXRjaCh0aGlzLmdhdGVTdGF0ZSl7Y2FzZSJwcmV0cmlnIjpyZXR1cm4gdGhpcy5nYXRlU3RhdGU9Im9uIiwwO2Nhc2Uib24iOnJldHVybiAxO2Nhc2Uib2ZmIjpyZXR1cm4gMDtkZWZhdWx0OmN0KCExKX19Z2V0RnJlcSgpe3N3aXRjaCh0aGlzLmdhdGVTdGF0ZSl7Y2FzZSJwcmV0cmlnIjpyZXR1cm4gdGhpcy5nYXRlU3RhdGU9Im9uIiwwO2Nhc2Uib24iOnJldHVybiB0aGlzLmZyZXE7Y2FzZSJvZmYiOnJldHVybiB0aGlzLmZyZXE7ZGVmYXVsdDpjdCghMSl9fWdldFZlbG9jaXR5KCl7c3dpdGNoKHRoaXMuZ2F0ZVN0YXRlKXtjYXNlInByZXRyaWciOnJldHVybiB0aGlzLmdhdGVTdGF0ZT0ib24iLDA7Y2FzZSJvbiI6cmV0dXJuIHRoaXMudmVsb2NpdHk7Y2FzZSJvZmYiOnJldHVybiB0aGlzLnZlbG9jaXR5O2RlZmF1bHQ6Y3QoITEpfX19Y2xhc3MgSHMgZXh0ZW5kcyBidHtjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLnR5cGU9Im1pZGlnYXRlIn11cGRhdGUodCl7cmV0dXJuIHRoaXMuY2hhbm5lbD10LHRoaXMuZ2V0R2F0ZSgpfX1jbGFzcyBVcyBleHRlbmRzIGJ0e2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMudHlwZT0ibWlkaWZyZXEifXVwZGF0ZSh0KXtyZXR1cm4gdGhpcy5jaGFubmVsPXQsdGhpcy5nZXRGcmVxKCl9fWNsYXNzICRzIGV4dGVuZHMgYnR7Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy50eXBlPSJtaWRpdmVsIn11cGRhdGUodCl7cmV0dXJuIHRoaXMuY2hhbm5lbD10LHRoaXMuZ2V0VmVsb2NpdHkoKX19Y2xhc3MgS3N7Y29uc3RydWN0b3IodCxzLGUsaSl7dGhpcy51cD0hMSx0aGlzLnNlbmQ9aSx0aGlzLnZhbHVlPTAsdGhpcy50eXBlPSJjYyJ9c2V0VmFsdWUodCl7dGhpcy52YWx1ZT10fXVwZGF0ZSh0LHMsZSl7cmV0dXJuIHRoaXMuaWQ9cywhdGhpcy51cCYmdD4wPyh0aGlzLnVwPSEwLHRoaXMuc2VuZCh7dHlwZToiU0lHTkFMX1RSSUdHRVIiLGlkOnMsdGltZTplfSksdGhpcy52YWx1ZSk6KHRoaXMudXA9dD4wLHRoaXMudmFsdWUpfX1jbGFzcyBacyBleHRlbmRzIHl7Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy50eXBlPSJjYyIsdGhpcy52YWx1ZT1zLmlucHV0c1sxXT8/MH1zZXRWYWx1ZSh0KXt0aGlzLnZhbHVlPXR9dXBkYXRlKHQpe3JldHVybiB0aGlzLmlkPXQsdGhpcy52YWx1ZX19Y2xhc3MgWHMgZXh0ZW5kcyB5e2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMudHlwZT0ibWlkaWNjIix0aGlzLnZhbHVlPXMuaW5wdXRzWzJdPz8tMSx0aGlzLmNoYW5uZWw9LTEsdGhpcy5jY251bWJlcj0tMX1zZXRWYWx1ZSh0KXt0aGlzLnZhbHVlPXR9dXBkYXRlKHQscyl7cmV0dXJuIHRoaXMuY2NudW1iZXI9dCx0aGlzLmNoYW5uZWw9cyx0aGlzLnZhbHVlfX1jbGFzcyBKcyBleHRlbmRzIHl7Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5jbG9ja1Nnbj0hMCx0aGlzLnN0ZXA9MCx0aGlzLmZpcnN0PSEwfXVwZGF0ZSh0LC4uLnMpe3JldHVybiF0aGlzLmNsb2NrU2duJiZ0PjA/KHRoaXMuc3RlcD0odGhpcy5zdGVwKzEpJXMubGVuZ3RoLHRoaXMuY2xvY2tTZ249dD4wLDApOih0aGlzLmNsb2NrU2duPXQ+MCxzW3RoaXMuc3RlcF0pfX1jbGFzcyBRcyBleHRlbmRzIHl7dXBkYXRlKHQsLi4ucyl7Y29uc3QgZT10JXMubGVuZ3RoK3MubGVuZ3RoO3JldHVybiBzW01hdGguZmxvb3IoZSklcy5sZW5ndGhdfX1jbGFzcyB0ZXt1cGRhdGUodCxzLGUsaSxuKXtsZXQgYT11cyh0LHMsZSk7cmV0dXJuIGNzKGEsaSxuKX19Y2xhc3Mgc2V7dXBkYXRlKHQscyxlKXtyZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgodCxzKSxlKX19Y2xhc3MgZWV7Y29uc3RydWN0b3IoKXt0aGlzLmhpPSExfXVwZGF0ZSh0KXtyZXR1cm4hdGhpcy5oaSYmdD4wPyh0aGlzLmhpPSEwLDEpOih0aGlzLmhpJiZ0PD0wJiYodGhpcy5oaT0hMSksMCl9fWNsYXNzIGlle2NvbnN0cnVjdG9yKCl7dGhpcy54MT0wLHRoaXMueDI9MCx0aGlzLnkxPTAsdGhpcy55Mj0wLHRoaXMuYTA9MSx0aGlzLmExPTAsdGhpcy5hMj0wLHRoaXMuYjA9MSx0aGlzLmIxPTAsdGhpcy5iMj0wfXVwZGF0ZSh0PTAscz0wLGU9NTAwLGk9MSxuPTEpe2NvbnN0IGE9MipNYXRoLlBJKmUvc2FtcGxlUmF0ZSxvPU1hdGguc2luKGEpO2k9TWF0aC5wb3coMTAsaS8yMCk7Y29uc3QgYz1vLygyKmkpLGg9TWF0aC5jb3MoYSk7aWYocz09PTApdGhpcy5iMT0xLWgsdGhpcy5iMD10aGlzLmIxLzIsdGhpcy5iMj10aGlzLmIwLHRoaXMuYTA9MStjLHRoaXMuYTE9LTIqaCx0aGlzLmEyPTEtYztlbHNlIGlmKHM9PT0xKXRoaXMuYjA9KDEraCkvMix0aGlzLmIxPS0oMStoKSx0aGlzLmIyPXRoaXMuYjAsdGhpcy5hMD0xK2MsdGhpcy5hMT0tMipoLHRoaXMuYTI9MS1jO2Vsc2UgaWYocz09PTIpdGhpcy5iMD1vLzIsdGhpcy5iMT0wLHRoaXMuYjI9LXRoaXMuYjAsdGhpcy5hMD0xK2MsdGhpcy5hMT0tMipoLHRoaXMuYTI9MS1jO2Vsc2UgaWYocz09PTMpdGhpcy5iMD0xLHRoaXMuYjE9LTIqaCx0aGlzLmIyPTEsdGhpcy5hMD0xK2MsdGhpcy5hMT0tMipoLHRoaXMuYTI9MS1jO2Vsc2UgaWYocz09PTQpdGhpcy5iMD0xLWMsdGhpcy5iMT0tMipoLHRoaXMuYjI9MStjLHRoaXMuYTA9MStjLHRoaXMuYTE9LTIqaCx0aGlzLmEyPTEtYztlbHNlIGlmKHM9PT01KXtjb25zdCB1PU1hdGgucG93KDEwLG4vNDApO3RoaXMuYjA9MStjKnUsdGhpcy5iMT0tMipoLHRoaXMuYjI9MS1jKnUsdGhpcy5hMD0xK2MvdSx0aGlzLmExPS0yKmgsdGhpcy5hMj0xLWMvdX1lbHNlIGlmKHM9PT02KXtjb25zdCB1PU1hdGgucG93KDEwLG4vNDApLGQ9MipNYXRoLnNxcnQodSkqYyxsPSh1LTEpKmgscD0odSsxKSpoO3RoaXMuYjA9dSoodSsxLWwrZCksdGhpcy5iMT0yKnUqKHUtMS1wKSx0aGlzLmIyPXUqKHUrMS1sLWQpLHRoaXMuYTA9dSsxK2wrZCx0aGlzLmExPS0yKih1LTErcCksdGhpcy5hMj11KzErbC1kfWVsc2UgaWYocz09PTcpe2NvbnN0IHU9TWF0aC5wb3coMTAsbi80MCksZD0yKk1hdGguc3FydCh1KSpjLGw9KHUtMSkqaCxwPSh1KzEpKmg7dGhpcy5iMD11Kih1KzErbCtkKSx0aGlzLmIxPS0yKnUqKHUtMStwKSx0aGlzLmIyPXUqKHUrMStsLWQpLHRoaXMuYTA9dSsxLWwrZCx0aGlzLmExPTIqKHUtMS1wKSx0aGlzLmEyPXUrMS1sLWR9dGhpcy5iMC89dGhpcy5hMCx0aGlzLmIxLz10aGlzLmEwLHRoaXMuYjIvPXRoaXMuYTAsdGhpcy5hMS89dGhpcy5hMCx0aGlzLmEyLz10aGlzLmEwLHRoaXMuYTA9MTtjb25zdCBmPXRoaXMuYjAqdCt0aGlzLmIxKnRoaXMueDErdGhpcy5iMip0aGlzLngyLXRoaXMuYTEqdGhpcy55MS10aGlzLmEyKnRoaXMueTI7cmV0dXJuIHRoaXMueDI9dGhpcy54MSx0aGlzLngxPXQsdGhpcy55Mj10aGlzLnkxLHRoaXMueTE9ZixmfX1jb25zdCByZT1PYmplY3QuZnJlZXplKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7X19wcm90b19fOm51bGwsQURTUk5vZGU6YnMsQXVkaW9JbjpqcyxBdWRpb05vZGU6eSxCUEY6WXMsQmlxdWFkRmlsdGVyOmllLEJyb3duTm9pc2VPc2M6VnMsQ0M6WnMsQ0xPQ0tfUFBROl90LENMT0NLX1BQUzpncyxDbGlwOnNlLENsb2NrOnZzLENsb2NrRGl2OklzLENsb2NrT3V0OndzLERlbGF5OlNzLERpc3RvcnQ6X3MsRHVzdE9zYzpCcyxGaWx0ZXI6V3MsRm9sZDpHcyxIb2xkOk1zLEltcHVsc2VPc2M6T3MsTGFnOnpzLExjZ05vaXNlOlBzLE1pZGlDQzpYcyxNaWRpRnJlcTpVcyxNaWRpR2F0ZTpIcyxNaWRpSW46YnQsTWlkaVZlbDokcyxOb2lzZU9zYzpUcyxPdXRwdXQ6eHMsUGljazpRcyxQaW5rTm9pc2U6QXMsUHVsc2VPc2M6TnMsUmVtYXA6dGUsU2F3T3NjOkZzLFNjb3BlOkRzLFNlcXVlbmNlOkpzLFNpZGVjaGFpbkNvbXByZXNzb3I6a3MsU2lnbmFsOktzLFNpbmVPc2M6RXMsU2xldzpxcyxTbGlkZTpMcyxUcmlPc2M6UnMsVHJpZzplZSxaYXdPc2M6Q3N9LFN5bWJvbC50b1N0cmluZ1RhZyx7dmFsdWU6Ik1vZHVsZSJ9KSksbmU9bmV3IE1hcChPYmplY3QuZW50cmllcyhyZSkpLFk9MTI4LEQ9TWF0aC5QSSx6PTIqRCxHPTEvc2FtcGxlUmF0ZSx4dD1yPT4xLU1hdGguZXhwKC1HL3IpLGp0PXI9Pk1hdGgucG93KDEwLHIvMjApLFM9KHIsdCxzKT0+TWF0aC5taW4oTWF0aC5tYXgocix0KSxzKSx1dD0ocix0LHMpPT5zKih0LXIpK3IsYj0ocix0KT0+clt0XT8/clswXSxRPXI9PnItTWF0aC5mbG9vcihyKSx0dD1yPT5yfDAsc3Q9cj0+dHQocisuNSksYWU9cj0+dHQocisxKSxIdD1yPT5yLXR0KHIpLGo9cj0+e2NvbnN0IHQ9cioqMjtyZXR1cm4gciooMjcrdCkvKDI3KzkqdCl9LFV0PShyLHQpPT57aWYocjwyKXJldHVybiBpPT4wO2NvbnN0IHM9dC8oci0xKSxlPXQqLjU7cmV0dXJuIGk9Pmkqcy1lfSxldD0ocix0KT0+cipNYXRoLnBvdygyLHQvMTIpO2Z1bmN0aW9uIG9lKHIsdCl7dD1NYXRoLm1pbih0LDEtdCk7Y29uc3Qgcz0xL3Q7cmV0dXJuIHI8dD8ocio9cywyKnItcioqMi0xKTpyPjEtdD8ocj0oci0xKSpzLHIqKjIrMipyKzEpOjB9Y29uc3QgeXQ9e3RyaShyLHQ9LjUpe2NvbnN0IHM9MS10O3JldHVybiByPj10PzEvcy1yL3M6ci90fSxzaW5lKHIpe3JldHVybiBNYXRoLnNpbih6KnIpKi41Ky41fSxyYW1wKHIpe3JldHVybiByfSxzYXcocil7cmV0dXJuIDEtcn0sc3F1YXJlKHIsdD0uNSl7cmV0dXJuIHI+PXQ/MDoxfSxjdXN0b20ocix0PVswLDFdKXtjb25zdCBzPXQubGVuZ3RoLTEsZT1NYXRoLmZsb29yKHIqcyksaT0xL3Msbj1TKHRbZV0sMCwxKSxvPVModFtlKzFdLDAsMSksYz1uLGg9MCxmPWk7cmV0dXJuKG8tYykvKGYtaCkqKHItaSplKStufSxzYXdibGVwKHIsdCl7cmV0dXJuIDIqci0xLW9lKHIsdCl9fSxoZT1PYmplY3Qua2V5cyh5dCk7Y2xhc3MgY2UgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiYmVnaW4iLGRlZmF1bHRWYWx1ZTowfSx7bmFtZToidGltZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJlbmQiLGRlZmF1bHRWYWx1ZTowfSx7bmFtZToiZnJlcXVlbmN5IixkZWZhdWx0VmFsdWU6LjV9LHtuYW1lOiJza2V3IixkZWZhdWx0VmFsdWU6LjV9LHtuYW1lOiJkZXB0aCIsZGVmYXVsdFZhbHVlOjF9LHtuYW1lOiJwaGFzZW9mZnNldCIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJzaGFwZSIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJjdXJ2ZSIsZGVmYXVsdFZhbHVlOjF9LHtuYW1lOiJkY29mZnNldCIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJtaW4iLGRlZmF1bHRWYWx1ZTotMWU5fSx7bmFtZToibWF4IixkZWZhdWx0VmFsdWU6MWU5fV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucGhhc2V9aW5jcmVtZW50UGhhc2UodCl7dGhpcy5waGFzZSs9dCx0aGlzLnBoYXNlPjEmJih0aGlzLnBoYXNlPXRoaXMucGhhc2UtMSl9cHJvY2Vzcyh0LHMsZSl7Y29uc3QgaT1lLmJlZ2luWzBdLG49ZS5lbmRbMF07aWYoY3VycmVudFRpbWU+PW4pcmV0dXJuITE7aWYoY3VycmVudFRpbWU8PWkpcmV0dXJuITA7Y29uc3QgYT1zWzBdLG89ZS5mcmVxdWVuY3lbMF0sYz1lLnRpbWVbMF0saD1lLmRlcHRoWzBdLGY9ZS5za2V3WzBdLHU9ZS5waGFzZW9mZnNldFswXSxkPWUuY3VydmVbMF0sbD1lLmRjb2Zmc2V0WzBdLHA9ZS5taW5bMF0sbT1lLm1heFswXSxJPWhlW2Uuc2hhcGVbMF1dLHc9YVswXS5sZW5ndGg/PzA7dGhpcy5waGFzZT09bnVsbCYmKHRoaXMucGhhc2U9SHQoYypvK3UpKTtjb25zdCB2PW8qRztmb3IobGV0IE09MDtNPHc7TSsrKXtmb3IobGV0IFA9MDtQPGEubGVuZ3RoO1ArKyl7bGV0IGc9KHl0W0ldKHRoaXMucGhhc2UsZikrbCkqaDtnPU1hdGgucG93KGcsZCksYVtQXVtNXT1TKGcscCxtKX10aGlzLmluY3JlbWVudFBoYXNlKHYpfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigibGZvLXByb2Nlc3NvciIsY2UpO2NsYXNzIHVlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImNvYXJzZSIsZGVmYXVsdFZhbHVlOjF9XX1jb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5zdGFydGVkPSExfXByb2Nlc3ModCxzLGUpe2NvbnN0IGk9dFswXSxuPXNbMF0sYT1pWzBdIT09dm9pZCAwO2lmKHRoaXMuc3RhcnRlZCYmIWEpcmV0dXJuITE7dGhpcy5zdGFydGVkPWE7bGV0IG89ZS5jb2Fyc2VbMF0/PzA7bz1NYXRoLm1heCgxLG8pO2ZvcihsZXQgYz0wO2M8WTtjKyspZm9yKGxldCBoPTA7aDxpLmxlbmd0aDtoKyspbltoXVtjXT1jJW89PT0wP2lbaF1bY106bltoXVtjLTFdO3JldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiY29hcnNlLXByb2Nlc3NvciIsdWUpO2NsYXNzIGxlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6ImNydXNoIixkZWZhdWx0VmFsdWU6MH1dfWNvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnN0YXJ0ZWQ9ITF9cHJvY2Vzcyh0LHMsZSl7Y29uc3QgaT10WzBdLG49c1swXSxhPWlbMF0hPT12b2lkIDA7aWYodGhpcy5zdGFydGVkJiYhYSlyZXR1cm4hMTt0aGlzLnN0YXJ0ZWQ9YTtsZXQgbz1lLmNydXNoWzBdPz84O289TWF0aC5tYXgoMSxvKTtmb3IobGV0IGM9MDtjPFk7YysrKWZvcihsZXQgaD0wO2g8aS5sZW5ndGg7aCsrKXtjb25zdCBmPU1hdGgucG93KDIsby0xKTtuW2hdW2NdPU1hdGgucm91bmQoaVtoXVtjXSpmKS9mfXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3NvcigiY3J1c2gtcHJvY2Vzc29yIixsZSk7Y2xhc3MgZmUgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToic2hhcGUiLGRlZmF1bHRWYWx1ZTowfSx7bmFtZToicG9zdGdhaW4iLGRlZmF1bHRWYWx1ZToxfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuc3RhcnRlZD0hMX1wcm9jZXNzKHQscyxlKXtjb25zdCBpPXRbMF0sbj1zWzBdLGE9aVswXSE9PXZvaWQgMDtpZih0aGlzLnN0YXJ0ZWQmJiFhKXJldHVybiExO3RoaXMuc3RhcnRlZD1hO2xldCBvPWUuc2hhcGVbMF07bz1vPDE/bzouOTk5OTk5OTk5NixvPTIqby8oMS1vKTtjb25zdCBjPU1hdGgubWF4KC4wMDEsTWF0aC5taW4oMSxlLnBvc3RnYWluWzBdKSk7Zm9yKGxldCBoPTA7aDxZO2grKylmb3IobGV0IGY9MDtmPGkubGVuZ3RoO2YrKyluW2ZdW2hdPSgxK28pKmlbZl1baF0vKDErbypNYXRoLmFicyhpW2ZdW2hdKSkqYztyZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoInNoYXBlLXByb2Nlc3NvciIsZmUpO2NsYXNzICR0e2NvbnN0cnVjdG9yKCl7RHQodGhpcywiczAiLDApO0R0KHRoaXMsInMxIiwwKX11cGRhdGUodCxzLGU9MCl7ZT1TKGUsMCwxKSxzPVMocywwLHNhbXBsZVJhdGUvMi0xKTtjb25zdCBpPVMoMipNYXRoLnNpbihzKkQqRyksMCwxLjE0KSxhPTEtTWF0aC5wb3coLjUsOCplKzEpKmk7cmV0dXJuIHRoaXMuczA9YSp0aGlzLnMwLWkqdGhpcy5zMStpKnQsdGhpcy5zMT1hKnRoaXMuczEraSp0aGlzLnMwLHRoaXMuczF9fWNsYXNzIGRlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6InZhbHVlIixkZWZhdWx0VmFsdWU6LjV9XX1jb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5maWx0ZXJzPVtuZXcgJHQsbmV3ICR0XX1wcm9jZXNzKHQscyxlKXtjb25zdCBpPXRbMF0sbj1zWzBdLGE9aVswXSE9PXZvaWQgMDt0aGlzLnN0YXJ0ZWQ9YTtjb25zdCBvPVMoZS52YWx1ZVswXSwwLDEpO2xldCBjPSJub25lIixoLGY9MTtvPi41MT8oYz0iaGlwYXNzIixmPShvLS41KSoyKTpvPC40OSYmKGM9ImxvcGFzcyIsZj1vKjIpLGg9TWF0aC5wb3coZioxMSw0KTtmb3IobGV0IHU9MDt1PGkubGVuZ3RoO3UrKylmb3IobGV0IGQ9MDtkPFk7ZCsrKWM9PSJub25lIj9uW3VdW2RdPWlbdV1bZF06KHRoaXMuZmlsdGVyc1t1XS51cGRhdGUoaVt1XVtkXSxoLC4xKSxjPT09ImxvcGFzcyI/blt1XVtkXT10aGlzLmZpbHRlcnNbdV0uczE6Yz09PSJoaXBhc3MiP25bdV1bZF09aVt1XVtkXS10aGlzLmZpbHRlcnNbdV0uczE6blt1XVtkXT1pW3VdW2RdKTtyZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImRqZi1wcm9jZXNzb3IiLGRlKTtjbGFzcyBwZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTo1MDB9LHtuYW1lOiJxIixkZWZhdWx0VmFsdWU6MX0se25hbWU6ImRyaXZlIixkZWZhdWx0VmFsdWU6LjY5fV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuc3RhcnRlZD0hMSx0aGlzLnAwPVswLDBdLHRoaXMucDE9WzAsMF0sdGhpcy5wMj1bMCwwXSx0aGlzLnAzPVswLDBdLHRoaXMucDMyPVswLDBdLHRoaXMucDMzPVswLDBdLHRoaXMucDM0PVswLDBdfXByb2Nlc3ModCxzLGUpe2NvbnN0IGk9dFswXSxuPXNbMF0sYT1pWzBdIT09dm9pZCAwO2lmKHRoaXMuc3RhcnRlZCYmIWEpcmV0dXJuITE7dGhpcy5zdGFydGVkPWE7Y29uc3Qgbz1lLnFbMF0sYz1TKE1hdGguZXhwKGUuZHJpdmVbMF0pLC4xLDJlMyk7bGV0IGg9ZS5mcmVxdWVuY3lbMF07aD1oKnoqRyxoPWg+MT8xOmg7Y29uc3QgZj1NYXRoLm1pbig4LG8qLjEzKTtsZXQgdT0xL2MqTWF0aC5taW4oMS43NSwxK2YpO2ZvcihsZXQgZD0wO2Q8WTtkKyspZm9yKGxldCBsPTA7bDxpLmxlbmd0aDtsKyspe2NvbnN0IHA9dGhpcy5wM1tsXSouMzYwODkxK3RoaXMucDMyW2xdKi40MTcyOSt0aGlzLnAzM1tsXSouMTc3ODk2K3RoaXMucDM0W2xdKi4wNDM5NzI1O3RoaXMucDM0W2xdPXRoaXMucDMzW2xdLHRoaXMucDMzW2xdPXRoaXMucDMyW2xdLHRoaXMucDMyW2xdPXRoaXMucDNbbF0sdGhpcy5wMFtsXSs9KGooaVtsXVtkXSpjLWYqcCktaih0aGlzLnAwW2xdKSkqaCx0aGlzLnAxW2xdKz0oaih0aGlzLnAwW2xdKS1qKHRoaXMucDFbbF0pKSpoLHRoaXMucDJbbF0rPShqKHRoaXMucDFbbF0pLWoodGhpcy5wMltsXSkpKmgsdGhpcy5wM1tsXSs9KGoodGhpcy5wMltsXSktaih0aGlzLnAzW2xdKSkqaCxuW2xdW2RdPXAqdX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImxhZGRlci1wcm9jZXNzb3IiLHBlKTtjbGFzcyBtZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJkaXN0b3J0IixkZWZhdWx0VmFsdWU6MH0se25hbWU6InBvc3RnYWluIixkZWZhdWx0VmFsdWU6MX1dfWNvbnN0cnVjdG9yKHtwcm9jZXNzb3JPcHRpb25zOnR9KXtzdXBlcigpLHRoaXMuc3RhcnRlZD0hMSx0aGlzLmFsZ29yaXRobT1ocyh0LmFsZ29yaXRobSl9cHJvY2Vzcyh0LHMsZSl7Y29uc3QgaT10WzBdLG49c1swXSxhPWlbMF0hPT12b2lkIDA7aWYodGhpcy5zdGFydGVkJiYhYSlyZXR1cm4hMTt0aGlzLnN0YXJ0ZWQ9YTtmb3IobGV0IG89MDtvPFk7bysrKXtjb25zdCBjPVMoYihlLnBvc3RnYWluLG8pLC4wMDEsMSksaD1NYXRoLmV4cG0xKGIoZS5kaXN0b3J0LG8pKTtmb3IobGV0IGY9MDtmPGkubGVuZ3RoO2YrKyl7Y29uc3QgdT1pW2ZdW29dO25bZl1bb109Yyp0aGlzLmFsZ29yaXRobSh1LGgpfX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImRpc3RvcnQtcHJvY2Vzc29yIixtZSk7Y2xhc3MgZ2UgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucG9ydC5vbm1lc3NhZ2U9dD0+e2NvbnN0e3R5cGU6cyxwYXlsb2FkOmV9PXQuZGF0YXx8e307cz09PSJpbml0aWFsaXplIiYmdGhpcy5pbml0aWFsaXplKGUpfSx0aGlzLmluaXRpYWxpemUoKX1pbml0aWFsaXplKHQpe3RoaXMucGhhc2U9W119c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiYmVnaW4iLGRlZmF1bHRWYWx1ZTotMSxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLG1pbjotMX0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOi0xLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOi0xfSx7bmFtZToiZnJlcXVlbmN5IixkZWZhdWx0VmFsdWU6NDQwLG1pbjpOdW1iZXIuRVBTSUxPTn0se25hbWU6InBhbnNwcmVhZCIsZGVmYXVsdFZhbHVlOi40LG1pbjowLG1heDoxfSx7bmFtZToiZnJlcXNwcmVhZCIsZGVmYXVsdFZhbHVlOi4yLG1pbjowfSx7bmFtZToiZGV0dW5lIixkZWZhdWx0VmFsdWU6MCxtaW46MH0se25hbWU6InZvaWNlcyIsZGVmYXVsdFZhbHVlOjUsbWluOjEsYXV0b21hdGlvblJhdGU6ImstcmF0ZSJ9XX1wcm9jZXNzKHQscyxlKXtjb25zdCBpPWUuYmVnaW5bMF0sbj1lLmVuZFswXSxhPWk+PTAsbz1uPj0wLGM9byYmY3VycmVudFRpbWU+PW4rLjUsaD1vJiZjdXJyZW50VGltZT49bixmPWN1cnJlbnRUaW1lPD1pO2lmKGMpcmV0dXJuITE7aWYoaHx8Znx8IWEpcmV0dXJuITA7Y29uc3QgdT1zWzBdLGQ9ZS52b2ljZXNbMF07Zm9yKGxldCBsPTA7bDx1WzBdLmxlbmd0aDtsKyspe2NvbnN0IHA9YihlLmRldHVuZSxsKSxtPWIoZS5mcmVxc3ByZWFkLGwpLEk9YihlLnBhbnNwcmVhZCxsKSouNSsuNTtsZXQgdz1NYXRoLnNxcnQoMS1JKSx2PU1hdGguc3FydChJKSxNPWIoZS5mcmVxdWVuY3ksbCk7TT1ldChNLHAvMTAwKTtjb25zdCBQPVV0KGQsbSk7Zm9yKGxldCBnPTA7ZzxkO2crKyl7Y29uc3QgVD1ldChNLFAoZykpLEE9UShUKkcpO3RoaXMucGhhc2VbZ109dGhpcy5waGFzZVtnXT8/TWF0aC5yYW5kb20oKTtjb25zdCBWPXl0LnNhd2JsZXAodGhpcy5waGFzZVtnXSxBKTt1WzBdW2xdKz1WKncsdVsxXVtsXSs9Vip2O2xldCBPPXRoaXMucGhhc2VbZ10rQTtPPj0xJiYoTy09MSksdGhpcy5waGFzZVtnXT1PO2NvbnN0IE49dzt3PXYsdj1OfX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoInN1cGVyc2F3LW9zY2lsbGF0b3IiLGdlKTtjb25zdCBiZT0yMDQ4LFB0PW5ldyBNYXA7ZnVuY3Rpb24gdmUocil7aWYoIVB0LmhhcyhyKSl7Y29uc3QgdD1uZXcgRmxvYXQzMkFycmF5KHIpO2ZvcihsZXQgcz0wO3M8cjtzKyspdFtzXT0uNSooMS1NYXRoLmNvcyh6KnMvcikpO1B0LnNldChyLHQpfXJldHVybiBQdC5nZXQocil9Y2xhc3MgSWUgZXh0ZW5kcyBYe3N0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKXtyZXR1cm5be25hbWU6InBpdGNoRmFjdG9yIixkZWZhdWx0VmFsdWU6MX1dfWNvbnN0cnVjdG9yKHQpe3QucHJvY2Vzc29yT3B0aW9ucz17YmxvY2tTaXplOmJlfSxzdXBlcih0KSx0aGlzLnRpbWVDdXJzb3I9MCx0aGlzLmZmdFNpemU9dGhpcy5ibG9ja1NpemUsdGhpcy5pbnZmZnRTaXplPTEvdGhpcy5mZnRTaXplLHRoaXMuaGFubldpbmRvdz12ZSh0aGlzLmZmdFNpemUpLHRoaXMuZmZ0PW5ldyBRdCh0aGlzLmZmdFNpemUpLHRoaXMuZnJlcUNvbXBsZXhCdWZmZXI9dGhpcy5mZnQuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQ9dGhpcy5mZnQuY3JlYXRlQ29tcGxleEFycmF5KCksdGhpcy50aW1lQ29tcGxleEJ1ZmZlcj10aGlzLmZmdC5jcmVhdGVDb21wbGV4QXJyYXkoKSx0aGlzLm1hZ25pdHVkZXM9bmV3IEZsb2F0MzJBcnJheSh0aGlzLmZmdFNpemUvMisxKSx0aGlzLnBlYWtJbmRleGVzPW5ldyBJbnQzMkFycmF5KHRoaXMubWFnbml0dWRlcy5sZW5ndGgpLHRoaXMubmJQZWFrcz0wfXByb2Nlc3NPTEEodCxzLGUpe2xldCBpPWUucGl0Y2hGYWN0b3JbZS5waXRjaEZhY3Rvci5sZW5ndGgtMV07aTwwJiYoaT1pKi4yNSksaT1NYXRoLm1heCgwLGkrMSk7Zm9yKGxldCBuPTA7bjx0aGlzLm5iSW5wdXRzO24rKylmb3IobGV0IGE9MDthPHRbbl0ubGVuZ3RoO2ErKyl7Y29uc3Qgbz10W25dW2FdLGM9c1tuXVthXTt0aGlzLmFwcGx5SGFubldpbmRvdyhvKSx0aGlzLmZmdC5yZWFsVHJhbnNmb3JtKHRoaXMuZnJlcUNvbXBsZXhCdWZmZXIsbyksdGhpcy5jb21wdXRlTWFnbml0dWRlcygpLHRoaXMuZmluZFBlYWtzKCksdGhpcy5zaGlmdFBlYWtzKGkpLHRoaXMuZmZ0LmNvbXBsZXRlU3BlY3RydW0odGhpcy5mcmVxQ29tcGxleEJ1ZmZlclNoaWZ0ZWQpLHRoaXMuZmZ0LmludmVyc2VUcmFuc2Zvcm0odGhpcy50aW1lQ29tcGxleEJ1ZmZlcix0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZCksdGhpcy5mZnQuZnJvbUNvbXBsZXhBcnJheSh0aGlzLnRpbWVDb21wbGV4QnVmZmVyLGMpLHRoaXMuYXBwbHlIYW5uV2luZG93KGMpfXRoaXMudGltZUN1cnNvcis9dGhpcy5ob3BTaXplfWFwcGx5SGFubldpbmRvdyh0KXtmb3IobGV0IHM9MDtzPHRoaXMuYmxvY2tTaXplO3MrKyl0W3NdKj10aGlzLmhhbm5XaW5kb3dbc10qMS42Mn1jb21wdXRlTWFnbml0dWRlcygpe2xldCB0PTAscz0wO2Zvcig7dDx0aGlzLm1hZ25pdHVkZXMubGVuZ3RoOyl7Y29uc3QgZT10aGlzLmZyZXFDb21wbGV4QnVmZmVyW3NdLGk9dGhpcy5mcmVxQ29tcGxleEJ1ZmZlcltzKzFdO3RoaXMubWFnbml0dWRlc1t0XT1lKioyK2kqKjIsdCs9MSxzKz0yfX1maW5kUGVha3MoKXt0aGlzLm5iUGVha3M9MDtsZXQgdD0yO2NvbnN0IHM9dGhpcy5tYWduaXR1ZGVzLmxlbmd0aC0yO2Zvcig7dDxzOyl7Y29uc3QgZT10aGlzLm1hZ25pdHVkZXNbdF07aWYodGhpcy5tYWduaXR1ZGVzW3QtMV0+PWV8fHRoaXMubWFnbml0dWRlc1t0LTJdPj1lKXt0Kys7Y29udGludWV9aWYodGhpcy5tYWduaXR1ZGVzW3QrMV0+PWV8fHRoaXMubWFnbml0dWRlc1t0KzJdPj1lKXt0Kys7Y29udGludWV9dGhpcy5wZWFrSW5kZXhlc1t0aGlzLm5iUGVha3NdPXQsdGhpcy5uYlBlYWtzKyssdCs9Mn19c2hpZnRQZWFrcyh0KXt0aGlzLmZyZXFDb21wbGV4QnVmZmVyU2hpZnRlZC5maWxsKDApO2ZvcihsZXQgcz0wO3M8dGhpcy5uYlBlYWtzO3MrKyl7Y29uc3QgZT10aGlzLnBlYWtJbmRleGVzW3NdLGk9c3QoZSp0KTtpZihpPnRoaXMubWFnbml0dWRlcy5sZW5ndGgpYnJlYWs7bGV0IG49MCxhPXRoaXMuZmZ0U2l6ZTtzPjAmJihuPWUtc3QoKGUtdGhpcy5wZWFrSW5kZXhlc1tzLTFdKS8yKSksczx0aGlzLm5iUGVha3MtMSYmKGE9ZSthZSgodGhpcy5wZWFrSW5kZXhlc1tzKzFdLWUpLzIpKTtjb25zdCBvPW4tZSxjPWEtZSxoPXoqdGhpcy5pbnZmZnRTaXplKihpLWUpLGY9TWF0aC5jb3MoaCp0aGlzLnRpbWVDdXJzb3IpLHU9TWF0aC5zaW4oaCp0aGlzLnRpbWVDdXJzb3IpO2ZvcihsZXQgZD1vO2Q8YztkKyspe2NvbnN0IGw9ZStkLHA9aStkO2lmKHA+PXRoaXMubWFnbml0dWRlcy5sZW5ndGgpYnJlYWs7Y29uc3QgbT0yKmwsST1tKzEsdz10aGlzLmZyZXFDb21wbGV4QnVmZmVyW21dLHY9dGhpcy5mcmVxQ29tcGxleEJ1ZmZlcltJXSxNPXcqZi12KnUsUD13KnUrdipmLGc9MipwLFQ9ZysxO3RoaXMuZnJlcUNvbXBsZXhCdWZmZXJTaGlmdGVkW2ddKz1NLHRoaXMuZnJlcUNvbXBsZXhCdWZmZXJTaGlmdGVkW1RdKz1QfX19fXJlZ2lzdGVyUHJvY2Vzc29yKCJwaGFzZS12b2NvZGVyLXByb2Nlc3NvciIsSWUpO2NsYXNzIHdlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnBoaT0tRCx0aGlzLlkwPTAsdGhpcy5ZMT0wLHRoaXMuUFc9RCx0aGlzLkI9Mi4zLHRoaXMuZHBoaWY9MCx0aGlzLmVudmY9MH1zdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJiZWdpbiIsZGVmYXVsdFZhbHVlOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWSxtaW46MH0se25hbWU6ImVuZCIsZGVmYXVsdFZhbHVlOjAsbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWSxtaW46MH0se25hbWU6ImZyZXF1ZW5jeSIsZGVmYXVsdFZhbHVlOjQ0MCxtaW46TnVtYmVyLkVQU0lMT059LHtuYW1lOiJkZXR1bmUiLGRlZmF1bHRWYWx1ZTowLG1pbjpOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksbWF4Ok51bWJlci5QT1NJVElWRV9JTkZJTklUWX0se25hbWU6InB1bHNld2lkdGgiLGRlZmF1bHRWYWx1ZToxLG1pbjowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl9XX1wcm9jZXNzKHQscyxlKXtpZih0aGlzLmRpc2Nvbm5lY3RlZClyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9ZS5iZWdpblswXSlyZXR1cm4hMDtpZihjdXJyZW50VGltZT49ZS5lbmRbMF0pcmV0dXJuITE7Y29uc3QgaT1zWzBdO2xldCBuPTEsYTtmb3IobGV0IG89MDtvPChpWzBdLmxlbmd0aD8/MCk7bysrKXtjb25zdCBjPSgxLVMoYihlLnB1bHNld2lkdGgsbyksLS45OSwuOTkpKSpELGg9YihlLmRldHVuZSxvKSxmPWV0KGIoZS5mcmVxdWVuY3ksbyksaC8xMDApO2E9Zip6KkcsdGhpcy5kcGhpZis9LjEqKGEtdGhpcy5kcGhpZiksbio9Ljk5OTgsdGhpcy5lbnZmKz0uMSoobi10aGlzLmVudmYpLHRoaXMuQj0yLjMqKDEtMWUtNCpmKSx0aGlzLkI8MCYmKHRoaXMuQj0wKSx0aGlzLnBoaSs9dGhpcy5kcGhpZix0aGlzLnBoaT49RCYmKHRoaXMucGhpLT16KTtsZXQgdT1NYXRoLmNvcyh0aGlzLnBoaSt0aGlzLkIqdGhpcy5ZMCk7dGhpcy5ZMD0uNSoodSt0aGlzLlkwKTtsZXQgZD1NYXRoLmNvcyh0aGlzLnBoaSt0aGlzLkIqdGhpcy5ZMStjKTt0aGlzLlkxPS41KihkK3RoaXMuWTEpO2ZvcihsZXQgbD0wO2w8aS5sZW5ndGg7bCsrKWlbbF1bb109LjE1Kih1LWQpKnRoaXMuZW52Zn1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoInB1bHNlLW9zY2lsbGF0b3IiLHdlKTtjb25zdCBUdD17Yml0QzpmdW5jdGlvbihyLHQscyl7cmV0dXJuIHImdD9zOjB9LGJyOmZ1bmN0aW9uKHIsdD04KXtpZih0PjMyKXRocm93IG5ldyBFcnJvcigiYnIoKSBTaXplIGNhbm5vdCBiZSBncmVhdGVyIHRoYW4gMzIiKTtsZXQgcz0wO2ZvcihsZXQgZT0wO2U8dDtlKyspc3w9VHQuYml0QyhyLDE8PGUsMTw8dC0oZSsxKSk7cmV0dXJuIHN9LHNpbmY6ZnVuY3Rpb24ocil7cmV0dXJuIE1hdGguc2luKHIqRC8xMjgpfSxjb3NmOmZ1bmN0aW9uKHIpe3JldHVybiBNYXRoLmNvcyhyKkQvMTI4KX0sdGFuZjpmdW5jdGlvbihyKXtyZXR1cm4gTWF0aC50YW4ocipELzEyOCl9LHJlZ0c6ZnVuY3Rpb24ocix0KXtyZXR1cm4gdC50ZXN0KHIudG9TdHJpbmcoMikpfX07bGV0IGx0LEJ0O2Z1bmN0aW9uIFNlKHIpe2lmKGx0PT1udWxsKXtsdD1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhNYXRoKSxCdD1sdC5tYXAoZT0+TWF0aFtlXSk7Y29uc3QgdD1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhUdCkscz10Lm1hcChlPT5UdFtlXSk7bHQucHVzaCgiaW50Iiwid2luZG93IiwuLi50KSxCdC5wdXNoKE1hdGguZmxvb3IsZ2xvYmFsVGhpcywuLi5zKX1yZXR1cm4gbmV3IEZ1bmN0aW9uKC4uLmx0LCJ0IixgcmV0dXJuIDAsCiR7cnx8MH07YCkuYmluZChnbG9iYWxUaGlzLC4uLkJ0KX1jbGFzcyBfZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5wb3J0Lm9ubWVzc2FnZT10PT57bGV0e2NvZGVUZXh0OnN9PXQuZGF0YTtjb25zdHtieXRlQmVhdFN0YXJ0VGltZTplfT10LmRhdGE7ZSE9bnVsbCYmKHRoaXMudD0wLHRoaXMuaW5pdGlhbE9mZnNldD1NYXRoLmZsb29yKGUpKSxzPXMudHJpbSgpLnJlcGxhY2UoL15ldmFsXCh1bmVzY2FwZVwoZXNjYXBlKD86YHxcKCd8XCgifFwoYCkoLio/KSg/OmB8J1wpfCJcKXxgXCkpLnJlcGxhY2VcKFwvdVwoXC5cLlwpXC9nLFsiJ2BdXCQxJVsiJ2BdXClcKVwpJC8sKGksbik9PnVuZXNjYXBlKGVzY2FwZShuKS5yZXBsYWNlKC91KC4uKS9nLCIkMSUiKSkpLHRoaXMuZnVuYz1TZShzKX0sdGhpcy5pbml0aWFsT2Zmc2V0PTAsdGhpcy50PW51bGwsdGhpcy5mdW5jPW51bGx9c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiYmVnaW4iLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTo0NDAsbWluOk51bWJlci5FUFNJTE9OfSx7bmFtZToiZGV0dW5lIixkZWZhdWx0VmFsdWU6MCxtaW46TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl9LHtuYW1lOiJlbmQiLGRlZmF1bHRWYWx1ZTowLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksbWluOjB9XX1wcm9jZXNzKHQscyxlKXtpZih0aGlzLmRpc2Nvbm5lY3RlZClyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9ZS5iZWdpblswXSlyZXR1cm4hMDtpZihjdXJyZW50VGltZT49ZS5lbmRbMF0pcmV0dXJuITE7dGhpcy50PT1udWxsJiYodGhpcy50PWUuYmVnaW5bMF0qc2FtcGxlUmF0ZSk7Y29uc3QgaT1zWzBdLG49MjU2Kkc7Zm9yKGxldCBhPTA7YTxpWzBdLmxlbmd0aDthKyspe2NvbnN0IG89YihlLmRldHVuZSxhKSxjPWV0KGIoZS5mcmVxdWVuY3ksYSksby8xMDApLGg9bipjKnRoaXMudCt0aGlzLmluaXRpYWxPZmZzZXQsdT0odGhpcy5mdW5jKGgpJjI1NSkvMTI3LjUtMSxkPVModSouMiwtLjQsLjQpO2ZvcihsZXQgbD0wO2w8aS5sZW5ndGg7bCsrKWlbbF1bYV09ZDt0aGlzLnQrK31yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImJ5dGUtYmVhdC1wcm9jZXNzb3IiLF9lKTtjbGFzcyBNZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJiZWdpbiIsZGVmYXVsdFZhbHVlOjB9LHtuYW1lOiJlbmQiLGRlZmF1bHRWYWx1ZTowfSx7bmFtZToiYXR0YWNrIixkZWZhdWx0VmFsdWU6LjAwNSxtaW5WYWx1ZTowfSx7bmFtZToiZGVjYXkiLGRlZmF1bHRWYWx1ZTouMTQsbWluVmFsdWU6MH0se25hbWU6InN1c3RhaW4iLGRlZmF1bHRWYWx1ZTowLG1pblZhbHVlOjAsbWF4VmFsdWU6MX0se25hbWU6InJlbGVhc2UiLGRlZmF1bHRWYWx1ZTouMSxtaW5WYWx1ZTowfSx7bmFtZToiYXR0YWNrQ3VydmUiLGRlZmF1bHRWYWx1ZTowLG1pblZhbHVlOi0xLG1heFZhbHVlOjF9LHtuYW1lOiJkZWNheUN1cnZlIixkZWZhdWx0VmFsdWU6MCxtaW5WYWx1ZTotMSxtYXhWYWx1ZToxfSx7bmFtZToicmVsZWFzZUN1cnZlIixkZWZhdWx0VmFsdWU6MCxtaW5WYWx1ZTotMSxtYXhWYWx1ZToxfSx7bmFtZToiZGVwdGgiLGRlZmF1bHRWYWx1ZToxfSx7bmFtZToibWluIixkZWZhdWx0VmFsdWU6LTFlOX0se25hbWU6Im1heCIsZGVmYXVsdFZhbHVlOjFlOX0se25hbWU6InJldHJpZ2dlciIsZGVmYXVsdFZhbHVlOjEsbWluVmFsdWU6MCxtYXhWYWx1ZToxfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMudmFsPTAsdGhpcy5zZWdJZHg9MCx0aGlzLnN0YXRlPTAsdGhpcy5iZWdpblRpbWU9MCx0aGlzLmVuZFRpbWU9MCx0aGlzLmF0dGFja1N0YXJ0PTB9X3dhcnAodCxzLGU9OCl7aWYodD09PTB8fHQ9PT0xKXJldHVybiB0O2lmKHM+MCl7Y29uc3QgaT0xK2UqcztyZXR1cm4gMS1NYXRoLnBvdygxLXQsaSl9ZWxzZXtjb25zdCBpPTEtZSpzO3JldHVybiBNYXRoLnBvdyh0LGkpfX1fYWR2YW5jZSh0LHMsZSxpKXtpZihlPT09MHx8dD09PXMpdGhpcy52YWw9cztlbHNle2NvbnN0IG49TWF0aC5taW4oMSwoY3VycmVudFRpbWUtdGhpcy5iZWdpblRpbWUpL2UpLGE9dGhpcy5fd2FycChuLGkpO3RoaXMudmFsPXQrKHMtdCkqYX19cHJvY2Vzcyh0LHMsZSl7Y29uc3QgaT1lLmJlZ2luWzBdLG49ZS5lbmRbMF07aWYoY3VycmVudFRpbWU+PW4pcmV0dXJuITE7aWYoY3VycmVudFRpbWU8PWkpcmV0dXJuITA7Y29uc3QgYT1zWzBdWzBdLG89YihlLnJldHJpZ2dlciwwKT49LjU7aSE9PXRoaXMuYmVnaW5UaW1lJiYodGhpcy5zdGF0ZT09PTB8fG8pJiYodGhpcy5iZWdpblRpbWU9aSx0aGlzLnN0YXRlPTEsdGhpcy5lbmRUaW1lPWIoZS5lbmQsMCksdGhpcy5hdHRhY2tTdGFydD10aGlzLnZhbCk7Y29uc3QgYz10aGlzLmVuZFRpbWUtdGhpcy5iZWdpblRpbWU7Zm9yKGxldCBoPTA7aDxhLmxlbmd0aDtoKyspe2NvbnN0IGY9YihlLmF0dGFjayxoKSx1PWIoZS5kZWNheSxoKSxkPWIoZS5zdXN0YWluLGgpLGw9YihlLnJlbGVhc2UsaCkscD1iKGUuYXR0YWNrQ3VydmUsaCksbT1iKGUuZGVjYXlDdXJ2ZSxoKSxJPWIoZS5yZWxlYXNlQ3VydmUsaCksdz1iKGUuZGVwdGgsaCksdj1iKGUubWluLGgpLE09YihlLm1heCxoKSxQPVt7dGltZTpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksc3RhcnQ6MCx0YXJnZXQ6MH0se3RpbWU6ZixzdGFydDp0aGlzLmF0dGFja1N0YXJ0LHRhcmdldDoxLGN1cnZlOnB9LHt0aW1lOmYrdSxzdGFydDoxLHRhcmdldDpkLGN1cnZlOm19LHt0aW1lOmMsc3RhcnQ6ZCx0YXJnZXQ6ZH0se3RpbWU6YytsLHN0YXJ0OmQsdGFyZ2V0OjAsY3VydmU6SX1dO2xldHt0aW1lOmcsc3RhcnQ6VCx0YXJnZXQ6QSxjdXJ2ZTpWfT1QW3RoaXMuc3RhdGVdO2Zvcih0aGlzLl9hZHZhbmNlKFQsQSxnLFYpO2N1cnJlbnRUaW1lLXRoaXMuYmVnaW5UaW1lPj1nOyl0aGlzLnN0YXRlPSh0aGlzLnN0YXRlKzEpJVAubGVuZ3RoLGc9UFt0aGlzLnN0YXRlXS50aW1lO2FbaF09Uyh0aGlzLnZhbCp3LHYsTSl9cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJlbnZlbG9wZS1wcm9jZXNzb3IiLE1lKTtjb25zdCB4PU9iamVjdC5mcmVlemUoe05PTkU6MCxBU1lNOjEsTUlSUk9SOjIsQkVORFA6MyxCRU5ETTo0LEJFTkRNUDo1LFNZTkM6NixRVUFOVDo3LEZPTEQ6OCxQV006OSxPUkJJVDoxMCxTUElOOjExLENIQU9TOjEyLFBSSU1FUzoxMyxCSU5BUlk6MTQsQlJPV05JQU46MTUsUkVDSVBST0NBTDoxNixXT1JNSE9MRToxNyxMT0dJU1RJQzoxOCxTSUdNT0lEOjE5LEZSQUNUQUw6MjAsRkxJUDoyMX0pO2Z1bmN0aW9uIHhlKHIpe3JldHVybiByPXIrMjEyNzkxMjIxNCsocjw8MTIpLHI9cl4zMzQ1MDcyNzAwXnI+Pj4xOSxyPXIrMzc0NzYxMzkzKyhyPDw1KSxyPXIrMzU1MDYzNTExNl5yPDw5LHI9cis0MjUxOTkzNzk3KyhyPDwzKSxyPXJeMzA0MjU5NDU2OV5yPj4+MTYscj4+PjB9Y29uc3QgS3Q9cj0+KHhlKHIpPj4+OCkvMTY3NzcyMTY7ZnVuY3Rpb24geWUocix0KXtsZXQgcz0wO2ZvcihsZXQgZT0wO2U8dDtlKyspcz1zPDwxfHImMSxyPj4+PTE7cmV0dXJuIHN9ZnVuY3Rpb24gUGUocil7Y29uc3QgdD1NYXRoLmZsb29yKHIpLHM9ci10LGU9S3QodCksaT1LdCh0KzEpO3JldHVybiBlKyhpLWUpKnN9ZnVuY3Rpb24gVGUocix0PTQpe2xldCBzPS41LGU9MCxpPTAsbj0xO2ZvcihsZXQgYT0wO2E8dDthKyspZSs9cypQZShyKm4pLGkrPXMscyo9LjUsbio9MjtyZXR1cm4gZS9pKjItMX1jb25zdCBWdD17fTtjbGFzcyBCZSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvcntzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCl7cmV0dXJuW3tuYW1lOiJiZWdpbiIsZGVmYXVsdFZhbHVlOi0xLG1pbjotMSxtYXg6TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfSx7bmFtZToiZW5kIixkZWZhdWx0VmFsdWU6LTEsbWluOi0xLG1heDpOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl9LHtuYW1lOiJmcmVxdWVuY3kiLGRlZmF1bHRWYWx1ZTo0NDAsbWluOk51bWJlci5FUFNJTE9OfSx7bmFtZToiZGV0dW5lIixkZWZhdWx0VmFsdWU6MH0se25hbWU6ImZyZXFzcHJlYWQiLGRlZmF1bHRWYWx1ZTouMTgsbWluOjB9LHtuYW1lOiJwb3NpdGlvbiIsZGVmYXVsdFZhbHVlOjAsbWluOjAsbWF4OjF9LHtuYW1lOiJ3YXJwIixkZWZhdWx0VmFsdWU6MCxtaW46MCxtYXg6MX0se25hbWU6IndhcnBNb2RlIixkZWZhdWx0VmFsdWU6MH0se25hbWU6InZvaWNlcyIsZGVmYXVsdFZhbHVlOjEsbWluOjEsYXV0b21hdGlvblJhdGU6ImstcmF0ZSJ9LHtuYW1lOiJwYW5zcHJlYWQiLGRlZmF1bHRWYWx1ZTouNyxtaW46MCxtYXg6MX0se25hbWU6InBoYXNlcmFuZCIsZGVmYXVsdFZhbHVlOjAsbWluOjAsbWF4OjF9XX1jb25zdHJ1Y3Rvcih0KXtzdXBlcih0KSx0aGlzLnBvcnQub25tZXNzYWdlPXM9Pntjb25zdHt0eXBlOmUscGF5bG9hZDppfT1zLmRhdGF8fHt9O2U9PT0iaW5pdGlhbGl6ZSImJnRoaXMuaW5pdGlhbGl6ZShpKX0sdGhpcy5pbml0aWFsaXplKCl9aW5pdGlhbGl6ZSh0KXtpZih0aGlzLnRhYmxlPW51bGwsdGhpcy5mcmFtZUxlbj1udWxsLHRoaXMubnVtRnJhbWVzPW51bGwsdGhpcy5waGFzZT1bXSx0IT1udWxsJiZ0LmtleSl7Y29uc3Qgcz10LmtleTt0aGlzLmZyYW1lTGVuPXQuZnJhbWVMZW4sVnRbc118fChWdFtzXT10LmZyYW1lcyksdGhpcy50YWJsZT1WdFtzXSx0aGlzLm51bUZyYW1lcz10aGlzLnRhYmxlLmxlbmd0aH19X21pcnJvcih0KXtyZXR1cm4gMS1NYXRoLmFicygyKnQtMSl9X3RvQml0cyh0LHM9MixlPTEyKXtjb25zdCBpPWUrKHMtZSkqdDtyZXR1cm57YjppLG46c3QoTWF0aC5wb3coMixpKSl9fV93YXJwUGhhc2UodCxzLGUpe3N3aXRjaChlKXtjYXNlIHguTk9ORTpyZXR1cm4gdDtjYXNlIHguQVNZTTp7Y29uc3QgaT0uMDErLjk5KnM7cmV0dXJuIHQ8aT8uNSp0L2k6LjUrLjUqKHQtaSkvKDEtaSl9Y2FzZSB4Lk1JUlJPUjpyZXR1cm4gdGhpcy5fbWlycm9yKHRoaXMuX3dhcnBQaGFzZSh0LHMseC5BU1lNKSk7Y2FzZSB4LkJFTkRQOnJldHVybiBNYXRoLnBvdyh0LDErMypzKTtjYXNlIHguQkVORE06cmV0dXJuIE1hdGgucG93KHQsMS8oMSszKnMpKTtjYXNlIHguQkVORE1QOnJldHVybiBzPC41P3RoaXMuX3dhcnBQaGFzZSh0LDEtMipzLDMpOnRoaXMuX3dhcnBQaGFzZSh0LDIqcy0xLDIpO2Nhc2UgeC5TWU5DOntjb25zdCBpPU1hdGgucG93KDE2LHMqKjIpO3JldHVybiB0KmklMX1jYXNlIHguUVVBTlQ6e2NvbnN0e246aX09dGhpcy5fdG9CaXRzKHMpO3JldHVybiB0dCh0KmkpL2l9Y2FzZSB4LkZPTEQ6e2NvbnN0IG49MStNYXRoLm1heCgxLHN0KDcqcykpO3JldHVybiBNYXRoLmFicyhIdChuKnQpLS41KSoyfWNhc2UgeC5QV006e2NvbnN0IGk9UyguNSsuNDkqKDIqcy0xKSwwLDEpO3JldHVybiB0PGk/dC9pKi41Oi41Kyh0LWkpLygxLWkpKi41fWNhc2UgeC5PUkJJVDp7Y29uc3QgaT0uNSpzO3JldHVybiBRKHQraSpNYXRoLnNpbih6KjMqdCkpfWNhc2UgeC5TUElOOntjb25zdCBpPS41KnMse259PXRoaXMuX3RvQml0cyhzLDEsNik7cmV0dXJuIFEodCtpKk1hdGguc2luKHoqbip0KSl9Y2FzZSB4LkNIQU9TOntjb25zdCBuPSgzLjcrLjMqcykqdCooMS10KTtyZXR1cm4gUygoMS1zKSp0K3MqbiwwLDEpfWNhc2UgeC5QUklNRVM6e2NvbnN0IGk9YT0+e2lmKGE8MilyZXR1cm4hMTtpZihhJTI9PT0wKXJldHVybiBhPT09Mjtmb3IobGV0IG89MztvKioyPD1hO28rPTIpaWYoYSVvPT09MClyZXR1cm4hMTtyZXR1cm4hMH07bGV0e259PXRoaXMuX3RvQml0cyhzLDMpO2Zvcig7IWkobik7KW4rKztyZXR1cm4gdHQodCpuKS9ufWNhc2UgeC5CSU5BUlk6e2xldHtiOml9PXRoaXMuX3RvQml0cyhzLDMpO2k9c3QoaSk7Y29uc3Qgbj0xPDxpLGE9dHQodCpuKTtyZXR1cm4geWUoYSxpKS9ufWNhc2UgeC5CUk9XTklBTjp7Y29uc3QgaT0uMjUqcypUZSg2NCp0LDQpO3JldHVybiBRKHQraSl9Y2FzZSB4LlJFQ0lQUk9DQUw6e2NvbnN0IGk9Mis0KnMsbj10KmksYT10KygxLXQpKmksbz1hPjFlLTEyP24vYTowO3JldHVybiBTKG8sMCwxKX1jYXNlIHguV09STUhPTEU6e2NvbnN0IGk9UyguOCpzLDAsMSksbj0uNSooMS1pKSxhPS41KigxK2kpO3JldHVybiB0PG4/dC9uKi41OnQ+YT8uNSooMSsodC1hKS8oMS1hKSk6LjV9Y2FzZSB4LkxPR0lTVElDOntsZXQgaT10O2NvbnN0IG49My42Ky40KnMsYT0xK3N0KDIqcyk7Zm9yKGxldCBvPTA7bzxhO28rKylpPW4qaSooMS1pKTtyZXR1cm4gUyhpLDAsMSl9Y2FzZSB4LlNJR01PSUQ6e2NvbnN0IGk9MSsxMCpzLG49dC0uNSxhPTEvKDErTWF0aC5leHAoLWkqbikpLG89MS8oMStNYXRoLmV4cCguNSppKSksYz0xLygxK01hdGguZXhwKC0uNSppKSk7cmV0dXJuKGEtbykvKGMtbyl9Y2FzZSB4LkZSQUNUQUw6e2NvbnN0IGk9LjUqTWF0aC5zaW4oeip0KSpzO3JldHVybiBRKHQraSl9Y2FzZSB4LkZMSVA6cmV0dXJuIHQ7ZGVmYXVsdDpyZXR1cm4gdH19X3NhbXBsZUZyYW1lKHQscyl7Y29uc3QgZT10Lmxlbmd0aCxpPXMqZTtsZXQgbj1pfDA7bj49ZSYmKG49MCk7Y29uc3QgYT1pLW4sbz10W25dO2xldCBjPW4rMTtjPj1lJiYoYz0wKTtjb25zdCBoPXRbY107cmV0dXJuIG8rKGgtbykqYX1wcm9jZXNzKHQscyxlKXtjb25zdCBpPWUuYmVnaW5bMF0sbj1lLmVuZFswXSxhPWk+PTAsbz1uPj0wLGM9byYmY3VycmVudFRpbWU+PW4rLjUsaD1vJiZjdXJyZW50VGltZT49bixmPWN1cnJlbnRUaW1lPD1pO2lmKGMpcmV0dXJuITE7aWYoaHx8Znx8IWEpcmV0dXJuITA7Y29uc3QgdT1zWzBdWzBdLGQ9c1swXVsxXXx8c1swXVswXTtpZighdGhpcy50YWJsZSlyZXR1cm4gdS5maWxsKDApLGQhPT11JiZkLnNldCh1KSwhMDtjb25zdCBsPWUudm9pY2VzWzBdO2ZvcihsZXQgcD0wO3A8dS5sZW5ndGg7cCsrKXtjb25zdCBtPWIoZS5kZXR1bmUscCksST1iKGUuZnJlcXNwcmVhZCxwKSx2PVMoYihlLnBvc2l0aW9uLHApLDAsMSkqKHRoaXMubnVtRnJhbWVzLTEpLE09dnwwLFA9di1NLGc9UyhiKGUud2FycCxwKSwwLDEpLFQ9YihlLndhcnBNb2RlLHApLEE9UyhiKGUucGhhc2VyYW5kLHApLDAsMSksVj1sPjE/UyhiKGUucGFuc3ByZWFkLHApLDAsMSk6MCxPPU1hdGguc3FydCguNS0uNSpWKSxOPU1hdGguc3FydCguNSsuNSpWKTtsZXQgQz1iKGUuZnJlcXVlbmN5LHApO0M9ZXQoQyxtLzEwMCk7Y29uc3QgRj0xL01hdGguc3FydChsKSxxPVV0KGwsSSk7Zm9yKGxldCBCPTA7QjxsO0IrKyl7Y29uc3QgTD0oQiYxKT09MTtsZXQgRT1PLEg9TjtMJiYoRT1OLEg9Tyk7Y29uc3QgJD1ldChDLHEoQikpKkc7dGhpcy5waGFzZVtCXT10aGlzLnBoYXNlW0JdPz9NYXRoLnJhbmRvbSgpKkE7Y29uc3QgVT10aGlzLl93YXJwUGhhc2UodGhpcy5waGFzZVtCXSxnLFQpLEs9dGhpcy5fc2FtcGxlRnJhbWUodGhpcy50YWJsZVtNXSxVKSxaPXRoaXMuX3NhbXBsZUZyYW1lKHRoaXMudGFibGVbTWF0aC5taW4odGhpcy5udW1GcmFtZXMtMSxNKzEpXSxVKTtsZXQgaz11dChLLFosUCk7VD09PXguRkxJUCYmdGhpcy5waGFzZVtCXTxnJiYoaz0tayksdVtwXSs9aypFKkYsZFtwXSs9aypIKkYsdGhpcy5waGFzZVtCXT1RKHRoaXMucGhhc2VbQl0rJCl9fXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3Nvcigid2F2ZXRhYmxlLW9zY2lsbGF0b3ItcHJvY2Vzc29yIixCZSk7Y2xhc3MgVmUgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVybltdfWNvbnN0cnVjdG9yKHQpe3N1cGVyKCksdGhpcy5nYWluQ29lZmY9eHQoLjIpLHRoaXMuYXZnR2Fpbj0xO2xldHthdHRhY2tUaW1lOnM9LjAwMyxzdXN0YWluVGltZTplPS4wOCxhdHRhY2s6aT0wLHN1c3RhaW46bj0wLHNlbnNpdGl2aXR5OmE9LjEsbWl4Om89MSxiZWdpbjpjPTAsZW5kOmg9MH09dC5wcm9jZXNzb3JPcHRpb25zO3M9UyhzLDVlLTQsLjA1KSxlPVMoZSwuMDEsLjUpLHRoaXMuYXR0YWNrQ29lZmY9eHQocyksdGhpcy5zdXN0YWluQ29lZmY9eHQoZSksdGhpcy5hdHRhY2tBbXQ9UyhpLC0xLDEpLHRoaXMuc3VzdGFpbkFtdD1TKG4sLTEsMSksdGhpcy5zY2FsaW5nPS41KzUqUyhhLDAsMSksdGhpcy5taXg9UyhvLDAsMSksdGhpcy5iZWdpbj1jLHRoaXMuZW5kPWgsdGhpcy5hdHRhY2tFbnY9bmV3IEZsb2F0MzJBcnJheSgyKSx0aGlzLnN1c3RhaW5FbnY9bmV3IEZsb2F0MzJBcnJheSgyKX1wcm9jZXNzKHQscyxlKXtjb25zdCBpPXRbMF0sbj1zWzBdO2lmKGN1cnJlbnRUaW1lPj10aGlzLmVuZClyZXR1cm4hMTtpZihjdXJyZW50VGltZTw9dGhpcy5iZWdpbilyZXR1cm4hMDtjb25zdCBhPWkubGVuZ3RoO2E+dGhpcy5hdHRhY2tFbnYubGVuZ3RoJiYodGhpcy5hdHRhY2tFbnY9bmV3IEZsb2F0MzJBcnJheShhKSx0aGlzLnN1c3RhaW5FbnY9bmV3IEZsb2F0MzJBcnJheShhKSk7bGV0IG89dGhpcy5hdmdHYWluO2ZvcihsZXQgYz0wO2M8YTtjKyspe2xldCBoPXRoaXMuYXR0YWNrRW52W2NdLGY9dGhpcy5zdXN0YWluRW52W2NdO2ZvcihsZXQgdT0wO3U8WTt1Kyspe2NvbnN0IGQ9aVtjXVt1XSxsPU1hdGguYWJzKGQpO2g9dXQoaCxsLHRoaXMuYXR0YWNrQ29lZmYpLGY9dXQoZixsLHRoaXMuc3VzdGFpbkNvZWZmKTtjb25zdCBwPVModGhpcy5zY2FsaW5nKihoLWYpLyhmKzFlLTYpLC0xLjUsMS41KSxtPXA+MD9wOjAsST1wPDA/LXA6MCx3PWp0KHRoaXMuYXR0YWNrQW10Km0qMTgpLHY9anQodGhpcy5zdXN0YWluQW10KkkqMzYpLE09Uyh3KnYsMCw4KTtvPXV0KG8sTSx0aGlzLmdhaW5Db2VmZik7Y29uc3QgUD1vPi4wMDE/MS9vOjEsZz1kKk0qUDtsZXQgVD11dChkLGcsdGhpcy5taXgpO1QvPTErTWF0aC5hYnMoVCksbltjXVt1XT1UfXRoaXMuYXR0YWNrRW52W2NdPWgsdGhpcy5zdXN0YWluRW52W2NdPWZ9cmV0dXJuIHRoaXMuYXZnR2Fpbj1vLCEwfX1yZWdpc3RlclByb2Nlc3NvcigidHJhbnNpZW50LXByb2Nlc3NvciIsVmUpO2NsYXNzIEFlIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29ye2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLnBsYXlQb3M9MDtjb25zdCB0PTE2O3RoaXMub3V0cHV0cz1uZXcgQXJyYXkodCkuZmlsbCgwKSx0aGlzLnNvdXJjZXM9bmV3IEFycmF5KHQpLmZpbGwoMCksdGhpcy5nYXRlRW5kZWQ9ITEsdGhpcy5zdGFydGVkPSExLHRoaXMucG9ydC5vbm1lc3NhZ2U9cz0+e3ZhciBoLGY7bGV0e3NyYzplLHNjaGVtYTp7dWdlbnM6aSxyZWdpc3RlcnM6bn0sc3RhcnQ6YSxnYXRlRW5kOm8sZW5kOmN9PXMuZGF0YTt0aGlzLnN0YXJ0PWEsdGhpcy5nYXRlRW5kPW8sdGhpcy5lbmQ9Yyx0aGlzLnJlZ2lzdGVycz1uZXcgQXJyYXkobikuZmlsbCgwKSx0aGlzLnNyYz1gby5maWxsKDApOyAvLyByZXNldCBvdXRwdXRzCiR7ZX1gLHRoaXMubm9kZXM9W107Zm9yKGxldCB1PTA7dTxpLmxlbmd0aDt1Kyspe2NvbnN0IGQ9aVt1XSxsPW5lLmdldChkLnR5cGUpLHA9bmV3IGwodSxkLHNhbXBsZVJhdGUpO3AudHlwZT09PSJjYyImJigoZj0oaD1kLmlucHV0cyk9PW51bGw/dm9pZCAwOmhbMF0pIT1udWxsJiZmLmluY2x1ZGVzKCJzdHJ1ZGVsLWdhdGUiKSkmJihwLnNldFZhbHVlKDEpLHRoaXMuZ2F0ZU5vZGU9cCksdGhpcy5ub2Rlc1t1XT1wfXRoaXMuZ2VuU2FtcGxlPW5ldyBGdW5jdGlvbigidGltZSIsIm5vZGVzIiwiaW5wdXQiLCJyIiwibyIsInMiLHRoaXMuc3JjKX19cHJvY2Vzcyh0LHMpe3ZhciBvLGM7Y29uc3QgZT0obz10WzBdKT09bnVsbD92b2lkIDA6b1swXTtpZihjdXJyZW50VGltZT49dGhpcy5lbmQpcmV0dXJuITE7aWYodGhpcy5nZW5TYW1wbGU9PT12b2lkIDB8fGN1cnJlbnRUaW1lPHRoaXMuc3RhcnQpcmV0dXJuITA7dGhpcy5zdGFydGVkPSEwLCF0aGlzLmdhdGVFbmRlZCYmY3VycmVudFRpbWU+dGhpcy5nYXRlRW5kJiYoKGM9dGhpcy5nYXRlTm9kZSk9PW51bGx8fGMuc2V0VmFsdWUoMCksdGhpcy5nYXRlRW5kZWQ9ITApO2NvbnN0IGk9c1swXSxuPWlbMF0sYT1pWzFdO2ZvcihsZXQgaD0wO2g8WTtoKyspe3RoaXMuZ2VuU2FtcGxlKHRoaXMucGxheVBvcyx0aGlzLm5vZGVzLGU/ZVtoXTowLHRoaXMucmVnaXN0ZXJzLHRoaXMub3V0cHV0cyx0aGlzLnNvdXJjZXMpO2NvbnN0IGY9dGhpcy5vdXRwdXRzWzBdLHU9dGhpcy5vdXRwdXRzWzFdO2E/KG5baF09ZixhW2hdPXUpOm5baF09LjUqKGYrdSksdGhpcy5wbGF5UG9zKz0xL3NhbXBsZVJhdGV9cmV0dXJuITB9fXJldHVybiByZWdpc3RlclByb2Nlc3NvcigiZ2VuZXJpYy1wcm9jZXNzb3IiLEFlKSxSLldhcnBNb2RlPXgsT2JqZWN0LmRlZmluZVByb3BlcnR5KFIsU3ltYm9sLnRvU3RyaW5nVGFnLHt2YWx1ZToiTW9kdWxlIn0pLFJ9KHt9KTsK";let Ef=[],Ey=0;const oN=4;let Nit=n=>{let e=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(i){return t.lc=e.push(i),()=>{for(let s=Ey+oN;s<Ef.length;)Ef[s]===i?Ef.splice(s,oN):s+=oN;let r=e.indexOf(i);~r&&(e.splice(r,1),--t.lc||t.off())}},notify(i,r){let s=!Ef.length;for(let a of e)Ef.push(a,t.value,i,r);if(s){for(Ey=0;Ey<Ef.length;Ey+=oN)Ef[Ey](Ef[Ey+1],Ef[Ey+2],Ef[Ey+3]);Ef.length=0}},off(){},set(i){let r=t.value;r!==i&&(t.value=i,t.notify(r))},subscribe(i){let r=t.listen(i);return i(t.value),r},value:n};return t},Bit=(n={})=>{let e=Nit(n);return e.setKey=function(t,i){let r=e.value;typeof i>"u"&&t in e.value?(e.value={...e.value},delete e.value[t],e.notify(r,t)):e.value[t]!==i&&(e.value={...e.value,[t]:i},e.notify(r,t))},e};const Fit={stretch:{node:"stretch",param:"pitchFactor"},gain:{node:"gain",param:"gain"},postgain:{node:"post",param:"gain"},pan:{node:"pan",param:"pan"},tremolo:{node:"tremolo",param:"frequency"},tremolosync:{node:"tremolo",param:"frequency"},tremolodepth:{node:"tremolo_gain",param:"gain"},tremoloskew:{node:"tremolo",param:"skew"},tremolophase:{node:"tremolo",param:"phase"},tremoloshape:{node:"tremolo",param:"shape"},lfo:{node:"lfo",param:"frequency"},lfo_rate:{node:"lfo",param:"frequency"},lfo_sync:{node:"lfo",param:"frequency"},lfo_depth:{node:"lfo",param:"depth"},lfo_depthabs:{node:"lfo",param:"depth"},lfo_skew:{node:"lfo",param:"skew"},lfo_curve:{node:"lfo",param:"curve"},lfo_dcoffset:{node:"lfo",param:"dcoffset"},env:{node:"env",param:"depth"},env_attack:{node:"env",param:"attack"},env_decay:{node:"env",param:"decay"},env_sustain:{node:"env",param:"sustain"},env_release:{node:"env",param:"release"},bmod:{node:"bmod",param:"depth"},bmod_depth:{node:"bmod",param:"depth"},bmod_depthabs:{node:"bmod",param:"depth"},cutoff:{node:"lpf",param:"frequency"},resonance:{node:"lpf",param:"Q"},lprate:{node:"lpf_lfo",param:"rate"},lpsync:{node:"lpf_lfo",param:"sync"},lpdepth:{node:"lpf_lfo",param:"depth"},lpdepthfrequency:{node:"lpf_lfo",param:"depth"},lpshape:{node:"lpf_lfo",param:"shape"},lpdc:{node:"lpf_lfo",param:"dcoffset"},lpskew:{node:"lpf_lfo",param:"skew"},hcutoff:{node:"hpf",param:"frequency"},hresonance:{node:"hpf",param:"Q"},hprate:{node:"hpf_lfo",param:"rate"},hpsync:{node:"hpf_lfo",param:"sync"},hpdepth:{node:"hpf_lfo",param:"depth"},hpdepthfrequency:{node:"hpf_lfo",param:"depth"},hpshape:{node:"hpf_lfo",param:"shape"},hpdc:{node:"hpf_lfo",param:"dcoffset"},hpskew:{node:"hpf_lfo",param:"skew"},bandf:{node:"bpf",param:"frequency"},bandq:{node:"bpf",param:"Q"},bprate:{node:"bpf_lfo",param:"rate"},bpsync:{node:"bpf_lfo",param:"sync"},bpdepth:{node:"bpf_lfo",param:"depth"},bpdepthfrequency:{node:"bpf_lfo",param:"depth"},bpshape:{node:"bpf_lfo",param:"shape"},bpdc:{node:"bpf_lfo",param:"dcoffset"},bpskew:{node:"bpf_lfo",param:"skew"},vowel:{node:"vowel",param:"frequency"},coarse:{node:"coarse",param:"coarse"},crush:{node:"crush",param:"crush"},shape:{node:"shape",param:"shape"},shapevol:{node:"shape",param:"postgain"},distort:{node:"distort",param:"distort"},distortvol:{node:"distort",param:"postgain"},distorttype:{node:"distort",param:"distort"},compressor:{node:"compressor",param:"threshold"},compressorRatio:{node:"compressor",param:"ratio"},compressorKnee:{node:"compressor",param:"knee"},compressorAttack:{node:"compressor",param:"attack"},compressorRelease:{node:"compressor",param:"release"},phaserrate:{node:"phaser_lfo",param:"frequency"},phasersweep:{node:"phaser_lfo",param:"depth"},phasercenter:{node:"phaser",param:"frequency"},phaserdepth:{node:"phaser",param:"Q"},delay:{node:"delay_mix",param:"gain"},delaytime:{node:"delay",param:"delayTime"},delayfeedback:{node:"delay",param:"feedback"},delaysync:{node:"delay",param:"delayTime"},dry:{node:"dry",param:"gain"},room:{node:"room_mix",param:"gain"},djf:{node:"djf",param:"value"},busgain:{node:"bus",param:"gain"},s:{node:"source",param:"frequency"},detune:{node:"source",param:"freqspread"},wt:{node:"source",param:"position"},warp:{node:"source",param:"warp"},freq:{node:"source",param:"frequency"},note:{node:"source",param:"frequency"},wtdc:{node:"wt_lfo",param:"dc"},wtskew:{node:"wt_lfo",param:"skew"},wtrate:{node:"wt_lfo",param:"frequency"},wtsync:{node:"wt_lfo",param:"frequency"},wtdepth:{node:"wt_lfo",param:"depth"},warpdc:{node:"warp_lfo",param:"dc"},warpskew:{node:"warp_lfo",param:"skew"},warprate:{node:"warp_lfo",param:"frequency"},warpsync:{node:"warp_lfo",param:"frequency"},warpdepth:{node:"warp_lfo",param:"depth"},fmi:{node:"fm_1_gain",param:"gain"},fmi2:{node:"fm_2_gain",param:"gain"},fmi3:{node:"fm_3_gain",param:"gain"},fmi4:{node:"fm_4_gain",param:"gain"},fmi5:{node:"fm_5_gain",param:"gain"},fmi6:{node:"fm_6_gain",param:"gain"},fmi7:{node:"fm_7_gain",param:"gain"},fmi8:{node:"fm_8_gain",param:"gain"},fmh:{node:"fm_1",param:"frequency"},fmh2:{node:"fm_2",param:"frequency"},fmh3:{node:"fm_3",param:"frequency"},fmh4:{node:"fm_4",param:"frequency"},fmh5:{node:"fm_5",param:"frequency"},fmh6:{node:"fm_6",param:"frequency"},fmh7:{node:"fm_7",param:"frequency"},fmh8:{node:"fm_8",param:"frequency"},pw:{node:"source",param:"pulsewidth"},pwrate:{node:"pw_lfo",param:"frequency"},pwsweep:{node:"pw_lfo",param:"depth"},vib:{node:"vib",param:"frequency"},vibmod:{node:"vib_gain",param:"gain"},byteBeatStartTime:{node:"source",param:"byteBeatStartTime"},spread:{node:"source",param:"panspread"},transient:{node:"transient",param:"attack"}};function Lit(){return Fit}const Iit=(n,e)=>{if(n?.parameters){const i=n.parameters.get(e);if(i instanceof AudioParam)return i}let t=n?.[e];if(t===void 0&&e==="frequency"&&(t=n?.detune??n?.playbackRate),t instanceof AudioParam)return t},qK=Lit(),Git=(n,e)=>{const t=n.split("_")[0];return qK[`${t}_${e}`]??qK[t]},z6=(n,e)=>n==="frequency"&&e>=30?{min:20-e,max:24e3-e}:{min:void 0,max:void 0},Oit=(n,e,t)=>{const i=Qi(),r=new Float32Array(256);for(let o=0;o<r.length;o++){const l=o/(r.length-1)*2-1;r[o]=Pm(l*t,e,t)}const s=new WaveShaperNode(i,{curve:r}),a=Ys(1/t);return n.connect(a).connect(s),{modulator:n,toCleanup:[s,a]}},V6=(n,e,t)=>{const i=Git(n,t);if(!i)return ME(new Error(`Could not find control data for target '${n}'. It may not be modulatable.`),"superdough"),{targetParams:[],paramName:n};const r=i.param,s=e[i.node]?i.node:n,a=e[s];if(!a){const l=Object.keys(e);return ME(new Error(`Could not connect to target '${s}'  it does not exist. Available targets: ${l.join(", ")}`),"superdough"),{targetParams:[],paramName:r}}const o=[];return a.forEach(l=>{const u=Iit(l,r);o.push(u)}),{targetParams:o,paramName:r}},$1e=(n,e,t)=>{const{rate:i=1,sync:r,cps:s,cycle:a,control:o="lfo",subControl:l,fxi:u="main",depth:c=1,depthabs:d,...f}=e,{targetParams:m,paramName:y}=V6(o,t[u],l);if(!m.length)return;let _=m[0].value;_=_===0?1:_;const{min:S,max:b}=z6(y,_),M=d??c*_,w={...f,frequency:r!==void 0?r*s:i,time:a/s,depth:M,min:S,max:b},T=xA(Qi(),w);return t.main[`lfo_${n}`]=[T],m.forEach(E=>T.connect(E)),T},J1e=(n,e,t)=>{const{control:i,subControl:r,acurve:s,dcurve:a,rcurve:o,depth:l=1,depthabs:u,fxi:c="main",...d}=e,{targetParams:f,paramName:m}=V6(i,t[c],r);if(!f.length)return;let y=f[0].value;y=y===0?1:y;const{min:_,max:S}=z6(m,y),b=u??l*y,M=z1e(Qi(),{...d,depth:b,min:_,max:S,attackCurve:s,decayCurve:a,releaseCurve:o});return t.main[`env_${n}`]=[M],f.forEach(w=>M.connect(w)),M},q1e=(n,e,t)=>{const i=Qi(),{control:r,subControl:s,depth:a=1,depthabs:o,fxi:l="main"}=n,{targetParams:u,paramName:c}=V6(r,e[l],s);if(!u.length)return{toCleanup:[]};const d=t.getBus(n.bus),f=new ConstantSourceNode(i,{offset:n.dc??0});f.start(n.begin);const m=f.connect(Ys(1));d.connect(m);let y=u[0].value;y=y===0?1:y;const{min:_,max:S}=z6(c,y),b=o??a*y,M=Ys(Math.sign(b)*Math.abs(b)/.3),w=m.connect(M),T=[];let E=w;if(_!==void 0&&S!==void 0){const R=Oit(w,_,S);E=R.modulator,T.push(...R.toCleanup)}return tm(i,()=>{u.forEach(R=>E.connect(R))},0,n.begin),T.push(f,m,M),{modulator:E,toCleanup:T}},H6={},TU={},Uit=n=>H6[n];function kit(n,e){var t=1024;if(n<t)return n+" B";var i=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1;do n/=t,++r;while(n>=t);return n.toFixed(1)+" "+i[r]}function Q1e(n,e){const{speed:t=1}=n,{transpose:i,url:r,index:s,midi:a,label:o}=U1e(n,e);let l=Math.abs(t)*Math.pow(2,i/12);return{transpose:i,url:r,index:s,midi:a,label:o,playbackRate:l}}const exe=async(n,e,t)=>{let{url:i,label:r,playbackRate:s}=Q1e(n,e);t&&(i=await t(i));const a=Qi(),o=await c2(i,a,r);return n.unit==="c"&&(s=s*o.duration),{buffer:o,playbackRate:s}},txe=async(n,e,t)=>{let{buffer:i,playbackRate:r}=await exe(n,e,t);n.speed<0&&(i=nxe(i));const s=Qi().createBufferSource();s.buffer=i,s.playbackRate.value=r;const{loopBegin:a=0,loopEnd:o=1,begin:l=0,end:u=1}=n,c=s.buffer.duration,d=l*c;n.loop&&(s.loop=!0,s.loopStart=a*c,s.loopEnd=o*c);const f=c/s.playbackRate.value,m=(u-l)*f;return{bufferSource:s,offset:d,bufferDuration:c,playbackDuration:f,sliceDuration:m}},c2=(n,e,t,i=0)=>{const r=t?`sound "${t}:${i}"`:"sample";if(n=n.replace("#","%23"),!TU[n]){To(`[sampler] load ${r}..`,"load-sample",{url:n});const s=Date.now();TU[n]=fetch(n).then(a=>a.arrayBuffer()).then(async a=>{const o=Date.now()-s,l=kit(a.byteLength);To(`[sampler] load ${r}... done! loaded ${l} in ${o}ms`,"loaded-sample",{url:n});const u=await e.decodeAudioData(a);return H6[n]=u,u})}return TU[n]};function nxe(n){const e=Qi(),t=e.createBuffer(n.numberOfChannels,n.length,e.sampleRate);for(let i=0;i<n.numberOfChannels;i++)t.copyToChannel(n.getChannelData(i).slice().reverse(),i,i);return t}const zit=n=>H6[n];function ixe(n){if(n.startsWith("bubo:")){const[e,t]=n.split(":");n=`github:Bubobubobubobubo/dough-${t}`}return n}function rxe(n,e=""){if(!n.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let t=n.slice(7);t=t.endsWith("/")?t.slice(0,-1):t;let i=t.split("/"),r=i[0],s=i.length>=2?i[1]:"samples",a=i.length>=3?i[2]:"main",o=i.slice(3);return o.push(e||""),o=o.join("/"),`https://raw.githubusercontent.com/${r}/${s}/${a}/${o}`}const sxe=(n,e,t=n._base||"")=>Object.entries(n).forEach(([i,r])=>{if(typeof r=="string"&&(r=[r]),typeof r!="object")throw new Error("wrong sample map format for "+i);t=r._base||t,t=ixe(t),t.startsWith("github:")&&(t=rxe(t,""));const s=a=>t+a;Array.isArray(r)?r=r.map(s):r=Object.fromEntries(Object.entries(r).map(([a,o])=>[a,(typeof o=="string"?[o]:o).map(s)])),e(i,r)});let axe={};function Vit(n,e){axe[n]=e}function Hit(n){const e=Object.entries(axe).find(([t])=>n.startsWith(t));if(e)return e[1]}async function Xit(n){const e=Hit(n);if(e)return e(n);if(n=ixe(n),n.startsWith("github:")&&(n=rxe(n,"strudel.json")),n.startsWith("local:")&&(n="http://localhost:5432"),n.startsWith("shabda:")){let[r,s]=n.split("shabda:");n=`https://shabda.ndre.gr/${s}.json?strudel=1`}if(n.startsWith("shabda/speech")){let[r,s]=n.split("shabda/speech");s=s.startsWith("/")?s.substring(1):s;let[a,o]=s.split(":"),l="f",u="en-GB";a&&([u,l]=a.split("/")),n=`https://shabda.ndre.gr/speech/${o}.json?gender=${l}&language=${u}&strudel=1'`}if(typeof fetch!="function")return;const t=k1e(n);if(typeof fetch>"u")return;const i=await fetch(n).then(r=>r.json()).catch(r=>{throw console.error(r),new Error(`error loading "${n}"`)});return[i,i._base||t]}const X6=async(n,e=n._base||"",t={})=>{if(typeof n=="string"){const[s,a]=await Xit(n);return X6(s,e||a,t)}const{prebake:i,tag:r}=t;sxe(n,(s,a)=>{lxe(s,a,{baseUrl:e,prebake:i,tag:r})},e)},QK=[];async function oxe(n,e,t,i,r){let{s,nudge:a=0,cut:o,loop:l,clip:u=void 0,n:c=0,speed:d=1,duration:f}=e;if(d===0)return;const m=Qi();let[y,_,S,b]=yh([e.attack,e.decay,e.sustain,e.release]);const{bufferSource:M,sliceDuration:w,offset:T}=await txe(e,i,r);if(!M){To(`[sampler] could not load "${s}:${c}"`,"error");return}if(m.currentTime>n){To(`[sampler] loading sound "${s}:${c}" took too long`,"highlight"),Zr(M);return}const E=NM(M.detune,e,n),R=n+a;M.start(R,T);const P=m.createGain(),I=M.connect(P);u==null&&l==null&&e.release==null&&(f=w);let B=n+f;gh(I.gain,y,_,S,b,0,1,n,B,"linear"),DM(M.detune,e,n,B);const N=m.createGain();I.connect(N),Dm(M,function(){Zr(M),E?.stop(),Zr(I),Zr(N),t()});let U=B+b+.01;M.stop(U);const V=K=>{M.stop(K)},W={node:N,nodes:{source:[M],...E?.nodes},stop:V};if(o!==void 0){const K=QK[o];K&&(K.node.gain.setValueAtTime(1,R),K.node.gain.linearRampToValueAtTime(0,R+.01)),QK[o]=W}return W}function Wit(n,e,t){Nf(n,(i,r,s)=>oxe(i,r,s,e),{type:"sample",samples:e,...t})}function lxe(n,e,t){n.startsWith("wt_")?W6(n,e,t):Wit(n,e,t)}const MS=(n,e)=>n!==void 0&&n!==e,dz=n=>new GainNode(n,{gain:1,channelCount:2,channelCountMode:"explicit"});class Zit{reverbNode;delayNode;output;summingNode;djfNode;audioContext;constructor(e){this.audioContext=e,this.output=dz(e),this.summingNode=dz(e),this.summingNode.connect(this.output)}disconnect(){this.output.disconnect(),this.summingNode.disconnect(),this.delayNode?.disconnect(),this.reverbNode?.disconnect()}getDjf(e,t=0){return this.djfNode==null&&(this.djfNode=Yu(this.audioContext,"djf-processor",{value:e}),this.summingNode.disconnect(),this.summingNode.connect(this.djfNode),this.djfNode.connect(this.output)),this.djfNode.parameters.get("value").setValueAtTime(e,t),this.djfNode}getDelay(e=0,t=.5,i){return t=Pm(t,0,.98),this.delayNode==null&&(this.delayNode=this.audioContext.createFeedbackDelay(1,e,t),this.delayNode.connect(this.summingNode),this.delayNode.start?.(i)),this.delayNode.delayTime.value!==e&&this.delayNode.delayTime.setValueAtTime(e,i),this.delayNode.feedback.value!==t&&this.delayNode.feedback.setValueAtTime(t,i),this.delayNode}getReverb(e,t,i,r,s,a,o){return this.reverbNode==null&&(this.reverbNode=this.audioContext.createReverb(e,t,i,r,s,a,o),this.reverbNode.connect(this.summingNode)),(MS(e,this.reverbNode.duration)||MS(t,this.reverbNode.fade)||MS(i,this.reverbNode.lp)||MS(r,this.reverbNode.dim)||MS(a,this.reverbNode.irspeed)||MS(o,this.reverbNode.irbegin)||this.reverbNode.ir!==s)&&this.reverbNode.generate(e,t,i,r,s,a,o),this.reverbNode}sendReverb(e,t){return AE(e,this.reverbNode,t)}sendDelay(e,t){return AE(e,this.delayNode,t)}duck(e,t=0,i=.1,r=1){const s=t,a=Math.max(i,.002),o=this.output.gain;tm(this.audioContext,()=>{const l=this.audioContext.currentTime,u=o.value;o.cancelScheduledValues(l),o.setValueAtTime(u,l);const c=Math.max(e,l),d=Pm(1-Math.sqrt(r),.01,u);o.exponentialRampToValueAtTime(d,c+s),o.exponentialRampToValueAtTime(1,c+s+a)},0,e-.01)}connectToOutput(e){e.connect(this.summingNode)}}class jit{channelMerger;destinationGain;constructor(e){this.audioContext=e,this.initializeAudio()}initializeAudio(){const e=this.audioContext,t=e.destination.maxChannelCount;this.audioContext.destination.channelCount=t,this.channelMerger=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),this.destinationGain=new GainNode(e),this.channelMerger.connect(this.destinationGain),this.destinationGain.connect(e.destination)}reset(){this.disconnect(),this.initializeAudio()}disconnect(){this.channelMerger.disconnect(),this.destinationGain.disconnect(),this.destinationGain=null,this.channelMerger=null}connectToDestination=(e,t=[0,1])=>{const i=new StereoPannerNode(this.audioContext);e.connect(i);const r=new ChannelSplitterNode(this.audioContext,{numberOfOutputs:i.channelCount});i.connect(r),t.forEach((s,a)=>{r.connect(this.channelMerger,a%i.channelCount,s%this.audioContext.destination.channelCount)})}}class uxe{audioContext;output;nodes={};buses={};constructor(e){this.audioContext=e,this.output=new jit(e)}reset(){Object.values(this.nodes).forEach(e=>{e.disconnect()}),Object.values(this.buses).forEach(e=>{e.disconnect()}),this.nodes={},this.buses={},this.output.reset()}duck(e,t,i=0,r=.1,s=1){const a=[e].flat(),o=[i].flat(),l=[r].flat(),u=[s].flat();a.forEach((c,d)=>{const f=this.nodes[c];if(f==null){ME(new Error(`duck target orbit ${c} does not exist`),"superdough");return}const m=o[d]??o[0],y=Math.max(l[d]??l[0],.002),_=u[d]??u[0];f.duck(t,m,y,_)})}getOrbit(e,t){return this.nodes[e]==null&&(this.nodes[e]=new Zit(this.audioContext),this.output.connectToDestination(this.nodes[e].output,t)),this.nodes[e]}getBus(e){return this.buses[e]==null&&(this.buses[e]=dz(this.audioContext)),this.buses[e]}}const fz=Object.freeze({NONE:0,ASYM:1,MIRROR:2,BENDP:3,BENDM:4,BENDMP:5,SYNC:6,QUANT:7,FOLD:8,PWM:9,ORBIT:10,SPIN:11,CHAOS:12,PRIMES:13,BINARY:14,BROWNIAN:15,RECIPROCAL:16,WORMHOLE:17,LOGISTIC:18,SIGMOID:19,FRACTAL:20,FLIP:21}),pz=new Set;function cxe(){pz.clear()}async function Yit(n,e,t=2048){const i=`${n},${t}`;if(!pz.has(i)){const r=(await qit(n,e)).getChannelData(0),s=r.length,a=Math.max(1,Math.floor(s/t)),o=new Array(a);for(let l=0;l<a;l++){const u=l*t;o[l]=r.subarray(u,u+t)}return pz.add(i),{frames:o,frameLen:t,numFrames:a,key:i}}return{frameLen:t,key:i}}function Kit(n,e){var t=1024;if(n<t)return n+" B";var i=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1;do n/=t,++r;while(n>=t);return n.toFixed(1)+" "+i[r]}function $it(n){const e=new DataView(n);let t=12;for(;t+8<=e.byteLength;){const i=String.fromCharCode(e.getUint8(t),e.getUint8(t+1),e.getUint8(t+2),e.getUint8(t+3)),r=e.getUint32(t+4,!0);if(i==="fmt ")return e.getUint32(t+12,!0);t+=8+r+(r&1)}return null}async function Jit(n){const e=$it(n)||44100;return await new OfflineAudioContext(1,1,e).decodeAudioData(n)}const CU={},qit=(n,e)=>{if(n=n.replace("#","%23"),!CU[n]){To(`[wavetable] load table ${e}..`,"load-table",{url:n});const t=Date.now();CU[n]=fetch(n).then(i=>i.arrayBuffer()).then(async i=>{const r=Date.now()-t,s=Kit(i.byteLength);return To(`[wavetable] load table ${e}... done! loaded ${s} in ${r}ms`,"loaded-table",{url:n}),await Jit(i)})}return CU[n]};function hxe(n,e=""){if(!n.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[t,i]=n.split("github:");return i=i.endsWith("/")?i.slice(0,-1):i,i.split("/").length===2&&(i+="/main"),`https://raw.githubusercontent.com/${i}/${e}`}const e$=(n,e,t,i={})=>(e=n._base||e,Object.entries(n).forEach(([r,s])=>{if(r==="_base")return!1;if(typeof s=="string"&&(s=[s]),typeof s!="object")throw new Error("wrong json format for "+r);let a=e;a.startsWith("github:")&&(a=hxe(a,"")),s=s.map(o=>a+o).filter(o=>o.toLowerCase().endsWith(".wav")?!0:(To(`[wavetable] skipping ${o} -- wavetables must be ".wav" format`),!1)),s.length&&W6(r,s,{baseUrl:e,frameLen:t})}));function W6(n,e,t){Nf(n,(i,r,s,a)=>dxe(i,r,s,e,a,t?.frameLen??2048),{type:"wavetable",tables:e,...t})}const Qit=async(n,e,t,i={})=>{if(t!==void 0)return e$(t,n,e);n.startsWith("github:")&&(n=hxe(n,"strudel.json")),n.startsWith("local:")&&(n="http://localhost:5432");const r=k1e(n);if(typeof fetch=="function"&&!(typeof fetch>"u"))return fetch(n).then(s=>s.json()).then(s=>e$(s,r,e,i)).catch(s=>{throw console.error(s),new Error(`error loading "${n}"`)})};async function dxe(n,e,t,i,r,s){const{s:a,n:o=0,duration:l,clip:u}=e,c=Qi(),[d,f,m,y]=yh([e.attack,e.decay,e.sustain,e.release]);let{warpmode:_}=e;typeof _=="string"&&(_=fz[_.toUpperCase()]??fz.NONE);const S=Jy(e),{url:b,label:M}=U1e(e,i),w=await Yit(b,M,s);let T=n+l;u!==void 0&&(T=Math.min(n+u*l,T));const E=T+y,R=E+.01,P={begin:n,end:R,frequency:S,freqspread:e.detune,position:e.wt,warp:e.warp,warpMode:_,voices:Math.max(e.unison??1,1),panspread:e.spread,phaserand:e.wtphaserand??e.unison>1?1:0},I=e3("wavetable",()=>new AudioWorkletNode(c,"wavetable-oscillator-processor",{outputChannelCount:[2]}));if(Object.entries(P).forEach(([Oe,nt])=>{const Ae=I.parameters.get(Oe),Ye=nt!==void 0?nt:Ae.defaultValue;Ae.value=Ye}),I.port.postMessage({type:"initialize",payload:w}),c.currentTime>n){To(`[wavetable] still loading sound "${a}:${o}"`,"highlight");return}const B=[e.wtattack,e.wtdecay,e.wtsustain,e.wtrelease],N=[e.warpattack,e.warpdecay,e.warpsustain,e.warprelease],U=I.parameters,V=U.get("position"),W=U.get("warp");let K=e.wtrate;e.wtsync!=null&&(K=r*e.wtsync);const q=hz(c,V,n,E,{offset:e.wt,amount:e.wtenv,defaultAmount:.5,values:B,holdEnd:T,defaultValues:[0,.5,0,.1]},{frequency:K,depth:e.wtdepth,defaultDepth:.5,shape:e.wtshape,skew:e.wtskew,dcoffset:e.wtdc??0});let j=e.warprate;e.warpsync!=null&&(j=j=r*e.warpsync);const te=hz(c,W,n,E,{offset:e.warp,amount:e.warpenv,defaultAmount:.5,values:N,holdEnd:T,defaultValues:[0,.5,0,.1]},{frequency:j,depth:e.warpdepth,defaultDepth:.5,shape:e.warpshape,skew:e.warpskew,dcoffset:e.warpdc??0}),he=NM(I.parameters.get("detune"),e,n),_e=TE(I.parameters.get("frequency"),e,n),Be=c.createGain(),ue=I.connect(Be);gh(ue.gain,d,f,m,y,0,.3,n,T,"linear"),DM(I.parameters.get("detune"),e,n,T);const ce={node:ue,nodes:{source:[I],wt_lfo:[q],warp_lfo:[te],..._e?.nodes,...he?.nodes}},Ce=tm(c,()=>{I6(I),he?.stop(),_e?.stop(),Zr(q),Zr(te),t()},n,R);return ce.stop=Oe=>{Ce.stop(Oe)},ce}const Z6=128,mz="System Standard";let j6=Z6;function fxe(n){j6=parseInt(n)??Z6}let Y6=!1;function pxe(n){Y6=n==!0}const Hf=Bit();function Nf(n,e,t={}){n=n.toLowerCase().replace(/\s+/g,"_"),Hf.setKey(n,{onTrigger:e,data:t})}let mxe=n=>n;function Jp(n){return mxe(n)}function ert(n){mxe=n}function gz(n){for(const t in n)n[t.toLowerCase()]=n[t];const e=Hf.get();for(const t in e){const[i,r]=t.split("_");if(!r)continue;const s=n[i];if(s){if(typeof s=="string")e[`${s}_${r}`.toLowerCase()]=e[t];else if(Array.isArray(s))for(const a of s)e[`${a}_${r}`.toLowerCase()]=e[t]}}Hf.set({...e})}async function trt(n){const e=await(await fetch(n)).json();gz(e)}async function nrt(...n){switch(n.length){case 1:return typeof n[0]=="string"?trt(n[0]):gz(n[0]);case 2:return gz({[n[0]]:n[1]});default:throw new Error("aliasMap expects 1 or 2 arguments, received "+n.length)}}function irt(n,e){if(Dx(n)==null){To("soundAlias: original sound not found");return}Hf.setKey(e,Dx(n))}function Dx(n){return typeof n!="string"?(console.warn(`getSound: expected string got "${n}". fall back to triangle`),Hf.get().triangle):Hf.get()[n.toLowerCase()]}const gxe=async()=>{await navigator.mediaDevices.getUserMedia({audio:!0});let n=await navigator.mediaDevices.enumerateDevices();n=n.filter(t=>t.kind==="audiooutput"&&t.deviceId!=="default");const e=new Map;return e.set(mz,""),n.forEach(t=>{e.set(t.label,t.deviceId)}),e};let t3={s:"triangle",gain:.8,postgain:1,density:".03",channels:[1,2],phaserdepth:.75,shapevol:1,distortvol:1,distorttype:0,delay:0,busgain:1,byteBeatExpression:"0",delayfeedback:.5,delaysync:3/16,orbit:1,i:1,velocity:1,fft:8,tremolodepth:1,tremolophase:0,release:.01};const rrt=Object.freeze({...t3});function srt(n,e){t3[n]=e}function art(){t3={...rrt}}let K6=new Map(Object.entries(t3));function $6(n,e){K6.set(n,e)}function Ya(n){return K6.get(n)}function ort(n){Object.keys(n).forEach(e=>{$6(e,n[e])})}function yxe(){K6=new Map(Object.entries(t3))}function lrt(n){yxe(),n==="1.0"&&$6("fanchor",.5)}const urt=()=>Hf.set({});let vxe=[];function xxe(n){vxe.push(n)}let lN;function bxe(){if(!lN){const n=Qi(),e=vxe.concat([Dit]);lN=Promise.all(e.map(t=>n.audioWorklet.addModule(t))).then(()=>lN=void 0)}return lN}async function J6(n={}){const{disableWorklets:e=!1,maxPolyphony:t,audioDeviceName:i=mz,multiChannelOrbits:r=!1}=n;if(fxe(t),pxe(r),cxe(),typeof window>"u")return;const s=Qi();if(i!=null&&i!=mz)try{const a=(await gxe()).get(i),o=(a??"").length>0;s.sinkId!==a&&o&&await s.setSinkId(a),To(`[superdough] Audio Device set to ${i}, it might take a few seconds before audio plays on all output channels`)}catch{To("[superdough] failed to set audio interface","warning")}if(!s instanceof OfflineAudioContext&&await s.resume(),e){To("[superdough]: AudioWorklets disabled with disableWorklets");return}try{await bxe(),To("[superdough] AudioWorklets loaded")}catch(a){console.warn("could not load AudioWorklet effects",a)}To("[superdough] ready")}let wU;async function _xe(n){return wU||(wU=new Promise(e=>{document.addEventListener("mousedown",async function t(){document.removeEventListener("mousedown",t),await J6(n),e()})})),wU}let kx;function GL(){return kx==null&&(kx=new uxe(Qi())),kx}function yz(n){return kx=n,kx}function Sxe(n,e){GL().output.connectToDestination(n,e)}function crt(n,e,t=1,i=.5,r=1e3,s=2e3){const a=Qi(),o=xA(a,{frequency:t,depth:s*2,begin:n,end:e}),l=1;let u=282;const c=[];for(let d=0;d<l;d++){const f=e3("filter",()=>a.createBiquadFilter());f.type="notch",f.gain.value=1,f.frequency.value=r+u,f.Q.value=2-Math.min(Math.max(i*2,0),1.9),o.connect(f.detune),u+=282,c.push(f)}return{filterChain:c,lfo:o}}function hrt(n){n=n??0;const e=["12db","ladder","24db"];return typeof n=="number"?e[Math.floor(O1e(n,e.length))]:n}let mu={},zx={};function Mxe(n,e=1024,t=.5){if(!mu[n]||mu[n].context!=Qi()){const i=Qi().createAnalyser();i.fftSize=e,i.smoothingTimeConstant=t,mu[n]=i,zx[n]=new Float32Array(mu[n].frequencyBinCount)}return mu[n].fftSize!==e&&(mu[n].fftSize=e,zx[n]=new Float32Array(mu[n].frequencyBinCount)),mu[n]}function OL(n="time",e=1){const t={time:()=>mu[e]?.getFloatTimeDomainData(zx[e]),frequency:()=>mu[e]?.getFloatFrequencyData(zx[e])}[n];if(!t)throw new Error(`getAnalyzerData: ${n} not supported. use one of ${Object.keys(t).join(", ")}`);return t(),zx[e]}function Axe(){kx?.reset(),mu={},zx={}}let LC=new Map;function t$(n){return(Array.isArray(n)?n:[n]).map(e=>e-1)}class drt{constructor(){this.audioNodes=[],this.tails=[]}connect(...e){return e.forEach(t=>{this.tails.forEach(i=>{i.connect(t)})}),this.tails=e,this.audioNodes.push(...e),this}connectOne(e,t){return this.tails[e].connect(t),this.tails[e]=t,this.audioNodes.push(t),this}releaseNodes(){this.audioNodes.forEach(e=>ait(e)?I6(e):Zr(e)),this.audioNodes=[],this.tails=[]}}const UL=async(n,e,t,i=.5,r=.5)=>{const s={main:{}},a=Qi(),o=GL();let{stretch:l}=n;if(l!=null&&(e=e-.04),typeof n!="object")throw new Error(`expected hap.value to be an object, but got "${n}". Hint: append .note() or .s() to the end`,"error");if(n.duration=t,e<a.currentTime){console.warn(`[superdough]: cannot schedule sounds in the past (target: ${e.toFixed(2)}, now: ${a.currentTime.toFixed(2)})`);return}let{s:u=Ya("s"),bank:c,source:d,postgain:f=Ya("postgain"),duckorbit:m,duckonset:y,duckattack:_,duckdepth:S,djf:b,release:M=Ya("release"),dry:w,delay:T=Ya("delay"),delayfeedback:E=Ya("delayfeedback"),delaysync:R=Ya("delaysync"),delaytime:P,orbit:I=Ya("orbit"),bus:B,busgain:N=Ya("busgain"),room:U,roomfade:V,roomlp:W,roomdim:K,roomsize:q,ir:j,irspeed:te,irbegin:he,i:_e=Ya("i"),analyze:Be,fft:ue=Ya("fft"),FX:ce=[],FXrelease:Ce}=n;P=P??YK(R,i);const Oe=t$(Y6&&I>0?[I*2-1,I*2]:Ya("channels")),nt=n.channels!=null?t$(n.channels):Oe,Ae=o.getOrbit(I,nt);m!=null&&o.duck(m,e,y,_,S),f=Jp(f),T=Jp(T),N=Jp(N);const Ye=e+t,ft=Math.max(M,Ce??0),ze=Ye+ft,ot=Math.round(Math.random()*1e6);for(let ke=0;ke<=LC.size-j6;ke++){const je=LC.entries().next(),gt=je.value[1].deref(),yt=je.value[0],ve=e+.25;gt?.node?.gain?.linearRampToValueAtTime(0,ve),gt?.stop?.(ve),LC.delete(yt)}if(["-","~","_"].includes(u))return;c&&u&&(u=`${c}_${u}`,n.s=u);const ut=new drt;let Wt;if(d)Wt=d(e,n,t,i),s.main.source=[Wt];else if(Dx(u)){const{onTrigger:ke}=Dx(u),je=await ke(e,n,()=>tm(a,()=>{ut.releaseNodes(),LC.delete(ot)},0,ze),i);je&&(Wt=je.node,LC.set(ot,new WeakRef(je)),s.main={...s.main,...je.nodes})}else throw new Error(`sound ${u} not found! Is it loaded?`);if(!Wt)return;if(a.currentTime>e){To("[webaudio] skip hap: still loading",a.currentTime-e);return}ut.connect(Wt),ce=[...ce,n];for(let[ke,je]of Object.entries(ce)){const gt=ke==ce.length-1?"main":ke;s[gt]??={};const yt=s[gt];let{gain:ve=Ya("gain"),velocity:An=Ya("velocity"),shapevol:cn=Ya("shapevol"),distorttype:In=Ya("distorttype"),distortvol:Zt=Ya("distortvol"),tremolodepth:le=Ya("tremolodepth"),phaserdepth:ee=Ya("phaserdepth"),delay:Re=Ya("delay"),delayfeedback:tt=Ya("delayfeedback"),delaysync:et=Ya("delaysync"),delaytime:at,i:jt=Ya("i")}=je;if(ve=Jp($g(ve,1)),cn=Jp(cn),Zt=Jp(Zt),An=Jp(An),le=Jp(le),ve*=An,at=at??YK(et,i),je.workletSrc!==void 0){const st=Yu(a,"generic-processor",{},{outputChannelCount:[2]});ut.connect(st);const Ft=je.workletSrc.replace(/\bpat\[(\d+)\]/g,(Ne,it)=>je.workletInputs[it]).replaceAll("sFreq",Jy(n)).replaceAll("sGate",`cc('strudel-gate-${ot}')`),{src:Se,ugens:Je,registers:St}=compileKabel(Ft);st.port.postMessage({src:Se,schema:{ugens:Je,registers:St},start:e,gateEnd:Ye,end:ze})}if(je.stretch!==void 0){const st=Yu(a,"phase-vocoder-processor",{pitchFactor:je.stretch});ut.connect(st),yt.stretch=[st]}if(je.transient!==void 0){const st=Yu(a,"transient-processor",{},{processorOptions:{attack:je.transient,sustain:je.transsustain,begin:e,end:ze}});ut.connect(st),yt.transient=st}const rn=Ys(ve);yt.gain=[rn],ut.connect(rn);const Nn=hrt(n.ftype),Fn=st=>H1e(a,e,Ye,st,i,r);if(je.cutoff!==void 0){const st=AU(je,{frequency:"cutoff",q:"resonance",attack:"lpattack",decay:"lpdecay",sustain:"lpsustain",release:"lprelease",env:"lpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"lprate",sync:"lpsync",depth:"lpdepth",depthfrequency:"lpdepthfrequency",shape:"lpshape",dcoffset:"lpdc",skew:"lpskew"});st.type="lowpass";const{filter:Ft,lfo:Se}=Fn(st);if(yt.lpf=[Ft],yt.lpf_lfo=[Se],ut.connect(Ft),Se&&ut.audioNodes.push(Se),Nn==="24db"){const{filter:Je,lfo:St}=Fn(st);yt.lpf.push(Je),yt.lpf_lfo.push(St),ut.connect(Je),St&&ut.audioNodes.push(St)}}if(je.hcutoff!==void 0){const st=AU(je,{frequency:"hcutoff",q:"hresonance",attack:"hpattack",decay:"hpdecay",sustain:"hpsustain",release:"hprelease",env:"hpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"hprate",sync:"hpsync",depth:"hpdepth",depthfrequency:"hpdepthfrequency",shape:"hpshape",dcoffset:"hpdc",skew:"hpskew"});st.type="highpass";const{filter:Ft,lfo:Se}=Fn(st);if(yt.hpf=[Ft],yt.hpf_lfo=[Se],Se&&ut.audioNodes.push(Se),ut.connect(Ft),Nn==="24db"){const{filter:Je,lfo:St}=Fn(st);yt.hpf.push(Je),yt.hpf_lfo.push(St),ut.connect(Je),St&&ut.audioNodes.push(St)}}if(je.bandf!==void 0){const st=AU(je,{frequency:"bandf",q:"bandq",attack:"bpattack",decay:"bpdecay",sustain:"bpsustain",release:"bprelease",env:"bpenv",anchor:"fanchor",model:"ftype",drive:"drive",rate:"bprate",sync:"bpsync",depth:"bpdepth",depthfrequency:"bpdepthfrequency",shape:"bpshape",dcoffset:"bpdc",skew:"bpskew"});st.type="bandpass";const{filter:Ft,lfo:Se}=Fn(st);if(yt.bpf=[Ft],yt.bpf_lfo=[Se],ut.connect(Ft),Se&&ut.audioNodes.push(Se),Nn==="24db"){const{filter:Je,lfo:St}=Fn(st);yt.bpf.push(Je),yt.bpf_lfo.push(St),ut.connect(Je),St&&ut.audioNodes.push(St)}}if(je.vowel!==void 0){const st=a.createVowelFilter(je.vowel);yt.vowel=st.filters,ut.connect(st)}if(je.coarse!==void 0){const st=Yu(a,"coarse-processor",{coarse:je.coarse});yt.coarse=[st],ut.connect(st)}if(je.crush!==void 0){const st=Yu(a,"crush-processor",{crush:je.crush});yt.crush=[st],ut.connect(st)}if(je.shape!==void 0){const st=Yu(a,"shape-processor",{shape:je.shape,postgain:cn});yt.shape=[st],ut.connect(st)}if(je.distort!==void 0){const st=Y1e(je.distort,Zt,In);yt.distort=[st],ut.connect(st)}let Gt=je.tremolo;if(je.tremolosync!=null&&(Gt=i*je.tremolosync),Gt!==void 0){const st=Math.max(1-le,0),Ft=new GainNode(a,{gain:st}),Se=r/i,Je=xA(a,{skew:je.tremoloskew??(je.tremoloshape!=null?.5:1),frequency:Gt,depth:le,time:Se,dcoffset:0,shape:je.tremoloshape,phaseoffset:je.tremolophase,min:0,max:1,curve:1.5,begin:e,end:ze});yt.tremolo=[Je],yt.tremolo_gain=[Ft],Je.connect(Ft.gain),ut.audioNodes.push(Je),ut.connect(Ft)}if(je.compressor!==void 0){const st=V1e(a,je.compressor,je.compressorRatio,je.compressorKnee,je.compressorAttack,je.compressorRelease);yt.compressor=[st],ut.connect(st)}if(je.pan!==void 0){const st=a.createStereoPanner();yt.pan=[st],st.pan.value=2*je.pan-1,ut.connect(st)}if(je.phaserrate!==void 0&&ee>0){const{filterChain:st,lfo:Ft}=crt(e,ze,je.phaserrate,ee,je.phasercenter,je.phasersweep);yt.phaser=[...st],yt.phaser_lfo=[Ft],st.forEach(Se=>ut.connect(Se)),ut.audioNodes.push(Ft)}if(gt!=="main"&&Re>0&&at>0&&tt>0){const st=Ys(1);tt=Pm(tt,0,.98);const Ft=a.createFeedbackDelay(1,at,tt),Se=Ys(Re),Je=Ys(je.dry??1),St=new GainNode(a,{gain:1,channelCount:2,channelCountMode:"explicit"});ut.connect(st).connect(Je,Ft).connectOne(1,Se).connect(St),ut.audioNodes.push(Ft.feedbackGain,Ft.delayGain),yt.delay=[Ft],yt.delay_mix=[Se]}if(gt!=="main"&&je.room>0){let st;if(je.ir!==void 0){let it,kt=Dx(je.ir);Array.isArray(kt)?it=kt.data.samples[je.i%kt.data.samples.length]:typeof kt=="object"&&(it=Object.values(kt.data.samples).flat()[jt%Object.values(kt.data.samples).length]),st=await c2(it,a,je.ir,0)}const Ft=Ys(1),Se=a.createReverb(je.roomsize,je.roomfade,je.roomlp,je.roomdim,st,je.irspeed,je.irbegin),Je=Ys(je.room),St=Ys(je.dry??1),Ne=new GainNode(a,{gain:1,channelCount:2,channelCountMode:"explicit"});ut.connect(Ft).connect(St,Se).connectOne(1,Je).connect(Ne),yt.room=[Se],yt.room_mix=[Je]}}if(Ce!==void 0&&Ce>M){const ke=Ys(1);ke.gain.setValueAtTime(1,Ye+M),ke.gain.linearRampToValueAtTime(0,ze),ut.connect(ke)}const It=new GainNode(a,{gain:f});if(s.main.post=[It],ut.connect(It),T>0&&P>0&&E>0){const ke=Ae.getDelay(P,E,e);s.main.delay=[ke];const je=Ae.sendDelay(It,T);s.main.delay_mix=[je],ut.audioNodes.push(je)}if(U>0){let ke;if(j!==void 0){let yt,ve=Dx(j);Array.isArray(ve)?yt=ve.data.samples[_e%ve.data.samples.length]:typeof ve=="object"&&(yt=Object.values(ve.data.samples).flat()[_e%Object.values(ve.data.samples).length]),ke=await c2(yt,a,j,0)}const je=Ae.getReverb(q,V,W,K,ke,te,he);s.main.room=[je];const gt=Ae.sendReverb(It,U);s.main.room_mix=[gt],ut.audioNodes.push(gt)}if(B!=null){const ke=o.getBus(B),je=AE(It,ke,N);ut.audioNodes.push(je)}if(b!=null){const ke=Ae.getDjf(b,e);s.main.djf=[ke]}if(Be&&!(a instanceof OfflineAudioContext)){const ke=Mxe(Be,2**(ue+5)),je=AE(It,ke,1);ut.audioNodes.push(je)}if(w!=null){w=Jp(w);const ke=new GainNode(a,{gain:w});ut.connect(ke),Ae.connectToOutput(ke)}else Ae.connectToOutput(It);ce.forEach((ke,je)=>{const gt=je===ce.length-1?"main":je;if(ke.lfo)for(const yt of ke.lfo.__ids){const ve=ke.lfo[yt];ve.fxi??=gt;const An=$1e(yt,{...ve,cps:i,cycle:r,begin:e,end:ze},s);An&&ut.audioNodes.push(An)}if(ke.env)for(const yt of ke.env.__ids){const ve=ke.env[yt];ve.fxi??=gt;const An=J1e(yt,{...ve,begin:e,end:ze},s);An&&ut.audioNodes.push(An)}if(ke.bmod)for(const yt of ke.bmod.__ids){const ve=ke.bmod[yt];ve.fxi??=gt;const{toCleanup:An}=q1e({...ve,begin:e},s,kx);ut.audioNodes.push(...An)}})},frt=(n,e,t,i)=>{UL(e,n-t,e.duration/i,i)},prt=["triangle","square","sawtooth","sine","user","one"],mrt=[["tri","triangle"],["sqr","square"],["saw","sawtooth"],["sin","sine"]];function grt(n,e){const t=n,i=new Float32Array(e);for(let r=0;r<e;r++){const s=r*2/e-1;i[r]=Math.tanh(s*t)}return i}function Txe(){[...prt].forEach(n=>{Nf(n,(e,t,i)=>{const[r,s,a,o]=yh([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]),l=Ys(.3),u=wxe(n,e,t,()=>{Zr(l),i()}),{node:c,nodes:d,stop:f,triggerRelease:m}=u,{duration:y}=t,_=Ys(1),S=c.connect(l).connect(_),b=e+y;gh(S.gain,r,s,a,o,0,1,e,b,"linear");const M=b+o+.01;return m?.(M),f(M),{node:S,nodes:d,stop:w=>{f(w)}}},{type:"synth",prebake:!0})}),Nf("sbd",(n,e,t)=>{const{duration:i,decay:r=.5,pdecay:s=.5,penv:a=36,clip:o}=e,l=Qi(),u=.02,c=1.2,d=.025,f=1,m=l.createOscillator();m.type="triangle",m.frequency.value=Jy(e,29),m.detune.setValueAtTime(a*100,0),m.detune.setValueAtTime(a*100,n),m.detune.exponentialRampToValueAtTime(.001,n+s);const y=Ys(1);y.gain.setValueAtTime(1,n+u),y.gain.exponentialRampToValueAtTime(.001,n+u+r),m.start(n);const _=uz("brown",n,2),S=Ys(1);S.gain.setValueAtTime(c,n),S.gain.exponentialRampToValueAtTime(.001,n+d);const b=new WaveShaperNode(l);b.curve=grt(2,l.sampleRate);const M=Ys(f);Dm(m,()=>{Zr(m),Zr(y),Zr(b),Zr(_.node),Zr(S),Zr(M),t()});const w=m.connect(b).connect(y).connect(M);_.node.connect(S).connect(M);let T=n+r+.01;return o!=null&&(T=Math.min(n+o*i,T)),M.gain.setValueAtTime(f,T-.01),M.gain.linearRampToValueAtTime(0,T),m.stop(T),_.stop(T),{node:w,nodes:{source:[m]},stop:E=>{m.stop(E)}}},{type:"synth",prebake:!0}),Nf("supersaw",(n,e,t)=>{const i=Qi();let{duration:r,n:s,unison:a=5,spread:o=.6,detune:l}=e;l=l??s??.18;const u=Jy(e),[c,d,f,m]=yh([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),y=n+r,_=y+m+.01,S=Pm(a,1,100);let b=S>1?Pm(o,0,1):0;const M={frequency:u,begin:n,end:_,freqspread:l,voices:S,panspread:b},w=e3("supersaw",()=>new AudioWorkletNode(i,"supersaw-oscillator",{outputChannelCount:[2]}));Object.entries(M).forEach(([B,N])=>{const U=w.parameters.get(B),V=N!==void 0?N:U.defaultValue;U.value=V}),w.port.postMessage({type:"initialize"});const T=1/Math.sqrt(S);DM(w.parameters.get("detune"),e,n,y);const E=NM(w.parameters.get("detune"),e,n),R=TE(w.parameters.get("frequency"),e,n);let P=Ys(1);P=w.connect(P),gh(P.gain,c,d,f,m,0,.3*T,n,y,"linear");let I=tm(i,()=>{I6(w),t(),R?.stop(),E?.stop()},n,_);return{node:P,nodes:{source:[w],...R?.nodes,...E?.nodes},stop:B=>{I.stop(B)}}},{prebake:!0,type:"synth"}),Nf("bytebeat",(n,e,t)=>{const i=["(t%255 >= t/255%255)*255","(t*(t*8%60 <= 300)|(-t)*(t*4%512 < 256))+t/400","t","t*(t >> 10^t)","t&128","t&t>>8","((t%255+t%128+t%64+t%32+t%16+t%127.8+t%64.8+t%32.8+t%16.8)/3)","((t%64+t%63.8+t%64.15+t%64.35+t%63.5)/1.25)","(t&(t>>7)-t)","(sin(t*PI/128)*127+127)","((t^t/2+t+64*(sin((t*PI/64)+(t*PI/32768))+64))%128*2)","((t^t/2+t+64*(cos >> 0))%127.85*2)","((t^t/2+t+64)%128*2)","(((t * .25)^(t * .25)/100+(t * .25))%128)*2","((t^t/2+t+64)%7 * 24)"],{n:r=0}=e,s=Jy(e),{byteBeatExpression:a=i[r%i.length],byteBeatStartTime:o}=e,l=Qi();let{duration:u}=e;const[c,d,f,m]=yh([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),y=n+u,_=y+m+.01;let S=Yu(l,"byte-beat-processor",{frequency:s,begin:n,end:_},{outputChannelCount:[2]});S.port.postMessage({codeText:a,byteBeatStartTime:o,frequency:s});let b=Ys(1);b=S.connect(b),gh(b.gain,c,d,f,m,0,1,n,y,"linear");let M=tm(l,()=>{Zr(S),t()},n,_);return{node:b,source:S,stop:w=>{M.stop(w)}}},{prebake:!0,type:"synth"}),Nf("pulse",(n,e,t)=>{const i=Qi();let{pwrate:r,pwsweep:s}=e;s==null&&(r!=null?s=.3:s=0),r==null&&s!=null&&(r=1);let{duration:a,pw:o=.5}=e;const l=Jy(e),[u,c,d,f]=yh([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),m=n+a,y=m+f+.01;let _=Yu(i,"pulse-oscillator",{frequency:l,begin:n,end:y,pulsewidth:o},{outputChannelCount:[2]});DM(_.parameters.get("detune"),e,n,m);const S=NM(_.parameters.get("detune"),e,n),b=TE(_.parameters.get("frequency"),e,n);let M=Ys(1);M=_.connect(M),gh(M.gain,u,c,d,f,0,1,n,m,"linear");let w;s!=0&&(w=xA(i,{frequency:r,depth:s,begin:n,end:y}),w.connect(_.parameters.get("pulsewidth")));let T=tm(i,()=>{Zr(_),Zr(w),t(),b?.stop(),S?.stop()},n,y);return{node:M,nodes:{source:[_],pw_lfo:[w],...b?.nodes,...S?.nodes},stop:E=>{T.stop(E)}}},{prebake:!0,type:"synth"}),Nf("bus",(n,e,t)=>{const i=Qi(),[r,s,a,o]=yh([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,1,.01]),l=n+e.duration,u=l+o+.01,c=GL().getBus(e.n??0),d=c.connect(Ys(0));gh(d.gain,r,s,a,o,0,1,n,l,"linear");const f=tm(i,()=>{c.disconnect(d),t()},n,u);return{node:d,nodes:{source:[c]},stop:m=>{f.stop(m)}}},{prebake:!0,type:"input"}),[...G6].forEach(n=>{Nf(n,(e,t,i)=>{const[r,s,a,o]=yh([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]);let l,{density:u}=t;l=uz(n,e,u);let{node:c,stop:d,triggerRelease:f}=l;const m=Ys(.3),{duration:y}=t;Dm(c,()=>{Zr(c),Zr(m),i()});const _=Ys(1);let S=c.connect(m).connect(_);const b=e+y;gh(S.gain,r,s,a,o,0,1,e,b,"linear");const M=b+o+.01;return f?.(M),d(M),{node:S,nodes:{source:[c]},stop:w=>{d(w)}}},{type:"synth",prebake:!0})}),mrt.forEach(([n,e])=>Hf.set({...Hf.get(),[n]:Hf.get()[e]}))}const n$=2*Math.PI;function Cxe(n,e,t){n=typeof n=="object"?n:new Float32Array(n).fill(1);const i=n.length,r=new Float32Array(i+1),s=new Float32Array(i+1),a=Qi(),o=a.createOscillator(),l={sawtooth:c=>[0,-1/c],square:c=>[0,c%2===0?0:1/c],triangle:c=>[c%2===0?0:1/(c*c),0],user:c=>[0,1]};if(!l[t])throw new Error(`unknown wave type ${t}`);for(let c=0;c<i;c++){const d=n[c],[f,m]=l[t](c+1),y=e?.[c]??0;let _=f*d,S=m*d;if(y!==0){const b=Math.cos(n$*y),M=Math.sin(n$*y);_=b*_-M*S,S=M*_+b*S}r[c+1]=_,s[c+1]=S}const u=a.createPeriodicWave(r,s);return o.setPeriodicWave(u),o}function wxe(n,e,t,i){const{duration:r,noise:s=0}=t,a=t.partials??t.n;let o;if(n==="user"&&!a&&(To("[superdough] Synth 'user' was selected, but partials not specified. Defaulting to triangle. Use pat.partials to setup custom waveform"),n="triangle"),n=n==="user"&&!a?"triangle":n,n==="one")return o=new ConstantSourceNode(Qi(),{offset:1}),o.start(e),{node:o,nodes:{source:o},stop:d=>o?.stop(d)};!a||a?.length===0||n==="sine"?(o=Qi().createOscillator(),o.type=n||"triangle"):o=Cxe(a,t.phases,n),o.frequency.value=Jy(t);const l=NM(o.detune,t,e);DM(o.detune,t,e,e+r);const u=TE(o.frequency,t,e);let c;return s&&(c=sit(o,s,e)),Dm(o,()=>{c?.teardown(),Zr(o),Zr(c?.node),i()}),o.start(e),{node:c?.node||o,nodes:{source:[o],...l?.nodes,...u?.nodes},stop:d=>{u.stop(d),l?.stop(d),c?.stop(d),o.stop(d)},triggerRelease:d=>{}}}function yrt(n=1,e=.05,t=220,i=0,r=0,s=.1,a=0,o=1,l=0,u=0,c=0,d=0,f=0,m=0,y=0,_=0,S=0,b=1,M=0,w=0){let T=Math.PI*2,E=Qi().sampleRate,R=_e=>_e>0?1:-1,P=l*=500*T/E/E,I=t*=(1+e*2*Math.random()-e)*T/E,B=[],N=0,U=0,V=0,W=1,K=0,q=0,j=0,te,he;for(i=i*E+9,M*=E,r*=E,s*=E,S*=E,u*=500*T/E**3,y*=T/E,c*=T/E,d*=E,f=f*E|0,he=i+M+r+s+S|0;V<he;B[V++]=j)++q%(_*100|0)||(j=a?a>1?a>2?a>3?Math.sin((N%T)**3):Math.max(Math.min(Math.tan(N),1),-1):1-(2*N/T%2+2)%2:1-4*Math.abs(Math.round(N/T)-N/T):Math.sin(N),j=(f?1-w+w*Math.sin(T*V/f):1)*R(j)*Math.abs(j)**o*n*1*(V<i?V/i:V<i+M?1-(V-i)/M*(1-b):V<i+M+r?b:V<he-S?(he-V-S)/s*b:0),j=S?j/2+(S>V?0:(V<he-S?1:(he-V)/S)*B[V-S|0]/2):j),te=(t+=l+=u)*Math.cos(y*U++),N+=te-te*m*(1-(Math.sin(V)+1)*1e9%2),W&&++W>d&&(t+=c,I+=c,W=0),f&&!(++K%f)&&(t=I,l=P,W||=1);return B}const Exe=(n,e)=>{let{s:t,note:i=36,freq:r,zrand:s=0,attack:a=0,decay:o=0,sustain:l=.8,release:u=.1,curve:c=1,slide:d=0,deltaSlide:f=0,pitchJump:m=0,pitchJumpTime:y=0,lfo:_=0,znoise:S=0,zmod:b=0,zcrush:M=0,zdelay:w=0,tremolo:T=0,duration:E=.2,zzfx:R}=n;const P=Math.max(E-a-o,0);typeof i=="string"&&(i=IL(i)),!r&&typeof i=="number"&&(r=G1e(i)),t=t.replace("z_","");const I=["sine","triangle","sawtooth","tan","noise"].indexOf(t)||0;c=t==="square"?0:c;const B=yrt(...R||[.25,s,r,a,P,u,I,c,d,f,m,y,_,S,b,M,w,l,o,T]),N=Qi(),U=N.createBuffer(1,B.length,N.sampleRate);U.getChannelData(0).set(B);const V=Qi().createBufferSource();return V.buffer=U,V.start(e),{node:V}};function vrt(){["zzfx","z_sine","z_sawtooth","z_triangle","z_square","z_tan","z_noise"].forEach(n=>{Nf(n,(e,t,i)=>{const{node:r}=Exe({s:n,...t},e);return Dm(r,()=>{Zr(r),i()}),{node:r,nodes:{source:[r]},stop:()=>{}}},{type:"synth",prebake:!0})})}let uM;async function Rxe(n,e){const t=`dsp-worklet-${Date.now()}`,i=`${e}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${t}', MyProcessor);
`,r=`data:text/javascript;base64,${btoa(i)}`;await n.audioWorklet.addModule(r);const s=new AudioWorkletNode(n,t);return{node:s,stop:()=>s.port.postMessage("stop")}}const Pxe=()=>{uM&&(uM?.stop(),uM?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",n=>{n.data==="strudel-stop"?Pxe():n.data?.dough&&uM?.node.port.postMessage(n.data)});const xrt=async n=>{const e=Qi();Pxe(),uM=await Rxe(e,n),uM.node.connect(e.destination)};function Dxe(n,e,t,i){window.postMessage({time:i,dough:n.value,currentTime:e,duration:n.duration,cps:t})}let ww;function brt(){const n=Qi();ww=Yu(n,"dough-processor",{},{outputChannelCount:[2]}),Sxe(ww)}const QN=new Map,i$=new Map;pn.prototype.supradough=function(){return this.onTrigger((n,e,t,i)=>{n.value._begin=i,n.value._duration=n.duration/t,!ww&&brt();const r=(n.value.bank?n.value.bank+"_":"")+n.value.s,s=n.value.n??0,a=`${r}:${s}`;if(QN.has(r)&&(n.value.s=a),QN.has(r)&&!i$.has(a)){const o=QN.get(r),l=o[s%o.length];console.log(`load ${a} from ${l}`);const u=Mrt(l);i$.set(a,u),u.then(({channels:c,sampleRate:d})=>ww.port.postMessage({sample:a,channels:c,sampleRate:d}))}ww.port.postMessage({spawn:n.value})},1)};function _rt(n,e=""){if(!n.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[t,i]=n.split("github:");return i=i.endsWith("/")?i.slice(0,-1):i,i.split("/").length===2&&(i+="/main"),`https://raw.githubusercontent.com/${i}/${e}`}async function Srt(n){if(n.startsWith("github:")&&(n=_rt(n,"strudel.json")),n.startsWith("local:")&&(n="http://localhost:5432"),n.startsWith("shabda:")){let[i,r]=n.split("shabda:");n=`https://shabda.ndre.gr/${r}.json?strudel=1`}if(n.startsWith("shabda/speech")){let[i,r]=n.split("shabda/speech");r=r.startsWith("/")?r.substring(1):r;let[s,a]=r.split(":"),o="f",l="en-GB";s&&([l,o]=s.split("/")),n=`https://shabda.ndre.gr/speech/${a}.json?gender=${o}&language=${l}&strudel=1'`}if(typeof fetch!="function")return;const e=n.split("/").slice(0,-1).join("/");if(typeof fetch>"u")return;const t=await fetch(n).then(i=>i.json()).catch(i=>{throw console.error(i),new Error(`error loading "${n}"`)});return[t,t._base||e]}async function Mrt(n){const e=await fetch(n).then(i=>i.arrayBuffer()).then(i=>Qi().decodeAudioData(i));let t=[];for(let i=0;i<e.numberOfChannels;i++)t.push(e.getChannelData(i));return{channels:t,sampleRate:e.sampleRate}}async function Nxe(n,e){if(typeof n=="string"){const[t,i]=await Srt(n);return Nxe(t,i)}Object.entries(n).map(async([t,i])=>{t!=="_base"&&(i=i.map(r=>e+r),QN.set(t,i))})}const Art="data:text/javascript;base64,dmFyIGh0PU9iamVjdC5kZWZpbmVQcm9wZXJ0eTt2YXIgbnQ9KHUsbSxmKT0+bSBpbiB1P2h0KHUsbSx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6Zn0pOnVbbV09Zjt2YXIgZT0odSxtLGYpPT5udCh1LHR5cGVvZiBtIT0ic3ltYm9sIj9tKyIiOm0sZik7KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IHU9dHlwZW9mIHNhbXBsZVJhdGU8InUiP3NhbXBsZVJhdGU6NDhlMyxtPU1hdGguUEkvdSxmPTEvdTtsZXQgVj1oPT5NYXRoLnBvdyhoLDIpO2NvbnN0IE89KGgscyx0KT0+TWF0aC5taW4oTWF0aC5tYXgoaCxzKSx0KTtmdW5jdGlvbiBfKGgpe3JldHVybiBWKGgpfWZ1bmN0aW9uIFQoaCxzLHQpe2NvbnN0IGk9TWF0aC5zaW4oKDEtdCkqLjUqTWF0aC5QSSksbj1NYXRoLnNpbih0Ki41Kk1hdGguUEkpO3JldHVybiBoKmkrcypufWNsYXNzIGd7Y29uc3RydWN0b3IoKXtlKHRoaXMsInBoYXNlIiwwKX11cGRhdGUocyl7Y29uc3QgdD1NYXRoLnNpbih0aGlzLnBoYXNlKjIqTWF0aC5QSSk7cmV0dXJuIHRoaXMucGhhc2U9KHRoaXMucGhhc2Urcy91KSUxLHR9fWNsYXNzIEl7Y29uc3RydWN0b3IoKXtlKHRoaXMsInBoYXNlIiwwKX11cGRhdGUocyl7cmV0dXJuIHRoaXMucGhhc2UrPWYqcyx0aGlzLnBoYXNlJTEqMi0xfX1mdW5jdGlvbiBNKGgscyl7cmV0dXJuIGg8cz8oaC89cyxoK2gtaCpoLTEpOmg+MS1zPyhoPShoLTEpL3MsaCpoK2graCsxKTowfWNsYXNzIFN7Y29uc3RydWN0b3Iocz17fSl7dGhpcy5waGFzZT1zLnBoYXNlPz8wfXVwZGF0ZShzKXtjb25zdCB0PXMvdTtsZXQgaT1NKHRoaXMucGhhc2UsdCksbj0yKnRoaXMucGhhc2UtMS1pO3JldHVybiB0aGlzLnBoYXNlKz10LHRoaXMucGhhc2U+MSYmKHRoaXMucGhhc2UtPTEpLG59fWZ1bmN0aW9uIHooaCxzLHQpe3JldHVybiBoPDI/MDooKG4sbCxyKT0+cioobC1uKStuKSgtcyouNSxzKi41LHQvKGgtMSkpfWZ1bmN0aW9uIEYoaCxzKXtyZXR1cm4gaCpNYXRoLnBvdygyLHMvMTIpfWNsYXNzIEx7Y29uc3RydWN0b3Iocz17fSl7dGhpcy52b2ljZXM9cy52b2ljZXM/PzUsdGhpcy5mcmVxc3ByZWFkPXMuZnJlcXNwcmVhZD8/LjIsdGhpcy5wYW5zcHJlYWQ9cy5wYW5zcHJlYWQ/Py40LHRoaXMucGhhc2U9bmV3IEZsb2F0MzJBcnJheSh0aGlzLnZvaWNlcykubWFwKCgpPT5NYXRoLnJhbmRvbSgpKX11cGRhdGUocyl7Y29uc3QgdD1NYXRoLnNxcnQoMS10aGlzLnBhbnNwcmVhZCksaT1NYXRoLnNxcnQodGhpcy5wYW5zcHJlYWQpO2xldCBuPTAsbD0wO2ZvcihsZXQgcj0wO3I8dGhpcy52b2ljZXM7cisrKXtjb25zdCBhPUYocyx6KHRoaXMudm9pY2VzLHRoaXMuZnJlcXNwcmVhZCxyKSkvdSxjPShyJjEpPT0xO2xldCBkPXQ7YyYmKGQ9aSk7bGV0IGI9TSh0aGlzLnBoYXNlW3JdLGEpLEU9Mip0aGlzLnBoYXNlW3JdLTEtYjtuPW4rRSpkLGw9bCtFKmQsdGhpcy5waGFzZVtyXSs9YSx0aGlzLnBoYXNlW3JdPjEmJih0aGlzLnBoYXNlW3JdLT0xKX1yZXR1cm4gbitsfX1jbGFzcyBre2NvbnN0cnVjdG9yKCl7ZSh0aGlzLCJwaGFzZSIsMCl9dXBkYXRlKHMpe3RoaXMucGhhc2UrPWYqcztsZXQgdD10aGlzLnBoYXNlJTE7cmV0dXJuKHQ8LjU/Mip0OjEtMioodC0uNSkpKjItMX19Y2xhc3MgcXtjb25zdHJ1Y3Rvcigpe2UodGhpcywiczAiLDApO2UodGhpcywiczEiLDApfXVwZGF0ZShzLHQsaT0wKXtpPU1hdGgubWF4KGksMCksdD1NYXRoLm1pbih0LDJlNCk7bGV0IG49MipNYXRoLnNpbih0Km0pO249TyhuLDAsMS4xNCk7Y29uc3Qgcj0xLU1hdGgucG93KC41LChpKy4xMjUpLy4xMjUpKm47cmV0dXJuIHRoaXMuczA9cip0aGlzLnMwLW4qdGhpcy5zMStuKnMsdGhpcy5zMT1yKnRoaXMuczErbip0aGlzLnMwLHRoaXMuczF9fWNsYXNzIEN7Y29uc3RydWN0b3Iocz0wKXt0aGlzLnBoYXNlPXN9c2F3KHMsdCl7bGV0IGk9KHRoaXMucGhhc2UrcyklMSxuPU0oaSx0KTtyZXR1cm4gMippLTEtbn11cGRhdGUocyx0PS41KXtjb25zdCBpPXMvdTtsZXQgbj10aGlzLnNhdygwLGkpLXRoaXMuc2F3KHQsaSk7cmV0dXJuIHRoaXMucGhhc2U9KHRoaXMucGhhc2UraSklMSxuK3QqMi0xfX1jbGFzcyBOe2NvbnN0cnVjdG9yKCl7ZSh0aGlzLCJwaGFzZSIsMCl9dXBkYXRlKHMsdD0uNSl7cmV0dXJuIHRoaXMucGhhc2UrPWYqcyx0aGlzLnBoYXNlJTE8dD8xOi0xfX1jbGFzcyBQe2NvbnN0cnVjdG9yKCl7ZSh0aGlzLCJ1cGRhdGUiLHM9Pk1hdGgucmFuZG9tKCk8cypmP01hdGgucmFuZG9tKCk6MCl9fWNsYXNzIEd7dXBkYXRlKCl7cmV0dXJuIE1hdGgucmFuZG9tKCkqMi0xfX1jbGFzcyBqe2NvbnN0cnVjdG9yKCl7dGhpcy5vdXQ9MH11cGRhdGUoKXtsZXQgcz1NYXRoLnJhbmRvbSgpKjItMTtyZXR1cm4gdGhpcy5vdXQ9KHRoaXMub3V0Ky4wMipzKS8xLjAyLHRoaXMub3V0fX1jbGFzcyBCe2NvbnN0cnVjdG9yKCl7dGhpcy5iMD0wLHRoaXMuYjE9MCx0aGlzLmIyPTAsdGhpcy5iMz0wLHRoaXMuYjQ9MCx0aGlzLmI1PTAsdGhpcy5iNj0wfXVwZGF0ZSgpe2NvbnN0IHM9TWF0aC5yYW5kb20oKSoyLTE7dGhpcy5iMD0uOTk4ODYqdGhpcy5iMCtzKi4wNTU1MTc5LHRoaXMuYjE9Ljk5MzMyKnRoaXMuYjErcyouMDc1MDc1OSx0aGlzLmIyPS45NjkqdGhpcy5iMitzKi4xNTM4NTIsdGhpcy5iMz0uODY2NSp0aGlzLmIzK3MqLjMxMDQ4NTYsdGhpcy5iND0uNTUqdGhpcy5iNCtzKi41MzI5NTIyLHRoaXMuYjU9LS43NjE2KnRoaXMuYjUtcyouMDE2ODk4O2NvbnN0IHQ9dGhpcy5iMCt0aGlzLmIxK3RoaXMuYjIrdGhpcy5iMyt0aGlzLmI0K3RoaXMuYjUrdGhpcy5iNitzKi41MzYyO3JldHVybiB0aGlzLmI2PXMqLjExNTkyNix0Ki4xMX19Y2xhc3MgJHtjb25zdHJ1Y3Rvcigpe2UodGhpcywicGhhc2UiLDEpfXVwZGF0ZShzKXt0aGlzLnBoYXNlKz1mKnM7bGV0IHQ9dGhpcy5waGFzZT49MT8xOjA7cmV0dXJuIHRoaXMucGhhc2U9dGhpcy5waGFzZSUxLHR9fWZ1bmN0aW9uIHgoaCxzLHQsaT0xKXtpZihoPD0wKXJldHVybiBzO2lmKGg+PTEpcmV0dXJuIHQ7bGV0IG47cmV0dXJuIGk9PT0wP249aDppPjA/bj1NYXRoLnBvdyhoLGkpOm49MS1NYXRoLnBvdygxLWgsLWkpLHMrKHQtcykqbn1jbGFzcyB2e2NvbnN0cnVjdG9yKHM9e30pe3RoaXMuc3RhdGU9Im9mZiIsdGhpcy5zdGFydFRpbWU9MCx0aGlzLnN0YXJ0VmFsPTAsdGhpcy5kZWNheUN1cnZlPXMuZGVjYXlDdXJ2ZT8/MX11cGRhdGUocyx0LGksbixsLHIpe3N3aXRjaCh0aGlzLnN0YXRlKXtjYXNlIm9mZiI6cmV0dXJuIHQ+MCYmKHRoaXMuc3RhdGU9ImF0dGFjayIsdGhpcy5zdGFydFRpbWU9cyx0aGlzLnN0YXJ0VmFsPTApLDA7Y2FzZSJhdHRhY2siOntsZXQgcD1zLXRoaXMuc3RhcnRUaW1lO3JldHVybiBwPmk/KHRoaXMuc3RhdGU9ImRlY2F5Iix0aGlzLnN0YXJ0VGltZT1zLDEpOngocC9pLHRoaXMuc3RhcnRWYWwsMSwxKX1jYXNlImRlY2F5Ijp7bGV0IHA9cy10aGlzLnN0YXJ0VGltZSxhPXgocC9uLDEsbCwtdGhpcy5kZWNheUN1cnZlKTtyZXR1cm4gdDw9MD8odGhpcy5zdGF0ZT0icmVsZWFzZSIsdGhpcy5zdGFydFRpbWU9cyx0aGlzLnN0YXJ0VmFsPWEsYSk6cD5uPyh0aGlzLnN0YXRlPSJzdXN0YWluIix0aGlzLnN0YXJ0VGltZT1zLGwpOmF9Y2FzZSJzdXN0YWluIjpyZXR1cm4gdDw9MCYmKHRoaXMuc3RhdGU9InJlbGVhc2UiLHRoaXMuc3RhcnRUaW1lPXMsdGhpcy5zdGFydFZhbD1sKSxsO2Nhc2UicmVsZWFzZSI6e2xldCBwPXMtdGhpcy5zdGFydFRpbWU7aWYocD5yKXJldHVybiB0aGlzLnN0YXRlPSJvZmYiLDA7bGV0IGE9eChwL3IsdGhpcy5zdGFydFZhbCwwLC10aGlzLmRlY2F5Q3VydmUpO3JldHVybiB0PjAmJih0aGlzLnN0YXRlPSJhdHRhY2siLHRoaXMuc3RhcnRUaW1lPXMsdGhpcy5zdGFydFZhbD1hKSxhfX10aHJvdyJpbnZhbGlkIGVudmVsb3BlIHN0YXRlIn19Y29uc3QgVz0xMDtjbGFzcyBSe2NvbnN0cnVjdG9yKCl7ZSh0aGlzLCJ3cml0ZUlkeCIsMCk7ZSh0aGlzLCJyZWFkSWR4IiwwKTtlKHRoaXMsImJ1ZmZlciIsbmV3IEZsb2F0MzJBcnJheShXKnUpKX13cml0ZShzLHQpe3RoaXMud3JpdGVJZHg9KHRoaXMud3JpdGVJZHgrMSkldGhpcy5idWZmZXIubGVuZ3RoLHRoaXMuYnVmZmVyW3RoaXMud3JpdGVJZHhdPXM7bGV0IGk9TWF0aC5taW4oTWF0aC5mbG9vcih1KnQpLHRoaXMuYnVmZmVyLmxlbmd0aC0xKTt0aGlzLnJlYWRJZHg9dGhpcy53cml0ZUlkeC1pLHRoaXMucmVhZElkeDwwJiYodGhpcy5yZWFkSWR4Kz10aGlzLmJ1ZmZlci5sZW5ndGgpfXVwZGF0ZShzLHQpe3JldHVybiB0aGlzLndyaXRlKHMsdCksdGhpcy5idWZmZXJbdGhpcy5yZWFkSWR4XX19Y2xhc3MgWHtjb25zdHJ1Y3Rvcigpe2UodGhpcywiZGVsYXkiLG5ldyBSKTtlKHRoaXMsIm1vZHVsYXRvciIsbmV3IGspfXVwZGF0ZShzLHQsaSxuLGwpe2NvbnN0IHI9dGhpcy5tb2R1bGF0b3IudXBkYXRlKG4pKmwscD10aGlzLmRlbGF5LnVwZGF0ZShzLGkqKDErcikpO3JldHVybiBUKHMscCx0KX19Y2xhc3MgVXtjb25zdHJ1Y3Rvcigpe2UodGhpcywiaG9sZCIsMCk7ZSh0aGlzLCJ0IiwwKX11cGRhdGUocyx0KXtyZXR1cm4gdGhpcy50KysldD09PTAmJih0aGlzLnQ9MCx0aGlzLmhvbGQ9cyksdGhpcy5ob2xkfX1jbGFzcyBZe3VwZGF0ZShzLHQpe3Q9TWF0aC5tYXgoMSx0KTtjb25zdCBpPU1hdGgucG93KDIsdC0xKTtyZXR1cm4gTWF0aC5yb3VuZChzKmkpL2l9fWNsYXNzIFp7dXBkYXRlKHMsdD0wLGk9MSl7aT1NYXRoLm1heCguMDAxLE1hdGgubWluKDEsaSkpO2NvbnN0IG49TWF0aC5leHBtMSh0KTtyZXR1cm4oMStuKSpzLygxK24qTWF0aC5hYnMocykpKml9fWNsYXNzIHd7Y29uc3RydWN0b3Iocyx0LGkpe2UodGhpcywiYnVmZmVyIik7ZSh0aGlzLCJzYW1wbGVSYXRlIik7ZSh0aGlzLCJwb3MiLDApO2UodGhpcywic2FtcGxlRnJlcSIsQSgpKTt0aGlzLmJ1ZmZlcj1zLHRoaXMuc2FtcGxlUmF0ZT10LHRoaXMuZHVyYXRpb249dGhpcy5idWZmZXIubGVuZ3RoL3RoaXMuc2FtcGxlUmF0ZSx0aGlzLnNwZWVkPXUvdGhpcy5zYW1wbGVSYXRlLGkmJih0aGlzLnNwZWVkKj10aGlzLmR1cmF0aW9uKX11cGRhdGUocyl7aWYodGhpcy5wb3M+PXRoaXMuYnVmZmVyLmxlbmd0aClyZXR1cm4gMDtjb25zdCB0PXMvdGhpcy5zYW1wbGVGcmVxKnRoaXMuc3BlZWQ7bGV0IGk9dGhpcy5idWZmZXJbTWF0aC5mbG9vcih0aGlzLnBvcyldO3JldHVybiB0aGlzLnBvcz10aGlzLnBvcyt0LGl9fWUodywic2FtcGxlcyIsbmV3IE1hcCk7Y29uc3QgeT0oaCxzPSJsaW5lYXIiLHQpPT57Y29uc3RbcixwLGEsY109aDtpZihyPT1udWxsJiZwPT1udWxsJiZhPT1udWxsJiZjPT1udWxsKXJldHVybiB0Pz9bLjAwMSwuMDAxLDEsLjAxXTtjb25zdCBkPWE/PyhyIT1udWxsJiZwPT1udWxsfHxyPT1udWxsJiZwPT1udWxsPzE6LjAwMSk7cmV0dXJuW01hdGgubWF4KHI/PzAsLjAwMSksTWF0aC5tYXgocD8/MCwuMDAxKSxNYXRoLm1pbihkLDEpLE1hdGgubWF4KGM/PzAsLjAxKV19O2xldCBEPXtzaW5lOmcsc2F3OlMsemF3Okksc2F3dG9vdGg6Uyx6YXd0b290aDpJLHN1cGVyc2F3OkwsdHJpOmssdHJpYW5nbGU6ayxwdWxzZTpDLHNxdWFyZTpDLHB1bHplOk4sZHVzdDpQLGNyYWNrbGU6UCxpbXB1bHNlOiQsd2hpdGU6Ryxicm93bjpqLHBpbms6Qn07Y29uc3QgSD17Y2hvcnVzOjAsbm90ZTo0OCxzOiJ0cmlhbmdsZSIsYmFuazoiIixnYWluOjEscG9zdGdhaW46MSx2ZWxvY2l0eToxLGRlbnNpdHk6Ii4wMyIsZnR5cGU6IjEyZGIiLGZhbmNob3I6MCxyZXNvbmFuY2U6MCxocmVzb25hbmNlOjAsYmFuZHE6MCxjaGFubmVsczpbMSwyXSxwaGFzZXJkZXB0aDouNzUsc2hhcGV2b2w6MSxkaXN0b3J0dm9sOjEsZGVsYXk6MCxieXRlQmVhdEV4cHJlc3Npb246IjAiLGRlbGF5ZmVlZGJhY2s6LjUsZGVsYXlzcGVlZDoxLGRlbGF5dGltZTouMjUsb3JiaXQ6MSxpOjEsZmZ0OjgsejoidHJpYW5nbGUiLHBhbjouNSxmbWg6MSxmbWVudjowLHNwZWVkOjEscHc6LjV9O2xldCBvPWg9PkhbaF07Y29uc3QgSj17YzowLGQ6MixlOjQsZjo1LGc6NyxhOjksYjoxMX0sSz17IiMiOjEsYjotMSxzOjEsZjotMX0sUT0oaCxzPTMpPT57dmFyIGE7bGV0W3QsaT0iIixuPSIiXT0oKGE9U3RyaW5nKGgpLm1hdGNoKC9eKFthLWdBLUddKShbI2JzZl0qKShbMC05XSopJC8pKT09bnVsbD92b2lkIDA6YS5zbGljZSgxKSl8fFtdO2lmKCF0KXRocm93IG5ldyBFcnJvcignbm90IGEgbm90ZTogIicraCsnIicpO2NvbnN0IGw9Slt0LnRvTG93ZXJDYXNlKCldLHI9KGk9PW51bGw/dm9pZCAwOmkuc3BsaXQoIiIpLnJlZHVjZSgoYyxkKT0+YytLW2RdLDApKXx8MDtyZXR1cm4oTnVtYmVyKG58fHMpKzEpKjEyK2wrcn0sdHQ9aD0+TWF0aC5wb3coMiwoaC02OSkvMTIpKjQ0MCxBPWg9PihoPWh8fG8oIm5vdGUiKSx0eXBlb2YgaD09InN0cmluZyImJihoPVEoaCwzKSksdHQoaCkpO2NsYXNzIHN0e2NvbnN0cnVjdG9yKHMpe2UodGhpcywiaWQiLDApO2UodGhpcywib3V0IixbMCwwXSk7ZSh0aGlzLCJhdHRhY2siKTtlKHRoaXMsImRlY2F5Iik7ZSh0aGlzLCJzdXN0YWluIik7ZSh0aGlzLCJyZWxlYXNlIik7ZSh0aGlzLCJfYmVnaW4iKTtlKHRoaXMsIl9kdXJhdGlvbiIpO2UodGhpcywiX3NvdW5kIik7ZSh0aGlzLCJfY2hhbm5lbHMiLDEpO2UodGhpcywiX2J1ZmZlcnMiKTtlKHRoaXMsInVuaXQiKTtlKHRoaXMsIl9wZW52Iik7ZSh0aGlzLCJwZW52Iik7ZSh0aGlzLCJwYXR0YWNrIik7ZSh0aGlzLCJwZGVjYXkiKTtlKHRoaXMsInBzdXN0YWluIik7ZSh0aGlzLCJwcmVsZWFzZSIpO2UodGhpcywidmliIik7ZSh0aGlzLCJfdmliIik7ZSh0aGlzLCJ2aWJtb2QiKTtlKHRoaXMsIl9mbSIpO2UodGhpcywiZm1oIik7ZSh0aGlzLCJmbWkiKTtlKHRoaXMsIl9mbWVudiIpO2UodGhpcywiZm1hdHRhY2siKTtlKHRoaXMsImZtZGVjYXkiKTtlKHRoaXMsImZtc3VzdGFpbiIpO2UodGhpcywiZm1yZWxlYXNlIik7ZSh0aGlzLCJfbHBlbnYiKTtlKHRoaXMsImxwZW52Iik7ZSh0aGlzLCJscGF0dGFjayIpO2UodGhpcywibHBkZWNheSIpO2UodGhpcywibHBzdXN0YWluIik7ZSh0aGlzLCJscHJlbGVhc2UiKTtlKHRoaXMsIl9ocGVudiIpO2UodGhpcywiaHBlbnYiKTtlKHRoaXMsImhwYXR0YWNrIik7ZSh0aGlzLCJocGRlY2F5Iik7ZSh0aGlzLCJocHN1c3RhaW4iKTtlKHRoaXMsImhwcmVsZWFzZSIpO2UodGhpcywiX2JwZW52Iik7ZSh0aGlzLCJicGVudiIpO2UodGhpcywiYnBhdHRhY2siKTtlKHRoaXMsImJwZGVjYXkiKTtlKHRoaXMsImJwc3VzdGFpbiIpO2UodGhpcywiYnByZWxlYXNlIik7ZSh0aGlzLCJjdXRvZmYiKTtlKHRoaXMsImhjdXRvZmYiKTtlKHRoaXMsImJhbmRmIik7ZSh0aGlzLCJjb2Fyc2UiKTtlKHRoaXMsImNydXNoIik7ZSh0aGlzLCJkaXN0b3J0Iik7ZSh0aGlzLCJmcmVxIik7ZSh0aGlzLCJub3RlIik7ZSh0aGlzLCJfbHBmIik7ZSh0aGlzLCJfaHBmIik7ZSh0aGlzLCJfYnBmIik7ZSh0aGlzLCJfY2hvcnVzIik7ZSh0aGlzLCJfY29hcnNlIik7ZSh0aGlzLCJfY3J1c2giKTtlKHRoaXMsIl9kaXN0b3J0Iik7dmFyIGksbixsLHIscCxhLGM7dGhpcy5mcmVxPz8odGhpcy5mcmVxPUEocy5ub3RlKSksdGhpcy5fYmVnaW49cy5fYmVnaW4sdGhpcy5fZHVyYXRpb249cy5fZHVyYXRpb24sdGhpcy5yZWxlYXNlPXMucmVsZWFzZT8/MDtsZXQgdD10aGlzO2lmKE9iamVjdC5hc3NpZ24odCxzKSx0LnM9dC5zPz9vKCJzIiksdC5nYWluPV8odC5nYWluPz9vKCJnYWluIikpLHQudmVsb2NpdHk9Xyh0LnZlbG9jaXR5Pz9vKCJ2ZWxvY2l0eSIpKSx0LnBvc3RnYWluPV8odC5wb3N0Z2Fpbj8/bygicG9zdGdhaW4iKSksdC5kZW5zaXR5PXQuZGVuc2l0eT8/bygiZGVuc2l0eSIpLHQuZmFuY2hvcj10LmZhbmNob3I/P28oImZhbmNob3IiKSx0LmRyaXZlPXQuZHJpdmU/Py42OSx0LnBoYXNlcmRlcHRoPXQucGhhc2VyZGVwdGg/P28oInBoYXNlcmRlcHRoIiksdC5zaGFwZXZvbD1fKHQuc2hhcGV2b2w/P28oInNoYXBldm9sIikpLHQuZGlzdG9ydHZvbD1fKHQuZGlzdG9ydHZvbD8/bygiZGlzdG9ydHZvbCIpKSx0Lmk9dC5pPz9vKCJpIiksdC5jaG9ydXM9dC5jaG9ydXM/P28oImNob3J1cyIpLHQuZmZ0PXQuZmZ0Pz9vKCJmZnQiKSx0LnBhbj10LnBhbj8/bygicGFuIiksdC5vcmJpdD10Lm9yYml0Pz9vKCJvcmJpdCIpLHQuZm1lbnY9dC5mbWVudj8/bygiZm1lbnYiKSx0LnJlc29uYW5jZT10LnJlc29uYW5jZT8/bygicmVzb25hbmNlIiksdC5ocmVzb25hbmNlPXQuaHJlc29uYW5jZT8/bygiaHJlc29uYW5jZSIpLHQuYmFuZHE9dC5iYW5kcT8/bygiYmFuZHEiKSx0LnNwZWVkPXQuc3BlZWQ/P28oInNwZWVkIiksdC5wdz10LnB3Pz9vKCJwdyIpLFt0LmF0dGFjayx0LmRlY2F5LHQuc3VzdGFpbix0LnJlbGVhc2VdPXkoW3QuYXR0YWNrLHQuZGVjYXksdC5zdXN0YWluLHQucmVsZWFzZV0pLHQuX2hvbGRFbmQ9dC5fYmVnaW4rdC5fZHVyYXRpb24sdC5fZW5kPXQuX2hvbGRFbmQrdC5yZWxlYXNlKy4wMSx0LmZtaSYmKHQucz09PSJzYXcifHx0LnM9PT0ic2F3dG9vdGgiKSYmKHQucz0iemF3IiksRFt0LnNdKXtjb25zdCBkPURbdC5zXTt0Ll9zb3VuZD1uZXcgZCx0Ll9jaGFubmVscz0xfWVsc2UgaWYody5zYW1wbGVzLmhhcyh0LnMpKXtjb25zdCBkPXcuc2FtcGxlcy5nZXQodC5zKTt0Ll9idWZmZXJzPVtdLHQuX2NoYW5uZWxzPWQuY2hhbm5lbHMubGVuZ3RoO2ZvcihsZXQgYj0wO2I8dC5fY2hhbm5lbHM7YisrKXQuX2J1ZmZlcnMucHVzaChuZXcgdyhkLmNoYW5uZWxzW2JdLGQuc2FtcGxlUmF0ZSx0LnVuaXQ9PT0iYyIpKX1lbHNlIGNvbnNvbGUud2Fybigic291bmQgbm90IGxvYWRlZCIsdC5zKTt0LnBlbnYmJih0Ll9wZW52PW5ldyB2KHtkZWNheUN1cnZlOjR9KSxbdC5wYXR0YWNrLHQucGRlY2F5LHQucHN1c3RhaW4sdC5wcmVsZWFzZV09eShbdC5wYXR0YWNrLHQucGRlY2F5LHQucHN1c3RhaW4sdC5wcmVsZWFzZV0pKSx0LnZpYiYmKHQuX3ZpYj1uZXcgZyx0LnZpYm1vZD10LnZpYm1vZD8/bygidmlibW9kIikpLHQuZm1pJiYodC5fZm09bmV3IGcsdC5mbWg9dC5mbWg/P28oImZtaCIpLHQuZm1lbnYmJih0Ll9mbWVudj1uZXcgdih7ZGVjYXlDdXJ2ZToyfSksW3QuZm1hdHRhY2ssdC5mbWRlY2F5LHQuZm1zdXN0YWluLHQuZm1yZWxlYXNlXT15KFt0LmZtYXR0YWNrLHQuZm1kZWNheSx0LmZtc3VzdGFpbix0LmZtcmVsZWFzZV0pKSksdC5fYWRzcj1uZXcgdih7ZGVjYXlDdXJ2ZToyfSksdC5kZWxheT1fKHQuZGVsYXk/P28oImRlbGF5IikpLHQuZGVsYXlmZWVkYmFjaz10LmRlbGF5ZmVlZGJhY2s/P28oImRlbGF5ZmVlZGJhY2siKSx0LmRlbGF5c3BlZWQ9dC5kZWxheXNwZWVkPz9vKCJkZWxheXNwZWVkIiksdC5kZWxheXRpbWU9dC5kZWxheXRpbWU/P28oImRlbGF5dGltZSIpLHQubHBlbnYmJih0Ll9scGVudj1uZXcgdih7ZGVjYXlDdXJ2ZTo0fSksW3QubHBhdHRhY2ssdC5scGRlY2F5LHQubHBzdXN0YWluLHQubHByZWxlYXNlXT15KFt0LmxwYXR0YWNrLHQubHBkZWNheSx0Lmxwc3VzdGFpbix0LmxwcmVsZWFzZV0pKSx0LmhwZW52JiYodC5faHBlbnY9bmV3IHYoe2RlY2F5Q3VydmU6NH0pLFt0LmhwYXR0YWNrLHQuaHBkZWNheSx0Lmhwc3VzdGFpbix0LmhwcmVsZWFzZV09eShbdC5ocGF0dGFjayx0LmhwZGVjYXksdC5ocHN1c3RhaW4sdC5ocHJlbGVhc2VdKSksdC5icGVudiYmKHQuX2JwZW52PW5ldyB2KHtkZWNheUN1cnZlOjR9KSxbdC5icGF0dGFjayx0LmJwZGVjYXksdC5icHN1c3RhaW4sdC5icHJlbGVhc2VdPXkoW3QuYnBhdHRhY2ssdC5icGRlY2F5LHQuYnBzdXN0YWluLHQuYnByZWxlYXNlXSkpLHQuX2Nob3J1cz10LmNob3J1cz9bXTpudWxsLHQuX2xwZj10LmN1dG9mZj9bXTpudWxsLHQuX2hwZj10LmhjdXRvZmY/W106bnVsbCx0Ll9icGY9dC5iYW5kZj9bXTpudWxsLHQuX2NvYXJzZT10LmNvYXJzZT9bXTpudWxsLHQuX2NydXNoPXQuY3J1c2g/W106bnVsbCx0Ll9kaXN0b3J0PXQuZGlzdG9ydD9bXTpudWxsO2ZvcihsZXQgZD0wO2Q8dGhpcy5fY2hhbm5lbHM7ZCsrKShpPXQuX2xwZik9PW51bGx8fGkucHVzaChuZXcgcSksKG49dC5faHBmKT09bnVsbHx8bi5wdXNoKG5ldyBxKSwobD10Ll9icGYpPT1udWxsfHxsLnB1c2gobmV3IHEpLChyPXQuX2Nob3J1cyk9PW51bGx8fHIucHVzaChuZXcgWCksKHA9dC5fY29hcnNlKT09bnVsbHx8cC5wdXNoKG5ldyBVKSwoYT10Ll9jcnVzaCk9PW51bGx8fGEucHVzaChuZXcgWSksKGM9dC5fZGlzdG9ydCk9PW51bGx8fGMucHVzaChuZXcgWil9dXBkYXRlKHMpe2lmKCF0aGlzLl9zb3VuZCYmIXRoaXMuX2J1ZmZlcnMpcmV0dXJuIDA7bGV0IHQ9KyhzPj10aGlzLl9iZWdpbiYmczw9dGhpcy5faG9sZEVuZCksaT10aGlzLmZyZXEqdGhpcy5zcGVlZDtpZih0aGlzLl9mbSYmdGhpcy5mbWghPT12b2lkIDAmJnRoaXMuZm1pIT09dm9pZCAwKXtsZXQgYT10aGlzLmZtaTtpZih0aGlzLl9mbWVudil7Y29uc3QgYj10aGlzLl9mbWVudi51cGRhdGUocyx0LHRoaXMuZm1hdHRhY2ssdGhpcy5mbWRlY2F5LHRoaXMuZm1zdXN0YWluLHRoaXMuZm1yZWxlYXNlKTthPXRoaXMuZm1lbnYqYiphfWNvbnN0IGM9aSp0aGlzLmZtaCxkPWMqYTtpPWkrdGhpcy5fZm0udXBkYXRlKGMpKmR9aWYodGhpcy5fdmliJiZ0aGlzLnZpYm1vZCE9PXZvaWQgMCYmKGk9aSoyKioodGhpcy5fdmliLnVwZGF0ZSh0aGlzLnZpYikqdGhpcy52aWJtb2QvMTIpKSx0aGlzLl9wZW52JiZ0aGlzLnBlbnYhPT12b2lkIDApe2NvbnN0IGE9dGhpcy5fcGVudi51cGRhdGUocyx0LHRoaXMucGF0dGFjayx0aGlzLnBkZWNheSx0aGlzLnBzdXN0YWluLHRoaXMucHJlbGVhc2UpO2k9aSthKnRoaXMucGVudn1sZXQgbj10aGlzLmN1dG9mZjtpZihuIT09dm9pZCAwJiZ0aGlzLl9scGVudil7Y29uc3QgYT10aGlzLl9scGVudi51cGRhdGUocyx0LHRoaXMubHBhdHRhY2ssdGhpcy5scGRlY2F5LHRoaXMubHBzdXN0YWluLHRoaXMubHByZWxlYXNlKTtuPXRoaXMubHBlbnYqYSpuK259bGV0IGw9dGhpcy5oY3V0b2ZmO2lmKGwhPT12b2lkIDAmJnRoaXMuX2hwZW52JiZ0aGlzLmhwZW52IT09dm9pZCAwKXtjb25zdCBhPXRoaXMuX2hwZW52LnVwZGF0ZShzLHQsdGhpcy5ocGF0dGFjayx0aGlzLmhwZGVjYXksdGhpcy5ocHN1c3RhaW4sdGhpcy5ocHJlbGVhc2UpO2w9MioqdGhpcy5ocGVudiphKmwrbH1sZXQgcj10aGlzLmJhbmRmO2lmKHIhPT12b2lkIDAmJnRoaXMuX2JwZW52JiZ0aGlzLmJwZW52IT09dm9pZCAwKXtjb25zdCBhPXRoaXMuX2JwZW52LnVwZGF0ZShzLHQsdGhpcy5icGF0dGFjayx0aGlzLmJwZGVjYXksdGhpcy5icHN1c3RhaW4sdGhpcy5icHJlbGVhc2UpO3I9MioqdGhpcy5icGVudiphKnIrcn1jb25zdCBwPXRoaXMuX2Fkc3IudXBkYXRlKHMsdCx0aGlzLmF0dGFjayx0aGlzLmRlY2F5LHRoaXMuc3VzdGFpbix0aGlzLnJlbGVhc2UpO2ZvcihsZXQgYT0wO2E8dGhpcy5fY2hhbm5lbHM7YSsrKXtpZih0aGlzLl9zb3VuZCYmdGhpcy5zPT09InB1bHNlIj90aGlzLm91dFthXT10aGlzLl9zb3VuZC51cGRhdGUoaSx0aGlzLnB3KTp0aGlzLl9zb3VuZD90aGlzLm91dFthXT10aGlzLl9zb3VuZC51cGRhdGUoaSk6dGhpcy5fYnVmZmVycyYmKHRoaXMub3V0W2FdPXRoaXMuX2J1ZmZlcnNbYV0udXBkYXRlKGkpKSx0aGlzLm91dFthXT10aGlzLm91dFthXSp0aGlzLmdhaW4qdGhpcy52ZWxvY2l0eSx0aGlzLl9jaG9ydXMpe2NvbnN0IGM9dGhpcy5fY2hvcnVzW2FdLnVwZGF0ZSh0aGlzLm91dFthXSx0aGlzLmNob3J1cywuMDMrLjA1KmEsMSwuMTEpO3RoaXMub3V0W2FdPWMrdGhpcy5vdXRbYV19dGhpcy5fbHBmJiYodGhpcy5fbHBmW2FdLnVwZGF0ZSh0aGlzLm91dFthXSxuLHRoaXMucmVzb25hbmNlKSx0aGlzLm91dFthXT10aGlzLl9scGZbYV0uczEpLHRoaXMuX2hwZiYmKHRoaXMuX2hwZlthXS51cGRhdGUodGhpcy5vdXRbYV0sbCx0aGlzLmhyZXNvbmFuY2UpLHRoaXMub3V0W2FdPXRoaXMub3V0W2FdLXRoaXMuX2hwZlthXS5zMSksdGhpcy5fYnBmJiYodGhpcy5fYnBmW2FdLnVwZGF0ZSh0aGlzLm91dFthXSxyLHRoaXMuYmFuZHEpLHRoaXMub3V0W2FdPXRoaXMuX2JwZlthXS5zMCksdGhpcy5fY29hcnNlJiYodGhpcy5vdXRbYV09dGhpcy5fY29hcnNlW2FdLnVwZGF0ZSh0aGlzLm91dFthXSx0aGlzLmNvYXJzZSkpLHRoaXMuX2NydXNoJiYodGhpcy5vdXRbYV09dGhpcy5fY3J1c2hbYV0udXBkYXRlKHRoaXMub3V0W2FdLHRoaXMuY3J1c2gpKSx0aGlzLl9kaXN0b3J0JiYodGhpcy5vdXRbYV09dGhpcy5fZGlzdG9ydFthXS51cGRhdGUodGhpcy5vdXRbYV0sdGhpcy5kaXN0b3J0LHRoaXMuZGlzdG9ydHZvbCkpLHRoaXMub3V0W2FdPXRoaXMub3V0W2FdKnAsdGhpcy5vdXRbYV09dGhpcy5vdXRbYV0qdGhpcy5wb3N0Z2Fpbix0aGlzLl9idWZmZXJzfHwodGhpcy5vdXRbYV09dGhpcy5vdXRbYV0qLjIpfWlmKHRoaXMuX2NoYW5uZWxzPT09MSYmKHRoaXMub3V0WzFdPXRoaXMub3V0WzBdKSx0aGlzLnBhbiE9PS41KXtjb25zdCBhPXRoaXMucGFuKk1hdGguUEkvMjt0aGlzLm91dFswXT10aGlzLm91dFswXSpNYXRoLmNvcyhhKSx0aGlzLm91dFsxXT10aGlzLm91dFsxXSpNYXRoLnNpbihhKX19fWNsYXNzIGV0e2NvbnN0cnVjdG9yKHM9NDhlMyx0PTApe2UodGhpcywidm9pY2VzIixbXSk7ZSh0aGlzLCJ2aWQiLDApO2UodGhpcywicSIsW10pO2UodGhpcywib3V0IixbMCwwXSk7ZSh0aGlzLCJkZWxheXNlbmQiLFswLDBdKTtlKHRoaXMsImRlbGF5dGltZSIsbygiZGVsYXl0aW1lIikpO2UodGhpcywiZGVsYXlmZWVkYmFjayIsbygiZGVsYXlmZWVkYmFjayIpKTtlKHRoaXMsImRlbGF5c3BlZWQiLG8oImRlbGF5c3BlZWQiKSk7ZSh0aGlzLCJ0IiwwKTt0aGlzLnNhbXBsZVJhdGU9cyx0aGlzLnQ9TWF0aC5mbG9vcih0KnMpLHRoaXMuX2RlbGF5TD1uZXcgUix0aGlzLl9kZWxheVI9bmV3IFJ9bG9hZFNhbXBsZShzLHQsaSl7dy5zYW1wbGVzLnNldChzLHtjaGFubmVsczp0LHNhbXBsZVJhdGU6aX0pfXNjaGVkdWxlU3Bhd24ocyl7aWYocy5fYmVnaW49PT12b2lkIDApdGhyb3cgbmV3IEVycm9yKCJbZG91Z2hdOiBzY2hlZHVsZVNwYXduIGV4cGVjdGVkIF9iZWdpbiB0byBiZSBzZXQiKTtpZihzLl9kdXJhdGlvbj09PXZvaWQgMCl0aHJvdyBuZXcgRXJyb3IoIltkb3VnaF06IHNjaGVkdWxlU3Bhd24gZXhwZWN0ZWQgX2R1cmF0aW9uIHRvIGJlIHNldCIpO3Muc2FtcGxlUmF0ZT10aGlzLnNhbXBsZVJhdGU7Y29uc3QgdD1NYXRoLmZsb29yKHMuX2JlZ2luKnRoaXMuc2FtcGxlUmF0ZSk7dGhpcy5zY2hlZHVsZSh7dGltZTp0LHR5cGU6InNwYXduIixhcmc6c30pfXNwYXduKHMpe3MuaWQ9dGhpcy52aWQrKztjb25zdCB0PW5ldyBzdChzKTt0aGlzLnZvaWNlcy5wdXNoKHQpO2NvbnN0IGk9TWF0aC5jZWlsKHQuX2VuZCp0aGlzLnNhbXBsZVJhdGUpO3RoaXMuc2NoZWR1bGUoe3RpbWU6aSx0eXBlOiJkZXNwYXduIixhcmc6dC5pZH0pfWRlc3Bhd24ocyl7dGhpcy52b2ljZXM9dGhpcy52b2ljZXMuZmlsdGVyKHQ9PnQuaWQhPT1zKX1zY2hlZHVsZShzKXtpZighdGhpcy5xLmxlbmd0aCl7dGhpcy5xLnB1c2gocyk7cmV0dXJufWxldCB0PTA7Zm9yKDt0PHRoaXMucS5sZW5ndGgmJnRoaXMucVt0XS50aW1lPHMudGltZTspdCsrO3RoaXMucS5zcGxpY2UodCwwLHMpfXVwZGF0ZSgpe2Zvcig7dGhpcy5xLmxlbmd0aD4wJiZ0aGlzLnFbMF0udGltZTw9dGhpcy50Oyl0aGlzW3RoaXMucVswXS50eXBlXSh0aGlzLnFbMF0uYXJnKSx0aGlzLnEuc2hpZnQoKTt0aGlzLm91dFswXT0wLHRoaXMub3V0WzFdPTA7Zm9yKGxldCBpPTA7aTx0aGlzLnZvaWNlcy5sZW5ndGg7aSsrKXRoaXMudm9pY2VzW2ldLnVwZGF0ZSh0aGlzLnQvdGhpcy5zYW1wbGVSYXRlKSx0aGlzLm91dFswXSs9dGhpcy52b2ljZXNbaV0ub3V0WzBdLHRoaXMub3V0WzFdKz10aGlzLnZvaWNlc1tpXS5vdXRbMV0sdGhpcy52b2ljZXNbaV0uZGVsYXkmJih0aGlzLmRlbGF5c2VuZFswXSs9dGhpcy52b2ljZXNbaV0ub3V0WzBdKnRoaXMudm9pY2VzW2ldLmRlbGF5LHRoaXMuZGVsYXlzZW5kWzFdKz10aGlzLnZvaWNlc1tpXS5vdXRbMV0qdGhpcy52b2ljZXNbaV0uZGVsYXksdGhpcy5kZWxheXRpbWU9dGhpcy52b2ljZXNbaV0uZGVsYXl0aW1lLHRoaXMuZGVsYXlzcGVlZD10aGlzLnZvaWNlc1tpXS5kZWxheXNwZWVkLHRoaXMuZGVsYXlmZWVkYmFjaz10aGlzLnZvaWNlc1tpXS5kZWxheWZlZWRiYWNrKTtjb25zdCBzPXRoaXMuX2RlbGF5TC51cGRhdGUodGhpcy5kZWxheXNlbmRbMF0sdGhpcy5kZWxheXRpbWUpLHQ9dGhpcy5fZGVsYXlSLnVwZGF0ZSh0aGlzLmRlbGF5c2VuZFsxXSx0aGlzLmRlbGF5dGltZSk7dGhpcy5kZWxheXNlbmRbMF09cyp0aGlzLmRlbGF5ZmVlZGJhY2ssdGhpcy5kZWxheXNlbmRbMV09dCp0aGlzLmRlbGF5ZmVlZGJhY2ssdGhpcy5vdXRbMF0rPXMsdGhpcy5vdXRbMV0rPXQsdGhpcy50Kyt9fWNvbnN0IGl0PShoLHMsdCk9Pk1hdGgubWluKE1hdGgubWF4KGgscyksdCk7Y2xhc3MgYXQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuZG91Z2g9bmV3IGV0KHNhbXBsZVJhdGUsY3VycmVudFRpbWUpLHRoaXMucG9ydC5vbm1lc3NhZ2U9cz0+e3MuZGF0YS5zcGF3bj90aGlzLmRvdWdoLnNjaGVkdWxlU3Bhd24ocy5kYXRhLnNwYXduKTpzLmRhdGEuc2FtcGxlP3RoaXMuZG91Z2gubG9hZFNhbXBsZShzLmRhdGEuc2FtcGxlLHMuZGF0YS5jaGFubmVscyxzLmRhdGEuc2FtcGxlUmF0ZSk6cy5kYXRhLnNhbXBsZXM/cy5kYXRhLnNhbXBsZXMuZm9yRWFjaCgoW3QsaSxuXSk9Pnt0aGlzLmRvdWdoLmxvYWRTYW1wbGUodCxpLG4pfSk6Y29uc29sZS5sb2coInVucmVjb2duaXplZCBldmVudCB0eXBlIixzLmRhdGEpfX1wcm9jZXNzKHMsdCxpKXtpZih0aGlzLmRpc2Nvbm5lY3RlZClyZXR1cm4hMTtjb25zdCBuPXRbMF07Zm9yKGxldCBsPTA7bDxuWzBdLmxlbmd0aDtsKyspe3RoaXMuZG91Z2gudXBkYXRlKCk7Zm9yKGxldCByPTA7cjxuLmxlbmd0aDtyKyspbltyXVtsXT1pdCh0aGlzLmRvdWdoLm91dFtyXSwtMSwxKX1yZXR1cm4hMH19cmVnaXN0ZXJQcm9jZXNzb3IoImRvdWdoLXByb2Nlc3NvciIsYXQpfSkoKTsK",Trt=Art;xxe(Trt);const{Pattern:Crt,logger:vz,repl:wrt}=D1e;F1e(vz);const Bxe=n=>(n.ensureObjectValue(),n.value),Fxe=(n,e,t,i,r)=>UL(Bxe(n),r,t,i,n.whole?.begin.valueOf());async function Ert(n,e,t,i,r,s,a,o=void 0){let l=Qi();await l.close(),l=new OfflineAudioContext(2,(i-t)/e*r,r),u2(l),yz(new uxe(l)),await J6({maxPolyphony:s,multiChannelOrbits:a}),vz("[webaudio] preloading");let u=n.queryArc(t,i,{_cps:e}).sort((c,d)=>c.whole.begin.valueOf()-d.whole.begin.valueOf());for(const c of u)if(c.hasOnset())try{await UL(Bxe(c),(c.whole.begin.valueOf()-t)/e,c.duration/e,e,(c.whole?.begin.valueOf()-t)/e)}catch(d){ME(d,"webaudio")}return vz("[webaudio] start rendering"),l.startRendering().then(c=>{const d=Rrt(c),f=new Blob([d],{type:"audio/wav"}),m=URL.createObjectURL(f),y=document.createElement("a");y.href=m,o=o?`${o}.wav`:`${new Date().toISOString()}.wav`,y.download=`${o}`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(m)}).finally(async()=>{u2(null),yz(null),Axe()})}function Lxe(n={}){const e=n.audioContext??Qi();return u2(e),n={getTime:()=>e.currentTime,defaultOutput:Fxe,...n},wrt(n)}Crt.prototype.dough=function(){return this.onTrigger(Dxe,1)};function Rrt(n,e){e=e||{};var t=n.numberOfChannels,i=n.sampleRate,r=e.float32?3:1,s=r===3?32:16,a;return t===2?a=Drt(n.getChannelData(0),n.getChannelData(1)):a=n.getChannelData(0),Prt(a,r,i,t,s)}function Prt(n,e,t,i,r){var s=r/8,a=i*s,o=new ArrayBuffer(44+n.length*s),l=new DataView(o);return uN(l,0,"RIFF"),l.setUint32(4,36+n.length*s,!0),uN(l,8,"WAVE"),uN(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,e,!0),l.setUint16(22,i,!0),l.setUint32(24,t,!0),l.setUint32(28,t*a,!0),l.setUint16(32,a,!0),l.setUint16(34,r,!0),uN(l,36,"data"),l.setUint32(40,n.length*s,!0),e===1?Brt(l,44,n):Nrt(l,44,n),o}function Drt(n,e){for(var t=n.length+e.length,i=new Float32Array(t),r=0,s=0;r<t;)i[r++]=n[s],i[r++]=e[s],s++;return i}function Nrt(n,e,t){for(var i=0;i<t.length;i++,e+=4)n.setFloat32(e,t[i],!0)}function Brt(n,e,t){for(var i=0;i<t.length;i++,e+=2){var r=Math.max(-1,Math.min(1,t[i]));n.setInt16(e,r<0?r*32768:r*32767,!0)}}function uN(n,e,t){for(var i=0;i<t.length;i++)n.setUint8(e+i,t.charCodeAt(i))}const zb=(n="test-canvas",e)=>{let{contextType:t="2d",pixelated:i=!1,pixelRatio:r=window.devicePixelRatio}={},s=document.querySelector("#"+n);if(!s){s=document.createElement("canvas"),s.id=n,s.width=window.innerWidth*r,s.height=window.innerHeight*r,s.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",i&&(s.style.imageRendering="pixelated"),document.body.prepend(s);let a;window.addEventListener("resize",()=>{a&&clearTimeout(a),a=setTimeout(()=>{s.width=window.innerWidth*r,s.height=window.innerHeight*r},200)})}return s.getContext(t,{willReadFrequently:!0})};let Ew={};function Frt(n){Ew[n]!==void 0&&(cancelAnimationFrame(Ew[n]),delete Ew[n])}let Rg={};pn.prototype.draw=function(n,e){if(typeof window>"u")return this;let{id:t=1,lookbehind:i=0,lookahead:r=0}=e,s=Math.max(rz(),0);Frt(t),i=Math.abs(i),Rg[t]=(Rg[t]||[]).filter(u=>!u.isInFuture(s));let a=this.queryArc(s,s+r).filter(u=>u.hasOnset());Rg[t]=Rg[t].concat(a);let o;const l=()=>{const u=rz(),c=u+r;Rg[t]=Rg[t].filter(m=>m.isInNearPast(i,u));let d=Math.max(o||c,c-1/10);const f=this.queryArc(d,c).filter(m=>m.hasOnset());Rg[t]=Rg[t].concat(f),o=c,n(Rg[t],u,c,this),Ew[t]=requestAnimationFrame(l)};return Ew[t]=requestAnimationFrame(l),this};pn.prototype.onPaint=function(n){return this.withState(e=>(e.controls.painters||(e.controls.painters=[]),e.controls.painters.push(n),e))};pn.prototype.getPainters=function(){let n=[];return this.queryArc(0,0,{painters:n}),n};let Lrt={background:"#222",foreground:"#75baff",caret:"#ffcc00",selection:"rgba(128, 203, 196, 0.5)",selectionMatch:"#036dd626",lineHighlight:"#00000050",gutterBackground:"transparent",gutterForeground:"#8a919966"};function s0(){return Lrt}let r$="#22222210";pn.prototype.animate=function({callback:n,sync:e=!1,smear:t=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const i=zb();let{clientWidth:r,clientHeight:s}=i.canvas;r*=window.devicePixelRatio,s*=window.devicePixelRatio;let a=t===0?"99":Number((1-t)*100).toFixed(0);a=a.length===1?`0${a}`:a,r$=`#200010${a}`;const o=l=>{let u;l=Math.round(l),u=this.slow(1e3).queryArc(l,l),i.fillStyle=r$,i.fillRect(0,0,r,s),u.forEach(c=>{let{x:d,y:f,w:m,h:y,s:_,r:S,angle:b=0,fill:M="darkseagreen"}=c.value;if(m*=r,y*=s,S!==void 0&&b!==void 0){const T=b*2*Math.PI,[E,R]=[(r-m)/2,(s-y)/2];d=E+Math.cos(T)*S*E,f=R+Math.sin(T)*S*R}else d*=r-m,f*=s-y;const w={...c.value,x:d,y:f,w:m,h:y};i.fillStyle=M,_==="rect"?i.fillRect(d,f,m,y):_==="ellipse"&&(i.beginPath(),i.ellipse(d+m/2,f+y/2,m/2,y/2,0,0,2*Math.PI),i.fill()),n&&n(i,w,c)}),window.frame=requestAnimationFrame(o)};return window.frame=requestAnimationFrame(o),ws};const{x:Ixe,y:vgt,w:xgt,h:bgt,angle:_gt,r:Sgt,fill:Mgt,smear:Agt}=v6("x","y","w","h","angle","r","fill","smear");Nt("rescale",function(n,e){return e.mul(Ixe(n).w(n).y(n).h(n))});Nt("moveXY",function(n,e,t){return t.add(Ixe(n).y(e))});Nt("zoomIn",function(n,e){const t=$s(1).sub(n).div(2);return e.rescale(n).move(t,t)});const IC=(n,e,t)=>n*(t-e)+e,s$=n=>{let{value:e}=n;typeof n.value!="object"&&(e={value:e});let{note:t,n:i,freq:r,s}=e;if(r)return i6(r);if(t=t??i,typeof t=="string")try{return Rm(t)}catch{return 0}return typeof t=="number"?t:s?"_"+s:e};pn.prototype.pianoroll=function(n={}){let{cycles:e=4,playhead:t=.5,overscan:i=0,hideNegative:r=!1,ctx:s=zb(),id:a=1}=n,o=-e*t,l=e*(1-t);const u=(c,d)=>(!r||c.whole.begin>=0)&&c.isWithinTime(d+o,d+l);return this.draw((c,d)=>{Gxe({...n,time:d,ctx:s,haps:c.filter(f=>u(f,d))})},{lookbehind:o-i,lookahead:l+i,id:a}),this};function Gxe({time:n,haps:e,cycles:t=4,playhead:i=.5,flipTime:r=0,flipValues:s=0,hideNegative:a=!1,inactive:o=s0().foreground,active:l=s0().foreground,background:u="transparent",smear:c=0,playheadColor:d=s0().foreground,minMidi:f=10,maxMidi:m=90,autorange:y=0,timeframe:_,fold:S=1,vertical:b=0,labels:M=!1,fill:w=1,fillActive:T=!1,strokeActive:E=!0,stroke:R,hideInactive:P=0,colorizeInactive:I=1,fontFamily:B,ctx:N,id:U}={}){const V=N.canvas.width,W=N.canvas.height;let K=-t*i,q=t*(1-i);U&&(e=e.filter(ft=>ft.hasTag(U))),_&&(console.warn("timeframe is deprecated! use from/to instead"),K=0,q=_);const j=b?W:V,te=b?V:W;let he=b?[j,0]:[0,j];const _e=q-K,Be=b?[0,te]:[te,0];let ue=m-f+1,ce=te/ue,Ce=[];r&&he.reverse(),s&&Be.reverse();const{min:Oe,max:nt,values:Ae}=e.reduce(({min:ft,max:ze,values:ot},ut)=>{const Wt=s$(ut);return{min:Wt<ft?Wt:ft,max:Wt>ze?Wt:ze,values:ot.includes(Wt)?ot:[...ot,Wt]}},{min:1/0,max:-1/0,values:[]});y&&(f=Oe,m=nt,ue=m-f+1),Ce=Ae.sort((ft,ze)=>typeof ft=="number"&&typeof ze=="number"?ft-ze:typeof ft=="number"?1:String(ft).localeCompare(String(ze))),ce=S?te/Ce.length:te/ue,N.fillStyle=u,N.globalAlpha=1,c||(N.clearRect(0,0,V,W),N.fillRect(0,0,V,W)),e.forEach(ft=>{const ze=ft.whole.begin<=n&&ft.endClipped>n;let ot=R??(E&&ze),ut=!ze&&w||ze&&T;if(P&&!ze)return;let Wt=ft.value?.color;l=Wt||l,o=I&&Wt||o,Wt=ze?l:o,N.fillStyle=ut?Wt:"transparent",N.strokeStyle=Wt;const{velocity:It=1,gain:ke=1}=ft.value||{};N.globalAlpha=It*ke;const je=(ft.whole.begin-(r?q:K))/_e,gt=IC(je,...he);let yt=IC(ft.duration/_e,0,j);const ve=s$(ft),An=S?Ce.indexOf(ve)/Ce.length:(Number(ve)-f)/ue,cn=IC(An,...Be);let In=0;const Zt=IC(n/_e,...he);let le;if(b?le=[cn+1-(s?ce:0),j-Zt+gt+In+1-(r?0:yt),ce-2,yt-2]:le=[gt-Zt+In+1-(r?yt:0),cn+1-(s?0:ce),yt-2,ce-2],ot&&N.strokeRect(...le),ut&&N.fillRect(...le),M){const ee=ft.value.note??ft.value.s+(ft.value.n?`:${ft.value.n}`:""),{label:Re,activeLabel:tt}=ft.value,et=(ze&&tt||Re)??ee;let at=b?yt:ce*.75;N.font=`${at}px ${B||"monospace"}`,N.fillStyle=ut?"black":Wt,N.textBaseline="top",N.fillText(et,...le)}}),N.globalAlpha=1;const Ye=IC(-K/_e,...he);return N.strokeStyle=d,N.beginPath(),b?(N.moveTo(0,Ye),N.lineTo(te,Ye)):(N.moveTo(Ye,0),N.lineTo(Ye,te)),N.stroke(),this}function Irt(n,e={}){let[t,i]=n;t=Math.abs(t);const r=i+t,s=r!==0?t/r:0;return{fold:1,...e,cycles:r,playhead:s}}const Grt=(n={})=>(e,t,i,r)=>Gxe({ctx:e,time:t,haps:i,...Irt(r,n)});pn.prototype.punchcard=function(n){return this.onPaint(Grt(n))};pn.prototype.wordfall=function(n){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...n})};function Ort(n,e,t,i){const r=(n-90)*Math.PI/180;return[t+Math.cos(r)*e,i+Math.sin(r)*e]}const a$=(n,e,t,i,r=0)=>Ort((n+r)*360,e*n,t,i);function o$(n){let{ctx:e,from:t=0,to:i=3,margin:r=50,cx:s=100,cy:a=100,rotate:o=0,thickness:l=r/2,color:u=s0().foreground,cap:c="round",stretch:d=1,fromOpacity:f=1,toOpacity:m=1}=n;t*=d,i*=d,o*=d,e.lineWidth=l,e.lineCap=c,e.strokeStyle=u,e.globalAlpha=f,e.beginPath();let[y,_]=a$(t,r,s,a,o);e.moveTo(y,_);const S=1/60;let b=t;for(;b<=i;){const[M,w]=a$(b,r,s,a,o);e.globalAlpha=(b-t)/(i-t)*m,e.lineTo(M,w),b+=S}e.stroke()}function Urt(n){let{stretch:e=1,size:t=80,thickness:i=t/2,cap:r="butt",inset:s=3,playheadColor:a="#ffffff",playheadLength:o=.02,playheadThickness:l=i,padding:u=0,steady:c=1,activeColor:d=s0().foreground,inactiveColor:f=s0().gutterForeground,colorizeInactive:m=0,fade:y=!0,ctx:_,time:S,haps:b,drawTime:M,id:w}=n;w&&(b=b.filter(V=>V.hasTag(w)));const[T,E]=[_.canvas.width,_.canvas.height];_.clearRect(0,0,T*2,E*2);const[R,P]=[T/2,E/2],I={margin:t/e,cx:R,cy:P,stretch:e,cap:r,thickness:i},B={...I,thickness:l,from:s-o,to:s,color:a},[N]=M,U=c*S;b.forEach(V=>{const W=V.whole.begin<=S&&V.endClipped>S,K=V.whole.begin-S+s,q=V.endClipped-S+s-u,j=V.value?.color||d,te=m||W?j:f,he=y?1-Math.abs((V.whole.begin-S)/N):1;o$({ctx:_,...I,from:K,to:q,rotate:U,color:te,fromOpacity:he,toOpacity:he})}),o$({ctx:_,...B,rotate:U})}pn.prototype.spiral=function(n={}){return this.onPaint((e,t,i,r)=>Urt({ctx:e,time:t,haps:i,drawTime:r,...n}))};const krt=EM(36),l$=(n,e,t,i)=>{i=i*Math.PI*2;const r=Math.sin(i)*t+n,s=Math.cos(i)*t+e;return[r,s]},u$=(n,e)=>.5-Math.log2(n/e)%1;function zrt({haps:n,ctx:e,id:t,hapcircles:i=1,circle:r=0,edo:s=12,root:a=krt,thickness:o=3,hapRadius:l=6,mode:u="flake",margin:c=10}={}){const d=u==="polygon",f=u==="flake",m=e.canvas.width,y=e.canvas.height;e.clearRect(0,0,m,y);const _=s0().foreground,S=Math.min(m,y)/2-o/2-l-c,b=m/2,M=y/2;t&&(n=n.filter(T=>T.hasTag(t))),e.strokeStyle=_,e.fillStyle=_,e.globalAlpha=1,e.lineWidth=o,r&&(e.beginPath(),e.arc(b,M,S,0,2*Math.PI),e.stroke()),s&&(Array.from({length:s},(T,E)=>{const R=u$(a*Math.pow(2,E/s),a),[P,I]=l$(b,M,S,R);e.beginPath(),e.arc(P,I,l,0,2*Math.PI),e.fill()}),e.stroke());let w=[];e.lineWidth=l,n.forEach(T=>{let E;try{E=ece(T)}catch{return}const R=u$(E,a),[P,I]=l$(b,M,S,R),B=T.value.color||_;e.strokeStyle=B,e.fillStyle=B;const{velocity:N=1,gain:U=1}=T.value||{},V=N*U;e.globalAlpha=V,w.push([P,I,R,B,V]),e.beginPath(),i&&(e.moveTo(P+l,I),e.arc(P,I,l,0,2*Math.PI),e.fill()),f&&(e.moveTo(b,M),e.lineTo(P,I)),e.stroke()}),e.strokeStyle=_,e.globalAlpha=1,d&&w.length&&(w=w.sort((T,E)=>T[2]-E[2]),e.beginPath(),e.moveTo(w[0][0],w[0][1]),w.forEach(([T,E,R,P,I])=>{e.strokeStyle=P,e.globalAlpha=I,e.lineTo(T,E)}),e.lineTo(w[0][0],w[0][1]),e.stroke())}pn.prototype.pitchwheel=function(n={}){let{ctx:e=zb(),id:t=1}=n;return this.tag(t).onPaint((i,r,s)=>zrt({...n,ctx:e,haps:s.filter(a=>a.isActive(r)),id:t}))};function Oxe(n,{align:e=!0,color:t="white",thickness:i=3,scale:r=.25,pos:s=.75,trigger:a=0,ctx:o=zb(),id:l=1}={}){o.lineWidth=i,o.strokeStyle=t;let u=o.canvas;if(!n){o.beginPath();let _=s*u.height;o.moveTo(0,_),o.lineTo(u.width,_),o.stroke();return}const c=OL("time",l);o.beginPath();const d=n.frequencyBinCount;let f=e?Array.from(c).findIndex((_,S,b)=>S&&b[S-1]>-a&&_<=-a):0;f=Math.max(f,0);const m=u.width*1/d;let y=0;for(let _=f;_<d;_++){const S=c[_]+1,b=(s-r*(S-1))*u.height;_===0?o.moveTo(y,b):o.lineTo(y,b),y+=m}o.stroke()}function Uxe(n,{color:e="white",scale:t=.25,pos:i=.75,lean:r=.5,min:s=-150,max:a=0,ctx:o=zb(),id:l=1}={}){if(!n){o.beginPath();let y=i*c.height;o.moveTo(0,y),o.lineTo(c.width,y),o.stroke();return}const u=OL("frequency",l),c=o.canvas;o.fillStyle=e;const d=n.frequencyBinCount,f=c.width*1/d;let m=0;for(let y=0;y<d;y++){const _=EL((u[y]-s)/(a-s),0,1)*t,S=_*c.height,b=(i-_*r)*c.height;o.fillRect(m,b,Math.max(f,1),S),m+=f}}function kxe(n=0,e="0,0,0",t=zb()){n?(t.fillStyle=`rgba(${e},${1-n})`,t.fillRect(0,0,t.canvas.width,t.canvas.height)):t.clearRect(0,0,t.canvas.width,t.canvas.height)}pn.prototype.fscope=function(n={}){let e=n.id??1;return this.analyze(e).draw(()=>{kxe(n.smear,"0,0,0",n.ctx),mu[e]&&Uxe(mu[e],n)},{id:e})};pn.prototype.tscope=function(n={}){let e=n.id??1;return this.analyze(e).draw(t=>{n.color=t[0]?.value?.color||s0().foreground,n.color,kxe(n.smear,"0,0,0",n.ctx),Oxe(mu[e],n)},{id:e})};pn.prototype.scope=pn.prototype.tscope;let c$={};pn.prototype.spectrum=function(n={}){let e=n.id??1;return this.analyze(e).draw(t=>{n.color=t[0]?.value?.color||c$[e]||s0().foreground,c$[e]=n.color,Vrt(mu[e],n)},{id:e})};pn.prototype.scope=pn.prototype.tscope;const EU=new Map;function Vrt(n,{thickness:e=3,speed:t=1,min:i=-80,max:r=0,ctx:s=zb(),id:a=1,color:o}={}){if(s.lineWidth=e,s.strokeStyle=o,!n)return;const l=t,u=OL("frequency",a),c=s.canvas;s.fillStyle=o;const d=n.frequencyBinCount;let f=EU.get(a)||s.getImageData(0,0,c.width,c.height);EU.set(a,f),s.clearRect(0,0,s.canvas.width,s.canvas.height),s.putImageData(f,-l,0);let m=c.width-t;for(let y=0;y<d;y++){const _=EL((u[y]-i)/(r-i),0,1);s.globalAlpha=_;const S=Math.log(y+1)/Math.log(d)*c.height;s.fillRect(m,c.height-S,l,2)}EU.set(a,s.getImageData(0,0,c.width,c.height))}const Hrt=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_MAX_POLYPHONY:Z6,Warpmode:fz,aliasBank:nrt,get analysers(){return mu},get analysersData(){return zx},applyFM:TE,applyGainCurve:Jp,applyParameterModulators:hz,cleanupOnEnd:K1e,connectBusModulator:q1e,connectEnvelope:J1e,connectLFO:$1e,connectToDestination:Sxe,createFilter:H1e,distortionAlgorithms:U6,dough:xrt,doughTrigger:Dxe,doughsamples:Nxe,drawFrequencyScope:Uxe,drawTimeScope:Oxe,drywet:X1e,dspWorklet:Rxe,effectSend:AE,errorLogger:ME,gainNode:Ys,getADSRValues:yh,getAnalyserById:Mxe,getAnalyzerData:OL,getAudioContext:Qi,getAudioContextCurrentTime:rit,getAudioDevices:gxe,getCachedBuffer:Uit,getCompressor:V1e,getDefaultValue:Ya,getDistortion:Y1e,getDistortionAlgorithm:wit,getEnvelope:z1e,getFrequencyFromValue:Jy,getLfo:xA,getLoadedBuffer:zit,getOscillator:wxe,getParamADSR:gh,getParamLfo:O6,getPitchEnvelope:DM,getSampleBuffer:exe,getSampleBufferSource:txe,getSampleInfo:Q1e,getSound:Dx,getSuperdoughAudioController:GL,getVibratoOscillator:NM,getWorklet:Yu,getZZFX:Exe,initAudio:J6,initAudioOnFirstClick:_xe,loadBuffer:c2,loadWorklets:bxe,logger:To,get maxPolyphony(){return j6},get multiChannelOrbits(){return Y6},noises:G6,onTriggerSample:oxe,onTriggerSynth:dxe,onceEnded:Dm,processSampleMap:sxe,registerSampleSource:lxe,registerSamplesPrefix:Vit,registerSound:Nf,registerSynthSounds:Txe,registerWaveTable:W6,registerWorklet:xxe,registerZZFXSounds:vrt,releaseAudioNode:Zr,renderPatternAudio:Ert,resetDefaultValues:yxe,resetDefaults:art,resetGlobalEffects:Axe,resetLoadedSounds:urt,resetSeenKeys:cxe,reverseBuffer:nxe,samples:X6,scheduleAtTime:yit,setAudioContext:u2,setDefault:srt,setDefaultAudioContext:N1e,setDefaultValue:$6,setDefaultValues:ort,setGainCurve:ert,setLogger:F1e,setMaxPolyphony:fxe,setMultiChannelOrbits:pxe,setSuperdoughAudioController:yz,setVersionDefaults:lrt,soundAlias:irt,soundMap:Hf,superdough:UL,superdoughTrigger:frt,tables:Qit,waveformN:Cxe,webAudioTimeout:tm,webaudioOutput:Fxe,webaudioRepl:Lxe},Symbol.toStringTag,{value:"Module"}));function Xrt(n,e){function t(){this.constructor=n}t.prototype=e.prototype,n.prototype=new t}function yb(n,e,t,i){var r=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(r,yb.prototype),r.expected=e,r.found=t,r.location=i,r.name="SyntaxError",r}Xrt(yb,Error);function RU(n,e,t){return t=t||" ",n.length>e?n:(e-=n.length,t+=t.repeat(e),n+t.slice(0,e))}yb.prototype.format=function(n){var e="Error: "+this.message;if(this.location){var t=null,i;for(i=0;i<n.length;i++)if(n[i].source===this.location.source){t=n[i].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,s=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(r):r,a=this.location.source+":"+s.line+":"+s.column;if(t){var o=this.location.end,l=RU("",s.line.toString().length," "),u=t[r.line-1],c=r.line===o.line?o.column:u.length+1,d=c-r.column||1;e+=`
 --> `+a+`
`+l+` |
`+s.line+" | "+u+`
`+l+" | "+RU("",r.column-1," ")+RU("",d,"^")}else e+=`
 at `+a}return e};yb.buildMessage=function(n,e){var t={literal:function(u){return'"'+r(u.text)+'"'},class:function(u){var c=u.parts.map(function(d){return Array.isArray(d)?s(d[0])+"-"+s(d[1]):s(d)});return"["+(u.inverted?"^":"")+c.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(u){return u.description}};function i(u){return u.charCodeAt(0).toString(16).toUpperCase()}function r(u){return u.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(c){return"\\x0"+i(c)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(c){return"\\x"+i(c)})}function s(u){return u.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(c){return"\\x0"+i(c)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(c){return"\\x"+i(c)})}function a(u){return t[u.type](u)}function o(u){var c=u.map(a),d,f;if(c.sort(),c.length>0){for(d=1,f=1;d<c.length;d++)c[d-1]!==c[d]&&(c[f]=c[d],f++);c.length=f}switch(c.length){case 1:return c[0];case 2:return c[0]+" or "+c[1];default:return c.slice(0,-1).join(", ")+", or "+c[c.length-1]}}function l(u){return u?'"'+r(u)+'"':"end of input"}return"Expected "+o(n)+" but "+l(e)+" found."};function zxe(n,e){e=e!==void 0?e:{};var t={},i=e.grammarSource,r={start:Ro},s=Ro,a=".",o="-",l="0",u=",",c="|",d="[",f="]",m="{",y="}",_="%",S="<",b=">",M="!",w="(",T=")",E="/",R="*",P="?",I=":",B="..",N="^",U="struct",V="target",W="euclid",K="slow",q="rotL",j="rotR",te="fast",he="scale",_e="//",Be="cat",ue="$",ce="setcps",Ce="setbpm",Oe="hush",nt=/^[1-9]/,Ae=/^[eE]/,Ye=/^[+\-]/,ft=/^[0-9]/,ze=/^[ \n\r\t\xA0]/,ot=/^["']/,ut=/^[#\--.0-9A-Z\^-_a-z~\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376-\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4-\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u09FC\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60-\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E46\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7B9\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD-\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5-\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,Wt=/^[@_]/,It=/^[^\n]/,ke=Jc("number"),je=Ui(".",!1),gt=Pl([["1","9"]],!1,!1),yt=Pl(["e","E"],!1,!1),ve=Pl(["+","-"],!1,!1),An=Ui("-",!1),cn=Ui("0",!1),In=Pl([["0","9"]],!1,!1),Zt=Jc("whitespace"),le=Pl([" ",`
`,"\r","	",""],!1,!1),ee=Ui(",",!1),Re=Ui("|",!1),tt=Pl(['"',"'"],!1,!1),et=Jc('a letter, a number, "-", "#", ".", "^", "_"'),at=Pl(["#",["-","."],["0","9"],["A","Z"],["^","_"],["a","z"],"~","","","",["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],"","",["",""],"",["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],"","",["",""],["",""],"",["",""],["",""],"",["",""],"","","",["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],"","",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],"","",["",""],["",""],["",""],"",["",""],"",["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],"",["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","","",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],"","",["",""],"",["",""],"","","",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"",["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""]],!1,!1),jt=Ui("[",!1),rn=Ui("]",!1),Nn=Ui("{",!1),Fn=Ui("}",!1),Gt=Ui("%",!1),st=Ui("<",!1),Ft=Ui(">",!1),Se=Pl(["@","_"],!1,!1),Je=Ui("!",!1),St=Ui("(",!1),Ne=Ui(")",!1),it=Ui("/",!1),kt=Ui("*",!1),vn=Ui("?",!1),Kt=Ui(":",!1),Ut=Ui("..",!1),z=Ui("^",!1),se=Ui("struct",!1),ne=Ui("target",!1),ae=Ui("euclid",!1),be=Ui("slow",!1),pt=Ui("rotL",!1),Bt=Ui("rotR",!1),tn=Ui("fast",!1),Tn=Ui("scale",!1),yi=Ui("//",!1),er=Pl([`
`],!0,!1),Vi=Ui("cat",!1),Zn=Ui("$",!1),Xs=Ui("setcps",!1),es=Ui("setbpm",!1),ie=Ui("hush",!1),ye=function(){return parseFloat(uc())},Ue=function(Y){const xe=Y.join("");return xe==="."||xe==="_"},dt=function(Y){return new Bs(Y.join(""))},Ct=function(Y){return Y},wt=function(Y,xe){return Y.arguments_.stepsPerCycle=xe,Y},sn=function(Y){return Y},Qt=function(Y){return Y.arguments_.alignment="polymeter_slowcat",Y},on=function(Y){return xe=>xe.options_.weight=(xe.options_.weight??1)+(Y??2)-1},ln=function(Y){return xe=>{const Pe=(xe.options_.reps??1)+(Y??2)-1;xe.options_.reps=Pe,xe.options_.ops=xe.options_.ops.filter(Ot=>Ot.type_!=="replicate"),xe.options_.ops.push({type_:"replicate",arguments_:{amount:Pe}}),xe.options_.weight=Pe}},gn=function(Y,xe,Pe){return Ot=>Ot.options_.ops.push({type_:"bjorklund",arguments_:{pulse:Y,step:xe,rotation:Pe}})},fn=function(Y){return xe=>xe.options_.ops.push({type_:"stretch",arguments_:{amount:Y,type:"slow"}})},de=function(Y){return xe=>xe.options_.ops.push({type_:"stretch",arguments_:{amount:Y,type:"fast"}})},Fe=function(Y){return xe=>xe.options_.ops.push({type_:"degradeBy",arguments_:{amount:Y,seed:Do++}})},$e=function(Y){return xe=>xe.options_.ops.push({type_:"tail",arguments_:{element:Y}})},Ke=function(Y){return xe=>xe.options_.ops.push({type_:"range",arguments_:{element:Y}})},Ze=function(Y,xe){const Pe=new mr(Y,{ops:[],weight:1,reps:1});for(const Ot of xe)Ot(Pe);return Pe},zt=function(Y,xe){return new no(xe,"fastcat",void 0,!!Y)},Jt=function(Y){return{alignment:"stack",list:Y}},Vt=function(Y){return{alignment:"rand",list:Y,seed:Do++}},Rn=function(Y){return{alignment:"feet",list:Y,seed:Do++}},yn=function(Y,xe){return xe&&xe.list.length>0?new no([Y,...xe.list],xe.alignment,xe.seed):Y},jn=function(Y,xe){return new no(xe?[Y,...xe.list]:[Y],"polymeter")},bn=function(Y){return Y},zn=function(Y){return{name:"struct",args:{mini:Y}}},Bi=function(Y){return{name:"target",args:{name:Y}}},_r=function(Y,xe,Pe){return{name:"bjorklund",args:{pulse:Y,step:parseInt(xe)}}},Oi=function(Y){return{name:"stretch",args:{amount:Y}}},On=function(Y){return{name:"shift",args:{amount:"-"+Y}}},qt=function(Y){return{name:"shift",args:{amount:Y}}},ei=function(Y){return{name:"stretch",args:{amount:"1/"+Y}}},Bn=function(Y){return{name:"scale",args:{scale:Y.join("")}}},tr=function(Y,xe){return xe},qs=function(Y,xe){return xe.unshift(Y),new no(xe,"slowcat")},Wi=function(Y){return Y},Ss=function(Y,xe){return new ca(Y.name,Y.args,xe)},Lr=function(Y){return Y},Qs=function(Y){return Y},Ws=function(Y){return new ns("setcps",{value:Y})},Zs=function(Y){return new ns("setcps",{value:Y/120/2})},la=function(){return new ns("hush")},Te=e.peg$currPos|0,ai=Te,$c=[{line:1,column:1}],jo=Te,lc=e.peg$maxFailExpected||[],$n=e.peg$silentFails|0,ql;if(e.startRule){if(!(e.startRule in r))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');s=r[e.startRule]}function uc(){return n.substring(ai,Te)}function cc(){return Yo(ai,Te)}function Ui(Y,xe){return{type:"literal",text:Y,ignoreCase:xe}}function Pl(Y,xe,Pe){return{type:"class",parts:Y,inverted:xe,ignoreCase:Pe}}function op(){return{type:"end"}}function Jc(Y){return{type:"other",description:Y}}function hc(Y){var xe=$c[Y],Pe;if(xe)return xe;if(Y>=$c.length)Pe=$c.length-1;else for(Pe=Y;!$c[--Pe];);for(xe=$c[Pe],xe={line:xe.line,column:xe.column};Pe<Y;)n.charCodeAt(Pe)===10?(xe.line++,xe.column=1):xe.column++,Pe++;return $c[Y]=xe,xe}function Yo(Y,xe,Pe){var Ot=hc(Y),li=hc(xe),Yr={source:i,start:{offset:Y,line:Ot.line,column:Ot.column},end:{offset:xe,line:li.line,column:li.column}};return Yr}function ni(Y){Te<jo||(Te>jo&&(jo=Te,lc=[]),lc.push(Y))}function to(Y,xe,Pe){return new yb(yb.buildMessage(Y,xe),Y,xe,Pe)}function Ro(){var Y;return Y=Sr(),Y}function al(){var Y,xe;return $n++,Y=Te,Ql(),xe=ua(),xe!==t?(Qc(),fc(),ai=Y,Y=ye()):(Te=Y,Y=t),$n--,Y===t&&$n===0&&ni(ke),Y}function dc(){var Y;return n.charCodeAt(Te)===46?(Y=a,Te++):(Y=t,$n===0&&ni(je)),Y}function Ih(){var Y;return Y=n.charAt(Te),nt.test(Y)?Te++:(Y=t,$n===0&&ni(gt)),Y}function qc(){var Y;return Y=n.charAt(Te),Ae.test(Y)?Te++:(Y=t,$n===0&&ni(yt)),Y}function fc(){var Y,xe,Pe,Ot,li;if(Y=Te,xe=qc(),xe!==t){if(Pe=n.charAt(Te),Ye.test(Pe)?Te++:(Pe=t,$n===0&&ni(ve)),Pe===t&&(Pe=null),Ot=[],li=ol(),li!==t)for(;li!==t;)Ot.push(li),li=ol();else Ot=t;Ot!==t?(xe=[xe,Pe,Ot],Y=xe):(Te=Y,Y=t)}else Te=Y,Y=t;return Y}function Qc(){var Y,xe,Pe,Ot;if(Y=Te,xe=dc(),xe!==t){if(Pe=[],Ot=ol(),Ot!==t)for(;Ot!==t;)Pe.push(Ot),Ot=ol();else Pe=t;Pe!==t?(xe=[xe,Pe],Y=xe):(Te=Y,Y=t)}else Te=Y,Y=t;return Y}function ua(){var Y,xe,Pe,Ot;if(Y=Qd(),Y===t)if(Y=Te,xe=Ih(),xe!==t){for(Pe=[],Ot=ol();Ot!==t;)Pe.push(Ot),Ot=ol();xe=[xe,Pe],Y=xe}else Te=Y,Y=t;return Y}function Ql(){var Y;return n.charCodeAt(Te)===45?(Y=o,Te++):(Y=t,$n===0&&ni(An)),Y}function Qd(){var Y;return n.charCodeAt(Te)===48?(Y=l,Te++):(Y=t,$n===0&&ni(cn)),Y}function ol(){var Y;return Y=n.charAt(Te),ft.test(Y)?Te++:(Y=t,$n===0&&ni(In)),Y}function ci(){var Y,xe;for($n++,Y=[],xe=n.charAt(Te),ze.test(xe)?Te++:(xe=t,$n===0&&ni(le));xe!==t;)Y.push(xe),xe=n.charAt(Te),ze.test(xe)?Te++:(xe=t,$n===0&&ni(le));return $n--,xe=t,$n===0&&ni(Zt),Y}function Dl(){var Y,xe,Pe,Ot;return Y=Te,xe=ci(),n.charCodeAt(Te)===44?(Pe=u,Te++):(Pe=t,$n===0&&ni(ee)),Pe!==t?(Ot=ci(),xe=[xe,Pe,Ot],Y=xe):(Te=Y,Y=t),Y}function Gh(){var Y,xe,Pe,Ot;return Y=Te,xe=ci(),n.charCodeAt(Te)===124?(Pe=c,Te++):(Pe=t,$n===0&&ni(Re)),Pe!==t?(Ot=ci(),xe=[xe,Pe,Ot],Y=xe):(Te=Y,Y=t),Y}function eh(){var Y,xe,Pe,Ot;return Y=Te,xe=ci(),n.charCodeAt(Te)===46?(Pe=a,Te++):(Pe=t,$n===0&&ni(je)),Pe!==t?(Ot=ci(),xe=[xe,Pe,Ot],Y=xe):(Te=Y,Y=t),Y}function ll(){var Y;return Y=n.charAt(Te),ot.test(Y)?Te++:(Y=t,$n===0&&ni(tt)),Y}function Eu(){var Y;return $n++,Y=n.charAt(Te),ut.test(Y)?Te++:(Y=t,$n===0&&ni(at)),$n--,Y===t&&$n===0&&ni(et),Y}function lp(){var Y,xe,Pe,Ot;if(Y=Te,ci(),xe=[],Pe=Eu(),Pe!==t)for(;Pe!==t;)xe.push(Pe),Pe=Eu();else xe=t;return xe!==t?(Pe=ci(),ai=Te,Ot=Ue(xe),Ot?Ot=t:Ot=void 0,Ot!==t?(ai=Y,Y=dt(xe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function D0(){var Y,xe,Pe,Ot;return Y=Te,ci(),n.charCodeAt(Te)===91?(xe=d,Te++):(xe=t,$n===0&&ni(jt)),xe!==t?(ci(),Pe=Ym(),Pe!==t?(ci(),n.charCodeAt(Te)===93?(Ot=f,Te++):(Ot=t,$n===0&&ni(rn)),Ot!==t?(ci(),ai=Y,Y=Ct(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function up(){var Y,xe,Pe,Ot,li;return Y=Te,ci(),n.charCodeAt(Te)===123?(xe=m,Te++):(xe=t,$n===0&&ni(Nn)),xe!==t?(ci(),Pe=Km(),Pe!==t?(ci(),n.charCodeAt(Te)===125?(Ot=y,Te++):(Ot=t,$n===0&&ni(Fn)),Ot!==t?(li=ef(),li===t&&(li=null),ci(),ai=Y,Y=wt(Pe,li)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function ef(){var Y,xe,Pe;return Y=Te,n.charCodeAt(Te)===37?(xe=_,Te++):(xe=t,$n===0&&ni(Gt)),xe!==t?(Pe=th(),Pe!==t?(ai=Y,Y=sn(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function Hm(){var Y,xe,Pe,Ot;return Y=Te,ci(),n.charCodeAt(Te)===60?(xe=S,Te++):(xe=t,$n===0&&ni(st)),xe!==t?(ci(),Pe=Km(),Pe!==t?(ci(),n.charCodeAt(Te)===62?(Ot=b,Te++):(Ot=t,$n===0&&ni(Ft)),Ot!==t?(ci(),ai=Y,Y=Qt(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function th(){var Y;return Y=lp(),Y===t&&(Y=D0(),Y===t&&(Y=up(),Y===t&&(Y=Hm()))),Y}function cp(){var Y;return Y=Xm(),Y===t&&(Y=hp(),Y===t&&(Y=dp(),Y===t&&(Y=N0(),Y===t&&(Y=tf(),Y===t&&(Y=Wm(),Y===t&&(Y=Zm(),Y===t&&(Y=fp()))))))),Y}function Xm(){var Y,xe,Pe;return Y=Te,ci(),xe=n.charAt(Te),Wt.test(xe)?Te++:(xe=t,$n===0&&ni(Se)),xe!==t?(Pe=al(),Pe===t&&(Pe=null),ai=Y,Y=on(Pe)):(Te=Y,Y=t),Y}function tf(){var Y,xe,Pe;return Y=Te,ci(),n.charCodeAt(Te)===33?(xe=M,Te++):(xe=t,$n===0&&ni(Je)),xe!==t?(Pe=al(),Pe===t&&(Pe=null),ai=Y,Y=ln(Pe)):(Te=Y,Y=t),Y}function hp(){var Y,xe,Pe,Ot,li,Yr,eu;return Y=Te,n.charCodeAt(Te)===40?(xe=w,Te++):(xe=t,$n===0&&ni(St)),xe!==t?(ci(),Pe=pc(),Pe!==t?(ci(),Ot=Dl(),Ot!==t?(ci(),li=pc(),li!==t?(ci(),Dl(),ci(),Yr=pc(),Yr===t&&(Yr=null),ci(),n.charCodeAt(Te)===41?(eu=T,Te++):(eu=t,$n===0&&ni(Ne)),eu!==t?(ai=Y,Y=gn(Pe,li,Yr)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function dp(){var Y,xe,Pe;return Y=Te,n.charCodeAt(Te)===47?(xe=E,Te++):(xe=t,$n===0&&ni(it)),xe!==t?(Pe=th(),Pe!==t?(ai=Y,Y=fn(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function N0(){var Y,xe,Pe;return Y=Te,n.charCodeAt(Te)===42?(xe=R,Te++):(xe=t,$n===0&&ni(kt)),xe!==t?(Pe=th(),Pe!==t?(ai=Y,Y=de(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function Wm(){var Y,xe,Pe;return Y=Te,n.charCodeAt(Te)===63?(xe=P,Te++):(xe=t,$n===0&&ni(vn)),xe!==t?(Pe=al(),Pe===t&&(Pe=null),ai=Y,Y=Fe(Pe)):(Te=Y,Y=t),Y}function Zm(){var Y,xe,Pe;return Y=Te,n.charCodeAt(Te)===58?(xe=I,Te++):(xe=t,$n===0&&ni(Kt)),xe!==t?(Pe=th(),Pe!==t?(ai=Y,Y=$e(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function fp(){var Y,xe,Pe;return Y=Te,n.substr(Te,2)===B?(xe=B,Te+=2):(xe=t,$n===0&&ni(Ut)),xe!==t?(Pe=th(),Pe!==t?(ai=Y,Y=Ke(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function pc(){var Y,xe,Pe,Ot;if(Y=Te,xe=th(),xe!==t){for(Pe=[],Ot=cp();Ot!==t;)Pe.push(Ot),Ot=cp();ai=Y,Y=Ze(xe,Pe)}else Te=Y,Y=t;return Y}function Po(){var Y,xe,Pe,Ot;if(Y=Te,n.charCodeAt(Te)===94?(xe=N,Te++):(xe=t,$n===0&&ni(z)),xe===t&&(xe=null),Pe=[],Ot=pc(),Ot!==t)for(;Ot!==t;)Pe.push(Ot),Ot=pc();else Pe=t;return Pe!==t?(ai=Y,Y=zt(xe,Pe)):(Te=Y,Y=t),Y}function nf(){var Y,xe,Pe,Ot,li;if(Y=Te,xe=[],Pe=Te,Ot=Dl(),Ot!==t?(li=Po(),li!==t?Pe=li:(Te=Pe,Pe=t)):(Te=Pe,Pe=t),Pe!==t)for(;Pe!==t;)xe.push(Pe),Pe=Te,Ot=Dl(),Ot!==t?(li=Po(),li!==t?Pe=li:(Te=Pe,Pe=t)):(Te=Pe,Pe=t);else xe=t;return xe!==t&&(ai=Y,xe=Jt(xe)),Y=xe,Y}function jm(){var Y,xe,Pe,Ot,li;if(Y=Te,xe=[],Pe=Te,Ot=Gh(),Ot!==t?(li=Po(),li!==t?Pe=li:(Te=Pe,Pe=t)):(Te=Pe,Pe=t),Pe!==t)for(;Pe!==t;)xe.push(Pe),Pe=Te,Ot=Gh(),Ot!==t?(li=Po(),li!==t?Pe=li:(Te=Pe,Pe=t)):(Te=Pe,Pe=t);else xe=t;return xe!==t&&(ai=Y,xe=Vt(xe)),Y=xe,Y}function Oh(){var Y,xe,Pe,Ot,li;if(Y=Te,xe=[],Pe=Te,Ot=eh(),Ot!==t?(li=Po(),li!==t?Pe=li:(Te=Pe,Pe=t)):(Te=Pe,Pe=t),Pe!==t)for(;Pe!==t;)xe.push(Pe),Pe=Te,Ot=eh(),Ot!==t?(li=Po(),li!==t?Pe=li:(Te=Pe,Pe=t)):(Te=Pe,Pe=t);else xe=t;return xe!==t&&(ai=Y,xe=Rn(xe)),Y=xe,Y}function Ym(){var Y,xe,Pe;return Y=Te,xe=Po(),xe!==t?(Pe=nf(),Pe===t&&(Pe=jm(),Pe===t&&(Pe=Oh())),Pe===t&&(Pe=null),ai=Y,Y=yn(xe,Pe)):(Te=Y,Y=t),Y}function Km(){var Y,xe,Pe;return Y=Te,xe=Po(),xe!==t?(Pe=nf(),Pe===t&&(Pe=null),ai=Y,Y=jn(xe,Pe)):(Te=Y,Y=t),Y}function u1(){var Y,xe,Pe,Ot;return Y=Te,ci(),xe=ll(),xe!==t?(ci(),Pe=Ym(),Pe!==t?(ci(),Ot=ll(),Ot!==t?(ai=Y,Y=bn(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function wa(){var Y;return Y=Ee(),Y===t&&(Y=J(),Y===t&&(Y=De(),Y===t&&(Y=F(),Y===t&&(Y=H(),Y===t&&(Y=$m(),Y===t&&(Y=Me(),Y===t&&(Y=oe()))))))),Y}function $m(){var Y,xe,Pe;return Y=Te,n.substr(Te,6)===U?(xe=U,Te+=6):(xe=t,$n===0&&ni(se)),xe!==t?(ci(),Pe=Cn(),Pe!==t?(ai=Y,Y=zn(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function F(){var Y,xe,Pe,Ot,li;return Y=Te,n.substr(Te,6)===V?(xe=V,Te+=6):(xe=t,$n===0&&ni(ne)),xe!==t?(ci(),Pe=ll(),Pe!==t?(Ot=lp(),Ot!==t?(li=ll(),li!==t?(ai=Y,Y=Bi(Ot)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function H(){var Y,xe,Pe,Ot;return Y=Te,n.substr(Te,6)===W?(xe=W,Te+=6):(xe=t,$n===0&&ni(ae)),xe!==t?(ci(),Pe=ua(),Pe!==t?(ci(),Ot=ua(),Ot!==t?(ci(),ua(),ai=Y,Y=_r(Pe,Ot)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function J(){var Y,xe,Pe;return Y=Te,n.substr(Te,4)===K?(xe=K,Te+=4):(xe=t,$n===0&&ni(be)),xe!==t?(ci(),Pe=al(),Pe!==t?(ai=Y,Y=Oi(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function oe(){var Y,xe,Pe;return Y=Te,n.substr(Te,4)===q?(xe=q,Te+=4):(xe=t,$n===0&&ni(pt)),xe!==t?(ci(),Pe=al(),Pe!==t?(ai=Y,Y=On(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function Me(){var Y,xe,Pe;return Y=Te,n.substr(Te,4)===j?(xe=j,Te+=4):(xe=t,$n===0&&ni(Bt)),xe!==t?(ci(),Pe=al(),Pe!==t?(ai=Y,Y=qt(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function De(){var Y,xe,Pe;return Y=Te,n.substr(Te,4)===te?(xe=te,Te+=4):(xe=t,$n===0&&ni(tn)),xe!==t?(ci(),Pe=al(),Pe!==t?(ai=Y,Y=ei(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function Ee(){var Y,xe,Pe,Ot,li;if(Y=Te,n.substr(Te,5)===he?(xe=he,Te+=5):(xe=t,$n===0&&ni(Tn)),xe!==t)if(ci(),Pe=ll(),Pe!==t){if(Ot=[],li=Eu(),li!==t)for(;li!==t;)Ot.push(li),li=Eu();else Ot=t;Ot!==t?(li=ll(),li!==t?(ai=Y,Y=Bn(Ot)):(Te=Y,Y=t)):(Te=Y,Y=t)}else Te=Y,Y=t;else Te=Y,Y=t;return Y}function qe(){var Y,xe,Pe,Ot;if(Y=Te,n.substr(Te,2)===_e?(xe=_e,Te+=2):(xe=t,$n===0&&ni(yi)),xe!==t){for(Pe=[],Ot=n.charAt(Te),It.test(Ot)?Te++:(Ot=t,$n===0&&ni(er));Ot!==t;)Pe.push(Ot),Ot=n.charAt(Te),It.test(Ot)?Te++:(Ot=t,$n===0&&ni(er));xe=[xe,Pe],Y=xe}else Te=Y,Y=t;return Y}function bt(){var Y,xe,Pe,Ot,li,Yr,eu,rf;if(Y=Te,n.substr(Te,3)===Be?(xe=Be,Te+=3):(xe=t,$n===0&&ni(Vi)),xe!==t)if(ci(),n.charCodeAt(Te)===91?(Pe=d,Te++):(Pe=t,$n===0&&ni(jt)),Pe!==t)if(ci(),Ot=Cn(),Ot!==t){for(li=[],Yr=Te,eu=Dl(),eu!==t?(rf=Cn(),rf!==t?(ai=Yr,Yr=tr(Ot,rf)):(Te=Yr,Yr=t)):(Te=Yr,Yr=t);Yr!==t;)li.push(Yr),Yr=Te,eu=Dl(),eu!==t?(rf=Cn(),rf!==t?(ai=Yr,Yr=tr(Ot,rf)):(Te=Yr,Yr=t)):(Te=Yr,Yr=t);Yr=ci(),n.charCodeAt(Te)===93?(eu=f,Te++):(eu=t,$n===0&&ni(rn)),eu!==t?(ai=Y,Y=qs(Ot,li)):(Te=Y,Y=t)}else Te=Y,Y=t;else Te=Y,Y=t;else Te=Y,Y=t;return Y}function un(){var Y;return Y=bt(),Y===t&&(Y=u1()),Y}function Cn(){var Y,xe,Pe,Ot,li;if(Y=Te,xe=un(),xe!==t){for(ci(),Pe=[],Ot=qe();Ot!==t;)Pe.push(Ot),Ot=qe();ai=Y,Y=Wi(xe)}else Te=Y,Y=t;return Y===t&&(Y=Te,xe=wa(),xe!==t?(ci(),n.charCodeAt(Te)===36?(Pe=ue,Te++):(Pe=t,$n===0&&ni(Zn)),Pe!==t?(Ot=ci(),li=Cn(),li!==t?(ai=Y,Y=Ss(xe,li)):(Te=Y,Y=t)):(Te=Y,Y=t)):(Te=Y,Y=t)),Y}function fi(){var Y,xe;return Y=Te,xe=Cn(),xe!==t&&(ai=Y,xe=Lr(xe)),Y=xe,Y===t&&(Y=qe()),Y}function oi(){var Y;return Y=fi(),Y}function Gn(){var Y,xe;return Y=Te,ci(),xe=vi(),xe===t&&(xe=Hi(),xe===t&&(xe=ts())),xe!==t?(ci(),ai=Y,Y=Qs(xe)):(Te=Y,Y=t),Y}function vi(){var Y,xe,Pe;return Y=Te,n.substr(Te,6)===ce?(xe=ce,Te+=6):(xe=t,$n===0&&ni(Xs)),xe!==t?(ci(),Pe=al(),Pe!==t?(ai=Y,Y=Ws(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function Hi(){var Y,xe,Pe;return Y=Te,n.substr(Te,6)===Ce?(xe=Ce,Te+=6):(xe=t,$n===0&&ni(es)),xe!==t?(ci(),Pe=al(),Pe!==t?(ai=Y,Y=Zs(Pe)):(Te=Y,Y=t)):(Te=Y,Y=t),Y}function ts(){var Y,xe;return Y=Te,n.substr(Te,4)===Oe?(xe=Oe,Te+=4):(xe=t,$n===0&&ni(ie)),xe!==t&&(ai=Y,xe=la()),Y=xe,Y}function Sr(){var Y;return Y=oi(),Y===t&&(Y=Gn()),Y}var Bs=function(Y){this.type_="atom",this.source_=Y,this.location_=cc()},no=function(Y,xe,Pe,Ot){this.type_="pattern",this.arguments_={alignment:xe,_steps:Ot},Pe!==void 0&&(this.arguments_.seed=Pe),this.source_=Y},ca=function(Y,xe,Pe){this.type_=Y,this.arguments_=xe,this.source_=Pe},mr=function(Y,xe){this.type_="element",this.source_=Y,this.options_=xe,this.location_=cc()},ns=function(Y,xe){this.type_="command",this.name_=Y,this.options_=xe},Do=0;if(ql=s(),e.peg$library)return{peg$result:ql,peg$currPos:Te,peg$FAILED:t,peg$maxFailExpected:lc,peg$maxFailPos:jo};if(ql!==t&&Te===n.length)return ql;throw ql!==t&&Te<n.length&&ni(op()),to(lc,jo<n.length?n.charAt(jo):null,jo<n.length?Yo(jo,jo+1):Yo(jo,jo))}const Wrt=["start"],Vxe=3e-4,Zrt=(n,e)=>(t,i)=>{const r=n.source_[i].options_?.ops,s=t.__steps_source;if(r)for(const a of r)switch(a.type_){case"stretch":{const o=["fast","slow"],{type:l,amount:u}=a.arguments_;if(!o.includes(l))throw new Error(`mini: stretch: type must be one of ${o.join("|")} but got ${l}`);t=xn(t)[l](e(u));break}case"replicate":{const{amount:o}=a.arguments_;t=xn(t),t=t._repeatCycles(o)._fast(o);break}case"bjorklund":{a.arguments_.rotation?t=t.euclidRot(e(a.arguments_.pulse),e(a.arguments_.step),e(a.arguments_.rotation)):t=t.euclid(e(a.arguments_.pulse),e(a.arguments_.step));break}case"degradeBy":{t=xn(t)._degradeByWith(rc.early(Vxe*a.arguments_.seed),a.arguments_.amount??.5);break}case"tail":{const o=e(a.arguments_.element);t=t.fmap(l=>u=>Array.isArray(l)?[...l,u]:[l,u]).appLeft(o);break}case"range":{const o=e(a.arguments_.element);t=xn(t);const l=(u,c,d=1)=>Array.from({length:Math.abs(c-u)/d+1},(f,m)=>u<c?u+m*d:u-m*d);t=((u,c)=>u.squeezeBind(d=>c.bind(f=>wu(...l(d,f)))))(t,o);break}default:console.warn(`operator "${a.type_}" not implemented`)}return t.__steps_source=t.__steps_source||s,t};function bA(n,e,t,i=0){t?.(n);const r=s=>bA(s,e,t,i);switch(n.type_){case"pattern":{const s=n.source_.map(u=>r(u)).map(Zrt(n,r)),a=n.arguments_.alignment,o=s.filter(u=>u.__steps_source);let l;switch(a){case"stack":{l=Ma(...s),o.length&&(l._steps=zf(...o.map(u=>Sn(u._steps))));break}case"polymeter_slowcat":{l=Ma(...s.map(u=>u._slow(u.__weight))),o.length&&(l._steps=zf(...o.map(u=>Sn(u._steps))));break}case"polymeter":{const u=n.arguments_.stepsPerCycle?r(n.arguments_.stepsPerCycle).fmap(d=>Sn(d)):$s(Sn(s.length>0?s[0].__weight:1)),c=s.map(d=>d.fast(u.fmap(f=>f.div(d.__weight))));l=Ma(...c);break}case"rand":{l=LL(rc.early(Vxe*n.arguments_.seed).segment(1),s),o.length&&(l._steps=zf(...o.map(u=>Sn(u._steps))));break}case"feet":{l=wu(...s);break}default:{if(n.source_.some(u=>!!u.options_?.weight)){const u=n.source_.reduce((c,d)=>c.add(d.options_?.weight||Sn(1)),Sn(0));l=p6(...n.source_.map((c,d)=>[c.options_?.weight||Sn(1),s[d]])),l.__weight=u,l._steps=u,o.length&&(l._steps=l._steps.mul(zf(...o.map(c=>Sn(c._steps)))))}else l=ep(...s),l._steps=s.length;n.arguments_._steps&&(l.__steps_source=!0)}}return o.length&&(l.__steps_source=!0),l}case"element":return r(n.source_);case"atom":{if(n.source_==="~"||n.source_==="-")return ws;if(!n.location_)return console.warn("no location for",n),n.source_;const s=isNaN(Number(n.source_))?n.source_:Number(n.source_);if(i===-1)return $s(s);const[a,o]=q6(e,n,i);return $s(s).withLoc(a,o)}case"stretch":return r(n.source_).slow(r(n.arguments_.amount));default:return console.warn(`node type "${n.type_}" not implemented -> returning silence`),ws}}const q6=(n,e,t=0)=>{const{start:i,end:r}=e.location_,s=n?.split("").slice(i.offset,r.offset).join(""),[a=0,o=0]=s?s.split(e.source_).map(l=>l.split("").filter(u=>u===" ").length):[];return[i.offset+a+t,r.offset-o+t]},n3=(n,e=0,t=n)=>{try{return zxe(n)}catch(i){const r=[i.location.start.offset+e,i.location.end.offset+e],s=t.slice(0,r[0]).split(`
`).length;throw new Error(`[mini] parse error at line ${s}: ${i.message}`)}},Hxe=(n,e,t)=>{const i=n3(n,e,t);let r=[];return bA(i,n,s=>{s.type_==="atom"&&r.push(s)},-1),r},Q6=(n,e=0,t)=>Hxe(n,e,t).map(i=>q6(n,i,e)),e8=(...n)=>{const e=n.map(t=>{const i=`"${t}"`,r=n3(i);return bA(r,i)});return ep(...e)},jrt=(n,e)=>{const t=`"${n}"`,i=n3(t);return bA(i,t,null,e)},Yrt=n=>{const e=n3(n);return bA(e,n)};function Krt(n){return typeof n=="string"?e8(n):xn(n)}function Xxe(){pce(e8)}const $rt=Object.freeze(Object.defineProperty({__proto__:null,StartRules:Wrt,SyntaxError:yb,getLeafLocation:q6,getLeafLocations:Q6,getLeaves:Hxe,h:Yrt,m:jrt,mini:e8,mini2ast:n3,miniAllStrings:Xxe,minify:Krt,parse:zxe,patternifyAST:bA},Symbol.toStringTag,{value:"Module"}));var Jrt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],Wxe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],qrt="-----------------------------------------------------------------------------------------------------------------------------------------------------",Zxe="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",PU={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},DU="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Qrt={5:DU,"5module":DU+" export import",6:DU+" const class extends export import super"},est=/^in(stanceof)?$/,tst=new RegExp("["+Zxe+"]"),nst=new RegExp("["+Zxe+qrt+"]");function xz(n,e){for(var t=65536,i=0;i<e.length;i+=2){if(t+=e[i],t>n)return!1;if(t+=e[i+1],t>=n)return!0}return!1}function y0(n,e){return n<65?n===36:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&tst.test(String.fromCharCode(n)):e===!1?!1:xz(n,Wxe)}function BM(n,e){return n<48?n===36:n<58?!0:n<65?!1:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&nst.test(String.fromCharCode(n)):e===!1?!1:xz(n,Wxe)||xz(n,Jrt)}var as=function(n,e){e===void 0&&(e={}),this.label=n,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null};function cd(n,e){return new as(n,{beforeExpr:!0,binop:e})}var hd={beforeExpr:!0},Fc={startsExpr:!0},t8={};function $r(n,e){return e===void 0&&(e={}),e.keyword=n,t8[n]=new as(n,e)}var me={num:new as("num",Fc),regexp:new as("regexp",Fc),string:new as("string",Fc),name:new as("name",Fc),privateId:new as("privateId",Fc),eof:new as("eof"),bracketL:new as("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new as("]"),braceL:new as("{",{beforeExpr:!0,startsExpr:!0}),braceR:new as("}"),parenL:new as("(",{beforeExpr:!0,startsExpr:!0}),parenR:new as(")"),comma:new as(",",hd),semi:new as(";",hd),colon:new as(":",hd),dot:new as("."),question:new as("?",hd),questionDot:new as("?."),arrow:new as("=>",hd),template:new as("template"),invalidTemplate:new as("invalidTemplate"),ellipsis:new as("...",hd),backQuote:new as("`",Fc),dollarBraceL:new as("${",{beforeExpr:!0,startsExpr:!0}),eq:new as("=",{beforeExpr:!0,isAssign:!0}),assign:new as("_=",{beforeExpr:!0,isAssign:!0}),incDec:new as("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new as("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:cd("||",1),logicalAND:cd("&&",2),bitwiseOR:cd("|",3),bitwiseXOR:cd("^",4),bitwiseAND:cd("&",5),equality:cd("==/!=/===/!==",6),relational:cd("</>/<=/>=",7),bitShift:cd("<</>>/>>>",8),plusMin:new as("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:cd("%",10),star:cd("*",10),slash:cd("/",10),starstar:new as("**",{beforeExpr:!0}),coalesce:cd("??",1),_break:$r("break"),_case:$r("case",hd),_catch:$r("catch"),_continue:$r("continue"),_debugger:$r("debugger"),_default:$r("default",hd),_do:$r("do",{isLoop:!0,beforeExpr:!0}),_else:$r("else",hd),_finally:$r("finally"),_for:$r("for",{isLoop:!0}),_function:$r("function",Fc),_if:$r("if"),_return:$r("return",hd),_switch:$r("switch"),_throw:$r("throw",hd),_try:$r("try"),_var:$r("var"),_const:$r("const"),_while:$r("while",{isLoop:!0}),_with:$r("with"),_new:$r("new",{beforeExpr:!0,startsExpr:!0}),_this:$r("this",Fc),_super:$r("super",Fc),_class:$r("class",Fc),_extends:$r("extends",hd),_export:$r("export"),_import:$r("import",Fc),_null:$r("null",Fc),_true:$r("true",Fc),_false:$r("false",Fc),_in:$r("in",{beforeExpr:!0,binop:7}),_instanceof:$r("instanceof",{beforeExpr:!0,binop:7}),_typeof:$r("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:$r("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:$r("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Jd=/\r\n?|\n|\u2028|\u2029/,ist=new RegExp(Jd.source,"g");function _A(n){return n===10||n===13||n===8232||n===8233}function jxe(n,e,t){t===void 0&&(t=n.length);for(var i=e;i<t;i++){var r=n.charCodeAt(i);if(_A(r))return i<t-1&&r===13&&n.charCodeAt(i+1)===10?i+2:i+1}return-1}var Yxe=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,vd=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Kxe=Object.prototype,rst=Kxe.hasOwnProperty,sst=Kxe.toString,SA=Object.hasOwn||function(n,e){return rst.call(n,e)},h$=Array.isArray||function(n){return sst.call(n)==="[object Array]"},d$=Object.create(null);function qy(n){return d$[n]||(d$[n]=new RegExp("^(?:"+n.replace(/ /g,"|")+")$"))}function v0(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}var ast=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,CE=function(n,e){this.line=n,this.column=e};CE.prototype.offset=function(n){return new CE(this.line,this.column+n)};var kL=function(n,e,t){this.start=e,this.end=t,n.sourceFile!==null&&(this.source=n.sourceFile)};function $xe(n,e){for(var t=1,i=0;;){var r=jxe(n,i,e);if(r<0)return new CE(t,e-i);++t,i=r}}var bz={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},f$=!1;function ost(n){var e={};for(var t in bz)e[t]=n&&SA(n,t)?n[t]:bz[t];if(e.ecmaVersion==="latest"?e.ecmaVersion=1e8:e.ecmaVersion==null?(!f$&&typeof console=="object"&&console.warn&&(f$=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),e.ecmaVersion=11):e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),e.allowReserved==null&&(e.allowReserved=e.ecmaVersion<5),(!n||n.allowHashBang==null)&&(e.allowHashBang=e.ecmaVersion>=14),h$(e.onToken)){var i=e.onToken;e.onToken=function(r){return i.push(r)}}return h$(e.onComment)&&(e.onComment=lst(e,e.onComment)),e}function lst(n,e){return function(t,i,r,s,a,o){var l={type:t?"Block":"Line",value:i,start:r,end:s};n.locations&&(l.loc=new kL(this,a,o)),n.ranges&&(l.range=[r,s]),e.push(l)}}var wE=1,MA=2,n8=4,Jxe=8,qxe=16,Qxe=32,i8=64,ebe=128,i3=256,r8=wE|MA|i3;function s8(n,e){return MA|(n?n8:0)|(e?Jxe:0)}var h2=0,a8=1,P0=2,tbe=3,nbe=4,ibe=5,il=function(n,e,t){this.options=n=ost(n),this.sourceFile=n.sourceFile,this.keywords=qy(Qrt[n.ecmaVersion>=6?6:n.sourceType==="module"?"5module":5]);var i="";n.allowReserved!==!0&&(i=PU[n.ecmaVersion>=6?6:n.ecmaVersion===5?5:3],n.sourceType==="module"&&(i+=" await")),this.reservedWords=qy(i);var r=(i?i+" ":"")+PU.strict;this.reservedWordsStrict=qy(r),this.reservedWordsStrictBind=qy(r+" "+PU.strictBind),this.input=String(e),this.containsEsc=!1,t?(this.pos=t,this.lineStart=this.input.lastIndexOf(`
`,t-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Jd).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=me.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=n.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&n.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(wE),this.regexpState=null,this.privateNameStack=[]},zm={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};il.prototype.parse=function(){var n=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(n)};zm.inFunction.get=function(){return(this.currentVarScope().flags&MA)>0};zm.inGenerator.get=function(){return(this.currentVarScope().flags&Jxe)>0&&!this.currentVarScope().inClassFieldInit};zm.inAsync.get=function(){return(this.currentVarScope().flags&n8)>0&&!this.currentVarScope().inClassFieldInit};zm.canAwait.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var e=this.scopeStack[n];if(e.inClassFieldInit||e.flags&i3)return!1;if(e.flags&MA)return(e.flags&n8)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction};zm.allowSuper.get=function(){var n=this.currentThisScope(),e=n.flags,t=n.inClassFieldInit;return(e&i8)>0||t||this.options.allowSuperOutsideMethod};zm.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ebe)>0};zm.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())};zm.allowNewDotTarget.get=function(){var n=this.currentThisScope(),e=n.flags,t=n.inClassFieldInit;return(e&(MA|i3))>0||t};zm.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&i3)>0};il.extend=function(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];for(var t=this,i=0;i<n.length;i++)t=n[i](t);return t};il.parse=function(n,e){return new this(e,n).parse()};il.parseExpressionAt=function(n,e,t){var i=new this(t,n,e);return i.nextToken(),i.parseExpression()};il.tokenizer=function(n,e){return new this(e,n)};Object.defineProperties(il.prototype,zm);var ac=il.prototype,ust=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;ac.strictDirective=function(n){if(this.options.ecmaVersion<5)return!1;for(;;){vd.lastIndex=n,n+=vd.exec(this.input)[0].length;var e=ust.exec(this.input.slice(n));if(!e)return!1;if((e[1]||e[2])==="use strict"){vd.lastIndex=n+e[0].length;var t=vd.exec(this.input),i=t.index+t[0].length,r=this.input.charAt(i);return r===";"||r==="}"||Jd.test(t[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(r)||r==="!"&&this.input.charAt(i+1)==="=")}n+=e[0].length,vd.lastIndex=n,n+=vd.exec(this.input)[0].length,this.input[n]===";"&&n++}};ac.eat=function(n){return this.type===n?(this.next(),!0):!1};ac.isContextual=function(n){return this.type===me.name&&this.value===n&&!this.containsEsc};ac.eatContextual=function(n){return this.isContextual(n)?(this.next(),!0):!1};ac.expectContextual=function(n){this.eatContextual(n)||this.unexpected()};ac.canInsertSemicolon=function(){return this.type===me.eof||this.type===me.braceR||Jd.test(this.input.slice(this.lastTokEnd,this.start))};ac.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};ac.semicolon=function(){!this.eat(me.semi)&&!this.insertSemicolon()&&this.unexpected()};ac.afterTrailingComma=function(n,e){if(this.type===n)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0};ac.expect=function(n){this.eat(n)||this.unexpected()};ac.unexpected=function(n){this.raise(n??this.start,"Unexpected token")};var zL=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};ac.checkPatternErrors=function(n,e){if(n){n.trailingComma>-1&&this.raiseRecoverable(n.trailingComma,"Comma is not permitted after the rest element");var t=e?n.parenthesizedAssign:n.parenthesizedBind;t>-1&&this.raiseRecoverable(t,e?"Assigning to rvalue":"Parenthesized pattern")}};ac.checkExpressionErrors=function(n,e){if(!n)return!1;var t=n.shorthandAssign,i=n.doubleProto;if(!e)return t>=0||i>=0;t>=0&&this.raise(t,"Shorthand property assignments are valid only in destructuring patterns"),i>=0&&this.raiseRecoverable(i,"Redefinition of __proto__ property")};ac.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")};ac.isSimpleAssignTarget=function(n){return n.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(n.expression):n.type==="Identifier"||n.type==="MemberExpression"};var gi=il.prototype;gi.parseTopLevel=function(n){var e=Object.create(null);for(n.body||(n.body=[]);this.type!==me.eof;){var t=this.parseStatement(null,!0,e);n.body.push(t)}if(this.inModule)for(var i=0,r=Object.keys(this.undefinedExports);i<r.length;i+=1){var s=r[i];this.raiseRecoverable(this.undefinedExports[s].start,"Export '"+s+"' is not defined")}return this.adaptDirectivePrologue(n.body),this.next(),n.sourceType=this.options.sourceType,this.finishNode(n,"Program")};var o8={kind:"loop"},cst={kind:"switch"};gi.isLet=function(n){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;vd.lastIndex=this.pos;var e=vd.exec(this.input),t=this.pos+e[0].length,i=this.input.charCodeAt(t);if(i===91||i===92)return!0;if(n)return!1;if(i===123||i>55295&&i<56320)return!0;if(y0(i,!0)){for(var r=t+1;BM(i=this.input.charCodeAt(r),!0);)++r;if(i===92||i>55295&&i<56320)return!0;var s=this.input.slice(t,r);if(!est.test(s))return!0}return!1};gi.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;vd.lastIndex=this.pos;var n=vd.exec(this.input),e=this.pos+n[0].length,t;return!Jd.test(this.input.slice(this.pos,e))&&this.input.slice(e,e+8)==="function"&&(e+8===this.input.length||!(BM(t=this.input.charCodeAt(e+8))||t>55295&&t<56320))};gi.parseStatement=function(n,e,t){var i=this.type,r=this.startNode(),s;switch(this.isLet(n)&&(i=me._var,s="let"),i){case me._break:case me._continue:return this.parseBreakContinueStatement(r,i.keyword);case me._debugger:return this.parseDebuggerStatement(r);case me._do:return this.parseDoStatement(r);case me._for:return this.parseForStatement(r);case me._function:return n&&(this.strict||n!=="if"&&n!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(r,!1,!n);case me._class:return n&&this.unexpected(),this.parseClass(r,!0);case me._if:return this.parseIfStatement(r);case me._return:return this.parseReturnStatement(r);case me._switch:return this.parseSwitchStatement(r);case me._throw:return this.parseThrowStatement(r);case me._try:return this.parseTryStatement(r);case me._const:case me._var:return s=s||this.value,n&&s!=="var"&&this.unexpected(),this.parseVarStatement(r,s);case me._while:return this.parseWhileStatement(r);case me._with:return this.parseWithStatement(r);case me.braceL:return this.parseBlock(!0,r);case me.semi:return this.parseEmptyStatement(r);case me._export:case me._import:if(this.options.ecmaVersion>10&&i===me._import){vd.lastIndex=this.pos;var a=vd.exec(this.input),o=this.pos+a[0].length,l=this.input.charCodeAt(o);if(l===40||l===46)return this.parseExpressionStatement(r,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===me._import?this.parseImport(r):this.parseExport(r,t);default:if(this.isAsyncFunction())return n&&this.unexpected(),this.next(),this.parseFunctionStatement(r,!0,!n);var u=this.value,c=this.parseExpression();return i===me.name&&c.type==="Identifier"&&this.eat(me.colon)?this.parseLabeledStatement(r,u,c,n):this.parseExpressionStatement(r,c)}};gi.parseBreakContinueStatement=function(n,e){var t=e==="break";this.next(),this.eat(me.semi)||this.insertSemicolon()?n.label=null:this.type!==me.name?this.unexpected():(n.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){var r=this.labels[i];if((n.label==null||r.name===n.label.name)&&(r.kind!=null&&(t||r.kind==="loop")||n.label&&t))break}return i===this.labels.length&&this.raise(n.start,"Unsyntactic "+e),this.finishNode(n,t?"BreakStatement":"ContinueStatement")};gi.parseDebuggerStatement=function(n){return this.next(),this.semicolon(),this.finishNode(n,"DebuggerStatement")};gi.parseDoStatement=function(n){return this.next(),this.labels.push(o8),n.body=this.parseStatement("do"),this.labels.pop(),this.expect(me._while),n.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(me.semi):this.semicolon(),this.finishNode(n,"DoWhileStatement")};gi.parseForStatement=function(n){this.next();var e=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(o8),this.enterScope(0),this.expect(me.parenL),this.type===me.semi)return e>-1&&this.unexpected(e),this.parseFor(n,null);var t=this.isLet();if(this.type===me._var||this.type===me._const||t){var i=this.startNode(),r=t?"let":this.value;return this.next(),this.parseVar(i,!0,r),this.finishNode(i,"VariableDeclaration"),(this.type===me._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&i.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===me._in?e>-1&&this.unexpected(e):n.await=e>-1),this.parseForIn(n,i)):(e>-1&&this.unexpected(e),this.parseFor(n,i))}var s=this.isContextual("let"),a=!1,o=this.containsEsc,l=new zL,u=this.start,c=e>-1?this.parseExprSubscripts(l,"await"):this.parseExpression(!0,l);return this.type===me._in||(a=this.options.ecmaVersion>=6&&this.isContextual("of"))?(e>-1?(this.type===me._in&&this.unexpected(e),n.await=!0):a&&this.options.ecmaVersion>=8&&(c.start===u&&!o&&c.type==="Identifier"&&c.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(n.await=!1)),s&&a&&this.raise(c.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(c,!1,l),this.checkLValPattern(c),this.parseForIn(n,c)):(this.checkExpressionErrors(l,!0),e>-1&&this.unexpected(e),this.parseFor(n,c))};gi.parseFunctionStatement=function(n,e,t){return this.next(),this.parseFunction(n,Rw|(t?0:_z),!1,e)};gi.parseIfStatement=function(n){return this.next(),n.test=this.parseParenExpression(),n.consequent=this.parseStatement("if"),n.alternate=this.eat(me._else)?this.parseStatement("if"):null,this.finishNode(n,"IfStatement")};gi.parseReturnStatement=function(n){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(me.semi)||this.insertSemicolon()?n.argument=null:(n.argument=this.parseExpression(),this.semicolon()),this.finishNode(n,"ReturnStatement")};gi.parseSwitchStatement=function(n){this.next(),n.discriminant=this.parseParenExpression(),n.cases=[],this.expect(me.braceL),this.labels.push(cst),this.enterScope(0);for(var e,t=!1;this.type!==me.braceR;)if(this.type===me._case||this.type===me._default){var i=this.type===me._case;e&&this.finishNode(e,"SwitchCase"),n.cases.push(e=this.startNode()),e.consequent=[],this.next(),i?e.test=this.parseExpression():(t&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),t=!0,e.test=null),this.expect(me.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(n,"SwitchStatement")};gi.parseThrowStatement=function(n){return this.next(),Jd.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),n.argument=this.parseExpression(),this.semicolon(),this.finishNode(n,"ThrowStatement")};var hst=[];gi.parseCatchClauseParam=function(){var n=this.parseBindingAtom(),e=n.type==="Identifier";return this.enterScope(e?Qxe:0),this.checkLValPattern(n,e?nbe:P0),this.expect(me.parenR),n};gi.parseTryStatement=function(n){if(this.next(),n.block=this.parseBlock(),n.handler=null,this.type===me._catch){var e=this.startNode();this.next(),this.eat(me.parenL)?e.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0)),e.body=this.parseBlock(!1),this.exitScope(),n.handler=this.finishNode(e,"CatchClause")}return n.finalizer=this.eat(me._finally)?this.parseBlock():null,!n.handler&&!n.finalizer&&this.raise(n.start,"Missing catch or finally clause"),this.finishNode(n,"TryStatement")};gi.parseVarStatement=function(n,e,t){return this.next(),this.parseVar(n,!1,e,t),this.semicolon(),this.finishNode(n,"VariableDeclaration")};gi.parseWhileStatement=function(n){return this.next(),n.test=this.parseParenExpression(),this.labels.push(o8),n.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(n,"WhileStatement")};gi.parseWithStatement=function(n){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),n.object=this.parseParenExpression(),n.body=this.parseStatement("with"),this.finishNode(n,"WithStatement")};gi.parseEmptyStatement=function(n){return this.next(),this.finishNode(n,"EmptyStatement")};gi.parseLabeledStatement=function(n,e,t,i){for(var r=0,s=this.labels;r<s.length;r+=1){var a=s[r];a.name===e&&this.raise(t.start,"Label '"+e+"' is already declared")}for(var o=this.type.isLoop?"loop":this.type===me._switch?"switch":null,l=this.labels.length-1;l>=0;l--){var u=this.labels[l];if(u.statementStart===n.start)u.statementStart=this.start,u.kind=o;else break}return this.labels.push({name:e,kind:o,statementStart:this.start}),n.body=this.parseStatement(i?i.indexOf("label")===-1?i+"label":i:"label"),this.labels.pop(),n.label=t,this.finishNode(n,"LabeledStatement")};gi.parseExpressionStatement=function(n,e){return n.expression=e,this.semicolon(),this.finishNode(n,"ExpressionStatement")};gi.parseBlock=function(n,e,t){for(n===void 0&&(n=!0),e===void 0&&(e=this.startNode()),e.body=[],this.expect(me.braceL),n&&this.enterScope(0);this.type!==me.braceR;){var i=this.parseStatement(null);e.body.push(i)}return t&&(this.strict=!1),this.next(),n&&this.exitScope(),this.finishNode(e,"BlockStatement")};gi.parseFor=function(n,e){return n.init=e,this.expect(me.semi),n.test=this.type===me.semi?null:this.parseExpression(),this.expect(me.semi),n.update=this.type===me.parenR?null:this.parseExpression(),this.expect(me.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,"ForStatement")};gi.parseForIn=function(n,e){var t=this.type===me._in;return this.next(),e.type==="VariableDeclaration"&&e.declarations[0].init!=null&&(!t||this.options.ecmaVersion<8||this.strict||e.kind!=="var"||e.declarations[0].id.type!=="Identifier")&&this.raise(e.start,(t?"for-in":"for-of")+" loop variable declaration may not have an initializer"),n.left=e,n.right=t?this.parseExpression():this.parseMaybeAssign(),this.expect(me.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,t?"ForInStatement":"ForOfStatement")};gi.parseVar=function(n,e,t,i){for(n.declarations=[],n.kind=t;;){var r=this.startNode();if(this.parseVarId(r,t),this.eat(me.eq)?r.init=this.parseMaybeAssign(e):!i&&t==="const"&&!(this.type===me._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!i&&r.id.type!=="Identifier"&&!(e&&(this.type===me._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):r.init=null,n.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(me.comma))break}return n};gi.parseVarId=function(n,e){n.id=this.parseBindingAtom(),this.checkLValPattern(n.id,e==="var"?a8:P0,!1)};var Rw=1,_z=2,rbe=4;gi.parseFunction=function(n,e,t,i,r){this.initFunction(n),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!i)&&(this.type===me.star&&e&_z&&this.unexpected(),n.generator=this.eat(me.star)),this.options.ecmaVersion>=8&&(n.async=!!i),e&Rw&&(n.id=e&rbe&&this.type!==me.name?null:this.parseIdent(),n.id&&!(e&_z)&&this.checkLValSimple(n.id,this.strict||n.generator||n.async?this.treatFunctionsAsVar?a8:P0:tbe));var s=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(s8(n.async,n.generator)),e&Rw||(n.id=this.type===me.name?this.parseIdent():null),this.parseFunctionParams(n),this.parseFunctionBody(n,t,!1,r),this.yieldPos=s,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(n,e&Rw?"FunctionDeclaration":"FunctionExpression")};gi.parseFunctionParams=function(n){this.expect(me.parenL),n.params=this.parseBindingList(me.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};gi.parseClass=function(n,e){this.next();var t=this.strict;this.strict=!0,this.parseClassId(n,e),this.parseClassSuper(n);var i=this.enterClassBody(),r=this.startNode(),s=!1;for(r.body=[],this.expect(me.braceL);this.type!==me.braceR;){var a=this.parseClassElement(n.superClass!==null);a&&(r.body.push(a),a.type==="MethodDefinition"&&a.kind==="constructor"?(s&&this.raiseRecoverable(a.start,"Duplicate constructor in the same class"),s=!0):a.key&&a.key.type==="PrivateIdentifier"&&dst(i,a)&&this.raiseRecoverable(a.key.start,"Identifier '#"+a.key.name+"' has already been declared"))}return this.strict=t,this.next(),n.body=this.finishNode(r,"ClassBody"),this.exitClassBody(),this.finishNode(n,e?"ClassDeclaration":"ClassExpression")};gi.parseClassElement=function(n){if(this.eat(me.semi))return null;var e=this.options.ecmaVersion,t=this.startNode(),i="",r=!1,s=!1,a="method",o=!1;if(this.eatContextual("static")){if(e>=13&&this.eat(me.braceL))return this.parseClassStaticBlock(t),t;this.isClassElementNameStart()||this.type===me.star?o=!0:i="static"}if(t.static=o,!i&&e>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===me.star)&&!this.canInsertSemicolon()?s=!0:i="async"),!i&&(e>=9||!s)&&this.eat(me.star)&&(r=!0),!i&&!s&&!r){var l=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?a=l:i=l)}if(i?(t.computed=!1,t.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),t.key.name=i,this.finishNode(t.key,"Identifier")):this.parseClassElementName(t),e<13||this.type===me.parenL||a!=="method"||r||s){var u=!t.static&&d2(t,"constructor"),c=u&&n;u&&a!=="method"&&this.raise(t.key.start,"Constructor can't have get/set modifier"),t.kind=u?"constructor":a,this.parseClassMethod(t,r,s,c)}else this.parseClassField(t);return t};gi.isClassElementNameStart=function(){return this.type===me.name||this.type===me.privateId||this.type===me.num||this.type===me.string||this.type===me.bracketL||this.type.keyword};gi.parseClassElementName=function(n){this.type===me.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),n.computed=!1,n.key=this.parsePrivateIdent()):this.parsePropertyName(n)};gi.parseClassMethod=function(n,e,t,i){var r=n.key;n.kind==="constructor"?(e&&this.raise(r.start,"Constructor can't be a generator"),t&&this.raise(r.start,"Constructor can't be an async method")):n.static&&d2(n,"prototype")&&this.raise(r.start,"Classes may not have a static property named prototype");var s=n.value=this.parseMethod(e,t,i);return n.kind==="get"&&s.params.length!==0&&this.raiseRecoverable(s.start,"getter should have no params"),n.kind==="set"&&s.params.length!==1&&this.raiseRecoverable(s.start,"setter should have exactly one param"),n.kind==="set"&&s.params[0].type==="RestElement"&&this.raiseRecoverable(s.params[0].start,"Setter cannot use rest params"),this.finishNode(n,"MethodDefinition")};gi.parseClassField=function(n){if(d2(n,"constructor")?this.raise(n.key.start,"Classes can't have a field named 'constructor'"):n.static&&d2(n,"prototype")&&this.raise(n.key.start,"Classes can't have a static field named 'prototype'"),this.eat(me.eq)){var e=this.currentThisScope(),t=e.inClassFieldInit;e.inClassFieldInit=!0,n.value=this.parseMaybeAssign(),e.inClassFieldInit=t}else n.value=null;return this.semicolon(),this.finishNode(n,"PropertyDefinition")};gi.parseClassStaticBlock=function(n){n.body=[];var e=this.labels;for(this.labels=[],this.enterScope(i3|i8);this.type!==me.braceR;){var t=this.parseStatement(null);n.body.push(t)}return this.next(),this.exitScope(),this.labels=e,this.finishNode(n,"StaticBlock")};gi.parseClassId=function(n,e){this.type===me.name?(n.id=this.parseIdent(),e&&this.checkLValSimple(n.id,P0,!1)):(e===!0&&this.unexpected(),n.id=null)};gi.parseClassSuper=function(n){n.superClass=this.eat(me._extends)?this.parseExprSubscripts(null,!1):null};gi.enterClassBody=function(){var n={declared:Object.create(null),used:[]};return this.privateNameStack.push(n),n.declared};gi.exitClassBody=function(){var n=this.privateNameStack.pop(),e=n.declared,t=n.used;if(this.options.checkPrivateFields)for(var i=this.privateNameStack.length,r=i===0?null:this.privateNameStack[i-1],s=0;s<t.length;++s){var a=t[s];SA(e,a.name)||(r?r.used.push(a):this.raiseRecoverable(a.start,"Private field '#"+a.name+"' must be declared in an enclosing class"))}};function dst(n,e){var t=e.key.name,i=n[t],r="true";return e.type==="MethodDefinition"&&(e.kind==="get"||e.kind==="set")&&(r=(e.static?"s":"i")+e.kind),i==="iget"&&r==="iset"||i==="iset"&&r==="iget"||i==="sget"&&r==="sset"||i==="sset"&&r==="sget"?(n[t]="true",!1):i?!0:(n[t]=r,!1)}function d2(n,e){var t=n.computed,i=n.key;return!t&&(i.type==="Identifier"&&i.name===e||i.type==="Literal"&&i.value===e)}gi.parseExportAllDeclaration=function(n,e){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(n.exported=this.parseModuleExportName(),this.checkExport(e,n.exported,this.lastTokStart)):n.exported=null),this.expectContextual("from"),this.type!==me.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ExportAllDeclaration")};gi.parseExport=function(n,e){if(this.next(),this.eat(me.star))return this.parseExportAllDeclaration(n,e);if(this.eat(me._default))return this.checkExport(e,"default",this.lastTokStart),n.declaration=this.parseExportDefaultDeclaration(),this.finishNode(n,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())n.declaration=this.parseExportDeclaration(n),n.declaration.type==="VariableDeclaration"?this.checkVariableExport(e,n.declaration.declarations):this.checkExport(e,n.declaration.id,n.declaration.id.start),n.specifiers=[],n.source=null;else{if(n.declaration=null,n.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==me.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause());else{for(var t=0,i=n.specifiers;t<i.length;t+=1){var r=i[t];this.checkUnreserved(r.local),this.checkLocalExport(r.local),r.local.type==="Literal"&&this.raise(r.local.start,"A string literal cannot be used as an exported binding without `from`.")}n.source=null}this.semicolon()}return this.finishNode(n,"ExportNamedDeclaration")};gi.parseExportDeclaration=function(n){return this.parseStatement(null)};gi.parseExportDefaultDeclaration=function(){var n;if(this.type===me._function||(n=this.isAsyncFunction())){var e=this.startNode();return this.next(),n&&this.next(),this.parseFunction(e,Rw|rbe,!1,n)}else if(this.type===me._class){var t=this.startNode();return this.parseClass(t,"nullableID")}else{var i=this.parseMaybeAssign();return this.semicolon(),i}};gi.checkExport=function(n,e,t){n&&(typeof e!="string"&&(e=e.type==="Identifier"?e.name:e.value),SA(n,e)&&this.raiseRecoverable(t,"Duplicate export '"+e+"'"),n[e]=!0)};gi.checkPatternExport=function(n,e){var t=e.type;if(t==="Identifier")this.checkExport(n,e,e.start);else if(t==="ObjectPattern")for(var i=0,r=e.properties;i<r.length;i+=1){var s=r[i];this.checkPatternExport(n,s)}else if(t==="ArrayPattern")for(var a=0,o=e.elements;a<o.length;a+=1){var l=o[a];l&&this.checkPatternExport(n,l)}else t==="Property"?this.checkPatternExport(n,e.value):t==="AssignmentPattern"?this.checkPatternExport(n,e.left):t==="RestElement"&&this.checkPatternExport(n,e.argument)};gi.checkVariableExport=function(n,e){if(n)for(var t=0,i=e;t<i.length;t+=1){var r=i[t];this.checkPatternExport(n,r.id)}};gi.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()};gi.parseExportSpecifier=function(n){var e=this.startNode();return e.local=this.parseModuleExportName(),e.exported=this.eatContextual("as")?this.parseModuleExportName():e.local,this.checkExport(n,e.exported,e.exported.start),this.finishNode(e,"ExportSpecifier")};gi.parseExportSpecifiers=function(n){var e=[],t=!0;for(this.expect(me.braceL);!this.eat(me.braceR);){if(t)t=!1;else if(this.expect(me.comma),this.afterTrailingComma(me.braceR))break;e.push(this.parseExportSpecifier(n))}return e};gi.parseImport=function(n){return this.next(),this.type===me.string?(n.specifiers=hst,n.source=this.parseExprAtom()):(n.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),n.source=this.type===me.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ImportDeclaration")};gi.parseImportSpecifier=function(){var n=this.startNode();return n.imported=this.parseModuleExportName(),this.eatContextual("as")?n.local=this.parseIdent():(this.checkUnreserved(n.imported),n.local=n.imported),this.checkLValSimple(n.local,P0),this.finishNode(n,"ImportSpecifier")};gi.parseImportDefaultSpecifier=function(){var n=this.startNode();return n.local=this.parseIdent(),this.checkLValSimple(n.local,P0),this.finishNode(n,"ImportDefaultSpecifier")};gi.parseImportNamespaceSpecifier=function(){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLValSimple(n.local,P0),this.finishNode(n,"ImportNamespaceSpecifier")};gi.parseImportSpecifiers=function(){var n=[],e=!0;if(this.type===me.name&&(n.push(this.parseImportDefaultSpecifier()),!this.eat(me.comma)))return n;if(this.type===me.star)return n.push(this.parseImportNamespaceSpecifier()),n;for(this.expect(me.braceL);!this.eat(me.braceR);){if(e)e=!1;else if(this.expect(me.comma),this.afterTrailingComma(me.braceR))break;n.push(this.parseImportSpecifier())}return n};gi.parseWithClause=function(){var n=[];if(!this.eat(me._with))return n;this.expect(me.braceL);for(var e={},t=!0;!this.eat(me.braceR);){if(t)t=!1;else if(this.expect(me.comma),this.afterTrailingComma(me.braceR))break;var i=this.parseImportAttribute(),r=i.key.type==="Identifier"?i.key.name:i.key.value;SA(e,r)&&this.raiseRecoverable(i.key.start,"Duplicate attribute key '"+r+"'"),e[r]=!0,n.push(i)}return n};gi.parseImportAttribute=function(){var n=this.startNode();return n.key=this.type===me.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(me.colon),this.type!==me.string&&this.unexpected(),n.value=this.parseExprAtom(),this.finishNode(n,"ImportAttribute")};gi.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===me.string){var n=this.parseLiteral(this.value);return ast.test(n.value)&&this.raise(n.start,"An export name cannot include a lone surrogate."),n}return this.parseIdent(!0)};gi.adaptDirectivePrologue=function(n){for(var e=0;e<n.length&&this.isDirectiveCandidate(n[e]);++e)n[e].directive=n[e].expression.raw.slice(1,-1)};gi.isDirectiveCandidate=function(n){return this.options.ecmaVersion>=5&&n.type==="ExpressionStatement"&&n.expression.type==="Literal"&&typeof n.expression.value=="string"&&(this.input[n.start]==='"'||this.input[n.start]==="'")};var qd=il.prototype;qd.toAssignable=function(n,e,t){if(this.options.ecmaVersion>=6&&n)switch(n.type){case"Identifier":this.inAsync&&n.name==="await"&&this.raise(n.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":n.type="ObjectPattern",t&&this.checkPatternErrors(t,!0);for(var i=0,r=n.properties;i<r.length;i+=1){var s=r[i];this.toAssignable(s,e),s.type==="RestElement"&&(s.argument.type==="ArrayPattern"||s.argument.type==="ObjectPattern")&&this.raise(s.argument.start,"Unexpected token")}break;case"Property":n.kind!=="init"&&this.raise(n.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(n.value,e);break;case"ArrayExpression":n.type="ArrayPattern",t&&this.checkPatternErrors(t,!0),this.toAssignableList(n.elements,e);break;case"SpreadElement":n.type="RestElement",this.toAssignable(n.argument,e),n.argument.type==="AssignmentPattern"&&this.raise(n.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":n.operator!=="="&&this.raise(n.left.end,"Only '=' operator can be used for specifying default value."),n.type="AssignmentPattern",delete n.operator,this.toAssignable(n.left,e);break;case"ParenthesizedExpression":this.toAssignable(n.expression,e,t);break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(n.start,"Assigning to rvalue")}else t&&this.checkPatternErrors(t,!0);return n};qd.toAssignableList=function(n,e){for(var t=n.length,i=0;i<t;i++){var r=n[i];r&&this.toAssignable(r,e)}if(t){var s=n[t-1];this.options.ecmaVersion===6&&e&&s&&s.type==="RestElement"&&s.argument.type!=="Identifier"&&this.unexpected(s.argument.start)}return n};qd.parseSpread=function(n){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,n),this.finishNode(e,"SpreadElement")};qd.parseRestBinding=function(){var n=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==me.name&&this.unexpected(),n.argument=this.parseBindingAtom(),this.finishNode(n,"RestElement")};qd.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case me.bracketL:var n=this.startNode();return this.next(),n.elements=this.parseBindingList(me.bracketR,!0,!0),this.finishNode(n,"ArrayPattern");case me.braceL:return this.parseObj(!0)}return this.parseIdent()};qd.parseBindingList=function(n,e,t,i){for(var r=[],s=!0;!this.eat(n);)if(s?s=!1:this.expect(me.comma),e&&this.type===me.comma)r.push(null);else{if(t&&this.afterTrailingComma(n))break;if(this.type===me.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),r.push(a),this.type===me.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(n);break}else r.push(this.parseAssignableListItem(i))}return r};qd.parseAssignableListItem=function(n){var e=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(e),e};qd.parseBindingListItem=function(n){return n};qd.parseMaybeDefault=function(n,e,t){if(t=t||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(me.eq))return t;var i=this.startNodeAt(n,e);return i.left=t,i.right=this.parseMaybeAssign(),this.finishNode(i,"AssignmentPattern")};qd.checkLValSimple=function(n,e,t){e===void 0&&(e=h2);var i=e!==h2;switch(n.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(n.name)&&this.raiseRecoverable(n.start,(i?"Binding ":"Assigning to ")+n.name+" in strict mode"),i&&(e===P0&&n.name==="let"&&this.raiseRecoverable(n.start,"let is disallowed as a lexically bound name"),t&&(SA(t,n.name)&&this.raiseRecoverable(n.start,"Argument name clash"),t[n.name]=!0),e!==ibe&&this.declareName(n.name,e,n.start));break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":i&&this.raiseRecoverable(n.start,"Binding member expression");break;case"ParenthesizedExpression":return i&&this.raiseRecoverable(n.start,"Binding parenthesized expression"),this.checkLValSimple(n.expression,e,t);default:this.raise(n.start,(i?"Binding":"Assigning to")+" rvalue")}};qd.checkLValPattern=function(n,e,t){switch(e===void 0&&(e=h2),n.type){case"ObjectPattern":for(var i=0,r=n.properties;i<r.length;i+=1){var s=r[i];this.checkLValInnerPattern(s,e,t)}break;case"ArrayPattern":for(var a=0,o=n.elements;a<o.length;a+=1){var l=o[a];l&&this.checkLValInnerPattern(l,e,t)}break;default:this.checkLValSimple(n,e,t)}};qd.checkLValInnerPattern=function(n,e,t){switch(e===void 0&&(e=h2),n.type){case"Property":this.checkLValInnerPattern(n.value,e,t);break;case"AssignmentPattern":this.checkLValPattern(n.left,e,t);break;case"RestElement":this.checkLValPattern(n.argument,e,t);break;default:this.checkLValPattern(n,e,t)}};var Pf=function(n,e,t,i,r){this.token=n,this.isExpr=!!e,this.preserveSpace=!!t,this.override=i,this.generator=!!r},Ga={b_stat:new Pf("{",!1),b_expr:new Pf("{",!0),b_tmpl:new Pf("${",!1),p_stat:new Pf("(",!1),p_expr:new Pf("(",!0),q_tmpl:new Pf("`",!0,!0,function(n){return n.tryReadTemplateToken()}),f_stat:new Pf("function",!1),f_expr:new Pf("function",!0),f_expr_gen:new Pf("function",!0,!1,null,!0),f_gen:new Pf("function",!1,!1,null,!0)},AA=il.prototype;AA.initialContext=function(){return[Ga.b_stat]};AA.curContext=function(){return this.context[this.context.length-1]};AA.braceIsBlock=function(n){var e=this.curContext();return e===Ga.f_expr||e===Ga.f_stat?!0:n===me.colon&&(e===Ga.b_stat||e===Ga.b_expr)?!e.isExpr:n===me._return||n===me.name&&this.exprAllowed?Jd.test(this.input.slice(this.lastTokEnd,this.start)):n===me._else||n===me.semi||n===me.eof||n===me.parenR||n===me.arrow?!0:n===me.braceL?e===Ga.b_stat:n===me._var||n===me._const||n===me.name?!1:!this.exprAllowed};AA.inGeneratorContext=function(){for(var n=this.context.length-1;n>=1;n--){var e=this.context[n];if(e.token==="function")return e.generator}return!1};AA.updateContext=function(n){var e,t=this.type;t.keyword&&n===me.dot?this.exprAllowed=!1:(e=t.updateContext)?e.call(this,n):this.exprAllowed=t.beforeExpr};AA.overrideContext=function(n){this.curContext()!==n&&(this.context[this.context.length-1]=n)};me.parenR.updateContext=me.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var n=this.context.pop();n===Ga.b_stat&&this.curContext().token==="function"&&(n=this.context.pop()),this.exprAllowed=!n.isExpr};me.braceL.updateContext=function(n){this.context.push(this.braceIsBlock(n)?Ga.b_stat:Ga.b_expr),this.exprAllowed=!0};me.dollarBraceL.updateContext=function(){this.context.push(Ga.b_tmpl),this.exprAllowed=!0};me.parenL.updateContext=function(n){var e=n===me._if||n===me._for||n===me._with||n===me._while;this.context.push(e?Ga.p_stat:Ga.p_expr),this.exprAllowed=!0};me.incDec.updateContext=function(){};me._function.updateContext=me._class.updateContext=function(n){n.beforeExpr&&n!==me._else&&!(n===me.semi&&this.curContext()!==Ga.p_stat)&&!(n===me._return&&Jd.test(this.input.slice(this.lastTokEnd,this.start)))&&!((n===me.colon||n===me.braceL)&&this.curContext()===Ga.b_stat)?this.context.push(Ga.f_expr):this.context.push(Ga.f_stat),this.exprAllowed=!1};me.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0};me.backQuote.updateContext=function(){this.curContext()===Ga.q_tmpl?this.context.pop():this.context.push(Ga.q_tmpl),this.exprAllowed=!1};me.star.updateContext=function(n){if(n===me._function){var e=this.context.length-1;this.context[e]===Ga.f_expr?this.context[e]=Ga.f_expr_gen:this.context[e]=Ga.f_gen}this.exprAllowed=!0};me.name.updateContext=function(n){var e=!1;this.options.ecmaVersion>=6&&n!==me.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var Zi=il.prototype;Zi.checkPropClash=function(n,e,t){if(!(this.options.ecmaVersion>=9&&n.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(n.computed||n.method||n.shorthand))){var i=n.key,r;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var s=n.kind;if(this.options.ecmaVersion>=6){r==="__proto__"&&s==="init"&&(e.proto&&(t?t.doubleProto<0&&(t.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),e.proto=!0);return}r="$"+r;var a=e[r];if(a){var o;s==="init"?o=this.strict&&a.init||a.get||a.set:o=a.init||a[s],o&&this.raiseRecoverable(i.start,"Redefinition of property")}else a=e[r]={init:!1,get:!1,set:!1};a[s]=!0}};Zi.parseExpression=function(n,e){var t=this.start,i=this.startLoc,r=this.parseMaybeAssign(n,e);if(this.type===me.comma){var s=this.startNodeAt(t,i);for(s.expressions=[r];this.eat(me.comma);)s.expressions.push(this.parseMaybeAssign(n,e));return this.finishNode(s,"SequenceExpression")}return r};Zi.parseMaybeAssign=function(n,e,t){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(n);this.exprAllowed=!1}var i=!1,r=-1,s=-1,a=-1;e?(r=e.parenthesizedAssign,s=e.trailingComma,a=e.doubleProto,e.parenthesizedAssign=e.trailingComma=-1):(e=new zL,i=!0);var o=this.start,l=this.startLoc;(this.type===me.parenL||this.type===me.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=n==="await");var u=this.parseMaybeConditional(n,e);if(t&&(u=t.call(this,u,o,l)),this.type.isAssign){var c=this.startNodeAt(o,l);return c.operator=this.value,this.type===me.eq&&(u=this.toAssignable(u,!1,e)),i||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=u.start&&(e.shorthandAssign=-1),this.type===me.eq?this.checkLValPattern(u):this.checkLValSimple(u),c.left=u,this.next(),c.right=this.parseMaybeAssign(n),a>-1&&(e.doubleProto=a),this.finishNode(c,"AssignmentExpression")}else i&&this.checkExpressionErrors(e,!0);return r>-1&&(e.parenthesizedAssign=r),s>-1&&(e.trailingComma=s),u};Zi.parseMaybeConditional=function(n,e){var t=this.start,i=this.startLoc,r=this.parseExprOps(n,e);if(this.checkExpressionErrors(e))return r;if(this.eat(me.question)){var s=this.startNodeAt(t,i);return s.test=r,s.consequent=this.parseMaybeAssign(),this.expect(me.colon),s.alternate=this.parseMaybeAssign(n),this.finishNode(s,"ConditionalExpression")}return r};Zi.parseExprOps=function(n,e){var t=this.start,i=this.startLoc,r=this.parseMaybeUnary(e,!1,!1,n);return this.checkExpressionErrors(e)||r.start===t&&r.type==="ArrowFunctionExpression"?r:this.parseExprOp(r,t,i,-1,n)};Zi.parseExprOp=function(n,e,t,i,r){var s=this.type.binop;if(s!=null&&(!r||this.type!==me._in)&&s>i){var a=this.type===me.logicalOR||this.type===me.logicalAND,o=this.type===me.coalesce;o&&(s=me.logicalAND.binop);var l=this.value;this.next();var u=this.start,c=this.startLoc,d=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,r),u,c,s,r),f=this.buildBinary(e,t,n,d,l,a||o);return(a&&this.type===me.coalesce||o&&(this.type===me.logicalOR||this.type===me.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(f,e,t,i,r)}return n};Zi.buildBinary=function(n,e,t,i,r,s){i.type==="PrivateIdentifier"&&this.raise(i.start,"Private identifier can only be left side of binary expression");var a=this.startNodeAt(n,e);return a.left=t,a.operator=r,a.right=i,this.finishNode(a,s?"LogicalExpression":"BinaryExpression")};Zi.parseMaybeUnary=function(n,e,t,i){var r=this.start,s=this.startLoc,a;if(this.isContextual("await")&&this.canAwait)a=this.parseAwait(i),e=!0;else if(this.type.prefix){var o=this.startNode(),l=this.type===me.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0,l,i),this.checkExpressionErrors(n,!0),l?this.checkLValSimple(o.argument):this.strict&&o.operator==="delete"&&sbe(o.argument)?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):o.operator==="delete"&&Sz(o.argument)?this.raiseRecoverable(o.start,"Private fields can not be deleted"):e=!0,a=this.finishNode(o,l?"UpdateExpression":"UnaryExpression")}else if(!e&&this.type===me.privateId)(i||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),a=this.parsePrivateIdent(),this.type!==me._in&&this.unexpected();else{if(a=this.parseExprSubscripts(n,i),this.checkExpressionErrors(n))return a;for(;this.type.postfix&&!this.canInsertSemicolon();){var u=this.startNodeAt(r,s);u.operator=this.value,u.prefix=!1,u.argument=a,this.checkLValSimple(a),this.next(),a=this.finishNode(u,"UpdateExpression")}}if(!t&&this.eat(me.starstar))if(e)this.unexpected(this.lastTokStart);else return this.buildBinary(r,s,a,this.parseMaybeUnary(null,!1,!1,i),"**",!1);else return a};function sbe(n){return n.type==="Identifier"||n.type==="ParenthesizedExpression"&&sbe(n.expression)}function Sz(n){return n.type==="MemberExpression"&&n.property.type==="PrivateIdentifier"||n.type==="ChainExpression"&&Sz(n.expression)||n.type==="ParenthesizedExpression"&&Sz(n.expression)}Zi.parseExprSubscripts=function(n,e){var t=this.start,i=this.startLoc,r=this.parseExprAtom(n,e);if(r.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return r;var s=this.parseSubscripts(r,t,i,!1,e);return n&&s.type==="MemberExpression"&&(n.parenthesizedAssign>=s.start&&(n.parenthesizedAssign=-1),n.parenthesizedBind>=s.start&&(n.parenthesizedBind=-1),n.trailingComma>=s.start&&(n.trailingComma=-1)),s};Zi.parseSubscripts=function(n,e,t,i,r){for(var s=this.options.ecmaVersion>=8&&n.type==="Identifier"&&n.name==="async"&&this.lastTokEnd===n.end&&!this.canInsertSemicolon()&&n.end-n.start===5&&this.potentialArrowAt===n.start,a=!1;;){var o=this.parseSubscript(n,e,t,i,s,a,r);if(o.optional&&(a=!0),o===n||o.type==="ArrowFunctionExpression"){if(a){var l=this.startNodeAt(e,t);l.expression=o,o=this.finishNode(l,"ChainExpression")}return o}n=o}};Zi.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(me.arrow)};Zi.parseSubscriptAsyncArrow=function(n,e,t,i){return this.parseArrowExpression(this.startNodeAt(n,e),t,!0,i)};Zi.parseSubscript=function(n,e,t,i,r,s,a){var o=this.options.ecmaVersion>=11,l=o&&this.eat(me.questionDot);i&&l&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(me.bracketL);if(u||l&&this.type!==me.parenL&&this.type!==me.backQuote||this.eat(me.dot)){var c=this.startNodeAt(e,t);c.object=n,u?(c.property=this.parseExpression(),this.expect(me.bracketR)):this.type===me.privateId&&n.type!=="Super"?c.property=this.parsePrivateIdent():c.property=this.parseIdent(this.options.allowReserved!=="never"),c.computed=!!u,o&&(c.optional=l),n=this.finishNode(c,"MemberExpression")}else if(!i&&this.eat(me.parenL)){var d=new zL,f=this.yieldPos,m=this.awaitPos,y=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var _=this.parseExprList(me.parenR,this.options.ecmaVersion>=8,!1,d);if(r&&!l&&this.shouldParseAsyncArrow())return this.checkPatternErrors(d,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=f,this.awaitPos=m,this.awaitIdentPos=y,this.parseSubscriptAsyncArrow(e,t,_,a);this.checkExpressionErrors(d,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=m||this.awaitPos,this.awaitIdentPos=y||this.awaitIdentPos;var S=this.startNodeAt(e,t);S.callee=n,S.arguments=_,o&&(S.optional=l),n=this.finishNode(S,"CallExpression")}else if(this.type===me.backQuote){(l||s)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var b=this.startNodeAt(e,t);b.tag=n,b.quasi=this.parseTemplate({isTagged:!0}),n=this.finishNode(b,"TaggedTemplateExpression")}return n};Zi.parseExprAtom=function(n,e,t){this.type===me.slash&&this.readRegexp();var i,r=this.potentialArrowAt===this.start;switch(this.type){case me._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),i=this.startNode(),this.next(),this.type===me.parenL&&!this.allowDirectSuper&&this.raise(i.start,"super() call outside constructor of a subclass"),this.type!==me.dot&&this.type!==me.bracketL&&this.type!==me.parenL&&this.unexpected(),this.finishNode(i,"Super");case me._this:return i=this.startNode(),this.next(),this.finishNode(i,"ThisExpression");case me.name:var s=this.start,a=this.startLoc,o=this.containsEsc,l=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&l.name==="async"&&!this.canInsertSemicolon()&&this.eat(me._function))return this.overrideContext(Ga.f_expr),this.parseFunction(this.startNodeAt(s,a),0,!1,!0,e);if(r&&!this.canInsertSemicolon()){if(this.eat(me.arrow))return this.parseArrowExpression(this.startNodeAt(s,a),[l],!1,e);if(this.options.ecmaVersion>=8&&l.name==="async"&&this.type===me.name&&!o&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return l=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(me.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(s,a),[l],!0,e)}return l;case me.regexp:var u=this.value;return i=this.parseLiteral(u.value),i.regex={pattern:u.pattern,flags:u.flags},i;case me.num:case me.string:return this.parseLiteral(this.value);case me._null:case me._true:case me._false:return i=this.startNode(),i.value=this.type===me._null?null:this.type===me._true,i.raw=this.type.keyword,this.next(),this.finishNode(i,"Literal");case me.parenL:var c=this.start,d=this.parseParenAndDistinguishExpression(r,e);return n&&(n.parenthesizedAssign<0&&!this.isSimpleAssignTarget(d)&&(n.parenthesizedAssign=c),n.parenthesizedBind<0&&(n.parenthesizedBind=c)),d;case me.bracketL:return i=this.startNode(),this.next(),i.elements=this.parseExprList(me.bracketR,!0,!0,n),this.finishNode(i,"ArrayExpression");case me.braceL:return this.overrideContext(Ga.b_expr),this.parseObj(!1,n);case me._function:return i=this.startNode(),this.next(),this.parseFunction(i,0);case me._class:return this.parseClass(this.startNode(),!1);case me._new:return this.parseNew();case me.backQuote:return this.parseTemplate();case me._import:return this.options.ecmaVersion>=11?this.parseExprImport(t):this.unexpected();default:return this.parseExprAtomDefault()}};Zi.parseExprAtomDefault=function(){this.unexpected()};Zi.parseExprImport=function(n){var e=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===me.parenL&&!n)return this.parseDynamicImport(e);if(this.type===me.dot){var t=this.startNodeAt(e.start,e.loc&&e.loc.start);return t.name="import",e.meta=this.finishNode(t,"Identifier"),this.parseImportMeta(e)}else this.unexpected()};Zi.parseDynamicImport=function(n){if(this.next(),n.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(me.parenR)?n.options=null:(this.expect(me.comma),this.afterTrailingComma(me.parenR)?n.options=null:(n.options=this.parseMaybeAssign(),this.eat(me.parenR)||(this.expect(me.comma),this.afterTrailingComma(me.parenR)||this.unexpected())));else if(!this.eat(me.parenR)){var e=this.start;this.eat(me.comma)&&this.eat(me.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(n,"ImportExpression")};Zi.parseImportMeta=function(n){this.next();var e=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="meta"&&this.raiseRecoverable(n.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(n.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(n.start,"Cannot use 'import.meta' outside a module"),this.finishNode(n,"MetaProperty")};Zi.parseLiteral=function(n){var e=this.startNode();return e.value=n,e.raw=this.input.slice(this.start,this.end),e.raw.charCodeAt(e.raw.length-1)===110&&(e.bigint=e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")};Zi.parseParenExpression=function(){this.expect(me.parenL);var n=this.parseExpression();return this.expect(me.parenR),n};Zi.shouldParseArrow=function(n){return!this.canInsertSemicolon()};Zi.parseParenAndDistinguishExpression=function(n,e){var t=this.start,i=this.startLoc,r,s=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a=this.start,o=this.startLoc,l=[],u=!0,c=!1,d=new zL,f=this.yieldPos,m=this.awaitPos,y;for(this.yieldPos=0,this.awaitPos=0;this.type!==me.parenR;)if(u?u=!1:this.expect(me.comma),s&&this.afterTrailingComma(me.parenR,!0)){c=!0;break}else if(this.type===me.ellipsis){y=this.start,l.push(this.parseParenItem(this.parseRestBinding())),this.type===me.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else l.push(this.parseMaybeAssign(!1,d,this.parseParenItem));var _=this.lastTokEnd,S=this.lastTokEndLoc;if(this.expect(me.parenR),n&&this.shouldParseArrow(l)&&this.eat(me.arrow))return this.checkPatternErrors(d,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=f,this.awaitPos=m,this.parseParenArrowList(t,i,l,e);(!l.length||c)&&this.unexpected(this.lastTokStart),y&&this.unexpected(y),this.checkExpressionErrors(d,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=m||this.awaitPos,l.length>1?(r=this.startNodeAt(a,o),r.expressions=l,this.finishNodeAt(r,"SequenceExpression",_,S)):r=l[0]}else r=this.parseParenExpression();if(this.options.preserveParens){var b=this.startNodeAt(t,i);return b.expression=r,this.finishNode(b,"ParenthesizedExpression")}else return r};Zi.parseParenItem=function(n){return n};Zi.parseParenArrowList=function(n,e,t,i){return this.parseArrowExpression(this.startNodeAt(n,e),t,!1,i)};var fst=[];Zi.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var n=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===me.dot){var e=this.startNodeAt(n.start,n.loc&&n.loc.start);e.name="new",n.meta=this.finishNode(e,"Identifier"),this.next();var t=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="target"&&this.raiseRecoverable(n.property.start,"The only valid meta property for new is 'new.target'"),t&&this.raiseRecoverable(n.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(n.start,"'new.target' can only be used in functions and class static block"),this.finishNode(n,"MetaProperty")}var i=this.start,r=this.startLoc;return n.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),i,r,!0,!1),this.eat(me.parenL)?n.arguments=this.parseExprList(me.parenR,this.options.ecmaVersion>=8,!1):n.arguments=fst,this.finishNode(n,"NewExpression")};Zi.parseTemplateElement=function(n){var e=n.isTagged,t=this.startNode();return this.type===me.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),t.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):t.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),t.tail=this.type===me.backQuote,this.finishNode(t,"TemplateElement")};Zi.parseTemplate=function(n){n===void 0&&(n={});var e=n.isTagged;e===void 0&&(e=!1);var t=this.startNode();this.next(),t.expressions=[];var i=this.parseTemplateElement({isTagged:e});for(t.quasis=[i];!i.tail;)this.type===me.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(me.dollarBraceL),t.expressions.push(this.parseExpression()),this.expect(me.braceR),t.quasis.push(i=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(t,"TemplateLiteral")};Zi.isAsyncProp=function(n){return!n.computed&&n.key.type==="Identifier"&&n.key.name==="async"&&(this.type===me.name||this.type===me.num||this.type===me.string||this.type===me.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===me.star)&&!Jd.test(this.input.slice(this.lastTokEnd,this.start))};Zi.parseObj=function(n,e){var t=this.startNode(),i=!0,r={};for(t.properties=[],this.next();!this.eat(me.braceR);){if(i)i=!1;else if(this.expect(me.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(me.braceR))break;var s=this.parseProperty(n,e);n||this.checkPropClash(s,r,e),t.properties.push(s)}return this.finishNode(t,n?"ObjectPattern":"ObjectExpression")};Zi.parseProperty=function(n,e){var t=this.startNode(),i,r,s,a;if(this.options.ecmaVersion>=9&&this.eat(me.ellipsis))return n?(t.argument=this.parseIdent(!1),this.type===me.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(t,"RestElement")):(t.argument=this.parseMaybeAssign(!1,e),this.type===me.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(t,"SpreadElement"));this.options.ecmaVersion>=6&&(t.method=!1,t.shorthand=!1,(n||e)&&(s=this.start,a=this.startLoc),n||(i=this.eat(me.star)));var o=this.containsEsc;return this.parsePropertyName(t),!n&&!o&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(t)?(r=!0,i=this.options.ecmaVersion>=9&&this.eat(me.star),this.parsePropertyName(t)):r=!1,this.parsePropertyValue(t,n,i,r,s,a,e,o),this.finishNode(t,"Property")};Zi.parseGetterSetter=function(n){n.kind=n.key.name,this.parsePropertyName(n),n.value=this.parseMethod(!1);var e=n.kind==="get"?0:1;if(n.value.params.length!==e){var t=n.value.start;n.kind==="get"?this.raiseRecoverable(t,"getter should have no params"):this.raiseRecoverable(t,"setter should have exactly one param")}else n.kind==="set"&&n.value.params[0].type==="RestElement"&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params")};Zi.parsePropertyValue=function(n,e,t,i,r,s,a,o){(t||i)&&this.type===me.colon&&this.unexpected(),this.eat(me.colon)?(n.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),n.kind="init"):this.options.ecmaVersion>=6&&this.type===me.parenL?(e&&this.unexpected(),n.kind="init",n.method=!0,n.value=this.parseMethod(t,i)):!e&&!o&&this.options.ecmaVersion>=5&&!n.computed&&n.key.type==="Identifier"&&(n.key.name==="get"||n.key.name==="set")&&this.type!==me.comma&&this.type!==me.braceR&&this.type!==me.eq?((t||i)&&this.unexpected(),this.parseGetterSetter(n)):this.options.ecmaVersion>=6&&!n.computed&&n.key.type==="Identifier"?((t||i)&&this.unexpected(),this.checkUnreserved(n.key),n.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=r),n.kind="init",e?n.value=this.parseMaybeDefault(r,s,this.copyNode(n.key)):this.type===me.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),n.value=this.parseMaybeDefault(r,s,this.copyNode(n.key))):n.value=this.copyNode(n.key),n.shorthand=!0):this.unexpected()};Zi.parsePropertyName=function(n){if(this.options.ecmaVersion>=6){if(this.eat(me.bracketL))return n.computed=!0,n.key=this.parseMaybeAssign(),this.expect(me.bracketR),n.key;n.computed=!1}return n.key=this.type===me.num||this.type===me.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")};Zi.initFunction=function(n){n.id=null,this.options.ecmaVersion>=6&&(n.generator=n.expression=!1),this.options.ecmaVersion>=8&&(n.async=!1)};Zi.parseMethod=function(n,e,t){var i=this.startNode(),r=this.yieldPos,s=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(i),this.options.ecmaVersion>=6&&(i.generator=n),this.options.ecmaVersion>=8&&(i.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(s8(e,i.generator)|i8|(t?ebe:0)),this.expect(me.parenL),i.params=this.parseBindingList(me.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(i,!1,!0,!1),this.yieldPos=r,this.awaitPos=s,this.awaitIdentPos=a,this.finishNode(i,"FunctionExpression")};Zi.parseArrowExpression=function(n,e,t,i){var r=this.yieldPos,s=this.awaitPos,a=this.awaitIdentPos;return this.enterScope(s8(t,!1)|qxe),this.initFunction(n),this.options.ecmaVersion>=8&&(n.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,n.params=this.toAssignableList(e,!0),this.parseFunctionBody(n,!0,!1,i),this.yieldPos=r,this.awaitPos=s,this.awaitIdentPos=a,this.finishNode(n,"ArrowFunctionExpression")};Zi.parseFunctionBody=function(n,e,t,i){var r=e&&this.type!==me.braceL,s=this.strict,a=!1;if(r)n.body=this.parseMaybeAssign(i),n.expression=!0,this.checkParams(n,!1);else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(n.params);(!s||o)&&(a=this.strictDirective(this.end),a&&o&&this.raiseRecoverable(n.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var l=this.labels;this.labels=[],a&&(this.strict=!0),this.checkParams(n,!s&&!a&&!e&&!t&&this.isSimpleParamList(n.params)),this.strict&&n.id&&this.checkLValSimple(n.id,ibe),n.body=this.parseBlock(!1,void 0,a&&!s),n.expression=!1,this.adaptDirectivePrologue(n.body.body),this.labels=l}this.exitScope()};Zi.isSimpleParamList=function(n){for(var e=0,t=n;e<t.length;e+=1){var i=t[e];if(i.type!=="Identifier")return!1}return!0};Zi.checkParams=function(n,e){for(var t=Object.create(null),i=0,r=n.params;i<r.length;i+=1){var s=r[i];this.checkLValInnerPattern(s,a8,e?null:t)}};Zi.parseExprList=function(n,e,t,i){for(var r=[],s=!0;!this.eat(n);){if(s)s=!1;else if(this.expect(me.comma),e&&this.afterTrailingComma(n))break;var a=void 0;t&&this.type===me.comma?a=null:this.type===me.ellipsis?(a=this.parseSpread(i),i&&this.type===me.comma&&i.trailingComma<0&&(i.trailingComma=this.start)):a=this.parseMaybeAssign(!1,i),r.push(a)}return r};Zi.checkUnreserved=function(n){var e=n.start,t=n.end,i=n.name;if(this.inGenerator&&i==="yield"&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&i==="await"&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),this.currentThisScope().inClassFieldInit&&i==="arguments"&&this.raiseRecoverable(e,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(i==="arguments"||i==="await")&&this.raise(e,"Cannot use "+i+" in class static initialization block"),this.keywords.test(i)&&this.raise(e,"Unexpected keyword '"+i+"'"),!(this.options.ecmaVersion<6&&this.input.slice(e,t).indexOf("\\")!==-1)){var r=this.strict?this.reservedWordsStrict:this.reservedWords;r.test(i)&&(!this.inAsync&&i==="await"&&this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+i+"' is reserved"))}};Zi.parseIdent=function(n){var e=this.parseIdentNode();return this.next(!!n),this.finishNode(e,"Identifier"),n||(this.checkUnreserved(e),e.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=e.start)),e};Zi.parseIdentNode=function(){var n=this.startNode();return this.type===me.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,(n.name==="class"||n.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=me.name):this.unexpected(),n};Zi.parsePrivateIdent=function(){var n=this.startNode();return this.type===me.privateId?n.name=this.value:this.unexpected(),this.next(),this.finishNode(n,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(n.start,"Private field '#"+n.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(n)),n};Zi.parseYield=function(n){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===me.semi||this.canInsertSemicolon()||this.type!==me.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(me.star),e.argument=this.parseMaybeAssign(n)),this.finishNode(e,"YieldExpression")};Zi.parseAwait=function(n){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0,!1,n),this.finishNode(e,"AwaitExpression")};var f2=il.prototype;f2.raise=function(n,e){var t=$xe(this.input,n);e+=" ("+t.line+":"+t.column+")";var i=new SyntaxError(e);throw i.pos=n,i.loc=t,i.raisedAt=this.pos,i};f2.raiseRecoverable=f2.raise;f2.curPosition=function(){if(this.options.locations)return new CE(this.curLine,this.pos-this.lineStart)};var o1=il.prototype,pst=function(n){this.flags=n,this.var=[],this.lexical=[],this.functions=[],this.inClassFieldInit=!1};o1.enterScope=function(n){this.scopeStack.push(new pst(n))};o1.exitScope=function(){this.scopeStack.pop()};o1.treatFunctionsAsVarInScope=function(n){return n.flags&MA||!this.inModule&&n.flags&wE};o1.declareName=function(n,e,t){var i=!1;if(e===P0){var r=this.currentScope();i=r.lexical.indexOf(n)>-1||r.functions.indexOf(n)>-1||r.var.indexOf(n)>-1,r.lexical.push(n),this.inModule&&r.flags&wE&&delete this.undefinedExports[n]}else if(e===nbe){var s=this.currentScope();s.lexical.push(n)}else if(e===tbe){var a=this.currentScope();this.treatFunctionsAsVar?i=a.lexical.indexOf(n)>-1:i=a.lexical.indexOf(n)>-1||a.var.indexOf(n)>-1,a.functions.push(n)}else for(var o=this.scopeStack.length-1;o>=0;--o){var l=this.scopeStack[o];if(l.lexical.indexOf(n)>-1&&!(l.flags&Qxe&&l.lexical[0]===n)||!this.treatFunctionsAsVarInScope(l)&&l.functions.indexOf(n)>-1){i=!0;break}if(l.var.push(n),this.inModule&&l.flags&wE&&delete this.undefinedExports[n],l.flags&r8)break}i&&this.raiseRecoverable(t,"Identifier '"+n+"' has already been declared")};o1.checkLocalExport=function(n){this.scopeStack[0].lexical.indexOf(n.name)===-1&&this.scopeStack[0].var.indexOf(n.name)===-1&&(this.undefinedExports[n.name]=n)};o1.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]};o1.currentVarScope=function(){for(var n=this.scopeStack.length-1;;n--){var e=this.scopeStack[n];if(e.flags&r8)return e}};o1.currentThisScope=function(){for(var n=this.scopeStack.length-1;;n--){var e=this.scopeStack[n];if(e.flags&r8&&!(e.flags&qxe))return e}};var VL=function(n,e,t){this.type="",this.start=e,this.end=0,n.options.locations&&(this.loc=new kL(n,t)),n.options.directSourceFile&&(this.sourceFile=n.options.directSourceFile),n.options.ranges&&(this.range=[e,0])},r3=il.prototype;r3.startNode=function(){return new VL(this,this.start,this.startLoc)};r3.startNodeAt=function(n,e){return new VL(this,n,e)};function abe(n,e,t,i){return n.type=e,n.end=t,this.options.locations&&(n.loc.end=i),this.options.ranges&&(n.range[1]=t),n}r3.finishNode=function(n,e){return abe.call(this,n,e,this.lastTokEnd,this.lastTokEndLoc)};r3.finishNodeAt=function(n,e,t,i){return abe.call(this,n,e,t,i)};r3.copyNode=function(n){var e=new VL(this,n.start,this.startLoc);for(var t in n)e[t]=n[t];return e};var mst="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",obe="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",lbe=obe+" Extended_Pictographic",ube=lbe,cbe=ube+" EBase EComp EMod EPres ExtPict",hbe=cbe,gst=hbe,yst={9:obe,10:lbe,11:ube,12:cbe,13:hbe,14:gst},vst="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",xst={9:"",10:"",11:"",12:"",13:"",14:vst},p$="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",dbe="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",fbe=dbe+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",pbe=fbe+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",mbe=pbe+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",gbe=mbe+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",bst=gbe+" "+mst,_st={9:dbe,10:fbe,11:pbe,12:mbe,13:gbe,14:bst},ybe={};function Sst(n){var e=ybe[n]={binary:qy(yst[n]+" "+p$),binaryOfStrings:qy(xst[n]),nonBinary:{General_Category:qy(p$),Script:qy(_st[n])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}for(var NU=0,m$=[9,10,11,12,13,14];NU<m$.length;NU+=1){var Mst=m$[NU];Sst(Mst)}var ui=il.prototype,p2=function(n,e){this.parent=n,this.base=e||this};p2.prototype.separatedFrom=function(n){for(var e=this;e;e=e.parent)for(var t=n;t;t=t.parent)if(e.base===t.base&&e!==t)return!0;return!1};p2.prototype.sibling=function(){return new p2(this.parent,this.base)};var Vm=function(n){this.parser=n,this.validFlags="gim"+(n.options.ecmaVersion>=6?"uy":"")+(n.options.ecmaVersion>=9?"s":"")+(n.options.ecmaVersion>=13?"d":"")+(n.options.ecmaVersion>=15?"v":""),this.unicodeProperties=ybe[n.options.ecmaVersion>=14?14:n.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};Vm.prototype.reset=function(n,e,t){var i=t.indexOf("v")!==-1,r=t.indexOf("u")!==-1;this.start=n|0,this.source=e+"",this.flags=t,i&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=r&&this.parser.options.ecmaVersion>=9)};Vm.prototype.raise=function(n){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+n)};Vm.prototype.at=function(n,e){e===void 0&&(e=!1);var t=this.source,i=t.length;if(n>=i)return-1;var r=t.charCodeAt(n);if(!(e||this.switchU)||r<=55295||r>=57344||n+1>=i)return r;var s=t.charCodeAt(n+1);return s>=56320&&s<=57343?(r<<10)+s-56613888:r};Vm.prototype.nextIndex=function(n,e){e===void 0&&(e=!1);var t=this.source,i=t.length;if(n>=i)return i;var r=t.charCodeAt(n),s;return!(e||this.switchU)||r<=55295||r>=57344||n+1>=i||(s=t.charCodeAt(n+1))<56320||s>57343?n+1:n+2};Vm.prototype.current=function(n){return n===void 0&&(n=!1),this.at(this.pos,n)};Vm.prototype.lookahead=function(n){return n===void 0&&(n=!1),this.at(this.nextIndex(this.pos,n),n)};Vm.prototype.advance=function(n){n===void 0&&(n=!1),this.pos=this.nextIndex(this.pos,n)};Vm.prototype.eat=function(n,e){return e===void 0&&(e=!1),this.current(e)===n?(this.advance(e),!0):!1};Vm.prototype.eatChars=function(n,e){e===void 0&&(e=!1);for(var t=this.pos,i=0,r=n;i<r.length;i+=1){var s=r[i],a=this.at(t,e);if(a===-1||a!==s)return!1;t=this.nextIndex(t,e)}return this.pos=t,!0};ui.validateRegExpFlags=function(n){for(var e=n.validFlags,t=n.flags,i=!1,r=!1,s=0;s<t.length;s++){var a=t.charAt(s);e.indexOf(a)===-1&&this.raise(n.start,"Invalid regular expression flag"),t.indexOf(a,s+1)>-1&&this.raise(n.start,"Duplicate regular expression flag"),a==="u"&&(i=!0),a==="v"&&(r=!0)}this.options.ecmaVersion>=15&&i&&r&&this.raise(n.start,"Invalid regular expression flag")};function Ast(n){for(var e in n)return!0;return!1}ui.validateRegExpPattern=function(n){this.regexp_pattern(n),!n.switchN&&this.options.ecmaVersion>=9&&Ast(n.groupNames)&&(n.switchN=!0,this.regexp_pattern(n))};ui.regexp_pattern=function(n){n.pos=0,n.lastIntValue=0,n.lastStringValue="",n.lastAssertionIsQuantifiable=!1,n.numCapturingParens=0,n.maxBackReference=0,n.groupNames=Object.create(null),n.backReferenceNames.length=0,n.branchID=null,this.regexp_disjunction(n),n.pos!==n.source.length&&(n.eat(41)&&n.raise("Unmatched ')'"),(n.eat(93)||n.eat(125))&&n.raise("Lone quantifier brackets")),n.maxBackReference>n.numCapturingParens&&n.raise("Invalid escape");for(var e=0,t=n.backReferenceNames;e<t.length;e+=1){var i=t[e];n.groupNames[i]||n.raise("Invalid named capture referenced")}};ui.regexp_disjunction=function(n){var e=this.options.ecmaVersion>=16;for(e&&(n.branchID=new p2(n.branchID,null)),this.regexp_alternative(n);n.eat(124);)e&&(n.branchID=n.branchID.sibling()),this.regexp_alternative(n);e&&(n.branchID=n.branchID.parent),this.regexp_eatQuantifier(n,!0)&&n.raise("Nothing to repeat"),n.eat(123)&&n.raise("Lone quantifier brackets")};ui.regexp_alternative=function(n){for(;n.pos<n.source.length&&this.regexp_eatTerm(n););};ui.regexp_eatTerm=function(n){return this.regexp_eatAssertion(n)?(n.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(n)&&n.switchU&&n.raise("Invalid quantifier"),!0):(n.switchU?this.regexp_eatAtom(n):this.regexp_eatExtendedAtom(n))?(this.regexp_eatQuantifier(n),!0):!1};ui.regexp_eatAssertion=function(n){var e=n.pos;if(n.lastAssertionIsQuantifiable=!1,n.eat(94)||n.eat(36))return!0;if(n.eat(92)){if(n.eat(66)||n.eat(98))return!0;n.pos=e}if(n.eat(40)&&n.eat(63)){var t=!1;if(this.options.ecmaVersion>=9&&(t=n.eat(60)),n.eat(61)||n.eat(33))return this.regexp_disjunction(n),n.eat(41)||n.raise("Unterminated group"),n.lastAssertionIsQuantifiable=!t,!0}return n.pos=e,!1};ui.regexp_eatQuantifier=function(n,e){return e===void 0&&(e=!1),this.regexp_eatQuantifierPrefix(n,e)?(n.eat(63),!0):!1};ui.regexp_eatQuantifierPrefix=function(n,e){return n.eat(42)||n.eat(43)||n.eat(63)||this.regexp_eatBracedQuantifier(n,e)};ui.regexp_eatBracedQuantifier=function(n,e){var t=n.pos;if(n.eat(123)){var i=0,r=-1;if(this.regexp_eatDecimalDigits(n)&&(i=n.lastIntValue,n.eat(44)&&this.regexp_eatDecimalDigits(n)&&(r=n.lastIntValue),n.eat(125)))return r!==-1&&r<i&&!e&&n.raise("numbers out of order in {} quantifier"),!0;n.switchU&&!e&&n.raise("Incomplete quantifier"),n.pos=t}return!1};ui.regexp_eatAtom=function(n){return this.regexp_eatPatternCharacters(n)||n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)};ui.regexp_eatReverseSolidusAtomEscape=function(n){var e=n.pos;if(n.eat(92)){if(this.regexp_eatAtomEscape(n))return!0;n.pos=e}return!1};ui.regexp_eatUncapturingGroup=function(n){var e=n.pos;if(n.eat(40)){if(n.eat(63)){if(this.options.ecmaVersion>=16){var t=this.regexp_eatModifiers(n),i=n.eat(45);if(t||i){for(var r=0;r<t.length;r++){var s=t.charAt(r);t.indexOf(s,r+1)>-1&&n.raise("Duplicate regular expression modifiers")}if(i){var a=this.regexp_eatModifiers(n);!t&&!a&&n.current()===58&&n.raise("Invalid regular expression modifiers");for(var o=0;o<a.length;o++){var l=a.charAt(o);(a.indexOf(l,o+1)>-1||t.indexOf(l)>-1)&&n.raise("Duplicate regular expression modifiers")}}}}if(n.eat(58)){if(this.regexp_disjunction(n),n.eat(41))return!0;n.raise("Unterminated group")}}n.pos=e}return!1};ui.regexp_eatCapturingGroup=function(n){if(n.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(n):n.current()===63&&n.raise("Invalid group"),this.regexp_disjunction(n),n.eat(41))return n.numCapturingParens+=1,!0;n.raise("Unterminated group")}return!1};ui.regexp_eatModifiers=function(n){for(var e="",t=0;(t=n.current())!==-1&&Tst(t);)e+=v0(t),n.advance();return e};function Tst(n){return n===105||n===109||n===115}ui.regexp_eatExtendedAtom=function(n){return n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)||this.regexp_eatInvalidBracedQuantifier(n)||this.regexp_eatExtendedPatternCharacter(n)};ui.regexp_eatInvalidBracedQuantifier=function(n){return this.regexp_eatBracedQuantifier(n,!0)&&n.raise("Nothing to repeat"),!1};ui.regexp_eatSyntaxCharacter=function(n){var e=n.current();return vbe(e)?(n.lastIntValue=e,n.advance(),!0):!1};function vbe(n){return n===36||n>=40&&n<=43||n===46||n===63||n>=91&&n<=94||n>=123&&n<=125}ui.regexp_eatPatternCharacters=function(n){for(var e=n.pos,t=0;(t=n.current())!==-1&&!vbe(t);)n.advance();return n.pos!==e};ui.regexp_eatExtendedPatternCharacter=function(n){var e=n.current();return e!==-1&&e!==36&&!(e>=40&&e<=43)&&e!==46&&e!==63&&e!==91&&e!==94&&e!==124?(n.advance(),!0):!1};ui.regexp_groupSpecifier=function(n){if(n.eat(63)){this.regexp_eatGroupName(n)||n.raise("Invalid group");var e=this.options.ecmaVersion>=16,t=n.groupNames[n.lastStringValue];if(t)if(e)for(var i=0,r=t;i<r.length;i+=1){var s=r[i];s.separatedFrom(n.branchID)||n.raise("Duplicate capture group name")}else n.raise("Duplicate capture group name");e?(t||(n.groupNames[n.lastStringValue]=[])).push(n.branchID):n.groupNames[n.lastStringValue]=!0}};ui.regexp_eatGroupName=function(n){if(n.lastStringValue="",n.eat(60)){if(this.regexp_eatRegExpIdentifierName(n)&&n.eat(62))return!0;n.raise("Invalid capture group name")}return!1};ui.regexp_eatRegExpIdentifierName=function(n){if(n.lastStringValue="",this.regexp_eatRegExpIdentifierStart(n)){for(n.lastStringValue+=v0(n.lastIntValue);this.regexp_eatRegExpIdentifierPart(n);)n.lastStringValue+=v0(n.lastIntValue);return!0}return!1};ui.regexp_eatRegExpIdentifierStart=function(n){var e=n.pos,t=this.options.ecmaVersion>=11,i=n.current(t);return n.advance(t),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,t)&&(i=n.lastIntValue),Cst(i)?(n.lastIntValue=i,!0):(n.pos=e,!1)};function Cst(n){return y0(n,!0)||n===36||n===95}ui.regexp_eatRegExpIdentifierPart=function(n){var e=n.pos,t=this.options.ecmaVersion>=11,i=n.current(t);return n.advance(t),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,t)&&(i=n.lastIntValue),wst(i)?(n.lastIntValue=i,!0):(n.pos=e,!1)};function wst(n){return BM(n,!0)||n===36||n===95||n===8204||n===8205}ui.regexp_eatAtomEscape=function(n){return this.regexp_eatBackReference(n)||this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)||n.switchN&&this.regexp_eatKGroupName(n)?!0:(n.switchU&&(n.current()===99&&n.raise("Invalid unicode escape"),n.raise("Invalid escape")),!1)};ui.regexp_eatBackReference=function(n){var e=n.pos;if(this.regexp_eatDecimalEscape(n)){var t=n.lastIntValue;if(n.switchU)return t>n.maxBackReference&&(n.maxBackReference=t),!0;if(t<=n.numCapturingParens)return!0;n.pos=e}return!1};ui.regexp_eatKGroupName=function(n){if(n.eat(107)){if(this.regexp_eatGroupName(n))return n.backReferenceNames.push(n.lastStringValue),!0;n.raise("Invalid named reference")}return!1};ui.regexp_eatCharacterEscape=function(n){return this.regexp_eatControlEscape(n)||this.regexp_eatCControlLetter(n)||this.regexp_eatZero(n)||this.regexp_eatHexEscapeSequence(n)||this.regexp_eatRegExpUnicodeEscapeSequence(n,!1)||!n.switchU&&this.regexp_eatLegacyOctalEscapeSequence(n)||this.regexp_eatIdentityEscape(n)};ui.regexp_eatCControlLetter=function(n){var e=n.pos;if(n.eat(99)){if(this.regexp_eatControlLetter(n))return!0;n.pos=e}return!1};ui.regexp_eatZero=function(n){return n.current()===48&&!HL(n.lookahead())?(n.lastIntValue=0,n.advance(),!0):!1};ui.regexp_eatControlEscape=function(n){var e=n.current();return e===116?(n.lastIntValue=9,n.advance(),!0):e===110?(n.lastIntValue=10,n.advance(),!0):e===118?(n.lastIntValue=11,n.advance(),!0):e===102?(n.lastIntValue=12,n.advance(),!0):e===114?(n.lastIntValue=13,n.advance(),!0):!1};ui.regexp_eatControlLetter=function(n){var e=n.current();return xbe(e)?(n.lastIntValue=e%32,n.advance(),!0):!1};function xbe(n){return n>=65&&n<=90||n>=97&&n<=122}ui.regexp_eatRegExpUnicodeEscapeSequence=function(n,e){e===void 0&&(e=!1);var t=n.pos,i=e||n.switchU;if(n.eat(117)){if(this.regexp_eatFixedHexDigits(n,4)){var r=n.lastIntValue;if(i&&r>=55296&&r<=56319){var s=n.pos;if(n.eat(92)&&n.eat(117)&&this.regexp_eatFixedHexDigits(n,4)){var a=n.lastIntValue;if(a>=56320&&a<=57343)return n.lastIntValue=(r-55296)*1024+(a-56320)+65536,!0}n.pos=s,n.lastIntValue=r}return!0}if(i&&n.eat(123)&&this.regexp_eatHexDigits(n)&&n.eat(125)&&Est(n.lastIntValue))return!0;i&&n.raise("Invalid unicode escape"),n.pos=t}return!1};function Est(n){return n>=0&&n<=1114111}ui.regexp_eatIdentityEscape=function(n){if(n.switchU)return this.regexp_eatSyntaxCharacter(n)?!0:n.eat(47)?(n.lastIntValue=47,!0):!1;var e=n.current();return e!==99&&(!n.switchN||e!==107)?(n.lastIntValue=e,n.advance(),!0):!1};ui.regexp_eatDecimalEscape=function(n){n.lastIntValue=0;var e=n.current();if(e>=49&&e<=57){do n.lastIntValue=10*n.lastIntValue+(e-48),n.advance();while((e=n.current())>=48&&e<=57);return!0}return!1};var bbe=0,x0=1,Sd=2;ui.regexp_eatCharacterClassEscape=function(n){var e=n.current();if(Rst(e))return n.lastIntValue=-1,n.advance(),x0;var t=!1;if(n.switchU&&this.options.ecmaVersion>=9&&((t=e===80)||e===112)){n.lastIntValue=-1,n.advance();var i;if(n.eat(123)&&(i=this.regexp_eatUnicodePropertyValueExpression(n))&&n.eat(125))return t&&i===Sd&&n.raise("Invalid property name"),i;n.raise("Invalid property name")}return bbe};function Rst(n){return n===100||n===68||n===115||n===83||n===119||n===87}ui.regexp_eatUnicodePropertyValueExpression=function(n){var e=n.pos;if(this.regexp_eatUnicodePropertyName(n)&&n.eat(61)){var t=n.lastStringValue;if(this.regexp_eatUnicodePropertyValue(n)){var i=n.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(n,t,i),x0}}if(n.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(n)){var r=n.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(n,r)}return bbe};ui.regexp_validateUnicodePropertyNameAndValue=function(n,e,t){SA(n.unicodeProperties.nonBinary,e)||n.raise("Invalid property name"),n.unicodeProperties.nonBinary[e].test(t)||n.raise("Invalid property value")};ui.regexp_validateUnicodePropertyNameOrValue=function(n,e){if(n.unicodeProperties.binary.test(e))return x0;if(n.switchV&&n.unicodeProperties.binaryOfStrings.test(e))return Sd;n.raise("Invalid property name")};ui.regexp_eatUnicodePropertyName=function(n){var e=0;for(n.lastStringValue="";_be(e=n.current());)n.lastStringValue+=v0(e),n.advance();return n.lastStringValue!==""};function _be(n){return xbe(n)||n===95}ui.regexp_eatUnicodePropertyValue=function(n){var e=0;for(n.lastStringValue="";Pst(e=n.current());)n.lastStringValue+=v0(e),n.advance();return n.lastStringValue!==""};function Pst(n){return _be(n)||HL(n)}ui.regexp_eatLoneUnicodePropertyNameOrValue=function(n){return this.regexp_eatUnicodePropertyValue(n)};ui.regexp_eatCharacterClass=function(n){if(n.eat(91)){var e=n.eat(94),t=this.regexp_classContents(n);return n.eat(93)||n.raise("Unterminated character class"),e&&t===Sd&&n.raise("Negated character class may contain strings"),!0}return!1};ui.regexp_classContents=function(n){return n.current()===93?x0:n.switchV?this.regexp_classSetExpression(n):(this.regexp_nonEmptyClassRanges(n),x0)};ui.regexp_nonEmptyClassRanges=function(n){for(;this.regexp_eatClassAtom(n);){var e=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassAtom(n)){var t=n.lastIntValue;n.switchU&&(e===-1||t===-1)&&n.raise("Invalid character class"),e!==-1&&t!==-1&&e>t&&n.raise("Range out of order in character class")}}};ui.regexp_eatClassAtom=function(n){var e=n.pos;if(n.eat(92)){if(this.regexp_eatClassEscape(n))return!0;if(n.switchU){var t=n.current();(t===99||Abe(t))&&n.raise("Invalid class escape"),n.raise("Invalid escape")}n.pos=e}var i=n.current();return i!==93?(n.lastIntValue=i,n.advance(),!0):!1};ui.regexp_eatClassEscape=function(n){var e=n.pos;if(n.eat(98))return n.lastIntValue=8,!0;if(n.switchU&&n.eat(45))return n.lastIntValue=45,!0;if(!n.switchU&&n.eat(99)){if(this.regexp_eatClassControlLetter(n))return!0;n.pos=e}return this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)};ui.regexp_classSetExpression=function(n){var e=x0,t;if(!this.regexp_eatClassSetRange(n))if(t=this.regexp_eatClassSetOperand(n)){t===Sd&&(e=Sd);for(var i=n.pos;n.eatChars([38,38]);){if(n.current()!==38&&(t=this.regexp_eatClassSetOperand(n))){t!==Sd&&(e=x0);continue}n.raise("Invalid character in character class")}if(i!==n.pos)return e;for(;n.eatChars([45,45]);)this.regexp_eatClassSetOperand(n)||n.raise("Invalid character in character class");if(i!==n.pos)return e}else n.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(n)){if(t=this.regexp_eatClassSetOperand(n),!t)return e;t===Sd&&(e=Sd)}};ui.regexp_eatClassSetRange=function(n){var e=n.pos;if(this.regexp_eatClassSetCharacter(n)){var t=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassSetCharacter(n)){var i=n.lastIntValue;return t!==-1&&i!==-1&&t>i&&n.raise("Range out of order in character class"),!0}n.pos=e}return!1};ui.regexp_eatClassSetOperand=function(n){return this.regexp_eatClassSetCharacter(n)?x0:this.regexp_eatClassStringDisjunction(n)||this.regexp_eatNestedClass(n)};ui.regexp_eatNestedClass=function(n){var e=n.pos;if(n.eat(91)){var t=n.eat(94),i=this.regexp_classContents(n);if(n.eat(93))return t&&i===Sd&&n.raise("Negated character class may contain strings"),i;n.pos=e}if(n.eat(92)){var r=this.regexp_eatCharacterClassEscape(n);if(r)return r;n.pos=e}return null};ui.regexp_eatClassStringDisjunction=function(n){var e=n.pos;if(n.eatChars([92,113])){if(n.eat(123)){var t=this.regexp_classStringDisjunctionContents(n);if(n.eat(125))return t}else n.raise("Invalid escape");n.pos=e}return null};ui.regexp_classStringDisjunctionContents=function(n){for(var e=this.regexp_classString(n);n.eat(124);)this.regexp_classString(n)===Sd&&(e=Sd);return e};ui.regexp_classString=function(n){for(var e=0;this.regexp_eatClassSetCharacter(n);)e++;return e===1?x0:Sd};ui.regexp_eatClassSetCharacter=function(n){var e=n.pos;if(n.eat(92))return this.regexp_eatCharacterEscape(n)||this.regexp_eatClassSetReservedPunctuator(n)?!0:n.eat(98)?(n.lastIntValue=8,!0):(n.pos=e,!1);var t=n.current();return t<0||t===n.lookahead()&&Dst(t)||Nst(t)?!1:(n.advance(),n.lastIntValue=t,!0)};function Dst(n){return n===33||n>=35&&n<=38||n>=42&&n<=44||n===46||n>=58&&n<=64||n===94||n===96||n===126}function Nst(n){return n===40||n===41||n===45||n===47||n>=91&&n<=93||n>=123&&n<=125}ui.regexp_eatClassSetReservedPunctuator=function(n){var e=n.current();return Bst(e)?(n.lastIntValue=e,n.advance(),!0):!1};function Bst(n){return n===33||n===35||n===37||n===38||n===44||n===45||n>=58&&n<=62||n===64||n===96||n===126}ui.regexp_eatClassControlLetter=function(n){var e=n.current();return HL(e)||e===95?(n.lastIntValue=e%32,n.advance(),!0):!1};ui.regexp_eatHexEscapeSequence=function(n){var e=n.pos;if(n.eat(120)){if(this.regexp_eatFixedHexDigits(n,2))return!0;n.switchU&&n.raise("Invalid escape"),n.pos=e}return!1};ui.regexp_eatDecimalDigits=function(n){var e=n.pos,t=0;for(n.lastIntValue=0;HL(t=n.current());)n.lastIntValue=10*n.lastIntValue+(t-48),n.advance();return n.pos!==e};function HL(n){return n>=48&&n<=57}ui.regexp_eatHexDigits=function(n){var e=n.pos,t=0;for(n.lastIntValue=0;Sbe(t=n.current());)n.lastIntValue=16*n.lastIntValue+Mbe(t),n.advance();return n.pos!==e};function Sbe(n){return n>=48&&n<=57||n>=65&&n<=70||n>=97&&n<=102}function Mbe(n){return n>=65&&n<=70?10+(n-65):n>=97&&n<=102?10+(n-97):n-48}ui.regexp_eatLegacyOctalEscapeSequence=function(n){if(this.regexp_eatOctalDigit(n)){var e=n.lastIntValue;if(this.regexp_eatOctalDigit(n)){var t=n.lastIntValue;e<=3&&this.regexp_eatOctalDigit(n)?n.lastIntValue=e*64+t*8+n.lastIntValue:n.lastIntValue=e*8+t}else n.lastIntValue=e;return!0}return!1};ui.regexp_eatOctalDigit=function(n){var e=n.current();return Abe(e)?(n.lastIntValue=e-48,n.advance(),!0):(n.lastIntValue=0,!1)};function Abe(n){return n>=48&&n<=55}ui.regexp_eatFixedHexDigits=function(n,e){var t=n.pos;n.lastIntValue=0;for(var i=0;i<e;++i){var r=n.current();if(!Sbe(r))return n.pos=t,!1;n.lastIntValue=16*n.lastIntValue+Mbe(r),n.advance()}return!0};var l8=function(n){this.type=n.type,this.value=n.value,this.start=n.start,this.end=n.end,n.options.locations&&(this.loc=new kL(n,n.startLoc,n.endLoc)),n.options.ranges&&(this.range=[n.start,n.end])},jr=il.prototype;jr.next=function(n){!n&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new l8(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};jr.getToken=function(){return this.next(),new l8(this)};typeof Symbol<"u"&&(jr[Symbol.iterator]=function(){var n=this;return{next:function(){var e=n.getToken();return{done:e.type===me.eof,value:e}}}});jr.nextToken=function(){var n=this.curContext();if((!n||!n.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(me.eof);if(n.override)return n.override(this);this.readToken(this.fullCharCodeAtPos())};jr.readToken=function(n){return y0(n,this.options.ecmaVersion>=6)||n===92?this.readWord():this.getTokenFromCode(n)};jr.fullCharCodeAtPos=function(){var n=this.input.charCodeAt(this.pos);if(n<=55295||n>=56320)return n;var e=this.input.charCodeAt(this.pos+1);return e<=56319||e>=57344?n:(n<<10)+e-56613888};jr.skipBlockComment=function(){var n=this.options.onComment&&this.curPosition(),e=this.pos,t=this.input.indexOf("*/",this.pos+=2);if(t===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=t+2,this.options.locations)for(var i=void 0,r=e;(i=jxe(this.input,r,this.pos))>-1;)++this.curLine,r=this.lineStart=i;this.options.onComment&&this.options.onComment(!0,this.input.slice(e+2,t),e,this.pos,n,this.curPosition())};jr.skipLineComment=function(n){for(var e=this.pos,t=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=n);this.pos<this.input.length&&!_A(i);)i=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+n,this.pos),e,this.pos,t,this.curPosition())};jr.skipSpace=function(){e:for(;this.pos<this.input.length;){var n=this.input.charCodeAt(this.pos);switch(n){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(n>8&&n<14||n>=5760&&Yxe.test(String.fromCharCode(n)))++this.pos;else break e}}};jr.finishToken=function(n,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var t=this.type;this.type=n,this.value=e,this.updateContext(t)};jr.readToken_dot=function(){var n=this.input.charCodeAt(this.pos+1);if(n>=48&&n<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&n===46&&e===46?(this.pos+=3,this.finishToken(me.ellipsis)):(++this.pos,this.finishToken(me.dot))};jr.readToken_slash=function(){var n=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):n===61?this.finishOp(me.assign,2):this.finishOp(me.slash,1)};jr.readToken_mult_modulo_exp=function(n){var e=this.input.charCodeAt(this.pos+1),t=1,i=n===42?me.star:me.modulo;return this.options.ecmaVersion>=7&&n===42&&e===42&&(++t,i=me.starstar,e=this.input.charCodeAt(this.pos+2)),e===61?this.finishOp(me.assign,t+1):this.finishOp(i,t)};jr.readToken_pipe_amp=function(n){var e=this.input.charCodeAt(this.pos+1);if(e===n){if(this.options.ecmaVersion>=12){var t=this.input.charCodeAt(this.pos+2);if(t===61)return this.finishOp(me.assign,3)}return this.finishOp(n===124?me.logicalOR:me.logicalAND,2)}return e===61?this.finishOp(me.assign,2):this.finishOp(n===124?me.bitwiseOR:me.bitwiseAND,1)};jr.readToken_caret=function(){var n=this.input.charCodeAt(this.pos+1);return n===61?this.finishOp(me.assign,2):this.finishOp(me.bitwiseXOR,1)};jr.readToken_plus_min=function(n){var e=this.input.charCodeAt(this.pos+1);return e===n?e===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Jd.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(me.incDec,2):e===61?this.finishOp(me.assign,2):this.finishOp(me.plusMin,1)};jr.readToken_lt_gt=function(n){var e=this.input.charCodeAt(this.pos+1),t=1;return e===n?(t=n===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+t)===61?this.finishOp(me.assign,t+1):this.finishOp(me.bitShift,t)):e===33&&n===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(e===61&&(t=2),this.finishOp(me.relational,t))};jr.readToken_eq_excl=function(n){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(me.equality,this.input.charCodeAt(this.pos+2)===61?3:2):n===61&&e===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(me.arrow)):this.finishOp(n===61?me.eq:me.prefix,1)};jr.readToken_question=function(){var n=this.options.ecmaVersion;if(n>=11){var e=this.input.charCodeAt(this.pos+1);if(e===46){var t=this.input.charCodeAt(this.pos+2);if(t<48||t>57)return this.finishOp(me.questionDot,2)}if(e===63){if(n>=12){var i=this.input.charCodeAt(this.pos+2);if(i===61)return this.finishOp(me.assign,3)}return this.finishOp(me.coalesce,2)}}return this.finishOp(me.question,1)};jr.readToken_numberSign=function(){var n=this.options.ecmaVersion,e=35;if(n>=13&&(++this.pos,e=this.fullCharCodeAtPos(),y0(e,!0)||e===92))return this.finishToken(me.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+v0(e)+"'")};jr.getTokenFromCode=function(n){switch(n){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(me.parenL);case 41:return++this.pos,this.finishToken(me.parenR);case 59:return++this.pos,this.finishToken(me.semi);case 44:return++this.pos,this.finishToken(me.comma);case 91:return++this.pos,this.finishToken(me.bracketL);case 93:return++this.pos,this.finishToken(me.bracketR);case 123:return++this.pos,this.finishToken(me.braceL);case 125:return++this.pos,this.finishToken(me.braceR);case 58:return++this.pos,this.finishToken(me.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(me.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(e===120||e===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(e===111||e===79)return this.readRadixNumber(8);if(e===98||e===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(n);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(n);case 124:case 38:return this.readToken_pipe_amp(n);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(n);case 60:case 62:return this.readToken_lt_gt(n);case 61:case 33:return this.readToken_eq_excl(n);case 63:return this.readToken_question();case 126:return this.finishOp(me.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+v0(n)+"'")};jr.finishOp=function(n,e){var t=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(n,t)};jr.readRegexp=function(){for(var n,e,t=this.pos;;){this.pos>=this.input.length&&this.raise(t,"Unterminated regular expression");var i=this.input.charAt(this.pos);if(Jd.test(i)&&this.raise(t,"Unterminated regular expression"),n)n=!1;else{if(i==="[")e=!0;else if(i==="]"&&e)e=!1;else if(i==="/"&&!e)break;n=i==="\\"}++this.pos}var r=this.input.slice(t,this.pos);++this.pos;var s=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(s);var o=this.regexpState||(this.regexpState=new Vm(this));o.reset(t,r,a),this.validateRegExpFlags(o),this.validateRegExpPattern(o);var l=null;try{l=new RegExp(r,a)}catch{}return this.finishToken(me.regexp,{pattern:r,flags:a,value:l})};jr.readInt=function(n,e,t){for(var i=this.options.ecmaVersion>=12&&e===void 0,r=t&&this.input.charCodeAt(this.pos)===48,s=this.pos,a=0,o=0,l=0,u=e??1/0;l<u;++l,++this.pos){var c=this.input.charCodeAt(this.pos),d=void 0;if(i&&c===95){r&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),o===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),l===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),o=c;continue}if(c>=97?d=c-97+10:c>=65?d=c-65+10:c>=48&&c<=57?d=c-48:d=1/0,d>=n)break;o=c,a=a*n+d}return i&&o===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===s||e!=null&&this.pos-s!==e?null:a};function Fst(n,e){return e?parseInt(n,8):parseFloat(n.replace(/_/g,""))}function Tbe(n){return typeof BigInt!="function"?null:BigInt(n.replace(/_/g,""))}jr.readRadixNumber=function(n){var e=this.pos;this.pos+=2;var t=this.readInt(n);return t==null&&this.raise(this.start+2,"Expected number in radix "+n),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(t=Tbe(this.input.slice(e,this.pos)),++this.pos):y0(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(me.num,t)};jr.readNumber=function(n){var e=this.pos;!n&&this.readInt(10,void 0,!0)===null&&this.raise(e,"Invalid number");var t=this.pos-e>=2&&this.input.charCodeAt(e)===48;t&&this.strict&&this.raise(e,"Invalid number");var i=this.input.charCodeAt(this.pos);if(!t&&!n&&this.options.ecmaVersion>=11&&i===110){var r=Tbe(this.input.slice(e,this.pos));return++this.pos,y0(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(me.num,r)}t&&/[89]/.test(this.input.slice(e,this.pos))&&(t=!1),i===46&&!t&&(++this.pos,this.readInt(10),i=this.input.charCodeAt(this.pos)),(i===69||i===101)&&!t&&(i=this.input.charCodeAt(++this.pos),(i===43||i===45)&&++this.pos,this.readInt(10)===null&&this.raise(e,"Invalid number")),y0(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var s=Fst(this.input.slice(e,this.pos),t);return this.finishToken(me.num,s)};jr.readCodePoint=function(){var n=this.input.charCodeAt(this.pos),e;if(n===123){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e};jr.readString=function(n){for(var e="",t=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var i=this.input.charCodeAt(this.pos);if(i===n)break;i===92?(e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!1),t=this.pos):i===8232||i===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(_A(i)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(t,this.pos++),this.finishToken(me.string,e)};var Cbe={};jr.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(n){if(n===Cbe)this.readInvalidTemplateToken();else throw n}this.inTemplateElement=!1};jr.invalidStringToken=function(n,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Cbe;this.raise(n,e)};jr.readTmplToken=function(){for(var n="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var t=this.input.charCodeAt(this.pos);if(t===96||t===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===me.template||this.type===me.invalidTemplate)?t===36?(this.pos+=2,this.finishToken(me.dollarBraceL)):(++this.pos,this.finishToken(me.backQuote)):(n+=this.input.slice(e,this.pos),this.finishToken(me.template,n));if(t===92)n+=this.input.slice(e,this.pos),n+=this.readEscapedChar(!0),e=this.pos;else if(_A(t)){switch(n+=this.input.slice(e,this.pos),++this.pos,t){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:n+=`
`;break;default:n+=String.fromCharCode(t);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}};jr.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(me.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")};jr.readEscapedChar=function(n){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return v0(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),n){var t=this.pos-1;this.invalidStringToken(t,"Invalid escape sequence in template string")}default:if(e>=48&&e<=55){var i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],r=parseInt(i,8);return r>255&&(i=i.slice(0,-1),r=parseInt(i,8)),this.pos+=i.length-1,e=this.input.charCodeAt(this.pos),(i!=="0"||e===56||e===57)&&(this.strict||n)&&this.invalidStringToken(this.pos-1-i.length,n?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(r)}return _A(e)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(e)}};jr.readHexChar=function(n){var e=this.pos,t=this.readInt(16,n);return t===null&&this.invalidStringToken(e,"Bad character escape sequence"),t};jr.readWord1=function(){this.containsEsc=!1;for(var n="",e=!0,t=this.pos,i=this.options.ecmaVersion>=6;this.pos<this.input.length;){var r=this.fullCharCodeAtPos();if(BM(r,i))this.pos+=r<=65535?1:2;else if(r===92){this.containsEsc=!0,n+=this.input.slice(t,this.pos);var s=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(e?y0:BM)(a,i)||this.invalidStringToken(s,"Invalid Unicode escape"),n+=v0(a),t=this.pos}else break;e=!1}return n+this.input.slice(t,this.pos)};jr.readWord=function(){var n=this.readWord1(),e=me.name;return this.keywords.test(n)&&(e=t8[n]),this.finishToken(e,n)};var Lst="8.14.0";il.acorn={Parser:il,version:Lst,defaultOptions:bz,Position:CE,SourceLocation:kL,getLineInfo:$xe,Node:VL,TokenType:as,tokTypes:me,keywordTypes:t8,TokContext:Pf,tokContexts:Ga,isIdentifierChar:BM,isIdentifierStart:y0,Token:l8,isNewLine:_A,lineBreak:Jd,lineBreakG:ist,nonASCIIwhitespace:Yxe};function Ist(n,e){return il.parse(n,e)}var Gst=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wbe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Ost(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}var g$={},y$={},v$;function Ust(){return v$||(v$=1,(function(n){(function e(t){var i,r,s,a,o,l;function u(E){var R={},P,I;for(P in E)E.hasOwnProperty(P)&&(I=E[P],typeof I=="object"&&I!==null?R[P]=u(I):R[P]=I);return R}function c(E,R){var P,I,B,N;for(I=E.length,B=0;I;)P=I>>>1,N=B+P,R(E[N])?I=P:(B=N+1,I-=P+1);return B}i={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ChainExpression:"ChainExpression",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportExpression:"ImportExpression",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",PrivateIdentifier:"PrivateIdentifier",Program:"Program",Property:"Property",PropertyDefinition:"PropertyDefinition",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},s={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ChainExpression:["expression"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportExpression:["source"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],PrivateIdentifier:[],Program:["body"],Property:["key","value"],PropertyDefinition:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},a={},o={},l={},r={Break:a,Skip:o,Remove:l};function d(E,R){this.parent=E,this.key=R}d.prototype.replace=function(E){this.parent[this.key]=E},d.prototype.remove=function(){return Array.isArray(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)};function f(E,R,P,I){this.node=E,this.path=R,this.wrap=P,this.ref=I}function m(){}m.prototype.path=function(){var E,R,P,I,B,N;function U(V,W){if(Array.isArray(W))for(P=0,I=W.length;P<I;++P)V.push(W[P]);else V.push(W)}if(!this.__current.path)return null;for(B=[],E=2,R=this.__leavelist.length;E<R;++E)N=this.__leavelist[E],U(B,N.path);return U(B,this.__current.path),B},m.prototype.type=function(){var E=this.current();return E.type||this.__current.wrap},m.prototype.parents=function(){var E,R,P;for(P=[],E=1,R=this.__leavelist.length;E<R;++E)P.push(this.__leavelist[E].node);return P},m.prototype.current=function(){return this.__current.node},m.prototype.__execute=function(E,R){var P,I;return I=void 0,P=this.__current,this.__current=R,this.__state=null,E&&(I=E.call(this,R.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=P,I},m.prototype.notify=function(E){this.__state=E},m.prototype.skip=function(){this.notify(o)},m.prototype.break=function(){this.notify(a)},m.prototype.remove=function(){this.notify(l)},m.prototype.__initialize=function(E,R){this.visitor=R,this.root=E,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback=null,R.fallback==="iteration"?this.__fallback=Object.keys:typeof R.fallback=="function"&&(this.__fallback=R.fallback),this.__keys=s,R.keys&&(this.__keys=Object.assign(Object.create(this.__keys),R.keys))};function y(E){return E==null?!1:typeof E=="object"&&typeof E.type=="string"}function _(E,R){return(E===i.ObjectExpression||E===i.ObjectPattern)&&R==="properties"}function S(E,R){for(var P=E.length-1;P>=0;--P)if(E[P].node===R)return!0;return!1}m.prototype.traverse=function(E,R){var P,I,B,N,U,V,W,K,q,j,te,he;for(this.__initialize(E,R),he={},P=this.__worklist,I=this.__leavelist,P.push(new f(E,null,null,null)),I.push(new f(null,null,null,null));P.length;){if(B=P.pop(),B===he){if(B=I.pop(),V=this.__execute(R.leave,B),this.__state===a||V===a)return;continue}if(B.node){if(V=this.__execute(R.enter,B),this.__state===a||V===a)return;if(P.push(he),I.push(B),this.__state===o||V===o)continue;if(N=B.node,U=N.type||B.wrap,j=this.__keys[U],!j)if(this.__fallback)j=this.__fallback(N);else throw new Error("Unknown node type "+U+".");for(K=j.length;(K-=1)>=0;)if(W=j[K],te=N[W],!!te){if(Array.isArray(te)){for(q=te.length;(q-=1)>=0;)if(te[q]&&!S(I,te[q])){if(_(U,j[K]))B=new f(te[q],[W,q],"Property",null);else if(y(te[q]))B=new f(te[q],[W,q],null,null);else continue;P.push(B)}}else if(y(te)){if(S(I,te))continue;P.push(new f(te,W,null,null))}}}}},m.prototype.replace=function(E,R){var P,I,B,N,U,V,W,K,q,j,te,he,_e;function Be(ue){var ce,Ce,Oe,nt;if(ue.ref.remove()){for(Ce=ue.ref.key,nt=ue.ref.parent,ce=P.length;ce--;)if(Oe=P[ce],Oe.ref&&Oe.ref.parent===nt){if(Oe.ref.key<Ce)break;--Oe.ref.key}}}for(this.__initialize(E,R),te={},P=this.__worklist,I=this.__leavelist,he={root:E},V=new f(E,null,null,new d(he,"root")),P.push(V),I.push(V);P.length;){if(V=P.pop(),V===te){if(V=I.pop(),U=this.__execute(R.leave,V),U!==void 0&&U!==a&&U!==o&&U!==l&&V.ref.replace(U),(this.__state===l||U===l)&&Be(V),this.__state===a||U===a)return he.root;continue}if(U=this.__execute(R.enter,V),U!==void 0&&U!==a&&U!==o&&U!==l&&(V.ref.replace(U),V.node=U),(this.__state===l||U===l)&&(Be(V),V.node=null),this.__state===a||U===a)return he.root;if(B=V.node,!!B&&(P.push(te),I.push(V),!(this.__state===o||U===o))){if(N=B.type||V.wrap,q=this.__keys[N],!q)if(this.__fallback)q=this.__fallback(B);else throw new Error("Unknown node type "+N+".");for(W=q.length;(W-=1)>=0;)if(_e=q[W],j=B[_e],!!j)if(Array.isArray(j)){for(K=j.length;(K-=1)>=0;)if(j[K]){if(_(N,q[W]))V=new f(j[K],[_e,K],"Property",new d(j,K));else if(y(j[K]))V=new f(j[K],[_e,K],null,new d(j,K));else continue;P.push(V)}}else y(j)&&P.push(new f(j,_e,null,new d(B,_e)))}}return he.root};function b(E,R){var P=new m;return P.traverse(E,R)}function M(E,R){var P=new m;return P.replace(E,R)}function w(E,R){var P;return P=c(R,function(I){return I.range[0]>E.range[0]}),E.extendedRange=[E.range[0],E.range[1]],P!==R.length&&(E.extendedRange[1]=R[P].range[0]),P-=1,P>=0&&(E.extendedRange[0]=R[P].range[1]),E}function T(E,R,P){var I=[],B,N,U,V;if(!E.range)throw new Error("attachComments needs range information");if(!P.length){if(R.length){for(U=0,N=R.length;U<N;U+=1)B=u(R[U]),B.extendedRange=[0,E.range[0]],I.push(B);E.leadingComments=I}return E}for(U=0,N=R.length;U<N;U+=1)I.push(w(u(R[U]),P));return V=0,b(E,{enter:function(W){for(var K;V<I.length&&(K=I[V],!(K.extendedRange[1]>W.range[0]));)K.extendedRange[1]===W.range[0]?(W.leadingComments||(W.leadingComments=[]),W.leadingComments.push(K),I.splice(V,1)):V+=1;if(V===I.length)return r.Break;if(I[V].extendedRange[0]>W.range[1])return r.Skip}}),V=0,b(E,{leave:function(W){for(var K;V<I.length&&(K=I[V],!(W.range[1]<K.extendedRange[0]));)W.range[1]===K.extendedRange[0]?(W.trailingComments||(W.trailingComments=[]),W.trailingComments.push(K),I.splice(V,1)):V+=1;if(V===I.length)return r.Break;if(I[V].extendedRange[0]>W.range[1])return r.Skip}}),E}return t.Syntax=i,t.traverse=b,t.replace=M,t.attachComments=T,t.VisitorKeys=s,t.VisitorOption=r,t.Controller=m,t.cloneEnvironment=function(){return e({})},t})(n)})(y$)),y$}var cN={},x$={exports:{}},b$;function kst(){return b$||(b$=1,(function(){function n(a){if(a==null)return!1;switch(a.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1}function e(a){if(a==null)return!1;switch(a.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1}function t(a){if(a==null)return!1;switch(a.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function i(a){return t(a)||a!=null&&a.type==="FunctionDeclaration"}function r(a){switch(a.type){case"IfStatement":return a.alternate!=null?a.alternate:a.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return a.body}return null}function s(a){var o;if(a.type!=="IfStatement"||a.alternate==null)return!1;o=a.consequent;do{if(o.type==="IfStatement"&&o.alternate==null)return!0;o=r(o)}while(o);return!1}x$.exports={isExpression:n,isStatement:t,isIterationStatement:e,isSourceElement:i,isProblematicIfStatement:s,trailingStatement:r}})()),x$.exports}var _$={exports:{}},S$;function Ebe(){return S$||(S$=1,(function(){var n,e,t,i,r,s;e={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};function a(S){return 48<=S&&S<=57}function o(S){return 48<=S&&S<=57||97<=S&&S<=102||65<=S&&S<=70}function l(S){return S>=48&&S<=55}t=[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function u(S){return S===32||S===9||S===11||S===12||S===160||S>=5760&&t.indexOf(S)>=0}function c(S){return S===10||S===13||S===8232||S===8233}function d(S){if(S<=65535)return String.fromCharCode(S);var b=String.fromCharCode(Math.floor((S-65536)/1024)+55296),M=String.fromCharCode((S-65536)%1024+56320);return b+M}for(i=new Array(128),s=0;s<128;++s)i[s]=s>=97&&s<=122||s>=65&&s<=90||s===36||s===95;for(r=new Array(128),s=0;s<128;++s)r[s]=s>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57||s===36||s===95;function f(S){return S<128?i[S]:e.NonAsciiIdentifierStart.test(d(S))}function m(S){return S<128?r[S]:e.NonAsciiIdentifierPart.test(d(S))}function y(S){return S<128?i[S]:n.NonAsciiIdentifierStart.test(d(S))}function _(S){return S<128?r[S]:n.NonAsciiIdentifierPart.test(d(S))}_$.exports={isDecimalDigit:a,isHexDigit:o,isOctalDigit:l,isWhiteSpace:u,isLineTerminator:c,isIdentifierStartES5:f,isIdentifierPartES5:m,isIdentifierStartES6:y,isIdentifierPartES6:_}})()),_$.exports}var M$={exports:{}},A$;function zst(){return A$||(A$=1,(function(){var n=Ebe();function e(f){switch(f){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}function t(f,m){return!m&&f==="yield"?!1:i(f,m)}function i(f,m){if(m&&e(f))return!0;switch(f.length){case 2:return f==="if"||f==="in"||f==="do";case 3:return f==="var"||f==="for"||f==="new"||f==="try";case 4:return f==="this"||f==="else"||f==="case"||f==="void"||f==="with"||f==="enum";case 5:return f==="while"||f==="break"||f==="catch"||f==="throw"||f==="const"||f==="yield"||f==="class"||f==="super";case 6:return f==="return"||f==="typeof"||f==="delete"||f==="switch"||f==="export"||f==="import";case 7:return f==="default"||f==="finally"||f==="extends";case 8:return f==="function"||f==="continue"||f==="debugger";case 10:return f==="instanceof";default:return!1}}function r(f,m){return f==="null"||f==="true"||f==="false"||t(f,m)}function s(f,m){return f==="null"||f==="true"||f==="false"||i(f,m)}function a(f){return f==="eval"||f==="arguments"}function o(f){var m,y,_;if(f.length===0||(_=f.charCodeAt(0),!n.isIdentifierStartES5(_)))return!1;for(m=1,y=f.length;m<y;++m)if(_=f.charCodeAt(m),!n.isIdentifierPartES5(_))return!1;return!0}function l(f,m){return(f-55296)*1024+(m-56320)+65536}function u(f){var m,y,_,S,b;if(f.length===0)return!1;for(b=n.isIdentifierStartES6,m=0,y=f.length;m<y;++m){if(_=f.charCodeAt(m),55296<=_&&_<=56319){if(++m,m>=y||(S=f.charCodeAt(m),!(56320<=S&&S<=57343)))return!1;_=l(_,S)}if(!b(_))return!1;b=n.isIdentifierPartES6}return!0}function c(f,m){return o(f)&&!r(f,m)}function d(f,m){return u(f)&&!s(f,m)}M$.exports={isKeywordES5:t,isKeywordES6:i,isReservedWordES5:r,isReservedWordES6:s,isRestrictedWord:a,isIdentifierNameES5:o,isIdentifierNameES6:u,isIdentifierES5:c,isIdentifierES6:d}})()),M$.exports}var T$;function Vst(){return T$||(T$=1,(function(){cN.ast=kst(),cN.code=Ebe(),cN.keyword=zst()})()),cN}var hN={},BU={},dN={},fN={},C$;function Hst(){if(C$)return fN;C$=1;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return fN.encode=function(e){if(0<=e&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},fN.decode=function(e){var t=65,i=90,r=97,s=122,a=48,o=57,l=43,u=47,c=26,d=52;return t<=e&&e<=i?e-t:r<=e&&e<=s?e-r+c:a<=e&&e<=o?e-a+d:e==l?62:e==u?63:-1},fN}var w$;function Rbe(){if(w$)return dN;w$=1;var n=Hst(),e=5,t=1<<e,i=t-1,r=t;function s(o){return o<0?(-o<<1)+1:(o<<1)+0}function a(o){var l=(o&1)===1,u=o>>1;return l?-u:u}return dN.encode=function(o){var l="",u,c=s(o);do u=c&i,c>>>=e,c>0&&(u|=r),l+=n.encode(u);while(c>0);return l},dN.decode=function(o,l,u){var c=o.length,d=0,f=0,m,y;do{if(l>=c)throw new Error("Expected more digits in base 64 VLQ value.");if(y=n.decode(o.charCodeAt(l++)),y===-1)throw new Error("Invalid base64 digit: "+o.charAt(l-1));m=!!(y&r),y&=i,d=d+(y<<f),f+=e}while(m);u.value=a(d),u.rest=l},dN}var E$={},R$;function s3(){return R$||(R$=1,(function(n){function e(T,E,R){if(E in T)return T[E];if(arguments.length===3)return R;throw new Error('"'+E+'" is a required argument.')}n.getArg=e;var t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,i=/^data:.+\,.+$/;function r(T){var E=T.match(t);return E?{scheme:E[1],auth:E[2],host:E[3],port:E[4],path:E[5]}:null}n.urlParse=r;function s(T){var E="";return T.scheme&&(E+=T.scheme+":"),E+="//",T.auth&&(E+=T.auth+"@"),T.host&&(E+=T.host),T.port&&(E+=":"+T.port),T.path&&(E+=T.path),E}n.urlGenerate=s;function a(T){var E=T,R=r(T);if(R){if(!R.path)return T;E=R.path}for(var P=n.isAbsolute(E),I=E.split(/\/+/),B,N=0,U=I.length-1;U>=0;U--)B=I[U],B==="."?I.splice(U,1):B===".."?N++:N>0&&(B===""?(I.splice(U+1,N),N=0):(I.splice(U,2),N--));return E=I.join("/"),E===""&&(E=P?"/":"."),R?(R.path=E,s(R)):E}n.normalize=a;function o(T,E){T===""&&(T="."),E===""&&(E=".");var R=r(E),P=r(T);if(P&&(T=P.path||"/"),R&&!R.scheme)return P&&(R.scheme=P.scheme),s(R);if(R||E.match(i))return E;if(P&&!P.host&&!P.path)return P.host=E,s(P);var I=E.charAt(0)==="/"?E:a(T.replace(/\/+$/,"")+"/"+E);return P?(P.path=I,s(P)):I}n.join=o,n.isAbsolute=function(T){return T.charAt(0)==="/"||t.test(T)};function l(T,E){T===""&&(T="."),T=T.replace(/\/$/,"");for(var R=0;E.indexOf(T+"/")!==0;){var P=T.lastIndexOf("/");if(P<0||(T=T.slice(0,P),T.match(/^([^\/]+:\/)?\/*$/)))return E;++R}return Array(R+1).join("../")+E.substr(T.length+1)}n.relative=l;var u=(function(){var T=Object.create(null);return!("__proto__"in T)})();function c(T){return T}function d(T){return m(T)?"$"+T:T}n.toSetString=u?c:d;function f(T){return m(T)?T.slice(1):T}n.fromSetString=u?c:f;function m(T){if(!T)return!1;var E=T.length;if(E<9||T.charCodeAt(E-1)!==95||T.charCodeAt(E-2)!==95||T.charCodeAt(E-3)!==111||T.charCodeAt(E-4)!==116||T.charCodeAt(E-5)!==111||T.charCodeAt(E-6)!==114||T.charCodeAt(E-7)!==112||T.charCodeAt(E-8)!==95||T.charCodeAt(E-9)!==95)return!1;for(var R=E-10;R>=0;R--)if(T.charCodeAt(R)!==36)return!1;return!0}function y(T,E,R){var P=S(T.source,E.source);return P!==0||(P=T.originalLine-E.originalLine,P!==0)||(P=T.originalColumn-E.originalColumn,P!==0||R)||(P=T.generatedColumn-E.generatedColumn,P!==0)||(P=T.generatedLine-E.generatedLine,P!==0)?P:S(T.name,E.name)}n.compareByOriginalPositions=y;function _(T,E,R){var P=T.generatedLine-E.generatedLine;return P!==0||(P=T.generatedColumn-E.generatedColumn,P!==0||R)||(P=S(T.source,E.source),P!==0)||(P=T.originalLine-E.originalLine,P!==0)||(P=T.originalColumn-E.originalColumn,P!==0)?P:S(T.name,E.name)}n.compareByGeneratedPositionsDeflated=_;function S(T,E){return T===E?0:T===null?1:E===null?-1:T>E?1:-1}function b(T,E){var R=T.generatedLine-E.generatedLine;return R!==0||(R=T.generatedColumn-E.generatedColumn,R!==0)||(R=S(T.source,E.source),R!==0)||(R=T.originalLine-E.originalLine,R!==0)||(R=T.originalColumn-E.originalColumn,R!==0)?R:S(T.name,E.name)}n.compareByGeneratedPositionsInflated=b;function M(T){return JSON.parse(T.replace(/^\)]}'[^\n]*\n/,""))}n.parseSourceMapInput=M;function w(T,E,R){if(E=E||"",T&&(T[T.length-1]!=="/"&&E[0]!=="/"&&(T+="/"),E=T+E),R){var P=r(R);if(!P)throw new Error("sourceMapURL could not be parsed");if(P.path){var I=P.path.lastIndexOf("/");I>=0&&(P.path=P.path.substring(0,I+1))}E=o(s(P),E)}return a(E)}n.computeSourceURL=w})(E$)),E$}var FU={},P$;function Pbe(){if(P$)return FU;P$=1;var n=s3(),e=Object.prototype.hasOwnProperty,t=typeof Map<"u";function i(){this._array=[],this._set=t?new Map:Object.create(null)}return i.fromArray=function(r,s){for(var a=new i,o=0,l=r.length;o<l;o++)a.add(r[o],s);return a},i.prototype.size=function(){return t?this._set.size:Object.getOwnPropertyNames(this._set).length},i.prototype.add=function(r,s){var a=t?r:n.toSetString(r),o=t?this.has(r):e.call(this._set,a),l=this._array.length;(!o||s)&&this._array.push(r),o||(t?this._set.set(r,l):this._set[a]=l)},i.prototype.has=function(r){if(t)return this._set.has(r);var s=n.toSetString(r);return e.call(this._set,s)},i.prototype.indexOf=function(r){if(t){var s=this._set.get(r);if(s>=0)return s}else{var a=n.toSetString(r);if(e.call(this._set,a))return this._set[a]}throw new Error('"'+r+'" is not in the set.')},i.prototype.at=function(r){if(r>=0&&r<this._array.length)return this._array[r];throw new Error("No element indexed by "+r)},i.prototype.toArray=function(){return this._array.slice()},FU.ArraySet=i,FU}var LU={},D$;function Xst(){if(D$)return LU;D$=1;var n=s3();function e(i,r){var s=i.generatedLine,a=r.generatedLine,o=i.generatedColumn,l=r.generatedColumn;return a>s||a==s&&l>=o||n.compareByGeneratedPositionsInflated(i,r)<=0}function t(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return t.prototype.unsortedForEach=function(i,r){this._array.forEach(i,r)},t.prototype.add=function(i){e(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))},t.prototype.toArray=function(){return this._sorted||(this._array.sort(n.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},LU.MappingList=t,LU}var N$;function Dbe(){if(N$)return BU;N$=1;var n=Rbe(),e=s3(),t=Pbe().ArraySet,i=Xst().MappingList;function r(s){s||(s={}),this._file=e.getArg(s,"file",null),this._sourceRoot=e.getArg(s,"sourceRoot",null),this._skipValidation=e.getArg(s,"skipValidation",!1),this._sources=new t,this._names=new t,this._mappings=new i,this._sourcesContents=null}return r.prototype._version=3,r.fromSourceMap=function(s){var a=s.sourceRoot,o=new r({file:s.file,sourceRoot:a});return s.eachMapping(function(l){var u={generated:{line:l.generatedLine,column:l.generatedColumn}};l.source!=null&&(u.source=l.source,a!=null&&(u.source=e.relative(a,u.source)),u.original={line:l.originalLine,column:l.originalColumn},l.name!=null&&(u.name=l.name)),o.addMapping(u)}),s.sources.forEach(function(l){var u=l;a!==null&&(u=e.relative(a,l)),o._sources.has(u)||o._sources.add(u);var c=s.sourceContentFor(l);c!=null&&o.setSourceContent(l,c)}),o},r.prototype.addMapping=function(s){var a=e.getArg(s,"generated"),o=e.getArg(s,"original",null),l=e.getArg(s,"source",null),u=e.getArg(s,"name",null);this._skipValidation||this._validateMapping(a,o,l,u),l!=null&&(l=String(l),this._sources.has(l)||this._sources.add(l)),u!=null&&(u=String(u),this._names.has(u)||this._names.add(u)),this._mappings.add({generatedLine:a.line,generatedColumn:a.column,originalLine:o!=null&&o.line,originalColumn:o!=null&&o.column,source:l,name:u})},r.prototype.setSourceContent=function(s,a){var o=s;this._sourceRoot!=null&&(o=e.relative(this._sourceRoot,o)),a!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(o)]=a):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(o)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},r.prototype.applySourceMap=function(s,a,o){var l=a;if(a==null){if(s.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);l=s.file}var u=this._sourceRoot;u!=null&&(l=e.relative(u,l));var c=new t,d=new t;this._mappings.unsortedForEach(function(f){if(f.source===l&&f.originalLine!=null){var m=s.originalPositionFor({line:f.originalLine,column:f.originalColumn});m.source!=null&&(f.source=m.source,o!=null&&(f.source=e.join(o,f.source)),u!=null&&(f.source=e.relative(u,f.source)),f.originalLine=m.line,f.originalColumn=m.column,m.name!=null&&(f.name=m.name))}var y=f.source;y!=null&&!c.has(y)&&c.add(y);var _=f.name;_!=null&&!d.has(_)&&d.add(_)},this),this._sources=c,this._names=d,s.sources.forEach(function(f){var m=s.sourceContentFor(f);m!=null&&(o!=null&&(f=e.join(o,f)),u!=null&&(f=e.relative(u,f)),this.setSourceContent(f,m))},this)},r.prototype._validateMapping=function(s,a,o,l){if(a&&typeof a.line!="number"&&typeof a.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(s&&"line"in s&&"column"in s&&s.line>0&&s.column>=0&&!a&&!o&&!l)){if(s&&"line"in s&&"column"in s&&a&&"line"in a&&"column"in a&&s.line>0&&s.column>=0&&a.line>0&&a.column>=0&&o)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:s,source:o,original:a,name:l}))}},r.prototype._serializeMappings=function(){for(var s=0,a=1,o=0,l=0,u=0,c=0,d="",f,m,y,_,S=this._mappings.toArray(),b=0,M=S.length;b<M;b++){if(m=S[b],f="",m.generatedLine!==a)for(s=0;m.generatedLine!==a;)f+=";",a++;else if(b>0){if(!e.compareByGeneratedPositionsInflated(m,S[b-1]))continue;f+=","}f+=n.encode(m.generatedColumn-s),s=m.generatedColumn,m.source!=null&&(_=this._sources.indexOf(m.source),f+=n.encode(_-c),c=_,f+=n.encode(m.originalLine-1-l),l=m.originalLine-1,f+=n.encode(m.originalColumn-o),o=m.originalColumn,m.name!=null&&(y=this._names.indexOf(m.name),f+=n.encode(y-u),u=y)),d+=f}return d},r.prototype._generateSourcesContent=function(s,a){return s.map(function(o){if(!this._sourcesContents)return null;a!=null&&(o=e.relative(a,o));var l=e.toSetString(o);return Object.prototype.hasOwnProperty.call(this._sourcesContents,l)?this._sourcesContents[l]:null},this)},r.prototype.toJSON=function(){var s={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(s.file=this._file),this._sourceRoot!=null&&(s.sourceRoot=this._sourceRoot),this._sourcesContents&&(s.sourcesContent=this._generateSourcesContent(s.sources,s.sourceRoot)),s},r.prototype.toString=function(){return JSON.stringify(this.toJSON())},BU.SourceMapGenerator=r,BU}var GC={},B$={},F$;function Wst(){return F$||(F$=1,(function(n){n.GREATEST_LOWER_BOUND=1,n.LEAST_UPPER_BOUND=2;function e(t,i,r,s,a,o){var l=Math.floor((i-t)/2)+t,u=a(r,s[l],!0);return u===0?l:u>0?i-l>1?e(l,i,r,s,a,o):o==n.LEAST_UPPER_BOUND?i<s.length?i:-1:l:l-t>1?e(t,l,r,s,a,o):o==n.LEAST_UPPER_BOUND?l:t<0?-1:t}n.search=function(t,i,r,s){if(i.length===0)return-1;var a=e(-1,i.length,t,i,r,s||n.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&r(i[a],i[a-1],!0)===0;)--a;return a}})(B$)),B$}var IU={},L$;function Zst(){if(L$)return IU;L$=1;function n(i,r,s){var a=i[r];i[r]=i[s],i[s]=a}function e(i,r){return Math.round(i+Math.random()*(r-i))}function t(i,r,s,a){if(s<a){var o=e(s,a),l=s-1;n(i,o,a);for(var u=i[a],c=s;c<a;c++)r(i[c],u)<=0&&(l+=1,n(i,l,c));n(i,l+1,c);var d=l+1;t(i,r,s,d-1),t(i,r,d+1,a)}}return IU.quickSort=function(i,r){t(i,r,0,i.length-1)},IU}var I$;function jst(){if(I$)return GC;I$=1;var n=s3(),e=Wst(),t=Pbe().ArraySet,i=Rbe(),r=Zst().quickSort;function s(u,c){var d=u;return typeof u=="string"&&(d=n.parseSourceMapInput(u)),d.sections!=null?new l(d,c):new a(d,c)}s.fromSourceMap=function(u,c){return a.fromSourceMap(u,c)},s.prototype._version=3,s.prototype.__generatedMappings=null,Object.defineProperty(s.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),s.prototype.__originalMappings=null,Object.defineProperty(s.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),s.prototype._charIsMappingSeparator=function(u,c){var d=u.charAt(c);return d===";"||d===","},s.prototype._parseMappings=function(u,c){throw new Error("Subclasses must implement _parseMappings")},s.GENERATED_ORDER=1,s.ORIGINAL_ORDER=2,s.GREATEST_LOWER_BOUND=1,s.LEAST_UPPER_BOUND=2,s.prototype.eachMapping=function(u,c,d){var f=c||null,m=d||s.GENERATED_ORDER,y;switch(m){case s.GENERATED_ORDER:y=this._generatedMappings;break;case s.ORIGINAL_ORDER:y=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var _=this.sourceRoot;y.map(function(S){var b=S.source===null?null:this._sources.at(S.source);return b=n.computeSourceURL(_,b,this._sourceMapURL),{source:b,generatedLine:S.generatedLine,generatedColumn:S.generatedColumn,originalLine:S.originalLine,originalColumn:S.originalColumn,name:S.name===null?null:this._names.at(S.name)}},this).forEach(u,f)},s.prototype.allGeneratedPositionsFor=function(u){var c=n.getArg(u,"line"),d={source:n.getArg(u,"source"),originalLine:c,originalColumn:n.getArg(u,"column",0)};if(d.source=this._findSourceIndex(d.source),d.source<0)return[];var f=[],m=this._findMapping(d,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,e.LEAST_UPPER_BOUND);if(m>=0){var y=this._originalMappings[m];if(u.column===void 0)for(var _=y.originalLine;y&&y.originalLine===_;)f.push({line:n.getArg(y,"generatedLine",null),column:n.getArg(y,"generatedColumn",null),lastColumn:n.getArg(y,"lastGeneratedColumn",null)}),y=this._originalMappings[++m];else for(var S=y.originalColumn;y&&y.originalLine===c&&y.originalColumn==S;)f.push({line:n.getArg(y,"generatedLine",null),column:n.getArg(y,"generatedColumn",null),lastColumn:n.getArg(y,"lastGeneratedColumn",null)}),y=this._originalMappings[++m]}return f},GC.SourceMapConsumer=s;function a(u,c){var d=u;typeof u=="string"&&(d=n.parseSourceMapInput(u));var f=n.getArg(d,"version"),m=n.getArg(d,"sources"),y=n.getArg(d,"names",[]),_=n.getArg(d,"sourceRoot",null),S=n.getArg(d,"sourcesContent",null),b=n.getArg(d,"mappings"),M=n.getArg(d,"file",null);if(f!=this._version)throw new Error("Unsupported version: "+f);_&&(_=n.normalize(_)),m=m.map(String).map(n.normalize).map(function(w){return _&&n.isAbsolute(_)&&n.isAbsolute(w)?n.relative(_,w):w}),this._names=t.fromArray(y.map(String),!0),this._sources=t.fromArray(m,!0),this._absoluteSources=this._sources.toArray().map(function(w){return n.computeSourceURL(_,w,c)}),this.sourceRoot=_,this.sourcesContent=S,this._mappings=b,this._sourceMapURL=c,this.file=M}a.prototype=Object.create(s.prototype),a.prototype.consumer=s,a.prototype._findSourceIndex=function(u){var c=u;if(this.sourceRoot!=null&&(c=n.relative(this.sourceRoot,c)),this._sources.has(c))return this._sources.indexOf(c);var d;for(d=0;d<this._absoluteSources.length;++d)if(this._absoluteSources[d]==u)return d;return-1},a.fromSourceMap=function(u,c){var d=Object.create(a.prototype),f=d._names=t.fromArray(u._names.toArray(),!0),m=d._sources=t.fromArray(u._sources.toArray(),!0);d.sourceRoot=u._sourceRoot,d.sourcesContent=u._generateSourcesContent(d._sources.toArray(),d.sourceRoot),d.file=u._file,d._sourceMapURL=c,d._absoluteSources=d._sources.toArray().map(function(E){return n.computeSourceURL(d.sourceRoot,E,c)});for(var y=u._mappings.toArray().slice(),_=d.__generatedMappings=[],S=d.__originalMappings=[],b=0,M=y.length;b<M;b++){var w=y[b],T=new o;T.generatedLine=w.generatedLine,T.generatedColumn=w.generatedColumn,w.source&&(T.source=m.indexOf(w.source),T.originalLine=w.originalLine,T.originalColumn=w.originalColumn,w.name&&(T.name=f.indexOf(w.name)),S.push(T)),_.push(T)}return r(d.__originalMappings,n.compareByOriginalPositions),d},a.prototype._version=3,Object.defineProperty(a.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function o(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}a.prototype._parseMappings=function(u,c){for(var d=1,f=0,m=0,y=0,_=0,S=0,b=u.length,M=0,w={},T={},E=[],R=[],P,I,B,N,U;M<b;)if(u.charAt(M)===";")d++,M++,f=0;else if(u.charAt(M)===",")M++;else{for(P=new o,P.generatedLine=d,N=M;N<b&&!this._charIsMappingSeparator(u,N);N++);if(I=u.slice(M,N),B=w[I],B)M+=I.length;else{for(B=[];M<N;)i.decode(u,M,T),U=T.value,M=T.rest,B.push(U);if(B.length===2)throw new Error("Found a source, but no line and column");if(B.length===3)throw new Error("Found a source and line, but no column");w[I]=B}P.generatedColumn=f+B[0],f=P.generatedColumn,B.length>1&&(P.source=_+B[1],_+=B[1],P.originalLine=m+B[2],m=P.originalLine,P.originalLine+=1,P.originalColumn=y+B[3],y=P.originalColumn,B.length>4&&(P.name=S+B[4],S+=B[4])),R.push(P),typeof P.originalLine=="number"&&E.push(P)}r(R,n.compareByGeneratedPositionsDeflated),this.__generatedMappings=R,r(E,n.compareByOriginalPositions),this.__originalMappings=E},a.prototype._findMapping=function(u,c,d,f,m,y){if(u[d]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+u[d]);if(u[f]<0)throw new TypeError("Column must be greater than or equal to 0, got "+u[f]);return e.search(u,c,m,y)},a.prototype.computeColumnSpans=function(){for(var u=0;u<this._generatedMappings.length;++u){var c=this._generatedMappings[u];if(u+1<this._generatedMappings.length){var d=this._generatedMappings[u+1];if(c.generatedLine===d.generatedLine){c.lastGeneratedColumn=d.generatedColumn-1;continue}}c.lastGeneratedColumn=1/0}},a.prototype.originalPositionFor=function(u){var c={generatedLine:n.getArg(u,"line"),generatedColumn:n.getArg(u,"column")},d=this._findMapping(c,this._generatedMappings,"generatedLine","generatedColumn",n.compareByGeneratedPositionsDeflated,n.getArg(u,"bias",s.GREATEST_LOWER_BOUND));if(d>=0){var f=this._generatedMappings[d];if(f.generatedLine===c.generatedLine){var m=n.getArg(f,"source",null);m!==null&&(m=this._sources.at(m),m=n.computeSourceURL(this.sourceRoot,m,this._sourceMapURL));var y=n.getArg(f,"name",null);return y!==null&&(y=this._names.at(y)),{source:m,line:n.getArg(f,"originalLine",null),column:n.getArg(f,"originalColumn",null),name:y}}}return{source:null,line:null,column:null,name:null}},a.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(u){return u==null}):!1},a.prototype.sourceContentFor=function(u,c){if(!this.sourcesContent)return null;var d=this._findSourceIndex(u);if(d>=0)return this.sourcesContent[d];var f=u;this.sourceRoot!=null&&(f=n.relative(this.sourceRoot,f));var m;if(this.sourceRoot!=null&&(m=n.urlParse(this.sourceRoot))){var y=f.replace(/^file:\/\//,"");if(m.scheme=="file"&&this._sources.has(y))return this.sourcesContent[this._sources.indexOf(y)];if((!m.path||m.path=="/")&&this._sources.has("/"+f))return this.sourcesContent[this._sources.indexOf("/"+f)]}if(c)return null;throw new Error('"'+f+'" is not in the SourceMap.')},a.prototype.generatedPositionFor=function(u){var c=n.getArg(u,"source");if(c=this._findSourceIndex(c),c<0)return{line:null,column:null,lastColumn:null};var d={source:c,originalLine:n.getArg(u,"line"),originalColumn:n.getArg(u,"column")},f=this._findMapping(d,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,n.getArg(u,"bias",s.GREATEST_LOWER_BOUND));if(f>=0){var m=this._originalMappings[f];if(m.source===d.source)return{line:n.getArg(m,"generatedLine",null),column:n.getArg(m,"generatedColumn",null),lastColumn:n.getArg(m,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},GC.BasicSourceMapConsumer=a;function l(u,c){var d=u;typeof u=="string"&&(d=n.parseSourceMapInput(u));var f=n.getArg(d,"version"),m=n.getArg(d,"sections");if(f!=this._version)throw new Error("Unsupported version: "+f);this._sources=new t,this._names=new t;var y={line:-1,column:0};this._sections=m.map(function(_){if(_.url)throw new Error("Support for url field in sections not implemented.");var S=n.getArg(_,"offset"),b=n.getArg(S,"line"),M=n.getArg(S,"column");if(b<y.line||b===y.line&&M<y.column)throw new Error("Section offsets must be ordered and non-overlapping.");return y=S,{generatedOffset:{generatedLine:b+1,generatedColumn:M+1},consumer:new s(n.getArg(_,"map"),c)}})}return l.prototype=Object.create(s.prototype),l.prototype.constructor=s,l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){for(var u=[],c=0;c<this._sections.length;c++)for(var d=0;d<this._sections[c].consumer.sources.length;d++)u.push(this._sections[c].consumer.sources[d]);return u}}),l.prototype.originalPositionFor=function(u){var c={generatedLine:n.getArg(u,"line"),generatedColumn:n.getArg(u,"column")},d=e.search(c,this._sections,function(m,y){var _=m.generatedLine-y.generatedOffset.generatedLine;return _||m.generatedColumn-y.generatedOffset.generatedColumn}),f=this._sections[d];return f?f.consumer.originalPositionFor({line:c.generatedLine-(f.generatedOffset.generatedLine-1),column:c.generatedColumn-(f.generatedOffset.generatedLine===c.generatedLine?f.generatedOffset.generatedColumn-1:0),bias:u.bias}):{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(u){return u.consumer.hasContentsOfAllSources()})},l.prototype.sourceContentFor=function(u,c){for(var d=0;d<this._sections.length;d++){var f=this._sections[d],m=f.consumer.sourceContentFor(u,!0);if(m)return m}if(c)return null;throw new Error('"'+u+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(u){for(var c=0;c<this._sections.length;c++){var d=this._sections[c];if(d.consumer._findSourceIndex(n.getArg(u,"source"))!==-1){var f=d.consumer.generatedPositionFor(u);if(f){var m={line:f.line+(d.generatedOffset.generatedLine-1),column:f.column+(d.generatedOffset.generatedLine===f.line?d.generatedOffset.generatedColumn-1:0)};return m}}}return{line:null,column:null}},l.prototype._parseMappings=function(u,c){this.__generatedMappings=[],this.__originalMappings=[];for(var d=0;d<this._sections.length;d++)for(var f=this._sections[d],m=f.consumer._generatedMappings,y=0;y<m.length;y++){var _=m[y],S=f.consumer._sources.at(_.source);S=n.computeSourceURL(f.consumer.sourceRoot,S,this._sourceMapURL),this._sources.add(S),S=this._sources.indexOf(S);var b=null;_.name&&(b=f.consumer._names.at(_.name),this._names.add(b),b=this._names.indexOf(b));var M={source:S,generatedLine:_.generatedLine+(f.generatedOffset.generatedLine-1),generatedColumn:_.generatedColumn+(f.generatedOffset.generatedLine===_.generatedLine?f.generatedOffset.generatedColumn-1:0),originalLine:_.originalLine,originalColumn:_.originalColumn,name:b};this.__generatedMappings.push(M),typeof M.originalLine=="number"&&this.__originalMappings.push(M)}r(this.__generatedMappings,n.compareByGeneratedPositionsDeflated),r(this.__originalMappings,n.compareByOriginalPositions)},GC.IndexedSourceMapConsumer=l,GC}var GU={},G$;function Yst(){if(G$)return GU;G$=1;var n=Dbe().SourceMapGenerator,e=s3(),t=/(\r?\n)/,i=10,r="$$$isSourceNode$$$";function s(a,o,l,u,c){this.children=[],this.sourceContents={},this.line=a??null,this.column=o??null,this.source=l??null,this.name=c??null,this[r]=!0,u!=null&&this.add(u)}return s.fromStringWithSourceMap=function(a,o,l){var u=new s,c=a.split(t),d=0,f=function(){var b=w(),M=w()||"";return b+M;function w(){return d<c.length?c[d++]:void 0}},m=1,y=0,_=null;return o.eachMapping(function(b){if(_!==null)if(m<b.generatedLine)S(_,f()),m++,y=0;else{var M=c[d]||"",w=M.substr(0,b.generatedColumn-y);c[d]=M.substr(b.generatedColumn-y),y=b.generatedColumn,S(_,w),_=b;return}for(;m<b.generatedLine;)u.add(f()),m++;if(y<b.generatedColumn){var M=c[d]||"";u.add(M.substr(0,b.generatedColumn)),c[d]=M.substr(b.generatedColumn),y=b.generatedColumn}_=b},this),d<c.length&&(_&&S(_,f()),u.add(c.splice(d).join(""))),o.sources.forEach(function(b){var M=o.sourceContentFor(b);M!=null&&(l!=null&&(b=e.join(l,b)),u.setSourceContent(b,M))}),u;function S(b,M){if(b===null||b.source===void 0)u.add(M);else{var w=l?e.join(l,b.source):b.source;u.add(new s(b.originalLine,b.originalColumn,w,M,b.name))}}},s.prototype.add=function(a){if(Array.isArray(a))a.forEach(function(o){this.add(o)},this);else if(a[r]||typeof a=="string")a&&this.children.push(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this},s.prototype.prepend=function(a){if(Array.isArray(a))for(var o=a.length-1;o>=0;o--)this.prepend(a[o]);else if(a[r]||typeof a=="string")this.children.unshift(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this},s.prototype.walk=function(a){for(var o,l=0,u=this.children.length;l<u;l++)o=this.children[l],o[r]?o.walk(a):o!==""&&a(o,{source:this.source,line:this.line,column:this.column,name:this.name})},s.prototype.join=function(a){var o,l,u=this.children.length;if(u>0){for(o=[],l=0;l<u-1;l++)o.push(this.children[l]),o.push(a);o.push(this.children[l]),this.children=o}return this},s.prototype.replaceRight=function(a,o){var l=this.children[this.children.length-1];return l[r]?l.replaceRight(a,o):typeof l=="string"?this.children[this.children.length-1]=l.replace(a,o):this.children.push("".replace(a,o)),this},s.prototype.setSourceContent=function(a,o){this.sourceContents[e.toSetString(a)]=o},s.prototype.walkSourceContents=function(a){for(var o=0,l=this.children.length;o<l;o++)this.children[o][r]&&this.children[o].walkSourceContents(a);for(var u=Object.keys(this.sourceContents),o=0,l=u.length;o<l;o++)a(e.fromSetString(u[o]),this.sourceContents[u[o]])},s.prototype.toString=function(){var a="";return this.walk(function(o){a+=o}),a},s.prototype.toStringWithSourceMap=function(a){var o={code:"",line:1,column:0},l=new n(a),u=!1,c=null,d=null,f=null,m=null;return this.walk(function(y,_){o.code+=y,_.source!==null&&_.line!==null&&_.column!==null?((c!==_.source||d!==_.line||f!==_.column||m!==_.name)&&l.addMapping({source:_.source,original:{line:_.line,column:_.column},generated:{line:o.line,column:o.column},name:_.name}),c=_.source,d=_.line,f=_.column,m=_.name,u=!0):u&&(l.addMapping({generated:{line:o.line,column:o.column}}),c=null,u=!1);for(var S=0,b=y.length;S<b;S++)y.charCodeAt(S)===i?(o.line++,o.column=0,S+1===b?(c=null,u=!1):u&&l.addMapping({source:_.source,original:{line:_.line,column:_.column},generated:{line:o.line,column:o.column},name:_.name})):o.column++}),this.walkSourceContents(function(y,_){l.setSourceContent(y,_)}),{code:o.code,map:l}},GU.SourceNode=s,GU}var O$;function Kst(){return O$||(O$=1,hN.SourceMapGenerator=Dbe().SourceMapGenerator,hN.SourceMapConsumer=jst().SourceMapConsumer,hN.SourceNode=Yst().SourceNode),hN}const $st="2.1.0",Jst={version:$st};var U$;function qst(){return U$||(U$=1,(function(n){(function(){var e,t,i,r,s,a,o,l,u,c,d,f,m,y,_,S,b,M,w,T,E,R,P,I,B,N;s=Ust(),a=Vst(),e=s.Syntax;function U(z){return St.Expression.hasOwnProperty(z.type)}function V(z){return St.Statement.hasOwnProperty(z.type)}t={Sequence:0,Yield:1,Assignment:1,Conditional:2,ArrowFunction:2,Coalesce:3,LogicalOR:4,LogicalAND:5,BitwiseOR:6,BitwiseXOR:7,BitwiseAND:8,Equality:9,Relational:10,BitwiseSHIFT:11,Additive:12,Multiplicative:13,Exponentiation:14,Await:15,Unary:15,Postfix:16,OptionalChaining:17,Call:18,New:19,TaggedTemplate:20,Member:21,Primary:22},i={"??":t.Coalesce,"||":t.LogicalOR,"&&":t.LogicalAND,"|":t.BitwiseOR,"^":t.BitwiseXOR,"&":t.BitwiseAND,"==":t.Equality,"!=":t.Equality,"===":t.Equality,"!==":t.Equality,is:t.Equality,isnt:t.Equality,"<":t.Relational,">":t.Relational,"<=":t.Relational,">=":t.Relational,in:t.Relational,instanceof:t.Relational,"<<":t.BitwiseSHIFT,">>":t.BitwiseSHIFT,">>>":t.BitwiseSHIFT,"+":t.Additive,"-":t.Additive,"*":t.Multiplicative,"%":t.Multiplicative,"/":t.Multiplicative,"**":t.Exponentiation};var W=1,K=2,q=4,j=8,te=16,he=32,_e=64,Be=K|q,ue=W|K,ce=W|K|q,Ce=W,Oe=q,nt=W|q,Ae=W,Ye=W|he,ft=0,ze=W|te,ot=W|j;function ut(){return{indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:`
`,space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null}}function Wt(z,se){var ne="";for(se|=0;se>0;se>>>=1,z+=z)se&1&&(ne+=z);return ne}function It(z){return/[\r\n]/g.test(z)}function ke(z){var se=z.length;return se&&a.code.isLineTerminator(z.charCodeAt(se-1))}function je(z,se){var ne;for(ne in se)se.hasOwnProperty(ne)&&(z[ne]=se[ne]);return z}function gt(z,se){var ne,ae;function be(pt){return typeof pt=="object"&&pt instanceof Object&&!(pt instanceof RegExp)}for(ne in se)se.hasOwnProperty(ne)&&(ae=se[ne],be(ae)?be(z[ne])?gt(z[ne],ae):z[ne]=gt({},ae):z[ne]=ae);return z}function yt(z){var se,ne,ae,be,pt;if(z!==z)throw new Error("Numeric literal whose value is NaN");if(z<0||z===0&&1/z<0)throw new Error("Numeric literal whose value is negative");if(z===1/0)return u?"null":c?"1e400":"1e+400";if(se=""+z,!c||se.length<3)return se;for(ne=se.indexOf("."),!u&&se.charCodeAt(0)===48&&ne===1&&(ne=0,se=se.slice(1)),ae=se,se=se.replace("e+","e"),be=0,(pt=ae.indexOf("e"))>0&&(be=+ae.slice(pt+1),ae=ae.slice(0,pt)),ne>=0&&(be-=ae.length-ne-1,ae=+(ae.slice(0,ne)+ae.slice(ne+1))+""),pt=0;ae.charCodeAt(ae.length+pt-1)===48;)--pt;return pt!==0&&(be-=pt,ae=ae.slice(0,pt)),be!==0&&(ae+="e"+be),(ae.length<se.length||d&&z>1e12&&Math.floor(z)===z&&(ae="0x"+z.toString(16)).length<se.length)&&+ae===z&&(se=ae),se}function ve(z,se){return(z&-2)===8232?(se?"u":"\\u")+(z===8232?"2028":"2029"):z===10||z===13?(se?"":"\\")+(z===10?"n":"r"):String.fromCharCode(z)}function An(z){var se,ne,ae,be,pt,Bt,tn,Tn;if(ne=z.toString(),z.source){if(se=ne.match(/\/([^/]*)$/),!se)return ne;for(ae=se[1],ne="",tn=!1,Tn=!1,be=0,pt=z.source.length;be<pt;++be)Bt=z.source.charCodeAt(be),Tn?(ne+=ve(Bt,Tn),Tn=!1):(tn?Bt===93&&(tn=!1):Bt===47?ne+="\\":Bt===91&&(tn=!0),ne+=ve(Bt,Tn),Tn=Bt===92);return"/"+ne+"/"+ae}return ne}function cn(z,se){var ne;return z===8?"\\b":z===12?"\\f":z===9?"\\t":(ne=z.toString(16).toUpperCase(),u||z>255?"\\u"+"0000".slice(ne.length)+ne:z===0&&!a.code.isDecimalDigit(se)?"\\0":z===11?"\\x0B":"\\x"+"00".slice(ne.length)+ne)}function In(z){if(z===92)return"\\\\";if(z===10)return"\\n";if(z===13)return"\\r";if(z===8232)return"\\u2028";if(z===8233)return"\\u2029";throw new Error("Incorrectly classified character")}function Zt(z){var se,ne,ae,be;for(be=f==="double"?'"':"'",se=0,ne=z.length;se<ne;++se)if(ae=z.charCodeAt(se),ae===39){be='"';break}else if(ae===34){be="'";break}else ae===92&&++se;return be+z+be}function le(z){var se="",ne,ae,be,pt=0,Bt=0,tn,Tn;for(ne=0,ae=z.length;ne<ae;++ne){if(be=z.charCodeAt(ne),be===39)++pt;else if(be===34)++Bt;else if(be===47&&u)se+="\\";else if(a.code.isLineTerminator(be)||be===92){se+=In(be);continue}else if(!a.code.isIdentifierPartES5(be)&&(u&&be<32||!u&&!m&&(be<32||be>126))){se+=cn(be,z.charCodeAt(ne+1));continue}se+=String.fromCharCode(be)}if(tn=!(f==="double"||f==="auto"&&Bt<pt),Tn=tn?"'":'"',!(tn?pt:Bt))return Tn+se+Tn;for(z=se,se=Tn,ne=0,ae=z.length;ne<ae;++ne)be=z.charCodeAt(ne),(be===39&&tn||be===34&&!tn)&&(se+="\\"),se+=String.fromCharCode(be);return se+Tn}function ee(z){var se,ne,ae,be="";for(se=0,ne=z.length;se<ne;++se)ae=z[se],be+=Array.isArray(ae)?ee(ae):ae;return be}function Re(z,se){if(!R)return Array.isArray(z)?ee(z):z;if(se==null){if(z instanceof r)return z;se={}}return se.loc==null?new r(null,null,R,z,se.name||null):new r(se.loc.start.line,se.loc.start.column,R===!0?se.loc.source||null:R,z,se.name||null)}function tt(){return _||" "}function et(z,se){var ne,ae,be,pt;return ne=Re(z).toString(),ne.length===0?[se]:(ae=Re(se).toString(),ae.length===0?[z]:(be=ne.charCodeAt(ne.length-1),pt=ae.charCodeAt(0),(be===43||be===45)&&be===pt||a.code.isIdentifierPartES5(be)&&a.code.isIdentifierPartES5(pt)||be===47&&pt===105?[z,tt(),se]:a.code.isWhiteSpace(be)||a.code.isLineTerminator(be)||a.code.isWhiteSpace(pt)||a.code.isLineTerminator(pt)?[z,se]:[z,_,se]))}function at(z){return[o,z]}function jt(z){var se;se=o,o+=l,z(o),o=se}function rn(z){var se;for(se=z.length-1;se>=0&&!a.code.isLineTerminator(z.charCodeAt(se));--se);return z.length-1-se}function Nn(z,se){var ne,ae,be,pt,Bt,tn,Tn,yi;for(ne=z.split(/\r\n|[\r\n]/),tn=Number.MAX_VALUE,ae=1,be=ne.length;ae<be;++ae){for(pt=ne[ae],Bt=0;Bt<pt.length&&a.code.isWhiteSpace(pt.charCodeAt(Bt));)++Bt;tn>Bt&&(tn=Bt)}for(typeof se<"u"?(Tn=o,ne[1][tn]==="*"&&(se+=" "),o=se):(tn&1&&--tn,Tn=o),ae=1,be=ne.length;ae<be;++ae)yi=Re(at(ne[ae].slice(tn))),ne[ae]=R?yi.join(""):yi;return o=Tn,ne.join(`
`)}function Fn(z,se){if(z.type==="Line"){if(ke(z.value))return"//"+z.value;var ne="//"+z.value;return I||(ne+=`
`),ne}return T.format.indent.adjustMultilineComment&&/[\n\r]/.test(z.value)?Nn("/*"+z.value+"*/",se):"/*"+z.value+"*/"}function Gt(z,se){var ne,ae,be,pt,Bt,tn,Tn,yi,er,Vi,Zn,Xs,es,ie;if(z.leadingComments&&z.leadingComments.length>0){if(pt=se,I){for(be=z.leadingComments[0],se=[],yi=be.extendedRange,er=be.range,Zn=P.substring(yi[0],er[0]),ie=(Zn.match(/\n/g)||[]).length,ie>0?(se.push(Wt(`
`,ie)),se.push(at(Fn(be)))):(se.push(Zn),se.push(Fn(be))),Vi=er,ne=1,ae=z.leadingComments.length;ne<ae;ne++)be=z.leadingComments[ne],er=be.range,Xs=P.substring(Vi[1],er[0]),ie=(Xs.match(/\n/g)||[]).length,se.push(Wt(`
`,ie)),se.push(at(Fn(be))),Vi=er;es=P.substring(er[1],yi[1]),ie=(es.match(/\n/g)||[]).length,se.push(Wt(`
`,ie))}else for(be=z.leadingComments[0],se=[],M&&z.type===e.Program&&z.body.length===0&&se.push(`
`),se.push(Fn(be)),ke(Re(se).toString())||se.push(`
`),ne=1,ae=z.leadingComments.length;ne<ae;++ne)be=z.leadingComments[ne],Tn=[Fn(be)],ke(Re(Tn).toString())||Tn.push(`
`),se.push(at(Tn));se.push(at(pt))}if(z.trailingComments)if(I)be=z.trailingComments[0],yi=be.extendedRange,er=be.range,Zn=P.substring(yi[0],er[0]),ie=(Zn.match(/\n/g)||[]).length,ie>0?(se.push(Wt(`
`,ie)),se.push(at(Fn(be)))):(se.push(Zn),se.push(Fn(be)));else for(Bt=!ke(Re(se).toString()),tn=Wt(" ",rn(Re([o,se,l]).toString())),ne=0,ae=z.trailingComments.length;ne<ae;++ne)be=z.trailingComments[ne],Bt?(ne===0?se=[se,l]:se=[se,tn],se.push(Fn(be,tn))):se=[se,at(Fn(be))],ne!==ae-1&&!ke(Re(se).toString())&&(se=[se,`
`]);return se}function st(z,se,ne){var ae,be=0;for(ae=z;ae<se;ae++)P[ae]===`
`&&be++;for(ae=1;ae<be;ae++)ne.push(y)}function Ft(z,se,ne){return se<ne?["(",z,")"]:z}function Se(z){var se,ne,ae;for(ae=z.split(/\r\n|\n/),se=1,ne=ae.length;se<ne;se++)ae[se]=y+o+ae[se];return ae}function Je(z,se){var ne,ae,be;return ne=z[T.verbatim],typeof ne=="string"?ae=Ft(Se(ne),t.Sequence,se):(ae=Se(ne.content),be=ne.precedence!=null?ne.precedence:t.Sequence,ae=Ft(ae,be,se)),Re(ae,z)}function St(){}St.prototype.maybeBlock=function(z,se){var ne,ae,be=this;return ae=!T.comment||!z.leadingComments,z.type===e.BlockStatement&&ae?[_,this.generateStatement(z,se)]:z.type===e.EmptyStatement&&ae?";":(jt(function(){ne=[y,at(be.generateStatement(z,se))]}),ne)},St.prototype.maybeBlockSuffix=function(z,se){var ne=ke(Re(se).toString());return z.type===e.BlockStatement&&(!T.comment||!z.leadingComments)&&!ne?[se,_]:ne?[se,o]:[se,y,o]};function Ne(z){return Re(z.name,z)}function it(z,se){return z.async?"async"+(se?tt():_):""}function kt(z){var se=z.generator&&!T.moz.starlessGenerator;return se?"*"+_:""}function vn(z){var se=z.value,ne="";return se.async&&(ne+=it(se,!z.computed)),se.generator&&(ne+=kt(se)?"*":""),ne}St.prototype.generatePattern=function(z,se,ne){return z.type===e.Identifier?Ne(z):this.generateExpression(z,se,ne)},St.prototype.generateFunctionParams=function(z){var se,ne,ae,be;if(be=!1,z.type===e.ArrowFunctionExpression&&!z.rest&&(!z.defaults||z.defaults.length===0)&&z.params.length===1&&z.params[0].type===e.Identifier)ae=[it(z,!0),Ne(z.params[0])];else{for(ae=z.type===e.ArrowFunctionExpression?[it(z,!1)]:[],ae.push("("),z.defaults&&(be=!0),se=0,ne=z.params.length;se<ne;++se)be&&z.defaults[se]?ae.push(this.generateAssignment(z.params[se],z.defaults[se],"=",t.Assignment,ce)):ae.push(this.generatePattern(z.params[se],t.Assignment,ce)),se+1<ne&&ae.push(","+_);z.rest&&(z.params.length&&ae.push(","+_),ae.push("..."),ae.push(Ne(z.rest))),ae.push(")")}return ae},St.prototype.generateFunctionBody=function(z){var se,ne;return se=this.generateFunctionParams(z),z.type===e.ArrowFunctionExpression&&(se.push(_),se.push("=>")),z.expression?(se.push(_),ne=this.generateExpression(z.body,t.Assignment,ce),ne.toString().charAt(0)==="{"&&(ne=["(",ne,")"]),se.push(ne)):se.push(this.maybeBlock(z.body,ot)),se},St.prototype.generateIterationForStatement=function(z,se,ne){var ae=["for"+(se.await?tt()+"await":"")+_+"("],be=this;return jt(function(){se.left.type===e.VariableDeclaration?jt(function(){ae.push(se.left.kind+tt()),ae.push(be.generateStatement(se.left.declarations[0],ft))}):ae.push(be.generateExpression(se.left,t.Call,ce)),ae=et(ae,z),ae=[et(ae,be.generateExpression(se.right,t.Assignment,ce)),")"]}),ae.push(this.maybeBlock(se.body,ne)),ae},St.prototype.generatePropertyKey=function(z,se){var ne=[];return se&&ne.push("["),ne.push(this.generateExpression(z,t.Assignment,ce)),se&&ne.push("]"),ne},St.prototype.generateAssignment=function(z,se,ne,ae,be){return t.Assignment<ae&&(be|=W),Ft([this.generateExpression(z,t.Call,be),_+ne+_,this.generateExpression(se,t.Assignment,be)],t.Assignment,ae)},St.prototype.semicolon=function(z){return!b&&z&he?"":";"},St.Statement={BlockStatement:function(z,se){var ne,ae,be=["{",y],pt=this;return jt(function(){z.body.length===0&&I&&(ne=z.range,ne[1]-ne[0]>2&&(ae=P.substring(ne[0]+1,ne[1]-1),ae[0]===`
`&&(be=["{"]),be.push(ae)));var Bt,tn,Tn,yi;for(yi=Ae,se&j&&(yi|=te),Bt=0,tn=z.body.length;Bt<tn;++Bt)I&&(Bt===0&&(z.body[0].leadingComments&&(ne=z.body[0].leadingComments[0].extendedRange,ae=P.substring(ne[0],ne[1]),ae[0]===`
`&&(be=["{"])),z.body[0].leadingComments||st(z.range[0],z.body[0].range[0],be)),Bt>0&&!z.body[Bt-1].trailingComments&&!z.body[Bt].leadingComments&&st(z.body[Bt-1].range[1],z.body[Bt].range[0],be)),Bt===tn-1&&(yi|=he),z.body[Bt].leadingComments&&I?Tn=pt.generateStatement(z.body[Bt],yi):Tn=at(pt.generateStatement(z.body[Bt],yi)),be.push(Tn),ke(Re(Tn).toString())||I&&Bt<tn-1&&z.body[Bt+1].leadingComments||be.push(y),I&&Bt===tn-1&&(z.body[Bt].trailingComments||st(z.body[Bt].range[1],z.range[1],be))}),be.push(at("}")),be},BreakStatement:function(z,se){return z.label?"break "+z.label.name+this.semicolon(se):"break"+this.semicolon(se)},ContinueStatement:function(z,se){return z.label?"continue "+z.label.name+this.semicolon(se):"continue"+this.semicolon(se)},ClassBody:function(z,se){var ne=["{",y],ae=this;return jt(function(be){var pt,Bt;for(pt=0,Bt=z.body.length;pt<Bt;++pt)ne.push(be),ne.push(ae.generateExpression(z.body[pt],t.Sequence,ce)),pt+1<Bt&&ne.push(y)}),ke(Re(ne).toString())||ne.push(y),ne.push(o),ne.push("}"),ne},ClassDeclaration:function(z,se){var ne,ae;return ne=["class"],z.id&&(ne=et(ne,this.generateExpression(z.id,t.Sequence,ce))),z.superClass&&(ae=et("extends",this.generateExpression(z.superClass,t.Unary,ce)),ne=et(ne,ae)),ne.push(_),ne.push(this.generateStatement(z.body,Ye)),ne},DirectiveStatement:function(z,se){return T.raw&&z.raw?z.raw+this.semicolon(se):Zt(z.directive)+this.semicolon(se)},DoWhileStatement:function(z,se){var ne=et("do",this.maybeBlock(z.body,Ae));return ne=this.maybeBlockSuffix(z.body,ne),et(ne,["while"+_+"(",this.generateExpression(z.test,t.Sequence,ce),")"+this.semicolon(se)])},CatchClause:function(z,se){var ne,ae=this;return jt(function(){var be;z.param?(ne=["catch"+_+"(",ae.generateExpression(z.param,t.Sequence,ce),")"],z.guard&&(be=ae.generateExpression(z.guard,t.Sequence,ce),ne.splice(2,0," if ",be))):ne=["catch"]}),ne.push(this.maybeBlock(z.body,Ae)),ne},DebuggerStatement:function(z,se){return"debugger"+this.semicolon(se)},EmptyStatement:function(z,se){return";"},ExportDefaultDeclaration:function(z,se){var ne=["export"],ae;return ae=se&he?Ye:Ae,ne=et(ne,"default"),V(z.declaration)?ne=et(ne,this.generateStatement(z.declaration,ae)):ne=et(ne,this.generateExpression(z.declaration,t.Assignment,ce)+this.semicolon(se)),ne},ExportNamedDeclaration:function(z,se){var ne=["export"],ae,be=this;return ae=se&he?Ye:Ae,z.declaration?et(ne,this.generateStatement(z.declaration,ae)):(z.specifiers&&(z.specifiers.length===0?ne=et(ne,"{"+_+"}"):z.specifiers[0].type===e.ExportBatchSpecifier?ne=et(ne,this.generateExpression(z.specifiers[0],t.Sequence,ce)):(ne=et(ne,"{"),jt(function(pt){var Bt,tn;for(ne.push(y),Bt=0,tn=z.specifiers.length;Bt<tn;++Bt)ne.push(pt),ne.push(be.generateExpression(z.specifiers[Bt],t.Sequence,ce)),Bt+1<tn&&ne.push(","+y)}),ke(Re(ne).toString())||ne.push(y),ne.push(o+"}")),z.source?ne=et(ne,["from"+_,this.generateExpression(z.source,t.Sequence,ce),this.semicolon(se)]):ne.push(this.semicolon(se))),ne)},ExportAllDeclaration:function(z,se){return["export"+_,"*"+_,"from"+_,this.generateExpression(z.source,t.Sequence,ce),this.semicolon(se)]},ExpressionStatement:function(z,se){var ne,ae;function be(tn){var Tn;return tn.slice(0,5)!=="class"?!1:(Tn=tn.charCodeAt(5),Tn===123||a.code.isWhiteSpace(Tn)||a.code.isLineTerminator(Tn))}function pt(tn){var Tn;return tn.slice(0,8)!=="function"?!1:(Tn=tn.charCodeAt(8),Tn===40||a.code.isWhiteSpace(Tn)||Tn===42||a.code.isLineTerminator(Tn))}function Bt(tn){var Tn,yi,er;if(tn.slice(0,5)!=="async"||!a.code.isWhiteSpace(tn.charCodeAt(5)))return!1;for(yi=6,er=tn.length;yi<er&&a.code.isWhiteSpace(tn.charCodeAt(yi));++yi);return yi===er||tn.slice(yi,yi+8)!=="function"?!1:(Tn=tn.charCodeAt(yi+8),Tn===40||a.code.isWhiteSpace(Tn)||Tn===42||a.code.isLineTerminator(Tn))}return ne=[this.generateExpression(z.expression,t.Sequence,ce)],ae=Re(ne).toString(),ae.charCodeAt(0)===123||be(ae)||pt(ae)||Bt(ae)||w&&se&te&&z.expression.type===e.Literal&&typeof z.expression.value=="string"?ne=["(",ne,")"+this.semicolon(se)]:ne.push(this.semicolon(se)),ne},ImportDeclaration:function(z,se){var ne,ae,be=this;return z.specifiers.length===0?["import",_,this.generateExpression(z.source,t.Sequence,ce),this.semicolon(se)]:(ne=["import"],ae=0,z.specifiers[ae].type===e.ImportDefaultSpecifier&&(ne=et(ne,[this.generateExpression(z.specifiers[ae],t.Sequence,ce)]),++ae),z.specifiers[ae]&&(ae!==0&&ne.push(","),z.specifiers[ae].type===e.ImportNamespaceSpecifier?ne=et(ne,[_,this.generateExpression(z.specifiers[ae],t.Sequence,ce)]):(ne.push(_+"{"),z.specifiers.length-ae===1?(ne.push(_),ne.push(this.generateExpression(z.specifiers[ae],t.Sequence,ce)),ne.push(_+"}"+_)):(jt(function(pt){var Bt,tn;for(ne.push(y),Bt=ae,tn=z.specifiers.length;Bt<tn;++Bt)ne.push(pt),ne.push(be.generateExpression(z.specifiers[Bt],t.Sequence,ce)),Bt+1<tn&&ne.push(","+y)}),ke(Re(ne).toString())||ne.push(y),ne.push(o+"}"+_)))),ne=et(ne,["from"+_,this.generateExpression(z.source,t.Sequence,ce),this.semicolon(se)]),ne)},VariableDeclarator:function(z,se){var ne=se&W?ce:Be;return z.init?[this.generateExpression(z.id,t.Assignment,ne),_,"=",_,this.generateExpression(z.init,t.Assignment,ne)]:this.generatePattern(z.id,t.Assignment,ne)},VariableDeclaration:function(z,se){var ne,ae,be,pt,Bt,tn=this;ne=[z.kind],Bt=se&W?Ae:ft;function Tn(){for(pt=z.declarations[0],T.comment&&pt.leadingComments?(ne.push(`
`),ne.push(at(tn.generateStatement(pt,Bt)))):(ne.push(tt()),ne.push(tn.generateStatement(pt,Bt))),ae=1,be=z.declarations.length;ae<be;++ae)pt=z.declarations[ae],T.comment&&pt.leadingComments?(ne.push(","+y),ne.push(at(tn.generateStatement(pt,Bt)))):(ne.push(","+_),ne.push(tn.generateStatement(pt,Bt)))}return z.declarations.length>1?jt(Tn):Tn(),ne.push(this.semicolon(se)),ne},ThrowStatement:function(z,se){return[et("throw",this.generateExpression(z.argument,t.Sequence,ce)),this.semicolon(se)]},TryStatement:function(z,se){var ne,ae,be,pt;if(ne=["try",this.maybeBlock(z.block,Ae)],ne=this.maybeBlockSuffix(z.block,ne),z.handlers)for(ae=0,be=z.handlers.length;ae<be;++ae)ne=et(ne,this.generateStatement(z.handlers[ae],Ae)),(z.finalizer||ae+1!==be)&&(ne=this.maybeBlockSuffix(z.handlers[ae].body,ne));else{for(pt=z.guardedHandlers||[],ae=0,be=pt.length;ae<be;++ae)ne=et(ne,this.generateStatement(pt[ae],Ae)),(z.finalizer||ae+1!==be)&&(ne=this.maybeBlockSuffix(pt[ae].body,ne));if(z.handler)if(Array.isArray(z.handler))for(ae=0,be=z.handler.length;ae<be;++ae)ne=et(ne,this.generateStatement(z.handler[ae],Ae)),(z.finalizer||ae+1!==be)&&(ne=this.maybeBlockSuffix(z.handler[ae].body,ne));else ne=et(ne,this.generateStatement(z.handler,Ae)),z.finalizer&&(ne=this.maybeBlockSuffix(z.handler.body,ne))}return z.finalizer&&(ne=et(ne,["finally",this.maybeBlock(z.finalizer,Ae)])),ne},SwitchStatement:function(z,se){var ne,ae,be,pt,Bt,tn=this;if(jt(function(){ne=["switch"+_+"(",tn.generateExpression(z.discriminant,t.Sequence,ce),")"+_+"{"+y]}),z.cases)for(Bt=Ae,be=0,pt=z.cases.length;be<pt;++be)be===pt-1&&(Bt|=he),ae=at(this.generateStatement(z.cases[be],Bt)),ne.push(ae),ke(Re(ae).toString())||ne.push(y);return ne.push(at("}")),ne},SwitchCase:function(z,se){var ne,ae,be,pt,Bt,tn=this;return jt(function(){for(z.test?ne=[et("case",tn.generateExpression(z.test,t.Sequence,ce)),":"]:ne=["default:"],be=0,pt=z.consequent.length,pt&&z.consequent[0].type===e.BlockStatement&&(ae=tn.maybeBlock(z.consequent[0],Ae),ne.push(ae),be=1),be!==pt&&!ke(Re(ne).toString())&&ne.push(y),Bt=Ae;be<pt;++be)be===pt-1&&se&he&&(Bt|=he),ae=at(tn.generateStatement(z.consequent[be],Bt)),ne.push(ae),be+1!==pt&&!ke(Re(ae).toString())&&ne.push(y)}),ne},IfStatement:function(z,se){var ne,ae,be,pt=this;return jt(function(){ne=["if"+_+"(",pt.generateExpression(z.test,t.Sequence,ce),")"]}),be=se&he,ae=Ae,be&&(ae|=he),z.alternate?(ne.push(this.maybeBlock(z.consequent,Ae)),ne=this.maybeBlockSuffix(z.consequent,ne),z.alternate.type===e.IfStatement?ne=et(ne,["else ",this.generateStatement(z.alternate,ae)]):ne=et(ne,et("else",this.maybeBlock(z.alternate,ae)))):ne.push(this.maybeBlock(z.consequent,ae)),ne},ForStatement:function(z,se){var ne,ae=this;return jt(function(){ne=["for"+_+"("],z.init?z.init.type===e.VariableDeclaration?ne.push(ae.generateStatement(z.init,ft)):(ne.push(ae.generateExpression(z.init,t.Sequence,Be)),ne.push(";")):ne.push(";"),z.test&&(ne.push(_),ne.push(ae.generateExpression(z.test,t.Sequence,ce))),ne.push(";"),z.update&&(ne.push(_),ne.push(ae.generateExpression(z.update,t.Sequence,ce))),ne.push(")")}),ne.push(this.maybeBlock(z.body,se&he?Ye:Ae)),ne},ForInStatement:function(z,se){return this.generateIterationForStatement("in",z,se&he?Ye:Ae)},ForOfStatement:function(z,se){return this.generateIterationForStatement("of",z,se&he?Ye:Ae)},LabeledStatement:function(z,se){return[z.label.name+":",this.maybeBlock(z.body,se&he?Ye:Ae)]},Program:function(z,se){var ne,ae,be,pt,Bt;for(pt=z.body.length,ne=[M&&pt>0?`
`:""],Bt=ze,be=0;be<pt;++be)!M&&be===pt-1&&(Bt|=he),I&&(be===0&&(z.body[0].leadingComments||st(z.range[0],z.body[be].range[0],ne)),be>0&&!z.body[be-1].trailingComments&&!z.body[be].leadingComments&&st(z.body[be-1].range[1],z.body[be].range[0],ne)),ae=at(this.generateStatement(z.body[be],Bt)),ne.push(ae),be+1<pt&&!ke(Re(ae).toString())&&(I&&z.body[be+1].leadingComments||ne.push(y)),I&&be===pt-1&&(z.body[be].trailingComments||st(z.body[be].range[1],z.range[1],ne));return ne},FunctionDeclaration:function(z,se){return[it(z,!0),"function",kt(z)||tt(),z.id?Ne(z.id):"",this.generateFunctionBody(z)]},ReturnStatement:function(z,se){return z.argument?[et("return",this.generateExpression(z.argument,t.Sequence,ce)),this.semicolon(se)]:["return"+this.semicolon(se)]},WhileStatement:function(z,se){var ne,ae=this;return jt(function(){ne=["while"+_+"(",ae.generateExpression(z.test,t.Sequence,ce),")"]}),ne.push(this.maybeBlock(z.body,se&he?Ye:Ae)),ne},WithStatement:function(z,se){var ne,ae=this;return jt(function(){ne=["with"+_+"(",ae.generateExpression(z.object,t.Sequence,ce),")"]}),ne.push(this.maybeBlock(z.body,se&he?Ye:Ae)),ne}},je(St.prototype,St.Statement),St.Expression={SequenceExpression:function(z,se,ne){var ae,be,pt;for(t.Sequence<se&&(ne|=W),ae=[],be=0,pt=z.expressions.length;be<pt;++be)ae.push(this.generateExpression(z.expressions[be],t.Assignment,ne)),be+1<pt&&ae.push(","+_);return Ft(ae,t.Sequence,se)},AssignmentExpression:function(z,se,ne){return this.generateAssignment(z.left,z.right,z.operator,se,ne)},ArrowFunctionExpression:function(z,se,ne){return Ft(this.generateFunctionBody(z),t.ArrowFunction,se)},ConditionalExpression:function(z,se,ne){return t.Conditional<se&&(ne|=W),Ft([this.generateExpression(z.test,t.Coalesce,ne),_+"?"+_,this.generateExpression(z.consequent,t.Assignment,ne),_+":"+_,this.generateExpression(z.alternate,t.Assignment,ne)],t.Conditional,se)},LogicalExpression:function(z,se,ne){return z.operator==="??"&&(ne|=_e),this.BinaryExpression(z,se,ne)},BinaryExpression:function(z,se,ne){var ae,be,pt,Bt,tn,Tn;return Bt=i[z.operator],be=z.operator==="**"?t.Postfix:Bt,pt=z.operator==="**"?Bt:Bt+1,Bt<se&&(ne|=W),tn=this.generateExpression(z.left,be,ne),Tn=tn.toString(),Tn.charCodeAt(Tn.length-1)===47&&a.code.isIdentifierPartES5(z.operator.charCodeAt(0))?ae=[tn,tt(),z.operator]:ae=et(tn,z.operator),tn=this.generateExpression(z.right,pt,ne),z.operator==="/"&&tn.toString().charAt(0)==="/"||z.operator.slice(-1)==="<"&&tn.toString().slice(0,3)==="!--"?(ae.push(tt()),ae.push(tn)):ae=et(ae,tn),z.operator==="in"&&!(ne&W)?["(",ae,")"]:(z.operator==="||"||z.operator==="&&")&&ne&_e?["(",ae,")"]:Ft(ae,Bt,se)},CallExpression:function(z,se,ne){var ae,be,pt;for(ae=[this.generateExpression(z.callee,t.Call,ue)],z.optional&&ae.push("?."),ae.push("("),be=0,pt=z.arguments.length;be<pt;++be)ae.push(this.generateExpression(z.arguments[be],t.Assignment,ce)),be+1<pt&&ae.push(","+_);return ae.push(")"),ne&K?Ft(ae,t.Call,se):["(",ae,")"]},ChainExpression:function(z,se,ne){t.OptionalChaining<se&&(ne|=K);var ae=this.generateExpression(z.expression,t.OptionalChaining,ne);return Ft(ae,t.OptionalChaining,se)},NewExpression:function(z,se,ne){var ae,be,pt,Bt,tn;if(be=z.arguments.length,tn=ne&q&&!S&&be===0?nt:Ce,ae=et("new",this.generateExpression(z.callee,t.New,tn)),!(ne&q)||S||be>0){for(ae.push("("),pt=0,Bt=be;pt<Bt;++pt)ae.push(this.generateExpression(z.arguments[pt],t.Assignment,ce)),pt+1<Bt&&ae.push(","+_);ae.push(")")}return Ft(ae,t.New,se)},MemberExpression:function(z,se,ne){var ae,be;return ae=[this.generateExpression(z.object,t.Call,ne&K?ue:Ce)],z.computed?(z.optional&&ae.push("?."),ae.push("["),ae.push(this.generateExpression(z.property,t.Sequence,ne&K?ce:nt)),ae.push("]")):(!z.optional&&z.object.type===e.Literal&&typeof z.object.value=="number"&&(be=Re(ae).toString(),be.indexOf(".")<0&&!/[eExX]/.test(be)&&a.code.isDecimalDigit(be.charCodeAt(be.length-1))&&!(be.length>=2&&be.charCodeAt(0)===48)&&ae.push(" ")),ae.push(z.optional?"?.":"."),ae.push(Ne(z.property))),Ft(ae,t.Member,se)},MetaProperty:function(z,se,ne){var ae;return ae=[],ae.push(typeof z.meta=="string"?z.meta:Ne(z.meta)),ae.push("."),ae.push(typeof z.property=="string"?z.property:Ne(z.property)),Ft(ae,t.Member,se)},UnaryExpression:function(z,se,ne){var ae,be,pt,Bt,tn;return be=this.generateExpression(z.argument,t.Unary,ce),_===""?ae=et(z.operator,be):(ae=[z.operator],z.operator.length>2?ae=et(ae,be):(Bt=Re(ae).toString(),tn=Bt.charCodeAt(Bt.length-1),pt=be.toString().charCodeAt(0),((tn===43||tn===45)&&tn===pt||a.code.isIdentifierPartES5(tn)&&a.code.isIdentifierPartES5(pt))&&ae.push(tt()),ae.push(be))),Ft(ae,t.Unary,se)},YieldExpression:function(z,se,ne){var ae;return z.delegate?ae="yield*":ae="yield",z.argument&&(ae=et(ae,this.generateExpression(z.argument,t.Yield,ce))),Ft(ae,t.Yield,se)},AwaitExpression:function(z,se,ne){var ae=et(z.all?"await*":"await",this.generateExpression(z.argument,t.Await,ce));return Ft(ae,t.Await,se)},UpdateExpression:function(z,se,ne){return z.prefix?Ft([z.operator,this.generateExpression(z.argument,t.Unary,ce)],t.Unary,se):Ft([this.generateExpression(z.argument,t.Postfix,ce),z.operator],t.Postfix,se)},FunctionExpression:function(z,se,ne){var ae=[it(z,!0),"function"];return z.id?(ae.push(kt(z)||tt()),ae.push(Ne(z.id))):ae.push(kt(z)||_),ae.push(this.generateFunctionBody(z)),ae},ArrayPattern:function(z,se,ne){return this.ArrayExpression(z,se,ne,!0)},ArrayExpression:function(z,se,ne,ae){var be,pt,Bt=this;return z.elements.length?(pt=ae?!1:z.elements.length>1,be=["[",pt?y:""],jt(function(tn){var Tn,yi;for(Tn=0,yi=z.elements.length;Tn<yi;++Tn)z.elements[Tn]?(be.push(pt?tn:""),be.push(Bt.generateExpression(z.elements[Tn],t.Assignment,ce))):(pt&&be.push(tn),Tn+1===yi&&be.push(",")),Tn+1<yi&&be.push(","+(pt?y:_))}),pt&&!ke(Re(be).toString())&&be.push(y),be.push(pt?o:""),be.push("]"),be):"[]"},RestElement:function(z,se,ne){return"..."+this.generatePattern(z.argument)},ClassExpression:function(z,se,ne){var ae,be;return ae=["class"],z.id&&(ae=et(ae,this.generateExpression(z.id,t.Sequence,ce))),z.superClass&&(be=et("extends",this.generateExpression(z.superClass,t.Unary,ce)),ae=et(ae,be)),ae.push(_),ae.push(this.generateStatement(z.body,Ye)),ae},MethodDefinition:function(z,se,ne){var ae,be;return z.static?ae=["static"+_]:ae=[],z.kind==="get"||z.kind==="set"?be=[et(z.kind,this.generatePropertyKey(z.key,z.computed)),this.generateFunctionBody(z.value)]:be=[vn(z),this.generatePropertyKey(z.key,z.computed),this.generateFunctionBody(z.value)],et(ae,be)},Property:function(z,se,ne){return z.kind==="get"||z.kind==="set"?[z.kind,tt(),this.generatePropertyKey(z.key,z.computed),this.generateFunctionBody(z.value)]:z.shorthand?z.value.type==="AssignmentPattern"?this.AssignmentPattern(z.value,t.Sequence,ce):this.generatePropertyKey(z.key,z.computed):z.method?[vn(z),this.generatePropertyKey(z.key,z.computed),this.generateFunctionBody(z.value)]:[this.generatePropertyKey(z.key,z.computed),":"+_,this.generateExpression(z.value,t.Assignment,ce)]},ObjectExpression:function(z,se,ne){var ae,be,pt,Bt=this;return z.properties.length?(ae=z.properties.length>1,jt(function(){pt=Bt.generateExpression(z.properties[0],t.Sequence,ce)}),!ae&&!It(Re(pt).toString())?["{",_,pt,_,"}"]:(jt(function(tn){var Tn,yi;if(be=["{",y,tn,pt],ae)for(be.push(","+y),Tn=1,yi=z.properties.length;Tn<yi;++Tn)be.push(tn),be.push(Bt.generateExpression(z.properties[Tn],t.Sequence,ce)),Tn+1<yi&&be.push(","+y)}),ke(Re(be).toString())||be.push(y),be.push(o),be.push("}"),be)):"{}"},AssignmentPattern:function(z,se,ne){return this.generateAssignment(z.left,z.right,"=",se,ne)},ObjectPattern:function(z,se,ne){var ae,be,pt,Bt,tn,Tn=this;if(!z.properties.length)return"{}";if(Bt=!1,z.properties.length===1)tn=z.properties[0],tn.type===e.Property&&tn.value.type!==e.Identifier&&(Bt=!0);else for(be=0,pt=z.properties.length;be<pt;++be)if(tn=z.properties[be],tn.type===e.Property&&!tn.shorthand){Bt=!0;break}return ae=["{",Bt?y:""],jt(function(yi){var er,Vi;for(er=0,Vi=z.properties.length;er<Vi;++er)ae.push(Bt?yi:""),ae.push(Tn.generateExpression(z.properties[er],t.Sequence,ce)),er+1<Vi&&ae.push(","+(Bt?y:_))}),Bt&&!ke(Re(ae).toString())&&ae.push(y),ae.push(Bt?o:""),ae.push("}"),ae},ThisExpression:function(z,se,ne){return"this"},Super:function(z,se,ne){return"super"},Identifier:function(z,se,ne){return Ne(z)},ImportDefaultSpecifier:function(z,se,ne){return Ne(z.id||z.local)},ImportNamespaceSpecifier:function(z,se,ne){var ae=["*"],be=z.id||z.local;return be&&ae.push(_+"as"+tt()+Ne(be)),ae},ImportSpecifier:function(z,se,ne){var ae=z.imported,be=[ae.name],pt=z.local;return pt&&pt.name!==ae.name&&be.push(tt()+"as"+tt()+Ne(pt)),be},ExportSpecifier:function(z,se,ne){var ae=z.local,be=[ae.name],pt=z.exported;return pt&&pt.name!==ae.name&&be.push(tt()+"as"+tt()+Ne(pt)),be},Literal:function(z,se,ne){var ae;if(z.hasOwnProperty("raw")&&E&&T.raw)try{if(ae=E(z.raw).body[0].expression,ae.type===e.Literal&&ae.value===z.value)return z.raw}catch{}return z.regex?"/"+z.regex.pattern+"/"+z.regex.flags:typeof z.value=="bigint"?z.value.toString()+"n":z.bigint?z.bigint+"n":z.value===null?"null":typeof z.value=="string"?le(z.value):typeof z.value=="number"?yt(z.value):typeof z.value=="boolean"?z.value?"true":"false":An(z.value)},GeneratorExpression:function(z,se,ne){return this.ComprehensionExpression(z,se,ne)},ComprehensionExpression:function(z,se,ne){var ae,be,pt,Bt,tn=this;return ae=z.type===e.GeneratorExpression?["("]:["["],T.moz.comprehensionExpressionStartsWithAssignment&&(Bt=this.generateExpression(z.body,t.Assignment,ce),ae.push(Bt)),z.blocks&&jt(function(){for(be=0,pt=z.blocks.length;be<pt;++be)Bt=tn.generateExpression(z.blocks[be],t.Sequence,ce),be>0||T.moz.comprehensionExpressionStartsWithAssignment?ae=et(ae,Bt):ae.push(Bt)}),z.filter&&(ae=et(ae,"if"+_),Bt=this.generateExpression(z.filter,t.Sequence,ce),ae=et(ae,["(",Bt,")"])),T.moz.comprehensionExpressionStartsWithAssignment||(Bt=this.generateExpression(z.body,t.Assignment,ce),ae=et(ae,Bt)),ae.push(z.type===e.GeneratorExpression?")":"]"),ae},ComprehensionBlock:function(z,se,ne){var ae;return z.left.type===e.VariableDeclaration?ae=[z.left.kind,tt(),this.generateStatement(z.left.declarations[0],ft)]:ae=this.generateExpression(z.left,t.Call,ce),ae=et(ae,z.of?"of":"in"),ae=et(ae,this.generateExpression(z.right,t.Sequence,ce)),["for"+_+"(",ae,")"]},SpreadElement:function(z,se,ne){return["...",this.generateExpression(z.argument,t.Assignment,ce)]},TaggedTemplateExpression:function(z,se,ne){var ae=ue;ne&K||(ae=Ce);var be=[this.generateExpression(z.tag,t.Call,ae),this.generateExpression(z.quasi,t.Primary,Oe)];return Ft(be,t.TaggedTemplate,se)},TemplateElement:function(z,se,ne){return z.value.raw},TemplateLiteral:function(z,se,ne){var ae,be,pt;for(ae=["`"],be=0,pt=z.quasis.length;be<pt;++be)ae.push(this.generateExpression(z.quasis[be],t.Primary,ce)),be+1<pt&&(ae.push("${"+_),ae.push(this.generateExpression(z.expressions[be],t.Sequence,ce)),ae.push(_+"}"));return ae.push("`"),ae},ModuleSpecifier:function(z,se,ne){return this.Literal(z,se,ne)},ImportExpression:function(z,se,ne){return Ft(["import(",this.generateExpression(z.source,t.Assignment,ce),")"],t.Call,se)}},je(St.prototype,St.Expression),St.prototype.generateExpression=function(z,se,ne){var ae,be;return be=z.type||e.Property,T.verbatim&&z.hasOwnProperty(T.verbatim)?Je(z,se):(ae=this[be](z,se,ne),T.comment&&(ae=Gt(z,ae)),Re(ae,z))},St.prototype.generateStatement=function(z,se){var ne,ae;return ne=this[z.type](z,se),T.comment&&(ne=Gt(z,ne)),ae=Re(ne).toString(),z.type===e.Program&&!M&&y===""&&ae.charAt(ae.length-1)===`
`&&(ne=R?Re(ne).replaceRight(/\s+$/,""):ae.replace(/\s+$/,"")),Re(ne,z)};function Kt(z){var se;if(se=new St,V(z))return se.generateStatement(z,Ae);if(U(z))return se.generateExpression(z,t.Sequence,ce);throw new Error("Unknown node type: "+z.type)}function Ut(z,se){var ne=ut(),ae,be;return se!=null?(typeof se.indent=="string"&&(ne.format.indent.style=se.indent),typeof se.base=="number"&&(ne.format.indent.base=se.base),se=gt(ne,se),l=se.format.indent.style,typeof se.base=="string"?o=se.base:o=Wt(l,se.format.indent.base)):(se=ne,l=se.format.indent.style,o=Wt(l,se.format.indent.base)),u=se.format.json,c=se.format.renumber,d=u?!1:se.format.hexadecimal,f=u?"double":se.format.quotes,m=se.format.escapeless,y=se.format.newline,_=se.format.space,se.format.compact&&(y=_=l=o=""),S=se.format.parentheses,b=se.format.semicolons,M=se.format.safeConcatenation,w=se.directive,E=u?null:se.parse,R=se.sourceMap,P=se.sourceCode,I=se.format.preserveBlankLines&&P!==null,T=se,R&&(n.browser?r=Gst.sourceMap.SourceNode:r=Kst().SourceNode),ae=Kt(z),R?(be=ae.toStringWithSourceMap({file:se.file,sourceRoot:se.sourceMapRoot}),se.sourceContent&&be.map.setSourceContent(se.sourceMap,se.sourceContent),se.sourceMapWithCode?be:be.map.toString()):(be={code:ae.toString(),map:null},se.sourceMapWithCode?be:be.code)}B={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},N=ut().format,n.version=Jst.version,n.generate=Ut,n.attachComments=s.attachComments,n.Precedence=gt({},t),n.browser=!1,n.FORMAT_MINIFY=B,n.FORMAT_DEFAULTS=N})()})(g$)),g$}var Qst=qst();const Nbe=wbe(Qst);class eat{constructor(){this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.context={skip:()=>this.should_skip=!0,remove:()=>this.should_remove=!0,replace:e=>this.replacement=e}}replace(e,t,i,r){e&&t&&(i!=null?e[t][i]=r:e[t]=r)}remove(e,t,i){e&&t&&(i!=null?e[t].splice(i,1):delete e[t])}}class tat extends eat{constructor(e,t){super(),this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.context={skip:()=>this.should_skip=!0,remove:()=>this.should_remove=!0,replace:i=>this.replacement=i},this.enter=e,this.leave=t}visit(e,t,i,r){if(e){if(this.enter){const a=this.should_skip,o=this.should_remove,l=this.replacement;this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.enter.call(this.context,e,t,i,r),this.replacement&&(e=this.replacement,this.replace(t,i,r,e)),this.should_remove&&this.remove(t,i,r);const u=this.should_skip,c=this.should_remove;if(this.should_skip=a,this.should_remove=o,this.replacement=l,u)return e;if(c)return null}let s;for(s in e){const a=e[s];if(a&&typeof a=="object")if(Array.isArray(a)){const o=a;for(let l=0;l<o.length;l+=1){const u=o[l];k$(u)&&(this.visit(u,e,s,l)||l--)}}else k$(a)&&this.visit(a,e,s,null)}if(this.leave){const a=this.replacement,o=this.should_remove;this.replacement=null,this.should_remove=!1,this.leave.call(this.context,e,t,i,r),this.replacement&&(e=this.replacement,this.replace(t,i,r,e)),this.should_remove&&this.remove(t,i,r);const l=this.should_remove;if(this.replacement=a,this.should_remove=o,l)return null}}return e}}function k$(n){return n!==null&&typeof n=="object"&&"type"in n&&typeof n.type=="string"}function Bbe(n,{enter:e,leave:t}){return new tat(e,t).visit(n,null)}let nat=[],EE=new Map;function iat(n,e={}){const{wrapAsync:t=!1,addReturn:i=!0,emitMiniLocations:r=!0,emitWidgets:s=!0}=e,a=[];let o=Ist(n,{ecmaVersion:2022,allowAwaitOutsideFunction:!0,locations:!0,onComment:a});const l=Eat(a,n.length);let u=[];const c=(y,_)=>{const S=EE.get("minilang");if(S){const b=`[${y}]`,M=S.getLocations(b,_.start);u=u.concat(M)}else{const b=Q6(`"${y}"`,_.start,n);u=u.concat(b)}};let d=[];Bbe(o,{enter(y,_){if(Mat(y)){const{name:S}=y.tag,b=EE.get(S),M=y.quasi.quasis[0].value.raw,w=y.quasi.start+1;if(r){const T=b.getLocations(M,w);u=u.concat(T)}return this.skip(),this.replace(wat(S,M,w))}if(Aat(y,"tidal")){const S=y.quasi.quasis[0].value.raw,b=y.quasi.start+1;if(r){const M=Tat(S,b);u=u.concat(M)}return this.skip(),this.replace(Cat(S,b))}if(fat(y,_)){if(W$(y.start,l))return;const{quasis:S}=y,{raw:b}=S[0].value;return this.skip(),r&&c(b,y),this.replace(X$(b,y))}if(dat(y)){if(W$(y.start,l))return;const{value:S}=y;return this.skip(),r&&c(S,y),this.replace(X$(S,y))}if(pat(y))return s&&d.push({from:y.arguments[0].start,to:y.arguments[0].end,value:y.arguments[0].raw,min:y.arguments[1]?.value??0,max:y.arguments[2]?.value??1,step:y.arguments[3]?.value,type:"slider"}),this.replace(gat(y));if(mat(y)){const S=y.callee.property.name,b=d.filter(w=>w.type===S).length,M={to:y.end,index:b,type:S,id:e.id};return s&&d.push(M),this.replace(vat(y,M))}if(xat(y,_))return this.replace(bat(y));if(_at(y))return this.replace(Sat(y))},leave(y,_,S,b){if(!rat(y))return;let[M,...w]=y.arguments;if(!M)throw new Error("K(...) requires an expression");sat(M)&&(M={type:"CallExpression",callee:M,arguments:[],optional:!1});const{template:T,patternExprs:E}=aat(M);if(E.length){const I=[{type:"Literal",value:T},...E,...w];let B=y.callee;return B.type==="ChainExpression"&&(B=B.expression),B.type==="MemberExpression"?this.replace({type:"CallExpression",callee:H$(B.object),arguments:I,optional:!1}):this.replace({type:"CallExpression",callee:{type:"Identifier",name:"worklet"},arguments:I,optional:!1})}const R=[{type:"Literal",value:Mz(M)},...w];let P=y.callee;return P.type==="ChainExpression"&&(P=P.expression),P.type==="MemberExpression"?this.replace({type:"CallExpression",callee:H$(P.object),arguments:R,optional:!1}):this.replace({type:"CallExpression",callee:{type:"Identifier",name:"worklet"},arguments:R,optional:!1})}});let{body:f}=o;if(!f.length)console.warn("empty body -> fallback to silence"),f.push({type:"ExpressionStatement",expression:{type:"Identifier",name:"silence"}});else if(!f?.[f.length-1]?.expression)throw new Error("unexpected ast format without body expression");if(i){const{expression:y}=f[f.length-1];f[f.length-1]={type:"ReturnStatement",argument:y}}let m=Nbe.generate(o);return t&&(m=`(async ()=>{${m}})()`),r?{output:m,miniLocations:u,widgets:d}:{output:m}}function rat(n){if(n.type!=="CallExpression")return!1;let e=n.callee;return e.type==="ChainExpression"&&(e=e.expression),e.type==="MemberExpression"?!e.computed&&e.property?.name==="K":e.type==="Identifier"&&e.name==="K"}function sat(n){return n.type!=="ArrowFunctionExpression"&&n.type!=="FunctionExpression"||n.params.length?!1:n.body?.type==="BlockStatement"}function Mz(n){return Nbe.generate(n,{format:{semicolons:!1}})}function aat(n){const e=V$(n),t=new Map,i=[];if(Bbe(e,{enter(a,o,l,u){t.set(a,{parent:o,prop:l,index:u});const c=oat(a);c&&(i.push({node:a,patternExpr:c}),this.skip())}}),!i.length)return{template:Mz(e),patternExprs:[]};i.sort((a,o)=>z$(a.node)-z$(o.node));const r=i.map(({patternExpr:a})=>V$(a));let s=e;return i.forEach(({node:a},o)=>{s=hat(a,cat(o),t,s)}),{template:Mz(s),patternExprs:r}}function oat(n){if(lat(n)){const e=n.arguments?.[0];if(!e)throw new Error("S(...) requires an argument");return e}return Fbe(n)?n:null}function lat(n){if(n.type!=="CallExpression")return!1;const e=n.callee;return e.type==="Identifier"?e.name==="S":e.type==="MemberExpression"&&!e.computed?e.property?.name==="S":!1}function uat(){return EE.get("minilang")?.name||"m"}function Fbe(n){if(n.type!=="CallExpression")return!1;const e=n.callee;if(e.type!=="Identifier"||e.name!==uat())return!1;const t=n.arguments?.[0];return t?.type==="Literal"&&typeof t.value=="string"}function z$(n){if(typeof n.start=="number")return n.start;if(Fbe(n)){const e=n.arguments?.[1];if(e?.type==="Literal"&&typeof e.value=="number")return e.value}return 0}function cat(n){return{type:"MemberExpression",object:{type:"Identifier",name:"pat"},property:{type:"Literal",value:n},computed:!0,optional:!1}}function hat(n,e,t,i){const r=t.get(n);if(!r||!r.parent)return e;const{parent:s,prop:a,index:o}=r;return Array.isArray(s[a])?s[a][o]=e:s[a]=e,t.set(e,{parent:s,prop:a,index:o}),i}function V$(n){return JSON.parse(JSON.stringify(n))}function H$(n){return{type:"MemberExpression",object:n,property:{type:"Identifier",name:"worklet"},computed:!1,optional:!1}}function dat(n,e,t){return n.type!=="Literal"?!1:n.raw[0]==='"'}function fat(n,e){return n.type==="TemplateLiteral"&&e.type!=="TaggedTemplateExpression"}function X$(n,e){const{start:t}=e,i=EE.get("minilang");let r="m";return i&&i.name&&(r=i.name),{type:"CallExpression",callee:{type:"Identifier",name:r},arguments:[{type:"Literal",value:n},{type:"Literal",value:t}],optional:!1}}function pat(n){return n.type==="CallExpression"&&n.callee.name==="slider"}function mat(n){return n.type==="CallExpression"&&nat.includes(n.callee.property?.name)}function gat(n){const e="slider_"+n.arguments[0].start;return n.arguments.unshift({type:"Literal",value:e,raw:e}),n.callee.name="sliderWithID",n}function yat(n){return`${n.id||""}_widget_${n.type}_${n.index}`}function vat(n,e){const t=yat(e);return n.arguments.unshift({type:"Literal",value:t,raw:t}),n}function xat(n,e){return n.type==="CallExpression"&&n.callee.name==="samples"&&e.type!=="AwaitExpression"}function bat(n){return{type:"AwaitExpression",argument:n}}function _at(n){return n.type==="LabeledStatement"}function Sat(n){return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"MemberExpression",object:n.body.expression,property:{type:"Identifier",name:"p"}},arguments:[{type:"Literal",value:n.label.name,raw:`'${n.label.name}'`}]}}}function Mat(n){return n.type==="TaggedTemplateExpression"&&EE.has(n.tag.name)}function Aat(n,e){return n.type==="TaggedTemplateExpression"&&n.tag.name===e}function Tat(n,e){return n.split("").reduce((t,i,r)=>(i!=='"'||(!t.length||t[t.length-1].length>1?t.push([r+1]):t[t.length-1].push(r)),t),[]).map(([t,i])=>{const r=n.slice(t,i);return Q6(`"${r}"`,e+t-1)}).flat()}function Cat(n,e){return{type:"CallExpression",callee:{type:"Identifier",name:"tidal"},arguments:[{type:"Literal",value:n},{type:"Literal",value:e}],optional:!1}}function wat(n,e,t){return{type:"CallExpression",callee:{type:"Identifier",name:n},arguments:[{type:"Literal",value:e},{type:"Literal",value:t}],optional:!1}}function Eat(n,e){const t=[],i=[];for(const r of n){const s=r.value.trim();if(s.startsWith("mini-off"))i.push(r.start);else if(s.startsWith("mini-on")){const a=i.pop();t.push([a,r.end])}}for(;i.length;){const r=i.pop();t.push([r,e])}return t}function W$(n,e){for(const[t,i]of e)if(n>=t&&n<i)return!0;return!1}function u8(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function c8(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var Lbe=[0,2,4,-1,1,3,5],Ibe=Lbe.map(n=>Math.floor(n*7/12));function Gbe(n){const{step:e,alt:t,oct:i,dir:r=1}=n,s=Lbe[e]+7*t;if(i===void 0)return[r*s];const a=i-Ibe[e]-4*t;return[r*s,r*a]}var Rat=[3,0,4,1,5,2,6];function Obe(n){const[e,t,i]=n,r=Rat[Pat(e)],s=Math.floor((e+1)/7);if(t===void 0)return{step:r,alt:s,dir:i};const a=t+4*s+Ibe[r];return{step:r,alt:s,oct:a,dir:i}}function Pat(n){const e=(n+1)%7;return e<0?7+e:e}var Z$=(n,e)=>Array(Math.abs(e)+1).join(n),Az=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),Dat="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Nat="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Bat=new RegExp("^"+Dat+"|"+Nat+"$");function Fat(n){const e=Bat.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var j$={};function Nm(n){return typeof n=="string"?j$[n]||(j$[n]=Lat(n)):c8(n)?Nm(Gat(n)):u8(n)?Nm(n.name):Az}var Y$=[0,2,4,5,7,9,11],Ube="PMMPPMM";function Lat(n){const e=Fat(n);if(e[0]==="")return Az;const t=+e[0],i=e[1],r=(Math.abs(t)-1)%7,s=Ube[r];if(s==="M"&&i==="P")return Az;const a=s==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,u=t===8||t===-8?t:l*(r+1),c=Iat(a,i),d=Math.floor((Math.abs(t)-1)/7),f=l*(Y$[r]+c+12*d),m=(l*(Y$[r]+c)%12+12)%12,y=Gbe({step:r,alt:c,oct:d,dir:l});return{empty:!1,name:o,num:t,q:i,step:r,alt:c,dir:l,type:a,simple:u,semitones:f,chroma:m,coord:y,oct:d}}function kbe(n,e){const[t,i=0]=n,r=t*7+i*12<0,s=e||r?[-t,-i,-1]:[t,i,1];return Nm(Obe(s))}function Iat(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function Gat(n){const{step:e,alt:t,oct:i=0,dir:r}=n;if(!r)return"";const s=e+1+7*i,a=s===0?e+1:s,o=r<0?"-":"",l=Ube[e]==="M"?"majorable":"perfectable";return o+a+Oat(l,t)}function Oat(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?Z$("A",e):Z$("d",n==="perfectable"?e:e+1)}var K$=(n,e)=>Array(Math.abs(e)+1).join(n),zbe=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),$$=new Map,Uat=n=>"CDEFGAB".charAt(n),XL=n=>n<0?K$("b",-n):K$("#",n),h8=n=>n[0]==="b"?-n.length:n.length;function bs(n){const e=JSON.stringify(n),t=$$.get(e);if(t)return t;const i=typeof n=="string"?Hat(n):c8(n)?bs(Xat(n)):u8(n)?bs(n.name):zbe;return $$.set(e,i),i}var kat=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function d8(n){const e=kat.exec(n);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function zat(n){return bs(Obe(n))}var Vat=(n,e)=>(n%e+e)%e,OU=[0,2,4,5,7,9,11];function Hat(n){const e=d8(n);if(e[0]===""||e[3]!=="")return zbe;const t=e[0],i=e[1],r=e[2],s=(t.charCodeAt(0)+3)%7,a=h8(i),o=r.length?+r:void 0,l=Gbe({step:s,alt:a,oct:o}),u=t+i+r,c=t+i,d=(OU[s]+a+120)%12,f=o===void 0?Vat(OU[s]+a,12)-1188:OU[s]+a+12*(o+1),m=f>=0&&f<=127?f:null,y=o===void 0?null:Math.pow(2,(f-69)/12)*440;return{empty:!1,acc:i,alt:a,chroma:d,coord:l,freq:y,height:f,letter:t,midi:m,name:u,oct:o,pc:c,step:s}}function Xat(n){const{step:e,alt:t,oct:i}=n,r=Uat(e);if(!r)return"";const s=r+XL(t);return i||i===0?s+i:s}function tp(n,e){const t=bs(n),i=Array.isArray(e)?e:Nm(e).coord;if(t.empty||!i||i.length<2)return"";const r=t.coord,s=r.length===1?[r[0]+i[0]]:[r[0]+i[0],r[1]+i[1]];return zat(s).name}function Vbe(n,e){const t=n.length;return i=>{if(!e)return"";const r=i<0?(t- -i%t)%t:i%t,s=Math.floor(i/t),a=tp(e,[0,s]);return tp(a,n[r])}}function WL(n,e){const t=bs(n),i=bs(e);if(t.empty||i.empty)return"";const r=t.coord,s=i.coord,a=s[0]-r[0],o=r.length===2&&s.length===2?s[1]-r[1]:-Math.floor(a*7/12),l=i.height===t.height&&i.midi!==null&&t.oct===i.oct&&t.step>i.step;return kbe([a,o],l).name}var J$=(n,e)=>Array(e+1).join(n),Wat=/^(_{1,}|=|\^{1,}|)([abcdefgABCDEFG])([,']*)$/;function Hbe(n){const e=Wat.exec(n);return e?[e[1],e[2],e[3]]:["","",""]}function m2(n){const[e,t,i]=Hbe(n);if(t==="")return"";let r=4;for(let a=0;a<i.length;a++)r+=i.charAt(a)===","?-1:1;const s=e[0]==="_"?e.replace(/_/g,"b"):e[0]==="^"?e.replace(/\^/g,"#"):"";return t.charCodeAt(0)>96?t.toUpperCase()+s+(r+1):t+s+r}function Xbe(n){const e=bs(n);if(e.empty||!e.oct&&e.oct!==0)return"";const{letter:t,acc:i,oct:r}=e,s=i[0]==="b"?i.replace(/b/g,"_"):i.replace(/#/g,"^"),a=r>4?t.toLowerCase():t,o=r===5?"":r>4?J$("'",r-5):J$(",",4-r);return s+a+o}function Zat(n,e){return Xbe(tp(m2(n),e))}function jat(n,e){return WL(m2(n),m2(e))}var Yat={abcToScientificNotation:m2,scientificToAbcNotation:Xbe,tokenize:Hbe,transpose:Zat,distance:jat};function Kat(n,e){const t=[];for(;e--;t[e]=e+n);return t}function $at(n,e){const t=[];for(;e--;t[e]=n-e);return t}function Jat(n,e){return n<e?Kat(n,e-n+1):$at(n,n-e+1)}function qat(n,e){const t=e.length,i=(n%t+t)%t;return e.slice(i,t).concat(e.slice(0,i))}function Qat(n){return n.filter(e=>e===0||e)}function Wbe(n){return n.map(e=>bs(e)).filter(e=>!e.empty).sort((e,t)=>e.height-t.height).map(e=>e.name)}function eot(n){return Wbe(n).filter((e,t,i)=>t===0||e!==i[t-1])}function tot(n,e=Math.random){let t,i,r=n.length;for(;r;)t=Math.floor(e()*r--),i=n[r],n[r]=n[t],n[t]=i;return n}function Zbe(n){return n.length===0?[[]]:Zbe(n.slice(1)).reduce((e,t)=>e.concat(n.map((i,r)=>{const s=t.slice();return s.splice(r,0,n[0]),s})),[])}const not=Object.freeze(Object.defineProperty({__proto__:null,compact:Qat,permutations:Zbe,range:Jat,rotate:qat,shuffle:tot,sortedNoteNames:Wbe,sortedUniqNoteNames:eot},Symbol.toStringTag,{value:"Module"}));function iot(n,e){const t=[];for(;e--;t[e]=e+n);return t}function rot(n,e){const t=[];for(;e--;t[e]=n-e);return t}function ZL(n,e){return n<e?iot(n,e-n+1):rot(n,n-e+1)}function TA(n,e){const t=e.length,i=(n%t+t)%t;return e.slice(i,t).concat(e.slice(0,i))}function f8(n){return n.filter(e=>e===0||e)}function sot(n,e=Math.random){let t,i,r=n.length;for(;r;)t=Math.floor(e()*r--),i=n[r],n[r]=n[t],n[t]=i;return n}function jbe(n){return n.length===0?[[]]:jbe(n.slice(1)).reduce((e,t)=>e.concat(n.map((i,r)=>{const s=t.slice();return s.splice(r,0,n[0]),s})),[])}var aot={compact:f8,permutations:jbe,range:ZL,rotate:TA,shuffle:sot},Xv={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},p8=n=>Number(n).toString(2).padStart(12,"0"),q$=n=>parseInt(n,2),oot=/^[01]{12}$/;function m8(n){return oot.test(n)}var lot=n=>typeof n=="number"&&n>=0&&n<=4095,uot=n=>n&&m8(n.chroma),Q$={[Xv.chroma]:Xv};function Kl(n){const e=m8(n)?n:lot(n)?p8(n):Array.isArray(n)?_ot(n):uot(n)?n.chroma:Xv.chroma;return Q$[e]=Q$[e]||bot(e)}var cot=Kl,Ybe=n=>Kl(n).chroma,hot=n=>Kl(n).intervals,dot=n=>Kl(n).setNum,fot=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function pot(n){const e=[];for(let t=0;t<12;t++)n.charAt(t)==="1"&&e.push(fot[t]);return e}function mot(n){return Kl(n).intervals.map(e=>tp("C",e))}function got(){return ZL(2048,4095).map(p8)}function g8(n,e=!0){const t=Kl(n).chroma.split("");return f8(t.map((i,r)=>{const s=TA(r,t);return e&&s[0]==="0"?null:s.join("")}))}function yot(n,e){return Kl(n).setNum===Kl(e).setNum}function jL(n){const e=Kl(n).setNum;return t=>{const i=Kl(t).setNum;return e&&e!==i&&(i&e)===i}}function YL(n){const e=Kl(n).setNum;return t=>{const i=Kl(t).setNum;return e&&e!==i&&(i|e)===i}}function Kbe(n){const e=Kl(n);return t=>{const i=bs(t);return e&&!i.empty&&e.chroma.charAt(i.chroma)==="1"}}function vot(n){const e=Kbe(n);return t=>t.filter(e)}var $be={get:Kl,chroma:Ybe,num:dot,intervals:hot,chromas:got,isSupersetOf:YL,isSubsetOf:jL,isNoteIncludedIn:Kbe,isEqual:yot,filter:vot,modes:g8,notes:mot,pcset:cot};function xot(n){const e=n.split("");return e.map((t,i)=>TA(i,e).join(""))}function bot(n){const e=q$(n),t=xot(n).map(q$).filter(s=>s>=2048).sort()[0],i=p8(t),r=pot(n);return{empty:!1,name:"",setNum:e,chroma:n,normalized:i,intervals:r}}function _ot(n){if(n.length===0)return Xv.chroma;let e;const t=[0,0,0,0,0,0,0,0,0,0,0,0];for(let i=0;i<n.length;i++)e=bs(n[i]),e.empty&&(e=Nm(n[i])),e.empty||(t[e.chroma]=1);return t.join("")}var Sot=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],Mot=Sot;({...Xv});var y8=[],eB={};function Jbe(){return y8.slice()}function Aot(n,e,t){const i=Cot(n),r={...Kl(n),name:t||"",quality:i,intervals:n,aliases:e};y8.push(r),r.name&&(eB[r.name]=r),eB[r.setNum]=r,eB[r.chroma]=r,r.aliases.forEach(s=>Tot(r,s))}function Tot(n,e){eB[e]=n}function Cot(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}Mot.forEach(([n,e,t])=>Aot(n.split(" "),t.split(" "),e));y8.sort((n,e)=>n.setNum-e.setNum);var wot=n=>{const e=n.reduce((t,i)=>{const r=bs(i).chroma;return r!==void 0&&(t[r]=t[r]||bs(i).name),t},{});return t=>e[t]};function Eot(n,e={}){const t=n.map(i=>bs(i).pc).filter(i=>i);return bs.length===0?[]:Lot(t,1,e).filter(i=>i.weight).sort((i,r)=>r.weight-i.weight).map(i=>i.name)}var KL={anyThirds:384,perfectFifth:16,nonPerfectFifths:40,anySeventh:3},$L=n=>e=>!!(e&n),Rot=$L(KL.anyThirds),Pot=$L(KL.perfectFifth),Dot=$L(KL.anySeventh),Not=$L(KL.nonPerfectFifths);function Bot(n){const e=parseInt(n.chroma,2);return Rot(e)&&Pot(e)&&Dot(e)}function Fot(n){const e=parseInt(n,2);return Not(e)?n:(e|16).toString(2)}function Lot(n,e,t){const i=n[0],r=bs(i).chroma,s=wot(n),a=g8(n,!1),o=[];return a.forEach((l,u)=>{const c=t.assumePerfectFifth&&Fot(l);Jbe().filter(d=>t.assumePerfectFifth&&Bot(d)?d.chroma===c:d.chroma===l).forEach(d=>{const f=d.aliases[0],m=s(u);u!==r?o.push({weight:.5*e,name:`${m}${f}/${i}`}):o.push({weight:1*e,name:`${m}${f}`})})}),o}function a3(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}var qbe=[0,2,4,5,7,9,11],Qbe=({step:n,alt:e})=>(qbe[n]+e+120)%12,v8=({step:n,alt:e,oct:t,dir:i=1})=>i*(qbe[n]+e+12*(t===void 0?-100:t)),e_e=n=>{const e=v8(n);return n.oct!==void 0&&e>=-12&&e<=115?e+12:null};function JL(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"}var t_e=[0,2,4,-1,1,3,5],n_e=t_e.map(n=>Math.floor(n*7/12));function qL(n){const{step:e,alt:t,oct:i,dir:r=1}=n,s=t_e[e]+7*t;if(i===void 0)return[r*s];const a=i-n_e[e]-4*t;return[r*s,r*a]}var Iot=[3,0,4,1,5,2,6];function QL(n){const[e,t,i]=n,r=Iot[Got(e)],s=Math.floor((e+1)/7);if(t===void 0)return{step:r,alt:s,dir:i};const a=t+4*s+n_e[r];return{step:r,alt:s,oct:a,dir:i}}function Got(n){const e=(n+1)%7;return e<0?7+e:e}var eJ=(n,e)=>Array(Math.abs(e)+1).join(n),Tz={empty:!0,name:"",acc:""},Oot="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Uot="(AA|A|P|M|m|d|dd)([-+]?\\d+)",kot=new RegExp("^"+Oot+"|"+Uot+"$");function x8(n){const e=kot.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var tJ={};function Tu(n){return typeof n=="string"?tJ[n]||(tJ[n]=zot(n)):JL(n)?Tu(Hot(n)):a3(n)?Tu(n.name):Tz}var nJ=[0,2,4,5,7,9,11],i_e="PMMPPMM";function zot(n){const e=x8(n);if(e[0]==="")return Tz;const t=+e[0],i=e[1],r=(Math.abs(t)-1)%7,s=i_e[r];if(s==="M"&&i==="P")return Tz;const a=s==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,u=t===8||t===-8?t:l*(r+1),c=Vot(a,i),d=Math.floor((Math.abs(t)-1)/7),f=l*(nJ[r]+c+12*d),m=(l*(nJ[r]+c)%12+12)%12,y=qL({step:r,alt:c,oct:d,dir:l});return{empty:!1,name:o,num:t,q:i,step:r,alt:c,dir:l,type:a,simple:u,semitones:f,chroma:m,coord:y,oct:d}}function o3(n,e){const[t,i=0]=n,r=t*7+i*12<0,s=e||r?[-t,-i,-1]:[t,i,1];return Tu(QL(s))}function Vot(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function Hot(n){const{step:e,alt:t,oct:i=0,dir:r}=n;if(!r)return"";const s=e+1+7*i,a=s===0?e+1:s,o=r<0?"-":"",l=i_e[e]==="M"?"majorable":"perfectable";return o+a+Xot(l,t)}function Xot(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?eJ("A",e):eJ("d",n==="perfectable"?e:e+1)}var iJ=(n,e)=>Array(Math.abs(e)+1).join(n),r_e={empty:!0,name:"",pc:"",acc:""},rJ=new Map,b8=n=>"CDEFGAB".charAt(n),_8=n=>n<0?iJ("b",-n):iJ("#",n),S8=n=>n[0]==="b"?-n.length:n.length;function Bm(n){const e=JSON.stringify(n),t=rJ.get(e);if(t)return t;const i=typeof n=="string"?jot(n):JL(n)?Bm(Yot(n)):a3(n)?Bm(n.name):r_e;return rJ.set(e,i),i}var Wot=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function eI(n){const e=Wot.exec(n);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function M8(n){return Bm(QL(n))}var Zot=(n,e)=>(n%e+e)%e,UU=[0,2,4,5,7,9,11];function jot(n){const e=eI(n);if(e[0]===""||e[3]!=="")return r_e;const t=e[0],i=e[1],r=e[2],s=(t.charCodeAt(0)+3)%7,a=S8(i),o=r.length?+r:void 0,l=qL({step:s,alt:a,oct:o}),u=t+i+r,c=t+i,d=(UU[s]+a+120)%12,f=o===void 0?Zot(UU[s]+a,12)-1188:UU[s]+a+12*(o+1),m=f>=0&&f<=127?f:null,y=o===void 0?null:Math.pow(2,(f-69)/12)*440;return{empty:!1,acc:i,alt:a,chroma:d,coord:l,freq:y,height:f,letter:t,midi:m,name:u,oct:o,pc:c,step:s}}function Yot(n){const{step:e,alt:t,oct:i}=n,r=b8(e);if(!r)return"";const s=r+_8(t);return i||i===0?s+i:s}function FM(n,e){const t=Bm(n),i=Array.isArray(e)?e:Tu(e).coord;if(t.empty||!i||i.length<2)return"";const r=t.coord,s=r.length===1?[r[0]+i[0]]:[r[0]+i[0],r[1]+i[1]];return M8(s).name}function tI(n,e){const t=n.length;return i=>{if(!e)return"";const r=i<0?(t- -i%t)%t:i%t,s=Math.floor(i/t),a=FM(e,[0,s]);return FM(a,n[r])}}function A8(n,e){const t=Bm(n),i=Bm(e);if(t.empty||i.empty)return"";const r=t.coord,s=i.coord,a=s[0]-r[0],o=r.length===2&&s.length===2?s[1]-r[1]:-Math.floor(a*7/12),l=i.height===t.height&&i.midi!==null&&t.midi!==null&&t.step>i.step;return o3([a,o],l).name}var s_e=(n,e)=>Array(Math.abs(e)+1).join(n);function CA(n,e,t){return function(...i){return console.warn(`${n} is deprecated. Use ${e}.`),t.apply(this,i)}}var a_e=CA("isNamed","isNamedPitch",a3);const o_e=Object.freeze(Object.defineProperty({__proto__:null,accToAlt:S8,altToAcc:_8,chroma:Qbe,coordToInterval:o3,coordToNote:M8,coordinates:qL,deprecate:CA,distance:A8,fillStr:s_e,height:v8,interval:Tu,isNamed:a_e,isNamedPitch:a3,isPitch:JL,midi:e_e,note:Bm,pitch:QL,stepToLetter:b8,tokenizeInterval:x8,tokenizeNote:eI,tonicIntervalsTransposer:tI,transpose:FM},Symbol.toStringTag,{value:"Module"}));var Kot=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],$ot=Kot,Jot={...Xv,name:"",quality:"Unknown",intervals:[],aliases:[]},wA=[],Vx={};function T8(n){return Vx[n]||Jot}var qot=CA("ChordType.chordType","ChordType.get",T8);function Qot(){return wA.map(n=>n.name).filter(n=>n)}function elt(){return wA.map(n=>n.aliases[0]).filter(n=>n)}function tlt(){return Object.keys(Vx)}function nI(){return wA.slice()}var nlt=CA("ChordType.entries","ChordType.all",nI);function ilt(){wA=[],Vx={}}function l_e(n,e,t){const i=slt(n),r={...Kl(n),name:t||"",quality:i,intervals:n,aliases:e};wA.push(r),r.name&&(Vx[r.name]=r),Vx[r.setNum]=r,Vx[r.chroma]=r,r.aliases.forEach(s=>rlt(r,s))}function rlt(n,e){Vx[e]=n}function slt(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}$ot.forEach(([n,e,t])=>l_e(n.split(" "),t.split(" "),e));wA.sort((n,e)=>n.setNum-e.setNum);var u_e={names:Qot,symbols:elt,get:T8,all:nI,add:l_e,removeAll:ilt,keys:tlt,entries:nlt,chordType:qot},alt=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],olt=alt,llt={...Xv,intervals:[],aliases:[]},iI=[],Hx={};function c_e(){return iI.map(n=>n.name)}function rI(n){return Hx[n]||llt}var ult=rI;function EA(){return iI.slice()}var clt=EA;function hlt(){return Object.keys(Hx)}function dlt(){iI=[],Hx={}}function h_e(n,e,t=[]){const i={...Kl(n),name:e,intervals:n,aliases:t};return iI.push(i),Hx[i.name]=i,Hx[i.setNum]=i,Hx[i.chroma]=i,i.aliases.forEach(r=>flt(i,r)),i}function flt(n,e){Hx[e]=n}olt.forEach(([n,e,...t])=>h_e(n.split(" "),e,t));var d_e={names:c_e,get:rI,all:EA,add:h_e,removeAll:dlt,keys:hlt,entries:clt,scaleType:ult},Cz={empty:!0,name:"",symbol:"",root:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function C8(n){const[e,t,i,r]=eI(n);return e===""?["",n]:e==="A"&&r==="ug"?["","aug"]:[e+t,i+r]}function Vb(n){if(n==="")return Cz;if(Array.isArray(n)&&n.length===2)return tB(n[1],n[0]);{const[e,t]=C8(n),i=tB(t,e);return i.empty?tB(n):i}}function tB(n,e,t){const i=T8(n),r=Bm(e||""),s=Bm(t||"");if(i.empty||e&&r.empty||t&&s.empty)return Cz;const a=A8(r.pc,s.pc),o=i.intervals.indexOf(a)+1;if(!s.empty&&!o)return Cz;const l=Array.from(i.intervals);for(let f=1;f<o;f++){const m=l[0][0],y=l[0][1],_=parseInt(m,10)+7;l.push(`${_}${y}`),l.shift()}const u=r.empty?[]:l.map(f=>FM(r,f));n=i.aliases.indexOf(n)!==-1?n:i.aliases[0];const c=`${r.empty?"":r.pc}${n}${s.empty||o<=1?"":"/"+s.pc}`,d=`${e?r.pc+" ":""}${i.name}${o>1&&t?" over "+s.pc:""}`;return{...i,name:d,symbol:c,type:i.name,root:s.name,intervals:l,rootDegree:o,tonic:r.name,notes:u}}var plt=CA("Chord.chord","Chord.get",Vb);function mlt(n,e){const[t,i]=C8(n);return t?FM(t,e)+i:n}function glt(n){const e=Vb(n),t=YL(e.chroma);return EA().filter(i=>t(i.chroma)).map(i=>i.name)}function ylt(n){const e=Vb(n),t=YL(e.chroma);return nI().filter(i=>t(i.chroma)).map(i=>e.tonic+i.aliases[0])}function vlt(n){const e=Vb(n),t=jL(e.chroma);return nI().filter(i=>t(i.chroma)).map(i=>e.tonic+i.aliases[0])}function xlt(n){const{intervals:e,tonic:t}=Vb(n),i=tI(e,t);return r=>r?i(r>0?r-1:r):""}function blt(n){const{intervals:e,tonic:t}=Vb(n);return tI(e,t)}var _lt={getChord:tB,get:Vb,detect:Eot,chordScales:glt,extended:ylt,reduced:vlt,tokenize:C8,transpose:mlt,degrees:xlt,steps:blt,chord:plt},Slt=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],Mlt=Slt,sI=[];Mlt.forEach(([n,e,t])=>Dlt(n,e,t));var Alt={empty:!0,name:"",value:0,fraction:[0,0],shorthand:"",dots:"",names:[]};function Tlt(){return sI.reduce((n,e)=>(e.names.forEach(t=>n.push(t)),n),[])}function Clt(){return sI.map(n=>n.shorthand)}var wlt=/^([^.]+)(\.*)$/;function w8(n){const[e,t,i]=wlt.exec(n)||[],r=sI.find(o=>o.shorthand===t||o.names.includes(t));if(!r)return Alt;const s=Nlt(r.fraction,i.length),a=s[0]/s[1];return{...r,name:n,dots:i,value:a,fraction:s}}var Elt=n=>w8(n).value,Rlt=n=>w8(n).fraction,Plt={names:Tlt,shorthands:Clt,get:w8,value:Elt,fraction:Rlt};function Dlt(n,e,t){sI.push({empty:!1,dots:"",name:"",value:1/n,fraction:n<1?[1/n,1]:[1,n],shorthand:e,names:t})}function Nlt(n,e){const t=Math.pow(2,e);let i=n[0]*t,r=n[1]*t;const s=i;for(let a=0;a<e;a++)i+=s/Math.pow(2,a+1);for(;i%2===0&&r%2===0;)i/=2,r/=2;return[i,r]}function Blt(){return"1P 2M 3M 4P 5P 6m 7m".split(" ")}var f_e=Tu,Flt=n=>Tu(n).name,Llt=n=>Tu(n).semitones,Ilt=n=>Tu(n).q,Glt=n=>Tu(n).num;function Olt(n){const e=Tu(n);return e.empty?"":e.simple+e.q}function Ult(n){const e=Tu(n);if(e.empty)return"";const t=(7-e.step)%7,i=e.type==="perfectable"?-e.alt:-(e.alt+1);return Tu({step:t,alt:i,oct:e.oct,dir:e.dir}).name}var klt=[1,2,2,3,3,4,5,5,6,6,7,7],zlt="P m M m M P d P m M m M".split(" ");function Vlt(n){const e=n<0?-1:1,t=Math.abs(n),i=t%12,r=Math.floor(t/12);return e*(klt[i]+7*r)+zlt[i]}var Hlt=WL,p_e=m_e((n,e)=>[n[0]+e[0],n[1]+e[1]]),Xlt=n=>e=>p_e(n,e),Wlt=m_e((n,e)=>[n[0]-e[0],n[1]-e[1]]);function Zlt(n,e){const t=f_e(n);if(t.empty)return"";const[i,r,s]=t.coord;return o3([i+e,r,s]).name}var vb={names:Blt,get:f_e,name:Flt,num:Glt,semitones:Llt,quality:Ilt,fromSemitones:Vlt,distance:Hlt,invert:Ult,simplify:Olt,add:p_e,addTo:Xlt,substract:Wlt,transposeFifths:Zlt};function m_e(n){return(e,t)=>{const i=Tu(e).coord,r=Tu(t).coord;if(i&&r){const s=n(i,r);return o3(s).name}}}function g_e(n){return+n>=0&&+n<=127}function y_e(n){if(g_e(n))return+n;const e=bs(n);return e.empty?null:e.midi}function jlt(n,e=440){return Math.pow(2,(n-69)/12)*e}var Ylt=Math.log(2),Klt=Math.log(440);function E8(n){const e=12*(Math.log(n)-Klt)/Ylt+69;return Math.round(e*100)/100}var $lt="C C# D D# E F F# G G# A A# B".split(" "),Jlt="C Db D Eb E F Gb G Ab A Bb B".split(" ");function l1(n,e={}){if(isNaN(n)||n===-1/0||n===1/0)return"";n=Math.round(n);const t=(e.sharps===!0?$lt:Jlt)[n%12];if(e.pitchClass)return t;const i=Math.floor(n/12)-1;return t+i}function R8(n){return n%12}function qlt(n){return n.split("").reduce((e,t,i)=>(i<12&&t==="1"&&e.push(i),e),[])}function Qlt(n){return n.map(R8).sort((e,t)=>e-t).filter((e,t,i)=>t===0||e!==i[t-1])}function P8(n){return Array.isArray(n)?Qlt(n):qlt(n)}function eut(n){const e=P8(n);return t=>{const i=R8(t);for(let r=0;r<12;r++){if(e.includes(i+r))return t+r;if(e.includes(i-r))return t-r}}}function v_e(n,e){const t=P8(n),i=t.length;return r=>{const s=r<0?(i- -r%i)%i:r%i,a=Math.floor(r/i);return t[s]+a*12+e}}function tut(n,e){const t=v_e(n,e);return i=>{if(i!==0)return t(i>0?i-1:i)}}var nut={chroma:R8,freqToMidi:E8,isMidi:g_e,midiToFreq:jlt,midiToNoteName:l1,pcsetNearest:eut,pcset:P8,pcsetDegrees:tut,pcsetSteps:v_e,toMidi:y_e},iut=["C","D","E","F","G","A","B"],x_e=n=>n.name,b_e=n=>n.map(bs).filter(e=>!e.empty);function rut(n){return n===void 0?iut.slice():Array.isArray(n)?b_e(n).map(x_e):[]}var np=bs,sut=n=>np(n).name,aut=n=>np(n).pc,out=n=>np(n).acc,lut=n=>np(n).oct,uut=n=>np(n).midi,cut=n=>np(n).freq,hut=n=>np(n).chroma;function __e(n){return l1(n)}function dut(n){return l1(E8(n))}function fut(n){return l1(E8(n),{sharps:!0})}function put(n){return l1(n,{sharps:!0})}var mut=WL,Xf=tp,gut=tp,S_e=n=>e=>Xf(e,n),yut=S_e,M_e=n=>e=>Xf(n,e),vut=M_e;function g2(n,e){return Xf(n,[e,0])}var xut=g2;function but(n,e){return Xf(n,[0,e])}var D8=(n,e)=>n.height-e.height,_ut=(n,e)=>e.height-n.height;function A_e(n,e){return e=e||D8,b_e(n).sort(e).map(x_e)}function T_e(n){return A_e(n,D8).filter((e,t,i)=>t===0||e!==i[t-1])}var Sut=n=>{const e=np(n);return e.empty?"":l1(e.midi||e.chroma,{sharps:e.alt>0,pitchClass:e.midi===null})};function C_e(n,e){const t=np(n);if(t.empty)return"";const i=np(e||l1(t.midi||t.chroma,{sharps:t.alt<0,pitchClass:!0}));if(i.empty||i.chroma!==t.chroma)return"";if(t.oct===void 0)return i.pc;const r=t.chroma-t.alt,s=i.chroma-i.alt,a=r>11||s<0?-1:r<0||s>11?1:0,o=t.oct+a;return i.pc+o}var ym={names:rut,get:np,name:sut,pitchClass:aut,accidentals:out,octave:lut,midi:uut,ascending:D8,descending:_ut,distance:mut,sortedNames:A_e,sortedUniqNames:T_e,fromMidi:__e,fromMidiSharps:put,freq:cut,fromFreq:dut,fromFreqSharps:fut,chroma:hut,transpose:Xf,tr:gut,transposeBy:S_e,trBy:yut,transposeFrom:M_e,trFrom:vut,transposeFifths:g2,transposeOctaves:but,trFifths:xut,simplify:Sut,enharmonic:C_e},w_e={empty:!0,name:"",chordType:""},sJ={};function Wv(n){return typeof n=="string"?sJ[n]||(sJ[n]=Rut(n)):typeof n=="number"?Wv(aI[n]||""):c8(n)?Tut(n):u8(n)?Wv(n.name):w_e}var Mut=Wv;function Aut(n=!0){return(n?aI:Eut).slice()}function Tut(n){return Wv(XL(n.alt)+aI[n.step])}var Cut=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function wut(n){return Cut.exec(n)||["","","",""]}var E_e="I II III IV V VI VII",aI=E_e.split(" "),Eut=E_e.toLowerCase().split(" ");function Rut(n){const[e,t,i,r]=wut(n);if(!i)return w_e;const s=i.toUpperCase(),a=aI.indexOf(s),o=h8(t),l=1;return{empty:!1,name:e,roman:i,interval:Nm({step:a,alt:o,dir:l}).name,acc:t,chordType:r,alt:o,step:a,major:i===s,oct:0,dir:l}}var Put={names:Aut,get:Wv,romanNumeral:Mut},Vl=Object.freeze([]),R_e={type:"major",tonic:"",alteration:0,keySignature:""},nB={tonic:"",grades:Vl,intervals:Vl,scale:Vl,triads:Vl,chords:Vl,chordsHarmonicFunction:Vl,chordScales:Vl,secondaryDominants:Vl,secondaryDominantSupertonics:Vl,substituteDominantsMinorRelative:Vl,substituteDominants:Vl,substituteDominantSupertonics:Vl,secondaryDominantsMinorRelative:Vl},Dut={...R_e,...nB,type:"major",minorRelative:"",scale:Vl,substituteDominants:Vl,secondaryDominantSupertonics:Vl,substituteDominantsMinorRelative:Vl},Nut={...R_e,type:"minor",relativeMajor:"",natural:nB,harmonic:nB,melodic:nB},kU=(n,e,t="")=>e.map((i,r)=>`${n[r]}${t}${i}`);function oI(n,e,t,i,r){return s=>{const a=n.map(m=>Wv(m).interval||""),o=a.map(m=>Xf(s,m)),l=kU(o,t),u=o.map(m=>Xf(m,"5P")).map(m=>o.includes(m)&&!l.includes(m+"7")?m+"7":""),c=aJ(u,e),d=u.map(m=>{if(!m)return"";const y=m.slice(0,-1);return Xf(y,"5d")+"7"}),f=aJ(d,e);return{tonic:s,grades:n,intervals:a,scale:o,triads:kU(o,e),chords:l,chordsHarmonicFunction:i.slice(),chordScales:kU(o,r," "),secondaryDominants:u,secondaryDominantSupertonics:c,substituteDominants:d,substituteDominantSupertonics:f,secondaryDominantsMinorRelative:c,substituteDominantsMinorRelative:f}}}var aJ=(n,e)=>n.map((t,i)=>{if(!t)return"";const r=t.slice(0,-1),s=Xf(r,"5P");return e[i].endsWith("m")?s+"m7":s+"m7b5"}),P_e=(n,e)=>{const t=bs(n),i=bs(e);return t.empty||i.empty?0:i.coord[0]-t.coord[0]},But=oI("I II III IV V VI VII".split(" ")," m m   m dim".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(",")),Fut=oI("I II bIII IV V bVI bVII".split(" "),"m dim  m m  ".split(" "),"m7 m7b5 maj7 m7 m7 maj7 7".split(" "),"T SD T SD D SD SD".split(" "),"minor,locrian,major,dorian,phrygian,lydian,mixolydian".split(",")),Lut=oI("I II bIII IV V bVI VII".split(" "),"m dim aug m   dim".split(" "),"mMaj7 m7b5 +maj7 m7 7 maj7 o7".split(" "),"T SD T SD D SD D".split(" "),"harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian".split(",")),Iut=oI("I II bIII IV V VI VII".split(" "),"m m aug   dim dim".split(" "),"m6 m7 +maj7 7 7 m7b5 m7b5".split(" "),"T SD T SD D  ".split(" "),"melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered".split(","));function Gut(n){const e=bs(n).pc;if(!e)return Dut;const t=But(e),i=P_e("C",e);return{...t,type:"major",minorRelative:Xf(e,"-3m"),alteration:i,keySignature:XL(i)}}function Out(n){const e=bs(n).pc;if(!e)return Nut;const t=P_e("C",e)-3;return{type:"minor",tonic:e,relativeMajor:Xf(e,"3m"),alteration:t,keySignature:XL(t),natural:Fut(e),harmonic:Lut(e),melodic:Iut(e)}}function Uut(n){return typeof n=="number"?g2("C",n):typeof n=="string"&&/^b+|#+$/.test(n)?g2("C",h8(n)):null}var kut={majorKey:Gut,majorTonicFromKeySignature:Uut,minorKey:Out},zut=Nm;function Vut(n){const e=Nm(n);return e.empty?"":e.simple+e.q}function Hut(n,e){const t=zut(n);if(t.empty)return"";const[i,r,s]=t.coord;return kbe([i+e,r,s]).name}var N8=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],oJ={...Xv,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},B8=N8.map(jut),wz={};B8.forEach(n=>{wz[n.name]=n,n.aliases.forEach(e=>{wz[e]=n})});function xb(n){return typeof n=="string"?wz[n.toLowerCase()]||oJ:n&&n.name?xb(n.name):oJ}var Xut=xb;function D_e(){return B8.slice()}var Wut=D_e;function Zut(){return B8.map(n=>n.name)}function jut(n){const[e,t,i,r,s,a,o]=n,l=o?[o]:[],u=Number(t).toString(2);return{empty:!1,intervals:rI(r).intervals,modeNum:e,chroma:u,normalized:u,name:r,setNum:t,alt:i,triad:s,seventh:a,aliases:l}}function Yut(n,e){return xb(n).intervals.map(t=>tp(e,t))}function N_e(n){return(e,t)=>{const i=xb(e);if(i.empty)return[];const r=TA(i.modeNum,n),s=i.intervals.map(a=>tp(t,a));return r.map((a,o)=>s[o]+a)}}var Kut=N_e(N8.map(n=>n[4])),$ut=N_e(N8.map(n=>n[5]));function B_e(n,e){const t=xb(e),i=xb(n);return t.empty||i.empty?"":Vut(Hut("1P",i.alt-t.alt))}function Jut(n,e,t){return tp(t,B_e(n,e))}var qut={get:xb,names:Zut,all:D_e,distance:B_e,relativeTonic:Jut,notes:Yut,triads:Kut,seventhChords:$ut,entries:Wut,mode:Xut};function Qut(n){const[e,t,i,r]=d8(n);return e===""?zU("",n):e==="A"&&r==="ug"?zU("","aug"):zU(e+t,i+r)}function zU(n,e){const t=e.split("/");if(t.length===1)return[n,t[0],""];const[i,r,s,a]=d8(t[1]);return i!==""&&s===""&&a===""?[n,t[0],i+r]:[n,e,""]}function ect(n,e){return e.map(Wv).map(t=>tp(n,Nm(t))+t.chordType)}function tct(n,e){return e.map(t=>{const[i,r]=Qut(t),s=WL(n,i);return Wv(Nm(s)).name+r})}var nct={fromRomanNumerals:ect,toRomanNumerals:tct};function F_e(n){const e=f8(n.map(t=>typeof t=="number"?t:y_e(t)));return!n.length||e.length!==n.length?[]:e.reduce((t,i)=>{const r=t[t.length-1];return t.concat(ZL(r,i).slice(1))},[e[0]])}function ict(n,e){return F_e(n).map(t=>l1(t,e))}var rct={numeric:F_e,chromatic:ict},sct={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function L_e(n){if(typeof n!="string")return["",""];const e=n.indexOf(" "),t=bs(n.substring(0,e));if(t.empty){const r=bs(n);return r.empty?["",n]:[r.name,""]}const i=n.substring(t.name.length+1).toLowerCase();return[t.name,i.length?i:""]}var act=c_e;function Fm(n){const e=Array.isArray(n)?n:L_e(n),t=bs(e[0]).name,i=rI(e[1]);if(i.empty)return sct;const r=i.name,s=t?i.intervals.map(o=>tp(t,o)):[],a=t?t+" "+r:r;return{...i,name:a,type:r,tonic:t,notes:s}}var oct=Fm;function lct(n,e={}){const t=Ybe(n),i=bs(e.tonic??n[0]??""),r=i.chroma;if(r===void 0)return[];const s=t.split("");s[r]="1";const a=TA(r,s).join(""),o=EA().find(u=>u.chroma===a),l=[];return o&&l.push(i.name+" "+o.name),e.match==="exact"||I_e(a).forEach(u=>{l.push(i.name+" "+u)}),l}function uct(n){const e=Fm(n),t=jL(e.chroma);return Jbe().filter(i=>t(i.chroma)).map(i=>i.aliases[0])}function I_e(n){const e=m8(n)?n:Fm(n).chroma,t=YL(e);return EA().filter(i=>t(i.chroma)).map(i=>i.name)}function cct(n){const e=jL(Fm(n).chroma);return EA().filter(t=>e(t.chroma)).map(t=>t.name)}function G_e(n){const e=n.map(r=>bs(r).pc).filter(r=>r),t=e[0],i=T_e(e);return TA(i.indexOf(t),i)}function hct(n){const e=Fm(n);if(e.empty)return[];const t=e.tonic?e.notes:e.intervals;return g8(e.chroma).map((i,r)=>{const s=Fm(i).name;return s?[t[r],s]:["",""]}).filter(i=>i[0])}function dct(n){const e=Array.isArray(n)?G_e(n):Fm(n).notes,t=e.map(i=>bs(i).chroma);return i=>{const r=bs(typeof i=="number"?__e(i):i),s=r.height;if(s===void 0)return;const a=s%12,o=t.indexOf(a);if(o!==-1)return C_e(r.name,e[o])}}function fct(n){const e=dct(n);return(t,i)=>{const r=bs(t).height,s=bs(i).height;return r===void 0||s===void 0?[]:ZL(r,s).map(e).filter(a=>a)}}function pct(n){const{intervals:e,tonic:t}=Fm(n),i=Vbe(e,t);return r=>r?i(r>0?r-1:r):""}function mct(n){const{intervals:e,tonic:t}=Fm(n);return Vbe(e,t)}var y2={degrees:pct,detect:lct,extended:I_e,get:Fm,modeNames:hct,names:act,rangeOf:fct,reduced:cct,scaleChords:uct,scaleNotes:G_e,steps:mct,tokenize:L_e,scale:oct},gct={empty:!0,name:"",upper:void 0,lower:void 0,type:void 0,additive:[]},yct=["4/4","3/4","2/4","2/2","12/8","9/8","6/8","3/8"];function vct(){return yct.slice()}var xct=/^(\d*\d(?:\+\d)*)\/(\d+)$/,lJ=new Map;function bct(n){const e=JSON.stringify(n),t=lJ.get(e);if(t)return t;const i=Mct(F8(n));return lJ.set(e,i),i}function F8(n){if(typeof n=="string"){const[s,a,o]=xct.exec(n)||[];return F8([a,o])}const[e,t]=n,i=+t;if(typeof e=="number")return[e,i];const r=e.split("+").map(s=>+s);return r.length===1?[r[0],i]:[r,i]}var _ct={names:vct,parse:F8,get:bct},Sct=n=>Math.log(n)/Math.log(2)%1===0;function Mct([n,e]){const t=Array.isArray(n)?n.reduce((o,l)=>o+l,0):n,i=e;if(t===0||i===0)return gct;const r=Array.isArray(n)?`${n.join("+")}/${e}`:`${n}/${e}`,s=Array.isArray(n)?n:[],a=i===4||i===2?"simple":i===8&&t%3===0?"compound":Sct(i)?"irregular":"irrational";return{empty:!1,name:r,type:a,upper:t,lower:i,additive:s}}var Act=o_e,Tct=$be,Cct=u_e,wct=d_e;const Ect=Object.freeze(Object.defineProperty({__proto__:null,AbcNotation:Yat,Array:not,Chord:_lt,ChordDictionary:Cct,ChordType:u_e,Collection:aot,Core:o_e,DurationValue:Plt,Interval:vb,Key:kut,Midi:nut,Mode:qut,Note:ym,PcSet:Tct,Pcset:$be,Progression:nct,Range:rct,RomanNumeral:Put,Scale:y2,ScaleDictionary:wct,ScaleType:d_e,TimeSignature:_ct,Tonal:Act,accToAlt:S8,altToAcc:_8,chroma:Qbe,coordToInterval:o3,coordToNote:M8,coordinates:qL,deprecate:CA,distance:A8,fillStr:s_e,height:v8,interval:Tu,isNamed:a_e,isNamedPitch:a3,isPitch:JL,midi:e_e,note:Bm,pitch:QL,stepToLetter:b8,tokenizeInterval:x8,tokenizeNote:eI,tonicIntervalsTransposer:tI,transpose:FM},Symbol.toStringTag,{value:"Module"})),Rct=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Pct=["c","db","d","eb","e","f","gb","g","ab","a","bb","b"],Dct=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Nct={b:-1,"#":1},Bct=n=>{const[e,...t]=n.split("");return Pct.indexOf(e.toLowerCase())+t.reduce((i,r)=>i+Nct[r],0)};function Fct(n){const e=(n||"").match(/^([A-G][b#]*)([^/]*)[/]?([A-G][b#]*)?$/);return e?e.slice(1):[]}const Ez=n=>n%12,O_e=n=>{let e=Number(n);return isNaN(e)?vb.semitones(n):e},Rz=(n,e)=>{if(typeof n=="number")return n;if(typeof n=="string")return Rm(n,e)},Lct=(n,e=!1)=>{const t=Math.floor(n/12)-1;return(e?Dct:Rct)[n%12]+t};function Ict(n,e,t=1){n=n.map(r=>typeof r=="string"?Rm(r):r);const i=Math.floor(e/n.length)*t*12;return e=zd(e,n.length),n[e]+i}function U_e(n,e,t){let i=0,r=1/0;return e.forEach((s,a)=>{const o=Math.abs(s-n);(!t&&o<r||t&&o<=r)&&(i=a,r=o)}),i}let VU={};function Gct(n,e,t,i){const[r,s]=y2.tokenize(e),a=Rz(r),o=Ez(a);if(!VU[s]){const{intervals:d}=y2.get(`C ${s}`);VU[s]=d.map(O_e)}const l=VU[s];if(!l)return null;let u=a;if(t){t=Rz(t,3);const d=Ez(t),f=zd(d-o,12),m=U_e(f,l,i);n=n+m,u=t-f}const c=Math.floor(n/l.length)*12;return n=zd(n,l.length),l[n]+u+c}let uJ={below:n=>n.slice(-1)[0],duck:n=>n.slice(-1)[0],above:n=>n[0],root:n=>n[0]};function Oct({chord:n,dictionary:e,offset:t=0,n:i,mode:r="below",anchor:s="c5",octaves:a=1}){const[o,l]=Fct(n),u=Bct(o);s=Rz(s?.note||s,4);const c=Ez(s),d=e[l].map(R=>(typeof R=="string"?R.split(" "):R).map(O_e));let f,m,y=d.map((R,P)=>{const I=uJ[r](R),B=zd(c-I-u,12);return(f===void 0||B<f)&&(f=B,m=P),B});r==="root"&&(m=0);const _=Math.ceil(t/d.length)*12,S=zd(m+t,d.length),b=d[S],M=uJ[r](b),w=s-y[S]+_,T=b.map(R=>w-M+R);let E=T.map(R=>Lct(R));return r==="duck"&&(E=E.filter((R,P)=>T[P]!==s)),i!==void 0?[Ict(E,i,a)]:E}const Uct=n=>(n<=0?-1:1)+n*7+"P";function L8(n){n=n.replaceAll(":"," ");const e=y2.get(n),{tonic:t,empty:i}=e;if(i&&Ub(n)||i&&!t)throw new Error(`Scale name ${n} is incomplete. Make sure to use ":" instead of spaces, example: .scale("C:major")`);if(i)throw new Error(`Invalid scale name "${n}"`);return e}function kct(n,e){n=Math.ceil(n);let{intervals:t,tonic:i}=L8(e);i=i||"C";const{pc:r,oct:s=3}=ym.get(i),a=Math.floor(n/t.length),o=zd(n,t.length),l=vb.add(t[o],Uct(a));return ym.transpose(r+s,l)}function cJ(n,e,t){let{notes:i}=L8(n);if(i=i.map(d=>ym.get(d).pc),e=Number(e),isNaN(e))throw new Error(`scale offset "${e}" not a number`);const{pc:r,oct:s=3}=ym.get(t),a=i.indexOf(r);if(a===-1)throw new Error(`note "${t}" is not in scale "${n}"`);let o=a,l=s,u=r;const c=Math.sign(e);for(;Math.abs(o-a)<Math.abs(e);){o+=c;const d=zd(o,i.length);c<0&&u[0]==="C"&&(l+=c),u=i[d],c>0&&u[0]==="C"&&(l+=c)}return u+l}const{transpose:zct,trans:Vct}=Nt(["transpose","trans"],function(n,e){return e.withHap(t=>{const i=t.value.note??t.value;if(typeof i=="number"){let a;typeof n=="number"?a=n:typeof n=="string"&&(a=vb.semitones(n)||0);const o=i+a;return typeof t.value=="object"?t.withValue(()=>({...t.value,note:o})):t.withValue(()=>o)}if(typeof i!="string"||!Ub(i))return Cl(`[tonal] transpose: not a note "${i}"`,"warning"),t;const r=isNaN(Number(n))?String(n):vb.fromSemitones(n),s=ym.transpose(i,r);return typeof t.value=="object"?t.withValue(()=>({...t.value,note:s})):t.withValue(()=>s)})}),{scaleTranspose:Hct,scaleTrans:Xct,strans:Wct}=Nt(["scaleTranspose","scaleTrans","strans"],function(n,e){return e.withHap(t=>{if(!t.context.scale)throw new Error("can only use scaleTranspose after .scale");if(typeof t.value=="object")return t.withValue(()=>({...t.value,note:cJ(t.context.scale,Number(n),t.value.note)}));if(typeof t.value!="string")throw new Error("can only use scaleTranspose with notes");return t.withValue(()=>cJ(t.context.scale,Number(n),t.value))})});function Zct(n){let e=Number(n),t=0;if(isNaN(e)){n=String(n);const i=/^(-?\d+)([#bsf]*)$/.exec(n);if(!i)throw new Error(`invalid scale step "${n}", expected number or integer with optional # b suffixes`);e=Number(i[1]);const r=i[2]||"";t=n6(r)}return[e,t]}let HU={};function jct(n,e,t=!0){let i=typeof e=="string"?Rm(e):e;if(HU[n]===void 0){const{intervals:d,tonic:f}=L8(n),{pc:m}=ym.get(f),y=d.concat("8P").map(S=>ym.transpose(m+"0",S)),_=y.map(Rm);HU[n]=[_,y]}const[r,s]=HU[n],a=r[0],o=Math.floor((i-a)/12),l=r.map(d=>d+12*o),u=U_e(i,l,t),c=s[u];return ym.transpose(c,vb.fromSemitones(12*o))}const Yct=Nt("scale",function(n,e){return Array.isArray(n)&&(n=n.flat().join(" ")),e.withHaps(t=>(t=t.map(i=>{let r=i.value;const s=typeof r=="object";r=s?r:{n:r};const{note:a,n:o,value:l,...u}=r,c=a??o??l;if(c===void 0)return Cl(`[tonal] Invalid value format for 'scale'. Value must contain n, note, or value but received keys [${Object.keys(r).join(", ")}]`,"error"),i;let d;if(Ub(c))d=jct(n,c),i.value={...u,note:d};else try{const[f,m]=Zct(c);u.anchor?d=Gct(f,n,u.anchor):d=kct(f,n),m!=0&&(d=ym.transpose(d,vb.fromSemitones(m)))}catch(f){JR(f,"tonal");return}return i.value=s?{...u,note:d}:d,i.setContext({...i.context,scale:n})}),kb(t)))},!0,!0);var hJ={},pN={},OC={},dJ;function k_e(){if(dJ)return OC;dJ=1,OC.__esModule=!0,OC.getBestVoicing=void 0;function n(e){var t=e.chord,i=e.range,r=e.finder,s=e.picker,a=e.lastVoicing,o=r(t,i);return o.length?s(o,a):[]}return OC.getBestVoicing=n,OC}var UC={};const z_e=Ost(Ect);var kC={},fJ;function V_e(){if(fJ)return kC;fJ=1,kC.__esModule=!0,kC.tokenizeChord=void 0;function n(e){var t=(e||"").match(/^([A-G][b#]*)([^\/]*)[\/]?([A-G][b#]*)?$/);return t?t.slice(1):[]}return kC.tokenizeChord=n,kC}var pJ;function Kct(){if(pJ)return UC;pJ=1,UC.__esModule=!0,UC.voicingsInRange=void 0;var n=z_e,e=H_e(),t=V_e();function i(r,s,a){s===void 0&&(s=e.lefthand),a===void 0&&(a=["D3","A4"]);var o=(0,t.tokenizeChord)(r),l=o[0],u=o[1];if(!s[u])return[];var c=s[u].map(function(f){return f.split(" ")}),d=n.Range.chromatic(a);return c.reduce(function(f,m){var y=m.map(function(M){return n.Interval.substract(M,m[0])}),_=n.Note.transpose(l,m[0]),S=d.filter(function(M){return n.Note.chroma(M)===n.Note.chroma(_)}).filter(function(M){return n.Note.midi(n.Note.transpose(M,y[y.length-1]))<=n.Note.midi(a[1])}).map(function(M){return n.Note.enharmonic(M,_)}),b=S.map(function(M){return y.map(function(w){return n.Note.transpose(M,w)})});return f.concat(b)},[])}return UC.voicingsInRange=i,UC}var mJ;function H_e(){return mJ||(mJ=1,(function(n){var e=pN.__assign||function(){return e=Object.assign||function(o){for(var l,u=1,c=arguments.length;u<c;u++){l=arguments[u];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(o[d]=l[d])}return o},e.apply(this,arguments)},t=pN.__rest||function(o,l){var u={};for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&l.indexOf(c)<0&&(u[c]=o[c]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,c=Object.getOwnPropertySymbols(o);d<c.length;d++)l.indexOf(c[d])<0&&Object.prototype.propertyIsEnumerable.call(o,c[d])&&(u[c[d]]=o[c[d]]);return u};n.__esModule=!0,n.dictionaryVoicing=n.dictionaryVoicingFinder=n.triads=n.guidetones=n.lefthand=void 0;var i=k_e(),r=Kct();n.lefthand={m7:["3m 5P 7m 9M","7m 9M 10m 12P"],7:["3M 6M 7m 9M","7m 9M 10M 13M"],"^7":["3M 5P 7M 9M","7M 9M 10M 12P"],69:["3M 5P 6A 9M"],m7b5:["3m 5d 7m 8P","7m 8P 10m 12d"],"7b9":["3M 6m 7m 9m","7m 9m 10M 13m"],"7b13":["3M 6m 7m 9m","7m 9m 10M 13m"],o7:["1P 3m 5d 6M","5d 6M 8P 10m"],"7#11":["7m 9M 11A 13A"],"7#9":["3M 7m 9A"],mM7:["3m 5P 7M 9M","7M 9M 10m 12P"],m6:["3m 5P 6M 9M","6M 9M 10m 12P"]},n.guidetones={m7:["3m 7m","7m 10m"],m9:["3m 7m","7m 10m"],7:["3M 7m","7m 10M"],"^7":["3M 7M","7M 10M"],"^9":["3M 7M","7M 10M"],69:["3M 6M"],6:["3M 6M","6M 10M"],m7b5:["3m 7m","7m 10m"],"7b9":["3M 7m","7m 10M"],"7b13":["3M 7m","7m 10M"],o7:["3m 6M","6M 10m"],"7#11":["3M 7m","7m 10M"],"7#9":["3M 7m","7m 10M"],mM7:["3m 7M","7M 10m"],m6:["3m 6M","6M 10m"]},n.triads={M:["1P 3M 5P","3M 5P 8P","5P 8P 10M"],m:["1P 3m 5P","3m 5P 8P","5P 8P 10m"],o:["1P 3m 5d","3m 5d 8P","5d 8P 10m"],aug:["1P 3m 5A","3m 5A 8P","5A 8P 10m"]};var s=function(o){return function(l,u){return(0,r.voicingsInRange)(l,o,u)}};n.dictionaryVoicingFinder=s;var a=function(o){var l=o.dictionary,u=o.range,c=t(o,["dictionary","range"]);return(0,i.getBestVoicing)(e(e({},c),{range:u,finder:(0,n.dictionaryVoicingFinder)(l)}))};n.dictionaryVoicing=a})(pN)),pN}var zC={},gJ;function $ct(){if(gJ)return zC;gJ=1,zC.__esModule=!0,zC.minTopNoteDiff=void 0;var n=z_e;function e(t,i){if(!i)return t[0];var r=function(s){return Math.abs(n.Note.midi(i[i.length-1])-n.Note.midi(s[s.length-1]))};return t.reduce(function(s,a){return r(a)<r(s)?a:s},t[0])}return zC.minTopNoteDiff=e,zC}var yJ;function Jct(){return yJ||(yJ=1,(function(n){n.__esModule=!0;var e=H_e(),t=$ct(),i=k_e(),r=V_e();n.default={tokenizeChord:r.tokenizeChord,getBestVoicing:i.getBestVoicing,dictionaryVoicing:e.dictionaryVoicing,dictionaryVoicingFinder:e.dictionaryVoicingFinder,lefthand:e.lefthand,guidetones:e.guidetones,triads:e.triads,minTopNoteDiff:t.minTopNoteDiff}})(hJ)),hJ}var qct=Jct();const vJ=wbe(qct),Nx={2:["1P 5P 8P 9M","1P 5P 8P 9M 12P","5P 8P 9M 12P"],5:["1P 5P 8P 12P","5P 8P 12P 15P"],6:["1P 5P 6M 8P 10M","1P 5P 8P 10M 13M","3M 5P 8P 10M 13M","5P 8P 10M 12P 13M"],7:["1P 5P 7m 8P 10M","1P 7m 8P 10M 12P","3M 7m 8P 10M 12P","3M 7m 8P 10M 14m","3M 7m 10M 12P 15P","7m 10M 12P 14m 15P","7m 10M 12P 15P 17M"],9:["1P 5P 7m 9M 10M","1P 7m 9M 10M 12P","3M 7m 8P 9M 12P","7m 9M 10M 14m 15P","3M 7m 8P 12P 16M","7m 10M 12P 15P 16M"],11:["1P 5P 7m 9M 11P","5P 7m 8P 9M 11P","7m 8P 9M 11P 12P","7m 8P 11P 12P 16M"],13:["1P 6M 7m 9M 10M","1P 7m 9M 10M 13M","3M 7m 8P 9M 13M","7m 8P 9M 10M 13M","7m 9M 10M 13M 15P"],69:["1P 5P 6M 9M 10M","1P 5P 9M 10M 13M","3M 5P 8P 9M 13M","5P 8P 9M 10M 13M"],add9:["1P 5P 8P 9M 10M","1P 5P 9M 10M 12P","3M 8P 9M 10M 12P","3M 8P 9M 12P 15P","5P 8P 9M 12P 17M"],"+":["1P 3M 6m 8P 10M","1P 6m 8P 10M 13m","3M 6m 8P 10M 13m","3M 8P 10M 13m 15P","6m 8P 10M 13m 15P","6m 10M 13m 15P 17M"],o:["1P 5d 8P 10m 12d","3m 8P 10m 12d 15P","5d 8P 10m 12d 15P"],h:["3m 5d 7m 8P 10m","1P 5d 7m 10m 12d","3m 7m 8P 10m 12d","3m 7m 8P 12d 14m","5d 7m 8P 10m 14m","5d 8P 10m 12d 14m","7m 10m 12d 14m 15P","5d 8P 10m 14m 17m"],sus:["1P 4P 5P 8P","1P 4P 5P 8P 11P","5P 8P 11P 12P","5P 8P 11P 12P 15P"],"^":["1P 5P 8P 10M","1P 5P 8P 10M 12P","3M 5P 8P 10M 12P","3M 8P 10M 12P 15P","5P 8P 10M 12P 15P"],"-":["1P 3m 5P 8P 10m","1P 5P 8P 10m 12P","3m 5P 8P 10m 12P","5P 8P 10m 12P 15P"],"^7":["1P 5P 7M 10M 12P","1P 10M 12P 14M","3M 8P 10M 12P 14M","5P 8P 10M 12P 14M","5P 8P 10M 14M 17M"],"-7":["1P 3m 5P 7m 10m","1P 5P 7m 10m 12P","3m 7m 8P 10m 12P","3m 7m 8P 10m 14m","5P 7m 8P 10m 14m","7m 10m 12P 14m 15P","5P 8P 10m 14m 17m","7m 10m 12P 15P 17m"],"7sus":["1P 5P 7m 8P 11P","5P 8P 11P 12P 14m","7m 8P 11P 12P 14m","7m 11P 12P 14m 18P"],h7:["3m 5d 7m 8P 10m","1P 5d 7m 10m 12d","1P 7m 10m 12d","3m 7m 8P 10m 12d","3m 7m 8P 12d 14m","5d 7m 8P 10m 14m","5d 8P 10m 12d 14m","7m 10m 12d 14m 15P","5d 8P 10m 14m 17m"],o7:["1P 6M 8P 10m 12d","1P 6M 10m 12d 13M","3m 8P 10m 12d 13M","3m 8P 12d 13M 15P","5d 10m 12d 13M 15P","5d 10m 13M 15P 17m","6M 12d 13M 15P 17m","6M 12d 15P 17m 19d"],"^9":["1P 5P 7M 9M 10M","1P 7M 9M 10M 12P","3M 7M 8P 9M 12P","3M 7M 8P 12P 16M","5P 8P 10M 14M 16M","7M 8P 10M 12P 16M"],"^13":["1P 6M 7M 9M 10M","1P 7M 9M 10M 13M","3M 7M 8P 9M 13M","3M 7M 8P 13M 16M","7M 8P 10M 13M 16M"],"^7#11":["1P 5P 7M 10M 12d","3M 7M 8P 10M 12d","1P 7M 10M 12d 14M","3M 7M 8P 12d 14M","5P 8P 10M 12d 14M"],"^9#11":["1P 3M 5d 7M 9M","1P 7M 9M 10M 12d","3M 7M 8P 9M 12d","3M 8P 9M 12d 14M"],"^7#5":["1P 6m 7M 10M 13m","3M 7M 8P 10M 13m","6m 7M 8P 10M 13m"],"-6":["1P 3m 5P 6M 8P","1P 5P 6M 8P 10m","3m 5P 6M 8P 10m","1P 5P 8P 10m 13M","3m 5P 8P 10m 13M","5P 8P 10m 12P 13M","5P 8P 10m 13M 15P"],"-69":["1P 3m 5P 6M 9M","3m 5P 6M 8P 9M","3m 6M 9M 10m 12P","1P 5P 9M 10m 13M","3m 5P 8P 9M 13M","5P 8P 9M 10m 13M","5P 8P 10m 13M 16M"],"-^7":["1P 3m 5P 7M 10m","1P 5P 7M 10m 12P","3m 7M 8P 10m 12P","5P 7M 8P 10m 14M","5P 8P 10m 14M 17m"],"-^9":["1P 3m 5P 7M 9M","1P 7M 9M 10m 12P","3m 7M 8P 9M 12P","5P 8P 9M 10m 14M"],"-9":["1P 3m 5P 7m 9M","3m 5P 7m 8P 9M","3m 7m 8P 9M 12P","5P 8P 9M 10m 14m","3m 7m 9M 12P 15P","7m 10m 12P 15P 16M"],"-add9":["1P 2M 3m 5P 8P","1P 3m 5P 9M","3m 5P 8P 9M 12P","5P 8P 9M 10m 12P"],"-11":["1P 3m 7m 9M 11P","3m 7m 8P 9M 11P","1P 4P 7m 10m 12P","5P 8P 11P 14m","3m 7m 9M 11P 15P","5P 8P 11P 14m 16M","7m 10m 12P 15P 18P"],"-7b5":["3m 5d 7m 8P 10m","1P 7m 10m 12d","1P 5d 7m 10m 12d","3m 7m 8P 10m 12d","3m 7m 8P 12d 14m","5d 7m 8P 10m 14m","5d 8P 10m 12d 14m","7m 10m 12d 14m 15P","5d 8P 10m 14m 17m"],h9:["1P 7m 9M 10m 12d","3m 7m 8P 9M 12d","5d 8P 9M 10m 14m","7m 10m 12d 15P 16M"],"-b6":["1P 5P 6m 8P 10m","1P 5P 8P 10m 13m","3m 5P 8P 10m 13m","5P 8P 10m 13m","5P 8P 10m 13m 15P"],"-#5":["1P 6m 8P 10m 13m","3m 6m 8P 10m 13m","6m 8P 10m 13m 15P"],"7b9":["1P 3M 7m 9m 10M","3M 7m 8P 9m 10M","3M 7m 8P 9m 14m","7m 9m 10M 14m 15P"],"7#9":["1P 3M 7m 10m","3M 7m 8P 10m 14m","7m 10m 10M 14m 15P"],"7#11":["1P 3M 7m 10M 12d","3M 7m 8P 10M 12d","7m 10M 12d 14m 15P"],"7b5":["1P 3M 7m 10M 12d","3M 7m 8P 10M 12d","7m 10M 12d 14m 15P"],"7#5":["1P 3M 7m 10M 13m","3M 7m 8P 10M 13m","3M 7m 8P 13m 14m","7m 10M 13m 14m 15P"],"9#11":["1P 7m 9M 10M 12d","3M 7m 8P 9M 12d","7m 10M 12d 15P 16M"],"9b5":["1P 7m 9M 10M 12d","3M 7m 8P 9M 12d","7m 10M 12d 15P 16M"],"9#5":["1P 7m 9M 10M 13m","3M 7m 9M 10M 13m","3M 7m 9M 13m 14m","7m 10M 13m 14m 16M","7m 10M 13m 16M 17M"],"7b13":["1P 3M 7m 10M 13m","3M 7m 8P 10M 13m","3M 7m 8P 13m 14m","7m 10M 13m 14m 15P"],"7#9#5":["1P 3M 7m 10m 13m","3M 7m 10m 13m 15P","7m 10M 13m 15P 17m"],"7#9b5":["1P 3M 7m 10m 12d","3M 7m 10m 12d 15P","7m 10M 12d 15P 17m"],"7#9#11":["1P 3M 7m 10m 12d","3M 7m 10m 12d 15P","7m 10M 12d 15P 17m"],"7b9#11":["1P 7m 9m 10M 12d","3M 7m 8P 9m 12d","7m 8P 10M 12d 16m"],"7b9b5":["1P 7m 9m 10M 12d","3M 7m 8P 9m 12d","7m 8P 10M 12d 16m"],"7b9#5":["1P 7m 9m 10M 13m","3M 7m 8P 9m 13m","7m 9m 10M 13m 15P"],"7b9#9":["1P 3M 7m 9m 10m","3M 7m 8P 9m 10m","7m 8P 10M 16m 17m"],"7b9b13":["1P 7m 9m 10M 13m","3M 7m 8P 9m 13m","7m 9m 10M 13m 15P"],"7alt":["3M 7m 8P 9m 12d","1P 7m 10m 10M 13m","3M 7m 8P 10m 13m","3M 7m 9m 12d 15P","3M 7m 10m 13m 15P","7m 10M 12d 15P 17m","7m 10M 13m 15P 17m"],"13#11":["1P 6M 7m 10M 12d","3M 7m 9M 12d 13M","7m 10M 12d 13M 16M"],"13b9":["1P 3M 6M 7m 9m","1P 6M 7m 9m 10M","3M 7m 9m 10M 13M","3M 7m 10M 13M 16m","7m 10M 13M 16m 17M"],"13#9":["1P 3M 6M 7m 10m","3M 7m 8P 10m 13M","7m 10M 13M 14m 17m"],"7b9sus":["1P 5P 7m 9m 11P","5P 7m 8P 9m 11P","7m 8P 11P 14m 16m"],"7susadd3":["1P 4P 5P 7m 10M","5P 8P 10M 11P 14m","7m 11P 12P 15P 17M"],"9sus":["1P 5P 7m 9M 11P","5P 7m 8P 9M 11P","7m 8P 9M 11P 12P","7m 8P 11P 12P 16M"],"13sus":["1P 4P 6M 7m 9M","1P 7m 9M 11P 13M","5P 7m 9M 11P 13M","7m 9M 11P 13M 15P"],"7b13sus":["1P 5P 7m 11P 13m","5P 7m 8P 11P 13m","7m 11P 13m 14m 15P"]},cM={2:["1P 5P 6M 8P 9M","1P 5P 8P 9M 12P","5P 8P 9M 12P 13M","5P 8P 9M 12P 15P"],5:["1P 5P 8P 12P","1P 5P 8P 9M 12P","5P 8P 12P 15P","5P 8P 12P 15P 16M"],6:["1P 5P 6M 9M 10M","1P 5P 9M 10M 13M","3M 5P 9M 10M 13M","5P 8P 9M 10M 13M","3M 6M 9M 12P 15P"],7:["1P 5P 7m 8P 10M","1P 7m 8P 10M 12P","3M 7m 8P 10M 12P","3M 7m 8P 10M 14m","3M 7m 10M 12P 15P","7m 10M 12P 14m 15P","7m 10M 12P 15P 17M","7m 10M 14m 17M 19P"],9:["1P 6M 7m 9M 10M","3M 7m 9M 10M 12P","1P 7m 9M 10M 13M","3M 7m 9M 10M 13M","3M 7m 9M 12P 15P","7m 10M 12P 13M 16M","7m 10M 13M 16M 17M","7m 10M 13M 16M 19P"],11:["1P 4P 6M 7m 9M","1P 5P 7m 9M 11P","4P 6M 7m 9M 11P","5P 8P 9M 11P 14m","7m 9M 11P 13M 15P","7m 11P 12P 14m 18P"],13:["3M 7m 9M 10M 13M","3M 7m 9M 13M 15P","3M 7m 10M 13M 16M","7m 10M 12P 13M 16M","7m 10M 13M 16M 17M","7m 10M 13M 16M 19P"],69:["1P 5P 6M 9M 10M","1P 5P 9M 10M 13M","3M 5P 9M 10M 13M","5P 8P 9M 10M 13M","3M 6M 9M 12P 15P"],add9:["1P 5P 8P 9M 10M","1P 5P 9M 10M 12P","3M 8P 9M 10M 12P","3M 8P 9M 12P 15P","5P 8P 9M 10M 15P","5P 8P 9M 12P 17M"],"+":["1P 6m 8P 9M 10M","1P 6m 8P 10M 13m","3M 8P 9M 10M 13m","3M 8P 10M 13m 15P","6m 10M 13m 15P 16M","6m 10M 13m 15P 17M"],o:["1P 6M 8P 10m 12d","1P 6M 10m 12d 13M","3m 8P 10m 12d 13M","3m 8P 12d 13M 15P","5d 10m 12d 13M 15P","5d 10m 13M 15P 17m","6M 12d 13M 15P 17m","6M 12d 15P 17m 19d"],h:["1P 5d 7m 10m 11P","3m 5d 7m 8P 11P","5d 7m 8P 10m 11P","1P 7m 10m 12d","3m 7m 8P 12d 14m","5d 8P 10m 11P 14m","7m 10m 11P 12d 14m","7m 10m 12d 14m 15P","5d 8P 10m 14m 17m"],sus:["1P 4P 5P 8P 9M","1P 4P 5P 8P 11P","1P 5P 8P 9M 11P","5P 8P 9M 11P 12P","5P 8P 11P 12P 13M","5P 8P 11P 13M 15P"],"^":["1P 3M 5P 6M 9M","1P 5P 8P 10M 12P","3M 5P 9M 10M 12P","1P 5P 8P 10M 13M","3M 8P 10M 13M 15P","5P 9M 10M 12P 15P"],"-":["1P 3m 5P 8P 10m","1P 3m 5P 9M 11P","3m 5P 8P 9M 11P","5P 8P 9M 10m 11P","1P 5P 9M 10m 12P","3m 5P 8P 10m 12P","5P 8P 10m 12P 15P"],"^7":["1P 6M 7M 9M 10M","3M 7M 9M 10M 12P","1P 7M 9M 10M 13M","3M 7M 9M 10M 13M","3M 7M 9M 12P 13M","3M 7M 9M 13M 14M","3M 7M 10M 13M 16M","7M 10M 13M 14M 16M","7M 10M 13M 16M 17M","7M 10M 13M 16M 19P"],"-7":["1P 3m 5P 7m 9M","1P 3m 5P 7m 10m","1P 5P 7m 10m 11P","3m 7m 8P 10m 11P","1P 5P 7m 10m 12P","3m 7m 9M 10m 12P","3m 7m 8P 10m 14m","5P 7m 9M 10m 14m","7m 10m 11P 14m 15P","7m 10m 12P 15P 16M","5P 8P 11P 14m 17m","7m 10m 12P 15P 17m"],"7sus":["1P 4P 6M 7m 9M","1P 5P 7m 9M 11P","4P 6M 7m 9M 11P","5P 8P 9M 11P 14m","7m 9M 11P 13M 15P","7m 11P 12P 14m 18P"],h7:["1P 5d 7m 10m 11P","3m 5d 7m 8P 11P","5d 7m 8P 10m 11P","1P 7m 10m 12d","3m 7m 8P 10m 12d","3m 7m 8P 12d 14m","5d 8P 10m 11P 14m","7m 10m 11P 12d 14m","7m 10m 12d 14m 15P","5d 8P 10m 14m 17m"],o7:["1P 6M 8P 10m 12d","1P 6M 10m 12d 13M","3m 8P 10m 12d 13M","3m 8P 12d 13M 15P","5d 10m 12d 13M 15P","5d 10m 13M 15P 17m","6M 12d 13M 15P 17m","6M 12d 15P 17m 19d"],"^9":["1P 6M 7M 9M 10M","1P 7M 9M 10M 13M","3M 7M 9M 10M 13M","3M 7M 9M 12P 13M","3M 7M 8P 9M 13M","3M 7M 9M 13M 14M","3M 7M 10M 13M 16M","7M 10M 13M 14M 16M","7M 10M 13M 16M 17M","7M 10M 13M 16M 19P"],"^13":["1P 6M 7M 9M 10M","1P 7M 9M 10M 13M","3M 7M 9M 12P 13M","3M 7M 9M 10M 13M","3M 7M 8P 9M 13M","3M 7M 9M 13M 14M","3M 7M 10M 13M 16M","7M 10M 13M 14M 16M","7M 10M 13M 16M 17M","7M 10M 13M 16M 19P"],"^7#11":["1P 3M 5d 7M 9M","1P 7M 9M 10M 12d","3M 7M 9M 10M 12d","3M 7M 9M 12d 13M","3M 7M 10M 12d 14M","7M 10M 12d 13M 14M","7M 10M 12d 13M 16M","7M 10M 12d 14M 17M"],"^9#11":["1P 3M 5d 7M 9M","1P 7M 9M 10M 12d","3M 7M 9M 10M 12d","3M 7M 9M 12d 13M","3M 7M 9M 12d 14M","7M 10M 12d 14M 16M","7M 10M 12d 13M 16M"],"^7#5":["1P 6m 7M 10M 13m","3M 7M 9M 10M 13m","3M 7M 10M 13m 14M","7M 10M 13m 14M 16M","7M 10M 13m 14M 17M"],"-6":["1P 3m 5P 6M 9M","3m 5P 6M 8P 9M","1P 5P 6M 10m 11P","3m 5P 6M 8P 11P","1P 5P 9M 10m 13M","3m 5P 8P 9M 13M","5P 8P 10m 11P 13M","5P 8P 10m 13M 16M"],"-69":["1P 3m 5P 6M 9M","3m 5P 6M 8P 9M","3m 6M 9M 10m 12P","1P 5P 9M 10m 13M","3m 5P 8P 9M 13M","5P 8P 9M 10m 13M","5P 8P 10m 13M 16M"],"-^7":["1P 3m 5P 7M 9M","1P 5P 7M 10m 11P","3m 7M 9M 10m 11P","3m 7M 9M 10m 12P","3m 7M 9M 12P 14M","7M 10m 11P 12P 14M","7M 10m 12P 14M 16M"],"-^9":["1P 3m 5P 7M 9M","1P 5P 7M 10m 11P","3m 7M 9M 10m 11P","3m 7M 9M 10m 12P","3m 7M 9M 12P 14M","7M 10m 11P 12P 14M","7M 10m 12P 14M 16M"],"-9":["1P 3m 5P 7m 9M","1P 3m 7m 9M 11P","3m 7m 9M 10m 11P","3m 7m 9M 10m 12P","3m 7m 9M 10m 14m","3m 7m 9M 12P 15P","7m 10m 11P 14m 16M","7m 10m 12P 16M 18P"],"-add9":["1P 2M 3m 5P 8P","1P 3m 5P 9M","3m 5P 8P 9M 12P","5P 8P 9M 10m 12P"],"-11":["3m 5P 7m 9M 11P","7m 9M 10m 11P","1P 4P 7m 10m 12P","3m 7m 9M 11P 12P","7m 9M 10m 11P 12P","3m 7m 9M 11P 14m","4P 10m 12P 14m","5P 8P 11P 14m","5P 8P 11P 14m 16M","7m 10m 12P 16M 18P","7m 10m 11P 16M 21m"],"-7b5":["1P 5d 7m 10m 11P","3m 5d 7m 8P 11P","5d 7m 8P 10m 11P","1P 7m 10m 12d","3m 7m 8P 10m 12d","3m 7m 8P 12d 14m","5d 8P 10m 11P 14m","7m 10m 11P 12d 14m","7m 10m 12d 14m 15P","5d 8P 10m 14m 17m"],h9:["3m 5d 7m 9M 11P","1P 7m 9M 10m 12d","3m 7m 9M 12d 14m","5d 8P 9M 10m 14m","7m 10m 11P 12d 14m","7m 10m 12d 14m 16M"],"-b6":["1P 3m 5P 6m 8P","3m 5P 8P 11P 13m","5P 8P 10m 11P 13m"],"-#5":["1P 6m 8P 10m 13m","3m 6m 8P 11P 13m","6m 8P 10m 13m 15P"],"7b9":["1P 3M 7m 9m 10M","3M 7m 8P 9m 10M","3M 7m 8P 9m 14m","7m 9m 10M 14m 15P"],"7#9":["1P 3M 7m 10m","3M 7m 10m 10M 12P","3M 7m 10m 12P 14m","7m 10M 12P 14m 17m"],"7#11":["1P 3M 7m 9M 12d","3M 7m 9M 12d 13M","7m 10M 12d 13M 16M"],"7b5":["1P 3M 7m 9M 12d","3M 7m 9M 12d 13M","7m 10M 12d 13M 16M"],"7#5":["1P 3M 7m 10M 13m","3M 7m 8P 10M 13m","3M 7m 8P 13m 14m","7m 10M 13m 14m 15P","7m 10M 13m 14m 17M"],"9#11":["1P 7m 9M 10M 12d","3M 7m 8P 9M 12d","7m 10M 12d 15P 16M"],"9b5":["1P 7m 9M 10M 12d","3M 7m 8P 9M 12d","7m 10M 12d 15P 16M"],"9#5":["1P 7m 9M 10M 13m","3M 7m 9M 10M 13m","3M 7m 9M 13m 14m","7m 10M 13m 14m 16M","7m 10M 13m 16M 17M"],"7b13":["1P 3M 7m 10M 13m","3M 7m 8P 10M 13m","3M 7m 8P 13m 14m","7m 10M 13m 14m 15P","7m 10M 13m 14m 17M"],"7#9#5":["3M 7m 10m 10M 13m","3M 7m 10m 13m 14m","7m 10M 13m 14m 17m"],"7#9b5":["3M 7m 10m 10M 12d","3M 7m 10m 12d 14m","7m 10M 12d 14m 17m"],"7#9#11":["3M 7m 10m 10M 12d","3M 7m 10m 12d 14m","7m 10M 12d 14m 17m"],"7b9#11":["3M 7m 9m 10M 12d","3M 7m 9m 12d 14m","7m 8P 10M 12d 16m","7m 10M 12d 14m 16m"],"7b9b5":["3M 7m 9m 10M 12d","3M 7m 9m 12d 14m","7m 8P 10M 12d 16m","7m 10M 12d 14m 16m"],"7b9#5":["1P 7m 9m 10M 13m","3M 7m 9m 10M 13m","3M 7m 10M 13m 16m","7m 10M 13m 14m 16m","7m 10M 13m 16m 17M"],"7b9#9":["1P 3M 7m 9m 10m","3M 7m 10m 13m 16m","7m 10M 13m 16m 17m"],"7b9b13":["1P 7m 9m 10M 13m","3M 7m 9m 10M 13m","3M 7m 10M 13m 16m","7m 10M 13m 14m 16m","7m 10M 13m 16m 17M"],"7alt":["3M 7m 8P 10m 13m","3M 7m 9m 12d 13m","3M 7m 9m 10m 13m","3M 7m 10m 13m 14m","3M 7m 9m 12d 14m","3M 7m 10m 13m 15P","3M 7m 10m 13m 16m","7m 10M 12d 14m 16m","7m 10M 12d 13m 16m","7m 10M 13m 15P 17m","7m 10M 13m 16m 17m","7m 10M 13m 16m 19d"],"13#11":["3M 7m 9M 12d 13M","7m 10M 12d 13M 16M"],"13b9":["3M 7m 9m 10M 13M","3M 7m 10M 13M 16m","7m 10M 13M 16m 17M"],"13#9":["3M 7m 10m 10M 13M","7m 10M 13M 14m 17m"],"7b9sus":["1P 5P 7m 9m 11P","5P 7m 8P 9m 11P","7m 8P 11P 14m 16m"],"7susadd3":["1P 4P 5P 7m 10M","5P 8P 10M 11P 14m","7m 11P 12P 15P 17M"],"9sus":["1P 4P 6M 7m 9M","1P 5P 7m 9M 11P","4P 6M 7m 9M 11P","5P 8P 9M 11P 14m","7m 9M 11P 13M 15P","7m 11P 12P 14m 18P"],"13sus":["1P 4P 6M 7m 9M","1P 7m 9M 11P 13M","4P 7m 9M 11P 13M","7m 9M 11P 13M 15P","7m 11P 13M 14m 16M","7m 11P 13M 16M 18P"],"7b13sus":["1P 5P 7m 11P 13m","5P 7m 8P 11P 13m","7m 11P 13m 14m 15P"]},{dictionaryVoicing:Qct,minTopNoteDiff:eht}=vJ.default||vJ,tht={m7:["3m 5P 7m 9M","7m 9M 10m 12P"],7:["3M 6M 7m 9M","7m 9M 10M 13M"],"^7":["3M 5P 7M 9M","7M 9M 10M 12P"],69:["3M 5P 6A 9M"],m7b5:["3m 5d 7m 8P","7m 8P 10m 12d"],"7b9":["3M 6m 7m 9m","7m 9m 10M 13m"],"7b13":["3M 6m 7m 9m","7m 9m 10M 13m"],o7:["1P 3m 5d 6M","5d 6M 8P 10m"],"7#11":["7m 9M 11A 13A"],"7#9":["3M 7m 9A"],mM7:["3m 5P 7M 9M","7M 9M 10m 12P"],m6:["3m 5P 6M 9M","6M 9M 10m 12P"]},nht={m7:["3m 7m","7m 10m"],m9:["3m 7m","7m 10m"],7:["3M 7m","7m 10M"],"^7":["3M 7M","7M 10M"],"^9":["3M 7M","7M 10M"],69:["3M 6M"],6:["3M 6M","6M 10M"],m7b5:["3m 7m","7m 10m"],"7b9":["3M 7m","7m 10M"],"7b13":["3M 7m","7m 10M"],o7:["3m 6M","6M 10m"],"7#11":["3M 7m","7m 10M"],"7#9":["3M 7m","7m 10M"],mM7:["3m 7M","7M 10m"],m6:["3m 6M","6M 10m"]},iht={"":["1P 3M 5P","3M 5P 8P","5P 8P 10M"],M:["1P 3M 5P","3M 5P 8P","5P 8P 10M"],m:["1P 3m 5P","3m 5P 8P","5P 8P 10m"],o:["1P 3m 5d","3m 5d 8P","5d 8P 10m"],aug:["1P 3m 5A","3m 5A 8P","5A 8P 10m"]},rht={"":["1P 3M 5P","3M 5P 8P","5P 8P 10M"],M:["1P 3M 5P","3M 5P 8P","5P 8P 10M"],m:["1P 3m 5P","3m 5P 8P","5P 8P 10m"],o:["1P 3m 5d","3m 5d 8P","5d 8P 10m"],aug:["1P 3m 5A","3m 5A 8P","5A 8P 10m"],m7:["3m 5P 7m 9M","7m 9M 10m 12P"],7:["3M 6M 7m 9M","7m 9M 10M 13M"],"^7":["3M 5P 7M 9M","7M 9M 10M 12P"],69:["3M 5P 6A 9M"],m7b5:["3m 5d 7m 8P","7m 8P 10m 12d"],"7b9":["3M 6m 7m 9m","7m 9m 10M 13m"],"7b13":["3M 6m 7m 9m","7m 9m 10M 13m"],o7:["1P 3m 5d 6M","5d 6M 8P 10m"],"7#11":["7m 9M 11A 13A"],"7#9":["3M 7m 9A"],mM7:["3m 5P 7M 9M","7M 9M 10m 12P"],m6:["3m 5P 6M 9M","6M 9M 10m 12P"]},RA={lefthand:{dictionary:tht,range:["F3","A4"],mode:"below",anchor:"a4"},triads:{dictionary:iht,mode:"below",anchor:"a4"},guidetones:{dictionary:nht,mode:"above",anchor:"a4"},legacy:{dictionary:rht,mode:"below",anchor:"a4"}};let X_e="ireal";const W_e=n=>X_e=n,sht=(n,e)=>Z_e(n,RA[n].dictionary,e),Z_e=(n,e,t=["F3","A4"])=>{Object.assign(RA,{[n]:{dictionary:e,range:t}})},I8=(n,e,t={})=>{Object.assign(RA,{[n]:{dictionary:e,...t}})},aht=(n,e,t)=>{const{dictionary:i,range:r}=RA[e];return Qct({chord:n,dictionary:i,range:r,picker:eht,lastVoicing:t})};let iB;const oht=Nt("voicings",function(n,e){return e.fmap(t=>(iB=aht(t,n,iB),Ma(...iB))).outerJoin()}),lht=Nt("rootNotes",function(n,e){return e.fmap(t=>{const i=(t.chord||t).match(/^([a-gA-G][b#]?).*$/)[1]+n;return t.chord?{note:i}:i})}),uht=Nt("voicing",function(n){return n.fmap(e=>{e=typeof e=="string"?{chord:e}:e;let{dictionary:t=X_e,chord:i,anchor:r,offset:s,mode:a,n:o,octaves:l,...u}=e;t=typeof t=="string"?RA[t]:{dictionary:t,mode:"below",anchor:"c5"};try{let c=Oct({...t,chord:i,anchor:r,offset:s,mode:a,n:o,octaves:l});return Ma(...c).note().set(u)}catch{return Cl(`[voicing]: unknown chord "${i}"`),ws}}).outerJoin()});function Pw(n,e,t){t=Array.isArray(t)?t:[t],t.forEach(i=>{i[e]=i[n]})}Pw("^","",[Nx,cM]);Object.keys(Nx).forEach(n=>{if(n.includes("-")){let e=n.replace("-","m");Pw(n,e,[cM,Nx])}if(n.includes("^")){let e=n.replace("^","M");Pw(n,e,[cM,Nx])}if(n.includes("+")){let e=n.replace("+","aug");Pw(n,e,[cM,Nx])}});I8("ireal",Nx);I8("ireal-ext",cM);function cht(){iB=void 0,W_e("ireal")}const hht="@strudel/tonal",dht=Object.freeze(Object.defineProperty({__proto__:null,addVoicings:Z_e,complex:cM,packageName:hht,registerVoicings:I8,resetVoicings:cht,rootNotes:lht,scale:Yct,scaleTrans:Xct,scaleTranspose:Hct,setDefaultVoicings:W_e,setVoicingRange:sht,simple:Nx,strans:Wct,trans:Vct,transpose:zct,voicing:uht,voicingAlias:Pw,voicingRegistry:RA,voicings:oht},Symbol.toStringTag,{value:"Module"}));async function fht(){const n=a2(a2,Promise.resolve().then(()=>D1e),Promise.resolve().then(()=>$rt),Promise.resolve().then(()=>dht),Promise.resolve().then(()=>Hrt),{hush:pht,evaluate:mht});await Promise.all([n,Txe()])}let Pz,Xx;function j_e(n={}){_xe(),n.miniAllStrings!==!1&&Xxe();const{prebake:e,...t}=n;return Xx=Lxe({...t,transpiler:iat}),Pz=(async()=>(await fht(),await e?.(),Xx))(),o2(()=>Xx.scheduler.now()),Pz}window.initStrudel=j_e;pn.prototype.play=function(){if(!Xx)throw new Error(".play: no repl found. Have you called initStrudel?");return Pz.then(()=>{Xx.setPattern(this,!0)}),this};function pht(){Xx.stop()}async function mht(n,e=!0){return Xx.evaluate(n,e)}function Y_e(n={}){const{audioContext:e=void 0,withSamples:t=!0}=n||{},i=G.useRef(null),r=G.useRef(null),s=G.useRef(!1),a=G.useRef(null),[o,l]=G.useState(!1),[u,c]=G.useState(!1);G.useEffect(()=>{if(e===null){console.log("[strudel] waiting for external AudioContext");return}let y=!0;async function _(){console.log("[strudel] init start");let S;e===void 0?(S=new AudioContext,s.current=!0,console.log("[strudel] created internal AudioContext")):(S=e,s.current=!1,console.log("[strudel] using external AudioContext")),r.current=S;const b=await j_e({audioContext:S,prebake:t?()=>X6("github:tidalcycles/dirt-samples"):void 0});if(!y)return;i.current=b;const M=S.createGain();M.gain.value=1,s.current&&M.connect(S.destination),b.connect?b.connect(M):b.masterGain?.connect?b.masterGain.connect(M):console.warn("[strudel] could not find strudel output to connect"),a.current=M,l(!0),console.log("[strudel] init done"),console.log("[strudel] ctx ===",S),console.log("[strudel] output ===",M)}return _(),()=>{y=!1;try{i.current?.evaluate?.("hush")}catch{console.error("[strudel] hush failed")}try{a.current?.disconnect()}catch{console.error("[strudel] disconnect failed")}if(s.current&&r.current)try{r.current.close()}catch{console.error("[strudel] ctx close failed")}i.current=null,a.current=null,r.current=null,s.current=!1,l(!1),c(!1)}},[e,t]);const d=G.useCallback(async()=>{const y=r.current;y&&y.state!=="running"&&(console.log("[strudel] unlocking audio"),await y.resume(),console.log("[strudel] audio state:",y.state))},[]),f=G.useCallback(()=>{if(i.current?.evaluate)try{i.current.evaluate("hush"),c(!1),console.log("[strudel] stop")}catch(y){console.error("[strudel] stop failed:",y)}},[]),m=G.useCallback(async y=>{if(i.current?.evaluate){await d();try{i.current.evaluate("hush"),i.current.evaluate(y),c(!0),console.log("[strudel] play")}catch(_){c(!1),console.error("[strudel] play failed:",_)}}},[d]);return{ready:o,isPlaying:u,play:m,stop:f,unlock:d,output:a.current,ctx:r.current}}const ght=`
setcps(0.7)

stack(
  sound("bd ~ bd ~").gain(1.1),
  sound("hh*8").gain(0.4),
  sound("arpy:2").slow(2).gain(0.5)
)
`,yht=`
setcps(0.9)

stack(
  sound("bd*2").gain(1.2),
  sound("cp ~").every(3, rev),
  sound("hh*16").gain(0.25),
  sound("noise").slow(4).gain(0.1)
)
`,vht=`
setcps(0.4)

stack(
  sound("arpy:1").slow(4).gain(0.5),
  sound("pad:2").slow(8).gain(0.4),
  sound("~ hh ~ hh").gain(0.15)
)
`,xht=`
setcps(0.7);

p1: n("0 2 4 6 7 6 4 2")
  .scale("<c3:major>/2")
  .s("supersaw")
  .distort(0.7)
  .superimpose((x) => x.detune("<0.5>"))
  .lpenv(perlin.slow(3).range(1, 4))
  .lpf(perlin.slow(2).range(100, 2000))
  .gain(0.3);
p2: "<a1 e2>/8".clip(0.8).struct("x*8").s("supersaw").note();
`,bht=`
setcps(0.7)

stack(
  sound("bd ~ bd ~").gain(1.1),
  sound("hh*8").gain(0.4),
  sound("arpy:2").slow(2).gain(0.5)
)
`,v2={threeD:ght,glitch:yht,ambient:vht,weirderStuff:xht,defaultPattern:bht},_ht=`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Sht=`
uniform float uTime;
uniform sampler2D uTextTexture;

uniform vec3  uScreenColor;
uniform float uNoiseStrength;
uniform float uGlowStrength;
uniform float uCurvature;
uniform float uVignette;

uniform float uScanlineStrength;
uniform float uScanlineDensity;
uniform float uRollSpeed;
uniform float uRollStrength;

uniform float uChromaOffset;

varying vec2 vUv;

float hash(vec2 p) {
  return fract(sin(dot(p, vec2(127.1,311.7))) * 43758.5453123);
}

vec2 curve(vec2 uv, float k) {
  uv = uv * 2.0 - 1.0;
  uv *= 1.0 + k * pow(abs(uv.yx), vec2(2.0));
  return uv * 0.5 + 0.5;
}

void main() {

  vec2 uv = curve(vUv, uCurvature);

  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
    gl_FragColor = vec4(0.0);
    return;
  }

  float roll = sin(uv.y * 8.0 + uTime * uRollSpeed) * 0.003 * uRollStrength;
  uv.y = fract(uv.y + roll + uTime * 0.02 * uRollStrength);

  vec3 color = uScreenColor;

  float n = hash(uv * 800.0 + uTime * 60.0);
  color += (n - 0.5) * uNoiseStrength;

  float scan = sin(uv.y * uScanlineDensity);
  color -= scan * uScanlineStrength;

  float off = uChromaOffset;
  vec4 tr = texture2D(uTextTexture, uv + vec2(off, 0.0));
  vec4 tg = texture2D(uTextTexture, uv);
  vec4 tb = texture2D(uTextTexture, uv - vec2(off, 0.0));

  vec3 textRGB = vec3(tr.r, tg.g, tb.b);
  float textA = max(tr.a, max(tg.a, tb.a));

  color = mix(color, textRGB, textA);
  color += textRGB * uGlowStrength * textA;

  float d = distance(uv, vec2(0.5));
  float vig = smoothstep(uVignette, 0.45, d);
  color *= mix(1.0, vig, 0.6);

  gl_FragColor = vec4(clamp(color, 0.0, 1.5), 1.0);
}
`,K_e=Yd({uTime:0,uTextTexture:null,uScreenColor:new en(.05,.18,.85),uNoiseStrength:.08,uGlowStrength:.35,uCurvature:.06,uVignette:.85,uScanlineStrength:.08,uScanlineDensity:900,uRollSpeed:.4,uRollStrength:.4,uChromaOffset:.0025},_ht,Sht);eo({CrtBlueScreenMaterial:K_e});function Mht(n,e,t,i,r,s){const a=e.split("");let o="";const l=[];return a.forEach(u=>{if(u===`
`)l.push(o),o="";else{const c=o+u;n.measureText(c).width>r&&o?(l.push(o),o=u):o=c}}),o&&l.push(o),l.forEach((u,c)=>{n.fillText(u,t,i+c*s)}),{lines:l,y:i+(l.length-1)*s}}function Aht({canvas:n,text:e,font:t,fontSize:i,fontColor:r,showCaret:s,caretMode:a,horizontalPadding:o,verticalPadding:l}){const u=n.getContext("2d");u.clearRect(0,0,n.width,n.height),u.font=t,u.fillStyle=r,u.textBaseline="top";const c=i*1.3,d=n.width-o*2,{lines:f,y:m}=Mht(u,e,o,l,d,c);if(s&&f.length){const y=f[f.length-1],_=u.measureText(y),S=o+_.width+4,b=_.actualBoundingBoxAscent+_.actualBoundingBoxDescent||i;a==="underscore"?u.fillRect(S,m+i*1.05,i*.8,3):a==="line"?u.fillRect(S,m+2,Math.max(4,i*.08),b):u.fillRect(S,m+2,i*.6,b)}}function Tht(){const n=document.createElement("canvas");n.width=1024,n.height=512;const e=new V9(n);return e.minFilter=Jn,e.magFilter=Jn,e.wrapS=ps,e.wrapT=ps,{canvas:n,texture:e}}const Cht={screenText:`12:00 FEB. 28, 1986\r
<< REWIND`,fontSize:28,fontName:"Press Start 2P",fontColor:"#FFFFFF",showCaret:!1,caretMode:"block",caretBlinkRate:2,horizontalPadding:48,verticalPadding:40,screenColor:"#0b2fd8",glowStrength:.35,curvature:.06,vignette:1.15,noiseStrength:.08,scanlineStrength:.08,scanlineDensity:900,rollSpeed:.4,rollStrength:0,chromaOffset:.0025},wht={screenText:`USERNAME: @ruinedpaintings
PASSWORD: ********`,fontSize:28,fontName:"Press Start 2P",fontColor:"#48ff00",showCaret:!0,caretMode:"block",caretBlinkRate:2,horizontalPadding:48,verticalPadding:40,screenColor:"#000000",glowStrength:.35,curvature:.06,vignette:1.15,noiseStrength:.08,scanlineStrength:.08,scanlineDensity:900,rollSpeed:.4,rollStrength:0,chromaOffset:.0025};function x2({screenText:n="12:00 FEB. 28, 1986",fontSize:e=28,fontName:t="Press Start 2P",fontColor:i="#FFFFFF",horizontalPadding:r=48,verticalPadding:s=40,showCaret:a=!1,caretMode:o="block",caretBlinkRate:l=2,screenColor:u="#0b2fd8",glowStrength:c=.35,curvature:d=.06,vignette:f=1.15,noiseStrength:m=.08,scanlineStrength:y=.08,scanlineDensity:_=900,rollSpeed:S=.4,rollStrength:b=0,chromaOffset:M=.0025}){const w=G.useRef(),T=G.useRef(0),E=G.useRef(!0),{canvas:R,texture:P}=G.useMemo(Tht,[]),I=`${e}px "${t}"`,B=N=>{Aht({canvas:R,text:n,font:I,fontSize:e,fontColor:i,showCaret:a&&N,caretMode:o||"block",horizontalPadding:r,verticalPadding:s}),P.needsUpdate=!0};return G.useEffect(()=>{B(!0)},[n,I,i,r,s,a,o]),rs((N,U)=>{w.current&&(w.current.uTime+=U,a&&(T.current+=U,T.current>=1/Math.max(l,.001)&&(T.current=0,E.current=!E.current,B(E.current))))}),$.jsx("crtBlueScreenMaterial",{ref:w,toneMapped:!1,uTextTexture:P,uScreenColor:u,uNoiseStrength:m,uGlowStrength:c,uCurvature:d,uVignette:f,uScanlineStrength:y,uScanlineDensity:_,uRollSpeed:S,uRollStrength:b,uChromaOffset:M},K_e.key)}const Eht=`
varying vec2 vUv;
void main(){
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
}
`,Rht=`
uniform sampler2D uScene;
uniform sampler2D uFeedback;
uniform float uTime;

uniform float uDecay;
uniform float uZoom;
uniform float uWarp;

uniform float uStaticAmount;
uniform float uScanlineStrength;
uniform float uCurvature;
uniform float uVignette;

varying vec2 vUv;

float hash(vec2 p){
  return fract(sin(dot(p,vec2(127.1,311.7))) * 43758.5453123);
}

vec2 curve(vec2 uv,float k){
  uv = uv*2.0-1.0;
  uv *= 1.0 + k * pow(abs(uv.yx),vec2(2.0));
  return uv*0.5+0.5;
}

void main(){
  vec2 uv = vUv;

  // warp feedback inward (recursion illusion)
  vec2 fUV = (uv - 0.5) / uZoom + 0.5;
  fUV += sin(vec2(uv.y, uv.x) * 6.0 + uTime*0.4) * 0.003 * uWarp;
  fUV = curve(fUV, uCurvature);

  vec3 sceneCol = texture2D(uScene, uv).rgb;
  vec3 feedbackCol = texture2D(uFeedback, fUV).rgb;

  vec3 col = mix(sceneCol, feedbackCol, uDecay);

  col -= sin(uv.y*900.0)*0.04*uScanlineStrength;
  col = mix(col, vec3(hash(uv*600.0+uTime)), uStaticAmount);

  float d = distance(uv,vec2(0.5));
  col *= 1.0-smoothstep(0.6,uVignette,d);

  gl_FragColor = vec4(col,1.0);
}
`,Pht=Yd({uScene:null,uFeedback:null,uTime:0,uDecay:.85,uZoom:1.01,uWarp:.6,uStaticAmount:.04,uScanlineStrength:.4,uCurvature:.12,uVignette:.85},Eht,Rht);eo({CrtAccumMaterial:Pht});function $_e({resolution:n=1024,decay:e=.85,zoom:t=1.01,warp:i=.6,staticAmount:r=.04,scanlineStrength:s=.4,curvature:a=.12,vignette:o=.85}){const l=G.useRef(),{gl:u,scene:c,camera:d}=ir(),f=G.useMemo(()=>new Nr(n,n),[n]),m=G.useMemo(()=>new Nr(n,n),[n]),y=G.useMemo(()=>new Nr(n,n),[n]),_=G.useRef(!1);return rs((S,b)=>{if(!l.current)return;l.current.uTime+=b;const M=u.getRenderTarget();u.setRenderTarget(f),u.clear(),u.render(c,d);const w=_.current?m:y,T=_.current?y:m;l.current.uScene=f.texture,l.current.uFeedback=w.texture,u.setRenderTarget(T),u.clear(),u.render(c,d),u.setRenderTarget(M),_.current=!_.current,l.current.uFeedback=T.texture}),$.jsx("crtAccumMaterial",{ref:l,uDecay:e,uZoom:t,uWarp:i,uStaticAmount:r,uScanlineStrength:s,uCurvature:a,uVignette:o,toneMapped:!1})}const Dht=`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Nht=`
uniform sampler2D uMap;
uniform float uTime;

uniform float uStaticAmount;
uniform float uStaticScale;
uniform float uStaticSpeed;

uniform float uScanlineStrength;
uniform float uCurvature;
uniform float uVignette;
uniform float uChromaDrift;
uniform float uBloom;

varying vec2 vUv;

float hash(vec2 p) {
  return fract(sin(dot(p, vec2(127.1,311.7))) * 43758.5453123);
}

vec2 curve(vec2 uv, float k) {
  uv = uv * 2.0 - 1.0;
  uv *= 1.0 + k * pow(abs(uv.yx), vec2(2.0));
  return uv * 0.5 + 0.5;
}

void main() {
  vec2 uv = curve(vUv, uCurvature);

  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
    gl_FragColor = vec4(0.0);
    return;
  }

  float drift = sin(uTime * 0.6 + uv.y * 4.0) * 0.002 * uChromaDrift;

  vec3 col;
  col.r = texture2D(uMap, uv + vec2(drift, 0.0)).r;
  col.g = texture2D(uMap, uv).g;
  col.b = texture2D(uMap, uv - vec2(drift, 0.0)).b;

  float t = floor(uTime * uStaticSpeed);
  float noise =
    hash(uv * uStaticScale + t) * 0.6 +
    hash(uv * uStaticScale * 1.7 - t) * 0.4;

  col = mix(col, vec3(noise), uStaticAmount);

  float scan = sin(uv.y * 900.0) * 0.04 * uScanlineStrength;
  col -= scan;

  float luma = dot(col, vec3(0.299,0.587,0.114));
  col += col * smoothstep(0.6, 1.0, luma) * uBloom;

  float d = distance(uv, vec2(0.5));
  col *= 1.0 - smoothstep(0.6, uVignette, d);

  gl_FragColor = vec4(col, 1.0);
}
`,Bht=Yd({uMap:null,uTime:0,uStaticAmount:.1,uStaticScale:600,uStaticSpeed:6,uScanlineStrength:.4,uCurvature:.12,uVignette:.85,uChromaDrift:.25,uBloom:.25},Dht,Nht);eo({CrtSceneShaderMaterial:Bht});function J_e({scene:n,resolution:e=1024,staticAmount:t=.12,staticScale:i=600,staticSpeed:r=6,scanlineStrength:s=.4,curvature:a=.12,vignette:o=.85,chromaDrift:l=.25,bloom:u=.25}){const c=G.useRef();return rs((d,f)=>{c.current&&(c.current.uTime+=f)}),$.jsx("crtSceneShaderMaterial",{ref:c,uStaticAmount:t,uStaticScale:i,uStaticSpeed:r,uScanlineStrength:s,uCurvature:a,uVignette:o,uChromaDrift:l,uBloom:u,toneMapped:!1,children:$.jsx(lZe,{attach:"uMap",frames:1/0,width:e,height:e,anisotropy:8,children:n})})}const Fht=`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Lht=`
uniform float uTime;
uniform sampler2D uTexture;

uniform float uStaticAmount;
uniform float uStaticScale;
uniform float uStaticSpeed;
uniform float uSnap;

uniform float uGlitchRate;
uniform float uScanlineStrength;
uniform float uColorBleed;

uniform float uCurvature;
uniform float uVignette;
uniform float uMaskStrength;

uniform float uFlyback;
uniform float uConverge;
uniform float uBloom;
uniform float uBreath;

uniform float uRetrace;
uniform float uBeamWidth;
uniform float uChromaDrift;
uniform float uHum;

uniform float uThermalDrift;
uniform float uSpotNoise;
uniform float uMaskMode;
uniform float uBarrelConverge;

uniform float uPadX;
uniform float uPadY;

varying vec2 vUv;

/* ----------------- Utils ----------------- */

float hash(vec2 p) {
  return fract(sin(dot(p, vec2(127.1,311.7))) * 43758.5453123);
}

vec2 curve(vec2 uv, float k) {
  uv = uv * 2.0 - 1.0;
  uv *= 1.0 + k * pow(abs(uv.yx), vec2(2.0));
  return uv * 0.5 + 0.5;
}

/* ----------------- Main ----------------- */

void main() {

  vec2 uv = vUv;

  uv = (uv - 0.5) * vec2(1.0 - uPadX, 1.0 - uPadY) + 0.5;

  float t = floor(uTime * uStaticSpeed * uSnap) / uSnap;

  float staticField =
    hash(uv * uStaticScale + vec2(t, -t)) * 0.6 +
    hash(uv * uStaticScale * 1.7 + vec2(-t * 2.0, t)) * 0.4;

  float thermalTime = uTime * 0.02;
  vec2 thermalWarp = vec2(
    sin(thermalTime * 0.7 + uv.y * 2.0),
    cos(thermalTime * 0.5 + uv.x * 2.0)
  ) * 0.004 * uThermalDrift;

  uv += thermalWarp;

  float breathe = sin(uTime * 0.35) * 0.003 * uBreath;
  uv += vec2(sin(uv.y * 3.0 + uTime * 0.4), cos(uv.x * 2.0 + uTime * 0.3)) * breathe;

  uv.x += sin(uTime * 0.12 + uv.y * 3.0) * 0.002 * uChromaDrift;
  uv.y += sin(uTime * 40.0 + uv.y * 800.0) * 0.0015 * uFlyback;
  uv.y += sin(uTime * 3.0) * 0.002 * uFlyback;

  uv = curve(uv, uCurvature);

  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
    gl_FragColor = vec4(0.0);
    return;
  }

  vec2 centered = uv * 2.0 - 1.0;
  float barrel = dot(centered, centered);

  float drift =
    sin(uTime * 0.6) *
    0.002 *
    uConverge *
    mix(0.3, 1.5, barrel * uBarrelConverge);

  vec2 rUV = uv + vec2(drift, 0.0);
  vec2 bUV = uv - vec2(drift, 0.0);

  vec3 col = texture2D(uTexture, uv).rgb;
  vec3 rCol = texture2D(uTexture, rUV).rgb;
  vec3 bCol = texture2D(uTexture, bUV).rgb;

  col.r = rCol.r;
  col.b = bCol.b;

  col.r += hash(uv + uTime) * uColorBleed;
  col.b -= hash(uv - uTime) * uColorBleed;

  float luma = dot(col, vec3(0.299,0.587,0.114));
  float beam = mix(900.0, 700.0, smoothstep(0.4,1.0,luma) * uBeamWidth);
  beam += staticField * 120.0 * uSpotNoise;

  float scan = sin(uv.y * beam) * 0.05 * uScanlineStrength;
  col -= scan;

  vec3 triad = vec3(
    sin(uv.x * 900.0),
    sin(uv.x * 900.0 + 2.1),
    sin(uv.x * 900.0 + 4.2)
  ) * 0.5 + 0.5;

  float grille = sin(uv.x * 1400.0) * 0.5 + 0.5;
  vec3 aperture = vec3(grille);

  vec3 mask = mix(triad, aperture, step(0.5, uMaskMode));
  col *= mix(vec3(1.0), mask, uMaskStrength);

  col += col * smoothstep(0.65, 1.0, luma) * uBloom;

  float retrace = smoothstep(0.0, 0.04, abs(fract(uTime * 0.8) - uv.y));
  col *= mix(1.0, 0.55, retrace * uRetrace);

  float hum = sin((uv.y + uTime * 0.15) * 6.2831) * 0.04 * uHum;
  col -= hum;

  float d = distance(uv, vec2(0.5));
  float vig = 1.0 - smoothstep(0.75, uVignette, d);
  col *= vig;

  vec3 staticColor = vec3(staticField);
  float glitch = step(1.0 - uGlitchRate, hash(vec2(floor(uTime * 10.0), 0.0)));
  vec3 finalColor = mix(col, staticColor, glitch * uStaticAmount);

  gl_FragColor = vec4(finalColor, 1.0);
}
`,q_e=Yd({uTime:0,uTexture:null,uStaticAmount:0,uStaticScale:0,uStaticSpeed:0,uSnap:0,uGlitchRate:0,uScanlineStrength:0,uColorBleed:0,uCurvature:0,uVignette:0,uMaskStrength:0,uFlyback:0,uConverge:0,uBloom:0,uBreath:0,uRetrace:0,uBeamWidth:0,uChromaDrift:0,uHum:0,uThermalDrift:0,uSpotNoise:0,uMaskMode:0,uBarrelConverge:0,uPadX:0,uPadY:0},Fht,Lht);eo({CrtShowMaterial:q_e});function b2({src:n=iNe("ren_and_stimpy.mp4"),useWebcam:e=!1,padX:t=.06,padY:i=.08,staticAmount:r=.35,staticScale:s=700,staticSpeed:a=9,snap:o=24,glitchRate:l=.18,scanlineStrength:u=.55,colorBleed:c=.14,curvature:d=.12,vignette:f=.75,maskStrength:m=.35,flybackStrength:y=.35,convergenceDrift:_=.4,bloomStrength:S=.25,breathStrength:b=.35,retraceStrength:M=.35,beamWidth:w=.5,chromaDrift:T=.3,humStrength:E=.25,barrelConvergence:R=.6,spotNoise:P=.35,thermalDrift:I=.15,maskMode:B=0}){const N=G.useRef();return G.useEffect(()=>{if(!N.current)return;let U=null,V=!1;const W=document.createElement("video");W.crossOrigin="anonymous",W.loop=!0,W.muted=!0,W.playsInline=!0,W.autoplay=!0;const K=()=>{if(V)return;const te=new nF(W);te.colorSpace=Ps,te.minFilter=Jn,te.magFilter=Jn,te.generateMipmaps=!1,N.current.uTexture=te},q=async()=>{try{W.src=n,await W.play(),K()}catch(te){console.error("[CRTShowMaterial] Video failed to play:",te)}};return e?(async()=>{try{const te=navigator,he=te.mediaDevices?.getUserMedia||te.getUserMedia||te.webkitGetUserMedia||te.mozGetUserMedia;if(!he)throw new Error("getUserMedia not supported on this device");te.mediaDevices?.getUserMedia?U=await te.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1}):U=await new Promise((_e,Be)=>{he.call(te,{video:!0,audio:!1},_e,Be)}),W.srcObject=U,await W.play(),K()}catch(te){console.warn("[CRTShowMaterial] Webcam failed, falling back to video:",te),q()}})():q(),()=>{V=!0,U&&U.getTracks().forEach(te=>te.stop()),N.current?.uTexture&&N.current.uTexture.dispose(),W.pause(),W.remove()}},[n,e]),rs((U,V)=>{N.current&&(N.current.uTime+=V)}),$.jsx("crtShowMaterial",{ref:N,toneMapped:!1,uPadX:t,uPadY:i,uStaticAmount:r,uStaticScale:s,uStaticSpeed:a,uSnap:o,uGlitchRate:l,uScanlineStrength:u,uColorBleed:c,uCurvature:d,uVignette:f,uMaskStrength:m,uFlyback:y,uConverge:_,uBloom:S,uBreath:b,uRetrace:M,uBeamWidth:w,uChromaDrift:T,uHum:E,uThermalDrift:I,uSpotNoise:P,uMaskMode:B,uBarrelConverge:R},q_e.key)}const Iht=`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Ght=`
uniform float uTime;

uniform float uStaticAmount;
uniform float uStaticScale;
uniform float uStaticSpeed;
uniform float uSnap;

uniform float uGlitchRate;
uniform float uScanlineStrength;
uniform float uColorBleed;

uniform float uCurvature;
uniform float uVignette;
uniform float uMaskStrength;

uniform float uFlyback;
uniform float uConverge;
uniform float uBloom;
uniform float uBreath;

/* --- next tier --- */
uniform float uRetrace;
uniform float uBeamWidth;
uniform float uChromaDrift;
uniform float uHum;

uniform float uThermalDrift;
uniform float uSpotNoise;
uniform float uMaskMode;
uniform float uBarrelConverge;

varying vec2 vUv;

/* ----------------- Utils ----------------- */

float hash(vec2 p) {
  return fract(sin(dot(p, vec2(127.1,311.7))) * 43758.5453123);
}

vec2 curve(vec2 uv, float k) {
  uv = uv * 2.0 - 1.0;
  uv *= 1.0 + k * pow(abs(uv.yx), vec2(2.0));
  return uv * 0.5 + 0.5;
}

/* ----------------- Colors ----------------- */

vec3 WHITE   = vec3(1.0);
vec3 YELLOW  = vec3(1.0,1.0,0.0);
vec3 CYAN    = vec3(0.0,1.0,1.0);
vec3 GREEN   = vec3(0.0,1.0,0.0);
vec3 MAGENTA = vec3(1.0,0.0,1.0);
vec3 RED     = vec3(1.0,0.0,0.0);
vec3 BLUE    = vec3(0.0,0.0,1.0);
vec3 BLACK   = vec3(0.0);
vec3 GRAY    = vec3(0.4);
vec3 NAVY    = vec3(0.0,0.0,0.4);

/* ----------------- RP-219 Layout ----------------- */

vec3 topBars(float x) {
  if (x < 1.0/7.0) return WHITE;
  if (x < 2.0/7.0) return YELLOW;
  if (x < 3.0/7.0) return CYAN;
  if (x < 4.0/7.0) return GREEN;
  if (x < 5.0/7.0) return MAGENTA;
  if (x < 6.0/7.0) return RED;
  return BLUE;
}

vec3 midBars(float x) {
  if (x < 0.14) return BLUE;
  if (x < 0.28) return BLACK;
  if (x < 0.42) return MAGENTA;
  if (x < 0.56) return BLACK;
  if (x < 0.70) return CYAN;
  if (x < 0.84) return BLACK;
  return GRAY;
}

vec3 bottomBars(float x) {
  if (x < 0.18) return NAVY;
  if (x < 0.36) return WHITE;
  if (x < 0.54) return vec3(0.1);
  if (x < 0.72) return BLACK;
  if (x < 0.86) return GRAY;
  return BLACK;
}

/* ----------------- Main ----------------- */

void main() {

  vec2 uv = vUv;

  float t = floor(uTime * uStaticSpeed * uSnap) / uSnap;

  float staticField =
    hash(uv * uStaticScale + vec2(t, -t)) * 0.6 +
    hash(uv * uStaticScale * 1.7 + vec2(-t * 2.0, t)) * 0.4;

  float thermalTime = uTime * 0.02;
  vec2 thermalWarp = vec2(
    sin(thermalTime * 0.7 + uv.y * 2.0),
    cos(thermalTime * 0.5 + uv.x * 2.0)
  ) * 0.004 * uThermalDrift;

  uv += thermalWarp;

  float breathe = sin(uTime * 0.35) * 0.003 * uBreath;
  uv += vec2(sin(uv.y * 3.0 + uTime * 0.4), cos(uv.x * 2.0 + uTime * 0.3)) * breathe;

  uv.x += sin(uTime * 0.12 + uv.y * 3.0) * 0.002 * uChromaDrift;

  uv.y += sin(uTime * 40.0 + uv.y * 800.0) * 0.0015 * uFlyback;
  uv.y += sin(uTime * 3.0) * 0.002 * uFlyback;

  uv = curve(uv, uCurvature);

  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
    gl_FragColor = vec4(0.0);
    return;
  }

  vec2 centered = uv * 2.0 - 1.0;
  float barrel = dot(centered, centered);

  float drift =
    sin(uTime * 0.6) *
    0.002 *
    uConverge *
    mix(0.3, 1.5, barrel * uBarrelConverge);

  vec2 rUV = uv + vec2(drift, 0.0);
  vec2 bUV = uv - vec2(drift, 0.0);

  vec3 bars;

  if (uv.y > 0.38) bars = topBars(uv.x);
  else if (uv.y > 0.30) bars = midBars(uv.x);
  else bars = bottomBars(uv.x);

  vec3 rBars = bars;
  vec3 bBars = bars;

  if (rUV.y > 0.38) rBars = topBars(rUV.x);
  else if (rUV.y > 0.30) rBars = midBars(rUV.x);
  else rBars = bottomBars(rUV.x);

  if (bUV.y > 0.38) bBars = topBars(bUV.x);
  else if (bUV.y > 0.30) bBars = midBars(bUV.x);
  else bBars = bottomBars(bUV.x);

  bars.r = rBars.r;
  bars.b = bBars.b;

  bars.r += hash(uv + uTime) * uColorBleed;
  bars.b -= hash(uv - uTime) * uColorBleed;

  bars += hash(uv * 60.0 + uTime * 0.4) * 0.02;

  float luma = dot(bars, vec3(0.299,0.587,0.114));
  float beam = mix(900.0, 700.0, smoothstep(0.4,1.0,luma) * uBeamWidth);
  beam += staticField * 120.0 * uSpotNoise;

  float scan = sin(uv.y * beam) * 0.05 * uScanlineStrength;
  bars -= scan;

  vec3 triad = vec3(
    sin(uv.x * 900.0),
    sin(uv.x * 900.0 + 2.1),
    sin(uv.x * 900.0 + 4.2)
  ) * 0.5 + 0.5;

  float grille = sin(uv.x * 1400.0) * 0.5 + 0.5;
  vec3 aperture = vec3(grille);

  vec3 mask = mix(triad, aperture, step(0.5, uMaskMode));
  bars *= mix(vec3(1.0), mask, uMaskStrength);

  bars += bars * smoothstep(0.65, 1.0, luma) * uBloom;

  float retrace = smoothstep(0.0, 0.04, abs(fract(uTime * 0.8) - uv.y));
  bars *= mix(1.0, 0.55, retrace * uRetrace);

  float hum = sin((uv.y + uTime * 0.15) * 6.2831) * 0.04 * uHum;
  bars -= hum;

  float d = distance(uv, vec2(0.5));
  float vig = 1.0 - smoothstep(0.75, uVignette, d);
  bars *= vig;

  float spot =
    hash(uv * uStaticScale * 0.8 + uTime) *
    staticField *
    0.15 *
    uSpotNoise;

  bars += spot;

  vec3 staticColor = vec3(staticField);
  float glitch = step(1.0 - uGlitchRate, hash(vec2(floor(uTime * 10.0), 0.0)));
  vec3 finalColor = mix(bars, staticColor, glitch * uStaticAmount);

  gl_FragColor = vec4(finalColor, 1.0);
}
`,Q_e=Yd({uTime:0,uStaticAmount:0,uStaticScale:0,uStaticSpeed:0,uSnap:0,uGlitchRate:0,uScanlineStrength:0,uColorBleed:0,uCurvature:0,uVignette:0,uMaskStrength:0,uFlyback:0,uConverge:0,uBloom:0,uBreath:0,uRetrace:0,uBeamWidth:0,uChromaDrift:0,uHum:0,uThermalDrift:0,uSpotNoise:0,uMaskMode:0,uBarrelConverge:0},Iht,Ght);eo({CrtSmtpeStaticMaterial:Q_e});function eSe({staticAmount:n=.35,staticScale:e=700,staticSpeed:t=9,snap:i=24,glitchRate:r=.18,scanlineStrength:s=.55,colorBleed:a=.14,curvature:o=.12,vignette:l=.75,maskStrength:u=.35,flybackStrength:c=.35,convergenceDrift:d=.4,bloomStrength:f=.25,breathStrength:m=.35,retraceStrength:y=.35,beamWidth:_=.5,chromaDrift:S=.3,humStrength:b=.25,barrelConvergence:M=.6,spotNoise:w=.35,thermalDrift:T=.15,maskMode:E=0}){const R=G.useRef();return rs((P,I)=>{R.current&&(R.current.uTime+=I)}),$.jsx("crtSmtpeStaticMaterial",{ref:R,transparent:!1,depthWrite:!0,toneMapped:!1,uStaticAmount:n,uStaticScale:e,uStaticSpeed:t,uSnap:i,uGlitchRate:r,uScanlineStrength:s,uColorBleed:a,uCurvature:o,uVignette:l,uMaskStrength:u,uFlyback:c,uConverge:d,uBloom:f,uBreath:m,uRetrace:y,uBeamWidth:_,uChromaDrift:S,uHum:b,uThermalDrift:T,uSpotNoise:w,uMaskMode:E,uBarrelConverge:M},Q_e.key)}const Oht=`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Uht=`
uniform float uTime;

/* snow controls */
uniform float uSnowAmount;
uniform float uSnowScale;
uniform float uSnowSpeed;
uniform float uSnowSize;
uniform float uSnap;

/* band + RF controls */
uniform float uBandStrength;
uniform float uBandSpeed;
uniform float uBandScale;

uniform float uRFStrength;
uniform float uRFScale;
uniform float uRFSpeed;

uniform float uCurvature;
uniform float uVignette;

varying vec2 vUv;

/* ----------------- Noise utils ----------------- */

vec2 hash2(vec2 p) {
  p = vec2(dot(p, vec2(127.1,311.7)),
           dot(p, vec2(269.5,183.3)));
  return -1.0 + 2.0 * fract(sin(p) * 43758.5453123);
}

float perlin(vec2 p) {
  vec2 i = floor(p);
  vec2 f = fract(p);

  vec2 u = f*f*(3.0-2.0*f);

  return mix(
    mix(dot(hash2(i + vec2(0.0,0.0)), f - vec2(0.0,0.0)),
        dot(hash2(i + vec2(1.0,0.0)), f - vec2(1.0,0.0)), u.x),
    mix(dot(hash2(i + vec2(0.0,1.0)), f - vec2(0.0,1.0)),
        dot(hash2(i + vec2(1.0,1.0)), f - vec2(1.0,1.0)), u.x),
    u.y);
}

float fbm(vec2 p) {
  float v = 0.0;
  float a = 0.5;
  for(int i = 0; i < 4; i++) {
    v += a * perlin(p);
    p *= 2.0;
    a *= 0.5;
  }
  return v;
}

/* ----------------- CRT warp ----------------- */

vec2 curve(vec2 uv, float k) {
  uv = uv * 2.0 - 1.0;
  uv *= 1.0 + k * pow(abs(uv.yx), vec2(2.0));
  return uv * 0.5 + 0.5;
}

/* ----------------- Main ----------------- */

void main() {

  vec2 uv = curve(vUv, uCurvature);

  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
    gl_FragColor = vec4(0.0);
    return;
  }

  float t = floor(uTime * uSnowSpeed * uSnap) / uSnap;

  /* ----------------- pixelated snow UVs ----------------- */

  vec2 pixelUV = floor(uv * uSnowSize) / uSnowSize;

  /* ----------------- perlin snow field ----------------- */

  float snowField = fbm(pixelUV * uSnowScale + vec2(t * 1.2, -t * 0.7));
  snowField = snowField * 0.5 + 0.5;

  float snow = step(0.5, snowField);
  snow = mix(snowField, snow, 0.65);

  /* ----------------- rolling static bands ----------------- */

  float band =
    sin(uv.y * uBandScale + uTime * uBandSpeed) * 0.5 + 0.5;

  float bandNoise = fbm(vec2(uv.y * 4.0, uTime * 0.15));
  band *= bandNoise;

  snow += band * uBandStrength;

  /* ----------------- RF interference streaks ----------------- */

  float rf = fbm(vec2(uv.y * uRFScale, uTime * uRFSpeed));
  rf = smoothstep(0.4, 0.75, rf);
  rf *= sin((uv.y + uTime * 0.15) * 80.0) * 0.5 + 0.5;

  snow += rf * uRFStrength;

  /* ----------------- tone shaping ----------------- */

  snow = clamp(snow, 0.0, 1.0);

  vec3 color = vec3(snow);

  /* vignette */
  float d = distance(uv, vec2(0.5));
  float vig = 1.0 - smoothstep(0.75, uVignette, d);
  color *= vig;

  /* global mix */
  color = mix(vec3(0.0), color, uSnowAmount);

  gl_FragColor = vec4(color, 1.0);
}
`,tSe=Yd({uTime:0,uSnowAmount:1,uSnowScale:140,uSnowSpeed:1,uSnowSize:240,uSnap:60,uBandStrength:.35,uBandSpeed:.6,uBandScale:8,uRFStrength:.25,uRFScale:22,uRFSpeed:.4,uCurvature:0,uVignette:1.1},Oht,Uht);eo({CrtStaticMaterial:tSe});function nSe({snowAmount:n=1,snowScale:e=180,snowSpeed:t=1,snowSize:i=240,curvature:r=.12,vignette:s=.75,bandStrength:a=.35,bandSpeed:o=.6,bandScale:l=8,snap:u=24,rfStrength:c=.25,rfScale:d=22,rfSpeed:f=.4}){const m=G.useRef();return rs((y,_)=>{m.current&&(m.current.uTime+=_)}),$.jsx("crtStaticMaterial",{ref:m,transparent:!1,depthWrite:!0,toneMapped:!1,uSnowAmount:n,uSnowScale:e,uSnowSpeed:t,uSnowSize:i,uSnap:u,uBandStrength:a,uBandSpeed:o,uBandScale:l,uRFStrength:c,uRFScale:d,uRFSpeed:f,uCurvature:r,uVignette:s},tSe.key)}function iSe({innerMaterial:n,outerMaterial:e,innerProps:t,outerProps:i,...r}){const{nodes:s}=Zo($l("Bret.glb"));return $.jsx("group",{...r,dispose:null,children:$.jsxs("group",{rotation:[Math.PI/2,0,0],children:[$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s["bret-in"].geometry,material:n,scale:[10,.524,10],...t}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:s["bret-out"].geometry,material:e,scale:[10,.524,10],...i})]})})}function rSe({innerColor:n="#FF0000",innerColorEmissive:e=!1,innerColorEmissiveIntensity:t=0,outerColor:i="#000000",outerColorEmissive:r=!1,outerColorEmissiveIntensity:s=0,...a}){const{materials:o}=Zo($l("Bret.glb")),l=G.useMemo(()=>n?new mo({color:e?null:n,emissive:e?n:null,emissiveIntensity:t,side:fr}):o["SVGMat.002"],[n,e,t,o]),u=G.useMemo(()=>i?new mo({color:r?null:i,emissive:r?i:null,emissiveIntensity:s,side:fr}):o["SVGMat.003"],[i,r,s,o]);return $.jsx(iSe,{innerMaterial:l,outerMaterial:u,...a})}function kht({pressDepth:n=.012,glowIntensity:e=2.5,onClick:t,...i}){const[r,s]=G.useState(!1),[a,o]=G.useState(!1),l=G.useMemo(()=>new mo({color:"#ff0000",emissive:"#ff0000",emissiveIntensity:0,side:fr}),[]),u=G.useMemo(()=>new mo({color:"#000000",side:fr}),[]),{pressY:c,emissive:d}=kg({pressY:a?-n:0,emissive:r?e:0,config:f=>f==="pressY"?{mass:.6,tension:320,friction:16}:{mass:1,tension:140,friction:20}});return $.jsx(iSe,{...i,innerMaterial:l,outerMaterial:u,innerProps:{positionY:c,onPointerDown:f=>{f.stopPropagation(),o(!0)},onPointerUp:f=>{f.stopPropagation(),o(!1),s(m=>!m),t?.()},onPointerLeave:()=>o(!1),children:$.jsx(CL.meshStandardMaterial,{attach:"material",color:"#ff0000",emissive:"#ff0000",emissiveIntensity:d,side:fr})},outerProps:{onPointerDown:f=>{f.stopPropagation(),o(!0)},onPointerUp:f=>{f.stopPropagation(),o(!1),s(m=>!m),t?.()},onPointerLeave:()=>o(!1)}})}Zo.preload($l("Bret.glb"));function zht({count:n=4,radius:e=2,speed:t=.25}){const i=G.useRef(),r=Math.PI*2/n;return rs((s,a)=>{i.current.rotation.y+=a*t}),$.jsx("group",{ref:i,children:Array.from({length:n}).map((s,a)=>{const o=a*r,l=Math.sin(o)*e,u=Math.cos(o)*e;return $.jsx(Kue,{position:[l,0,u],rotation:[0,o,0]},a)})})}function sSe(){return $.jsxs(G.Suspense,{fallback:$.jsx(iue,{}),children:[$.jsx(Ob,{makeDefault:!0,position:[0,0,3]}),$.jsx("color",{attach:"background",args:["#646464"]}),$.jsx("ambientLight",{intensity:.3}),$.jsx("directionalLight",{position:[5,6,4],intensity:1.2}),$.jsx(zht,{count:6,radius:1.2,speed:.6}),$.jsx(rSe,{scale:1.5,position:[0,.05,0],rotation:[0,0,0]})]})}function Vht(){return{channels:G.useMemo(()=>[{key:"static",video:$.jsx(nSe,{}),audio:{type:"file",url:US("tv-static.mp3"),loop:!0}},{key:"smtpe",video:$.jsx(eSe,{}),audio:{type:"file",url:US("tv-static.mp3"),loop:!0}},{key:"vhs",video:$.jsx(x2,{...Cht,horizontalPadding:100,verticalPadding:95}),audio:null},{key:"terminal",video:$.jsx(x2,{...wht,horizontalPadding:100,verticalPadding:95}),audio:null},{key:"homeVideo",video:$.jsx(b2,{useWebcam:!0}),audio:{type:"file",url:US("laugh-track.mp3"),loop:!0}},{key:"tv",video:$.jsx(b2,{}),audio:{type:"file",url:US("ren-and-stimpy.mp3"),loop:!0}},{key:"threeD",video:$.jsx(J_e,{scene:$.jsx(sSe,{})}),audio:{type:"strudel",code:v2.threeD}},{key:"pip",video:$.jsx($_e,{}),audio:{type:"strudel",code:v2.weirderStuff}}],[])}}function Hht({initialPower:n=!0,defaultChannelKey:e,surfChannels:t=!1,initialMuted:i=!1}={}){const r=G.useRef(null),s=G.useRef(null),a=G.useRef(null),o=G.useRef(null),l=G.useRef(null),[u,c]=G.useState(null),[d,f]=G.useState(!1),[m,y]=G.useState(n),[_,S]=G.useState(t),[b,M]=G.useState(i),{channels:w}=Vht(),T=G.useMemo(()=>{const ze={};return w.forEach((ot,ut)=>{ze[ot.key]=ut}),ze},[w]),[E,R]=G.useState(()=>e&&e in T?T[e]:0),P=m?w[E]:null;G.useEffect(()=>{console.log("[rca] creating AudioContext");const ze=new AudioContext,ot=ze.createGain(),ut=ze.createGain(),Wt=ze.createBiquadFilter(),It=ze.createDynamicsCompressor(),ke=ze.createGain();return Wt.type="bandpass",Wt.frequency.value=1800,Wt.Q.value=.8,ut.gain.value=.9,ke.gain.value=i?1e-4:.8,ot.connect(ut).connect(Wt).connect(It).connect(ke).connect(ze.destination),r.current=ze,s.current=ot,a.current=ke,c(ze),console.log("[rca] AudioContext ready",ze),()=>{console.log("[rca] closing AudioContext"),ze.close()}},[i]);const I=Y_e(u?{audioContext:u}:null);G.useEffect(()=>{if(!(!I?.ready||!I.output||!s.current)){if(console.log("[rca] attempting to patch strudel"),console.log("[rca] RCA ctx:",r.current),console.log("[rca] Strudel ctx:",I.ctx||I.audioContext),I.ctx&&r.current&&I.ctx!==r.current){console.error("[rca]  AUDIO CONTEXT MISMATCH  aborting patch");return}try{I.output.disconnect()}catch(ze){console.warn("[rca] strudel output disconnect failed",ze)}I.output.connect(s.current),console.log("[rca]  strudel patched into tv bus")}},[I?.ready]),G.useEffect(()=>{if(!a.current||!r.current)return;const ze=r.current,ot=b?1e-4:.8;a.current.gain.cancelScheduledValues(ze.currentTime),a.current.gain.linearRampToValueAtTime(ot,ze.currentTime+.15)},[b]);const B=async()=>{const ze=r.current;!ze||ze.state==="running"||(console.log("[rca] unlocking audio"),await ze.resume(),await I?.unlock?.(),f(!0),console.log("[rca] audio unlocked"))};function N(ze=.3){if(!l.current||!o.current)return;const ot=r.current;l.current.gain.linearRampToValueAtTime(1e-4,ot.currentTime+ze),setTimeout(()=>{try{o.current?.stop?.()}catch(ut){console.error("[rca cables] current source stop failed",ut)}o.current=null,l.current=null},ze*1e3)}async function U(ze,ot=!0,ut=.4){const Wt=r.current;if(!Wt||!s.current)return;N(),I?.stop?.();const It=await fetch(ze),ke=await Wt.decodeAudioData(await It.arrayBuffer()),je=Wt.createBufferSource(),gt=Wt.createGain();je.buffer=ke,je.loop=ot,gt.gain.value=1e-4,je.connect(gt).connect(s.current),je.start(),gt.gain.linearRampToValueAtTime(1,Wt.currentTime+ut),o.current=je,l.current=gt}G.useEffect(()=>{if(!m||b||!P?.audio){N(.35),I?.stop?.();return}const{audio:ze}=P;ze.type==="file"&&U(ze.url,ze.loop),ze.type==="strudel"&&I?.ready&&(N(.35),I.play(ze.code))},[m,E,b,I?.ready]);const V=()=>{B(),y(!0)},W=()=>{N(.35),I?.stop?.(),y(!1)},K=()=>{y(ze=>(ze?(N(.35),I?.stop?.()):B(),!ze))},q=()=>M(!0),j=()=>M(!1),te=()=>M(ze=>!ze);function he(){R(ze=>(ze+1)%w.length)}function _e(ze){ze in T&&R(T[ze])}const Be=G.useRef(0),ue=G.useRef(1+Math.random()*.5);rs((ze,ot)=>{!m||!_||(Be.current+=ot,Be.current>=ue.current&&(Be.current=0,ue.current=.6+Math.random()*.9,R(ut=>(ut+1)%w.length)))});const ce=()=>S(!0),Ce=()=>S(!1),Oe=()=>S(ze=>!ze);async function nt(ze,ot=.5){const ut=r.current;if(!ut)return;ut.state!=="running"&&await B();const Wt=await fetch(ze),It=await ut.decodeAudioData(await Wt.arrayBuffer()),ke=ut.createBufferSource(),je=ut.createGain();je.gain.value=ot,ke.buffer=It,ke.connect(je).connect(ut.destination),ke.start(),ke.onended=()=>{ke.disconnect(),je.disconnect()}}const Ae=()=>nt(US("knob-click.mp3"),.35),Ye=()=>nt(US("switch-click.mp3"),.35);function ft(ze){if(!ze||!a.current||!r.current)return;const ot=new oV;ze.add(ot);const ut=new uV(ot);a.current.disconnect(),a.current.connect(ut.gain),ut.setRefDistance(1.2),ut.setRolloffFactor(2),ze.add(ut)}return{channels:w,activeChannel:P,channelIndex:E,channelKey:P?.key??null,power:m,surfing:_,muted:b,unlocked:d,powerOn:V,powerOff:W,togglePower:K,muteOn:q,muteOff:j,toggleMute:te,nextChannel:he,setChannelByKey:_e,surfOn:ce,surfOff:Ce,toggleSurfing:Oe,knobClick:Ae,dialClick:Ye,unlockAudio:B,attachToObject:ft,strudel:I}}const aSe=G.createContext(null);function oSe({children:n,bodyMaterial:e,dialMaterial:t,knobMaterial:i}){const{nodes:r}=Zo($l("retro_tv.glb")),s=G.useMemo(()=>({body:e??new mo({color:"#050505",roughness:.65,metalness:.15}),dial:t??new mo({color:"#0b0b0b",roughness:.4,metalness:.1}),knob:i??new mo({color:"#0b0b0b",roughness:.4,metalness:.1})}),[e,t,i]),a=G.useMemo(()=>{const o=r.retro_tv.clone(),l=r.knob_01.clone(),u=r.knob_02.clone();return o.material=s.body,l.material=s.knob,u.material=s.knob,{Body:o,Knob:l,Knob1:u}},[r,s]);return $.jsx(EWe,{meshes:a,children:o=>$.jsx(aSe.Provider,{value:{merged:o,nodes:r,screenGeo:r.screen.geometry},children:n})})}Zo.preload($l("retro_tv.glb"));function Ry(n){let e=null;return n.traverse(t=>{t.isMesh&&!e&&(e=t)}),e}function Xht({knob01Step:n=0,stepsPerRotation:e=12,onDial1Click:t,onDial2Click:i,onDial3Click:r,onDial4Click:s,onDial5Click:a,onKnob01Click:o,onKnob02Click:l,screenMaterial:u,power:c,muted:d,channelSurfing:f,channelIndex:m,...y}){const{merged:_,nodes:S,screenGeo:b}=G.useContext(aSe),M=G.useRef({}),w=Math.PI*2/e,{knobRotation:T}=kg({knobRotation:-(n*w),config:{tension:180,friction:20}}),E=G.useMemo(()=>({d1:Ry(S.dial_01)?.geometry,d2:Ry(S.dial_02)?.geometry,d3:Ry(S.dial_03)?.geometry}),[S]),R=G.useMemo(()=>({power:Ry(S.dial_01).material.clone(),terminal:Ry(S.dial_02).material.clone(),vhs:Ry(S.dial_03).material.clone(),surf:Ry(S.dial_01).material.clone(),mute:Ry(S.dial_01).material.clone()}),[S]);G.useEffect(()=>{R.power.emissive.set("#ff1a1a"),R.terminal.emissive.set("#00ff55"),R.vhs.emissive.set("#1a4dff"),R.surf.emissive.set("#d0d0d0"),R.mute.emissive.set("#fb00ff")},[R]);const P=kg({glow:c?1:0}),I=kg({glow:c&&m===3?1:0}),B=kg({glow:c&&m===2?1:0}),N=kg({glow:c&&f?1:0}),U=kg({glow:c&&d?1:0});rs(()=>{R.power.emissiveIntensity=P.glow.get()*2,R.terminal.emissiveIntensity=I.glow.get()*2,R.vhs.emissiveIntensity=B.glow.get()*2,R.surf.emissiveIntensity=N.glow.get()*2,R.mute.emissiveIntensity=U.glow.get()*2});function V(q,j=.004){const te=M.current[q];te&&(te.position.z+=j)}function W(q,j=.004){const te=M.current[q];te&&(te.position.z-=j)}function K(q,j){return te=>{te.stopPropagation(),V(q),j?.(),setTimeout(()=>W(q),120)}}return $.jsx("group",{...y,children:$.jsxs("group",{rotation:[-Math.PI,-Math.PI,-Math.PI],children:[$.jsx(_.Body,{}),$.jsx("mesh",{geometry:E.d1,material:R.power,scale:.5,position:[.254,.208,.092],ref:q=>{M.current.dial1=q},onPointerDown:K("dial1",t)}),$.jsx("mesh",{geometry:E.d2,material:R.terminal,scale:.5,position:[.272,.208,.092],ref:q=>{M.current.dial2=q},onPointerDown:K("dial2",i)}),$.jsx("mesh",{geometry:E.d3,material:R.vhs,scale:.5,position:[.29,.208,.092],ref:q=>{M.current.dial3=q},onPointerDown:K("dial3",r)}),$.jsx("mesh",{geometry:E.d1,material:R.surf,scale:.5,position:[.308,.208,.092],ref:q=>{M.current.dial4=q},onPointerDown:K("dial4",s)}),$.jsx("mesh",{geometry:E.d1,material:R.mute,scale:.5,position:[.326,.208,.092],ref:q=>{M.current.dial5=q},onPointerDown:K("dial5",a)}),$.jsx(CL.group,{position:[.291,.406,.097],"rotation-z":T,children:$.jsx(_.Knob,{onPointerDown:o})}),$.jsx(_.Knob1,{position:[.291,.289,.097],onPointerDown:l}),$.jsx("mesh",{geometry:b,position:[-.077,.262,.07],rotation:[0,0,-3.13],children:u??$.jsx("meshStandardMaterial",{color:"#111",metalness:1,roughness:0})})]})})}function XU({stepsPerRotation:n=12,isTurnedOn:e=!0,defaultChannel:t="snow",isSurfingChannels:i=!1,isOnMute:r=!1,...s}){const a=G.useMemo(()=>({body:new mo({color:"#050505",roughness:.75,metalness:.05}),plastic:new mo({color:"#0b0b0b",roughness:.4,metalness:.1}),metal:new mo({color:"#7d7b7b",roughness:0,metalness:1})}),[]),{activeChannel:o,channelIndex:l,channelKey:u,power:c,surfing:d,muted:f,togglePower:m,toggleMute:y,nextChannel:_,setChannelByKey:S,toggleSurfing:b,knobClick:M,dialClick:w}=Hht({initialPower:e,defaultChannelKey:t,surfChannels:i,initialMuted:r}),[T,E]=G.useState(0);G.useEffect(()=>{d&&E(W=>W+1)},[u,E]);function R(){M(),_(),E(W=>W+1)}function P(){w(),m()}function I(){w(),c||m(),d&&b(),S("terminal")}function B(){w(),c||m(),d&&b(),S("vhs")}function N(){w(),b()}function U(){w(),y()}function V(){console.log("knob 2 clicked (reserved)")}return $.jsx(oSe,{bodyMaterial:a.body,dialMaterial:a.plastic,knobMaterial:a.metal,children:$.jsx(Xht,{...s,stepsPerRotation:n,knob01Step:T,power:c,muted:f,channelSurfing:d,channelIndex:l,screenMaterial:o?.video??null,onDial1Click:P,onDial2Click:I,onDial3Click:B,onDial4Click:N,onDial5Click:U,onKnob01Click:R,onKnob02Click:V})})}const xJ=["Arial Black","Arial","Verdana","Tahoma","Trebuchet MS","Impact","Courier New","Lucida Console","Monaco","Consolas","Menlo","Orbitron","VT323","Press Start 2P","monospace","sans-serif","serif","terminal"];function Wht(){const n=Ks("CRT SMPTE RP-219",{staticAmount:{value:.35,min:0,max:1,step:.01},staticScale:{value:700,min:50,max:1400,step:1},staticSpeed:{value:9,min:.1,max:20,step:.1},snap:{value:24,min:1,max:60,step:1},glitchRate:{value:.18,min:0,max:1,step:.01},scanlineStrength:{value:.55,min:0,max:1,step:.01},colorBleed:{value:.14,min:0,max:.5,step:.01},curvature:{value:.12,min:0,max:.4,step:.01},vignette:{value:.75,min:.6,max:.98,step:.01},maskStrength:{value:.35,min:0,max:1,step:.01},flybackStrength:{value:.35,min:0,max:1,step:.01},convergenceDrift:{value:.4,min:0,max:1,step:.01},bloomStrength:{value:.25,min:0,max:1,step:.01},breathStrength:{value:.35,min:0,max:1,step:.01},retraceStrength:{value:.35,min:0,max:1,step:.01},beamWidth:{value:.5,min:0,max:1,step:.01},chromaDrift:{value:.3,min:0,max:1,step:.01},humStrength:{value:.25,min:0,max:1,step:.01},barrelConvergence:{value:.6,min:0,max:2,step:.01},spotNoise:{value:.35,min:0,max:1,step:.01},thermalDrift:{value:.15,min:0,max:1,step:.01},maskMode:{value:0,options:{shadow:0,grille:1}}},{collapsed:!0}),e=Ks("CRT Static",{snowAmount:{value:1,min:0,max:1},snowScale:{value:180,min:10,max:800},snowSpeed:{value:1,min:0,max:5},snowSize:{value:240,min:40,max:1e3},curvature:{value:.12,min:0,max:.4,step:.01},vignette:{value:.75,min:.6,max:.98,step:.01},bandStrength:{value:.35,min:0,max:1},bandSpeed:{value:.6,min:0,max:3},bandScale:{value:8,min:1,max:40},snap:{value:24,min:1,max:60,step:1},rfStrength:{value:.25,min:0,max:1},rfScale:{value:22,min:2,max:80},rfSpeed:{value:.4,min:0,max:3}},{collapsed:!0}),t=Ks("No Signal",{Text:Mi({screenText:{value:`12:00 FEB. 28, 1986\r
INSERT VHS`,rows:!0},fontSize:{value:28,min:0,max:48,step:1},fontName:{value:"Press Start 2P",options:xJ},fontColor:{value:"#FFFFFF"},showCaret:{value:!1},caretMode:{value:"block",options:["block","underscore","line"]},caretBlinkRate:{value:2,min:.2,max:5,step:.1},horizontalPadding:{value:100,min:0,max:1e3,step:1},verticalPadding:{value:95,min:0,max:1e3,step:1}},{collapsed:!0}),Look:Mi({screenColor:{value:"#0b2fd8"},glowStrength:{value:.35,min:0,max:1,step:.01},curvature:{value:.06,min:0,max:.2,step:.001},vignette:{value:1.15,min:.5,max:2,step:.01}},{collapsed:!0}),Noise:Mi({noiseStrength:{value:.08,min:0,max:.4,step:.001},scanlineStrength:{value:.08,min:0,max:.3,step:.001},scanlineDensity:{value:900,min:200,max:2e3,step:10}},{collapsed:!0}),Roll:Mi({rollSpeed:{value:.4,min:0,max:2,step:.01},rollStrength:{value:0,min:0,max:2,step:.01}},{collapsed:!0}),Chroma:Mi({chromaOffset:{value:.0025,min:0,max:.01,step:1e-4}},{collapsed:!0})},{collapsed:!0}),i=Ks("Terminal",{Text:Mi({screenText:{value:`a:\\> ||TERMINAL ERROR||\r
    - 0X666420 -\r
    DATA CORRUPTED\r
a:\\> FULL SYSTEM FAILURE
a:\\> INSERT BOOT DISK`,rows:!0},fontSize:{value:26,min:0,max:48,step:1},fontName:{value:"Press Start 2P",options:xJ},fontColor:{value:"#48ff00"},showCaret:{value:!0},caretMode:{value:"block",options:["block","underscore","line"]},caretBlinkRate:{value:2,min:.2,max:5,step:.1},horizontalPadding:{value:100,min:0,max:1e3,step:1},verticalPadding:{value:95,min:0,max:1e3,step:1}},{collapsed:!0}),Look:Mi({screenColor:{value:"#000000"},glowStrength:{value:.35,min:0,max:1,step:.01},curvature:{value:.06,min:0,max:.2,step:.001},vignette:{value:1.15,min:.5,max:2,step:.01}},{collapsed:!0}),Noise:Mi({noiseStrength:{value:.08,min:0,max:.4,step:.001},scanlineStrength:{value:.08,min:0,max:.3,step:.001},scanlineDensity:{value:900,min:200,max:2e3,step:10}},{collapsed:!0}),Roll:Mi({rollSpeed:{value:.4,min:0,max:2,step:.01},rollStrength:{value:0,min:0,max:2,step:.01}},{collapsed:!0}),Chroma:Mi({chromaOffset:{value:.0025,min:0,max:.01,step:1e-4}},{collapsed:!0})},{collapsed:!0}),r=Ks("HomeVideo",{padX:{value:.06,min:0,max:.25,step:.001},padY:{value:.08,min:0,max:.25,step:.001},curvature:{value:.12,min:0,max:.4,step:.001},vignette:{value:.75,min:.3,max:1.2,step:.001},staticAmount:{value:.35,min:0,max:1,step:.001},staticScale:{value:700,min:50,max:2e3,step:1},staticSpeed:{value:9,min:0,max:30,step:.01},snap:{value:24,min:1,max:60,step:1},spotNoise:{value:.35,min:0,max:1,step:.001},thermalDrift:{value:.15,min:0,max:1,step:.001},glitchRate:{value:.18,min:0,max:1,step:.001},flybackStrength:{value:.35,min:0,max:1,step:.001},retraceStrength:{value:.35,min:0,max:1,step:.001},humStrength:{value:.25,min:0,max:1,step:.001},breathStrength:{value:.35,min:0,max:1,step:.001},scanlineStrength:{value:.55,min:0,max:1,step:.001},beamWidth:{value:.5,min:0,max:1,step:.001},bloomStrength:{value:.25,min:0,max:1,step:.001},colorBleed:{value:.14,min:0,max:.5,step:.001},chromaDrift:{value:.3,min:0,max:1,step:.001},convergenceDrift:{value:.4,min:0,max:1,step:.001},barrelConvergence:{value:.6,min:0,max:2,step:.001},maskStrength:{value:.35,min:0,max:1,step:.001},maskMode:{value:0,options:{Triad:0,Aperture:1}}},{collapsed:!0}),s=Ks("TV",{padX:{value:.06,min:0,max:.25,step:.001},padY:{value:.08,min:0,max:.25,step:.001},curvature:{value:.12,min:0,max:.4,step:.001},vignette:{value:.75,min:.3,max:1.2,step:.001},staticAmount:{value:.35,min:0,max:1,step:.001},staticScale:{value:700,min:50,max:2e3,step:1},staticSpeed:{value:9,min:0,max:30,step:.01},snap:{value:24,min:1,max:60,step:1},spotNoise:{value:.35,min:0,max:1,step:.001},thermalDrift:{value:.15,min:0,max:1,step:.001},glitchRate:{value:.18,min:0,max:1,step:.001},flybackStrength:{value:.35,min:0,max:1,step:.001},retraceStrength:{value:.35,min:0,max:1,step:.001},humStrength:{value:.25,min:0,max:1,step:.001},breathStrength:{value:.35,min:0,max:1,step:.001},scanlineStrength:{value:.55,min:0,max:1,step:.001},beamWidth:{value:.5,min:0,max:1,step:.001},bloomStrength:{value:.25,min:0,max:1,step:.001},colorBleed:{value:.14,min:0,max:.5,step:.001},chromaDrift:{value:.3,min:0,max:1,step:.001},convergenceDrift:{value:.4,min:0,max:1,step:.001},barrelConvergence:{value:.6,min:0,max:2,step:.001},maskStrength:{value:.35,min:0,max:1,step:.001},maskMode:{value:0,options:{Triad:0,Aperture:1}}},{collapsed:!0}),a=Ks("Scene In Scene",{Render:Mi({resolution:{value:1024,min:256,max:2048,step:256}},{collapsed:!0}),Static:Mi({staticAmount:{value:.12,min:0,max:.5,step:.001},staticScale:{value:600,min:50,max:2e3,step:10},staticSpeed:{value:6,min:0,max:20,step:.1}},{collapsed:!0}),CRT:Mi({scanlineStrength:{value:.4,min:0,max:1,step:.01},curvature:{value:.12,min:0,max:.4,step:.005},vignette:{value:.85,min:.4,max:1.2,step:.005},chromaDrift:{value:.25,min:0,max:1,step:.005}},{collapsed:!0}),Post:Mi({bloom:{value:.25,min:0,max:2,step:.01}},{collapsed:!0})},{collapsed:!0}),o=Ks("Picture In Picture",{Render:Mi({resolution:{value:1024,min:256,max:2048,step:256}},{collapsed:!0}),Feedback:Mi({decay:{value:.85,min:.7,max:.97,step:.001},zoom:{value:1.01,min:1,max:1.05,step:5e-4},warp:{value:.6,min:0,max:2,step:.01}},{collapsed:!0}),CRT:Mi({staticAmount:{value:.04,min:0,max:.25,step:.001},scanlineStrength:{value:.4,min:0,max:1,step:.01},curvature:{value:.12,min:0,max:.4,step:.005},vignette:{value:.85,min:.4,max:1.2,step:.005}},{collapsed:!0})},{collapsed:!0});return{smtpe:n,tvStatic:e,noSignal:t,terminal:i,homeVideo:r,tv:s,threeD:a,pip:o}}function Zht(){const{smtpe:n,tvStatic:e,noSignal:t,terminal:i,homeVideo:r,tv:s,threeD:a,pip:o}=Wht(),l=7,u=1,c=Math.PI*.9,d=.2,f=G.useMemo(()=>[$.jsx("meshStandardMaterial",{color:"#111",roughness:0,metalness:1},"std"),$.jsx(nSe,{...e},"static"),$.jsx(eSe,{...n},"smtpe"),$.jsx(x2,{...i},"terminal"),$.jsx(x2,{...t},"vhs"),$.jsx(b2,{useWebcam:!0,...r},"homeVideo"),$.jsx(b2,{...s},"tv"),$.jsx(J_e,{scene:$.jsx(sSe,{}),...a},"three-d"),$.jsx($_e,{...o},"pip")],[]),[m,y]=G.useState(0),_=G.useRef(1),S=G.useMemo(()=>f.slice(0,m),[f,m]),b=G.useMemo(()=>{const T=S.length;if(T===0)return[];const E=c,R=f.length,I=E/Math.max(R-1,1)*.95,B=(T-1)/2;return S.map((N,U)=>{const V=(U-B)*I,W=Math.sin(V)*l,K=-(Math.cos(V)*l)+l+d;return{position:[W,u,K],rotation:[0,-V,0],material:N}})},[S,l,u,c,d,f.length]),M=jue(b,{keys:(T,E)=>E,from:{position:[0,-1,3],rotation:[0,0,0],scale:.25},enter:T=>({position:T.position,rotation:T.rotation,scale:1}),update:T=>({position:T.position,rotation:T.rotation,scale:1}),leave:{position:[0,u-.5,2.5],rotation:[0,Math.PI*.15,0],scale:.05},config:{mass:1,tension:220,friction:26}}),w=G.useCallback(()=>{y(T=>T>=f.length?(_.current=-1,T-1):T<=0?(_.current=1,1):T+_.current)},[f.length]);return $.jsxs($.Fragment,{children:[M((T,E,R,P)=>$.jsxs(CL.mesh,{position:T.position,rotation:T.rotation,scale:T.scale,children:[$.jsx("planeGeometry",{args:[2,2]}),E.material]},`panel-${P}`)),$.jsx(Kue,{position:[0,0,1],rotation:[-Math.PI/2,0,0],onClick:w}),$.jsx(s2,{position:[-1,0,2],rotation:[-Math.PI/2,0,0]}),$.jsx(s2,{position:[1,0,2],rotation:[-Math.PI/2,0,0]})]})}function jht(){return $.jsxs($.Fragment,{children:[$.jsx(Ob,{makeDefault:!0,position:[0,7,11],near:1,far:100}),$.jsx(mA,{makeDefault:!0,minDistance:0}),$.jsx("ambientLight",{intensity:.1}),$.jsx("directionalLight",{position:[5,6,4],intensity:.2,lookAt:[0,0,0]}),$.jsx("directionalLight",{position:[-5,6,-4],intensity:.2,lookAt:[0,0,0]}),$.jsx(_We,{}),$.jsx(Yht,{}),$.jsx(Zht,{}),$.jsx(Kht,{}),$.jsx($ht,{}),$.jsx("color",{attach:"background",args:["#000000"]}),$.jsx(gL,{preset:"city"})]})}function Yht(){return $.jsx("group",{children:$.jsxs(oSe,{children:[$.jsx(XU,{position:[5,1,-3],rotation:[0,-Math.PI/4,0],scale:10,defaultChannel:"vhs"}),$.jsx(XU,{position:[0,6.25,-5],rotation:[0,0,0],scale:10,defaultChannel:"threeD",isTurnedOn:!1}),$.jsx(XU,{position:[-5,1,-3],rotation:[0,Math.PI/4,0],scale:10,defaultChannel:"terminal",isTurnedOn:!1})]})})}function Kht(){return $.jsxs("mesh",{position:[0,0,2],rotation:[-Math.PI/2,0,-Math.PI/4],children:[$.jsx("planeGeometry",{args:[20,20]}),$.jsx(NWe,{blur:[300,100],resolution:2048,mixBlur:1,mixStrength:80,roughness:1,depthScale:1.2,minDepthThreshold:.4,maxDepthThreshold:1.4,color:"#131313",metalness:1})]})}function $ht(){return $.jsxs("group",{children:[$.jsx("directionalLight",{position:[0,10,0],intensity:.7,lookAt:[0,0,0]}),$.jsx("directionalLight",{position:[0,10,0],intensity:.7,lookAt:[0,1,-3]}),$.jsxs("mesh",{position:[0,10,5],rotation:[-Math.PI/4,0,0],children:[$.jsx("torusGeometry",{args:[5]}),$.jsx("meshStandardMaterial",{color:"#FFFFFF",emissive:"#FFFFFF",emissiveIntensity:1})]})]})}function Ba(n){return n*(Math.PI/180)}function Jht(n,e){const t=Math.random();return n+Math.floor(t*(e-n))}function mN(n,e,t){return Math.sin(n*e)*t}const bJ=Ba(45),_2=Ba(90);function qht({rightLidVisible:n=!0,rightLidRotation:e=Math.PI/4,leftLidVisible:t=!0,leftLidRotation:i=1.833,frontLeftWheelRotation:r=Math.PI,frontRightWheelRotation:s=0,rearLeftWheelRotation:a=Math.PI,rearRightWheelRotation:o=0,...l}){const{nodes:u,materials:c}=Zo($l("Dumpster.glb"));return $.jsx("group",{...l,dispose:null,children:$.jsx("group",{name:"Scene",children:$.jsx("group",{name:"Model",children:$.jsx("group",{name:"Base",rotation:[Math.PI/2,0,0],scale:.01,children:$.jsx("group",{name:"Root",children:$.jsxs("group",{name:"Dumpster",rotation:[-Math.PI,0,0],children:[$.jsx("group",{name:"Container",position:[0,2.238,122.206],children:$.jsx("group",{name:"C1",position:[90,-49.761,-24.038],rotation:[0,-1.571,0],children:$.jsx("mesh",{name:"C2",castShadow:!0,receiveShadow:!0,geometry:u.C2.geometry,material:c["Dumpster_02.001"]})})}),$.jsx("group",{name:"FrontLeftWheel",position:[-83.16,-30,16.669],rotation:[0,0,r],children:$.jsx("group",{name:"FLW1",position:[6.84,-17.523,81.499],rotation:[0,-1.571,0],children:$.jsx("mesh",{name:"FLW2",castShadow:!0,receiveShadow:!0,geometry:u.FLW2.geometry,material:c["Dumpster_02.001"]})})}),$.jsx("group",{name:"FrontRightWheel",position:[83.16,-30,16.669],rotation:[0,0,s],children:$.jsx("group",{name:"FRW1",position:[6.84,-17.523,81.499],rotation:[0,-1.571,0],children:$.jsx("mesh",{name:"FRW2",castShadow:!0,receiveShadow:!0,geometry:u.FRW2.geometry,material:c["Dumpster_02.001"]})})}),$.jsx("group",{visible:t,name:"LeftLid",position:[-47.5,51.999,146.244],rotation:[i,0,0],children:$.jsx("group",{name:"LL1",position:[0,.3,51.276],children:$.jsx("mesh",{name:"LL2",castShadow:!0,receiveShadow:!0,geometry:u.LL2.geometry,material:c["Dumpster_02.001"]})})}),$.jsx("group",{name:"RearLeftWheel",position:[-83.16,30,16.669],rotation:[0,0,a],children:$.jsx("group",{name:"RLW1",position:[6.84,-17.523,81.499],rotation:[0,-1.571,0],children:$.jsx("mesh",{name:"RLW2",castShadow:!0,receiveShadow:!0,geometry:u.RLW2.geometry,material:c["Dumpster_02.001"]})})}),$.jsx("group",{name:"RearRightWheel",position:[83.16,33.131,16.669],rotation:[0,0,o],children:$.jsx("group",{name:"RRW1",position:[6.84,-17.523,81.499],rotation:[0,-1.571,0],children:$.jsx("mesh",{name:"RRW2",castShadow:!0,receiveShadow:!0,geometry:u.RRW2.geometry,material:c["Dumpster_02.001"]})})}),$.jsx("group",{name:"RightLid",visible:n,position:[47.5,51.999,146.244],rotation:[e,0,0],children:$.jsx("group",{name:"RL1",position:[0,.3,51.276],children:$.jsx("mesh",{name:"RL2",castShadow:!0,receiveShadow:!0,geometry:u.RL2.geometry,material:c["Dumpster_02.001"]})})})]})})})})})})}Zo.preload($l("Dumpster.glb"));function Qht(){return Ks("ScreenShot",{name:"canvas",png:Eee(n=>{let e=n("ScreenShot.name");e.length||(e="Canvas");const t=document.createElement("a");t.setAttribute("download",`${e}.png`),t.setAttribute("href",document.querySelector("canvas").toDataURL("image/png").replace("image/png","image/octet-stream")),t.click()})},{collapsed:!0}),null}function lI({screenShot:n=!1}){return $.jsxs($.Fragment,{children:[$.jsx(pWe,{}),n&&$.jsx(Qht,{})]})}function lSe({x:n,y:e,z:t,size:i=10,divisions:r=10,...s}){return $.jsxs("group",{...s,children:[n&&$.jsx("gridHelper",{args:[i,r],rotation:[0,0,0]}),e&&$.jsx("gridHelper",{args:[i,r],rotation:[0,0,_2]}),t&&$.jsx("gridHelper",{args:[i,r],rotation:[_2,0,0]})]})}function edt({x:n,y:e,z:t,size:i=10,divisions:r=10,...s}){return $.jsxs("group",{...s,children:[n&&$.jsx("polarGridHelper",{args:[i,r],rotation:[0,0,0]}),e&&$.jsx("polarGridHelper",{args:[i,r],rotation:[0,0,_2]}),t&&$.jsx("polarGridHelper",{args:[i,r],rotation:[_2,0,0]})]})}function PA(){const{plPosition:n,plDecay:e,plDistance:t,plIntensity:i,plCastShadow:r,ambientLightIntensity:s}=Ks("Lighting Rig",{"Point Light":Mi({plPosition:{label:"Position",value:{x:3,y:3,z:5}},plDecay:{label:"Decay",value:0,min:-10,max:10,step:.1},plDistance:{label:"Distance",value:-1,min:-10,max:10,step:.1},plIntensity:{label:"Intensity",value:.8,min:0,max:10,step:.1},plCastShadow:{label:"Cast Shadow",value:!0}},{collapsed:!0}),"Ambient Light":Mi({ambientLightIntensity:{label:"Intensity",value:0,min:0,max:1,step:.1}},{collapsed:!0})},{collapsed:!0});return $.jsxs("group",{children:[$.jsx("ambientLight",{intensity:s}),$.jsx("pointLight",{position:[n.x,n.y,n.z],decay:e,distance:t,intensity:i,castShadow:r})]})}function tdt(){const{rightLidRotation:n,leftLidRotation:e}=Ks("Dumpster Fire",{rightLidRotation:{label:"Right Lid",value:1,min:0,max:1,step:.01},leftLidRotation:{label:"Left Lid",value:0,min:0,max:1,step:.01}},{collapsed:!0}),t=i=>Ba(256+265*i);return $.jsxs($.Fragment,{children:[$.jsx(lI,{}),$.jsx(PA,{}),$.jsx(lSe,{x:!0,y:!0,z:!0}),$.jsx(Jle,{temporal:!0,frames:200,color:"purple",colorBlend:.5,opacity:1,scale:10,alphaTest:.85,children:$.jsx(qle,{amount:8,radius:5,ambient:.5,position:[5,3,2],bias:.001})}),$.jsx(GH,{children:$.jsx(Qle,{})}),$.jsx(qht,{rightLidRotation:-t(n),leftLidRotation:-t(e)}),$.jsx(gL,{preset:"city",background:!0,blur:1})]})}function _J(n){const e=parseInt(n.slice(1),16),t=e>>16&255,i=e>>8&255,r=e&255;return{r:t,g:i,b:r}}function ndt(n,e,t){return`#${(1<<24|n<<16|e<<8|t).toString(16).slice(1)}`}function uSe(n,e,t){const i=_J(n),r=_J(e),s={r:(r.r-i.r)/(t-1),g:(r.g-i.g)/(t-1),b:(r.b-i.b)/(t-1)};return Array.from({length:t},(o,l)=>{const u=Math.round(i.r+s.r*l),c=Math.round(i.g+s.g*l),d=Math.round(i.b+s.b*l);return ndt(u,c,d)})}function idt(n){const{nodes:e,materials:t}=Zo($l("FoldedFrame.glb"));return $.jsx("group",{...n,dispose:null,children:$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Frame.geometry,material:t["Material.002"],rotation:[Math.PI/2,0,0]})})}Zo.preload($l("FoldedFrame.glb"));function rdt(n,e,t){return{size:n,position:e,color:t}}function lo(n,e){return rdt(n,e,"white")}const sdt={settings:{paperDepth:1/16,symmetric:!0},layers:[[lo(1,[0,0])],[lo(2,[0,0]),lo(1,[1.5,1.5])],[lo(2,[1.5,1.5]),lo(1,[-.75,.75])],[lo(1,[.75,.75]),lo(1,[.75,2.25]),lo(1,[2.25,.75]),lo(1,[2.25,2.25])],[lo(1,[-1.25,1.25]),lo(1,[0,1.5]),lo(1,[1.5,0]),lo(1,[.5,2.5]),lo(1,[2.5,.5]),lo(1,[1.5,3]),lo(1,[3,1.5]),lo(1,[2.5,2.5])],[lo(2,[-1.25,1.25])],[lo(2,[0,2.5]),lo(2,[2.5,0]),lo(2,[2.5,2.5]),lo(1,[-2,2])]]};function cSe(){return[{name:"1",frame:sdt}]}function adt(n){return cSe().find(e=>e.name===n)?.frame}function odt({size:n,position:e,color:t,settings:i}){const[r,s]=e,a=i.symmetric&&(r!==0||s!==0);return $.jsxs($.Fragment,{children:[$.jsxs("mesh",{position:[r,s,0],children:[$.jsx("boxGeometry",{castShadow:!0,receiveShadow:!0,args:[n,n,i.paperDepth]}),$.jsx("meshStandardMaterial",{color:t})]}),a&&$.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[-r,-s,0],children:[$.jsx("boxGeometry",{castShadow:!0,receiveShadow:!0,args:[n,n,i.paperDepth]}),$.jsx("meshStandardMaterial",{color:t})]})]})}function ldt({layer:n,squares:e,depth:t,settings:i}){return $.jsx("group",{castShadow:!0,receiveShadow:!0,position:[0,0,t],children:e.map((r,s)=>$.jsx(odt,{index:s,layer:n,...r,settings:i},`sq-${s}`))})}function udt(){const n=cSe(),[{frame:e,rotate:t,colorRangeStart:i,colorRangeEnd:r,dataScale:s,frameScale:a,dataPosition:o,frameVisible:l,framePosition:u},c]=Ks("Scene",()=>({frame:{label:"Select Frame",value:n[0].name,options:n.map(E=>E.name)},colorRangeStart:{label:"Start",value:"#FFFFFF"},colorRangeEnd:{label:"End",value:"#D8D8D8"},rotate:{value:!0,label:"Rotate 45*"},dataScale:{label:"Square Scale",value:.1,min:.1,max:10,step:.1},dataPosition:{label:"Square Position",value:{x:0,y:1.1,z:.08}},frameVisible:{label:"Show Frame",value:!0},framePosition:{label:"Frame Position",value:{x:0,y:1.1,z:0}},frameScale:{label:"Frame Scale",value:1.1,min:.1,max:10,step:.1}}),{collapsed:!1}),d=adt(e||n[0].name),{settings:f,layers:m}=d,y=uSe(i,r,m.length),_=m.map((E,R)=>E.map(P=>({...P,color:y[R]}))),[S,b]=G.useState(1);function M(E){return`#${Math.floor(E).toString(16).padStart(6,"0")}`}function w(E){return`#${(16777215-Math.floor(E)).toString(16).padStart(6,"0")}`}const T=G.useRef();return rs(({clock:E})=>{E||(b(1+Math.sin(E.getElapsedTime())/2),E.getElapsedTime()%2<.5&&c({colorRangeStart:M(E.elapsedTime*E.elapsedTime*23),colorRangeEnd:w(E.elapsedTime*E.elapsedTime*23)}))}),$.jsxs($.Fragment,{children:[$.jsx(PA,{}),$.jsx(lI,{}),$.jsx(Ob,{makeDefault:!0,position:[0,0,3],rotation:[0,0,0]}),$.jsx(Jle,{temporal:!0,frames:200,color:"purple",colorBlend:.5,opacity:1,scale:10,alphaTest:.85,children:$.jsx(qle,{amount:8,radius:5,ambient:.5,position:[5,3,2],bias:.001})}),$.jsx(gL,{preset:"city",background:!0,blur:1}),$.jsxs("group",{ref:T,children:[$.jsx(idt,{visible:l,position:[u.x,u.y,u.z],scale:a,rotation:[0,0,t?0:-bJ]}),$.jsx("group",{castShadow:!0,receiveShadow:!0,position:[o.x,o.y,o.z],scale:s,rotation:[0,0,t?-bJ:0],children:_.map((E,R)=>$.jsx(ldt,{layer:R,squares:E,depth:-(R*f.paperDepth*S),settings:f},`layer-${R}`))})]})]})}const cdt=["wrist","thumbCMC","thumbMCP","thumbIP","thumbTip","indexMCP","indexPIP","indexDIP","indexTip","middleMCP","middlePIP","middleDIP","middleTip","ringMCP","ringPIP","ringDIP","ringTip","pinkyMCP","pinkyPIP","pinkyDIP","pinkyTip"];function hdt(n){if(!n)return null;const e={};return cdt.forEach((t,i)=>{e[t]=n[i]}),e}function ddt(n){const e=[n.wrist,n.indexMCP,n.middleMCP,n.ringMCP,n.pinkyMCP],t={x:0,y:0,z:0};return e.forEach(i=>{t.x+=i.x,t.y+=i.y,t.z+=i.z}),t.x/=e.length,t.y/=e.length,t.z/=e.length,t}function hSe(n,{xScale:e=4,yScale:t=3,zScale:i=5}={}){return new re((.5-n.x)*e,(.5-n.y)*t,-n.z*i)}const fdt={hands:[],left:null,right:null,primary:null,leftHandPosition:null,rightHandPosition:null,handPosition:null,leftHandLandmarks:null,rightHandLandmarks:null,landmarks:null};function pdt(n,{maxHands:e=1,xScale:t=4,yScale:i=3,zScale:r=5}={}){return G.useMemo(()=>{if(!n?.multiHandLandmarks?.length)return fdt;const s=n.multiHandLandmarks.map((c,d)=>{const f=hdt(c),m=ddt(f),y=hSe(m,{xScale:t,yScale:i,zScale:r});return{index:d,landmarks:f,rawLandmarks:c,palm:m,position:y}}),a=[...s].sort((c,d)=>c.position.x-d.position.x),o=a[0]??null,l=a[1]??null,u=e===1?s[0]??null:null;return{hands:s,left:o,right:l,primary:u,leftHandPosition:o?.position??null,rightHandPosition:l?.position??null,handPosition:u?.position??null,leftHandLandmarks:o?.landmarks??null,rightHandLandmarks:l?.landmarks??null,landmarks:u?.landmarks??null}},[n,e,t,i,r])}function mdt({hands:n,scale:{xScale:e,yScale:t,zScale:i}}){return G.useMemo(()=>n?.length?n.flatMap((s,a)=>Object.values(s.landmarks).map((o,l)=>({key:`${a}-${l}`,position:hSe(o,{xScale:e,yScale:t,zScale:i})}))):[],[n,e,t,i]).map(s=>$.jsx(FWe,{args:[.025,12,12],position:s.position,children:$.jsx("meshNormalMaterial",{})},s.key))}function Bx(n,e){return Math.hypot(n.x-e.x,n.y-e.y)}function gN(n,e,t){const i=n[e],r=n[t],s=n[0];return Bx(i,s)>Bx(r,s)}function gdt(n,e=.045){if(!n)return null;const t=n[4];return{index:Bx(t,n[8])<e,middle:Bx(t,n[12])<e,ring:Bx(t,n[16])<e,pinky:Bx(t,n[20])<e}}function ydt(n,{pinchDist:e=.05}={}){if(!n)return"IDLE";const t=n[4],i=n[8],r=gN(n,8,6),s=gN(n,12,10),a=gN(n,16,14),o=gN(n,20,18);return Bx(t,i)<e?"PINCH":!r&&s&&!a&&!o?"THE_BIRD":r&&!s&&!a&&o?"THE_HORNS":r&&s&&a&&o?"PALM_OPEN":!r&&!s&&!a&&!o?"GRAB":r&&!s&&!a&&!o?"POINT":r&&s&&!a&&!o?"VICTORY":"IDLE"}function vdt(n,{pinchDist:e=.05,fingerPinchDist:t=.045,swipeThreshold:i=.12,swipeCooldownMs:r=900,onLeftGestureStart:s,onLeftGestureEnd:a,onRightGestureStart:o,onRightGestureEnd:l,onGestureStart:u,onGestureEnd:c,onLeftFingerPinchStart:d,onLeftFingerPinchEnd:f,onRightFingerPinchStart:m,onRightFingerPinchEnd:y,onSwipeLeft:_,onSwipeRight:S}={}){const b=G.useRef({leftGesture:"IDLE",rightGesture:"IDLE",primaryGesture:"IDLE",leftPinches:{},rightPinches:{}}),M=G.useRef(null),w=G.useRef(0),T=G.useMemo(()=>{if(!n?.hands?.length)return null;const E=B=>{if(!B)return null;const N=B.rawLandmarks;return{pose:ydt(N,{pinchDist:e}),pinches:gdt(N,t)}},R=E(n.left),P=E(n.right),I=E(n.primary);return{left:R,right:P,primary:I,leftPose:R?.pose??"IDLE",rightPose:P?.pose??"IDLE",primaryPose:I?.pose??"IDLE"}},[n,e,t]);return G.useEffect(()=>{if(!T)return;function E(R,P,I,B){const N=b.current[R];N!==P&&(P!=="IDLE"&&I&&I(P,n),N!=="IDLE"&&B&&B(N,n),b.current[R]=P)}E("leftGesture",T.leftPose,s,a),E("rightGesture",T.rightPose,o,l),E("primaryGesture",T.primaryPose,u,c)},[T,n]),G.useEffect(()=>{if(!T)return;function E(R,P,I,B){const N=b.current[R]||{};P&&(["index","middle","ring","pinky"].forEach(U=>{const V=P[U],W=N[U]??!1;!W&&V&&I&&I(U,n),W&&!V&&B&&B(U,n),N[U]=V}),b.current[R]=N)}E("leftPinches",T.left?.pinches,d,f),E("rightPinches",T.right?.pinches,m,y)},[T,n]),G.useEffect(()=>{if(!T||!n)return;const E=Date.now(),R=n.right||n.left,P=n.right?T.rightPose:T.leftPose;if(!R||P!=="PALM_OPEN"){M.current=null;return}const I=R.rawLandmarks[9],B={x:I.x,y:I.y};if(M.current){const N=B.x-M.current.x;Math.abs(N)>i&&E-w.current>r&&(N>0&&S&&S(n),N<0&&_&&_(n),w.current=E)}M.current=B},[T,n]),{...T,left:T?.left,right:T?.right,primary:T?.primary,isPalmOpen:T?.leftPose==="PALM_OPEN"||T?.rightPose==="PALM_OPEN",isGrabbing:T?.leftPose==="GRAB"||T?.rightPose==="GRAB",isBird:T?.leftPose==="THE_BIRD"||T?.rightPose==="THE_BIRD",isHorns:T?.leftPose==="THE_HORNS"||T?.rightPose==="THE_HORNS"}}var WU={},SJ;function xdt(){return SJ||(SJ=1,(function(){function n(N){var U=0;return function(){return U<N.length?{done:!1,value:N[U++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(N,U,V){return N==Array.prototype||N==Object.prototype||(N[U]=V.value),N};function t(N){N=[typeof globalThis=="object"&&globalThis,N,typeof window=="object"&&window,typeof self=="object"&&self,typeof hM=="object"&&hM];for(var U=0;U<N.length;++U){var V=N[U];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var i=t(this);function r(N,U){if(U)e:{var V=i;N=N.split(".");for(var W=0;W<N.length-1;W++){var K=N[W];if(!(K in V))break e;V=V[K]}N=N[N.length-1],W=V[N],U=U(W),U!=W&&U!=null&&e(V,N,{configurable:!0,writable:!0,value:U})}}r("Symbol",function(N){function U(q){if(this instanceof U)throw new TypeError("Symbol is not a constructor");return new V(W+(q||"")+"_"+K++,q)}function V(q,j){this.g=q,e(this,"description",{configurable:!0,writable:!0,value:j})}if(N)return N;V.prototype.toString=function(){return this.g};var W="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",K=0;return U}),r("Symbol.iterator",function(N){if(N)return N;N=Symbol("Symbol.iterator");for(var U="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),V=0;V<U.length;V++){var W=i[U[V]];typeof W=="function"&&typeof W.prototype[N]!="function"&&e(W.prototype,N,{configurable:!0,writable:!0,value:function(){return s(n(this))}})}return N});function s(N){return N={next:N},N[Symbol.iterator]=function(){return this},N}function a(N){var U=typeof Symbol<"u"&&Symbol.iterator&&N[Symbol.iterator];return U?U.call(N):{next:n(N)}}function o(){this.i=!1,this.g=null,this.o=void 0,this.j=1,this.m=0,this.h=null}function l(N){if(N.i)throw new TypeError("Generator is already running");N.i=!0}o.prototype.l=function(N){this.o=N};function u(N,U){N.h={F:U,G:!0},N.j=N.m}o.prototype.return=function(N){this.h={return:N},this.j=this.m};function c(N){this.g=new o,this.h=N}function d(N,U){l(N.g);var V=N.g.g;return V?f(N,"return"in V?V.return:function(W){return{value:W,done:!0}},U,N.g.return):(N.g.return(U),m(N))}function f(N,U,V,W){try{var K=U.call(N.g.g,V);if(!(K instanceof Object))throw new TypeError("Iterator result "+K+" is not an object");if(!K.done)return N.g.i=!1,K;var q=K.value}catch(j){return N.g.g=null,u(N.g,j),m(N)}return N.g.g=null,W.call(N.g,q),m(N)}function m(N){for(;N.g.j;)try{var U=N.h(N.g);if(U)return N.g.i=!1,{value:U.value,done:!1}}catch(V){N.g.o=void 0,u(N.g,V)}if(N.g.i=!1,N.g.h){if(U=N.g.h,N.g.h=null,U.G)throw U.F;return{value:U.return,done:!0}}return{value:void 0,done:!0}}function y(N){this.next=function(U){return l(N.g),N.g.g?U=f(N,N.g.g.next,U,N.g.l):(N.g.l(U),U=m(N)),U},this.throw=function(U){return l(N.g),N.g.g?U=f(N,N.g.g.throw,U,N.g.l):(u(N.g,U),U=m(N)),U},this.return=function(U){return d(N,U)},this[Symbol.iterator]=function(){return this}}function _(N){function U(W){return N.next(W)}function V(W){return N.throw(W)}return new Promise(function(W,K){function q(j){j.done?W(j.value):Promise.resolve(j.value).then(U,V).then(q,K)}q(N.next())})}r("Promise",function(N){function U(j){this.h=0,this.i=void 0,this.g=[],this.o=!1;var te=this.j();try{j(te.resolve,te.reject)}catch(he){te.reject(he)}}function V(){this.g=null}function W(j){return j instanceof U?j:new U(function(te){te(j)})}if(N)return N;V.prototype.h=function(j){if(this.g==null){this.g=[];var te=this;this.i(function(){te.l()})}this.g.push(j)};var K=i.setTimeout;V.prototype.i=function(j){K(j,0)},V.prototype.l=function(){for(;this.g&&this.g.length;){var j=this.g;this.g=[];for(var te=0;te<j.length;++te){var he=j[te];j[te]=null;try{he()}catch(_e){this.j(_e)}}}this.g=null},V.prototype.j=function(j){this.i(function(){throw j})},U.prototype.j=function(){function j(_e){return function(Be){he||(he=!0,_e.call(te,Be))}}var te=this,he=!1;return{resolve:j(this.A),reject:j(this.l)}},U.prototype.A=function(j){if(j===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(j instanceof U)this.C(j);else{e:switch(typeof j){case"object":var te=j!=null;break e;case"function":te=!0;break e;default:te=!1}te?this.v(j):this.m(j)}},U.prototype.v=function(j){var te=void 0;try{te=j.then}catch(he){this.l(he);return}typeof te=="function"?this.D(te,j):this.m(j)},U.prototype.l=function(j){this.u(2,j)},U.prototype.m=function(j){this.u(1,j)},U.prototype.u=function(j,te){if(this.h!=0)throw Error("Cannot settle("+j+", "+te+"): Promise already settled in state"+this.h);this.h=j,this.i=te,this.h===2&&this.B(),this.H()},U.prototype.B=function(){var j=this;K(function(){if(j.I()){var te=i.console;typeof te<"u"&&te.error(j.i)}},1)},U.prototype.I=function(){if(this.o)return!1;var j=i.CustomEvent,te=i.Event,he=i.dispatchEvent;return typeof he>"u"?!0:(typeof j=="function"?j=new j("unhandledrejection",{cancelable:!0}):typeof te=="function"?j=new te("unhandledrejection",{cancelable:!0}):(j=i.document.createEvent("CustomEvent"),j.initCustomEvent("unhandledrejection",!1,!0,j)),j.promise=this,j.reason=this.i,he(j))},U.prototype.H=function(){if(this.g!=null){for(var j=0;j<this.g.length;++j)q.h(this.g[j]);this.g=null}};var q=new V;return U.prototype.C=function(j){var te=this.j();j.s(te.resolve,te.reject)},U.prototype.D=function(j,te){var he=this.j();try{j.call(te,he.resolve,he.reject)}catch(_e){he.reject(_e)}},U.prototype.then=function(j,te){function he(ce,Ce){return typeof ce=="function"?function(Oe){try{_e(ce(Oe))}catch(nt){Be(nt)}}:Ce}var _e,Be,ue=new U(function(ce,Ce){_e=ce,Be=Ce});return this.s(he(j,_e),he(te,Be)),ue},U.prototype.catch=function(j){return this.then(void 0,j)},U.prototype.s=function(j,te){function he(){switch(_e.h){case 1:j(_e.i);break;case 2:te(_e.i);break;default:throw Error("Unexpected state: "+_e.h)}}var _e=this;this.g==null?q.h(he):this.g.push(he),this.o=!0},U.resolve=W,U.reject=function(j){return new U(function(te,he){he(j)})},U.race=function(j){return new U(function(te,he){for(var _e=a(j),Be=_e.next();!Be.done;Be=_e.next())W(Be.value).s(te,he)})},U.all=function(j){var te=a(j),he=te.next();return he.done?W([]):new U(function(_e,Be){function ue(Oe){return function(nt){ce[Oe]=nt,Ce--,Ce==0&&_e(ce)}}var ce=[],Ce=0;do ce.push(void 0),Ce++,W(he.value).s(ue(ce.length-1),Be),he=te.next();while(!he.done)})},U});var S=typeof Object.assign=="function"?Object.assign:function(N,U){for(var V=1;V<arguments.length;V++){var W=arguments[V];if(W)for(var K in W)Object.prototype.hasOwnProperty.call(W,K)&&(N[K]=W[K])}return N};r("Object.assign",function(N){return N||S});var b=this||self,M={facingMode:"user",width:640,height:480};function w(N,U){this.video=N,this.i=0,this.h=Object.assign(Object.assign({},M),U)}w.prototype.stop=function(){var N=this,U,V,W,K;return _(new y(new c(function(q){if(N.g){for(U=N.g.getTracks(),V=a(U),W=V.next();!W.done;W=V.next())K=W.value,K.stop();N.g=void 0}q.j=0})))},w.prototype.start=function(){var N=this,U;return _(new y(new c(function(V){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||alert("No navigator.mediaDevices.getUserMedia exists."),U=N.h,V.return(navigator.mediaDevices.getUserMedia({video:{facingMode:U.facingMode,width:U.width,height:U.height}}).then(function(W){E(N,W)}).catch(function(W){var K="Failed to acquire camera feed: "+W;throw console.error(K),alert(K),W}))})))};function T(N){window.requestAnimationFrame(function(){R(N)})}function E(N,U){N.g=U,N.video.srcObject=U,N.video.onloadedmetadata=function(){N.video.play(),T(N)}}function R(N){var U=null;N.video.paused||N.video.currentTime===N.i||(N.i=N.video.currentTime,U=N.h.onFrame()),U?U.then(function(){T(N)}):T(N)}var P=["Camera"],I=b;P[0]in I||typeof I.execScript>"u"||I.execScript("var "+P[0]);for(var B;P.length&&(B=P.shift());)P.length||w===void 0?I[B]&&I[B]!==Object.prototype[B]?I=I[B]:I=I[B]={}:I[B]=w}).call(WU)),WU}var bdt=xdt(),ZU={},MJ;function _dt(){return MJ||(MJ=1,(function(){function n(y){var _=0;return function(){return _<y.length?{done:!1,value:y[_++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(y,_,S){return y==Array.prototype||y==Object.prototype||(y[_]=S.value),y};function t(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof hM=="object"&&hM];for(var _=0;_<y.length;++_){var S=y[_];if(S&&S.Math==Math)return S}throw Error("Cannot find global object")}var i=t(this);function r(y,_){if(_)e:{var S=i;y=y.split(".");for(var b=0;b<y.length-1;b++){var M=y[b];if(!(M in S))break e;S=S[M]}y=y[y.length-1],b=S[y],_=_(b),_!=b&&_!=null&&e(S,y,{configurable:!0,writable:!0,value:_})}}function s(y){var _=typeof Symbol<"u"&&Symbol.iterator&&y[Symbol.iterator];return _?_.call(y):{next:n(y)}}var a=typeof Object.assign=="function"?Object.assign:function(y,_){for(var S=1;S<arguments.length;S++){var b=arguments[S];if(b)for(var M in b)Object.prototype.hasOwnProperty.call(b,M)&&(y[M]=b[M])}return y};r("Object.assign",function(y){return y||a}),r("Array.prototype.fill",function(y){return y||function(_,S,b){var M=this.length||0;for(0>S&&(S=Math.max(0,M+S)),(b==null||b>M)&&(b=M),b=Number(b),0>b&&(b=Math.max(0,M+b)),S=Number(S||0);S<b;S++)this[S]=_;return this}});function o(y){return y||Array.prototype.fill}r("Int8Array.prototype.fill",o),r("Uint8Array.prototype.fill",o),r("Uint8ClampedArray.prototype.fill",o),r("Int16Array.prototype.fill",o),r("Uint16Array.prototype.fill",o),r("Int32Array.prototype.fill",o),r("Uint32Array.prototype.fill",o),r("Float32Array.prototype.fill",o),r("Float64Array.prototype.fill",o);var l=this||self;function u(y,_){y=y.split(".");var S=l;y[0]in S||typeof S.execScript>"u"||S.execScript("var "+y[0]);for(var b;y.length&&(b=y.shift());)y.length||_===void 0?S[b]&&S[b]!==Object.prototype[b]?S=S[b]:S=S[b]={}:S[b]=_}var c={color:"white",lineWidth:4,radius:6,visibilityMin:.5};function d(y){return y=y||{},Object.assign({},c,{fillColor:y.color},y)}function f(y,_){return y instanceof Function?y(_):y}function m(y,_,S){return Math.max(Math.min(_,S),Math.min(Math.max(_,S),y))}u("clamp",m),u("drawLandmarks",function(y,_,S){if(_){S=d(S),y.save();var b=y.canvas,M=0;_=s(_);for(var w=_.next();!w.done;w=_.next())if(w=w.value,w!==void 0&&(w.visibility===void 0||w.visibility>S.visibilityMin)){y.fillStyle=f(S.fillColor,{index:M,from:w}),y.strokeStyle=f(S.color,{index:M,from:w}),y.lineWidth=f(S.lineWidth,{index:M,from:w});var T=new Path2D;T.arc(w.x*b.width,w.y*b.height,f(S.radius,{index:M,from:w}),0,2*Math.PI),y.fill(T),y.stroke(T),++M}y.restore()}}),u("drawConnectors",function(y,_,S,b){if(_&&S){b=d(b),y.save();var M=y.canvas,w=0;S=s(S);for(var T=S.next();!T.done;T=S.next()){var E=T.value;y.beginPath(),T=_[E[0]],E=_[E[1]],T&&E&&(T.visibility===void 0||T.visibility>b.visibilityMin)&&(E.visibility===void 0||E.visibility>b.visibilityMin)&&(y.strokeStyle=f(b.color,{index:w,from:T,to:E}),y.lineWidth=f(b.lineWidth,{index:w,from:T,to:E}),y.moveTo(T.x*M.width,T.y*M.height),y.lineTo(E.x*M.width,E.y*M.height)),++w,y.stroke()}y.restore()}}),u("drawRectangle",function(y,_,S){S=d(S),y.save();var b=y.canvas;y.beginPath(),y.lineWidth=f(S.lineWidth,{}),y.strokeStyle=f(S.color,{}),y.fillStyle=f(S.fillColor,{}),y.translate(_.xCenter*b.width,_.yCenter*b.height),y.rotate(_.rotation*Math.PI/180),y.rect(-_.width/2*b.width,-_.height/2*b.height,_.width*b.width,_.height*b.height),y.translate(-_.xCenter*b.width,-_.yCenter*b.height),y.stroke(),y.fill(),y.restore()}),u("lerp",function(y,_,S,b,M){return m(b*(1-(y-_)/(S-_))+M*(1-(S-y)/(S-_)),b,M)})}).call(ZU)),ZU}var AJ=_dt(),jU={},TJ;function Sdt(){return TJ||(TJ=1,(function(){var n;function e(F){var H=0;return function(){return H<F.length?{done:!1,value:F[H++]}:{done:!0}}}var t=typeof Object.defineProperties=="function"?Object.defineProperty:function(F,H,J){return F==Array.prototype||F==Object.prototype||(F[H]=J.value),F};function i(F){F=[typeof globalThis=="object"&&globalThis,F,typeof window=="object"&&window,typeof self=="object"&&self,typeof hM=="object"&&hM];for(var H=0;H<F.length;++H){var J=F[H];if(J&&J.Math==Math)return J}throw Error("Cannot find global object")}var r=i(this);function s(F,H){if(H)e:{var J=r;F=F.split(".");for(var oe=0;oe<F.length-1;oe++){var Me=F[oe];if(!(Me in J))break e;J=J[Me]}F=F[F.length-1],oe=J[F],H=H(oe),H!=oe&&H!=null&&t(J,F,{configurable:!0,writable:!0,value:H})}}s("Symbol",function(F){function H(De){if(this instanceof H)throw new TypeError("Symbol is not a constructor");return new J(oe+(De||"")+"_"+Me++,De)}function J(De,Ee){this.h=De,t(this,"description",{configurable:!0,writable:!0,value:Ee})}if(F)return F;J.prototype.toString=function(){return this.h};var oe="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Me=0;return H}),s("Symbol.iterator",function(F){if(F)return F;F=Symbol("Symbol.iterator");for(var H="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),J=0;J<H.length;J++){var oe=r[H[J]];typeof oe=="function"&&typeof oe.prototype[F]!="function"&&t(oe.prototype,F,{configurable:!0,writable:!0,value:function(){return a(e(this))}})}return F});function a(F){return F={next:F},F[Symbol.iterator]=function(){return this},F}function o(F){var H=typeof Symbol<"u"&&Symbol.iterator&&F[Symbol.iterator];return H?H.call(F):{next:e(F)}}function l(F){if(!(F instanceof Array)){F=o(F);for(var H,J=[];!(H=F.next()).done;)J.push(H.value);F=J}return F}var u=typeof Object.assign=="function"?Object.assign:function(F,H){for(var J=1;J<arguments.length;J++){var oe=arguments[J];if(oe)for(var Me in oe)Object.prototype.hasOwnProperty.call(oe,Me)&&(F[Me]=oe[Me])}return F};s("Object.assign",function(F){return F||u});var c=typeof Object.create=="function"?Object.create:function(F){function H(){}return H.prototype=F,new H},d;if(typeof Object.setPrototypeOf=="function")d=Object.setPrototypeOf;else{var f;e:{var m={a:!0},y={};try{y.__proto__=m,f=y.a;break e}catch{}f=!1}d=f?function(F,H){if(F.__proto__=H,F.__proto__!==H)throw new TypeError(F+" is not extensible");return F}:null}var _=d;function S(F,H){if(F.prototype=c(H.prototype),F.prototype.constructor=F,_)_(F,H);else for(var J in H)if(J!="prototype")if(Object.defineProperties){var oe=Object.getOwnPropertyDescriptor(H,J);oe&&Object.defineProperty(F,J,oe)}else F[J]=H[J];F.ya=H.prototype}function b(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function M(F){if(F.m)throw new TypeError("Generator is already running");F.m=!0}b.prototype.u=function(F){this.i=F};function w(F,H){F.l={ma:H,na:!0},F.h=F.s||F.v}b.prototype.return=function(F){this.l={return:F},this.h=this.v};function T(F,H,J){return F.h=J,{value:H}}function E(F){this.h=new b,this.i=F}function R(F,H){M(F.h);var J=F.h.j;return J?P(F,"return"in J?J.return:function(oe){return{value:oe,done:!0}},H,F.h.return):(F.h.return(H),I(F))}function P(F,H,J,oe){try{var Me=H.call(F.h.j,J);if(!(Me instanceof Object))throw new TypeError("Iterator result "+Me+" is not an object");if(!Me.done)return F.h.m=!1,Me;var De=Me.value}catch(Ee){return F.h.j=null,w(F.h,Ee),I(F)}return F.h.j=null,oe.call(F.h,De),I(F)}function I(F){for(;F.h.h;)try{var H=F.i(F.h);if(H)return F.h.m=!1,{value:H.value,done:!1}}catch(J){F.h.i=void 0,w(F.h,J)}if(F.h.m=!1,F.h.l){if(H=F.h.l,F.h.l=null,H.na)throw H.ma;return{value:H.return,done:!0}}return{value:void 0,done:!0}}function B(F){this.next=function(H){return M(F.h),F.h.j?H=P(F,F.h.j.next,H,F.h.u):(F.h.u(H),H=I(F)),H},this.throw=function(H){return M(F.h),F.h.j?H=P(F,F.h.j.throw,H,F.h.u):(w(F.h,H),H=I(F)),H},this.return=function(H){return R(F,H)},this[Symbol.iterator]=function(){return this}}function N(F){function H(oe){return F.next(oe)}function J(oe){return F.throw(oe)}return new Promise(function(oe,Me){function De(Ee){Ee.done?oe(Ee.value):Promise.resolve(Ee.value).then(H,J).then(De,Me)}De(F.next())})}function U(F){return N(new B(new E(F)))}s("Promise",function(F){function H(Ee){this.i=0,this.j=void 0,this.h=[],this.u=!1;var qe=this.l();try{Ee(qe.resolve,qe.reject)}catch(bt){qe.reject(bt)}}function J(){this.h=null}function oe(Ee){return Ee instanceof H?Ee:new H(function(qe){qe(Ee)})}if(F)return F;J.prototype.i=function(Ee){if(this.h==null){this.h=[];var qe=this;this.j(function(){qe.m()})}this.h.push(Ee)};var Me=r.setTimeout;J.prototype.j=function(Ee){Me(Ee,0)},J.prototype.m=function(){for(;this.h&&this.h.length;){var Ee=this.h;this.h=[];for(var qe=0;qe<Ee.length;++qe){var bt=Ee[qe];Ee[qe]=null;try{bt()}catch(un){this.l(un)}}}this.h=null},J.prototype.l=function(Ee){this.j(function(){throw Ee})},H.prototype.l=function(){function Ee(un){return function(Cn){bt||(bt=!0,un.call(qe,Cn))}}var qe=this,bt=!1;return{resolve:Ee(this.I),reject:Ee(this.m)}},H.prototype.I=function(Ee){if(Ee===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(Ee instanceof H)this.L(Ee);else{e:switch(typeof Ee){case"object":var qe=Ee!=null;break e;case"function":qe=!0;break e;default:qe=!1}qe?this.F(Ee):this.s(Ee)}},H.prototype.F=function(Ee){var qe=void 0;try{qe=Ee.then}catch(bt){this.m(bt);return}typeof qe=="function"?this.M(qe,Ee):this.s(Ee)},H.prototype.m=function(Ee){this.v(2,Ee)},H.prototype.s=function(Ee){this.v(1,Ee)},H.prototype.v=function(Ee,qe){if(this.i!=0)throw Error("Cannot settle("+Ee+", "+qe+"): Promise already settled in state"+this.i);this.i=Ee,this.j=qe,this.i===2&&this.K(),this.H()},H.prototype.K=function(){var Ee=this;Me(function(){if(Ee.D()){var qe=r.console;typeof qe<"u"&&qe.error(Ee.j)}},1)},H.prototype.D=function(){if(this.u)return!1;var Ee=r.CustomEvent,qe=r.Event,bt=r.dispatchEvent;return typeof bt>"u"?!0:(typeof Ee=="function"?Ee=new Ee("unhandledrejection",{cancelable:!0}):typeof qe=="function"?Ee=new qe("unhandledrejection",{cancelable:!0}):(Ee=r.document.createEvent("CustomEvent"),Ee.initCustomEvent("unhandledrejection",!1,!0,Ee)),Ee.promise=this,Ee.reason=this.j,bt(Ee))},H.prototype.H=function(){if(this.h!=null){for(var Ee=0;Ee<this.h.length;++Ee)De.i(this.h[Ee]);this.h=null}};var De=new J;return H.prototype.L=function(Ee){var qe=this.l();Ee.T(qe.resolve,qe.reject)},H.prototype.M=function(Ee,qe){var bt=this.l();try{Ee.call(qe,bt.resolve,bt.reject)}catch(un){bt.reject(un)}},H.prototype.then=function(Ee,qe){function bt(oi,Gn){return typeof oi=="function"?function(vi){try{un(oi(vi))}catch(Hi){Cn(Hi)}}:Gn}var un,Cn,fi=new H(function(oi,Gn){un=oi,Cn=Gn});return this.T(bt(Ee,un),bt(qe,Cn)),fi},H.prototype.catch=function(Ee){return this.then(void 0,Ee)},H.prototype.T=function(Ee,qe){function bt(){switch(un.i){case 1:Ee(un.j);break;case 2:qe(un.j);break;default:throw Error("Unexpected state: "+un.i)}}var un=this;this.h==null?De.i(bt):this.h.push(bt),this.u=!0},H.resolve=oe,H.reject=function(Ee){return new H(function(qe,bt){bt(Ee)})},H.race=function(Ee){return new H(function(qe,bt){for(var un=o(Ee),Cn=un.next();!Cn.done;Cn=un.next())oe(Cn.value).T(qe,bt)})},H.all=function(Ee){var qe=o(Ee),bt=qe.next();return bt.done?oe([]):new H(function(un,Cn){function fi(vi){return function(Hi){oi[vi]=Hi,Gn--,Gn==0&&un(oi)}}var oi=[],Gn=0;do oi.push(void 0),Gn++,oe(bt.value).T(fi(oi.length-1),Cn),bt=qe.next();while(!bt.done)})},H});function V(F,H){F instanceof String&&(F+="");var J=0,oe=!1,Me={next:function(){if(!oe&&J<F.length){var De=J++;return{value:H(De,F[De]),done:!1}}return oe=!0,{done:!0,value:void 0}}};return Me[Symbol.iterator]=function(){return Me},Me}s("Array.prototype.keys",function(F){return F||function(){return V(this,function(H){return H})}}),s("Array.prototype.fill",function(F){return F||function(H,J,oe){var Me=this.length||0;for(0>J&&(J=Math.max(0,Me+J)),(oe==null||oe>Me)&&(oe=Me),oe=Number(oe),0>oe&&(oe=Math.max(0,Me+oe)),J=Number(J||0);J<oe;J++)this[J]=H;return this}});function W(F){return F||Array.prototype.fill}s("Int8Array.prototype.fill",W),s("Uint8Array.prototype.fill",W),s("Uint8ClampedArray.prototype.fill",W),s("Int16Array.prototype.fill",W),s("Uint16Array.prototype.fill",W),s("Int32Array.prototype.fill",W),s("Uint32Array.prototype.fill",W),s("Float32Array.prototype.fill",W),s("Float64Array.prototype.fill",W),s("Object.is",function(F){return F||function(H,J){return H===J?H!==0||1/H===1/J:H!==H&&J!==J}}),s("Array.prototype.includes",function(F){return F||function(H,J){var oe=this;oe instanceof String&&(oe=String(oe));var Me=oe.length;for(J=J||0,0>J&&(J=Math.max(J+Me,0));J<Me;J++){var De=oe[J];if(De===H||Object.is(De,H))return!0}return!1}}),s("String.prototype.includes",function(F){return F||function(H,J){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(H instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(H,J||0)!==-1}});var K=this||self;function q(F,H){F=F.split(".");var J=K;F[0]in J||typeof J.execScript>"u"||J.execScript("var "+F[0]);for(var oe;F.length&&(oe=F.shift());)F.length||H===void 0?J[oe]&&J[oe]!==Object.prototype[oe]?J=J[oe]:J=J[oe]={}:J[oe]=H}function j(F){var H;e:{if((H=K.navigator)&&(H=H.userAgent))break e;H=""}return H.indexOf(F)!=-1}var te=Array.prototype.map?function(F,H){return Array.prototype.map.call(F,H,void 0)}:function(F,H){for(var J=F.length,oe=Array(J),Me=typeof F=="string"?F.split(""):F,De=0;De<J;De++)De in Me&&(oe[De]=H.call(void 0,Me[De],De,F));return oe},he={},_e=null;function Be(F){var H=F.length,J=3*H/4;J%3?J=Math.floor(J):"=.".indexOf(F[H-1])!=-1&&(J="=.".indexOf(F[H-2])!=-1?J-2:J-1);var oe=new Uint8Array(J),Me=0;return ue(F,function(De){oe[Me++]=De}),Me!==J?oe.subarray(0,Me):oe}function ue(F,H){function J(bt){for(;oe<F.length;){var un=F.charAt(oe++),Cn=_e[un];if(Cn!=null)return Cn;if(!/^[\s\xa0]*$/.test(un))throw Error("Unknown base64 encoding at char: "+un)}return bt}ce();for(var oe=0;;){var Me=J(-1),De=J(0),Ee=J(64),qe=J(64);if(qe===64&&Me===-1)break;H(Me<<2|De>>4),Ee!=64&&(H(De<<4&240|Ee>>2),qe!=64&&H(Ee<<6&192|qe))}}function ce(){if(!_e){_e={};for(var F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),H=["+/=","+/","-_=","-_.","-_"],J=0;5>J;J++){var oe=F.concat(H[J].split(""));he[J]=oe;for(var Me=0;Me<oe.length;Me++){var De=oe[Me];_e[De]===void 0&&(_e[De]=Me)}}}}var Ce=typeof Uint8Array<"u",Oe=!(j("Trident")||j("MSIE"))&&typeof K.btoa=="function";function nt(F){if(!Oe){var H;H===void 0&&(H=0),ce(),H=he[H];for(var J=Array(Math.floor(F.length/3)),oe=H[64]||"",Me=0,De=0;Me<F.length-2;Me+=3){var Ee=F[Me],qe=F[Me+1],bt=F[Me+2],un=H[Ee>>2];Ee=H[(Ee&3)<<4|qe>>4],qe=H[(qe&15)<<2|bt>>6],bt=H[bt&63],J[De++]=un+Ee+qe+bt}switch(un=0,bt=oe,F.length-Me){case 2:un=F[Me+1],bt=H[(un&15)<<2]||oe;case 1:F=F[Me],J[De]=H[F>>2]+H[(F&3)<<4|un>>4]+bt+oe}return J.join("")}for(H="";10240<F.length;)H+=String.fromCharCode.apply(null,F.subarray(0,10240)),F=F.subarray(10240);return H+=String.fromCharCode.apply(null,F),btoa(H)}var Ae=RegExp("[-_.]","g");function Ye(F){switch(F){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function ft(F){if(!Oe)return Be(F);Ae.test(F)&&(F=F.replace(Ae,Ye)),F=atob(F);for(var H=new Uint8Array(F.length),J=0;J<F.length;J++)H[J]=F.charCodeAt(J);return H}var ze;function ot(){return ze||(ze=new Uint8Array(0))}var ut={},Wt=typeof Uint8Array.prototype.slice=="function",It=0,ke=0;function je(F){var H=0>F;F=Math.abs(F);var J=F>>>0;F=Math.floor((F-J)/4294967296),H&&(J=o(yt(J,F)),H=J.next().value,F=J.next().value,J=H),It=J>>>0,ke=F>>>0}var gt=typeof BigInt=="function";function yt(F,H){return H=~H,F?F=~F+1:H+=1,[F,H]}function ve(F,H){this.i=F>>>0,this.h=H>>>0}function An(F){if(!F)return cn||(cn=new ve(0,0));if(!/^-?\d+$/.test(F))return null;if(16>F.length)je(Number(F));else if(gt)F=BigInt(F),It=Number(F&BigInt(4294967295))>>>0,ke=Number(F>>BigInt(32)&BigInt(4294967295));else{var H=+(F[0]==="-");ke=It=0;for(var J=F.length,oe=H,Me=(J-H)%6+H;Me<=J;oe=Me,Me+=6)oe=Number(F.slice(oe,Me)),ke*=1e6,It=1e6*It+oe,4294967296<=It&&(ke+=It/4294967296|0,It%=4294967296);H&&(H=o(yt(It,ke)),F=H.next().value,H=H.next().value,It=F,ke=H)}return new ve(It,ke)}var cn;function In(F,H){return Error("Invalid wire type: "+F+" (at position "+H+")")}function Zt(){return Error("Failed to read varint, encoding is invalid.")}function le(F,H){return Error("Tried to read past the end of the data "+H+" > "+F)}function ee(){throw Error("Invalid UTF8")}function Re(F,H){return H=String.fromCharCode.apply(null,H),F==null?H:F+H}var tt=void 0,et,at=typeof TextDecoder<"u",jt,rn=typeof TextEncoder<"u",Nn;function Fn(F){if(F!==ut)throw Error("illegal external caller")}function Gt(F,H){if(Fn(H),this.V=F,F!=null&&F.length===0)throw Error("ByteString should be constructed with non-empty values")}function st(){return Nn||(Nn=new Gt(null,ut))}function Ft(F){Fn(ut);var H=F.V;return H=H==null||Ce&&H!=null&&H instanceof Uint8Array?H:typeof H=="string"?ft(H):null,H==null?H:F.V=H}function Se(F){if(typeof F=="string")return{buffer:ft(F),C:!1};if(Array.isArray(F))return{buffer:new Uint8Array(F),C:!1};if(F.constructor===Uint8Array)return{buffer:F,C:!1};if(F.constructor===ArrayBuffer)return{buffer:new Uint8Array(F),C:!1};if(F.constructor===Gt)return{buffer:Ft(F)||ot(),C:!0};if(F instanceof Uint8Array)return{buffer:new Uint8Array(F.buffer,F.byteOffset,F.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Je(F,H){this.i=null,this.m=!1,this.h=this.j=this.l=0,St(this,F,H)}function St(F,H,J){J=J===void 0?{}:J,F.S=J.S===void 0?!1:J.S,H&&(H=Se(H),F.i=H.buffer,F.m=H.C,F.l=0,F.j=F.i.length,F.h=F.l)}Je.prototype.reset=function(){this.h=this.l};function Ne(F,H){if(F.h=H,H>F.j)throw le(F.j,H)}function it(F){var H=F.i,J=F.h,oe=H[J++],Me=oe&127;if(oe&128&&(oe=H[J++],Me|=(oe&127)<<7,oe&128&&(oe=H[J++],Me|=(oe&127)<<14,oe&128&&(oe=H[J++],Me|=(oe&127)<<21,oe&128&&(oe=H[J++],Me|=oe<<28,oe&128&&H[J++]&128&&H[J++]&128&&H[J++]&128&&H[J++]&128&&H[J++]&128)))))throw Zt();return Ne(F,J),Me}function kt(F,H){if(0>H)throw Error("Tried to read a negative byte length: "+H);var J=F.h,oe=J+H;if(oe>F.j)throw le(H,F.j-J);return F.h=oe,J}var vn=[];function Kt(){this.h=[]}Kt.prototype.length=function(){return this.h.length},Kt.prototype.end=function(){var F=this.h;return this.h=[],F};function Ut(F,H,J){for(;0<J||127<H;)F.h.push(H&127|128),H=(H>>>7|J<<25)>>>0,J>>>=7;F.h.push(H)}function z(F,H){for(;127<H;)F.h.push(H&127|128),H>>>=7;F.h.push(H)}function se(F,H){if(vn.length){var J=vn.pop();St(J,F,H),F=J}else F=new Je(F,H);this.h=F,this.j=this.h.h,this.i=this.l=-1,this.setOptions(H)}se.prototype.setOptions=function(F){F=F===void 0?{}:F,this.ca=F.ca===void 0?!1:F.ca},se.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function ne(F){var H=F.h;if(H.h==H.j)return!1;F.j=F.h.h;var J=it(F.h)>>>0;if(H=J>>>3,J&=7,!(0<=J&&5>=J))throw In(J,F.j);if(1>H)throw Error("Invalid field number: "+H+" (at position "+F.j+")");return F.l=H,F.i=J,!0}function ae(F){switch(F.i){case 0:if(F.i!=0)ae(F);else e:{F=F.h;for(var H=F.h,J=H+10,oe=F.i;H<J;)if((oe[H++]&128)===0){Ne(F,H);break e}throw Zt()}break;case 1:F=F.h,Ne(F,F.h+8);break;case 2:F.i!=2?ae(F):(H=it(F.h)>>>0,F=F.h,Ne(F,F.h+H));break;case 5:F=F.h,Ne(F,F.h+4);break;case 3:H=F.l;do{if(!ne(F))throw Error("Unmatched start-group tag: stream EOF");if(F.i==4){if(F.l!=H)throw Error("Unmatched end-group tag");break}ae(F)}while(!0);break;default:throw In(F.i,F.j)}}var be=[];function pt(){this.j=[],this.i=0,this.h=new Kt}function Bt(F,H){H.length!==0&&(F.j.push(H),F.i+=H.length)}function tn(F,H){if(H=H.R){Bt(F,F.h.end());for(var J=0;J<H.length;J++)Bt(F,Ft(H[J])||ot())}}var Tn=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function yi(F,H){return Tn?F[Tn]|=H:F.A!==void 0?F.A|=H:(Object.defineProperties(F,{A:{value:H,configurable:!0,writable:!0,enumerable:!1}}),H)}function er(F,H){Tn?F[Tn]&&(F[Tn]&=~H):F.A!==void 0&&(F.A&=~H)}function Vi(F){var H;return Tn?H=F[Tn]:H=F.A,H??0}function Zn(F,H){Tn?F[Tn]=H:F.A!==void 0?F.A=H:Object.defineProperties(F,{A:{value:H,configurable:!0,writable:!0,enumerable:!1}})}function Xs(F){return yi(F,1),F}function es(F,H){Zn(H,(F|0)&-51)}function ie(F,H){Zn(H,(F|18)&-41)}var ye={};function Ue(F){return F!==null&&typeof F=="object"&&!Array.isArray(F)&&F.constructor===Object}var dt,Ct=[];Zn(Ct,23),dt=Object.freeze(Ct);function wt(F){if(Vi(F.o)&2)throw Error("Cannot mutate an immutable Message")}function sn(F){var H=F.length;(H=H?F[H-1]:void 0)&&Ue(H)?H.g=1:(H={},F.push((H.g=1,H)))}function Qt(F){var H=F.i+F.G;return F.B||(F.B=F.o[H]={})}function on(F,H){return H===-1?null:H>=F.i?F.B?F.B[H]:void 0:F.o[H+F.G]}function ln(F,H,J,oe){wt(F),gn(F,H,J,oe)}function gn(F,H,J,oe){F.j&&(F.j=void 0),H>=F.i||oe?Qt(F)[H]=J:(F.o[H+F.G]=J,(F=F.B)&&H in F&&delete F[H])}function fn(F,H,J,oe){var Me=on(F,H);Array.isArray(Me)||(Me=dt);var De=Vi(Me);if(De&1||Xs(Me),oe)De&2||yi(Me,2),J&1||Object.freeze(Me);else{oe=!(J&2);var Ee=De&2;J&1||!Ee?oe&&De&16&&!Ee&&er(Me,16):(Me=Xs(Array.prototype.slice.call(Me)),gn(F,H,Me))}return Me}function de(F,H){var J=on(F,H),oe=J==null?J:typeof J=="number"||J==="NaN"||J==="Infinity"||J==="-Infinity"?Number(J):void 0;return oe!=null&&oe!==J&&gn(F,H,oe),oe}function Fe(F,H,J,oe,Me){F.h||(F.h={});var De=F.h[J],Ee=fn(F,J,3,Me);if(!De){var qe=Ee;De=[];var bt=!!(Vi(F.o)&16);Ee=!!(Vi(qe)&2);var un=qe;!Me&&Ee&&(qe=Array.prototype.slice.call(qe));for(var Cn=Ee,fi=0;fi<qe.length;fi++){var oi=qe[fi],Gn=H,vi=!1;if(vi=vi===void 0?!1:vi,oi=Array.isArray(oi)?new Gn(oi):vi?new Gn:void 0,oi!==void 0){Gn=oi.o;var Hi=vi=Vi(Gn);Ee&&(Hi|=2),bt&&(Hi|=16),Hi!=vi&&Zn(Gn,Hi),Gn=Hi,Cn=Cn||!!(2&Gn),De.push(oi)}}return F.h[J]=De,bt=Vi(qe),H=bt|33,H=Cn?H&-9:H|8,bt!=H&&(Cn=qe,Object.isFrozen(Cn)&&(Cn=Array.prototype.slice.call(Cn)),Zn(Cn,H),qe=Cn),un!==qe&&gn(F,J,qe),(Me||oe&&Ee)&&yi(De,2),oe&&Object.freeze(De),De}return Me||(Me=Object.isFrozen(De),oe&&!Me?Object.freeze(De):!oe&&Me&&(De=Array.prototype.slice.call(De),F.h[J]=De)),De}function $e(F,H,J){var oe=!!(Vi(F.o)&2);if(H=Fe(F,H,J,oe,oe),F=fn(F,J,3,oe),!(oe||Vi(F)&8)){for(oe=0;oe<H.length;oe++){if(J=H[oe],Vi(J.o)&2){var Me=On(J,!1);Me.j=J}else Me=J;J!==Me&&(H[oe]=Me,F[oe]=Me.o)}yi(F,8)}return H}function Ke(F,H,J){if(J!=null&&typeof J!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof J+": "+J);ln(F,H,J)}function Ze(F,H,J,oe,Me){wt(F);var De=Fe(F,J,H,!1,!1);return J=oe??new J,F=fn(F,H,2,!1),Me!=null?(De.splice(Me,0,J),F.splice(Me,0,J.o)):(De.push(J),F.push(J.o)),J.C()&&er(F,8),J}function zt(F,H){return F??H}function Jt(F,H,J){return J=J===void 0?0:J,zt(de(F,H),J)}var Vt;function Rn(F){switch(typeof F){case"number":return isFinite(F)?F:String(F);case"object":if(F)if(Array.isArray(F)){if((Vi(F)&128)!==0)return F=Array.prototype.slice.call(F),sn(F),F}else{if(Ce&&F!=null&&F instanceof Uint8Array)return nt(F);if(F instanceof Gt){var H=F.V;return H==null?"":typeof H=="string"?H:F.V=nt(H)}}}return F}function yn(F,H,J,oe){if(F!=null){if(Array.isArray(F))F=jn(F,H,J,oe!==void 0);else if(Ue(F)){var Me={},De;for(De in F)Me[De]=yn(F[De],H,J,oe);F=Me}else F=H(F,oe);return F}}function jn(F,H,J,oe){var Me=Vi(F);oe=oe?!!(Me&16):void 0,F=Array.prototype.slice.call(F);for(var De=0;De<F.length;De++)F[De]=yn(F[De],H,J,oe);return J(Me,F),F}function bn(F){return F.ja===ye?F.toJSON():Rn(F)}function zn(F,H){F&128&&sn(H)}function Bi(F,H,J){if(J=J===void 0?ie:J,F!=null){if(Ce&&F instanceof Uint8Array)return F.length?new Gt(new Uint8Array(F),ut):st();if(Array.isArray(F)){var oe=Vi(F);return oe&2?F:H&&!(oe&32)&&(oe&16||oe===0)?(Zn(F,oe|2),F):(F=jn(F,Bi,oe&4?ie:J,!0),H=Vi(F),H&4&&H&2&&Object.freeze(F),F)}return F.ja===ye?Oi(F):F}}function _r(F,H,J,oe,Me,De,Ee){if(F=F.h&&F.h[J]){if(oe=Vi(F),oe&2?oe=F:(De=te(F,Oi),ie(oe,De),Object.freeze(De),oe=De),wt(H),Ee=oe==null?dt:Xs([]),oe!=null){for(De=!!oe.length,F=0;F<oe.length;F++){var qe=oe[F];De=De&&!(Vi(qe.o)&2),Ee[F]=qe.o}De=(De?8:0)|1,F=Vi(Ee),(F&De)!==De&&(Object.isFrozen(Ee)&&(Ee=Array.prototype.slice.call(Ee)),Zn(Ee,F|De)),H.h||(H.h={}),H.h[J]=oe}else H.h&&(H.h[J]=void 0);gn(H,J,Ee,Me)}else ln(H,J,Bi(oe,De,Ee),Me)}function Oi(F){return Vi(F.o)&2||(F=On(F,!0),yi(F.o,2)),F}function On(F,H){var J=F.o,oe=[];yi(oe,16);var Me=F.constructor.h;if(Me&&oe.push(Me),Me=F.B,Me){oe.length=J.length,oe.fill(void 0,oe.length,J.length);var De={};oe[oe.length-1]=De}(Vi(J)&128)!==0&&sn(oe),H=H||F.C()?ie:es,De=F.constructor,Vt=oe,oe=new De(oe),Vt=void 0,F.R&&(oe.R=F.R.slice()),De=!!(Vi(J)&16);for(var Ee=Me?J.length-1:J.length,qe=0;qe<Ee;qe++)_r(F,oe,qe-F.G,J[qe],!1,De,H);if(Me)for(var bt in Me)_r(F,oe,+bt,Me[bt],!0,De,H);return oe}function qt(F,H,J){F==null&&(F=Vt),Vt=void 0;var oe=this.constructor.i||0,Me=0<oe,De=this.constructor.h,Ee=!1;if(F==null){F=De?[De]:[];var qe=48,bt=!0;Me&&(oe=0,qe|=128),Zn(F,qe)}else{if(!Array.isArray(F)||De&&De!==F[0])throw Error();var un=qe=yi(F,0);if((bt=(16&un)!==0)&&((Ee=(32&un)!==0)||(un|=32)),Me){if(128&un)oe=0;else if(0<F.length){var Cn=F[F.length-1];if(Ue(Cn)&&"g"in Cn){oe=0,un|=128,delete Cn.g;var fi=!0,oi;for(oi in Cn){fi=!1;break}fi&&F.pop()}}}else if(128&un)throw Error();qe!==un&&Zn(F,un)}this.G=(De?0:-1)-oe,this.h=void 0,this.o=F;e:{if(De=this.o.length,oe=De-1,De&&(De=this.o[oe],Ue(De))){this.B=De,this.i=oe-this.G;break e}H!==void 0&&-1<H?(this.i=Math.max(H,oe+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!Me&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(J){H=bt&&!Ee&&!0,Me=this.i;var Gn;for(bt=0;bt<J.length;bt++)Ee=J[bt],Ee<Me?(Ee+=this.G,(oe=F[Ee])?ei(oe,H):F[Ee]=dt):(Gn||(Gn=Qt(this)),(oe=Gn[Ee])?ei(oe,H):Gn[Ee]=dt)}}qt.prototype.toJSON=function(){return jn(this.o,bn,zn)},qt.prototype.C=function(){return!!(Vi(this.o)&2)};function ei(F,H){if(Array.isArray(F)){var J=Vi(F),oe=1;!H||J&2||(oe|=16),(J&oe)!==oe&&Zn(F,J|oe)}}qt.prototype.ja=ye,qt.prototype.toString=function(){return this.o.toString()};function Bn(F,H,J){if(J){var oe={},Me;for(Me in J){var De=J[Me],Ee=De.qa;Ee||(oe.J=De.wa||De.oa.W,De.ia?(oe.aa=la(De.ia),Ee=(function(qe){return function(bt,un,Cn){return qe.J(bt,un,Cn,qe.aa)}})(oe)):De.ka?(oe.Z=Te(De.da.P,De.ka),Ee=(function(qe){return function(bt,un,Cn){return qe.J(bt,un,Cn,qe.Z)}})(oe)):Ee=oe.J,De.qa=Ee),Ee(H,F,De.da),oe={J:oe.J,aa:oe.aa,Z:oe.Z}}}tn(H,F)}var tr=Symbol();function qs(F,H,J){return F[tr]||(F[tr]=function(oe,Me){return H(oe,Me,J)})}function Wi(F){var H=F[tr];if(!H){var J=Jc(F);H=function(oe,Me){return hc(oe,Me,J)},F[tr]=H}return H}function Ss(F){var H=F.ia;if(H)return Wi(H);if(H=F.va)return qs(F.da.P,H,F.ka)}function Lr(F){var H=Ss(F),J=F.da,oe=F.oa.U;return H?function(Me,De){return oe(Me,De,J,H)}:function(Me,De){return oe(Me,De,J)}}function Qs(F,H){var J=F[H];return typeof J=="function"&&J.length===0&&(J=J(),F[H]=J),Array.isArray(J)&&(uc in J||ai in J||0<J.length&&typeof J[0]=="function")?J:void 0}function Ws(F,H,J,oe,Me,De){H.P=F[0];var Ee=1;if(F.length>Ee&&typeof F[Ee]!="number"){var qe=F[Ee++];J(H,qe)}for(;Ee<F.length;){J=F[Ee++];for(var bt=Ee+1;bt<F.length&&typeof F[bt]!="number";)bt++;switch(qe=F[Ee++],bt-=Ee,bt){case 0:oe(H,J,qe);break;case 1:(bt=Qs(F,Ee))?(Ee++,Me(H,J,qe,bt)):oe(H,J,qe,F[Ee++]);break;case 2:bt=Ee++,bt=Qs(F,bt),Me(H,J,qe,bt,F[Ee++]);break;case 3:De(H,J,qe,F[Ee++],F[Ee++],F[Ee++]);break;case 4:De(H,J,qe,F[Ee++],F[Ee++],F[Ee++],F[Ee++]);break;default:throw Error("unexpected number of binary field arguments: "+bt)}}return H}var Zs=Symbol();function la(F){var H=F[Zs];if(!H){var J=ql(F);H=function(oe,Me){return Yo(oe,Me,J)},F[Zs]=H}return H}function Te(F,H){var J=F[Zs];return J||(J=function(oe,Me){return Bn(oe,Me,H)},F[Zs]=J),J}var ai=Symbol();function $c(F,H){F.push(H)}function jo(F,H,J){F.push(H,J.W)}function lc(F,H,J,oe){var Me=la(oe),De=ql(oe).P,Ee=J.W;F.push(H,function(qe,bt,un){return Ee(qe,bt,un,De,Me)})}function $n(F,H,J,oe,Me,De){var Ee=Te(oe,De),qe=J.W;F.push(H,function(bt,un,Cn){return qe(bt,un,Cn,oe,Ee)})}function ql(F){var H=F[ai];return H||(H=Ws(F,F[ai]=[],$c,jo,lc,$n),uc in F&&ai in F&&(F.length=0),H)}var uc=Symbol();function cc(F,H){F[0]=H}function Ui(F,H,J,oe){var Me=J.U;F[H]=oe?function(De,Ee,qe){return Me(De,Ee,qe,oe)}:Me}function Pl(F,H,J,oe,Me){var De=J.U,Ee=Wi(oe),qe=Jc(oe).P;F[H]=function(bt,un,Cn){return De(bt,un,Cn,qe,Ee,Me)}}function op(F,H,J,oe,Me,De,Ee){var qe=J.U,bt=qs(oe,Me,De);F[H]=function(un,Cn,fi){return qe(un,Cn,fi,oe,bt,Ee)}}function Jc(F){var H=F[uc];return H||(H=Ws(F,F[uc]={},cc,Ui,Pl,op),uc in F&&ai in F&&(F.length=0),H)}function hc(F,H,J){for(;ne(H)&&H.i!=4;){var oe=H.l,Me=J[oe];if(!Me){var De=J[0];De&&(De=De[oe])&&(Me=J[oe]=Lr(De))}if(!Me||!Me(H,F,oe)){Me=H,oe=F,De=Me.j,ae(Me);var Ee=Me;if(!Ee.ca){if(Me=Ee.h.h-De,Ee.h.h=De,Ee=Ee.h,Me==0)Me=st();else{if(De=kt(Ee,Me),Ee.S&&Ee.m)Me=Ee.i.subarray(De,De+Me);else{Ee=Ee.i;var qe=De;Me=De+Me,Me=qe===Me?ot():Wt?Ee.slice(qe,Me):new Uint8Array(Ee.subarray(qe,Me))}Me=Me.length==0?st():new Gt(Me,ut)}(De=oe.R)?De.push(Me):oe.R=[Me]}}}return F}function Yo(F,H,J){for(var oe=J.length,Me=oe%2==1,De=Me?1:0;De<oe;De+=2)(0,J[De+1])(H,F,J[De]);Bn(F,H,Me?J[0]:void 0)}function ni(F,H){return{U:F,W:H}}var to=ni(function(F,H,J){if(F.i!==5)return!1;F=F.h;var oe=F.i,Me=F.h,De=oe[Me],Ee=oe[Me+1],qe=oe[Me+2];return oe=oe[Me+3],Ne(F,F.h+4),Ee=(De<<0|Ee<<8|qe<<16|oe<<24)>>>0,F=2*(Ee>>31)+1,De=Ee>>>23&255,Ee&=8388607,ln(H,J,De==255?Ee?NaN:1/0*F:De==0?F*Math.pow(2,-149)*Ee:F*Math.pow(2,De-150)*(Ee+Math.pow(2,23))),!0},function(F,H,J){if(H=de(H,J),H!=null){z(F.h,8*J+5),F=F.h;var oe=+H;oe===0?0<1/oe?It=ke=0:(ke=0,It=2147483648):isNaN(oe)?(ke=0,It=2147483647):(oe=(J=0>oe?-2147483648:0)?-oe:oe,34028234663852886e22<oe?(ke=0,It=(J|2139095040)>>>0):11754943508222875e-54>oe?(oe=Math.round(oe/Math.pow(2,-149)),ke=0,It=(J|oe)>>>0):(H=Math.floor(Math.log(oe)/Math.LN2),oe*=Math.pow(2,-H),oe=Math.round(8388608*oe),16777216<=oe&&++H,ke=0,It=(J|H+127<<23|oe&8388607)>>>0)),J=It,F.h.push(J>>>0&255),F.h.push(J>>>8&255),F.h.push(J>>>16&255),F.h.push(J>>>24&255)}}),Ro=ni(function(F,H,J){if(F.i!==0)return!1;var oe=F.h,Me=0,De=F=0,Ee=oe.i,qe=oe.h;do{var bt=Ee[qe++];Me|=(bt&127)<<De,De+=7}while(32>De&&bt&128);for(32<De&&(F|=(bt&127)>>4),De=3;32>De&&bt&128;De+=7)bt=Ee[qe++],F|=(bt&127)<<De;if(Ne(oe,qe),128>bt)oe=Me>>>0,bt=F>>>0,(F=bt&2147483648)&&(oe=~oe+1>>>0,bt=~bt>>>0,oe==0&&(bt=bt+1>>>0)),oe=4294967296*bt+(oe>>>0);else throw Zt();return ln(H,J,F?-oe:oe),!0},function(F,H,J){H=on(H,J),H!=null&&(typeof H=="string"&&An(H),H!=null&&(z(F.h,8*J),typeof H=="number"?(F=F.h,je(H),Ut(F,It,ke)):(J=An(H),Ut(F.h,J.i,J.h))))}),al=ni(function(F,H,J){return F.i!==0?!1:(ln(H,J,it(F.h)),!0)},function(F,H,J){if(H=on(H,J),H!=null&&H!=null)if(z(F.h,8*J),F=F.h,J=H,0<=J)z(F,J);else{for(H=0;9>H;H++)F.h.push(J&127|128),J>>=7;F.h.push(1)}}),dc=ni(function(F,H,J){if(F.i!==2)return!1;var oe=it(F.h)>>>0;F=F.h;var Me=kt(F,oe);if(F=F.i,at){var De=F,Ee;(Ee=et)||(Ee=et=new TextDecoder("utf-8",{fatal:!0})),F=Me+oe,De=Me===0&&F===De.length?De:De.subarray(Me,F);try{var qe=Ee.decode(De)}catch(fi){if(tt===void 0){try{Ee.decode(new Uint8Array([128]))}catch{}try{Ee.decode(new Uint8Array([97])),tt=!0}catch{tt=!1}}throw!tt&&(et=void 0),fi}}else{qe=Me,oe=qe+oe,Me=[];for(var bt=null,un,Cn;qe<oe;)un=F[qe++],128>un?Me.push(un):224>un?qe>=oe?ee():(Cn=F[qe++],194>un||(Cn&192)!==128?(qe--,ee()):Me.push((un&31)<<6|Cn&63)):240>un?qe>=oe-1?ee():(Cn=F[qe++],(Cn&192)!==128||un===224&&160>Cn||un===237&&160<=Cn||((De=F[qe++])&192)!==128?(qe--,ee()):Me.push((un&15)<<12|(Cn&63)<<6|De&63)):244>=un?qe>=oe-2?ee():(Cn=F[qe++],(Cn&192)!==128||(un<<28)+(Cn-144)>>30!==0||((De=F[qe++])&192)!==128||((Ee=F[qe++])&192)!==128?(qe--,ee()):(un=(un&7)<<18|(Cn&63)<<12|(De&63)<<6|Ee&63,un-=65536,Me.push((un>>10&1023)+55296,(un&1023)+56320))):ee(),8192<=Me.length&&(bt=Re(bt,Me),Me.length=0);qe=Re(bt,Me)}return ln(H,J,qe),!0},function(F,H,J){if(H=on(H,J),H!=null){var oe=!1;if(oe=oe===void 0?!1:oe,rn){if(oe&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(H))throw Error("Found an unpaired surrogate");H=(jt||(jt=new TextEncoder)).encode(H)}else{for(var Me=0,De=new Uint8Array(3*H.length),Ee=0;Ee<H.length;Ee++){var qe=H.charCodeAt(Ee);if(128>qe)De[Me++]=qe;else{if(2048>qe)De[Me++]=qe>>6|192;else{if(55296<=qe&&57343>=qe){if(56319>=qe&&Ee<H.length){var bt=H.charCodeAt(++Ee);if(56320<=bt&&57343>=bt){qe=1024*(qe-55296)+bt-56320+65536,De[Me++]=qe>>18|240,De[Me++]=qe>>12&63|128,De[Me++]=qe>>6&63|128,De[Me++]=qe&63|128;continue}else Ee--}if(oe)throw Error("Found an unpaired surrogate");qe=65533}De[Me++]=qe>>12|224,De[Me++]=qe>>6&63|128}De[Me++]=qe&63|128}}H=Me===De.length?De:De.subarray(0,Me)}z(F.h,8*J+2),z(F.h,H.length),Bt(F,F.h.end()),Bt(F,H)}}),Ih=ni(function(F,H,J,oe,Me){if(F.i!==2)return!1;H=Ze(H,J,oe),J=F.h.j,oe=it(F.h)>>>0;var De=F.h.h+oe,Ee=De-J;if(0>=Ee&&(F.h.j=De,Me(H,F,void 0,void 0,void 0),Ee=De-F.h.h),Ee)throw Error("Message parsing ended unexpectedly. Expected to read "+(oe+" bytes, instead read "+(oe-Ee)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return F.h.h=De,F.h.j=J,!0},function(F,H,J,oe,Me){if(H=$e(H,oe,J),H!=null)for(oe=0;oe<H.length;oe++){var De=F;z(De.h,8*J+2);var Ee=De.h.end();Bt(De,Ee),Ee.push(De.i),De=Ee,Me(H[oe],F),Ee=F;var qe=De.pop();for(qe=Ee.i+Ee.h.length()-qe;127<qe;)De.push(qe&127|128),qe>>>=7,Ee.i++;De.push(qe),Ee.i++}});function qc(F){return function(H,J){e:{if(be.length){var oe=be.pop();oe.setOptions(J),St(oe.h,H,J),H=oe}else H=new se(H,J);try{var Me=Jc(F),De=hc(new Me.P,H,Me);break e}finally{Me=H.h,Me.i=null,Me.m=!1,Me.l=0,Me.j=0,Me.h=0,Me.S=!1,H.l=-1,H.i=-1,100>be.length&&be.push(H)}De=void 0}return De}}function fc(F){return function(){var H=new pt;Yo(this,H,ql(F)),Bt(H,H.h.end());for(var J=new Uint8Array(H.i),oe=H.j,Me=oe.length,De=0,Ee=0;Ee<Me;Ee++){var qe=oe[Ee];J.set(qe,De),De+=qe.length}return H.j=[J],J}}function Qc(F){qt.call(this,F)}S(Qc,qt);var ua=[Qc,1,al,2,to,3,dc,4,dc];Qc.prototype.l=fc(ua);function Ql(F){qt.call(this,F,-1,Qd)}S(Ql,qt),Ql.prototype.addClassification=function(F,H){return Ze(this,1,Qc,F,H),this};var Qd=[1],ol=qc([Ql,1,Ih,ua]);function ci(F){qt.call(this,F)}S(ci,qt);var Dl=[ci,1,to,2,to,3,to,4,to,5,to];ci.prototype.l=fc(Dl);function Gh(F){qt.call(this,F,-1,eh)}S(Gh,qt);var eh=[1],ll=qc([Gh,1,Ih,Dl]);function Eu(F){qt.call(this,F)}S(Eu,qt);var lp=[Eu,1,to,2,to,3,to,4,to,5,to,6,Ro],D0=qc(lp);Eu.prototype.l=fc(lp);function up(F,H,J){if(J=F.createShader(J===0?F.VERTEX_SHADER:F.FRAGMENT_SHADER),F.shaderSource(J,H),F.compileShader(J),!F.getShaderParameter(J,F.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+F.getShaderInfoLog(J));return J}function ef(F){return $e(F,Qc,1).map(function(H){var J=on(H,1);return{index:J??0,score:Jt(H,2),label:on(H,3)!=null?zt(on(H,3),""):void 0,displayName:on(H,4)!=null?zt(on(H,4),""):void 0}})}function Hm(F){return{x:Jt(F,1),y:Jt(F,2),z:Jt(F,3),visibility:de(F,4)!=null?Jt(F,4):void 0}}function th(F){return F.map(function(H){return $e(ll(H),ci,1).map(Hm)})}function cp(F,H){this.i=F,this.h=H,this.m=0}function Xm(F,H,J){return tf(F,H),typeof F.h.canvas.transferToImageBitmap=="function"?Promise.resolve(F.h.canvas.transferToImageBitmap()):J?Promise.resolve(F.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(F.h.canvas):(F.j===void 0&&(F.j=document.createElement("canvas")),new Promise(function(oe){F.j.height=F.h.canvas.height,F.j.width=F.h.canvas.width,F.j.getContext("2d",{}).drawImage(F.h.canvas,0,0,F.h.canvas.width,F.h.canvas.height),oe(F.j)}))}function tf(F,H){var J=F.h;if(F.s===void 0){var oe=up(J,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),Me=up(J,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),De=J.createProgram();if(J.attachShader(De,oe),J.attachShader(De,Me),J.linkProgram(De),!J.getProgramParameter(De,J.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+J.getProgramInfoLog(De));oe=F.s=De,J.useProgram(oe),Me=J.getUniformLocation(oe,"sampler0"),F.l={O:J.getAttribLocation(oe,"aVertex"),N:J.getAttribLocation(oe,"aTex"),xa:Me},F.v=J.createBuffer(),J.bindBuffer(J.ARRAY_BUFFER,F.v),J.enableVertexAttribArray(F.l.O),J.vertexAttribPointer(F.l.O,2,J.FLOAT,!1,0,0),J.bufferData(J.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),J.STATIC_DRAW),J.bindBuffer(J.ARRAY_BUFFER,null),F.u=J.createBuffer(),J.bindBuffer(J.ARRAY_BUFFER,F.u),J.enableVertexAttribArray(F.l.N),J.vertexAttribPointer(F.l.N,2,J.FLOAT,!1,0,0),J.bufferData(J.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),J.STATIC_DRAW),J.bindBuffer(J.ARRAY_BUFFER,null),J.uniform1i(Me,0)}oe=F.l,J.useProgram(F.s),J.canvas.width=H.width,J.canvas.height=H.height,J.viewport(0,0,H.width,H.height),J.activeTexture(J.TEXTURE0),F.i.bindTexture2d(H.glName),J.enableVertexAttribArray(oe.O),J.bindBuffer(J.ARRAY_BUFFER,F.v),J.vertexAttribPointer(oe.O,2,J.FLOAT,!1,0,0),J.enableVertexAttribArray(oe.N),J.bindBuffer(J.ARRAY_BUFFER,F.u),J.vertexAttribPointer(oe.N,2,J.FLOAT,!1,0,0),J.bindFramebuffer(J.DRAW_FRAMEBUFFER?J.DRAW_FRAMEBUFFER:J.FRAMEBUFFER,null),J.clearColor(0,0,0,0),J.clear(J.COLOR_BUFFER_BIT),J.colorMask(!0,!0,!0,!0),J.drawArrays(J.TRIANGLE_FAN,0,4),J.disableVertexAttribArray(oe.O),J.disableVertexAttribArray(oe.N),J.bindBuffer(J.ARRAY_BUFFER,null),F.i.bindTexture2d(0)}function hp(F){this.h=F}var dp=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function N0(F,H){return H+F}function Wm(F,H){window[F]=H}function Zm(F){var H=document.createElement("script");return H.setAttribute("src",F),H.setAttribute("crossorigin","anonymous"),new Promise(function(J){H.addEventListener("load",function(){J()},!1),H.addEventListener("error",function(){J()},!1),document.body.appendChild(H)})}function fp(){return U(function(F){switch(F.h){case 1:return F.s=2,T(F,WebAssembly.instantiate(dp),4);case 4:F.h=3,F.s=0;break;case 2:return F.s=0,F.l=null,F.return(!1);case 3:return F.return(!0)}})}function pc(F){if(this.h=F,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=F&&F.locateFile||N0,typeof window=="object")var H=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")H=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=H,F.options){H=o(Object.keys(F.options));for(var J=H.next();!J.done;J=H.next()){J=J.value;var oe=F.options[J].default;oe!==void 0&&(this.l[J]=typeof oe=="function"?oe():oe)}}}n=pc.prototype,n.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function Po(F){var H,J,oe,Me,De,Ee,qe,bt,un,Cn,fi;return U(function(oi){switch(oi.h){case 1:return F.ga?(H=F.h.files===void 0?[]:typeof F.h.files=="function"?F.h.files(F.l):F.h.files,T(oi,fp(),2)):oi.return();case 2:if(J=oi.i,typeof window=="object")return Wm("createMediapipeSolutionsWasm",{locateFile:F.locateFile}),Wm("createMediapipeSolutionsPackedAssets",{locateFile:F.locateFile}),Ee=H.filter(function(Gn){return Gn.data!==void 0}),qe=H.filter(function(Gn){return Gn.data===void 0}),bt=Promise.all(Ee.map(function(Gn){var vi=Oh(F,Gn.url);if(Gn.path!==void 0){var Hi=Gn.path;vi=vi.then(function(ts){return F.overrideFile(Hi,ts),Promise.resolve(ts)})}return vi})),un=Promise.all(qe.map(function(Gn){return Gn.simd===void 0||Gn.simd&&J||!Gn.simd&&!J?Zm(F.locateFile(Gn.url,F.ha)):Promise.resolve()})).then(function(){var Gn,vi,Hi;return U(function(ts){if(ts.h==1)return Gn=window.createMediapipeSolutionsWasm,vi=window.createMediapipeSolutionsPackedAssets,Hi=F,T(ts,Gn(vi),2);Hi.i=ts.i,ts.h=0})}),Cn=(function(){return U(function(Gn){return F.h.graph&&F.h.graph.url?Gn=T(Gn,Oh(F,F.h.graph.url),0):(Gn.h=0,Gn=void 0),Gn})})(),T(oi,Promise.all([un,bt,Cn]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return oe=H.filter(function(Gn){return Gn.simd===void 0||Gn.simd&&J||!Gn.simd&&!J}).map(function(Gn){return F.locateFile(Gn.url,F.ha)}),importScripts.apply(null,l(oe)),Me=F,T(oi,createMediapipeSolutionsWasm(Module),6);case 6:Me.i=oi.i,F.m=new OffscreenCanvas(1,1),F.i.canvas=F.m,De=F.i.GL.createContext(F.m,{antialias:!1,alpha:!1,ua:typeof WebGL2RenderingContext<"u"?2:1}),F.i.GL.makeContextCurrent(De),oi.h=4;break;case 7:if(F.m=document.createElement("canvas"),fi=F.m.getContext("webgl2",{}),!fi&&(fi=F.m.getContext("webgl",{}),!fi))return alert("Failed to create WebGL canvas context when passing video frame."),oi.return();F.K=fi,F.i.canvas=F.m,F.i.createContext(F.m,!0,!0,{});case 4:F.j=new F.i.SolutionWasm,F.ga=!1,oi.h=0}})}function nf(F){var H,J,oe,Me,De,Ee,qe,bt;return U(function(un){if(un.h==1){if(F.h.graph&&F.h.graph.url&&F.fa===F.h.graph.url)return un.return();if(F.u=!0,!F.h.graph||!F.h.graph.url){un.h=2;return}return F.fa=F.h.graph.url,T(un,Oh(F,F.h.graph.url),3)}for(un.h!=2&&(H=un.i,F.j.loadGraph(H)),J=o(Object.keys(F.D)),oe=J.next();!oe.done;oe=J.next())Me=oe.value,F.j.overrideFile(Me,F.D[Me]);if(F.D={},F.h.listeners)for(De=o(F.h.listeners),Ee=De.next();!Ee.done;Ee=De.next())qe=Ee.value,u1(F,qe);bt=F.l,F.l={},F.setOptions(bt),un.h=0})}n.reset=function(){var F=this;return U(function(H){F.j&&(F.j.reset(),F.s={},F.v={}),H.h=0})},n.setOptions=function(F,H){var J=this;if(H=H||this.h.options){for(var oe=[],Me=[],De={},Ee=o(Object.keys(F)),qe=Ee.next();!qe.done;De={X:De.X,Y:De.Y},qe=Ee.next())if(qe=qe.value,!(qe in this.l&&this.l[qe]===F[qe])){this.l[qe]=F[qe];var bt=H[qe];bt!==void 0&&(bt.onChange&&(De.X=bt.onChange,De.Y=F[qe],oe.push((function(un){return function(){var Cn;return U(function(fi){if(fi.h==1)return T(fi,un.X(un.Y),2);Cn=fi.i,Cn===!0&&(J.u=!0),fi.h=0})}})(De))),bt.graphOptionXref&&(qe=Object.assign({},{calculatorName:"",calculatorIndex:0},bt.graphOptionXref,{valueNumber:bt.type===1?F[qe]:0,valueBoolean:bt.type===0?F[qe]:!1,valueString:bt.type===2?F[qe]:""}),Me.push(qe)))}(oe.length!==0||Me.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(Me),this.F=(this.F===void 0?[]:this.F).concat(oe))}};function jm(F){var H,J,oe,Me,De,Ee,qe;return U(function(bt){switch(bt.h){case 1:if(!F.u)return bt.return();if(!F.F){bt.h=2;break}H=o(F.F),J=H.next();case 3:if(J.done){bt.h=5;break}return oe=J.value,T(bt,oe(),4);case 4:J=H.next(),bt.h=3;break;case 5:F.F=void 0;case 2:if(F.H){for(Me=new F.i.GraphOptionChangeRequestList,De=o(F.H),Ee=De.next();!Ee.done;Ee=De.next())qe=Ee.value,Me.push_back(qe);F.j.changeOptions(Me),Me.delete(),F.H=void 0}F.u=!1,bt.h=0}})}n.initialize=function(){var F=this;return U(function(H){return H.h==1?T(H,Po(F),2):H.h!=3?T(H,nf(F),3):T(H,jm(F),0)})};function Oh(F,H){var J,oe;return U(function(Me){return H in F.L?Me.return(F.L[H]):(J=F.locateFile(H,""),oe=fetch(J).then(function(De){return De.arrayBuffer()}),F.L[H]=oe,Me.return(oe))})}n.overrideFile=function(F,H){this.j?this.j.overrideFile(F,H):this.D[F]=H},n.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},n.send=function(F,H){var J=this,oe,Me,De,Ee,qe,bt,un,Cn,fi;return U(function(oi){switch(oi.h){case 1:return J.h.inputs?(oe=1e3*(H??performance.now()),T(oi,J.I,2)):oi.return();case 2:return T(oi,J.initialize(),3);case 3:for(Me=new J.i.PacketDataList,De=o(Object.keys(F)),Ee=De.next();!Ee.done;Ee=De.next())if(qe=Ee.value,bt=J.h.inputs[qe]){e:{var Gn=F[qe];switch(bt.type){case"video":var vi=J.s[bt.stream];if(vi||(vi=new cp(J.i,J.K),J.s[bt.stream]=vi),vi.m===0&&(vi.m=vi.i.createTexture()),typeof HTMLVideoElement<"u"&&Gn instanceof HTMLVideoElement)var Hi=Gn.videoWidth,ts=Gn.videoHeight;else typeof HTMLImageElement<"u"&&Gn instanceof HTMLImageElement?(Hi=Gn.naturalWidth,ts=Gn.naturalHeight):(Hi=Gn.width,ts=Gn.height);ts={glName:vi.m,width:Hi,height:ts},Hi=vi.h,Hi.canvas.width=ts.width,Hi.canvas.height=ts.height,Hi.activeTexture(Hi.TEXTURE0),vi.i.bindTexture2d(vi.m),Hi.texImage2D(Hi.TEXTURE_2D,0,Hi.RGBA,Hi.RGBA,Hi.UNSIGNED_BYTE,Gn),vi.i.bindTexture2d(0),vi=ts;break e;case"detections":for(vi=J.s[bt.stream],vi||(vi=new hp(J.i),J.s[bt.stream]=vi),vi.data||(vi.data=new vi.h.DetectionListData),vi.data.reset(Gn.length),ts=0;ts<Gn.length;++ts){Hi=Gn[ts];var Sr=vi.data,Bs=Sr.setBoundingBox,no=ts,ca=Hi.la,mr=new Eu;if(Ke(mr,1,ca.ra),Ke(mr,2,ca.sa),Ke(mr,3,ca.height),Ke(mr,4,ca.width),Ke(mr,5,ca.rotation),ln(mr,6,ca.pa),ca=mr.l(),Bs.call(Sr,no,ca),Hi.ea)for(Sr=0;Sr<Hi.ea.length;++Sr){mr=Hi.ea[Sr],Bs=vi.data,no=Bs.addNormalizedLandmark,ca=ts,mr=Object.assign({},mr,{visibility:mr.visibility?mr.visibility:0});var ns=new ci;Ke(ns,1,mr.x),Ke(ns,2,mr.y),Ke(ns,3,mr.z),mr.visibility&&Ke(ns,4,mr.visibility),mr=ns.l(),no.call(Bs,ca,mr)}if(Hi.ba)for(Sr=0;Sr<Hi.ba.length;++Sr)Bs=vi.data,no=Bs.addClassification,ca=ts,mr=Hi.ba[Sr],ns=new Qc,Ke(ns,2,mr.score),mr.index&&ln(ns,1,mr.index),mr.label&&ln(ns,3,mr.label),mr.displayName&&ln(ns,4,mr.displayName),mr=ns.l(),no.call(Bs,ca,mr)}vi=vi.data;break e;default:vi={}}}switch(un=vi,Cn=bt.stream,bt.type){case"video":Me.pushTexture2d(Object.assign({},un,{stream:Cn,timestamp:oe}));break;case"detections":fi=un,fi.stream=Cn,fi.timestamp=oe,Me.pushDetectionList(fi);break;default:throw Error("Unknown input config type: '"+bt.type+"'")}}return J.j.send(Me),T(oi,J.I,4);case 4:Me.delete(),oi.h=0}})};function Ym(F,H,J){var oe,Me,De,Ee,qe,bt,un,Cn,fi,oi,Gn,vi,Hi,ts;return U(function(Sr){switch(Sr.h){case 1:if(!J)return Sr.return(H);for(oe={},Me=0,De=o(Object.keys(J)),Ee=De.next();!Ee.done;Ee=De.next())qe=Ee.value,bt=J[qe],typeof bt!="string"&&bt.type==="texture"&&H[bt.stream]!==void 0&&++Me;1<Me&&(F.M=!1),un=o(Object.keys(J)),Ee=un.next();case 2:if(Ee.done){Sr.h=4;break}if(Cn=Ee.value,fi=J[Cn],typeof fi=="string")return Hi=oe,ts=Cn,T(Sr,Km(F,Cn,H[fi]),14);if(oi=H[fi.stream],fi.type==="detection_list"){if(oi){for(var Bs=oi.getRectList(),no=oi.getLandmarksList(),ca=oi.getClassificationsList(),mr=[],ns=0;ns<Bs.size();++ns){var Do=D0(Bs.get(ns)),Y=Jt(Do,1),xe=Jt(Do,2),Pe=Jt(Do,3),Ot=Jt(Do,4),li=Jt(Do,5,0),Yr=void 0;Yr=Yr===void 0?0:Yr,Do={la:{ra:Y,sa:xe,height:Pe,width:Ot,rotation:li,pa:zt(on(Do,6),Yr)},ea:$e(ll(no.get(ns)),ci,1).map(Hm),ba:ef(ol(ca.get(ns)))},mr.push(Do)}Bs=mr}else Bs=[];oe[Cn]=Bs,Sr.h=7;break}if(fi.type==="proto_list"){if(oi){for(Bs=Array(oi.size()),no=0;no<oi.size();no++)Bs[no]=oi.get(no);oi.delete()}else Bs=[];oe[Cn]=Bs,Sr.h=7;break}if(oi===void 0){Sr.h=3;break}if(fi.type==="float_list"){oe[Cn]=oi,Sr.h=7;break}if(fi.type==="proto"){oe[Cn]=oi,Sr.h=7;break}if(fi.type!=="texture")throw Error("Unknown output config type: '"+fi.type+"'");return Gn=F.v[Cn],Gn||(Gn=new cp(F.i,F.K),F.v[Cn]=Gn),T(Sr,Xm(Gn,oi,F.M),13);case 13:vi=Sr.i,oe[Cn]=vi;case 7:fi.transform&&oe[Cn]&&(oe[Cn]=fi.transform(oe[Cn])),Sr.h=3;break;case 14:Hi[ts]=Sr.i;case 3:Ee=un.next(),Sr.h=2;break;case 4:return Sr.return(oe)}})}function Km(F,H,J){var oe;return U(function(Me){return typeof J=="number"||J instanceof Uint8Array||J instanceof F.i.Uint8BlobList?Me.return(J):J instanceof F.i.Texture2dDataOut?(oe=F.v[H],oe||(oe=new cp(F.i,F.K),F.v[H]=oe),Me.return(Xm(oe,J,F.M))):Me.return(void 0)})}function u1(F,H){for(var J=H.name||"$",oe=[].concat(l(H.wants)),Me=new F.i.StringList,De=o(H.wants),Ee=De.next();!Ee.done;Ee=De.next())Me.push_back(Ee.value);De=F.i.PacketListener.implement({onResults:function(qe){for(var bt={},un=0;un<H.wants.length;++un)bt[oe[un]]=qe.get(un);var Cn=F.listeners[J];Cn&&(F.I=Ym(F,bt,H.outs).then(function(fi){fi=Cn(fi);for(var oi=0;oi<H.wants.length;++oi){var Gn=bt[oe[oi]];typeof Gn=="object"&&Gn.hasOwnProperty&&Gn.hasOwnProperty("delete")&&Gn.delete()}fi&&(F.I=fi)}))}}),F.j.attachMultiListener(Me,De),Me.delete()}n.onResults=function(F,H){this.listeners[H||"$"]=F},q("Solution",pc),q("OptionType",{BOOL:0,NUMBER:1,ta:2,0:"BOOL",1:"NUMBER",2:"STRING"});function wa(F){return F===void 0&&(F=0),F===1?"hand_landmark_full.tflite":"hand_landmark_lite.tflite"}function $m(F){var H=this;F=F||{},this.h=new pc({locateFile:F.locateFile,files:function(J){return[{url:"hands_solution_packed_assets_loader.js"},{simd:!1,url:"hands_solution_wasm_bin.js"},{simd:!0,url:"hands_solution_simd_wasm_bin.js"},{data:!0,url:wa(J.modelComplexity)}]},graph:{url:"hands.binarypb"},inputs:{image:{type:"video",stream:"input_frames_gpu"}},listeners:[{wants:["multi_hand_landmarks","multi_hand_world_landmarks","image_transformed","multi_handedness"],outs:{image:"image_transformed",multiHandLandmarks:{type:"proto_list",stream:"multi_hand_landmarks",transform:th},multiHandWorldLandmarks:{type:"proto_list",stream:"multi_hand_world_landmarks",transform:th},multiHandedness:{type:"proto_list",stream:"multi_handedness",transform:function(J){return J.map(function(oe){return ef(ol(oe))[0]})}}}}],options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},maxNumHands:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculator",fieldName:"int_value"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(J){var oe,Me,De;return U(function(Ee){return Ee.h==1?(oe=wa(J),Me="third_party/mediapipe/modules/hand_landmark/"+oe,T(Ee,Oh(H.h,oe),2)):(De=Ee.i,H.h.overrideFile(Me,De),Ee.return(!0))})}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"handlandmarktrackinggpu__palmdetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"handlandmarktrackinggpu__handlandmarkgpu__ThresholdingCalculator",fieldName:"threshold"}}}})}n=$m.prototype,n.close=function(){return this.h.close(),Promise.resolve()},n.onResults=function(F){this.h.onResults(F)},n.initialize=function(){var F=this;return U(function(H){return T(H,F.h.initialize(),0)})},n.reset=function(){this.h.reset()},n.send=function(F){var H=this;return U(function(J){return T(J,H.h.send(F),0)})},n.setOptions=function(F){this.h.setOptions(F)},q("Hands",$m),q("HAND_CONNECTIONS",[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]]),q("VERSION","0.4.1675469240")}).call(jU)),jU}var CJ=Sdt();function wJ(){return window.innerWidth<window.innerHeight}const yN=240,vN=135;function Mdt({maxHands:n=1,modelComplexity:e=1,minDetectionConfidence:t=.6,minTrackingConfidence:i=.6,cameraWidth:r=wJ()?720:1280,cameraHeight:s=wJ()?1280:720,showVideo:a=!1,showDebugSkeleton:o=!0,landmarkStyle:l={color:"#FF3366",radius:4},connectorStyle:u={color:"#00FFAA",lineWidth:3},videoSize:c=1,videoPosition:d="bottom-center",videoStyle:f={}}={}){const m=G.useRef(null),y=G.useRef(null),_=G.useRef(null),S=G.useRef(null),b=G.useRef(null),M=G.useRef(a),w=G.useRef(o),T=G.useRef(l),E=G.useRef(u),[R,P]=G.useState(null);return G.useEffect(()=>{M.current=a},[a]),G.useEffect(()=>{w.current=o},[o]),G.useEffect(()=>{T.current=l},[l]),G.useEffect(()=>{E.current=u},[u]),G.useEffect(()=>{if(S.current)return;let I=!0;const B=document.createElement("video");B.className=d??"bottom-center",B.playsInline=!0,B.autoplay=!0,B.muted=!0,Object.assign(B.style,{position:"fixed",transform:"scaleX(-1)",zIndex:9999,width:`${yN*c}px`,height:`${vN*c}px`,pointerEvents:"none",borderRadius:"var(--overlay-radius)",boxShadow:"var(--overlay-shadow)",display:"none"});const N=document.createElement("canvas");N.className=d??"bottom-center",Object.assign(N.style,{position:"fixed",transform:"scaleX(-1)",zIndex:1e4,width:`${yN*c}px`,height:`${vN*c}px`,pointerEvents:"none",borderRadius:"var(--overlay-radius)",display:"none"});const U=N.getContext("2d");document.body.appendChild(B),document.body.appendChild(N),m.current=B,y.current=N,_.current=U,B.addEventListener("loadedmetadata",()=>{N.width=B.videoWidth,N.height=B.videoHeight});const V=new CJ.Hands({locateFile:K=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${K}`});V.onResults(K=>{if(!I)return;P(K);const q=M.current,j=w.current;if(!(!_.current||!y.current)){if(!q){_.current.clearRect(0,0,y.current.width,y.current.height);return}_.current.save(),_.current.clearRect(0,0,y.current.width,y.current.height),_.current.drawImage(K.image,0,0,y.current.width,y.current.height),j&&K.multiHandLandmarks&&K.multiHandLandmarks.forEach(te=>{AJ.drawConnectors(_.current,te,CJ.HAND_CONNECTIONS,E.current),AJ.drawLandmarks(_.current,te,T.current)}),_.current.restore()}}),S.current=V;const W=new bdt.Camera(B,{onFrame:async()=>{S.current&&await S.current.send({image:B})},width:r,height:s});return W.start(),b.current=W,()=>{I=!1,b.current?.stop(),S.current?.close(),B.remove(),N.remove(),S.current=null,b.current=null,m.current=null,y.current=null,_.current=null}},[]),G.useEffect(()=>{S.current&&S.current.setOptions({maxNumHands:n,modelComplexity:e,minDetectionConfidence:t,minTrackingConfidence:i})},[n,e,t,i]),G.useEffect(()=>{if(!m.current||!y.current)return;const I=a?"block":"none";Object.assign(m.current.style,{display:I,...f}),Object.assign(y.current.style,{display:I,...f}),!a&&_.current&&y.current&&_.current.clearRect(0,0,y.current.width,y.current.height)},[a,f]),G.useEffect(()=>{!m.current||!y.current||(Object.assign(m.current.style,{width:`${yN*c}px`,height:`${vN*c}px`}),Object.assign(y.current.style,{width:`${yN*c}px`,height:`${vN*c}px`}))},[c]),R}function Adt(){const n=G.useRef(),e=G.useRef(),t=G.useRef(),i=Ks("MediaPipe",{maxHands:{label:"Hands",value:2,min:1,max:2,step:1},showVideo:{label:"Show Video",value:!0},showDebugSkeleton:{label:"Show Skeleton",value:!0},landmarkColor:{label:"Landmark Color",value:"#FF3366"},connectorColor:{label:"Connector Color",value:"#00FFAA"},landmarkRadius:{label:"Landmark Radius",value:4,min:1,max:10},connectorLineWidth:{label:"Connector Line Width",value:3,min:1,max:10},videoSize:{label:"Video Size (x)",value:1,min:.1,max:3,step:.1}},{collapsed:!0}),r=Ks("Scale Mapping",{xScale:{label:"X",value:4,min:1,max:10,step:.1},yScale:{label:"Y",value:3,min:1,max:10,step:.1},zScale:{label:"Z",value:5,min:1,max:15,step:.1}},{collapsed:!0}),s=Ks("Debug",{showLandmarks:{label:"Show Landmarks",value:!0},reset:Eee(()=>{n.current.position.set(0,0,1),e.current.position.set(-1,0,1),t.current.position.set(1,0,1)})},{collapsed:!0}),a=Mdt({maxHands:i.maxHands,showVideo:i.showVideo,showDebugSkeleton:i.showDebugSkeleton,landmarkStyle:{color:i.landmarkColor,radius:i.landmarkRadius},connectorStyle:{color:i.connectorColor,lineWidth:i.connectorLineWidth},videoSize:i.videoSize}),o=pdt(a,{maxHands:i.maxHands,...r}),l=vdt(o,{onGestureStart:c=>console.log(" gesture start:",c),onGestureEnd:c=>console.log(" gesture end:",c),onLeftGestureStart:c=>console.log(" left start:",c),onRightGestureStart:c=>console.log(" right start:",c),onLeftFingerPinchStart:c=>console.log(" LEFT PINCH:",c),onRightFingerPinchStart:c=>console.log(" RIGHT PINCH:",c),onSwipeLeft:()=>console.log(" swipe left"),onSwipeRight:()=>console.log(" swipe right")});rs(()=>{o?.handPosition&&n.current&&n.current.position.lerp(o.handPosition,.25),o?.leftHandPosition&&e.current&&e.current.position.lerp(o.leftHandPosition,.25),o?.rightHandPosition&&t.current&&t.current.position.lerp(o.rightHandPosition,.25)});function u(c){if(!c)return"white";switch(c){case"PALM_OPEN":return"deepskyblue";case"GRAB":return"red";case"POINT":return"yellow";case"VICTORY":return"lime";case"THE_HORNS":return"orange";case"PINCH":return"hotpink";case"THUMB_INDEX":return"hotpink";case"THUMB_MIDDLE":return"violet";case"THUMB_RING":return"cyan";case"THUMB_PINKY":return"gold";default:return"white"}}return $.jsxs($.Fragment,{children:[$.jsx(Ob,{makeDefault:!0,position:[-5,2,4],fov:50}),$.jsx("ambientLight",{intensity:1}),$.jsx("color",{attach:"background",args:["#5b5b5b"]}),$.jsx(mA,{}),$.jsx(kle,{args:[10,10]}),$.jsx(s2,{}),$.jsxs("mesh",{ref:n,position:[0,0,1],visible:i.maxHands===1,children:[$.jsx("sphereGeometry",{args:[.15,32,32]}),$.jsx("meshPhysicalMaterial",{color:u(l?.primaryPose)})]}),$.jsxs("mesh",{ref:e,position:[-1,0,1],visible:i.maxHands===2,children:[$.jsx("sphereGeometry",{args:[.15,32,32]}),$.jsx("meshPhysicalMaterial",{color:u(l?.leftPose)})]}),$.jsxs("mesh",{ref:t,position:[1,0,1],visible:i.maxHands===2,children:[$.jsx("sphereGeometry",{args:[.15,32,32]}),$.jsx("meshPhysicalMaterial",{color:u(l?.rightPose)})]}),s.showLandmarks&&o&&$.jsx(mdt,{hands:o.hands,scale:r})]})}function Tdt(n,e,t){const i=n%(e+t);return i<e?0:(i-e)/t*2*Math.PI}function Cdt({bretPosition:n={x:0,y:0,z:0},bretRotation:e={x:0,y:0,z:0},bretInnerColor:t="#FF0000",bretInnerColorEmissive:i=!1,bretInnerColorEmissiveIntensity:r=0,bretOuterColor:s="#000000",bretOuterColorEmissive:a=!1,bretOuterColorEmissiveIntensity:o=0,reversalPosition:l={x:.9,y:-.4,z:0},reversalRotation:u={x:0,y:0,z:0},reversalInnerColor:c="#FF0000",reversalInnerColorEmissive:d=!1,reversalInnerColorEmissiveIntensity:f=0,reversalOuterColor:m="#000000",reversalOuterColorEmissive:y=!1,reversalOuterColorEmissiveIntensity:_=0,...S}){const{float:b,floatSpeed:M,floatIntensity:w,flip:T,flipDelay:E,flipDuration:R,spin:P,spinRotation:I,spinSpeed:B}=Ks("Logo",{Float:Mi({float:{label:"Float",value:!0},floatSpeed:{label:"Speed",value:1,min:0,max:10,step:.01},floatIntensity:{label:"Intensity",value:.05,min:0,max:1,step:.01}},{collapsed:!0}),Spin:Mi({spin:{label:"Spin",value:!0},spinRotation:{label:"Rotation",value:33,min:0,max:360,step:1},spinSpeed:{label:"Speed",value:.4,min:0,max:1,step:.01}},{collapsed:!0}),Flip:Mi({flip:{label:"Flip",value:!0},flipDuration:{label:"Duration",value:2,min:1,max:2,step:.01},flipDelay:{label:"Delay",value:4,min:0,max:10,step:.01}},{collapsed:!0})},{collapsed:!0}),N=G.useRef(),U=G.useRef(),V=G.useRef();return rs(({clock:W})=>{const K=W.getElapsedTime();b?N.current.position.y=mN(K,M,w):N.current.position.y!==0&&(N.current.position.y=mN(K,M*2,w),Math.abs(N.current.position.y)<.01&&(N.current.position.y=0)),P?N.current.rotation.y=Ba(mN(K,B,I)):N.current.rotation.y!==0&&(N.current.rotation.y=Ba(mN(K,B*2,I)),Math.abs(N.current.rotation.y)<.1&&(N.current.rotation.y=0)),(T||V.current.rotation.x!==0)&&(V.current.rotation.x=Tdt(K,E,R))}),$.jsx("group",{...S,dispose:null,children:$.jsxs("group",{ref:N,children:[$.jsx("group",{position:[n.x,n.y,n.z],rotation:[Ba(e.x),Ba(e.y),Ba(e.z)],children:$.jsx("group",{ref:U,children:$.jsx(rSe,{innerColor:t,innerColorEmissive:i,innerColorEmissiveIntensity:r,outerColor:s,outerColorEmissive:a,outerColorEmissiveIntensity:o})})}),$.jsx("group",{position:[l.x,l.y,l.z],rotation:[Ba(u.x),Ba(u.y),Ba(u.z)],children:$.jsx("group",{ref:V,children:$.jsx(s2,{innerColor:c,innerColorEmissive:d,innerColorEmissiveIntensity:f,outerColor:m,outerColorEmissive:y,outerColorEmissiveIntensity:_})})})]})})}eo({UnrealBloomPass:u7e});function EJ(n,e=8,t=2,i=10){const r=n/1e3,s=Math.random()*t,a=Math.sin(r*2*Math.PI*i),o=e+t*a+s;return Math.max(1,Math.min(10,o))}function wdt(){const{backgroundColor:n,fogColor:e,fogNear:t,fogFar:i,bloomThreshold:r,bloomStrength:s,bloomRadius:a,bretPosition:o,bretRotation:l,bretInnerColor:u,bretInnerColorEmissive:c,bretInnerColorEmissiveIntensity:d,bretOuterColor:f,bretOuterColorEmissive:m,bretOuterColorEmissiveIntensity:y,reversalPosition:_,reversalRotation:S,reversalInnerColor:b,reversalInnerColorEmissive:M,reversalInnerColorEmissiveIntensity:w,reversalOuterColor:T,reversalOuterColorEmissive:E,reversalOuterColorEmissiveIntensity:R,sparkleColor:P,sparkleCount:I,sparkleNoise:B,sparkleOpactity:N,sparkleScale:U,sparkleSize:V,sparkleSpeed:W,enableNeonFlicker:K,neonFlickerIntensity:q,neonFlickerFrequency:j}=Ks("LoGlow",{Background:Mi({backgroundColor:{label:"Background Color",value:"#202030"},Fog:Mi({fogColor:{label:"Fog Color",value:"#202030"},fogNear:{label:"Fog Near",value:10},fogFar:{label:"Fog Far",value:25}},{collapsed:!0})},{collapsed:!0}),Bloom:Mi({bloomThreshold:{label:"Bloom Threshold",value:.1,min:0,max:10},bloomStrength:{label:"Bloom Strength",value:.2,min:0,max:10},bloomRadius:{label:"Bloom Radius",value:.2,min:0,max:10}},{collapsed:!0}),Logo:Mi({Bret:Mi({bretPosition:{label:"Position",value:{x:0,y:0,z:0}},bretRotation:{label:"Rotation",value:{x:0,y:0,z:0}},"Inner Color":Mi({bretInnerColor:{label:"Color",value:"#FF0000"},bretInnerColorEmissive:{label:"Emissive",value:!0},bretInnerColorEmissiveIntensity:{label:"Emissive Intensity",value:5,min:0,max:10,step:.1}},{collapsed:!0}),"Outer Color":Mi({bretOuterColor:{label:"Color",value:"#000000"},bretOuterColorEmissive:{label:"Emissive",value:!1},bretOuterColorEmissiveIntensity:{label:"Emissive Intensity",value:0,min:0,max:10,step:.1}},{collapsed:!0})},{collapsed:!0}),Reversal:Mi({reversalPosition:{label:"Position",value:{x:.9,y:-.4,z:0}},reversalRotation:{label:"Rotation",value:{x:0,y:0,z:0}},"Inner Color":Mi({reversalInnerColor:{label:"Color",value:"#FF0000"},reversalInnerColorEmissive:{label:"Emissive",value:!0},reversalInnerColorEmissiveIntensity:{label:"Emissive Intensity",value:5,min:0,max:10,step:.1}},{collapsed:!0}),"Outer Color":Mi({reversalOuterColor:{label:"Color",value:"#000000"},reversalOuterColorEmissive:{label:"Emissive",value:!1},reversalOuterColorEmissiveIntensity:{label:"Emissive Intensity",value:0,min:0,max:10,step:.1}},{collapsed:!0})},{collapsed:!0}),Neon:Mi({enableNeonFlicker:{label:"Flicker",value:!0},neonFlickerIntensity:{label:"Intensity",value:2,min:.1,max:10},neonFlickerFrequency:{label:"Frequency",value:10,min:.1,max:10}},{collapsed:!0})},{collapsed:!0}),Sparkles:Mi({sparkleCount:{label:"Count",value:100,min:10,max:500},sparkleSpeed:{label:"Speed",value:.71,min:0,max:10},sparkleOpactity:{label:"Opacity",value:.7,min:0,max:1},sparkleColor:{label:"Color",value:"#FFFFFF"},sparkleSize:{label:"Size",value:.7,min:.1,max:10},sparkleScale:{label:"Scale",value:3.6,min:0,max:10},sparkleNoise:{label:"Noise",value:1,min:0,max:10}},{collapsed:!0})},{collapsed:!0}),[{reversalEmissiveIntensity:te,bretEmissiveIntensity:he},_e]=G.useState({reversalEmissiveIntensity:0,bretEmissiveIntensity:0});return rs(({clock:Be})=>{K?_e({reversalEmissiveIntensity:EJ(Be.getElapsedTime(),w,q,j),bretEmissiveIntensity:EJ(Be.getElapsedTime(),d,q,j)}):(te!==w||he!==d)&&_e({reversalEmissiveIntensity:w,bretEmissiveIntensity:d})}),$.jsxs($.Fragment,{children:[$.jsx(PA,{}),$.jsx(lI,{screenShot:!0}),$.jsx(Ob,{makeDefault:!0,position:[0,0,5]}),$.jsx(oZe,{}),$.jsx("color",{attach:"background",args:[n]}),$.jsx("fog",{attach:"fog",args:[e,t,i]}),$.jsx(Cdt,{scale:2,bretPosition:o,bretRotation:l,bretInnerColor:u,bretInnerColorEmissive:c,bretInnerColorEmissiveIntensity:he,bretEmissiveIntensity:he,bretOuterColor:f,bretOuterColorEmissive:m,bretOuterColorEmissiveIntensity:y,reversalPosition:_,reversalRotation:S,reversalInnerColor:b,reversalInnerColorEmissive:M,reversalInnerColorEmissiveIntensity:te,reversalOuterColor:T,reversalOuterColorEmissive:E,reversalOuterColorEmissiveIntensity:R}),$.jsx(aZe,{count:I,speed:W,opacity:N,color:P,size:V,scale:U,noise:B}),$.jsx(aWe,{disableGamma:!0,children:$.jsx("unrealBloomPass",{threshold:r,strength:s,radius:a})})]})}const RJ={normal:Al,additive:bm,multiply:c0,subtractive:u0};function Edt({innerDiameter:n=6,outerDiameter:e=18,height:t=0,maxParticleCount:i=1e3,particleCount:r=500,minConnections:s=1,maxConnections:a=8,minDistance:o=.8,maxDistance:l=2.4,pointColor:u="#ffffff",lineColor:c="#88ccff",pointSize:d=2.5,lineWidth:f=1,pointBlending:m="normal",lineBlending:y="normal",pointsToneMapped:_=!1,linesToneMapped:S=!1,pointsTransparent:b=!0,linesTransparent:M=!0,pointsOpacity:w=1,linesOpacity:T=1,timeScale:E=1,angularSpeed:R=1,radialSpeed:P=1,verticalSpeed:I=1,systemRotation:B=1}){const N=G.useRef(),U=G.useRef(),V=G.useRef(),W=G.useRef([]),K=G.useRef(),q=G.useRef(),j=G.useRef(),te=n*.5,he=e*.5;return G.useEffect(()=>{const _e=i*i;K.current=new Float32Array(i*3),q.current=new Float32Array(_e*3),j.current=new Float32Array(_e*3),W.current=[];for(let ce=0;ce<i;ce++){const Ce=Math.random()*Math.PI*2,Oe=te+Math.random()*(he-te),nt=(Math.random()-.5)*t,Ae=(.15+Math.random()*.25)*(te/Math.max(Oe,1e-4));K.current.set([Math.cos(Ce)*Oe,nt,Math.sin(Ce)*Oe],ce*3),W.current.push({theta:Ce,radius:Oe,y:nt,angularVelocity:Ae*(Math.random()<.5?-1:1),radialVelocity:(Math.random()-.5)*.002,verticalPhase:Math.random()*Math.PI*2,verticalSpeed:.3+Math.random()*.4,numConnections:0})}const Be=U.current,ue=V.current;Be.setAttribute("position",new Gi(K.current,3)),ue.setAttribute("position",new Gi(q.current,3)),ue.setAttribute("color",new Gi(j.current,3)),Be.setDrawRange(0,r),ue.setDrawRange(0,0),Be.attributes.position.needsUpdate=!0,ue.attributes.position.needsUpdate=!0,ue.attributes.color.needsUpdate=!0},[i,n,e,t]),G.useEffect(()=>{U.current&&U.current.setDrawRange(0,r)},[r]),rs((_e,Be)=>{if(!K.current)return;const ue=Be*E;let ce=0,Ce=0;const Oe=K.current,nt=W.current;for(let ze=0;ze<r;ze++)nt[ze].numConnections=0;for(let ze=0;ze<r;ze++){const ot=nt[ze];ot.theta+=ot.angularVelocity*ue*2*R,ot.radius+=ot.radialVelocity*ue*60*P,ot.radius<te&&(ot.radius=te,ot.radialVelocity*=-1),ot.radius>he&&(ot.radius=he,ot.radialVelocity*=-1),ot.verticalPhase+=ue*ot.verticalSpeed*I;const ut=ot.y+Math.sin(ot.verticalPhase)*t*.15;Oe[ze*3]=Math.cos(ot.theta)*ot.radius,Oe[ze*3+1]=ut,Oe[ze*3+2]=Math.sin(ot.theta)*ot.radius}const Ae=[];for(let ze=0;ze<r;ze++)for(let ot=ze+1;ot<r;ot++){const ut=Oe[ze*3]-Oe[ot*3],Wt=Oe[ze*3+1]-Oe[ot*3+1],It=Oe[ze*3+2]-Oe[ot*3+2],ke=Math.sqrt(ut*ut+Wt*Wt+It*It);ke>=o&&ke<=l&&Ae.push({i:ze,j:ot,dist:ke})}Ae.sort((ze,ot)=>ze.dist-ot.dist);const Ye=(ze,ot,ut)=>{const Wt=1-(ut-o)/(l-o);q.current.set([Oe[ze*3],Oe[ze*3+1],Oe[ze*3+2],Oe[ot*3],Oe[ot*3+1],Oe[ot*3+2]],ce),j.current.set([Wt,Wt,Wt,Wt,Wt,Wt],Ce),ce+=6,Ce+=6,nt[ze].numConnections++,nt[ot].numConnections++};for(let ze=0;ze<Ae.length;ze++){const{i:ot,j:ut,dist:Wt}=Ae[ze],It=nt[ot],ke=nt[ut];(It.numConnections<s||ke.numConnections<s)&&It.numConnections<a&&ke.numConnections<a&&Ye(ot,ut,Wt)}for(let ze=0;ze<Ae.length;ze++){const{i:ot,j:ut,dist:Wt}=Ae[ze],It=nt[ot],ke=nt[ut];It.numConnections<a&&ke.numConnections<a&&Ye(ot,ut,Wt)}const ft=V.current;ft.setDrawRange(0,ce/3),ft.attributes.position.needsUpdate=!0,ft.attributes.color.needsUpdate=!0,U.current.attributes.position.needsUpdate=!0,N.current.rotation.y+=ue*.03*B}),$.jsxs("group",{ref:N,dispose:null,children:[$.jsxs("points",{children:[$.jsx("bufferGeometry",{ref:U}),$.jsx("pointsMaterial",{color:new en(u),size:d,sizeAttenuation:!1,blending:RJ[m]??Al,transparent:b,opacity:w,toneMapped:_,depthWrite:!1})]}),$.jsxs("lineSegments",{children:[$.jsx("bufferGeometry",{ref:V}),$.jsx("lineBasicMaterial",{color:new en(c),linewidth:f,vertexColors:!0,blending:RJ[y]??Al,transparent:M,opacity:T,toneMapped:S,depthWrite:!1})]})]})}Z.BRDF_GGX;Z.BRDF_Lambert;Z.BasicPointShadowFilter;Z.BasicShadowFilter;Z.Break;Z.Const;Z.Continue;Z.DFGLUT;Z.D_GGX;Z.Discard;Z.EPSILON;Z.F_Schlick;const Rdt=Z.Fn;Z.INFINITY;Z.If;Z.Loop;Z.NodeAccess;Z.NodeShaderStage;Z.NodeType;Z.NodeUpdateType;Z.PCFShadowFilter;Z.PCFSoftShadowFilter;Z.PI;Z.PI2;Z.TWO_PI;Z.HALF_PI;Z.PointShadowFilter;Z.Return;Z.Schlick_to_F0;Z.ScriptableNodeResources;Z.ShaderNode;Z.Stack;Z.Switch;Z.TBNViewMatrix;Z.VSMShadowFilter;Z.V_GGX_SmithCorrelated;Z.Var;Z.VarIntent;const Pdt=Z.abs;Z.acesFilmicToneMapping;Z.acos;Z.add;Z.addMethodChaining;Z.addNodeElement;Z.agxToneMapping;Z.all;Z.alphaT;Z.and;Z.anisotropy;Z.anisotropyB;Z.anisotropyT;Z.any;Z.append;Z.array;Z.arrayBuffer;Z.asin;Z.assign;Z.atan;Z.atan2;Z.atomicAdd;Z.atomicAnd;Z.atomicFunc;Z.atomicLoad;Z.atomicMax;Z.atomicMin;Z.atomicOr;Z.atomicStore;Z.atomicSub;Z.atomicXor;Z.attenuationColor;Z.attenuationDistance;Z.attribute;Z.attributeArray;Z.backgroundBlurriness;Z.backgroundIntensity;Z.backgroundRotation;Z.batch;Z.bentNormalView;Z.billboarding;Z.bitAnd;Z.bitNot;Z.bitOr;Z.bitXor;Z.bitangentGeometry;Z.bitangentLocal;Z.bitangentView;Z.bitangentWorld;Z.bitcast;Z.blendBurn;Z.blendColor;Z.blendDodge;Z.blendOverlay;Z.blendScreen;Z.blur;Z.bool;Z.buffer;Z.bufferAttribute;Z.bumpMap;Z.burn;Z.builtin;Z.builtinAOContext;Z.builtinShadowContext;Z.bvec2;Z.bvec3;Z.bvec4;Z.bypass;Z.cache;Z.call;Z.cameraFar;Z.cameraIndex;Z.cameraNear;Z.cameraNormalMatrix;Z.cameraPosition;Z.cameraProjectionMatrix;Z.cameraProjectionMatrixInverse;Z.cameraViewMatrix;Z.cameraViewport;Z.cameraWorldMatrix;Z.cbrt;Z.cdl;Z.ceil;Z.checker;Z.cineonToneMapping;Z.clamp;Z.clearcoat;Z.clearcoatNormalView;Z.clearcoatRoughness;Z.code;Z.color;Z.colorSpaceToWorking;Z.colorToDirection;Z.compute;Z.computeKernel;Z.computeSkinning;Z.context;Z.convert;Z.convertColorSpace;Z.convertToTexture;Z.countLeadingZeros;Z.countOneBits;Z.countTrailingZeros;Z.cos;Z.cross;Z.cubeTexture;Z.cubeTextureBase;Z.dFdx;Z.dFdy;Z.dashSize;Z.debug;Z.decrement;Z.decrementBefore;Z.defaultBuildStages;Z.defaultShaderStages;Z.defined;Z.degrees;Z.deltaTime;Z.densityFog;Z.densityFogFactor;Z.depth;Z.depthPass;Z.determinant;Z.difference;Z.diffuseColor;Z.directPointLight;Z.directionToColor;Z.directionToFaceDirection;Z.dispersion;Z.distance;Z.div;Z.dodge;Z.dot;Z.drawIndex;Z.dynamicBufferAttribute;Z.element;Z.emissive;Z.equal;Z.equals;Z.equirectUV;Z.exp;Z.exp2;Z.expression;Z.faceDirection;Z.faceForward;Z.faceforward;const PJ=Z.float;Z.floatBitsToInt;Z.floatBitsToUint;Z.floor;Z.fog;const Ddt=Z.fract;Z.frameGroup;Z.frameId;Z.frontFacing;Z.fwidth;Z.gain;Z.gapSize;Z.getConstNodeType;Z.getCurrentStack;Z.getDirection;Z.getDistanceAttenuation;Z.getGeometryRoughness;Z.getNormalFromDepth;Z.interleavedGradientNoise;Z.vogelDiskSample;Z.getParallaxCorrectNormal;Z.getRoughness;Z.getScreenPosition;Z.getShIrradianceAt;Z.getShadowMaterial;Z.getShadowRenderObjectFunction;Z.getTextureIndex;Z.getViewPosition;Z.globalId;Z.glsl;Z.glslFn;Z.grayscale;Z.greaterThan;Z.greaterThanEqual;Z.hash;Z.highpModelNormalViewMatrix;Z.highpModelViewMatrix;Z.hue;Z.increment;Z.incrementBefore;Z.instance;Z.instanceIndex;Z.instancedArray;Z.instancedBufferAttribute;Z.instancedDynamicBufferAttribute;Z.instancedMesh;Z.int;Z.intBitsToFloat;Z.inverse;Z.inverseSqrt;Z.inversesqrt;Z.invocationLocalIndex;Z.invocationSubgroupIndex;Z.ior;Z.iridescence;Z.iridescenceIOR;Z.iridescenceThickness;Z.ivec2;Z.ivec3;Z.ivec4;Z.js;Z.label;Z.length;Z.lengthSq;Z.lessThan;Z.lessThanEqual;Z.lightPosition;Z.lightProjectionUV;Z.lightShadowMatrix;Z.lightTargetDirection;Z.lightTargetPosition;Z.lightViewPosition;Z.lightingContext;Z.lights;Z.linearDepth;Z.linearToneMapping;Z.localId;Z.log;Z.log2;Z.logarithmicDepthToViewZ;Z.luminance;Z.mat2;Z.mat3;Z.mat4;Z.matcapUV;Z.materialAO;Z.materialAlphaTest;Z.materialAnisotropy;Z.materialAnisotropyVector;Z.materialAttenuationColor;Z.materialAttenuationDistance;Z.materialClearcoat;Z.materialClearcoatNormal;Z.materialClearcoatRoughness;Z.materialColor;Z.materialDispersion;Z.materialEmissive;Z.materialEnvIntensity;Z.materialEnvRotation;Z.materialIOR;Z.materialIridescence;Z.materialIridescenceIOR;Z.materialIridescenceThickness;Z.materialLightMap;Z.materialLineDashOffset;Z.materialLineDashSize;Z.materialLineGapSize;Z.materialLineScale;Z.materialLineWidth;Z.materialMetalness;Z.materialNormal;Z.materialOpacity;Z.materialPointSize;Z.materialReference;Z.materialReflectivity;Z.materialRefractionRatio;Z.materialRotation;Z.materialRoughness;Z.materialSheen;Z.materialSheenRoughness;Z.materialShininess;Z.materialSpecular;Z.materialSpecularColor;Z.materialSpecularIntensity;Z.materialSpecularStrength;Z.materialThickness;Z.materialTransmission;const Ndt=Z.max;Z.maxMipLevel;Z.mediumpModelViewMatrix;Z.metalness;Z.min;const Bdt=Z.mix;Z.mixElement;Z.mod;Z.modInt;Z.modelDirection;Z.modelNormalMatrix;Z.modelPosition;Z.modelRadius;Z.modelScale;Z.modelViewMatrix;Z.modelViewPosition;Z.modelViewProjection;Z.modelWorldMatrix;Z.modelWorldMatrixInverse;Z.morphReference;Z.mrt;Z.mul;Z.mx_aastep;Z.mx_add;Z.mx_atan2;Z.mx_cell_noise_float;Z.mx_contrast;Z.mx_divide;Z.mx_fractal_noise_float;Z.mx_fractal_noise_vec2;Z.mx_fractal_noise_vec3;Z.mx_fractal_noise_vec4;Z.mx_frame;Z.mx_heighttonormal;Z.mx_hsvtorgb;Z.mx_ifequal;Z.mx_ifgreater;Z.mx_ifgreatereq;Z.mx_invert;Z.mx_modulo;Z.mx_multiply;Z.mx_noise_float;Z.mx_noise_vec3;Z.mx_noise_vec4;Z.mx_place2d;Z.mx_power;Z.mx_ramp4;Z.mx_ramplr;Z.mx_ramptb;Z.mx_rgbtohsv;Z.mx_rotate2d;Z.mx_rotate3d;Z.mx_safepower;Z.mx_separate;Z.mx_splitlr;Z.mx_splittb;Z.mx_srgb_texture_to_lin_rec709;Z.mx_subtract;Z.mx_timer;Z.mx_transform_uv;Z.mx_unifiednoise2d;Z.mx_unifiednoise3d;Z.mx_worley_noise_float;Z.mx_worley_noise_vec2;Z.mx_worley_noise_vec3;Z.negate;Z.neutralToneMapping;Z.nodeArray;Z.nodeImmutable;Z.nodeObject;Z.nodeObjectIntent;Z.nodeObjects;Z.nodeProxy;Z.nodeProxyIntent;Z.normalFlat;Z.normalGeometry;Z.normalLocal;Z.normalMap;Z.normalView;Z.normalViewGeometry;const Fdt=Z.normalWorld;Z.normalWorldGeometry;Z.normalize;Z.not;Z.notEqual;Z.numWorkgroups;Z.objectDirection;Z.objectGroup;Z.objectPosition;Z.objectRadius;Z.objectScale;Z.objectViewPosition;Z.objectWorldMatrix;Z.OnBeforeObjectUpdate;Z.OnBeforeMaterialUpdate;Z.OnObjectUpdate;Z.OnMaterialUpdate;Z.oneMinus;Z.or;Z.orthographicDepthToViewZ;Z.oscSawtooth;Z.oscSine;Z.oscSquare;Z.oscTriangle;Z.output;Z.outputStruct;Z.overlay;Z.overloadingFn;Z.packHalf2x16;Z.packSnorm2x16;Z.packUnorm2x16;Z.parabola;Z.parallaxDirection;Z.parallaxUV;Z.parameter;Z.pass;Z.passTexture;Z.pcurve;Z.perspectiveDepthToViewZ;Z.pmremTexture;Z.pointShadow;Z.pointUV;Z.pointWidth;Z.positionGeometry;Z.positionLocal;Z.positionPrevious;Z.positionView;Z.positionViewDirection;const Ldt=Z.positionWorld;Z.positionWorldDirection;Z.posterize;Z.pow;Z.pow2;Z.pow3;Z.pow4;Z.premultiplyAlpha;Z.property;Z.radians;Z.rand;Z.range;Z.rangeFog;Z.rangeFogFactor;Z.reciprocal;Z.reference;Z.referenceBuffer;Z.reflect;Z.reflectVector;Z.reflectView;Z.reflector;Z.refract;Z.refractVector;Z.refractView;Z.reinhardToneMapping;Z.remap;Z.remapClamp;Z.renderGroup;Z.renderOutput;Z.rendererReference;Z.replaceDefaultUV;Z.rotate;Z.rotateUV;Z.roughness;Z.round;Z.rtt;Z.sRGBTransferEOTF;Z.sRGBTransferOETF;Z.sample;Z.sampler;Z.samplerComparison;Z.saturate;Z.saturation;Z.screen;Z.screenCoordinate;Z.screenDPR;Z.screenSize;Z.screenUV;Z.scriptable;Z.scriptableValue;const DJ=Z.select;Z.setCurrentStack;Z.setName;Z.shaderStages;Z.shadow;Z.shadowPositionWorld;Z.shapeCircle;Z.sharedUniformGroup;Z.sheen;Z.sheenRoughness;Z.shiftLeft;Z.shiftRight;Z.shininess;Z.sign;Z.sin;Z.sinc;Z.skinning;Z.smoothstep;Z.smoothstepElement;Z.specularColor;Z.specularF90;Z.spherizeUV;Z.split;Z.spritesheetUV;Z.sqrt;Z.stack;const NJ=Z.step;Z.stepElement;Z.storage;Z.storageBarrier;Z.storageObject;Z.storageTexture;Z.string;Z.struct;Z.sub;Z.subgroupAdd;Z.subgroupAll;Z.subgroupAnd;Z.subgroupAny;Z.subgroupBallot;Z.subgroupBroadcast;Z.subgroupBroadcastFirst;Z.subBuild;Z.subgroupElect;Z.subgroupExclusiveAdd;Z.subgroupExclusiveMul;Z.subgroupInclusiveAdd;Z.subgroupInclusiveMul;Z.subgroupIndex;Z.subgroupMax;Z.subgroupMin;Z.subgroupMul;Z.subgroupOr;Z.subgroupShuffle;Z.subgroupShuffleDown;Z.subgroupShuffleUp;Z.subgroupShuffleXor;Z.subgroupSize;Z.subgroupXor;Z.tan;Z.tangentGeometry;Z.tangentLocal;Z.tangentView;Z.tangentWorld;Z.texture;Z.texture3D;Z.textureBarrier;Z.textureBicubic;Z.textureBicubicLevel;Z.textureCubeUV;Z.textureLoad;Z.textureSize;Z.textureLevel;Z.textureStore;Z.thickness;Z.time;Z.toneMapping;Z.toneMappingExposure;Z.toonOutlinePass;Z.transformDirection;Z.transformNormal;Z.transformNormalToView;Z.transformedClearcoatNormalView;Z.transformedNormalView;Z.transformedNormalWorld;Z.transmission;Z.transpose;Z.triNoise3D;Z.triplanarTexture;Z.triplanarTextures;Z.trunc;Z.uint;Z.uintBitsToFloat;Z.uniform;Z.uniformArray;Z.uniformCubeTexture;Z.uniformGroup;Z.uniformFlow;Z.uniformTexture;Z.unpackHalf2x16;Z.unpackSnorm2x16;Z.unpackUnorm2x16;Z.unpremultiplyAlpha;Z.userData;Z.uv;Z.uvec2;Z.uvec3;Z.uvec4;Z.varying;Z.varyingProperty;const YU=Z.vec2,BJ=Z.vec3;Z.vec4;Z.vectorComponents;Z.velocity;Z.vertexColor;Z.vertexIndex;Z.vertexStage;Z.vibrance;Z.viewZToLogarithmicDepth;Z.viewZToOrthographicDepth;Z.viewZToPerspectiveDepth;Z.viewport;Z.viewportCoordinate;Z.viewportDepthTexture;Z.viewportLinearDepth;Z.viewportMipTexture;Z.viewportResolution;Z.viewportSafeUV;Z.viewportSharedTexture;Z.viewportSize;Z.viewportTexture;Z.viewportUV;Z.wgsl;Z.wgslFn;Z.workgroupArray;Z.workgroupBarrier;Z.workgroupId;Z.workingToColorSpace;Z.xor;eo(hXe);function Idt({gridSize:n=2,lineWidth:e=.03,bgColor:t=[.45,.45,.45],lineColor:i=[.85,.85,.85]}={}){return{gridColorNode:G.useMemo(()=>Rdt(()=>{const a=PJ(n),o=PJ(e),l=Ldt.div(a),u=Pdt(Fdt),c=u.x.greaterThan(u.y).and(u.x.greaterThan(u.z)),d=u.y.greaterThan(u.x).and(u.y.greaterThan(u.z)),f=DJ(c,YU(l.y,l.z),DJ(d,YU(l.x,l.z),YU(l.x,l.y))),m=Ddt(f),y=Ndt(NJ(m.x,o),NJ(m.y,o)),_=BJ(t[0],t[1],t[2]),S=BJ(i[0],i[1],i[2]);return Bdt(_,S,y)})(),[n,e,t,i])}}function Gdt({gridSize:n,lineWidth:e,bgColor:t,lineColor:i,roughness:r=1,metalness:s=0}){const{gridColorNode:a}=Idt({gridSize:n,lineWidth:e,bgColor:t,lineColor:i});return $.jsx("meshStandardNodeMaterial",{colorNode:a,roughness:r,metalness:s,side:fr})}function Odt(){const n=Ks("Neural Rings",{Ring:Mi({innerDiameter:{value:3,min:0,max:30,step:.1},outerDiameter:{value:7,min:1,max:60,step:.1},height:{value:.2,min:0,max:10,step:.05}},{collapsed:!0}),Particles:Mi({particleCount:{value:500,min:10,max:1e3,step:10},maxParticleCount:{value:1e3,min:100,max:3e3,step:100},pointSize:{value:2.5,min:.5,max:10,step:.1},pointBlending:{value:"normal",options:["normal","additive","multiply","subtractive"]},pointsToneMapped:!1,pointsTransparent:!0,pointsOpacity:{value:1,min:0,max:1,step:.01}},{collapsed:!0}),Connections:Mi({minConnections:{value:1,min:0,max:64,step:1},maxConnections:{value:8,min:0,max:64,step:1},minDistance:{value:.2,min:.2,max:10,step:.01},maxDistance:{value:.8,min:.2,max:10,step:.01},lineWidth:{value:1,min:.1,max:5,step:.1},linesToneMapped:!1,linesTransparent:!0,linesOpacity:{value:1,min:0,max:1,step:.01},lineBlending:{value:"normal",options:["normal","additive","multiply","subtractive"]}},{collapsed:!0}),Colors:Mi({pointColor:"#ff0000",lineColor:"#000000"},{collapsed:!0}),Time:Mi({timeScale:{value:.4,min:0,max:3,step:.01},angularSpeed:{value:.53,min:-3,max:3,step:.01},radialSpeed:{value:1,min:0,max:5,step:.01},verticalSpeed:{value:1,min:0,max:5,step:.01},systemRotation:{value:1,min:-2,max:2,step:.01}},{collapsed:!0})});return $.jsxs($.Fragment,{children:[$.jsx(Ob,{makeDefault:!0,position:[-5,2,4],fov:50}),$.jsx("ambientLight",{intensity:.9}),$.jsx("color",{attach:"background",args:["#5b5b5b"]}),$.jsx(mA,{}),$.jsx(Edt,{...n}),$.jsx(kht,{}),$.jsxs("mesh",{position:[0,-1,0],rotation:[-Math.PI/2,0,0],children:[$.jsx("planeGeometry",{args:[5,5]}),$.jsx(Gdt,{})]})]})}function Udt(n){const{nodes:e,materials:t}=Zo($l("Femur.gltf"));return $.jsx("group",{...n,dispose:null,children:$.jsxs("group",{position:[-4.28,3.792,4.512],rotation:[-3.127,.467,1.865],children:[$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Object_2.geometry,material:t.material_0}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Object_3.geometry,material:t.material_0}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Object_4.geometry,material:t.material_0}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Object_5.geometry,material:t.material_0}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Object_6.geometry,material:t.material_0}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Object_7.geometry,material:t.material_0}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Object_8.geometry,material:t.material_0})]})})}Zo.preload($l("Femur.gltf"));function kdt({innerRadius:n=1,outerRadius:e=2,color:t="black",metallic:i=!1,...r}){const s=i?1:0,a=i?.3:1;return $.jsxs("mesh",{...r,children:[$.jsx("ringGeometry",{args:[n,e,150]}),$.jsx("meshStandardMaterial",{color:t,roughness:a,metalness:s,side:fr})]})}function zdt({innerRadius:n,rings:e,...t}){let i=n;const r=e.map((s,a)=>{const o=i,l=i+s.width;return i=l,$.jsx(kdt,{innerRadius:o,outerRadius:l,color:s.color,metallic:s.metallic,position:[0,0,0]},`ring-${a}`)});return $.jsx("group",{...t,children:r})}function Vdt({...n}){const{sideA:e,animate:t,speed:i,wobble:r,wobbleSpeed:s,wobbleAngle:a}=Ks("Record",{sideA:{label:"Side",value:!0,options:{"Side A":!0,"Side B":!1}},animate:{label:"Play",value:!0},speed:{label:"RPM",value:33,min:33,max:78,step:1},wobble:{label:"Wobble",value:!0},wobbleSpeed:{label:"Wobble Speed",value:1,min:0,max:10,step:.1},wobbleAngle:{label:"Wobble Angle",value:5,min:1,max:15,step:1}},{collapsed:!0}),o=G.useRef();rs(({clock:c})=>{if(t&&(o.current.rotation.z+=i/60*.1),r){const d=Math.sin(c.elapsedTime*s)*a;o.current.rotation.x=Ba(d)}});const{nodes:l,materials:u}=Zo($l("Record.glb"));return $.jsx("group",{...n,dispose:null,children:$.jsx("group",{ref:o,children:$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:l["REC33#RECTextures"].geometry,material:u.RECTextures,rotation:[e?0:Math.PI,0,0]})})})}Zo.preload($l("Record.glb"));function Hdt({showCranium:n,showLeftZygomatic:e,showOccipital:t,showRightLacrimal:i,showRightMaxilla:r,showRightNasal:s,showRightPalatine:a,showRightParietal:o,showRightTemporal:l,showRightZygomatic:u,showSphenoid:c,showTeeth:d,showVomer:f,showEthmoid:m,showFrontal:y,showInferiorConchae:_,showLeftLacrimal:S,showLeftMaxilla:b,showLeftNasal:M,showLeftPalatine:w,showLeftParietal:T,showLeftTemporal:E,showMandible:R,showMandibleBone:P,showMandibleTeeth:I,...B}){const{nodes:N,materials:U}=Zo($l("Skull.gltf"));return $.jsx("group",{...B,dispose:null,children:$.jsxs("group",{position:[-.249,5.881,.961],rotation:[-2.352,.002,-.08],children:[$.jsxs("group",{position:[-.418,-1.66,.931],rotation:[-.154,.022,.045],visible:R,children:[$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Lower_teeth_1.geometry,material:U.phong3,visible:I}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Mandible_2.geometry,material:U.lambert5,visible:P})]}),$.jsxs("group",{visible:n,children:[$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Left_zygomatic_1.geometry,material:U.lambert5,visible:e}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Occipital_1.geometry,material:U.lambert5,visible:t}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Right_lacrimal_1.geometry,material:U.lambert5,visible:i}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Right_max_1.geometry,material:U.lambert5,visible:r}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Right_nasal_1.geometry,material:U.lambert5,visible:s}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Right_palatine_1.geometry,material:U.lambert5,visible:a}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Right_Parietal_1.geometry,material:U.lambert5,visible:o}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Right_temporal_1.geometry,material:U.lambert5,visible:l}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Right_zygomatic_1.geometry,material:U.lambert5,visible:u}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Sphenoid_1.geometry,material:U.lambert5,visible:c}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Teeth_1.geometry,material:U.phong3,visible:d}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Vomer_1.geometry,material:U.lambert5,visible:f}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Ethmoid_1.geometry,material:U.lambert5,visible:m}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Ethmoid_2.geometry,material:U.lambert5,visible:m}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Frontal_1.geometry,material:U.lambert5,visible:y}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Inferior_conchae_1.geometry,material:U.lambert5,visible:_}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Left_lacrimal_1.geometry,material:U.lambert5,visible:S}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Left_maxilla_1.geometry,material:U.lambert5,visible:b}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Left_maxilla_2.geometry,material:U.lambert5,visible:b}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Left_nasal_1.geometry,material:U.lambert5,visible:M}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Left_palatine_1.geometry,material:U.lambert5,visible:w}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Left_parietal_1.geometry,material:U.lambert5,visible:T}),$.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:N.Left_temporal_1.geometry,material:U.lambert5,visible:E})]})]})})}Zo.preload($l("Skull.gltf"));const Xdt={showCranium:{value:!0,label:"Show Cranium"},showLeftZygomatic:{value:!0,label:"Show Left Zygomatic"},showOccipital:{value:!0,label:"Show Occipital"},showRightLacrimal:{value:!0,label:"Show Right Lacrimal"},showRightMaxilla:{value:!0,label:"Show Right Maxilla"},showRightNasal:{value:!0,label:"Show Right Nasal"},showRightPalatine:{value:!0,label:"Show Right Palatine"},showRightParietal:{value:!0,label:"Show Right Parietal"},showRightTemporal:{value:!0,label:"Show Right Temporal"},showRightZygomatic:{value:!0,label:"Show Right Zygomatic"},showSphenoid:{value:!0,label:"Show Sphenoid"},showTeeth:{value:!0,label:"Show Teeth"},showVomer:{value:!0,label:"Show Vomer"},showEthmoid:{value:!0,label:"Show Ethmoid"},showFrontal:{value:!0,label:"Show Frontal"},showInferiorConchae:{value:!0,label:"Show Inferior Conchae"},showLeftLacrimal:{value:!0,label:"Show Left Lacrimal"},showLeftMaxilla:{value:!0,label:"Show Left Maxilla"},showLeftNasal:{value:!0,label:"Show Left Nasal"},showLeftPalatine:{value:!0,label:"Show Left Palatine"},showLeftParietal:{value:!0,label:"Show Left Parietal"},showLeftTemporal:{value:!0,label:"Show Left Temporal"}},Wdt={showMandible:{value:!0,label:"Show Mandible"},showMandibleBone:{value:!0,label:"Show Mandible Bone"},showMandibleTeeth:{value:!0,label:"Show Bottom Teeth"}};function FJ(n,e){const t={...n};return Object.keys(e).forEach(i=>{Object.hasOwn(t,i)&&(t[i].value=e[i])}),t}function Zdt(n={}){const e=FJ(Xdt,n.cranium?n.cranium:{}),t=FJ(Wdt,n.mandible?n.mandible:{});return Ks(n.controlName?n.controlName:"Skull",{Cranium:Mi(e,{collapsed:!0}),Mandible:Mi(t,{collapsed:!0})},{collapsed:n.collapsed?n.collapsed:!0})}function jdt(){return Ks("Scene",{showGridHelper:{label:"Show Grid Helper",value:!1},showPolarGridHelper:{label:"Show Polar Grid Helper",value:!1},Halo:Mi({haloPosition:{label:"Position",value:{x:0,y:1.5,z:-1}},haloRotation:{label:"Rotation",value:{x:45,y:0,z:0}},haloScale:{label:"Scale",value:12,min:.1,max:12,step:.1},haloVisible:{label:"Visible",value:!0}},{collapsed:!0}),Skull:Mi({skullPosition:{label:"Position",value:{x:0,y:0,z:0}},skullRotation:{label:"Rotation",value:{x:0,y:0,z:0}},skullScale:{label:"Scale",value:.1,min:.01,max:1,step:.01},skullVisible:{label:"Visible",value:!0}},{collapsed:!0}),Cloud:Mi({cloudPosition:{label:"Position",value:{x:0,y:.75,z:0}},cloudRotation:{label:"Rotation",value:{x:0,y:0,z:0}},cloudScale:{label:"Scale",value:.15,min:.01,max:1,step:.01},cloudVisible:{label:"Visible",value:!0}},{collapsed:!0}),Femur:Mi({femurPosition:{label:"Position",value:{x:-3,y:-3,z:-.05}},femurRotation:{label:"Rotation",value:{x:0,y:0,z:-66}},femurScale:{label:"Scale",value:.75,min:.1,max:1,step:.01},femurVisible:{label:"Visible",value:!0}},{collapsed:!0}),Effects:Mi({autoRotateSpeed:{label:"Rotate Speed",value:0,min:-50,max:50},floatSpeed:{label:"Float Speed",value:.5,min:0,max:1,step:.01},pixelationEnabled:{label:"Pixelation Enabled",value:!1},pixelationGranularity:{label:"Pixelation Granularity",value:8,min:0,max:50,step:1},asciiEnabled:{label:"Ascii Enabled",value:!1},asciiBgColor:{label:"Ascii BG Color",value:"#FFFFFF"},asciiFgColor:{label:"Ascii FG Color",value:"#000000"},asciiCharSet:{label:"Ascii Char Set",value:" `.-':_,^=;><+!rc*/z?sLTv)J7(|Fi{C}fI31tlu[neoZ5Yxjya]2ESwqkP6h9d4VpOGbUAKXHm8RD#$Bg0MNWQ%&@"},asciiInvert:{label:"Ascii Invert",value:!1},asciiColorize:{label:"Ascii Colorize",value:!0},asciiResolution:{label:"Ascii Resolution",value:.25,min:.1,max:.4,step:.01}},{collapsed:!0})},{collapsed:!0})}function Ydt(){return Ks("Cloud",{seed:{value:Jht(1,100),min:1,max:100,step:1},segments:{value:50,min:1,max:80,step:1},volume:{value:6,min:0,max:100,step:.1},opacity:{value:.8,min:0,max:1,step:.01},fade:{value:0,min:0,max:400,step:1},growth:{value:4,min:0,max:20,step:1},speed:{value:.5,min:0,max:1,step:.01},x:{value:6,min:0,max:10,step:1},y:{value:1,min:0,max:10,step:1},z:{value:1,min:0,max:10,step:1},color:"#bababa"},{collapsed:!0})}function Kdt(){return Ks("Halo",{innerRadius:{label:"Inner Radius",value:.5,min:.1,max:2,step:.1},outerRadius:{label:"Outer Radius",value:2,min:2,max:20,step:.1},style:{label:"Style",value:"default",options:{Default:"default",Gradient:"gradient"}},start:{label:"Start",value:"#FFFFFF",render:n=>n("Halo.style")==="gradient"},end:{label:"End",value:"#000000",render:n=>n("Halo.style")==="gradient"},steps:{label:"Steps",value:8,min:2,max:20,step:1,render:n=>n("Halo.style")==="gradient"},sm:{value:.1,min:.1,max:3,step:.1,render:n=>n("Halo.style")==="default"},med:{value:1,min:.1,max:3,step:.1,render:n=>n("Halo.style")==="default"},lg:{value:2,min:.1,max:3,step:.1,render:n=>n("Halo.style")==="default"},xl:{value:3,min:.1,max:3,step:.1,render:n=>n("Halo.style")==="default"},silver:{label:"Silver",value:"#c1c1c1",render:n=>n("Halo.style")==="default"},white:{label:"White",value:"#ffffff",render:n=>n("Halo.style")==="default"},black:{label:"Black",value:"#000000",render:n=>n("Halo.style")==="default"},blue:{label:"Blue",value:"#0023ff",render:n=>n("Halo.style")==="default"},lightblue:{label:"Light Blue",value:"#69d8ff",render:n=>n("Halo.style")==="default"}},{collapsed:!0})}function $dt(n){const{innerRadius:e,outerRadius:t,style:i,start:r,end:s,steps:a,sm:o,med:l,lg:u,xl:c,silver:d,white:f,black:m,blue:y,lightblue:_}=n,S=t-e,b=uSe(r,s,a).map(E=>({width:S/a,color:E})),M=[{width:u,color:d},{width:o,color:m},{width:l,color:f},{width:c,color:m},{width:c,color:y},{width:c,color:_},{width:o,color:m},{width:u,color:d}],w=M.reduce((E,R)=>E+R.width,0),T=i==="gradient"?b:M.map(E=>{const R=E.width/w*S,P=Math.round(R*100)/100;return{...E,width:P}});return{innerRadius:e,rings:T}}function Jdt(){const n=jdt(),e=Zdt({cranium:{showRightParietal:!1,showRightTemporal:!1,showTeeth:!1,showLeftParietal:!1,showLeftTemporal:!1},mandible:{showMandible:!1}}),t=Ydt(),i=Kdt();return $.jsxs($.Fragment,{children:[$.jsx(PA,{}),$.jsx(Ob,{makeDefault:!0,position:[-1,-1,3.5]}),$.jsx(lSe,{x:!0,y:!0,z:!0,visible:n.showGridHelper}),$.jsx(edt,{x:!0,y:!0,z:!0,visible:n.showPolarGridHelper}),$.jsx(mA,{autoRotate:!0,enableDamping:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,autoRotateSpeed:n.autoRotateSpeed}),$.jsxs(IWe,{speed:n.floatSpeed,children:[$.jsx(zdt,{visible:n.haloVisible,position:[n.haloPosition.x,n.haloPosition.y,n.haloPosition.z],rotation:[Ba(n.haloRotation.x),Ba(n.haloRotation.y),Ba(n.haloRotation.z)],...$dt(i)}),$.jsx(Hdt,{...e,position:[n.skullPosition.x,n.skullPosition.y,n.skullPosition.z],rotation:[Ba(n.skullRotation.x),Ba(n.skullRotation.y),Ba(n.skullRotation.z)],scale:n.skullScale,visible:n.skullVisible}),$.jsx(GH,{visible:n.cloudVisible,children:$.jsx(Qle,{position:[n.cloudPosition.x,n.cloudPosition.y,n.cloudPosition.z],rotation:[Ba(n.cloudRotation.x),Ba(n.cloudRotation.y),Ba(n.cloudRotation.z)],bounds:[t.x,t.y,t.z],scale:n.cloudScale,...t,castShadow:!0,receiveShadow:!0})}),$.jsx(Udt,{position:[n.femurPosition.x,n.femurPosition.y,n.femurPosition.z],rotation:[Ba(n.femurRotation.x),Ba(n.femurRotation.y),Ba(n.femurRotation.z)],scale:n.femurScale,visible:n.femurVisible})]}),n.asciiEnabled&&$.jsx(lWe,{bgColor:n.asciiBgColor,fgColor:n.asciiFgColor,characters:n.asciiCharSet,invert:n.asciiInvert,color:n.asciiColorize,resolution:n.asciiResolution}),$.jsx(uue,{children:$.jsx(cue,{granularity:n.pixelationEnabled?n.pixelationGranularity:0})})]})}const dSe=0,qdt=1,Qdt=2,LJ=2,KU=1.25,IJ=1,rB=32,uI=65535,eft=Math.pow(2,-24),$U=Symbol("SKIP_GENERATION");function tft(n){return n.index?n.index.count:n.attributes.position.count}function DA(n){return tft(n)/3}function nft(n,e=ArrayBuffer){return n>65535?new Uint32Array(new e(4*n)):new Uint16Array(new e(2*n))}function ift(n,e){if(!n.index){const t=n.attributes.position.count,i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=nft(t,i);n.setIndex(new Gi(r,1));for(let s=0;s<t;s++)r[s]=s}}function fSe(n){const e=DA(n),t=n.drawRange,i=t.start/3,r=(t.start+t.count)/3,s=Math.max(0,i),a=Math.min(e,r)-s;return[{offset:Math.floor(s),count:Math.floor(a)}]}function pSe(n){if(!n.groups||!n.groups.length)return fSe(n);const e=[],t=new Set,i=n.drawRange,r=i.start/3,s=(i.start+i.count)/3;for(const o of n.groups){const l=o.start/3,u=(o.start+o.count)/3;t.add(Math.max(r,l)),t.add(Math.min(s,u))}const a=Array.from(t.values()).sort((o,l)=>o-l);for(let o=0;o<a.length-1;o++){const l=a[o],u=a[o+1];e.push({offset:Math.floor(l),count:Math.floor(u-l)})}return e}function rft(n){if(n.groups.length===0)return!1;const e=DA(n),t=pSe(n).sort((s,a)=>s.offset-a.offset),i=t[t.length-1];i.count=Math.min(e-i.offset,i.count);let r=0;return t.forEach(({count:s})=>r+=s),e!==r}function Ja(n,e,t){return t.min.x=e[n],t.min.y=e[n+1],t.min.z=e[n+2],t.max.x=e[n+3],t.max.y=e[n+4],t.max.z=e[n+5],t}function sft(n){n[0]=n[1]=n[2]=1/0,n[3]=n[4]=n[5]=-1/0}function GJ(n){let e=-1,t=-1/0;for(let i=0;i<3;i++){const r=n[i+3]-n[i];r>t&&(t=r,e=i)}return e}function OJ(n,e){e.set(n)}function UJ(n,e,t){let i,r;for(let s=0;s<3;s++){const a=s+3;i=n[s],r=e[s],t[s]=i<r?i:r,i=n[a],r=e[a],t[a]=i>r?i:r}}function xN(n,e,t){for(let i=0;i<3;i++){const r=e[n+2*i],s=e[n+2*i+1],a=r-s,o=r+s;a<t[i]&&(t[i]=a),o>t[i+3]&&(t[i+3]=o)}}function VC(n){const e=n[3]-n[0],t=n[4]-n[1],i=n[5]-n[2];return 2*(e*t+t*i+i*e)}function JU(n,e,t,i,r=null){let s=1/0,a=1/0,o=1/0,l=-1/0,u=-1/0,c=-1/0,d=1/0,f=1/0,m=1/0,y=-1/0,_=-1/0,S=-1/0;const b=r!==null;for(let M=e*6,w=(e+t)*6;M<w;M+=6){const T=n[M+0],E=n[M+1],R=T-E,P=T+E;R<s&&(s=R),P>l&&(l=P),b&&T<d&&(d=T),b&&T>y&&(y=T);const I=n[M+2],B=n[M+3],N=I-B,U=I+B;N<a&&(a=N),U>u&&(u=U),b&&I<f&&(f=I),b&&I>_&&(_=I);const V=n[M+4],W=n[M+5],K=V-W,q=V+W;K<o&&(o=K),q>c&&(c=q),b&&V<m&&(m=V),b&&V>S&&(S=V)}i[0]=s,i[1]=a,i[2]=o,i[3]=l,i[4]=u,i[5]=c,b&&(r[0]=d,r[1]=f,r[2]=m,r[3]=y,r[4]=_,r[5]=S)}function aft(n,e,t,i){let r=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,u=-1/0;for(let c=e*6,d=(e+t)*6;c<d;c+=6){const f=n[c+0];f<r&&(r=f),f>o&&(o=f);const m=n[c+2];m<s&&(s=m),m>l&&(l=m);const y=n[c+4];y<a&&(a=y),y>u&&(u=y)}i[0]=r,i[1]=s,i[2]=a,i[3]=o,i[4]=l,i[5]=u}function oft(n,e){sft(e);const t=n.attributes.position,i=n.index?n.index.array:null,r=DA(n),s=new Float32Array(r*6),a=t.normalized,o=t.array,l=t.offset||0;let u=3;t.isInterleavedBufferAttribute&&(u=t.data.stride);const c=["getX","getY","getZ"];for(let d=0;d<r;d++){const f=d*3,m=d*6;let y=f+0,_=f+1,S=f+2;i&&(y=i[y],_=i[_],S=i[S]),a||(y=y*u+l,_=_*u+l,S=S*u+l);for(let b=0;b<3;b++){let M,w,T;a?(M=t[c[b]](y),w=t[c[b]](_),T=t[c[b]](S)):(M=o[y+b],w=o[_+b],T=o[S+b]);let E=M;w<E&&(E=w),T<E&&(E=T);let R=M;w>R&&(R=w),T>R&&(R=T);const P=(R-E)/2,I=b*2;s[m+I+0]=E+P,s[m+I+1]=P+(Math.abs(E)+P)*eft,E<e[b]&&(e[b]=E),R>e[b+3]&&(e[b+3]=R)}}return s}const Fg=32,lft=(n,e)=>n.candidate-e.candidate,Py=new Array(Fg).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),bN=new Float32Array(6);function uft(n,e,t,i,r,s){let a=-1,o=0;if(s===dSe)a=GJ(e),a!==-1&&(o=(e[a]+e[a+3])/2);else if(s===qdt)a=GJ(n),a!==-1&&(o=cft(t,i,r,a));else if(s===Qdt){const l=VC(n);let u=KU*r;const c=i*6,d=(i+r)*6;for(let f=0;f<3;f++){const m=e[f],S=(e[f+3]-m)/Fg;if(r<Fg/4){const b=[...Py];b.length=r;let M=0;for(let T=c;T<d;T+=6,M++){const E=b[M];E.candidate=t[T+2*f],E.count=0;const{bounds:R,leftCacheBounds:P,rightCacheBounds:I}=E;for(let B=0;B<3;B++)I[B]=1/0,I[B+3]=-1/0,P[B]=1/0,P[B+3]=-1/0,R[B]=1/0,R[B+3]=-1/0;xN(T,t,R)}b.sort(lft);let w=r;for(let T=0;T<w;T++){const E=b[T];for(;T+1<w&&b[T+1].candidate===E.candidate;)b.splice(T+1,1),w--}for(let T=c;T<d;T+=6){const E=t[T+2*f];for(let R=0;R<w;R++){const P=b[R];E>=P.candidate?xN(T,t,P.rightCacheBounds):(xN(T,t,P.leftCacheBounds),P.count++)}}for(let T=0;T<w;T++){const E=b[T],R=E.count,P=r-E.count,I=E.leftCacheBounds,B=E.rightCacheBounds;let N=0;R!==0&&(N=VC(I)/l);let U=0;P!==0&&(U=VC(B)/l);const V=IJ+KU*(N*R+U*P);V<u&&(a=f,u=V,o=E.candidate)}}else{for(let w=0;w<Fg;w++){const T=Py[w];T.count=0,T.candidate=m+S+w*S;const E=T.bounds;for(let R=0;R<3;R++)E[R]=1/0,E[R+3]=-1/0}for(let w=c;w<d;w+=6){let R=~~((t[w+2*f]-m)/S);R>=Fg&&(R=Fg-1);const P=Py[R];P.count++,xN(w,t,P.bounds)}const b=Py[Fg-1];OJ(b.bounds,b.rightCacheBounds);for(let w=Fg-2;w>=0;w--){const T=Py[w],E=Py[w+1];UJ(T.bounds,E.rightCacheBounds,T.rightCacheBounds)}let M=0;for(let w=0;w<Fg-1;w++){const T=Py[w],E=T.count,R=T.bounds,I=Py[w+1].rightCacheBounds;E!==0&&(M===0?OJ(R,bN):UJ(R,bN,bN)),M+=E;let B=0,N=0;M!==0&&(B=VC(bN)/l);const U=r-M;U!==0&&(N=VC(I)/l);const V=IJ+KU*(B*M+N*U);V<u&&(a=f,u=V,o=T.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function cft(n,e,t,i){let r=0;for(let s=e,a=e+t;s<a;s++)r+=n[s*6+i*2];return r/t}class _N{constructor(){}}function hft(n,e,t,i,r,s){let a=i,o=i+r-1;const l=s.pos,u=s.axis*2;for(;;){for(;a<=o&&t[a*6+u]<l;)a++;for(;a<=o&&t[o*6+u]>=l;)o--;if(a<o){for(let c=0;c<3;c++){let d=e[a*3+c];e[a*3+c]=e[o*3+c],e[o*3+c]=d}for(let c=0;c<6;c++){let d=t[a*6+c];t[a*6+c]=t[o*6+c],t[o*6+c]=d}a++,o--}else return a}}function dft(n,e,t,i,r,s){let a=i,o=i+r-1;const l=s.pos,u=s.axis*2;for(;;){for(;a<=o&&t[a*6+u]<l;)a++;for(;a<=o&&t[o*6+u]>=l;)o--;if(a<o){let c=n[a];n[a]=n[o],n[o]=c;for(let d=0;d<6;d++){let f=t[a*6+d];t[a*6+d]=t[o*6+d],t[o*6+d]=f}a++,o--}else return a}}function fft(n,e){const t=(n.index?n.index.count:n.attributes.position.count)/3,i=t>2**16,r=i?4:2,s=e?new SharedArrayBuffer(t*r):new ArrayBuffer(t*r),a=i?new Uint32Array(s):new Uint16Array(s);for(let o=0,l=a.length;o<l;o++)a[o]=o;return a}function pft(n,e){const t=n.geometry,i=t.index?t.index.array:null,r=e.maxDepth,s=e.verbose,a=e.maxLeafTris,o=e.strategy,l=e.onProgress,u=DA(t),c=n._indirectBuffer;let d=!1;const f=new Float32Array(6),m=new Float32Array(6),y=oft(t,f),_=e.indirect?dft:hft,S=[],b=e.indirect?fSe(t):pSe(t);if(b.length===1){const T=b[0],E=new _N;E.boundingData=f,aft(y,T.offset,T.count,m),w(E,T.offset,T.count,m),S.push(E)}else for(let T of b){const E=new _N;E.boundingData=new Float32Array(6),JU(y,T.offset,T.count,E.boundingData,m),w(E,T.offset,T.count,m),S.push(E)}return S;function M(T){l&&l(T/u)}function w(T,E,R,P=null,I=0){if(!d&&I>=r&&(d=!0,s&&(console.warn(`MeshBVH: Max depth of ${r} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),R<=a||I>=r)return M(E+R),T.offset=E,T.count=R,T;const B=uft(T.boundingData,P,y,E,R,o);if(B.axis===-1)return M(E+R),T.offset=E,T.count=R,T;const N=_(c,i,y,E,R,B);if(N===E||N===E+R)M(E+R),T.offset=E,T.count=R;else{T.splitAxis=B.axis;const U=new _N,V=E,W=N-E;T.left=U,U.boundingData=new Float32Array(6),JU(y,V,W,U.boundingData,m),w(U,V,W,m,I+1);const K=new _N,q=N,j=R-W;T.right=K,K.boundingData=new Float32Array(6),JU(y,q,j,K.boundingData,m),w(K,q,j,m,I+1)}return T}}function mft(n,e){const t=n.geometry;e.indirect&&(n._indirectBuffer=fft(t,e.useSharedArrayBuffer),rft(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||ift(t,e);const i=pft(n,e);let r,s,a;const o=[],l=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<i.length;d++){const f=i[d];let m=u(f);const y=new l(rB*m);r=new Float32Array(y),s=new Uint32Array(y),a=new Uint16Array(y),c(0,f),o.push(y)}n._roots=o;return;function u(d){return d.count?1:1+u(d.left)+u(d.right)}function c(d,f){const m=d/4,y=d/2,_=!!f.count,S=f.boundingData;for(let b=0;b<6;b++)r[m+b]=S[b];if(_){const b=f.offset,M=f.count;return s[m+6]=b,a[y+14]=M,a[y+15]=uI,d+rB}else{const b=f.left,M=f.right,w=f.splitAxis;let T;if(T=c(d+rB,b),T/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[m+6]=T/4,T=c(T,M),s[m+7]=w,T}}}class b0{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let s=0,a=e.length;s<a;s++){const l=e[s][t];i=l<i?l:i,r=l>r?l:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let s=0,a=t.length;s<a;s++){const o=t[s],l=e.dot(o);i=l<i?l:i,r=l>r?l:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}b0.prototype.setFromBox=(function(){const n=new re;return function(t,i){const r=i.min,s=i.max;let a=1/0,o=-1/0;for(let l=0;l<=1;l++)for(let u=0;u<=1;u++)for(let c=0;c<=1;c++){n.x=r.x*l+s.x*(1-l),n.y=r.y*u+s.y*(1-u),n.z=r.z*c+s.z*(1-c);const d=t.dot(n);a=Math.min(d,a),o=Math.max(d,o)}this.min=a,this.max=o}})();const gft=(function(){const n=new re,e=new re,t=new re;return function(r,s,a){const o=r.start,l=n,u=s.start,c=e;t.subVectors(o,u),n.subVectors(r.end,r.start),e.subVectors(s.end,s.start);const d=t.dot(c),f=c.dot(l),m=c.dot(c),y=t.dot(l),S=l.dot(l)*m-f*f;let b,M;S!==0?b=(d*f-y*m)/S:b=0,M=(d+b*f)/m,a.x=b,a.y=M}})(),G8=(function(){const n=new rt,e=new re,t=new re;return function(r,s,a,o){gft(r,s,n);let l=n.x,u=n.y;if(l>=0&&l<=1&&u>=0&&u<=1){r.at(l,a),s.at(u,o);return}else if(l>=0&&l<=1){u<0?s.at(0,o):s.at(1,o),r.closestPointToPoint(o,!0,a);return}else if(u>=0&&u<=1){l<0?r.at(0,a):r.at(1,a),s.closestPointToPoint(a,!0,o);return}else{let c;l<0?c=r.start:c=r.end;let d;u<0?d=s.start:d=s.end;const f=e,m=t;if(r.closestPointToPoint(d,!0,e),s.closestPointToPoint(c,!0,t),f.distanceToSquared(d)<=m.distanceToSquared(c)){a.copy(f),o.copy(d);return}else{a.copy(c),o.copy(m);return}}}})(),yft=(function(){const n=new re,e=new re,t=new Xl,i=new Hc;return function(s,a){const{radius:o,center:l}=s,{a:u,b:c,c:d}=a;if(i.start=u,i.end=c,i.closestPointToPoint(l,!0,n).distanceTo(l)<=o||(i.start=u,i.end=d,i.closestPointToPoint(l,!0,n).distanceTo(l)<=o)||(i.start=c,i.end=d,i.closestPointToPoint(l,!0,n).distanceTo(l)<=o))return!0;const _=a.getPlane(t);if(Math.abs(_.distanceToPoint(l))<=o){const b=_.projectPoint(l,e);if(a.containsPoint(b))return!0}return!1}})(),vft=1e-15;function qU(n){return Math.abs(n)<vft}class Vd extends Vs{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new re),this.satBounds=new Array(4).fill().map(()=>new b0),this.points=[this.a,this.b,this.c],this.sphere=new fo,this.plane=new Xl,this.needsUpdate=!0}intersectsSphere(e){return yft(e,this)}update(){const e=this.a,t=this.b,i=this.c,r=this.points,s=this.satAxes,a=this.satBounds,o=s[0],l=a[0];this.getNormal(o),l.setFromPoints(o,r);const u=s[1],c=a[1];u.subVectors(e,t),c.setFromPoints(u,r);const d=s[2],f=a[2];d.subVectors(t,i),f.setFromPoints(d,r);const m=s[3],y=a[3];m.subVectors(i,e),y.setFromPoints(m,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}Vd.prototype.closestPointToSegment=(function(){const n=new re,e=new re,t=new Hc;return function(r,s=null,a=null){const{start:o,end:l}=r,u=this.points;let c,d=1/0;for(let f=0;f<3;f++){const m=(f+1)%3;t.start.copy(u[f]),t.end.copy(u[m]),G8(t,r,n,e),c=n.distanceToSquared(e),c<d&&(d=c,s&&s.copy(n),a&&a.copy(e))}return this.closestPointToPoint(o,n),c=o.distanceToSquared(n),c<d&&(d=c,s&&s.copy(n),a&&a.copy(o)),this.closestPointToPoint(l,n),c=l.distanceToSquared(n),c<d&&(d=c,s&&s.copy(n),a&&a.copy(l)),Math.sqrt(d)}})();Vd.prototype.intersectsTriangle=(function(){const n=new Vd,e=new Array(3),t=new Array(3),i=new b0,r=new b0,s=new re,a=new re,o=new re,l=new re,u=new re,c=new Hc,d=new Hc,f=new Hc,m=new re;function y(_,S,b){const M=_.points;let w=0,T=-1;for(let E=0;E<3;E++){const{start:R,end:P}=c;R.copy(M[E]),P.copy(M[(E+1)%3]),c.delta(a);const I=qU(S.distanceToPoint(R));if(qU(S.normal.dot(a))&&I){b.copy(c),w=2;break}const B=S.intersectLine(c,m);if(!B&&I&&m.copy(R),(B||I)&&!qU(m.distanceTo(P))){if(w<=1)(w===1?b.start:b.end).copy(m),I&&(T=w);else if(w>=2){(T===1?b.start:b.end).copy(m),w=2;break}if(w++,w===2&&T===-1)break}}return w}return function(S,b=null,M=!1){this.needsUpdate&&this.update(),S.isExtendedTriangle?S.needsUpdate&&S.update():(n.copy(S),n.update(),S=n);const w=this.plane,T=S.plane;if(Math.abs(w.normal.dot(T.normal))>1-1e-10){const E=this.satBounds,R=this.satAxes;t[0]=S.a,t[1]=S.b,t[2]=S.c;for(let B=0;B<4;B++){const N=E[B],U=R[B];if(i.setFromPoints(U,t),N.isSeparated(i))return!1}const P=S.satBounds,I=S.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let B=0;B<4;B++){const N=P[B],U=I[B];if(i.setFromPoints(U,e),N.isSeparated(i))return!1}for(let B=0;B<4;B++){const N=R[B];for(let U=0;U<4;U++){const V=I[U];if(s.crossVectors(N,V),i.setFromPoints(s,e),r.setFromPoints(s,t),i.isSeparated(r))return!1}}return b&&(M||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),b.start.set(0,0,0),b.end.set(0,0,0)),!0}else{const E=y(this,T,d);if(E===1&&S.containsPoint(d.end))return b&&(b.start.copy(d.end),b.end.copy(d.end)),!0;if(E!==2)return!1;const R=y(S,w,f);if(R===1&&this.containsPoint(f.end))return b&&(b.start.copy(f.end),b.end.copy(f.end)),!0;if(R!==2)return!1;if(d.delta(o),f.delta(l),o.dot(l)<0){let W=f.start;f.start=f.end,f.end=W}const P=d.start.dot(o),I=d.end.dot(o),B=f.start.dot(o),N=f.end.dot(o),U=I<B,V=P<N;return P!==N&&B!==I&&U===V?!1:(b&&(u.subVectors(d.start,f.start),u.dot(o)>0?b.start.copy(d.start):b.start.copy(f.start),u.subVectors(d.end,f.end),u.dot(o)<0?b.end.copy(d.end):b.end.copy(f.end)),!0)}}})();Vd.prototype.distanceToPoint=(function(){const n=new re;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}})();Vd.prototype.distanceToTriangle=(function(){const n=new re,e=new re,t=["a","b","c"],i=new Hc,r=new Hc;return function(a,o=null,l=null){const u=o||l?i:null;if(this.intersectsTriangle(a,u))return(o||l)&&(o&&u.getCenter(o),l&&u.getCenter(l)),0;let c=1/0;for(let d=0;d<3;d++){let f;const m=t[d],y=a[m];this.closestPointToPoint(y,n),f=y.distanceToSquared(n),f<c&&(c=f,o&&o.copy(n),l&&l.copy(y));const _=this[m];a.closestPointToPoint(_,n),f=_.distanceToSquared(n),f<c&&(c=f,o&&o.copy(_),l&&l.copy(n))}for(let d=0;d<3;d++){const f=t[d],m=t[(d+1)%3];i.set(this[f],this[m]);for(let y=0;y<3;y++){const _=t[y],S=t[(y+1)%3];r.set(a[_],a[S]),G8(i,r,n,e);const b=n.distanceToSquared(e);b<c&&(c=b,o&&o.copy(n),l&&l.copy(e))}}return Math.sqrt(c)}})();class oc{constructor(e,t,i){this.isOrientedBox=!0,this.min=new re,this.max=new re,this.matrix=new Mn,this.invMatrix=new Mn,this.points=new Array(8).fill().map(()=>new re),this.satAxes=new Array(3).fill().map(()=>new re),this.satBounds=new Array(3).fill().map(()=>new b0),this.alignedSatBounds=new Array(3).fill().map(()=>new b0),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}oc.prototype.update=(function(){return function(){const e=this.matrix,t=this.min,i=this.max,r=this.points;for(let u=0;u<=1;u++)for(let c=0;c<=1;c++)for(let d=0;d<=1;d++){const f=1*u|2*c|4*d,m=r[f];m.x=u?i.x:t.x,m.y=c?i.y:t.y,m.z=d?i.z:t.z,m.applyMatrix4(e)}const s=this.satBounds,a=this.satAxes,o=r[0];for(let u=0;u<3;u++){const c=a[u],d=s[u],f=1<<u,m=r[f];c.subVectors(o,m),d.setFromPoints(c,r)}const l=this.alignedSatBounds;l[0].setFromPointsField(r,"x"),l[1].setFromPointsField(r,"y"),l[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}})();oc.prototype.intersectsBox=(function(){const n=new b0;return function(t){this.needsUpdate&&this.update();const i=t.min,r=t.max,s=this.satBounds,a=this.satAxes,o=this.alignedSatBounds;if(n.min=i.x,n.max=r.x,o[0].isSeparated(n)||(n.min=i.y,n.max=r.y,o[1].isSeparated(n))||(n.min=i.z,n.max=r.z,o[2].isSeparated(n)))return!1;for(let l=0;l<3;l++){const u=a[l],c=s[l];if(n.setFromBox(u,t),c.isSeparated(n))return!1}return!0}})();oc.prototype.intersectsTriangle=(function(){const n=new Vd,e=new Array(3),t=new b0,i=new b0,r=new re;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(n.copy(a),n.update(),a=n);const o=this.satBounds,l=this.satAxes;e[0]=a.a,e[1]=a.b,e[2]=a.c;for(let f=0;f<3;f++){const m=o[f],y=l[f];if(t.setFromPoints(y,e),m.isSeparated(t))return!1}const u=a.satBounds,c=a.satAxes,d=this.points;for(let f=0;f<3;f++){const m=u[f],y=c[f];if(t.setFromPoints(y,d),m.isSeparated(t))return!1}for(let f=0;f<3;f++){const m=l[f];for(let y=0;y<4;y++){const _=c[y];if(r.crossVectors(m,_),t.setFromPoints(r,e),i.setFromPoints(r,d),t.isSeparated(i))return!1}}return!0}})();oc.prototype.closestPointToPoint=(function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}})();oc.prototype.distanceToPoint=(function(){const n=new re;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}})();oc.prototype.distanceToBox=(function(){const n=["x","y","z"],e=new Array(12).fill().map(()=>new Hc),t=new Array(12).fill().map(()=>new Hc),i=new re,r=new re;return function(a,o=0,l=null,u=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(l||u)&&(a.getCenter(r),this.closestPointToPoint(r,i),a.closestPointToPoint(i,r),l&&l.copy(i),u&&u.copy(r)),0;const c=o*o,d=a.min,f=a.max,m=this.points;let y=1/0;for(let S=0;S<8;S++){const b=m[S];r.copy(b).clamp(d,f);const M=b.distanceToSquared(r);if(M<y&&(y=M,l&&l.copy(b),u&&u.copy(r),M<c))return Math.sqrt(M)}let _=0;for(let S=0;S<3;S++)for(let b=0;b<=1;b++)for(let M=0;M<=1;M++){const w=(S+1)%3,T=(S+2)%3,E=b<<w|M<<T,R=1<<S|b<<w|M<<T,P=m[E],I=m[R];e[_].set(P,I);const N=n[S],U=n[w],V=n[T],W=t[_],K=W.start,q=W.end;K[N]=d[N],K[U]=b?d[U]:f[U],K[V]=M?d[V]:f[U],q[N]=f[N],q[U]=b?d[U]:f[U],q[V]=M?d[V]:f[U],_++}for(let S=0;S<=1;S++)for(let b=0;b<=1;b++)for(let M=0;M<=1;M++){r.x=S?f.x:d.x,r.y=b?f.y:d.y,r.z=M?f.z:d.z,this.closestPointToPoint(r,i);const w=r.distanceToSquared(i);if(w<y&&(y=w,l&&l.copy(i),u&&u.copy(r),w<c))return Math.sqrt(w)}for(let S=0;S<12;S++){const b=e[S];for(let M=0;M<12;M++){const w=t[M];G8(b,w,i,r);const T=i.distanceToSquared(r);if(T<y&&(y=T,l&&l.copy(i),u&&u.copy(r),T<c))return Math.sqrt(T)}}return Math.sqrt(y)}})();class O8{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class xft extends O8{constructor(){super(()=>new Vd)}}const Pd=new xft;function vh(n,e){return e[n+15]===65535}function Sh(n,e){return e[n+6]}function Dd(n,e){return e[n+14]}function Nd(n){return n+8}function Bd(n,e){return e[n+6]}function mSe(n,e){return e[n+7]}class bft{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=i=>{t&&e.push(t),t=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const Aa=new bft;let Qy,WS;const AS=[],SN=new O8(()=>new Ns);function _ft(n,e,t,i,r,s){Qy=SN.getPrimitive(),WS=SN.getPrimitive(),AS.push(Qy,WS),Aa.setBuffer(n._roots[e]);const a=Dz(0,n.geometry,t,i,r,s);Aa.clearBuffer(),SN.releasePrimitive(Qy),SN.releasePrimitive(WS),AS.pop(),AS.pop();const o=AS.length;return o>0&&(WS=AS[o-1],Qy=AS[o-2]),a}function Dz(n,e,t,i,r=null,s=0,a=0){const{float32Array:o,uint16Array:l,uint32Array:u}=Aa;let c=n*2;if(vh(c,l)){const f=Sh(n,u),m=Dd(c,l);return Ja(n,o,Qy),i(f,m,!1,a,s+n,Qy)}else{let N=function(V){const{uint16Array:W,uint32Array:K}=Aa;let q=V*2;for(;!vh(q,W);)V=Nd(V),q=V*2;return Sh(V,K)},U=function(V){const{uint16Array:W,uint32Array:K}=Aa;let q=V*2;for(;!vh(q,W);)V=Bd(V,K),q=V*2;return Sh(V,K)+Dd(q,W)};const f=Nd(n),m=Bd(n,u);let y=f,_=m,S,b,M,w;if(r&&(M=Qy,w=WS,Ja(y,o,M),Ja(_,o,w),S=r(M),b=r(w),b<S)){y=m,_=f;const V=S;S=b,b=V,M=w}M||(M=Qy,Ja(y,o,M));const T=vh(y*2,l),E=t(M,T,S,a+1,s+y);let R;if(E===LJ){const V=N(y),K=U(y)-V;R=i(V,K,!0,a+1,s+y,M)}else R=E&&Dz(y,e,t,i,r,s,a+1);if(R)return!0;w=WS,Ja(_,o,w);const P=vh(_*2,l),I=t(w,P,b,a+1,s+_);let B;if(I===LJ){const V=N(_),K=U(_)-V;B=i(V,K,!0,a+1,s+_,w)}else B=I&&Dz(_,e,t,i,r,s,a+1);return!!B}}const HC=new re,QU=new re;function Sft(n,e,t={},i=0,r=1/0){const s=i*i,a=r*r;let o=1/0,l=null;if(n.shapecast({boundsTraverseOrder:c=>(HC.copy(e).clamp(c.min,c.max),HC.distanceToSquared(e)),intersectsBounds:(c,d,f)=>f<o&&f<a,intersectsTriangle:(c,d)=>{c.closestPointToPoint(e,HC);const f=e.distanceToSquared(HC);return f<o&&(QU.copy(HC),o=f,l=d),f<s}}),o===1/0)return null;const u=Math.sqrt(o);return t.point?t.point.copy(QU):t.point=QU.clone(),t.distance=u,t.faceIndex=l,t}const TS=new re,CS=new re,wS=new re,MN=new rt,AN=new rt,TN=new rt,kJ=new re,zJ=new re,VJ=new re,CN=new re;function Mft(n,e,t,i,r,s){let a;return s===Er?a=n.intersectTriangle(i,t,e,!0,r):a=n.intersectTriangle(e,t,i,s!==fr,r),a===null?null:{distance:n.origin.distanceTo(r),point:r.clone()}}function Aft(n,e,t,i,r,s,a,o,l){TS.fromBufferAttribute(e,s),CS.fromBufferAttribute(e,a),wS.fromBufferAttribute(e,o);const u=Mft(n,TS,CS,wS,CN,l);if(u){i&&(MN.fromBufferAttribute(i,s),AN.fromBufferAttribute(i,a),TN.fromBufferAttribute(i,o),u.uv=Vs.getInterpolation(CN,TS,CS,wS,MN,AN,TN,new rt)),r&&(MN.fromBufferAttribute(r,s),AN.fromBufferAttribute(r,a),TN.fromBufferAttribute(r,o),u.uv1=Vs.getInterpolation(CN,TS,CS,wS,MN,AN,TN,new rt)),t&&(kJ.fromBufferAttribute(t,s),zJ.fromBufferAttribute(t,a),VJ.fromBufferAttribute(t,o),u.normal=Vs.getInterpolation(CN,TS,CS,wS,kJ,zJ,VJ,new re),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const c={a:s,b:a,c:o,normal:new re,materialIndex:0};Vs.getNormal(TS,CS,wS,c.normal),u.face=c,u.faceIndex=s}return u}function cI(n,e,t,i,r){const s=i*3;let a=s+0,o=s+1,l=s+2;const u=n.index;n.index&&(a=u.getX(a),o=u.getX(o),l=u.getX(l));const{position:c,normal:d,uv:f,uv1:m}=n.attributes,y=Aft(t,c,d,f,m,a,o,l,e);return y?(y.faceIndex=i,r&&r.push(y),y):null}function Ho(n,e,t,i){const r=n.a,s=n.b,a=n.c;let o=e,l=e+1,u=e+2;t&&(o=t.getX(o),l=t.getX(l),u=t.getX(u)),r.x=i.getX(o),r.y=i.getY(o),r.z=i.getZ(o),s.x=i.getX(l),s.y=i.getY(l),s.z=i.getZ(l),a.x=i.getX(u),a.y=i.getY(u),a.z=i.getZ(u)}function Tft(n,e,t,i,r,s){const{geometry:a,_indirectBuffer:o}=n;for(let l=i,u=i+r;l<u;l++)cI(a,e,t,l,s)}function Cft(n,e,t,i,r){const{geometry:s,_indirectBuffer:a}=n;let o=1/0,l=null;for(let u=i,c=i+r;u<c;u++){let d;d=cI(s,e,t,u),d&&d.distance<o&&(l=d,o=d.distance)}return l}function wft(n,e,t,i,r,s,a){const{geometry:o}=t,{index:l}=o,u=o.attributes.position;for(let c=n,d=e+n;c<d;c++){let f;if(f=c,Ho(a,f*3,l,u),a.needsUpdate=!0,i(a,f,r,s))return!0}return!1}function Eft(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=n.geometry,i=t.index?t.index.array:null,r=t.attributes.position;let s,a,o,l,u=0;const c=n._roots;for(let f=0,m=c.length;f<m;f++)s=c[f],a=new Uint32Array(s),o=new Uint16Array(s),l=new Float32Array(s),d(0,u),u+=s.byteLength;function d(f,m,y=!1){const _=f*2;if(o[_+15]===uI){const b=a[f+6],M=o[_+14];let w=1/0,T=1/0,E=1/0,R=-1/0,P=-1/0,I=-1/0;for(let B=3*b,N=3*(b+M);B<N;B++){let U=i[B];const V=r.getX(U),W=r.getY(U),K=r.getZ(U);V<w&&(w=V),V>R&&(R=V),W<T&&(T=W),W>P&&(P=W),K<E&&(E=K),K>I&&(I=K)}return l[f+0]!==w||l[f+1]!==T||l[f+2]!==E||l[f+3]!==R||l[f+4]!==P||l[f+5]!==I?(l[f+0]=w,l[f+1]=T,l[f+2]=E,l[f+3]=R,l[f+4]=P,l[f+5]=I,!0):!1}else{const b=f+8,M=a[f+6],w=b+m,T=M+m;let E=y,R=!1,P=!1;e?E||(R=e.has(w),P=e.has(T),E=!R&&!P):(R=!0,P=!0);const I=E||R,B=E||P;let N=!1;I&&(N=d(b,m,E));let U=!1;B&&(U=d(M,m,E));const V=N||U;if(V)for(let W=0;W<3;W++){const K=b+W,q=M+W,j=l[K],te=l[K+3],he=l[q],_e=l[q+3];l[f+W]=j<he?j:he,l[f+W+3]=te>_e?te:_e}return V}}}const HJ=new Ns;function Zv(n,e,t,i){return Ja(n,e,HJ),t.intersectBox(HJ,i)}function Rft(n,e,t,i,r,s){const{geometry:a,_indirectBuffer:o}=n;for(let l=i,u=i+r;l<u;l++){let c=o?o[l]:l;cI(a,e,t,c,s)}}function Pft(n,e,t,i,r){const{geometry:s,_indirectBuffer:a}=n;let o=1/0,l=null;for(let u=i,c=i+r;u<c;u++){let d;d=cI(s,e,t,a?a[u]:u),d&&d.distance<o&&(l=d,o=d.distance)}return l}function Dft(n,e,t,i,r,s,a){const{geometry:o}=t,{index:l}=o,u=o.attributes.position;for(let c=n,d=e+n;c<d;c++){let f;if(f=t.resolveTriangleIndex(c),Ho(a,f*3,l,u),a.needsUpdate=!0,i(a,f,r,s))return!0}return!1}const XJ=new re;function Nft(n,e,t,i,r){Aa.setBuffer(n._roots[e]),Nz(0,n,t,i,r),Aa.clearBuffer()}function Nz(n,e,t,i,r){const{float32Array:s,uint16Array:a,uint32Array:o}=Aa,l=n*2;if(vh(l,a)){const c=Sh(n,o),d=Dd(l,a);Tft(e,t,i,c,d,r)}else{const c=Nd(n);Zv(c,s,i,XJ)&&Nz(c,e,t,i,r);const d=Bd(n,o);Zv(d,s,i,XJ)&&Nz(d,e,t,i,r)}}const WJ=new re,Bft=["x","y","z"];function Fft(n,e,t,i){Aa.setBuffer(n._roots[e]);const r=Bz(0,n,t,i);return Aa.clearBuffer(),r}function Bz(n,e,t,i){const{float32Array:r,uint16Array:s,uint32Array:a}=Aa;let o=n*2;if(vh(o,s)){const u=Sh(n,a),c=Dd(o,s);return Cft(e,t,i,u,c)}else{const u=mSe(n,a),c=Bft[u],f=i.direction[c]>=0;let m,y;f?(m=Nd(n),y=Bd(n,a)):(m=Bd(n,a),y=Nd(n));const S=Zv(m,r,i,WJ)?Bz(m,e,t,i):null;if(S){const w=S.point[c];if(f?w<=r[y+u]:w>=r[y+u+3])return S}const M=Zv(y,r,i,WJ)?Bz(y,e,t,i):null;return S&&M?S.distance<=M.distance?S:M:S||M||null}}const wN=new Ns,ES=new Vd,RS=new Vd,XC=new Mn,ZJ=new oc,EN=new oc;function Lft(n,e,t,i){Aa.setBuffer(n._roots[e]);const r=Fz(0,n,t,i);return Aa.clearBuffer(),r}function Fz(n,e,t,i,r=null){const{float32Array:s,uint16Array:a,uint32Array:o}=Aa;let l=n*2;if(r===null&&(t.boundingBox||t.computeBoundingBox(),ZJ.set(t.boundingBox.min,t.boundingBox.max,i),r=ZJ),vh(l,a)){const c=e.geometry,d=c.index,f=c.attributes.position,m=t.index,y=t.attributes.position,_=Sh(n,o),S=Dd(l,a);if(XC.copy(i).invert(),t.boundsTree)return Ja(n,s,EN),EN.matrix.copy(XC),EN.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:M=>EN.intersectsBox(M),intersectsTriangle:M=>{M.a.applyMatrix4(i),M.b.applyMatrix4(i),M.c.applyMatrix4(i),M.needsUpdate=!0;for(let w=_*3,T=(S+_)*3;w<T;w+=3)if(Ho(RS,w,d,f),RS.needsUpdate=!0,M.intersectsTriangle(RS))return!0;return!1}});for(let b=_*3,M=(S+_)*3;b<M;b+=3){Ho(ES,b,d,f),ES.a.applyMatrix4(XC),ES.b.applyMatrix4(XC),ES.c.applyMatrix4(XC),ES.needsUpdate=!0;for(let w=0,T=m.count;w<T;w+=3)if(Ho(RS,w,m,y),RS.needsUpdate=!0,ES.intersectsTriangle(RS))return!0}}else{const c=n+8,d=o[n+6];return Ja(c,s,wN),!!(r.intersectsBox(wN)&&Fz(c,e,t,i,r)||(Ja(d,s,wN),r.intersectsBox(wN)&&Fz(d,e,t,i,r)))}}const RN=new Mn,e5=new oc,WC=new oc,Ift=new re,Gft=new re,Oft=new re,Uft=new re;function kft(n,e,t,i={},r={},s=0,a=1/0){e.boundingBox||e.computeBoundingBox(),e5.set(e.boundingBox.min,e.boundingBox.max,t),e5.needsUpdate=!0;const o=n.geometry,l=o.attributes.position,u=o.index,c=e.attributes.position,d=e.index,f=Pd.getPrimitive(),m=Pd.getPrimitive();let y=Ift,_=Gft,S=null,b=null;r&&(S=Oft,b=Uft);let M=1/0,w=null,T=null;return RN.copy(t).invert(),WC.matrix.copy(RN),n.shapecast({boundsTraverseOrder:E=>e5.distanceToBox(E),intersectsBounds:(E,R,P)=>P<M&&P<a?(R&&(WC.min.copy(E.min),WC.max.copy(E.max),WC.needsUpdate=!0),!0):!1,intersectsRange:(E,R)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:I=>WC.distanceToBox(I),intersectsBounds:(I,B,N)=>N<M&&N<a,intersectsRange:(I,B)=>{for(let N=I,U=I+B;N<U;N++){Ho(m,3*N,d,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let V=E,W=E+R;V<W;V++){Ho(f,3*V,u,l),f.needsUpdate=!0;const K=f.distanceToTriangle(m,y,S);if(K<M&&(_.copy(y),b&&b.copy(S),M=K,w=V,T=N),K<s)return!0}}}});{const P=DA(e);for(let I=0,B=P;I<B;I++){Ho(m,3*I,d,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let N=E,U=E+R;N<U;N++){Ho(f,3*N,u,l),f.needsUpdate=!0;const V=f.distanceToTriangle(m,y,S);if(V<M&&(_.copy(y),b&&b.copy(S),M=V,w=N,T=I),V<s)return!0}}}}}),Pd.releasePrimitive(f),Pd.releasePrimitive(m),M===1/0?null:(i.point?i.point.copy(_):i.point=_.clone(),i.distance=M,i.faceIndex=w,r&&(r.point?r.point.copy(b):r.point=b.clone(),r.point.applyMatrix4(RN),_.applyMatrix4(RN),r.distance=_.sub(r.point).length(),r.faceIndex=T),i)}function zft(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=n.geometry,i=t.index?t.index.array:null,r=t.attributes.position;let s,a,o,l,u=0;const c=n._roots;for(let f=0,m=c.length;f<m;f++)s=c[f],a=new Uint32Array(s),o=new Uint16Array(s),l=new Float32Array(s),d(0,u),u+=s.byteLength;function d(f,m,y=!1){const _=f*2;if(o[_+15]===uI){const b=a[f+6],M=o[_+14];let w=1/0,T=1/0,E=1/0,R=-1/0,P=-1/0,I=-1/0;for(let B=b,N=b+M;B<N;B++){const U=3*n.resolveTriangleIndex(B);for(let V=0;V<3;V++){let W=U+V;W=i?i[W]:W;const K=r.getX(W),q=r.getY(W),j=r.getZ(W);K<w&&(w=K),K>R&&(R=K),q<T&&(T=q),q>P&&(P=q),j<E&&(E=j),j>I&&(I=j)}}return l[f+0]!==w||l[f+1]!==T||l[f+2]!==E||l[f+3]!==R||l[f+4]!==P||l[f+5]!==I?(l[f+0]=w,l[f+1]=T,l[f+2]=E,l[f+3]=R,l[f+4]=P,l[f+5]=I,!0):!1}else{const b=f+8,M=a[f+6],w=b+m,T=M+m;let E=y,R=!1,P=!1;e?E||(R=e.has(w),P=e.has(T),E=!R&&!P):(R=!0,P=!0);const I=E||R,B=E||P;let N=!1;I&&(N=d(b,m,E));let U=!1;B&&(U=d(M,m,E));const V=N||U;if(V)for(let W=0;W<3;W++){const K=b+W,q=M+W,j=l[K],te=l[K+3],he=l[q],_e=l[q+3];l[f+W]=j<he?j:he,l[f+W+3]=te>_e?te:_e}return V}}}const jJ=new re;function Vft(n,e,t,i,r){Aa.setBuffer(n._roots[e]),Lz(0,n,t,i,r),Aa.clearBuffer()}function Lz(n,e,t,i,r){const{float32Array:s,uint16Array:a,uint32Array:o}=Aa,l=n*2;if(vh(l,a)){const c=Sh(n,o),d=Dd(l,a);Rft(e,t,i,c,d,r)}else{const c=Nd(n);Zv(c,s,i,jJ)&&Lz(c,e,t,i,r);const d=Bd(n,o);Zv(d,s,i,jJ)&&Lz(d,e,t,i,r)}}const YJ=new re,Hft=["x","y","z"];function Xft(n,e,t,i){Aa.setBuffer(n._roots[e]);const r=Iz(0,n,t,i);return Aa.clearBuffer(),r}function Iz(n,e,t,i){const{float32Array:r,uint16Array:s,uint32Array:a}=Aa;let o=n*2;if(vh(o,s)){const u=Sh(n,a),c=Dd(o,s);return Pft(e,t,i,u,c)}else{const u=mSe(n,a),c=Hft[u],f=i.direction[c]>=0;let m,y;f?(m=Nd(n),y=Bd(n,a)):(m=Bd(n,a),y=Nd(n));const S=Zv(m,r,i,YJ)?Iz(m,e,t,i):null;if(S){const w=S.point[c];if(f?w<=r[y+u]:w>=r[y+u+3])return S}const M=Zv(y,r,i,YJ)?Iz(y,e,t,i):null;return S&&M?S.distance<=M.distance?S:M:S||M||null}}const PN=new Ns,PS=new Vd,DS=new Vd,ZC=new Mn,KJ=new oc,DN=new oc;function Wft(n,e,t,i){Aa.setBuffer(n._roots[e]);const r=Gz(0,n,t,i);return Aa.clearBuffer(),r}function Gz(n,e,t,i,r=null){const{float32Array:s,uint16Array:a,uint32Array:o}=Aa;let l=n*2;if(r===null&&(t.boundingBox||t.computeBoundingBox(),KJ.set(t.boundingBox.min,t.boundingBox.max,i),r=KJ),vh(l,a)){const c=e.geometry,d=c.index,f=c.attributes.position,m=t.index,y=t.attributes.position,_=Sh(n,o),S=Dd(l,a);if(ZC.copy(i).invert(),t.boundsTree)return Ja(n,s,DN),DN.matrix.copy(ZC),DN.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:M=>DN.intersectsBox(M),intersectsTriangle:M=>{M.a.applyMatrix4(i),M.b.applyMatrix4(i),M.c.applyMatrix4(i),M.needsUpdate=!0;for(let w=_,T=S+_;w<T;w++)if(Ho(DS,3*e.resolveTriangleIndex(w),d,f),DS.needsUpdate=!0,M.intersectsTriangle(DS))return!0;return!1}});for(let b=_,M=S+_;b<M;b++){const w=e.resolveTriangleIndex(b);Ho(PS,3*w,d,f),PS.a.applyMatrix4(ZC),PS.b.applyMatrix4(ZC),PS.c.applyMatrix4(ZC),PS.needsUpdate=!0;for(let T=0,E=m.count;T<E;T+=3)if(Ho(DS,T,m,y),DS.needsUpdate=!0,PS.intersectsTriangle(DS))return!0}}else{const c=n+8,d=o[n+6];return Ja(c,s,PN),!!(r.intersectsBox(PN)&&Gz(c,e,t,i,r)||(Ja(d,s,PN),r.intersectsBox(PN)&&Gz(d,e,t,i,r)))}}const NN=new Mn,t5=new oc,jC=new oc,Zft=new re,jft=new re,Yft=new re,Kft=new re;function $ft(n,e,t,i={},r={},s=0,a=1/0){e.boundingBox||e.computeBoundingBox(),t5.set(e.boundingBox.min,e.boundingBox.max,t),t5.needsUpdate=!0;const o=n.geometry,l=o.attributes.position,u=o.index,c=e.attributes.position,d=e.index,f=Pd.getPrimitive(),m=Pd.getPrimitive();let y=Zft,_=jft,S=null,b=null;r&&(S=Yft,b=Kft);let M=1/0,w=null,T=null;return NN.copy(t).invert(),jC.matrix.copy(NN),n.shapecast({boundsTraverseOrder:E=>t5.distanceToBox(E),intersectsBounds:(E,R,P)=>P<M&&P<a?(R&&(jC.min.copy(E.min),jC.max.copy(E.max),jC.needsUpdate=!0),!0):!1,intersectsRange:(E,R)=>{if(e.boundsTree){const P=e.boundsTree;return P.shapecast({boundsTraverseOrder:I=>jC.distanceToBox(I),intersectsBounds:(I,B,N)=>N<M&&N<a,intersectsRange:(I,B)=>{for(let N=I,U=I+B;N<U;N++){const V=P.resolveTriangleIndex(N);Ho(m,3*V,d,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let W=E,K=E+R;W<K;W++){const q=n.resolveTriangleIndex(W);Ho(f,3*q,u,l),f.needsUpdate=!0;const j=f.distanceToTriangle(m,y,S);if(j<M&&(_.copy(y),b&&b.copy(S),M=j,w=W,T=N),j<s)return!0}}}})}else{const P=DA(e);for(let I=0,B=P;I<B;I++){Ho(m,3*I,d,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let N=E,U=E+R;N<U;N++){const V=n.resolveTriangleIndex(N);Ho(f,3*V,u,l),f.needsUpdate=!0;const W=f.distanceToTriangle(m,y,S);if(W<M&&(_.copy(y),b&&b.copy(S),M=W,w=N,T=I),W<s)return!0}}}}}),Pd.releasePrimitive(f),Pd.releasePrimitive(m),M===1/0?null:(i.point?i.point.copy(_):i.point=_.clone(),i.distance=M,i.faceIndex=w,r&&(r.point?r.point.copy(b):r.point=b.clone(),r.point.applyMatrix4(NN),_.applyMatrix4(NN),r.distance=_.sub(r.point).length(),r.faceIndex=T),i)}function Jft(){return typeof SharedArrayBuffer<"u"}const Dw=new Aa.constructor,S2=new Aa.constructor,Oy=new O8(()=>new Ns),NS=new Ns,BS=new Ns,n5=new Ns,i5=new Ns;let r5=!1;function qft(n,e,t,i){if(r5)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");r5=!0;const r=n._roots,s=e._roots;let a,o=0,l=0;const u=new Mn().copy(t).invert();for(let c=0,d=r.length;c<d;c++){Dw.setBuffer(r[c]),l=0;const f=Oy.getPrimitive();Ja(0,Dw.float32Array,f),f.applyMatrix4(u);for(let m=0,y=s.length;m<y&&(S2.setBuffer(s[c]),a=Df(0,0,t,u,i,o,l,0,0,f),S2.clearBuffer(),l+=s[m].length,!a);m++);if(Oy.releasePrimitive(f),Dw.clearBuffer(),o+=r[c].length,a)break}return r5=!1,a}function Df(n,e,t,i,r,s=0,a=0,o=0,l=0,u=null,c=!1){let d,f;c?(d=S2,f=Dw):(d=Dw,f=S2);const m=d.float32Array,y=d.uint32Array,_=d.uint16Array,S=f.float32Array,b=f.uint32Array,M=f.uint16Array,w=n*2,T=e*2,E=vh(w,_),R=vh(T,M);let P=!1;if(R&&E)c?P=r(Sh(e,b),Dd(e*2,M),Sh(n,y),Dd(n*2,_),l,a+e,o,s+n):P=r(Sh(n,y),Dd(n*2,_),Sh(e,b),Dd(e*2,M),o,s+n,l,a+e);else if(R){const I=Oy.getPrimitive();Ja(e,S,I),I.applyMatrix4(t);const B=Nd(n),N=Bd(n,y);Ja(B,m,NS),Ja(N,m,BS);const U=I.intersectsBox(NS),V=I.intersectsBox(BS);P=U&&Df(e,B,i,t,r,a,s,l,o+1,I,!c)||V&&Df(e,N,i,t,r,a,s,l,o+1,I,!c),Oy.releasePrimitive(I)}else{const I=Nd(e),B=Bd(e,b);Ja(I,S,n5),Ja(B,S,i5);const N=u.intersectsBox(n5),U=u.intersectsBox(i5);if(N&&U)P=Df(n,I,t,i,r,s,a,o,l+1,u,c)||Df(n,B,t,i,r,s,a,o,l+1,u,c);else if(N)if(E)P=Df(n,I,t,i,r,s,a,o,l+1,u,c);else{const V=Oy.getPrimitive();V.copy(n5).applyMatrix4(t);const W=Nd(n),K=Bd(n,y);Ja(W,m,NS),Ja(K,m,BS);const q=V.intersectsBox(NS),j=V.intersectsBox(BS);P=q&&Df(I,W,i,t,r,a,s,l,o+1,V,!c)||j&&Df(I,K,i,t,r,a,s,l,o+1,V,!c),Oy.releasePrimitive(V)}else if(U)if(E)P=Df(n,B,t,i,r,s,a,o,l+1,u,c);else{const V=Oy.getPrimitive();V.copy(i5).applyMatrix4(t);const W=Nd(n),K=Bd(n,y);Ja(W,m,NS),Ja(K,m,BS);const q=V.intersectsBox(NS),j=V.intersectsBox(BS);P=q&&Df(B,W,i,t,r,a,s,l,o+1,V,!c)||j&&Df(B,K,i,t,r,a,s,l,o+1,V,!c),Oy.releasePrimitive(V)}}return P}const BN=new oc,$J=new Ns;class U8{static serialize(e,t={}){t={cloneBuffers:!0,...t};const i=e.geometry,r=e._roots,s=e._indirectBuffer,a=i.getIndex();let o;return t.cloneBuffers?o={roots:r.map(l=>l.slice()),index:a.array.slice(),indirectBuffer:s?s.slice():null}:o={roots:r,index:a.array,indirectBuffer:s},o}static deserialize(e,t,i={}){i={setIndex:!0,indirect:!!e.indirectBuffer,...i};const{index:r,roots:s,indirectBuffer:a}=e,o=new U8(t,{...i,[$U]:!0});if(o._roots=s,o._indirectBuffer=a||null,i.setIndex){const l=t.getIndex();if(l===null){const u=new Gi(e.index,1,!1);t.setIndex(u)}else l.array!==r&&(l.array.set(r),l.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:dSe,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[$U]:!1},t),t.useSharedArrayBuffer&&!Jft())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[$U]||(mft(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Ns)));const{_indirectBuffer:i}=this;this.resolveTriangleIndex=t.indirect?r=>i[r]:r=>r}refit(e=null){return(this.indirect?zft:Eft)(this,e)}traverse(e,t=0){const i=this._roots[t],r=new Uint32Array(i),s=new Uint16Array(i);a(0);function a(o,l=0){const u=o*2,c=s[u+15]===uI;if(c){const d=r[o+6],f=s[u+14];e(l,c,new Float32Array(i,o*4,6),d,f)}else{const d=o+rB/4,f=r[o+6],m=r[o+7];e(l,c,new Float32Array(i,o*4,6),m)||(a(d,l+1),a(f,l+1))}}}raycast(e,t=wo){const i=this._roots,r=this.geometry,s=[],a=t.isMaterial,o=Array.isArray(t),l=r.groups,u=a?t.side:t,c=this.indirect?Vft:Nft;for(let d=0,f=i.length;d<f;d++){const m=o?t[l[d].materialIndex].side:u,y=s.length;if(c(this,d,m,e,s),o){const _=l[d].materialIndex;for(let S=y,b=s.length;S<b;S++)s[S].face.materialIndex=_}}return s}raycastFirst(e,t=wo){const i=this._roots,r=this.geometry,s=t.isMaterial,a=Array.isArray(t);let o=null;const l=r.groups,u=s?t.side:t,c=this.indirect?Xft:Fft;for(let d=0,f=i.length;d<f;d++){const m=a?t[l[d].materialIndex].side:u,y=c(this,d,m,e);y!=null&&(o==null||y.distance<o.distance)&&(o=y,a&&(y.face.materialIndex=l[d].materialIndex))}return o}intersectsGeometry(e,t){let i=!1;const r=this._roots,s=this.indirect?Wft:Lft;for(let a=0,o=r.length;a<o&&(i=s(this,a,e,t),!i);a++);return i}shapecast(e){const t=Pd.getPrimitive(),i=this.indirect?Dft:wft;let{boundsTraverseOrder:r,intersectsBounds:s,intersectsRange:a,intersectsTriangle:o}=e;if(a&&o){const d=a;a=(f,m,y,_,S)=>d(f,m,y,_,S)?!0:i(f,m,this,o,y,_,t)}else a||(o?a=(d,f,m,y)=>i(d,f,this,o,m,y,t):a=(d,f,m)=>m);let l=!1,u=0;const c=this._roots;for(let d=0,f=c.length;d<f;d++){const m=c[d];if(l=_ft(this,d,s,a,r,u),l)break;u+=m.byteLength}return Pd.releasePrimitive(t),l}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:s}=i;const a=Pd.getPrimitive(),o=this.geometry.index,l=this.geometry.attributes.position,u=this.indirect?y=>{const _=this.resolveTriangleIndex(y);Ho(a,_*3,o,l)}:y=>{Ho(a,y*3,o,l)},c=Pd.getPrimitive(),d=e.geometry.index,f=e.geometry.attributes.position,m=e.indirect?y=>{const _=e.resolveTriangleIndex(y);Ho(c,_*3,d,f)}:y=>{Ho(c,y*3,d,f)};if(s){const y=(_,S,b,M,w,T,E,R)=>{for(let P=b,I=b+M;P<I;P++){m(P),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let B=_,N=_+S;B<N;B++)if(u(B),a.needsUpdate=!0,s(a,c,B,P,w,T,E,R))return!0}return!1};if(r){const _=r;r=function(S,b,M,w,T,E,R,P){return _(S,b,M,w,T,E,R,P)?!0:y(S,b,M,w,T,E,R,P)}}else r=y}return qft(this,e,t,r)}intersectsBox(e,t){return BN.set(e.min,e.max,t),BN.needsUpdate=!0,this.shapecast({intersectsBounds:i=>BN.intersectsBox(i),intersectsTriangle:i=>BN.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},s=0,a=1/0){return(this.indirect?$ft:kft)(this,e,t,i,r,s,a)}closestPointToPoint(e,t={},i=0,r=1/0){return Sft(this,e,t,i,r)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{Ja(0,new Float32Array(i),$J),e.union($J)}),e}}const gSe=1e-6,Qft=gSe*.5,ySe=Math.pow(10,-Math.log10(gSe)),ept=Qft*ySe;function nm(n){return~~(n*ySe+ept)}function tpt(n){return`${nm(n.x)},${nm(n.y)}`}function JJ(n){return`${nm(n.x)},${nm(n.y)},${nm(n.z)}`}function npt(n){return`${nm(n.x)},${nm(n.y)},${nm(n.z)},${nm(n.w)}`}function ipt(n,e,t){t.direction.subVectors(e,n).normalize();const i=n.dot(t.direction);return t.origin.copy(n).addScaledVector(t.direction,-i),t}function vSe(){return typeof SharedArrayBuffer<"u"}function rpt(n){if(n.buffer instanceof SharedArrayBuffer)return n;const e=n.constructor,t=n.buffer,i=new SharedArrayBuffer(t.byteLength),r=new Uint8Array(t);return new Uint8Array(i).set(r,0),new e(i)}function spt(n,e=ArrayBuffer){return n>65535?new Uint32Array(new e(4*n)):new Uint16Array(new e(2*n))}function apt(n,e){if(!n.index){const t=n.attributes.position.count,i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=spt(t,i);n.setIndex(new Gi(r,1));for(let s=0;s<t;s++)r[s]=s}}function opt(n){return n.index?n.index.count:n.attributes.position.count}function k8(n){return opt(n)/3}const lpt=1e-8,upt=new re;function cpt(n){return~~(n/3)}function hpt(n){return n%3}function qJ(n,e){return n.start-e.start}function QJ(n,e){return upt.subVectors(e,n.origin).dot(n.direction)}function dpt(n,e,t,i=lpt){n.sort(qJ),e.sort(qJ);for(let o=0;o<n.length;o++){const l=n[o];for(let u=0;u<e.length;u++){const c=e[u];if(!(c.start>l.end)){if(l.end<c.start||c.end<l.start)continue;if(l.start<=c.start&&l.end>=c.end)s(c.end,l.end)||n.splice(o+1,0,{start:c.end,end:l.end,index:l.index}),l.end=c.start,c.start=0,c.end=0;else if(l.start>=c.start&&l.end<=c.end)s(l.end,c.end)||e.splice(u+1,0,{start:l.end,end:c.end,index:c.index}),c.end=l.start,l.start=0,l.end=0;else if(l.start<=c.start&&l.end<=c.end){const d=l.end;l.end=c.start,c.start=d}else if(l.start>=c.start&&l.end>=c.end){const d=c.end;c.end=l.start,l.start=d}else throw new Error}if(t.has(l.index)||t.set(l.index,[]),t.has(c.index)||t.set(c.index,[]),t.get(l.index).push(c.index),t.get(c.index).push(l.index),a(c)&&(e.splice(u,1),u--),a(l)){n.splice(o,1),o--;break}}}r(n),r(e);function r(o){for(let l=0;l<o.length;l++)a(o[l])&&(o.splice(l,1),l--)}function s(o,l){return Math.abs(l-o)<i}function a(o){return Math.abs(o.end-o.start)<i}}const eq=1e-5,tq=1e-4;class fpt{constructor(){this._rays=[]}addRay(e){this._rays.push(e)}findClosestRay(e){const t=this._rays,i=e.clone();i.direction.multiplyScalar(-1);let r=1/0,s=null;for(let l=0,u=t.length;l<u;l++){const c=t[l];if(a(c,e)&&a(c,i))continue;const d=o(c,e),f=o(c,i),m=Math.min(d,f);m<r&&(r=m,s=c)}return s;function a(l,u){const c=l.origin.distanceTo(u.origin)>eq;return l.direction.angleTo(u.direction)>tq||c}function o(l,u){const c=l.origin.distanceTo(u.origin),d=l.direction.angleTo(u.direction);return c/eq+d/tq}}}const s5=new re,a5=new re,FN=new Im;function ppt(n,e,t){const i=n.attributes,r=n.index,s=i.position,a=new Map,o=new Map,l=Array.from(e),u=new fpt;for(let c=0,d=l.length;c<d;c++){const f=l[c],m=cpt(f),y=hpt(f);let _=3*m+y,S=3*m+(y+1)%3;r&&(_=r.getX(_),S=r.getX(S)),s5.fromBufferAttribute(s,_),a5.fromBufferAttribute(s,S),ipt(s5,a5,FN);let b,M=u.findClosestRay(FN);M===null&&(M=FN.clone(),u.addRay(M)),o.has(M)||o.set(M,{forward:[],reverse:[],ray:M}),b=o.get(M);let w=QJ(M,s5),T=QJ(M,a5);w>T&&([w,T]=[T,w]),FN.direction.dot(M.direction)<0?b.reverse.push({start:w,end:T,index:f}):b.forward.push({start:w,end:T,index:f})}return o.forEach(({forward:c,reverse:d},f)=>{dpt(c,d,a,t),c.length===0&&d.length===0&&o.delete(f)}),{disjointConnectivityMap:a,fragmentMap:o}}const mpt=new rt,o5=new re,gpt=new si,l5=["","",""];class ypt{constructor(e=null){this.data=null,this.disjointConnections=null,this.unmatchedDisjointEdges=null,this.unmatchedEdges=-1,this.matchedEdges=-1,this.useDrawRange=!0,this.useAllAttributes=!1,this.matchDisjointEdges=!1,this.degenerateEpsilon=1e-8,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const i=this.data[e*3+t];return i===-1?-1:~~(i/3)}getSiblingEdgeIndex(e,t){const i=this.data[e*3+t];return i===-1?-1:i%3}getDisjointSiblingTriangleIndices(e,t){const i=e*3+t,r=this.disjointConnections.get(i);return r?r.map(s=>~~(s/3)):[]}getDisjointSiblingEdgeIndices(e,t){const i=e*3+t,r=this.disjointConnections.get(i);return r?r.map(s=>s%3):[]}isFullyConnected(){return this.unmatchedEdges===0}updateFrom(e){const{useAllAttributes:t,useDrawRange:i,matchDisjointEdges:r,degenerateEpsilon:s}=this,a=t?w:M,o=new Map,{attributes:l}=e,u=t?Object.keys(l):null,c=e.index,d=l.position;let f=k8(e);const m=f;let y=0;i&&(y=e.drawRange.start,e.drawRange.count!==1/0&&(f=~~(e.drawRange.count/3)));let _=this.data;(!_||_.length<3*m)&&(_=new Int32Array(3*m)),_.fill(-1);let S=0,b=new Set;for(let T=y,E=f*3+y;T<E;T+=3){const R=T;for(let P=0;P<3;P++){let I=R+P;c&&(I=c.getX(I)),l5[P]=a(I)}for(let P=0;P<3;P++){const I=(P+1)%3,B=l5[P],N=l5[I],U=`${N}_${B}`;if(o.has(U)){const V=R+P,W=o.get(U);_[V]=W,_[W]=V,o.delete(U),S+=2,b.delete(W)}else{const V=`${B}_${N}`,W=R+P;o.set(V,W),b.add(W)}}}if(r){const{fragmentMap:T,disjointConnectivityMap:E}=ppt(e,b,s);b.clear(),T.forEach(({forward:R,reverse:P})=>{R.forEach(({index:I})=>b.add(I)),P.forEach(({index:I})=>b.add(I))}),this.unmatchedDisjointEdges=T,this.disjointConnections=E,S=f*3-b.size}this.matchedEdges=S,this.unmatchedEdges=b.size,this.data=_;function M(T){return o5.fromBufferAttribute(d,T),JJ(o5)}function w(T){let E="";for(let R=0,P=u.length;R<P;R++){const I=l[u[R]];let B;switch(I.itemSize){case 1:B=nm(I.getX(T));break;case 2:B=tpt(mpt.fromBufferAttribute(I,T));break;case 3:B=JJ(o5.fromBufferAttribute(I,T));break;case 4:B=npt(gpt.fromBufferAttribute(I,T));break}E!==""&&(E+="|"),E+=B}return E}}}class RE extends Fr{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new Mn,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,i=e.elements,r=t.elements;for(let s=0;s<16;s++)if(i[s]!==r[s])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes,i=vSe();if(i)for(const r in t){const s=t[r];if(s.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");s.array=rpt(s.array)}if(e.boundsTree||(apt(e,{useSharedArrayBuffer:i}),e.boundsTree=new U8(e,{maxLeafTris:3,indirect:!0,useSharedArrayBuffer:i})),e.halfEdges||(e.halfEdges=new ypt(e)),!e.groupIndices){const r=k8(e),s=new Uint16Array(r),a=e.groups;for(let o=0,l=a.length;o<l;o++){const{start:u,count:c}=a[o];for(let d=u/3,f=(u+c)/3;d<f;d++)s[d]=o}e.groupIndices=s}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}const vpt=1e-14,u5=new re,nq=new re,iq=new re;function zy(n,e=vpt){u5.subVectors(n.b,n.a),nq.subVectors(n.c,n.a),iq.subVectors(n.b,n.c);const t=u5.angleTo(nq),i=u5.angleTo(iq),r=Math.PI-t-i;return Math.abs(t)<e||Math.abs(i)<e||Math.abs(r)<e||n.a.distanceToSquared(n.b)<e||n.a.distanceToSquared(n.c)<e||n.b.distanceToSquared(n.c)<e}const c5=1e-10,YC=1e-10,xpt=1e-10,Pg=new Hc,Mo=new Hc,Dg=new re,h5=new re,rq=new re,LN=new Xl,d5=new Vd;class bpt{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new Vs),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class _pt{constructor(){this.trianglePool=new bpt,this.triangles=[],this.normal=new re,this.coplanarTriangleUsed=!1}initialize(e){this.reset();const{triangles:t,trianglePool:i,normal:r}=this;if(Array.isArray(e))for(let s=0,a=e.length;s<a;s++){const o=e[s];if(s===0)o.getNormal(r);else if(Math.abs(1-o.getNormal(Dg).dot(r))>c5)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const l=i.getTriangle();l.copy(o),t.push(l)}else{e.getNormal(r);const s=i.getTriangle();s.copy(e),t.push(s)}}splitByTriangle(e){const{normal:t,triangles:i}=this;if(e.getNormal(h5).normalize(),Math.abs(1-Math.abs(h5.dot(t)))<xpt){this.coplanarTriangleUsed=!0;for(let s=0,a=i.length;s<a;s++){const o=i[s];o.coplanarCount=0}const r=[e.a,e.b,e.c];for(let s=0;s<3;s++){const a=(s+1)%3,o=r[s],l=r[a];Dg.subVectors(l,o).normalize(),rq.crossVectors(h5,Dg),LN.setFromNormalAndCoplanarPoint(rq,o),this.splitByPlane(LN,e)}}else e.getPlane(LN),this.splitByPlane(LN,e)}splitByPlane(e,t){const{triangles:i,trianglePool:r}=this;d5.copy(t),d5.needsUpdate=!0;for(let s=0,a=i.length;s<a;s++){const o=i[s];if(!d5.intersectsTriangle(o,Pg,!0))continue;const{a:l,b:u,c}=o;let d=0,f=-1,m=!1,y=[],_=[];const S=[l,u,c];for(let b=0;b<3;b++){const M=(b+1)%3;Pg.start.copy(S[b]),Pg.end.copy(S[M]);const w=e.distanceToPoint(Pg.start),T=e.distanceToPoint(Pg.end);if(Math.abs(w)<YC&&Math.abs(T)<YC){m=!0;break}if(w>0?y.push(b):_.push(b),Math.abs(w)<YC)continue;let E=!!e.intersectLine(Pg,Dg);!E&&Math.abs(T)<YC&&(Dg.copy(Pg.end),E=!0),E&&!(Dg.distanceTo(Pg.start)<c5)&&(Dg.distanceTo(Pg.end)<c5&&(f=b),d===0?Mo.start.copy(Dg):Mo.end.copy(Dg),d++)}if(!m&&d===2&&Mo.distance()>YC)if(f!==-1){f=(f+1)%3;let b=0;b===f&&(b=(b+1)%3);let M=b+1;M===f&&(M=(M+1)%3);const w=r.getTriangle();w.a.copy(S[M]),w.b.copy(Mo.end),w.c.copy(Mo.start),zy(w)||i.push(w),o.a.copy(S[b]),o.b.copy(Mo.start),o.c.copy(Mo.end),zy(o)&&(i.splice(s,1),s--,a--)}else{const b=y.length>=2?_[0]:y[0];if(b===0){let R=Mo.start;Mo.start=Mo.end,Mo.end=R}const M=(b+1)%3,w=(b+2)%3,T=r.getTriangle(),E=r.getTriangle();S[M].distanceToSquared(Mo.start)<S[w].distanceToSquared(Mo.end)?(T.a.copy(S[M]),T.b.copy(Mo.start),T.c.copy(Mo.end),E.a.copy(S[M]),E.b.copy(S[w]),E.c.copy(Mo.start)):(T.a.copy(S[w]),T.b.copy(Mo.start),T.c.copy(Mo.end),E.a.copy(S[M]),E.b.copy(S[w]),E.c.copy(Mo.end)),o.a.copy(S[b]),o.b.copy(Mo.end),o.c.copy(Mo.start),zy(T)||i.push(T),zy(E)||i.push(E),zy(o)&&(i.splice(s,1),s--,a--)}else d===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0,this.trianglePool.clear(),this.coplanarTriangleUsed=!1}}function Spt(n){return n=~~n,n+4-n%4}class sq{constructor(e,t=500){this.expansionFactor=1.5,this.type=e,this.length=0,this.array=null,this.setSize(t)}setType(e){if(this.length!==0)throw new Error("TypeBackedArray: Cannot change the type while there is used data in the buffer.");const t=this.array.buffer;this.array=new e(t),this.type=e}setSize(e){if(this.array&&e===this.array.length)return;const t=this.type,i=vSe()?SharedArrayBuffer:ArrayBuffer,r=new t(new i(Spt(e*t.BYTES_PER_ELEMENT)));this.array&&r.set(this.array,0),this.array=r}expand(){const{array:e,expansionFactor:t}=this;this.setSize(e.length*t)}push(...e){let{array:t,length:i}=this;i+e.length>t.length&&(this.expand(),t=this.array);for(let r=0,s=e.length;r<s;r++)t[i+r]=e[r];this.length+=e.length}clear(){this.length=0}}class Mpt{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getItemSize(e){return this.groupAttributes[0][e].itemSize}getNormalized(e){return this.groupAttributes[0][e].normalized}getCount(e){if(this.groupCount<=e)return 0;const t=this.getGroupAttrArray("position",e);return t.length/t.itemSize}getTotalLength(e){const{groupCount:t,groupAttributes:i}=this;let r=0;for(let s=0;s<t;s++){const a=i[s];r+=a[e].length}return r}getGroupAttrSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const i=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const r={};t.push(r);for(const s in i){const a=i[s],o=new sq(a.type);o.itemSize=a.itemSize,o.normalized=a.normalized,r[s]=o}}return t[e]}getGroupAttrArray(e,t=0){const{groupAttributes:i}=this;if(!i[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupAttrSet(t)[e]}initializeArray(e,t,i,r){const{groupAttributes:s}=this,o=s[0][e];if(o){if(o.type!==t)for(let l=0,u=s.length;l<u;l++){const c=s[l][e];c.setType(t),c.itemSize=i,c.normalized=r}}else for(let l=0,u=s.length;l<u;l++){const c=new sq(t);c.itemSize=i,c.normalized=r,s[l][e]=c}}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(t=>{for(const i in t)t[i].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[],this.groupCount=0}}class aq{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:i,ids:r}=this;i[e]||(i[e]=[],r.push(e)),i[e].push(t)}}const z8=0,xSe=1,bSe=2,_Se=3,SSe=4,MSe=5,ASe=6,md=new Im,oq=new Mn,ku=new Vs,Ng=new re,lq=new si,uq=new si,cq=new si,f5=new si,IN=new si,GN=new si,hq=new Hc,p5=new re,m5=1e-8,Apt=1e-15,vx=-1,xx=1,sB=-2,aB=2,Nw=0,cx=1,V8=2,Tpt=1e-14;let oB=null;function dq(n){oB=n}function TSe(n,e){n.getMidpoint(md.origin),n.getNormal(md.direction);const t=e.raycastFirst(md,fr);return!!(t&&md.direction.dot(t.face.normal)>0)?vx:xx}function Cpt(n,e){function t(){return Math.random()-.5}n.getNormal(p5),md.direction.copy(p5),n.getMidpoint(md.origin);const i=3;let r=0,s=1/0;for(let a=0;a<i;a++){md.direction.x+=t()*m5,md.direction.y+=t()*m5,md.direction.z+=t()*m5,md.direction.multiplyScalar(-1);const o=e.raycastFirst(md,fr);if(o&&md.direction.dot(o.face.normal)>0&&r++,o!==null&&(s=Math.min(s,o.distance)),s<=Apt)return o.face.normal.dot(p5)>0?aB:sB;if(r/i>.5||(a-r+1)/i>.5)break}return r/i>.5?vx:xx}function wpt(n,e){const t=new aq,i=new aq;return oq.copy(n.matrixWorld).invert().multiply(e.matrixWorld),n.geometry.boundsTree.bvhcast(e.geometry.boundsTree,oq,{intersectsTriangles(r,s,a,o){if(!zy(r)&&!zy(s)){let l=r.intersectsTriangle(s,hq,!0);if(!l){const u=r.plane,c=s.plane,d=u.normal,f=c.normal;d.dot(f)===1&&Math.abs(u.constant-c.constant)<Tpt&&(l=!0)}if(l){let u=n.geometry.boundsTree.resolveTriangleIndex(a),c=e.geometry.boundsTree.resolveTriangleIndex(o);t.add(u,c),i.add(c,u),oB&&(oB.addEdge(hq),oB.addIntersectingTriangles(a,r,o,s))}}return!1}}),{aIntersections:t,bIntersections:i}}function Ept(n,e,t,i,r,s,a=!1){const o=t.attributes,l=t.index,u=n*3,c=l.getX(u+0),d=l.getX(u+1),f=l.getX(u+2);for(const m in s){const y=o[m],_=s[m];if(!(m in o))throw new Error(`CSG Operations: Attribute ${m} not available on geometry.`);const S=y.itemSize;m==="position"?(ku.a.fromBufferAttribute(y,c).applyMatrix4(i),ku.b.fromBufferAttribute(y,d).applyMatrix4(i),ku.c.fromBufferAttribute(y,f).applyMatrix4(i),g5(ku.a,ku.b,ku.c,e,3,_,a)):m==="normal"?(ku.a.fromBufferAttribute(y,c).applyNormalMatrix(r),ku.b.fromBufferAttribute(y,d).applyNormalMatrix(r),ku.c.fromBufferAttribute(y,f).applyNormalMatrix(r),a&&(ku.a.multiplyScalar(-1),ku.b.multiplyScalar(-1),ku.c.multiplyScalar(-1)),g5(ku.a,ku.b,ku.c,e,3,_,a,!0)):(lq.fromBufferAttribute(y,c),uq.fromBufferAttribute(y,d),cq.fromBufferAttribute(y,f),g5(lq,uq,cq,e,S,_,a))}}function Rpt(n,e,t,i,r,s,a,o=!1){y5(n,i,r,s,a,o),y5(o?t:e,i,r,s,a,o),y5(o?e:t,i,r,s,a,o)}function CSe(n,e,t=!1){switch(n){case z8:if(e===xx||e===aB&&!t)return cx;break;case xSe:if(t){if(e===vx)return Nw}else if(e===xx||e===sB)return cx;break;case bSe:if(t){if(e===xx||e===sB)return cx}else if(e===vx)return Nw;break;case SSe:if(e===vx)return Nw;if(e===xx)return cx;break;case _Se:if(e===vx||e===aB&&!t)return cx;break;case MSe:if(!t&&(e===xx||e===sB))return cx;break;case ASe:if(!t&&(e===vx||e===aB))return cx;break;default:throw new Error(`Unrecognized CSG operation enum "${n}".`)}return V8}function g5(n,e,t,i,r,s,a=!1,o=!1){const l=u=>{s.push(u.x),r>1&&s.push(u.y),r>2&&s.push(u.z),r>3&&s.push(u.w)};f5.set(0,0,0,0).addScaledVector(n,i.a.x).addScaledVector(e,i.a.y).addScaledVector(t,i.a.z),IN.set(0,0,0,0).addScaledVector(n,i.b.x).addScaledVector(e,i.b.y).addScaledVector(t,i.b.z),GN.set(0,0,0,0).addScaledVector(n,i.c.x).addScaledVector(e,i.c.y).addScaledVector(t,i.c.z),o&&(f5.normalize(),IN.normalize(),GN.normalize()),l(f5),a?(l(GN),l(IN)):(l(IN),l(GN))}function y5(n,e,t,i,r,s=!1){for(const a in r){const o=e[a],l=r[a];if(!(a in e))throw new Error(`CSG Operations: Attribute ${a} no available on geometry.`);const u=o.itemSize;a==="position"?(Ng.fromBufferAttribute(o,n).applyMatrix4(t),l.push(Ng.x,Ng.y,Ng.z)):a==="normal"?(Ng.fromBufferAttribute(o,n).applyNormalMatrix(i),s&&Ng.multiplyScalar(-1),l.push(Ng.x,Ng.y,Ng.z)):(l.push(o.getX(n)),u>1&&l.push(o.getY(n)),u>2&&l.push(o.getZ(n)),u>3&&l.push(o.getW(n)))}}class Ppt{constructor(e){this.triangle=new Vs().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new Vs().copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const i in t)e.push(t[i]);return e}}class fq{constructor(){this.data={}}addTriangleIntersection(e,t,i,r){const{data:s}=this;s[e]||(s[e]=new Ppt(t)),s[e].addTriangle(i,r)}getTrianglesAsArray(e=null){const{data:t}=this,i=[];if(e!==null)e in t&&i.push(t[e].triangle);else for(const r in t)i.push(t[r].triangle);return i}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(i=>parseInt(i)):[]}getIntersectionsAsArray(e=null,t=null){const{data:i}=this,r=new Set,s=[],a=o=>{if(i[o])if(t!==null)i[o].intersects[t]&&s.push(i[o].intersects[t]);else{const l=i[o].intersects;for(const u in l)r.has(u)||(r.add(u),s.push(l[u]))}};if(e!==null)a(e);else for(const o in i)a(o);return s}reset(){this.data={}}}class Dpt{constructor(){this.enabled=!1,this.triangleIntersectsA=new fq,this.triangleIntersectsB=new fq,this.intersectionEdges=[]}addIntersectingTriangles(e,t,i,r){const{triangleIntersectsA:s,triangleIntersectsB:a}=this;s.addTriangleIntersection(e,t,i,r),a.addTriangleIntersection(i,r,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}init(){this.enabled&&(this.reset(),dq(this))}complete(){this.enabled&&dq(null)}}const ev=new Mn,M2=new Li,hx=new Vs,ON=new Vs,Dy=new Vs,UN=new Vs,Of=[],Wx=[];function Npt(n){for(const e of n)return e}function Bpt(n,e,t,i,r,s={}){const{useGroups:a=!0}=s,{aIntersections:o,bIntersections:l}=wpt(n,e),u=[];let c=null,d;return d=a?0:-1,pq(n,e,o,t,!1,i,r,d),mq(n,e,o,t,!1,r,d),t.findIndex(m=>m!==ASe&&m!==MSe)!==-1&&(d=a?n.geometry.groups.length||1:-1,pq(e,n,l,t,!0,i,r,d),mq(e,n,l,t,!0,r,d)),Of.length=0,Wx.length=0,{groups:u,materials:c}}function pq(n,e,t,i,r,s,a,o=0){const l=n.matrixWorld.determinant()<0;ev.copy(e.matrixWorld).invert().multiply(n.matrixWorld),M2.getNormalMatrix(n.matrixWorld).multiplyScalar(l?-1:1);const u=n.geometry.groupIndices,c=n.geometry.index,d=n.geometry.attributes.position,f=e.geometry.boundsTree,m=e.geometry.index,y=e.geometry.attributes.position,_=t.ids,S=t.intersectionSet;for(let b=0,M=_.length;b<M;b++){const w=_[b],T=o===-1?0:u[w]+o,E=3*w,R=c.getX(E+0),P=c.getX(E+1),I=c.getX(E+2);hx.a.fromBufferAttribute(d,R).applyMatrix4(ev),hx.b.fromBufferAttribute(d,P).applyMatrix4(ev),hx.c.fromBufferAttribute(d,I).applyMatrix4(ev),s.reset(),s.initialize(hx);const B=S[w];for(let U=0,V=B.length;U<V;U++){const W=3*B[U],K=m.getX(W+0),q=m.getX(W+1),j=m.getX(W+2);ON.a.fromBufferAttribute(y,K),ON.b.fromBufferAttribute(y,q),ON.c.fromBufferAttribute(y,j),s.splitByTriangle(ON)}const N=s.triangles;for(let U=0,V=N.length;U<V;U++){const W=N[U],K=s.coplanarTriangleUsed?Cpt(W,f):TSe(W,f);Of.length=0,Wx.length=0;for(let q=0,j=i.length;q<j;q++){const te=CSe(i[q],K,r);te!==V8&&(Wx.push(te),Of.push(a[q].getGroupAttrSet(T)))}if(Of.length!==0){hx.getBarycoord(W.a,UN.a),hx.getBarycoord(W.b,UN.b),hx.getBarycoord(W.c,UN.c);for(let q=0,j=Of.length;q<j;q++){const te=Of[q],_e=Wx[q]===Nw;Ept(w,UN,n.geometry,n.matrixWorld,M2,te,l!==_e)}}}}return _.length}function mq(n,e,t,i,r,s,a=0){const o=n.matrixWorld.determinant()<0;ev.copy(e.matrixWorld).invert().multiply(n.matrixWorld),M2.getNormalMatrix(n.matrixWorld).multiplyScalar(o?-1:1);const l=e.geometry.boundsTree,u=n.geometry.groupIndices,c=n.geometry.index,d=n.geometry.attributes,f=d.position,m=[],y=n.geometry.halfEdges,_=new Set,S=k8(n.geometry);for(let b=0,M=S;b<M;b++)b in t.intersectionSet||_.add(b);for(;_.size>0;){const b=Npt(_);_.delete(b),m.push(b);const M=3*b,w=c.getX(M+0),T=c.getX(M+1),E=c.getX(M+2);Dy.a.fromBufferAttribute(f,w).applyMatrix4(ev),Dy.b.fromBufferAttribute(f,T).applyMatrix4(ev),Dy.c.fromBufferAttribute(f,E).applyMatrix4(ev);const R=TSe(Dy,l);Wx.length=0,Of.length=0;for(let P=0,I=i.length;P<I;P++){const B=CSe(i[P],R,r);B!==V8&&(Wx.push(B),Of.push(s[P]))}for(;m.length>0;){const P=m.pop();for(let I=0;I<3;I++){const B=y.getSiblingTriangleIndex(P,I);B!==-1&&_.has(B)&&(m.push(B),_.delete(B))}if(Of.length!==0){const I=3*P,B=c.getX(I+0),N=c.getX(I+1),U=c.getX(I+2),V=a===-1?0:u[P]+a;if(Dy.a.fromBufferAttribute(f,B),Dy.b.fromBufferAttribute(f,N),Dy.c.fromBufferAttribute(f,U),!zy(Dy))for(let W=0,K=Of.length;W<K;W++){const q=Wx[W],j=Of[W].getGroupAttrSet(V),te=q===Nw;Rpt(B,N,U,d,n.matrixWorld,M2,j,te!==o)}}}}}function Fpt(n){for(let e=0;e<n.length-1;e++){const t=n[e],i=n[e+1];if(t.materialIndex===i.materialIndex){const r=t.start,s=i.start+i.count;i.start=r,i.count=s-r,n.splice(e,1),e--}}}function Lpt(n,e,t,i){t.clear();const r=n.attributes;for(let s=0,a=i.length;s<a;s++){const o=i[s],l=r[o];t.initializeArray(o,l.array.constructor,l.itemSize,l.normalized)}for(const s in t.attributes)i.includes(s)||t.delete(s);for(const s in e.attributes)i.includes(s)||(e.deleteAttribute(s),e.dispose())}function Ipt(n,e,t){let i=!1,r=-1;const s=n.attributes,a=e.groupAttributes[0];for(const l in a){const u=e.getTotalLength(l),c=e.getType(l),d=e.getItemSize(l),f=e.getNormalized(l);let m=s[l];(!m||m.array.length<u)&&(m=new Gi(new c(u),d,f),n.setAttribute(l,m),i=!0);let y=0;for(let _=0,S=Math.min(t.length,e.groupCount);_<S;_++){const b=t[_].index,{array:M,type:w,length:T}=e.groupAttributes[b][l],E=new w(M.buffer,0,T);m.array.set(E,y),y+=E.length}m.needsUpdate=!0,r=u/m.itemSize}if(n.index){const l=n.index.array;if(l.length<r)n.index=null,i=!0;else for(let u=0,c=l.length;u<c;u++)l[u]=u}let o=0;n.clearGroups();for(let l=0,u=Math.min(t.length,e.groupCount);l<u;l++){const{index:c,materialIndex:d}=t[l],f=e.getCount(c);f!==0&&(n.addGroup(o,f,d),o+=f)}n.setDrawRange(0,r),n.boundsTree=null,i&&n.dispose()}function gq(n,e){let t=e;return Array.isArray(e)||(t=[],n.forEach(i=>{t[i.materialIndex]=e})),t}class Gpt{constructor(){this.triangleSplitter=new _pt,this.attributeData=[],this.attributes=["position","uv","normal"],this.useGroups=!0,this.consolidateGroups=!0,this.debug=new Dpt}getGroupRanges(e){return!this.useGroups||e.groups.length===0?[{start:0,count:1/0,materialIndex:0}]:e.groups.map(t=>({...t}))}evaluate(e,t,i,r=new RE){let s=!0;if(Array.isArray(i)||(i=[i]),Array.isArray(r)||(r=[r],s=!1),r.length!==i.length)throw new Error("Evaluator: operations and target array passed as different sizes.");e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:a,attributeData:o,attributes:l,useGroups:u,consolidateGroups:c,debug:d}=this;for(;o.length<r.length;)o.push(new Mpt);r.forEach((b,M)=>{Lpt(e.geometry,b.geometry,o[M],l)}),d.init(),Bpt(e,t,i,a,o,{useGroups:u}),d.complete();const f=this.getGroupRanges(e.geometry),m=gq(f,e.material),y=this.getGroupRanges(t.geometry),_=gq(y,t.material);y.forEach(b=>b.materialIndex+=m.length);let S=[...f,...y].map((b,M)=>({...b,index:M}));if(u){const b=[...m,..._];c&&(S=S.map(w=>{const T=b[w.materialIndex];return w.materialIndex=b.indexOf(T),w}).sort((w,T)=>w.materialIndex-T.materialIndex));const M=[];for(let w=0,T=b.length;w<T;w++){let E=!1;for(let R=0,P=S.length;R<P;R++){const I=S[R];I.materialIndex===w&&(E=!0,I.materialIndex=M.length)}E&&M.push(b[w])}r.forEach(w=>{w.material=M})}else S=[{start:0,count:1/0,index:0,materialIndex:0}],r.forEach(b=>{b.material=m[0]});return r.forEach((b,M)=>{const w=b.geometry;Ipt(w,o[M],S),c&&Fpt(w.groups)}),s?r:r[0]}evaluateHierarchy(e,t=new RE){e.updateMatrixWorld(!0);const i=(s,a)=>{const o=s.children;for(let l=0,u=o.length;l<u;l++){const c=o[l];c.isOperationGroup?i(c,a):a(c)}},r=s=>{const a=s.children;let o=!1;for(let u=0,c=a.length;u<c;u++){const d=a[u];o=r(d)||o}const l=s.isDirty();if(l&&s.markUpdated(),o&&!s.isOperationGroup){let u;return i(s,c=>{u?u=this.evaluate(u,c,c.operation):u=this.evaluate(s,c,c.operation)}),s._cachedGeometry=u.geometry,s._cachedMaterials=u.material,!0}else return o||l};return r(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const Opt={subtraction:xSe,reverseSubtraction:bSe,addition:z8,difference:SSe,intersection:_Se};function Upt(n){n.dispose(),n.attributes={},n.groups=[],n.boundsTree=n.index=n.boundingBox=n.boundingSphere=null,n.drawRange={start:0,count:1/0}}function yq(n){let e=null;return n instanceof RE?(n.updateMatrixWorld(),e=n):n.traverse(t=>{t.updateMatrixWorld(),!e&&t instanceof RE&&(e=t)}),e}const wSe=G.createContext(null),kpt=G.forwardRef(({children:n,computeVertexNormals:e=!1,useGroups:t=!1,showOperations:i=!1},r)=>{const s=G.useRef(null),a=G.useRef(null),o=G.useMemo(()=>Object.assign(new Gpt,{useGroups:t}),[t]),l=G.useCallback(()=>{try{const m=a.current.children.slice();if(m.length>0){Upt(s.current),a.current.matrixWorld.identity();let y=yq(m.shift());if(y){for(var c,d,f;m.length;){const _=yq(m.shift());_&&(y=o.evaluate(y,_,Opt[_.operator]||z8))}s.current.boundsTree=y.geometry.boundsTree,s.current.index=y.geometry.index,s.current.attributes=y.geometry.attributes,s.current.groups=y.geometry.groups,s.current.drawRange=y.geometry.drawRange,o.useGroups&&(c=s.current)!=null&&(d=c.__r3f)!=null&&(f=d.parent)!=null&&f.material&&(s.current.__r3f.parent.material=y.material),e&&s.current.computeVertexNormals()}}}catch(m){console.log(m)}},[e,o]),u=G.useMemo(()=>({computeVertexNormals:e,showOperations:i,useGroups:t,update:l}),[e,i,t]);return G.useLayoutEffect(()=>{l()}),G.useImperativeHandle(r,()=>({geometry:s.current,operations:a.current,...u}),[u]),G.createElement(G.Fragment,null,G.createElement("group",{matrixAutoUpdate:!1,ref:a},G.createElement(wSe.Provider,{value:u},n)),G.createElement("bufferGeometry",{ref:s}))}),ESe=G.forwardRef(({showOperation:n=!1,operator:e="addition",...t},i)=>{eo({Brush:RE});const{showOperations:r}=G.useContext(wSe);return G.createElement("brush",Ta({operator:e,raycast:()=>null,visible:n||r,ref:i},t))}),zpt=G.forwardRef((n,e)=>G.createElement(ESe,Ta({ref:e,operator:"subtraction"},n))),v5=["black","violet","indigo","blue","green","yellow","orange","red","white","black"];function Vpt(){const{layerWidth:n,layerDepth:e,layerDepthBuffer:t,layerHeight:i,windowSize01:r,minSizeRatio:s,maxSizeRatio:a,windowXY:o,windowZ:l,taperAmount:u,taperCurve:c,squareSpacing:d,patternRotationDeg:f,windowRotationDeg:m,spiralTwistDeg:y,spiralCurve:_}=Ks("Paper Stack",{Stack:Mi({layerHeight:{value:4,min:1,max:10},layerWidth:{value:10,min:1,max:20},layerDepth:{value:.01,min:.005,max:.1},layerDepthBuffer:{value:.01,min:0,max:.1}},{collapsed:!0}),Window:Mi({windowSize01:{label:"Size",value:.5,min:0,max:1},minSizeRatio:{label:"Min Size %",value:.12,min:.02,max:.4},maxSizeRatio:{label:"Max Size %",value:.38,min:.1,max:.48},windowXY:{value:{x:0,y:0}},windowZ:{value:.005,min:-.1,max:.1},squareSpacing:{value:.9,min:.4,max:1.4},patternRotationDeg:{label:"Pattern Rot ()",value:0,min:0,max:180,step:1},windowRotationDeg:{label:"Square Rot ()",value:0,min:0,max:90,step:1}},{collapsed:!1}),Stepping:Mi({taperAmount:{value:.22,min:0,max:.9},taperCurve:{value:2.2,min:.4,max:4,step:.1}},{collapsed:!1}),Spiral:Mi({spiralTwistDeg:{label:"Total Spiral ()",value:0,min:-360,max:360,step:1},spiralCurve:{label:"Spiral Curve",value:1.6,min:.2,max:4,step:.1}},{collapsed:!1})}),S=Wl.degToRad(f),b=Wl.degToRad(m),M=Wl.degToRad(y),w=e+t,T=v5.length,E=G.useMemo(()=>v5.map(U=>new mo({color:U,side:fr})),[]),R=G.useMemo(()=>new Id(n,i,e),[n,i,e]),P=G.useMemo(()=>new Id(1,1,e*6),[e]),I=G.useMemo(()=>{const U=Math.min(n,i),V=U*s,W=U*a;return Wl.lerp(V,W,r)},[n,i,s,a,r]),B=G.useMemo(()=>v5.map((U,V)=>{const W=V/(T-1),K=W**c,q=Wl.lerp(1,1-u,K),j=W**_,te=M*j;return{i:V,z:-V*w,scale:q,spiral:te}}),[w,T,u,c,M,_]),N=G.useMemo(()=>{const U=I*d;return[[U,U],[-U,U],[U,-U],[-U,-U]]},[I,d]);return $.jsx("group",{children:B.map(U=>$.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:E[U.i],position:[0,0,U.z],children:$.jsxs(kpt,{computeVertexNormals:!0,children:[$.jsx(ESe,{geometry:R}),N.map((V,W)=>{const K=S+U.spiral,q=Math.cos(K),j=Math.sin(K),te=V[0]*q-V[1]*j,he=V[0]*j+V[1]*q;return $.jsx(zpt,{geometry:P,rotation:[0,0,b+U.spiral],position:[o.x+te*U.scale,o.y+he*U.scale,l],scale:[I*U.scale,I*U.scale,1]},`cut-${U.i}-${W}`)})]})},U.i))})}function Hpt(){return $.jsxs($.Fragment,{children:[$.jsx("color",{attach:"background",args:["#f0f0f0"]}),$.jsx("ambientLight",{intensity:1}),$.jsx(PA,{}),$.jsx(lI,{screenShot:!0}),$.jsx(Vpt,{})]})}const RSe=G.createContext(null);function Xpt({children:n}){const e=G.useContext(RSe);return e?SV($.jsx("group",{children:G.Children.map(n,t=>G.isValidElement(t)?G.cloneElement(t,{material:new La({color:"white"})}):null)}),e):null}class PSe extends oE{constructor(e,t,{pixelSize:i=8,maskScene:r}){super("PixelMaskEffect",`
        uniform sampler2D maskTex;
        uniform sampler2D maskDepthTex;
        uniform float pixelSize;
        uniform vec2 resolution;
        uniform float depthBias;

        void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {

        float sceneDepth = texture(depthBuffer, uv).r;
        float maskDepth  = texture(maskDepthTex, uv).r;

        float px = 1.0 / resolution.x;
        float py = 1.0 / resolution.y;

        float mask = 0.0;
        mask += texture(maskTex, uv + vec2( px, 0)).r;
        mask += texture(maskTex, uv + vec2(-px, 0)).r;
        mask += texture(maskTex, uv + vec2(0,  py)).r;
        mask += texture(maskTex, uv + vec2(0, -py)).r;
        mask *= 0.25;

        bool depthPass = sceneDepth > maskDepth + depthBias;
        bool stable = abs(sceneDepth - maskDepth) > 0.0012;

        vec4 color = inputColor;

        if (mask > 0.02 && depthPass && stable) {
            vec2 grid = pixelSize / resolution;
            vec2 pUv = floor(uv / grid) * grid;
            color = texture(inputBuffer, pUv);
        }

        outputColor = color;
        }
      `,{uniforms:new Map([["maskTex",new mi(null)],["maskDepthTex",new mi(null)],["depthBias",new mi(.005)],["pixelSize",new mi(i)],["resolution",new mi(new rt)]])}),this.needsDepthTexture=!0,this.scene=e,this.camera=t,this.maskScene=r,this.maskTarget=new Nr(1,1,{depthBuffer:!0}),this.maskTarget.depthTexture=new po,this.maskTarget.depthTexture.type=jl}update(e){const t=e.getSize(new rt);this.uniforms.get("resolution").value.set(t.x,t.y),(this.maskTarget.width!==t.x||this.maskTarget.height!==t.y)&&this.maskTarget.setSize(t.x,t.y),e.setRenderTarget(this.maskTarget),e.clear(),e.render(this.maskScene,this.camera),e.setRenderTarget(null),this.uniforms.get("maskTex").value=this.maskTarget.texture,this.uniforms.get("maskDepthTex").value=this.maskTarget.depthTexture}}eo({PixelMaskEffectImpl:PSe});function Wpt({children:n,pixelSize:e=8}){const{scene:t,camera:i}=ir(),r=G.useMemo(()=>new Wc,[]),s=G.useMemo(()=>new PSe(t,i,{pixelSize:e,maskScene:r}),[t,i,e,r]);return $.jsxs(RSe.Provider,{value:r,children:[$.jsx(Aje,{intensity:0,radius:.001}),$.jsx("primitive",{object:s}),n]})}function Zpt(){const{pixelEffect:n,effectShape:e,pixelSize:t,planeHeight:i,planeWidth:r}=Ks("",{pixelEffect:{label:"Effect",options:{Yours:"Yours",Mine:"Mine"},value:"Yours"},effectShape:{label:"Effect Shape",options:{Plane:"Plane",TwoPanes:"TwoPanes",Cube:"Cube",Cubes:"Cubes",Torus:"Torus",Sphere:"Sphere",Knot:"Knot"},value:"TwoPanes"},pixelSize:{label:"Pixel Size",value:8,min:1,max:32,step:1},planeHeight:{label:"Plane Height",value:1,min:1,max:10,step:.25},planeWidth:{label:"Plane Width",value:5,min:1,max:10,step:.25}},{});return $.jsxs($.Fragment,{children:[$.jsx(PA,{}),$.jsx(mA,{enableDamping:!0,enablePan:!0,enableRotate:!0,enableZoom:!0}),$.jsx(gL,{preset:"studio",background:!0,blur:.25}),$.jsx(Vdt,{scale:10,position:[0,0,-1],rotation:[0,0,0]}),$.jsxs("mesh",{position:[0,0,1],children:[$.jsx("sphereGeometry",{args:[.25,32,32]}),$.jsx("meshPhysicalMaterial",{color:"hotpink"})]}),$.jsxs(uue,{multisampling:0,enableNormalPass:!0,children:[n==="Yours"&&$.jsx(cue,{granularity:t}),n==="Mine"&&$.jsx(Wpt,{pixelSize:t,children:$.jsxs(Xpt,{children:[e==="Plane"&&$.jsx(LWe,{args:[r,i],children:$.jsx("meshBasicMaterial",{})}),e==="TwoPanes"&&$.jsxs($.Fragment,{children:[$.jsxs("mesh",{position:[.5,.5,0],children:[$.jsx("planeGeometry",{args:[1,1]}),$.jsx("meshBasicMaterial",{})]}),$.jsxs("mesh",{position:[-.5,-.5,0],children:[$.jsx("planeGeometry",{args:[1,1]}),$.jsx("meshBasicMaterial",{})]})]}),e==="Cube"&&$.jsxs("mesh",{position:0,children:[$.jsx("boxGeometry",{args:[1,1,1]}),$.jsx("meshBasicMaterial",{}),"``"]}),e==="Cubes"&&$.jsx($.Fragment,{children:$.jsxs("mesh",{position:[0,0,1],children:[$.jsx("boxGeometry",{args:[1,1,1]}),$.jsx("meshBasicMaterial",{})]})}),e==="Torus"&&$.jsxs("mesh",{children:[$.jsx("torusGeometry",{args:[.5,.15,16,100]}),$.jsx("meshBasicMaterial",{})]}),e==="Sphere"&&$.jsxs("mesh",{children:[$.jsx("sphereGeometry",{args:[.4,32,32]}),$.jsx("meshBasicMaterial",{})]}),e==="Knot"&&$.jsxs("mesh",{children:[$.jsx("torusKnotGeometry",{args:[.5,.1,100,16]}),$.jsx("meshBasicMaterial",{})]})]})})]})]})}const jpt=Yd({uTime:0,uColorTop:new en("#ff9bf5"),uColorBottom:new en("#ff2fa4"),uBands:12,uIntensity:2.2},`
    varying vec2 vUv;

    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
    }
  `,`
    uniform vec3 uColorTop;
    uniform vec3 uColorBottom;
    uniform float uBands;
    uniform float uIntensity;

    varying vec2 vUv;

    void main() {

      // solid band or hole
      float band = step(0.5, fract(vUv.y * uBands));
      if (band > 0.5) discard;

      // radial glow
      float dist = distance(vUv, vec2(0.5));
      float glow = smoothstep(0.0, 0.35, 1.0 - dist);

      // vertical gradient
      vec3 grad = mix(uColorBottom, uColorTop, vUv.y);
      vec3 color = grad * glow * uIntensity;

      gl_FragColor = vec4(color, 1.0);
    }
  `);eo({SunMaterial:jpt});function FS({colorTop:n="#ff9bf5",colorBottom:e="#ff2fa4",bands:t=12,intensity:i=2.2,...r}){const s=G.useRef();return rs((a,o)=>{s.current&&(s.current.uTime+=o)}),$.jsxs("mesh",{...r,children:[$.jsx("sphereGeometry",{args:[1.5,64,64]}),$.jsx("sunMaterial",{ref:s,side:wo,depthWrite:!0,depthTest:!0,uColorTop:n,uColorBottom:e,uBands:t,uIntensity:i})]})}function vq({colorTop:n="#ff9bf5",colorBottom:e="#ff2fa4",innerColorTop:t="#6b2cff",innerColorBottom:i="#14002b",bands:r=12,intensity:s=2.2,radius:a=1.5,...o}){const l=G.useRef(),u=G.useRef();return rs((c,d)=>{l.current&&(l.current.uTime+=d),u.current&&(u.current.uTime+=d*.6)}),$.jsxs("group",{...o,children:[$.jsxs("mesh",{children:[$.jsx("sphereGeometry",{args:[a,64,64]}),$.jsx("sunMaterial",{ref:l,side:wo,depthWrite:!0,depthTest:!0,uColorTop:n,uColorBottom:e,uBands:r,uIntensity:s})]}),$.jsxs("mesh",{scale:.992,children:[$.jsx("sphereGeometry",{args:[a,64,64]}),$.jsx("sunMaterial",{ref:u,side:Er,depthWrite:!0,depthTest:!0,uColorTop:t,uColorBottom:i,uBands:r,uIntensity:s*.75})]})]})}const xq={Miami:{bg:"#07000f",grid:"#ff4fd8",wire:"#00f6ff",accent:"#ffe66d",fog:"#2b0051",skyTop:"#ff4fd8",skyBottom:"#00f6ff"},CyberSunset:{bg:"#02010a",grid:"#ff8c42",wire:"#b967ff",accent:"#2de2e6",fog:"#220039",skyTop:"#ff8c42",skyBottom:"#b967ff"},MonoNeon:{bg:"#000000",grid:"#00ff9c",wire:"#00ff9c",accent:"#ffffff",fog:"#00422e",skyTop:"#008b56",skyBottom:"#000000"}};function dx({children:n,speed:e=.25,amp:t=.6}){const i=G.useRef();return rs(r=>{const s=r.clock.elapsedTime*e;i.current&&(i.current.position.y=Math.sin(s)*t,i.current.rotation.y+=.002,i.current.rotation.x=Math.sin(s*.6)*.04)}),$.jsx("group",{ref:i,children:n})}const Ypt=Yd({uTop:new en("#2b0f3f"),uBottom:new en("#060010")},`
    varying vec3 vPos;
    void main() {
      vPos = position;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
    }
  `,`
    uniform vec3 uTop;
    uniform vec3 uBottom;
    varying vec3 vPos;

    void main() {
      float h = normalize(vPos).y * 0.5 + 0.5;
      vec3 col = mix(uBottom, uTop, smoothstep(0.0, 1.0, h));
      gl_FragColor = vec4(col, 1.0);
    }
  `);eo({SkyMaterial:Ypt});function Kpt({top:n,bottom:e}){return $.jsxs("mesh",{scale:200,children:[$.jsx("sphereGeometry",{args:[1,64,64]}),$.jsx("skyMaterial",{side:Er,uTop:n,uBottom:e})]})}function $pt({y:n=-2.401}){return $.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,n,0],children:[$.jsx("planeGeometry",{args:[500,500]}),$.jsx("meshStandardMaterial",{color:"#000",transparent:!0,opacity:1,depthWrite:!0})]})}const Jpt=Yd({uColorTop:new en("#ff9bf5"),uColorBottom:new en("#ff2fa4"),uBands:14,uHorizon:.35},`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
    }
  `,`
    uniform vec3 uColorTop;
    uniform vec3 uColorBottom;
    uniform float uBands;
    uniform float uHorizon;
    varying vec2 vUv;

    void main() {

      if (vUv.y < uHorizon) discard;

      float band = step(0.5, fract(vUv.y * uBands));

      float dist = distance(vUv, vec2(0.5));
      float glow = smoothstep(0.0, 0.35, 1.0 - dist);

      vec3 grad = mix(uColorBottom, uColorTop, vUv.y);
      vec3 color = grad * glow * 2.2;

      gl_FragColor = vec4(color, band);
    }
  `);eo({HorizonSunMaterial:Jpt});function qpt({colorTop:n,colorBottom:e,bands:t=14,horizon:i=.35,...r}){return $.jsxs("mesh",{...r,children:[$.jsx("sphereGeometry",{args:[2.4,64,64]}),$.jsx("horizonSunMaterial",{transparent:!0,depthWrite:!1,side:fr,uColorTop:n,uColorBottom:e,uBands:t,uHorizon:i})]})}function Qpt({theme:n}){const e=G.useMemo(()=>new YM(n.fog,10,70),[n]);return $.jsxs($.Fragment,{children:[$.jsx("primitive",{attach:"fog",object:e}),$.jsx(Kpt,{top:n.skyTop,bottom:n.skyBottom}),$.jsx("ambientLight",{intensity:.6}),$.jsx("pointLight",{position:[0,6,-10],intensity:3,color:n.accent}),$.jsx(qpt,{position:[0,2.4,-155],scale:17,colorTop:n.accent,colorBottom:n.grid,bands:18,horizon:.38}),$.jsx($pt,{y:-2.42}),$.jsx(kle,{position:[0,-2.4,0],args:[140,140],cellSize:1,sectionSize:6,infiniteGrid:!0,fadeDistance:70,fadeStrength:1,cellColor:n.grid,sectionColor:n.grid}),$.jsx(dx,{children:$.jsx(FS,{position:[5,9,-12],colorTop:"#ededed",colorBottom:"#343434",bands:20})}),$.jsx(dx,{children:$.jsx(FS,{position:[-1,-3,2],colorTop:"#38daf6",colorBottom:"#7e007e",bands:7})}),$.jsx(dx,{children:$.jsx(FS,{scale:2.2,position:[-7,.5,-10],colorTop:"#b500b5",colorBottom:"#00ff59",bands:16})}),$.jsx(dx,{children:$.jsx(vq,{scale:2.2,position:[7,-.5,10],colorTop:"#b500b5",colorBottom:"#00ff59",innerColorTop:"#00ff59",innerColorBottom:"#b500b5",bands:16})}),$.jsx(dx,{children:$.jsx(FS,{scale:1.3,position:[4,-.3,-7],colorTop:"#e020e6",colorBottom:"#02c68e",bands:12})}),$.jsx(dx,{children:$.jsx(FS,{scale:.7,position:[-7,.5,4],colorTop:"#0d00ff",colorBottom:"#ff00ff",bands:16})}),$.jsxs(dx,{children:[$.jsx(FS,{scale:.7,position:[5.5,6,4],colorTop:"#ff0084",colorBottom:"#0080ff",bands:16}),$.jsx(vq,{scale:.2,position:[6.5,7,4.5],colorTop:"#ff0084",colorBottom:"#0080ff",innerColorTop:"#ffffff",innerColorBottom:"#000000",bands:8})]})]})}function emt(){const{ready:n,play:e,stop:t,isPlaying:i}=Y_e({withSamples:!0}),r=G.useMemo(()=>Object.fromEntries(Object.entries(v2).map(([d,f])=>[d,f.toString()])),[]),{themeName:s,presetName:a,autoPlay:o}=Ks("Strudelizer",{Theme:Mi({themeName:{value:"Miami",options:Object.keys(xq)}}),Track:Mi({presetName:{value:"defaultPattern",options:Object.keys(r)},autoPlay:!1})}),l=xq[s],[u,c]=G.useState(v2.defaultPattern);return G.useEffect(()=>{const d=r[a];d&&(c(d),o&&n&&e(d))},[a,n,o,e]),$.jsxs($.Fragment,{children:[$.jsx(mA,{enablePan:!1,minDistance:6,maxDistance:16,target:[0,1.5,0],minPolarAngle:Math.PI*.35,maxPolarAngle:Math.PI*.495}),$.jsx(Qpt,{theme:l}),$.jsx(TH,{center:!0,transform:!0,position:[0,2.5,-2],children:$.jsxs("div",{style:{width:420,maxWidth:"90vw",background:`linear-gradient(180deg, ${l.bg}, #000)`,color:l.wire,padding:16,fontFamily:"monospace",borderRadius:14,border:`1px solid ${l.grid}`,boxShadow:`0 0 30px ${l.grid}55, inset 0 0 30px #000`,display:"flex",flexDirection:"column",gap:8,pointerEvents:"auto"},children:[$.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[$.jsx("strong",{style:{color:l.accent},children:" STRUDELIZER"}),$.jsx("span",{style:{color:n?l.wire:"#f33"},children:n?"ready":"loading"})]}),$.jsx("div",{style:{color:i?l.wire:"#f44"},children:i?" playing":" stopped"}),$.jsx("textarea",{value:u,onChange:d=>c(d.target.value),rows:9,style:{width:"100%",background:"#000",color:l.wire,border:`1px solid ${l.grid}`,padding:10,resize:"none",borderRadius:8,outline:"none"}}),$.jsxs("div",{style:{display:"flex",gap:8},children:[$.jsx("button",{type:"button",onClick:()=>e(u),children:" play"}),$.jsx("button",{type:"button",onClick:t,children:" stop"})]}),$.jsx("div",{style:{fontSize:11,opacity:.6},children:"First interaction must be a user tap (mobile audio unlock)"})]})})]})}function tmt(){return $.jsx(TH,{children:$.jsx("p",{children:""})})}const nmt={id:"noScene",renderer:"webgl",Component:tmt,icon:"",public:!0,linkable:!0},imt={id:"pixelHater",renderer:"webgl",Component:Zpt,label:"PixelHater",icon:"",public:!1,linkable:!0},rmt={id:"dumpsterFire",renderer:"webgl",Component:tdt,label:"Dumpster Fire",icon:"",public:!1,linkable:!1},smt={id:"foldedFrame",renderer:"webgl",Component:udt,label:"Folded Frame",icon:"  ",public:!0,linkable:!0},amt={id:"loGlow",renderer:"webgl",Component:wdt,label:"LoGlow",icon:"",public:!0,linkable:!0},omt={id:"newScene",renderer:"webgl",Component:Jdt,label:"New Scene",icon:"",public:!0,linkable:!0},lmt={id:"paperStack",renderer:"webgl",Component:Hpt,label:"Paper Stack",icon:"",public:!0,linkable:!0},umt={id:"handStuff",renderer:"webgl",Component:Adt,label:"Hand Stuff",icon:"",public:!1,linkable:!0},cmt={id:"networkTest",renderer:"webgpu",Component:Odt,label:"Network Test",icon:"",public:!1,linkable:!0},hmt={id:"crtTest",renderer:"webgl",Component:jht,label:"CRT Test",icon:"",public:!1,linkable:!1},dmt={id:"strudelDoodle",renderer:"webgl",Component:emt,label:"StrudelDoodle",icon:"",public:!1,linkable:!0},fmt=[nmt,imt,rmt,smt,amt,omt,lmt,umt,cmt,hmt,dmt];function pmt(){return{scenes:fmt}}function mmt(){return new URLSearchParams(window.location.search).get("scene")}const bq="loGlow";function gmt(){const n=u9(),{scenes:e}=pmt(),t=G.useMemo(()=>Object.fromEntries(e.map(d=>[d.id,d])),[e]),i=G.useMemo(()=>n?e:e.filter(d=>d.public),[n,e]),r=G.useMemo(()=>Object.fromEntries(i.map(d=>[`${d.label??d.id}`,d.id])),[i]),s=G.useMemo(()=>{const d=mmt();if(d&&t[d]){const m=t[d];if(n||m.linkable)return m.id}return!d&&!n&&t[bq]?t[bq].id:e.find(m=>m.public&&m.linkable)?.id??e[0].id},[n,t,e]),{scene:a}=Ks("Scene Selection",{scene:{options:r,value:s}});G.useEffect(()=>{const d=new URLSearchParams(window.location.search);d.set("scene",a),window.history.replaceState({},"",`?${d.toString()}`)},[a]);const o=t[a],l=o?.renderer??"webgl",u=o?.Component,c=l==="webgpu"?dXe:cUe;return $.jsx("div",{className:"App",children:$.jsx(c,{children:$.jsx(G.Suspense,{fallback:$.jsx(iue,{}),children:u&&$.jsx(u,{})})},l)})}function ymt(){const n=new Date,e=`${n.getDate()} | ${n.getMonth()+1} | ${n.getFullYear()}`;return $.jsx("span",{children:e})}var DSe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},_q=Ie.createContext&&Ie.createContext(DSe),vmt=["attr","size","title"];function xmt(n,e){if(n==null)return{};var t=bmt(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}function bmt(n,e){if(n==null)return{};var t={};for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){if(e.indexOf(i)>=0)continue;t[i]=n[i]}return t}function A2(){return A2=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},A2.apply(this,arguments)}function Sq(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function T2(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Sq(Object(t),!0).forEach(function(i){_mt(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Sq(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function _mt(n,e,t){return e=Smt(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Smt(n){var e=Mmt(n,"string");return typeof e=="symbol"?e:e+""}function Mmt(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function NSe(n){return n&&n.map((e,t)=>Ie.createElement(e.tag,T2({key:t},e.attr),NSe(e.child)))}function BSe(n){return e=>Ie.createElement(Amt,A2({attr:T2({},n.attr)},e),NSe(n.child))}function Amt(n){var e=t=>{var{attr:i,size:r,title:s}=n,a=xmt(n,vmt),o=r||t.size||"1em",l;return t.className&&(l=t.className),n.className&&(l=(l?l+" ":"")+n.className),Ie.createElement("svg",A2({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,a,{className:l,style:T2(T2({color:n.color||t.color},t.style),n.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),s&&Ie.createElement("title",null,s),n.children)};return _q!==void 0?Ie.createElement(_q.Consumer,null,t=>e(t)):e(DSe)}function Tmt(n){return BSe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"},child:[]}]})(n)}function Cmt(n){return BSe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"},child:[]}]})(n)}function wmt(){return $.jsxs("div",{className:"external-links",children:[$.jsx("span",{children:"Brett McGillis"}),$.jsx("a",{href:"https://www.instagram.com/ruinedpaintings/",target:"_blank",rel:"noreferrer","aria-label":"Instagram",children:$.jsx(Tmt,{size:16,color:"#000000"})}),$.jsx("a",{href:"https://www.linkedin.com/in/brett-mcgillis-61b93a125/",target:"_blank",rel:"noreferrer","aria-label":"LinkedIn",children:$.jsx(Cmt,{size:16,color:"#000000"})})]})}var FSe=/^--/;function Emt(n,e){return e==null||typeof e=="boolean"||e===""?"":typeof e=="number"&&e!==0&&!FSe.test(n)&&!(Bw.hasOwnProperty(n)&&Bw[n])?e+"px":(""+e).trim()}var Mq={};function Rmt(n,e){if(!n.nodeType||!n.setAttribute)return!1;const t=n.nodeName==="filter"||n.parentNode&&n.parentNode.nodeName==="filter",{className:i,style:r,children:s,scrollTop:a,scrollLeft:o,viewBox:l,...u}=e,c=Object.values(u),d=Object.keys(u).map(f=>t||n.hasAttribute(f)?f:Mq[f]||(Mq[f]=f.replace(/([A-Z])/g,m=>"-"+m.toLowerCase())));s!==void 0&&(n.textContent=s);for(const f in r)if(r.hasOwnProperty(f)){const m=Emt(f,r[f]);FSe.test(f)?n.style.setProperty(f,m):n.style[f]=m}d.forEach((f,m)=>{n.setAttribute(f,c[m])}),i!==void 0&&(n.className=i),a!==void 0&&(n.scrollTop=a),o!==void 0&&(n.scrollLeft=o),l!==void 0&&n.setAttribute("viewBox",l)}var Bw={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Pmt=(n,e)=>n+e.charAt(0).toUpperCase()+e.substring(1),Dmt=["Webkit","Ms","Moz","O"];Bw=Object.keys(Bw).reduce((n,e)=>(Dmt.forEach(t=>n[Pmt(t,e)]=n[e]),n),Bw);var Nmt=/^(matrix|translate|scale|rotate|skew)/,Bmt=/^(translate)/,Fmt=/^(rotate|skew)/,x5=(n,e)=>_n.num(n)&&n!==0?n+e:n,lB=(n,e)=>_n.arr(n)?n.every(t=>lB(t,e)):_n.num(n)?n===e:parseFloat(n)===e,Lmt=class extends AL{constructor({x:n,y:e,z:t,...i}){const r=[],s=[];(n||e||t)&&(r.push([n||0,e||0,t||0]),s.push(a=>[`translate3d(${a.map(o=>x5(o,"px")).join(",")})`,lB(a,0)])),Em(i,(a,o)=>{if(o==="transform")r.push([a||""]),s.push(l=>[l,l===""]);else if(Nmt.test(o)){if(delete i[o],_n.und(a))return;const l=Bmt.test(o)?"px":Fmt.test(o)?"deg":"";r.push(tc(a)),s.push(o==="rotate3d"?([u,c,d,f])=>[`rotate3d(${u},${c},${d},${x5(f,l)})`,lB(f,0)]:u=>[`${o}(${u.map(c=>x5(c,l)).join(",")})`,lB(u,o.startsWith("scale")?1:0)])}}),r.length&&(i.transform=new Imt(r,s)),super(i)}},Imt=class extends _ue{constructor(n,e){super(),this.inputs=n,this.transforms=e,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let n="",e=!0;return Yi(this.inputs,(t,i)=>{const r=Gc(t[0]),[s,a]=this.transforms[i](_n.arr(r)?r:t.map(Gc));n+=" "+s,e=e&&a}),e?"none":n}observerAdded(n){n==1&&Yi(this.inputs,e=>Yi(e,t=>yd(t)&&gA(t,this)))}observerRemoved(n){n==0&&Yi(this.inputs,e=>Yi(e,t=>yd(t)&&hE(t,this)))}eventObserved(n){n.type=="change"&&(this._value=null),cE(this,n)}},Gmt=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];kd.assign({batchedUpdates:C2.unstable_batchedUpdates,createStringInterpolator:ZH,colors:bue});var Omt=Rue(Gmt,{applyAnimatedValues:Rmt,createAnimatedStyle:n=>new Lmt(n),getComponentProps:({scrollTop:n,scrollLeft:e,...t})=>t}),Aq=Omt.animated;const Umt={colors:{elevation1:"var(--overlay-bg)",elevation2:"var(--overlay-bg-2)",elevation3:"var(--overlay-bg)",highlight1:"#000",highlight2:"#000",highlight3:"#ffffff",accent1:"#000",accent2:"#000",accent3:"#000",folderWidgetColor:"#000"},radii:{xs:"6px",sm:"10px",lg:"2em"},shadows:{level1:"none"},fonts:{mono:"inherit",sans:"inherit"}};function kmt({visible:n}){const e=u9(),t=kg({opacity:n?1:0,maxHeight:n?600:0,config:{tension:170,friction:26}}),i=jue(n,{from:{opacity:0,y:-12,scale:.97},enter:{opacity:1,y:0,scale:1},leave:{opacity:0,y:-12,scale:.97},config:{tension:170,friction:26}});return $.jsx(Aq.div,{style:{overflow:"hidden",opacity:t.opacity,maxHeight:t.maxHeight},children:i((r,s)=>s?$.jsx(Aq.div,{style:{opacity:r.opacity,transform:r.y.to(a=>`translate3d(0, ${a}px, 0) scale(${r.scale.get()})`),transformOrigin:"top right"},children:$.jsx(Nee,{collapsed:!e,hidden:!1,oneLineLabels:!0,theme:Umt,fill:!0,titleBar:{title:"",filter:!0,drag:!1}})}):null)})}function zmt(){return $.jsxs("div",{className:"version-tag",children:["v. ","0.1.0"]})}function Vmt(){const n=u9(),[e,t]=G.useState(!!n),i=()=>{t(r=>!r)};return $.jsxs("div",{className:"overlay",children:[$.jsxs("div",{className:"top-right overlay-panel",children:[$.jsx(zmt,{}),$.jsx(kmt,{visible:e})]}),$.jsxs("div",{className:"top-left overlay-panel",children:[$.jsxs("span",{className:"debug",onClick:i,children:[""," "]})," "]}),$.jsx("div",{className:"bottom-left overlay-panel",children:$.jsx(wmt,{})}),$.jsx("div",{className:"bottom-right overlay-panel",children:$.jsx(ymt,{})})]})}Uz.createRoot(document.getElementById("root")).render($.jsxs($.Fragment,{children:[$.jsx(Vmt,{}),$.jsx(gmt,{})]}));
